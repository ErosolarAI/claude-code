{"code":"jest.mock(\"../src/core/agentSchemaLoader.js\",()=>{const mockSchema={contractVersion:\"1.0.0\",version:\"2024-11-24\",providers:[{id:\"openai\",label:\"OpenAI\",envVars:{apiKey:\"OPENAI_API_KEY\"}},{id:\"anthropic\",label:\"Anthropic\",envVars:{apiKey:\"ANTHROPIC_API_KEY\"}},{id:\"ollama\",label:\"Ollama (Local)\",envVars:{}}],models:[{id:\"gpt-4o\",label:\"gpt-4o\",provider:\"openai\"},{id:\"claude-3-opus\",label:\"Claude 3 Opus\",provider:\"anthropic\"}],profiles:[{name:\"agi-code\",label:\"AGI Code\",description:\"Coding assistant\"}],slashCommands:[],capabilities:[]};let cachedSchema=mockSchema;return{getAgentSchemas:jest.fn(()=>{if(!cachedSchema){cachedSchema=mockSchema}return cachedSchema}),getProviders:jest.fn(()=>mockSchema.providers),getProvider:jest.fn(providerId=>mockSchema.providers.find(p=>p.id===providerId)),getModels:jest.fn(async()=>mockSchema.models),getModelsByProvider:jest.fn(async providerId=>mockSchema.models.filter(m=>m.provider===providerId)),getModel:jest.fn(async modelId=>mockSchema.models.find(m=>m.id===modelId)),getProfiles:jest.fn(()=>mockSchema.profiles),getProfile:jest.fn(profileName=>mockSchema.profiles.find(p=>p.name===profileName)),getSlashCommands:jest.fn(()=>mockSchema.slashCommands),getCapabilities:jest.fn(()=>mockSchema.capabilities),clearSchemaCache:jest.fn(()=>{cachedSchema=null}),isValidProvider:jest.fn(providerId=>mockSchema.providers.some(p=>p.id===providerId)),isValidModel:jest.fn(async modelId=>mockSchema.models.some(m=>m.id===modelId)),isValidProfile:jest.fn(profileName=>mockSchema.profiles.some(p=>p.name===profileName))}});import{getAgentSchemas,getProviders,getProvider,getModels,getModelsByProvider,getModel,getProfiles,getProfile,getSlashCommands,getCapabilities,clearSchemaCache,isValidProvider,isValidModel,isValidProfile}from\"../src/core/agentSchemaLoader.js\";describe(\"agentSchemaLoader\",()=>{beforeEach(()=>{clearSchemaCache()});it(\"should load agent schemas\",()=>{const schemas=getAgentSchemas();expect(schemas).toBeDefined();expect(schemas.contractVersion).toBe(\"1.0.0\");expect(schemas.version).toBeDefined();expect(Array.isArray(schemas.providers)).toBe(true);expect(Array.isArray(schemas.models)).toBe(true);expect(Array.isArray(schemas.profiles)).toBe(true)});it(\"should get providers list\",()=>{const providers=getProviders();expect(Array.isArray(providers)).toBe(true);expect(providers.length).toBeGreaterThan(0);const openaiProvider=providers.find(p=>p.id===\"openai\");expect(openaiProvider).toBeDefined();expect(openaiProvider?.label).toBe(\"OpenAI\")});it(\"should get specific provider\",()=>{const provider=getProvider(\"anthropic\");expect(provider).toBeDefined();expect(provider?.id).toBe(\"anthropic\");expect(provider?.label).toBe(\"Anthropic\");const unknownProvider=getProvider(\"unknown\");expect(unknownProvider).toBeUndefined()});it(\"should get models asynchronously\",async()=>{const models=await getModels();expect(Array.isArray(models)).toBe(true);expect(models.length).toBeGreaterThan(0);const hasGpt4o=models.some(m=>m.id===\"gpt-4o\");expect(hasGpt4o).toBe(true)});it(\"should get models by provider asynchronously\",async()=>{const openaiModels=await getModelsByProvider(\"openai\");expect(Array.isArray(openaiModels)).toBe(true);expect(openaiModels.length).toBeGreaterThan(0);expect(openaiModels.every(m=>m.provider===\"openai\")).toBe(true);const emptyModels=await getModelsByProvider(\"unknown\");expect(Array.isArray(emptyModels)).toBe(true);expect(emptyModels.length).toBe(0)});it(\"should get specific model asynchronously\",async()=>{const model=await getModel(\"gpt-4o\");expect(model).toBeDefined();expect(model?.id).toBe(\"gpt-4o\");expect(model?.provider).toBe(\"openai\");const unknownModel=await getModel(\"unknown-model\");expect(unknownModel).toBeUndefined()});it(\"should get profiles list\",()=>{const profiles=getProfiles();expect(Array.isArray(profiles)).toBe(true);expect(profiles.length).toBeGreaterThan(0);const hasCodeProfile=profiles.some(p=>p.name===\"agi-code\");expect(hasCodeProfile).toBe(true)});it(\"should get specific profile\",()=>{const profile=getProfile(\"agi-code\");expect(profile).toBeDefined();expect(profile?.name).toBe(\"agi-code\");const unknownProfile=getProfile(\"unknown-profile\");expect(unknownProfile).toBeUndefined()});it(\"should get slash commands\",()=>{const slashCommands=getSlashCommands();expect(Array.isArray(slashCommands)).toBe(true)});it(\"should get capabilities\",()=>{const capabilities=getCapabilities();expect(Array.isArray(capabilities)).toBe(true)});it(\"should validate provider IDs\",()=>{expect(isValidProvider(\"openai\")).toBe(true);expect(isValidProvider(\"anthropic\")).toBe(true);expect(isValidProvider(\"unknown\")).toBe(false)});it(\"should validate model IDs asynchronously\",async()=>{expect(await isValidModel(\"gpt-4o\")).toBe(true);expect(await isValidModel(\"unknown-model\")).toBe(false)});it(\"should validate profile names\",()=>{expect(isValidProfile(\"agi-code\")).toBe(true);expect(isValidProfile(\"unknown-profile\")).toBe(false)})});\n","warnings":[],"map":{"version":3,"mappings":"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","names":[],"ignoreList":[],"sources":["/Users/bo/GitHub/agi-core-CLI-coding/test/agentSchemaLoader.test.ts"],"sourcesContent":[null]}}