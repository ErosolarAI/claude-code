{"version":3,"names":["cov_1970357qum","actualCoverage","existsSync","readdirSync","readFileSync","join","homedir","logDebug","dataRoot","s","b","process","env","trim","defaultCommandsDir","loadCustomSlashCommands","dir","f","files","filter","file","toLowerCase","endsWith","commands","seen","Set","filePath","raw","parsed","JSON","parse","Array","isArray","entry","cmd","normalizeCommand","has","command","add","push","error","buildCustomCommandPrompt","input","context","replacements","workspace","profile","provider","model","template","replace","_","key","normalized","source","record","rawCommandValue","rawCommand","startsWith","descriptionValue","description","templateEntry","templateValue","requireInputEntry","requireInput","categoryEntry","category","undefined"],"sources":["customCommands.ts"],"sourcesContent":["import { existsSync, readdirSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\nimport { homedir } from 'node:os';\nimport type { ProfileName } from '../config.js';\nimport type { ProviderId } from './types.js';\nimport { logDebug } from '../utils/debugLogger.js';\n\nconst dataRoot = process.env['EROSOLAR_DATA_DIR']?.trim() || join(homedir(), '.agi');\nconst defaultCommandsDir =\n  process.env['EROSOLAR_COMMANDS_DIR']?.trim() || join(dataRoot, 'commands');\n\nexport interface LoadedCustomCommand {\n  command: string;\n  description: string;\n  template: string;\n  requireInput: boolean;\n  source: string;\n  category?: string;\n}\n\nexport interface CustomCommandContext {\n  workspace: string;\n  profile: ProfileName;\n  provider: ProviderId;\n  model: string;\n}\n\nexport function loadCustomSlashCommands(dir: string = defaultCommandsDir): LoadedCustomCommand[] {\n  if (!existsSync(dir)) {\n    return [];\n  }\n\n  const files = readdirSync(dir).filter((file) => file.toLowerCase().endsWith('.json'));\n  const commands: LoadedCustomCommand[] = [];\n  const seen = new Set<string>();\n\n  for (const file of files) {\n    const filePath = join(dir, file);\n    try {\n      const raw = readFileSync(filePath, 'utf8');\n      const parsed = JSON.parse(raw);\n      if (Array.isArray(parsed)) {\n        for (const entry of parsed) {\n          const cmd = normalizeCommand(entry, filePath);\n          if (cmd && !seen.has(cmd.command)) {\n            seen.add(cmd.command);\n            commands.push(cmd);\n          }\n        }\n      } else {\n        const cmd = normalizeCommand(parsed, filePath);\n        if (cmd && !seen.has(cmd.command)) {\n          seen.add(cmd.command);\n          commands.push(cmd);\n        }\n      }\n    } catch (error) {\n      logDebug(`[custom commands] Failed to load ${filePath}:`, error);\n    }\n  }\n\n  return commands;\n}\n\nexport function buildCustomCommandPrompt(\n  command: LoadedCustomCommand,\n  input: string,\n  context: CustomCommandContext\n): string {\n  const replacements: Record<string, string> = {\n    input,\n    workspace: context.workspace,\n    profile: context.profile,\n    provider: context.provider,\n    model: context.model,\n  };\n  return command.template.replace(/\\{\\{\\s*(\\w+)\\s*\\}\\}/g, (_, key: string) => {\n    const normalized = key.toLowerCase();\n    return replacements[normalized] ?? replacements[key] ?? '';\n  });\n}\n\nfunction normalizeCommand(entry: unknown, source: string): LoadedCustomCommand | null {\n  if (!entry || typeof entry !== 'object') {\n    return null;\n  }\n  const record = entry as Record<string, unknown>;\n  const rawCommandValue = record['command'];\n  const rawCommand =\n    typeof rawCommandValue === 'string' ? rawCommandValue.trim() : '';\n  const command = rawCommand ? (rawCommand.startsWith('/') ? rawCommand : `/${rawCommand}`) : '';\n\n  const descriptionValue = record['description'];\n  const description =\n    typeof descriptionValue === 'string' && descriptionValue.trim()\n      ? descriptionValue.trim()\n      : 'Custom command';\n\n  const templateEntry = record['template'] ?? record['prompt'];\n  const templateValue = typeof templateEntry === 'string' ? templateEntry : '';\n\n  if (!command || !templateValue.trim()) {\n    return null;\n  }\n\n  const requireInputEntry = record['requireInput'] ?? record['inputRequired'];\n  const requireInput = typeof requireInputEntry === 'boolean' ? requireInputEntry : false;\n\n  const categoryEntry = record['category'];\n  const category = typeof categoryEntry === 'string' ? categoryEntry.trim() : undefined;\n\n  return {\n    command,\n    description,\n    template: templateValue,\n    requireInput,\n    source,\n    category,\n  };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}