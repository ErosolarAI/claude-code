e580393aeabe29d790b54ec2dd9a231b
"use strict";

var _errorUtils = require("../src/utils/errorUtils.js");
describe('errorUtils', () => {
  it('createErrorDetails creates proper error details from Error', () => {
    const error = new Error('Test error');
    const context = {
      userId: '123',
      action: 'test'
    };
    const details = (0, _errorUtils.createErrorDetails)(error, context);
    expect(details.message).toBe('Test error');
    expect(details.code).toBe('TEST_ERROR');
    expect(details.context).toEqual(context);
    expect(details.stack).toBeTruthy();
    expect(details.timestamp).toBeTruthy();
  });
  it('createErrorDetails handles non-Error objects', () => {
    const details = (0, _errorUtils.createErrorDetails)('String error');
    expect(details.message).toBe('String error');
    expect(details.code).toBeUndefined();
    expect(details.context).toBeUndefined();
    expect(details.stack).toBeUndefined();
    expect(details.timestamp).toBeTruthy();
  });
  it('formatErrorForLogging formats error with context', () => {
    const error = new Error('Test error');
    const context = {
      userId: '123',
      action: 'test'
    };
    const formatted = (0, _errorUtils.formatErrorForLogging)(error, context);
    expect(formatted).toContain('Test error');
    expect(formatted).toContain('Context: {"userId":"123","action":"test"}');
    expect(formatted).toContain('Stack:');
  });
  it('isRetryableError identifies retryable errors', () => {
    expect((0, _errorUtils.isRetryableError)(new Error('Request timeout'))).toBe(true);
    expect((0, _errorUtils.isRetryableError)(new Error('Network error'))).toBe(true);
    expect((0, _errorUtils.isRetryableError)(new Error('Rate limit exceeded'))).toBe(true);
    expect((0, _errorUtils.isRetryableError)(new Error('Too many requests'))).toBe(true);
    expect((0, _errorUtils.isRetryableError)(new Error('Service unavailable'))).toBe(true);
    expect((0, _errorUtils.isRetryableError)(new Error('Regular error'))).toBe(false);
    expect((0, _errorUtils.isRetryableError)('String error')).toBe(false);
  });
  it('withRetry retries on retryable errors', async () => {
    let attempts = 0;
    const operation = async () => {
      attempts++;
      if (attempts < 3) {
        throw new Error('Rate limit exceeded');
      }
      return 'success';
    };
    const result = await (0, _errorUtils.withRetry)(operation, 3, 10);
    expect(result).toBe('success');
    expect(attempts).toBe(3);
  });
  it('withRetry fails after max retries', async () => {
    let attempts = 0;
    const operation = async () => {
      attempts++;
      throw new Error('Rate limit exceeded');
    };
    await expect((0, _errorUtils.withRetry)(operation, 2, 10)).rejects.toThrow('Rate limit exceeded');
    expect(attempts).toBe(3); // initial + 2 retries
  });
  it('withRetry does not retry non-retryable errors', async () => {
    let attempts = 0;
    const operation = async () => {
      attempts++;
      throw new Error('Validation error');
    };
    await expect((0, _errorUtils.withRetry)(operation, 3, 10)).rejects.toThrow('Validation error');
    expect(attempts).toBe(1); // no retries for non-retryable errors
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXJyb3JVdGlscyIsInJlcXVpcmUiLCJkZXNjcmliZSIsIml0IiwiZXJyb3IiLCJFcnJvciIsImNvbnRleHQiLCJ1c2VySWQiLCJhY3Rpb24iLCJkZXRhaWxzIiwiY3JlYXRlRXJyb3JEZXRhaWxzIiwiZXhwZWN0IiwibWVzc2FnZSIsInRvQmUiLCJjb2RlIiwidG9FcXVhbCIsInN0YWNrIiwidG9CZVRydXRoeSIsInRpbWVzdGFtcCIsInRvQmVVbmRlZmluZWQiLCJmb3JtYXR0ZWQiLCJmb3JtYXRFcnJvckZvckxvZ2dpbmciLCJ0b0NvbnRhaW4iLCJpc1JldHJ5YWJsZUVycm9yIiwiYXR0ZW1wdHMiLCJvcGVyYXRpb24iLCJyZXN1bHQiLCJ3aXRoUmV0cnkiLCJyZWplY3RzIiwidG9UaHJvdyJdLCJzb3VyY2VzIjpbImVycm9yVXRpbHMudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBjcmVhdGVFcnJvckRldGFpbHMsXG4gIGZvcm1hdEVycm9yRm9yTG9nZ2luZyxcbiAgaXNSZXRyeWFibGVFcnJvcixcbiAgd2l0aFJldHJ5LFxufSBmcm9tICcuLi9zcmMvdXRpbHMvZXJyb3JVdGlscy5qcyc7XG5cbmRlc2NyaWJlKCdlcnJvclV0aWxzJywgKCkgPT4ge1xuICBpdCgnY3JlYXRlRXJyb3JEZXRhaWxzIGNyZWF0ZXMgcHJvcGVyIGVycm9yIGRldGFpbHMgZnJvbSBFcnJvcicsICgpID0+IHtcbiAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignVGVzdCBlcnJvcicpO1xuICAgIGNvbnN0IGNvbnRleHQgPSB7IHVzZXJJZDogJzEyMycsIGFjdGlvbjogJ3Rlc3QnIH07XG4gICAgY29uc3QgZGV0YWlscyA9IGNyZWF0ZUVycm9yRGV0YWlscyhlcnJvciwgY29udGV4dCk7XG5cbiAgICBleHBlY3QoZGV0YWlscy5tZXNzYWdlKS50b0JlKCdUZXN0IGVycm9yJyk7XG4gICAgZXhwZWN0KGRldGFpbHMuY29kZSkudG9CZSgnVEVTVF9FUlJPUicpO1xuICAgIGV4cGVjdChkZXRhaWxzLmNvbnRleHQpLnRvRXF1YWwoY29udGV4dCk7XG4gICAgZXhwZWN0KGRldGFpbHMuc3RhY2spLnRvQmVUcnV0aHkoKTtcbiAgICBleHBlY3QoZGV0YWlscy50aW1lc3RhbXApLnRvQmVUcnV0aHkoKTtcbiAgfSk7XG5cbiAgaXQoJ2NyZWF0ZUVycm9yRGV0YWlscyBoYW5kbGVzIG5vbi1FcnJvciBvYmplY3RzJywgKCkgPT4ge1xuICAgIGNvbnN0IGRldGFpbHMgPSBjcmVhdGVFcnJvckRldGFpbHMoJ1N0cmluZyBlcnJvcicpO1xuXG4gICAgZXhwZWN0KGRldGFpbHMubWVzc2FnZSkudG9CZSgnU3RyaW5nIGVycm9yJyk7XG4gICAgZXhwZWN0KGRldGFpbHMuY29kZSkudG9CZVVuZGVmaW5lZCgpO1xuICAgIGV4cGVjdChkZXRhaWxzLmNvbnRleHQpLnRvQmVVbmRlZmluZWQoKTtcbiAgICBleHBlY3QoZGV0YWlscy5zdGFjaykudG9CZVVuZGVmaW5lZCgpO1xuICAgIGV4cGVjdChkZXRhaWxzLnRpbWVzdGFtcCkudG9CZVRydXRoeSgpO1xuICB9KTtcblxuICBpdCgnZm9ybWF0RXJyb3JGb3JMb2dnaW5nIGZvcm1hdHMgZXJyb3Igd2l0aCBjb250ZXh0JywgKCkgPT4ge1xuICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKCdUZXN0IGVycm9yJyk7XG4gICAgY29uc3QgY29udGV4dCA9IHsgdXNlcklkOiAnMTIzJywgYWN0aW9uOiAndGVzdCcgfTtcbiAgICBjb25zdCBmb3JtYXR0ZWQgPSBmb3JtYXRFcnJvckZvckxvZ2dpbmcoZXJyb3IsIGNvbnRleHQpO1xuXG4gICAgZXhwZWN0KGZvcm1hdHRlZCkudG9Db250YWluKCdUZXN0IGVycm9yJyk7XG4gICAgZXhwZWN0KGZvcm1hdHRlZCkudG9Db250YWluKCdDb250ZXh0OiB7XCJ1c2VySWRcIjpcIjEyM1wiLFwiYWN0aW9uXCI6XCJ0ZXN0XCJ9Jyk7XG4gICAgZXhwZWN0KGZvcm1hdHRlZCkudG9Db250YWluKCdTdGFjazonKTtcbiAgfSk7XG5cbiAgaXQoJ2lzUmV0cnlhYmxlRXJyb3IgaWRlbnRpZmllcyByZXRyeWFibGUgZXJyb3JzJywgKCkgPT4ge1xuICAgIGV4cGVjdChpc1JldHJ5YWJsZUVycm9yKG5ldyBFcnJvcignUmVxdWVzdCB0aW1lb3V0JykpKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdChpc1JldHJ5YWJsZUVycm9yKG5ldyBFcnJvcignTmV0d29yayBlcnJvcicpKSkudG9CZSh0cnVlKTtcbiAgICBleHBlY3QoaXNSZXRyeWFibGVFcnJvcihuZXcgRXJyb3IoJ1JhdGUgbGltaXQgZXhjZWVkZWQnKSkpLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KGlzUmV0cnlhYmxlRXJyb3IobmV3IEVycm9yKCdUb28gbWFueSByZXF1ZXN0cycpKSkudG9CZSh0cnVlKTtcbiAgICBleHBlY3QoaXNSZXRyeWFibGVFcnJvcihuZXcgRXJyb3IoJ1NlcnZpY2UgdW5hdmFpbGFibGUnKSkpLnRvQmUodHJ1ZSk7XG4gICAgZXhwZWN0KGlzUmV0cnlhYmxlRXJyb3IobmV3IEVycm9yKCdSZWd1bGFyIGVycm9yJykpKS50b0JlKGZhbHNlKTtcbiAgICBleHBlY3QoaXNSZXRyeWFibGVFcnJvcignU3RyaW5nIGVycm9yJykpLnRvQmUoZmFsc2UpO1xuICB9KTtcblxuICBpdCgnd2l0aFJldHJ5IHJldHJpZXMgb24gcmV0cnlhYmxlIGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICBsZXQgYXR0ZW1wdHMgPSAwO1xuXG4gICAgY29uc3Qgb3BlcmF0aW9uID0gYXN5bmMgKCkgPT4ge1xuICAgICAgYXR0ZW1wdHMrKztcbiAgICAgIGlmIChhdHRlbXB0cyA8IDMpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSYXRlIGxpbWl0IGV4Y2VlZGVkJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gJ3N1Y2Nlc3MnO1xuICAgIH07XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB3aXRoUmV0cnkob3BlcmF0aW9uLCAzLCAxMCk7XG5cbiAgICBleHBlY3QocmVzdWx0KS50b0JlKCdzdWNjZXNzJyk7XG4gICAgZXhwZWN0KGF0dGVtcHRzKS50b0JlKDMpO1xuICB9KTtcblxuICBpdCgnd2l0aFJldHJ5IGZhaWxzIGFmdGVyIG1heCByZXRyaWVzJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBhdHRlbXB0cyA9IDA7XG5cbiAgICBjb25zdCBvcGVyYXRpb24gPSBhc3luYyAoKSA9PiB7XG4gICAgICBhdHRlbXB0cysrO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdSYXRlIGxpbWl0IGV4Y2VlZGVkJyk7XG4gICAgfTtcblxuICAgIGF3YWl0IGV4cGVjdCh3aXRoUmV0cnkob3BlcmF0aW9uLCAyLCAxMCkpLnJlamVjdHMudG9UaHJvdygnUmF0ZSBsaW1pdCBleGNlZWRlZCcpO1xuICAgIGV4cGVjdChhdHRlbXB0cykudG9CZSgzKTsgLy8gaW5pdGlhbCArIDIgcmV0cmllc1xuICB9KTtcblxuICBpdCgnd2l0aFJldHJ5IGRvZXMgbm90IHJldHJ5IG5vbi1yZXRyeWFibGUgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgIGxldCBhdHRlbXB0cyA9IDA7XG5cbiAgICBjb25zdCBvcGVyYXRpb24gPSBhc3luYyAoKSA9PiB7XG4gICAgICBhdHRlbXB0cysrO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdWYWxpZGF0aW9uIGVycm9yJyk7XG4gICAgfTtcblxuICAgIGF3YWl0IGV4cGVjdCh3aXRoUmV0cnkob3BlcmF0aW9uLCAzLCAxMCkpLnJlamVjdHMudG9UaHJvdygnVmFsaWRhdGlvbiBlcnJvcicpO1xuICAgIGV4cGVjdChhdHRlbXB0cykudG9CZSgxKTsgLy8gbm8gcmV0cmllcyBmb3Igbm9uLXJldHJ5YWJsZSBlcnJvcnNcbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFBQSxXQUFBLEdBQUFDLE9BQUE7QUFPQUMsUUFBUSxDQUFDLFlBQVksRUFBRSxNQUFNO0VBQzNCQyxFQUFFLENBQUMs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