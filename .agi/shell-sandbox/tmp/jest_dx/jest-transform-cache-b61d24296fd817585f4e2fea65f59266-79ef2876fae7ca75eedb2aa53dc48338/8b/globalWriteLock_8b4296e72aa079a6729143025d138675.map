{"version":3,"names":["cov_j4jwfo2m9","actualCoverage","streamingActive","s","isStreamingMode","f","enterStreamingMode","b","console","warn","exitStreamingMode","ifNotStreaming","callback","installGlobalWriteLock"],"sources":["globalWriteLock.ts"],"sourcesContent":["/**\n * Global Write Lock - Simplified streaming-safe output coordination\n *\n * This module provides a simple mechanism to ensure streaming content\n * is not interrupted by other UI components during streaming.\n *\n * Design Principle:\n * - During streaming, ONLY streaming content writes to stdout\n * - All other UI components (status, input area, etc.) wait until streaming ends\n * - No complex lock nesting or queuing - just a simple boolean flag\n *\n * This prevents the garbled output and cutoffs that occur when multiple\n * components try to write simultaneously with cursor positioning.\n */\n\nlet streamingActive = false;\n\n/**\n * Check if streaming mode is currently active\n */\nexport function isStreamingMode(): boolean {\n  return streamingActive;\n}\n\n/**\n * Enter streaming mode - blocks all non-streaming output\n */\nexport function enterStreamingMode(): void {\n  if (streamingActive) {\n    console.warn('[StreamingMode] enterStreamingMode() called while already in streaming mode');\n  }\n  streamingActive = true;\n}\n\n/**\n * Exit streaming mode - allows normal UI output to resume\n */\nexport function exitStreamingMode(): void {\n  // Be tolerant of double-exit; just clear the flag.\n  streamingActive = false;\n}\n\n/**\n * Execute a callback only if not in streaming mode.\n * Returns true if the callback was executed, false if skipped.\n */\nexport function ifNotStreaming(callback: () => void): boolean {\n  if (streamingActive) {\n    return false;\n  }\n  callback();\n  return true;\n}\n\n/**\n * Legacy: installGlobalWriteLock is now a no-op\n * The old approach of wrapping stdout.write caused nested lock issues.\n * We now use a simpler streaming mode flag instead.\n */\nexport function installGlobalWriteLock(): void {\n  // No-op - we no longer wrap stdout.write\n  // The streaming mode flag handles coordination instead\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,aAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,aAAA;AAfZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAIE,eAAe;AAAA;AAAA,CAAAF,aAAA,GAAAG,CAAA,OAAG,KAAK;;AAE3B;AACA;AACA;AACA,OAAO,SAASC,eAAeA,CAAA,EAAY;EAAA;EAAAJ,aAAA,GAAAK,CAAA;EAAAL,aAAA,GAAAG,CAAA;EACzC,OAAOD,eAAe;AACxB;;AAEA;AACA;AACA;AACA,OAAO,SAASI,kBAAkBA,CAAA,EAAS;EAAA;EAAAN,aAAA,GAAAK,CAAA;EAAAL,aAAA,GAAAG,CAAA;EACzC,IAAID,eAAe,EAAE;IAAA;IAAAF,aAAA,GAAAO,CAAA;IAAAP,aAAA,GAAAG,CAAA;IACnBK,OAAO,CAACC,IAAI,CAAC,6EAA6E,CAAC;EAC7F,CAAC;EAAA;EAAA;IAAAT,aAAA,GAAAO,CAAA;EAAA;EAAAP,aAAA,GAAAG,CAAA;EACDD,eAAe,GAAG,IAAI;AACxB;;AAEA;AACA;AACA;AACA,OAAO,SAASQ,iBAAiBA,CAAA,EAAS;EAAA;EAAAV,aAAA,GAAAK,CAAA;EAAAL,aAAA,GAAAG,CAAA;EACxC;EACAD,eAAe,GAAG,KAAK;AACzB;;AAEA;AACA;AACA;AACA;AACA,OAAO,SAASS,cAAcA,CAACC,QAAoB,EAAW;EAAA;EAAAZ,aAAA,GAAAK,CAAA;EAAAL,aAAA,GAAAG,CAAA;EAC5D,IAAID,eAAe,EAAE;IAAA;IAAAF,aAAA,GAAAO,CAAA;IAAAP,aAAA,GAAAG,CAAA;IACnB,OAAO,KAAK;EACd,CAAC;EAAA;EAAA;IAAAH,aAAA,GAAAO,CAAA;EAAA;EAAAP,aAAA,GAAAG,CAAA;EACDS,QAAQ,CAAC,CAAC;EAAC;EAAAZ,aAAA,GAAAG,CAAA;EACX,OAAO,IAAI;AACb;;AAEA;AACA;AACA;AACA;AACA;AACA,OAAO,SAASU,sBAAsBA,CAAA,EAAS;EAAA;EAAAb,aAAA,GAAAK,CAAA;AAG/C,CAAC,CAFC;AACA","ignoreList":[]}