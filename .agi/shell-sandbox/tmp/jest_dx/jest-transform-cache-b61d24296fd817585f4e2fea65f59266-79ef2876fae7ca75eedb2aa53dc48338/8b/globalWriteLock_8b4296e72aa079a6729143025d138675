0ea7df034e0aae881227f346b2f5ad59
/* istanbul ignore next */
function cov_j4jwfo2m9() {
  var path = "/Users/bo/GitHub/agi-core-CLI-coding/src/ui/globalWriteLock.ts";
  var hash = "4cadf4fd1b7567e86d7b4c01ace33596a1cd1913";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/bo/GitHub/agi-core-CLI-coding/src/ui/globalWriteLock.ts",
    statementMap: {
      "0": {
        start: {
          line: 16,
          column: 22
        },
        end: {
          line: 16,
          column: 27
        }
      },
      "1": {
        start: {
          line: 22,
          column: 2
        },
        end: {
          line: 22,
          column: 25
        }
      },
      "2": {
        start: {
          line: 29,
          column: 2
        },
        end: {
          line: 31,
          column: 3
        }
      },
      "3": {
        start: {
          line: 30,
          column: 4
        },
        end: {
          line: 30,
          column: 96
        }
      },
      "4": {
        start: {
          line: 32,
          column: 2
        },
        end: {
          line: 32,
          column: 25
        }
      },
      "5": {
        start: {
          line: 40,
          column: 2
        },
        end: {
          line: 40,
          column: 26
        }
      },
      "6": {
        start: {
          line: 48,
          column: 2
        },
        end: {
          line: 50,
          column: 3
        }
      },
      "7": {
        start: {
          line: 49,
          column: 4
        },
        end: {
          line: 49,
          column: 17
        }
      },
      "8": {
        start: {
          line: 51,
          column: 2
        },
        end: {
          line: 51,
          column: 13
        }
      },
      "9": {
        start: {
          line: 52,
          column: 2
        },
        end: {
          line: 52,
          column: 14
        }
      }
    },
    fnMap: {
      "0": {
        name: "isStreamingMode",
        decl: {
          start: {
            line: 21,
            column: 16
          },
          end: {
            line: 21,
            column: 31
          }
        },
        loc: {
          start: {
            line: 21,
            column: 43
          },
          end: {
            line: 23,
            column: 1
          }
        },
        line: 21
      },
      "1": {
        name: "enterStreamingMode",
        decl: {
          start: {
            line: 28,
            column: 16
          },
          end: {
            line: 28,
            column: 34
          }
        },
        loc: {
          start: {
            line: 28,
            column: 43
          },
          end: {
            line: 33,
            column: 1
          }
        },
        line: 28
      },
      "2": {
        name: "exitStreamingMode",
        decl: {
          start: {
            line: 38,
            column: 16
          },
          end: {
            line: 38,
            column: 33
          }
        },
        loc: {
          start: {
            line: 38,
            column: 42
          },
          end: {
            line: 41,
            column: 1
          }
        },
        line: 38
      },
      "3": {
        name: "ifNotStreaming",
        decl: {
          start: {
            line: 47,
            column: 16
          },
          end: {
            line: 47,
            column: 30
          }
        },
        loc: {
          start: {
            line: 47,
            column: 62
          },
          end: {
            line: 53,
            column: 1
          }
        },
        line: 47
      },
      "4": {
        name: "installGlobalWriteLock",
        decl: {
          start: {
            line: 60,
            column: 16
          },
          end: {
            line: 60,
            column: 38
          }
        },
        loc: {
          start: {
            line: 60,
            column: 47
          },
          end: {
            line: 63,
            column: 1
          }
        },
        line: 60
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 29,
            column: 2
          },
          end: {
            line: 31,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 29,
            column: 2
          },
          end: {
            line: 31,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 29
      },
      "1": {
        loc: {
          start: {
            line: 48,
            column: 2
          },
          end: {
            line: 50,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 48,
            column: 2
          },
          end: {
            line: 50,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 48
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0]
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "4cadf4fd1b7567e86d7b4c01ace33596a1cd1913"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_j4jwfo2m9 = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_j4jwfo2m9();
/**
 * Global Write Lock - Simplified streaming-safe output coordination
 *
 * This module provides a simple mechanism to ensure streaming content
 * is not interrupted by other UI components during streaming.
 *
 * Design Principle:
 * - During streaming, ONLY streaming content writes to stdout
 * - All other UI components (status, input area, etc.) wait until streaming ends
 * - No complex lock nesting or queuing - just a simple boolean flag
 *
 * This prevents the garbled output and cutoffs that occur when multiple
 * components try to write simultaneously with cursor positioning.
 */

let streamingActive =
/* istanbul ignore next */
(cov_j4jwfo2m9().s[0]++, false);

/**
 * Check if streaming mode is currently active
 */
export function isStreamingMode() {
  /* istanbul ignore next */
  cov_j4jwfo2m9().f[0]++;
  cov_j4jwfo2m9().s[1]++;
  return streamingActive;
}

/**
 * Enter streaming mode - blocks all non-streaming output
 */
export function enterStreamingMode() {
  /* istanbul ignore next */
  cov_j4jwfo2m9().f[1]++;
  cov_j4jwfo2m9().s[2]++;
  if (streamingActive) {
    /* istanbul ignore next */
    cov_j4jwfo2m9().b[0][0]++;
    cov_j4jwfo2m9().s[3]++;
    console.warn('[StreamingMode] enterStreamingMode() called while already in streaming mode');
  } else
  /* istanbul ignore next */
  {
    cov_j4jwfo2m9().b[0][1]++;
  }
  cov_j4jwfo2m9().s[4]++;
  streamingActive = true;
}

/**
 * Exit streaming mode - allows normal UI output to resume
 */
export function exitStreamingMode() {
  /* istanbul ignore next */
  cov_j4jwfo2m9().f[2]++;
  cov_j4jwfo2m9().s[5]++;
  // Be tolerant of double-exit; just clear the flag.
  streamingActive = false;
}

/**
 * Execute a callback only if not in streaming mode.
 * Returns true if the callback was executed, false if skipped.
 */
export function ifNotStreaming(callback) {
  /* istanbul ignore next */
  cov_j4jwfo2m9().f[3]++;
  cov_j4jwfo2m9().s[6]++;
  if (streamingActive) {
    /* istanbul ignore next */
    cov_j4jwfo2m9().b[1][0]++;
    cov_j4jwfo2m9().s[7]++;
    return false;
  } else
  /* istanbul ignore next */
  {
    cov_j4jwfo2m9().b[1][1]++;
  }
  cov_j4jwfo2m9().s[8]++;
  callback();
  /* istanbul ignore next */
  cov_j4jwfo2m9().s[9]++;
  return true;
}

/**
 * Legacy: installGlobalWriteLock is now a no-op
 * The old approach of wrapping stdout.write caused nested lock issues.
 * We now use a simpler streaming mode flag instead.
 */
export function installGlobalWriteLock() {
  /* istanbul ignore next */
  cov_j4jwfo2m9().f[4]++;
} // No-op - we no longer wrap stdout.write
// The streaming mode flag handles coordination instead
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfajRqd2ZvMm05IiwiYWN0dWFsQ292ZXJhZ2UiLCJzdHJlYW1pbmdBY3RpdmUiLCJzIiwiaXNTdHJlYW1pbmdNb2RlIiwiZiIsImVudGVyU3RyZWFtaW5nTW9kZSIsImIiLCJjb25zb2xlIiwid2FybiIsImV4aXRTdHJlYW1pbmdNb2RlIiwiaWZOb3RTdHJlYW1pbmciLCJjYWxsYmFjayIsImluc3RhbGxHbG9iYWxXcml0ZUxvY2siXSwic291cmNlcyI6WyJnbG9iYWxXcml0ZUxvY2sudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBHbG9iYWwgV3JpdGUgTG9jayAtIFNpbXBsaWZpZWQgc3RyZWFtaW5nLXNhZmUgb3V0cHV0IGNvb3JkaW5hdGlvblxuICpcbiAqIFRoaXMgbW9kdWxlIHByb3ZpZGVzIGEgc2ltcGxlIG1lY2hhbmlzbSB0byBlbnN1cmUgc3RyZWFtaW5nIGNvbnRlbnRcbiAqIGlzIG5vdCBpbnRlcnJ1cHRlZCBieSBvdGhlciBVSSBjb21wb25lbnRzIGR1cmluZyBzdHJlYW1pbmcuXG4gKlxuICogRGVzaWduIFByaW5jaXBsZTpcbiAqIC0gRHVyaW5nIHN0cmVhbWluZywgT05MWSBzdHJlYW1pbmcgY29udGVudCB3cml0ZXMgdG8gc3Rkb3V0XG4gKiAtIEFsbCBvdGhlciBVSSBjb21wb25lbnRzIChzdGF0dXMsIGlucHV0IGFyZWEsIGV0Yy4pIHdhaXQgdW50aWwgc3RyZWFtaW5nIGVuZHNcbiAqIC0gTm8gY29tcGxleCBsb2NrIG5lc3Rpbmcgb3IgcXVldWluZyAtIGp1c3QgYSBzaW1wbGUgYm9vbGVhbiBmbGFnXG4gKlxuICogVGhpcyBwcmV2ZW50cyB0aGUgZ2FyYmxlZCBvdXRwdXQgYW5kIGN1dG9mZnMgdGhhdCBvY2N1ciB3aGVuIG11bHRpcGxlXG4gKiBjb21wb25lbnRzIHRyeSB0byB3cml0ZSBzaW11bHRhbmVvdXNseSB3aXRoIGN1cnNvciBwb3NpdGlvbmluZy5cbiAqL1xuXG5sZXQgc3RyZWFtaW5nQWN0aXZlID0gZmFsc2U7XG5cbi8qKlxuICogQ2hlY2sgaWYgc3RyZWFtaW5nIG1vZGUgaXMgY3VycmVudGx5IGFjdGl2ZVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNTdHJlYW1pbmdNb2RlKCk6IGJvb2xlYW4ge1xuICByZXR1cm4gc3RyZWFtaW5nQWN0aXZlO1xufVxuXG4vKipcbiAqIEVudGVyIHN0cmVhbWluZyBtb2RlIC0gYmxvY2tzIGFsbCBub24tc3RyZWFtaW5nIG91dHB1dFxuICovXG5leHBvcnQgZnVuY3Rpb24gZW50ZXJTdHJlYW1pbmdNb2RlKCk6IHZvaWQge1xuICBpZiAoc3RyZWFtaW5nQWN0aXZlKSB7XG4gICAgY29uc29sZS53YXJuKCdbU3RyZWFtaW5nTW9kZV0gZW50ZXJTdHJlYW1pbmdNb2RlKCkgY2FsbGVkIHdoaWxlIGFscmVhZHkgaW4gc3RyZWFtaW5nIG1vZGUnKTtcbiAgfVxuICBzdHJlYW1pbmdBY3RpdmUgPSB0cnVlO1xufVxuXG4vKipcbiAqIEV4aXQgc3RyZWFtaW5nIG1vZGUgLSBhbGxvd3Mgbm9ybWFsIFVJIG91dHB1dCB0byByZXN1bWVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGV4aXRTdHJlYW1pbmdNb2RlKCk6IHZvaWQge1xuICAvLyBCZSB0b2xlcmFudCBvZiBkb3VibGUtZXhpdDsganVzdCBjbGVhciB0aGUgZmxhZy5cbiAgc3RyZWFtaW5nQWN0aXZlID0gZmFsc2U7XG59XG5cbi8qKlxuICogRXhlY3V0ZSBhIGNhbGxiYWNrIG9ubHkgaWYgbm90IGluIHN0cmVhbWluZyBtb2RlLlxuICogUmV0dXJucyB0cnVlIGlmIHRoZSBjYWxsYmFjayB3YXMgZXhlY3V0ZWQsIGZhbHNlIGlmIHNraXBwZWQuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpZk5vdFN0cmVhbWluZyhjYWxsYmFjazogKCkgPT4gdm9pZCk6IGJvb2xlYW4ge1xuICBpZiAoc3RyZWFtaW5nQWN0aXZlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGNhbGxiYWNrKCk7XG4gIHJldHVybiB0cnVlO1xufVxuXG4vKipcbiAqIExlZ2FjeTogaW5zdGFsbEdsb2JhbFdyaXRlTG9jayBpcyBub3cgYSBuby1vcFxuICogVGhlIG9sZCBhcHByb2FjaCBvZiB3cmFwcGluZyBzdGRvdXQud3JpdGUgY2F1c2VkIG5lc3RlZCBsb2NrIGlzc3Vlcy5cbiAqIFdlIG5vdyB1c2UgYSBzaW1wbGVyIHN0cmVhbWluZyBtb2RlIGZsYWcgaW5zdGVhZC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluc3RhbGxHbG9iYWxXcml0ZUxvY2soKTogdm9pZCB7XG4gIC8vIE5vLW9wIC0gd2Ugbm8gbG9uZ2VyIHdyYXAgc3Rkb3V0LndyaXRlXG4gIC8vIFRoZSBzdHJlYW1pbmcgbW9kZSBmbGFnIGhhbmRsZXMgY29vcmRpbmF0aW9uIGluc3RlYWRcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUFlWTtJQUFBQSxhQUFBLFlBQUFBLENBQUE7TUFBQSxPQUFBQyxjQUFBO0lBQUE7RUFBQTtFQUFBLE9BQUFBLGNBQUE7QUFBQTtBQUFBRCxhQUFBO0FBZlo7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxJQUFJRSxlQUFlO0FBQUE7QUFBQSxDQUFBRixhQUFBLEdBQUFHLENBQUEsT0FBRyxLQUFLOztBQUUzQjtBQUNBO0FBQ0E7QUFDQSxPQUFPLFNBQVNDLGVBQWVBLENBQUEsRUFBWTtFQUFBO0VBQUFKLGFBQUEsR0FBQUssQ0FBQTtFQUFBTCxhQUFBLEdBQUFHLENBQUE7RUFDekMsT0FBT0QsZUFBZTtBQUN4Qjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxPQUFPLFNBQVNJLGtCQUFrQkEsQ0FBQSxFQUFTO0VBQUE7RUFBQU4sYUFBQSxHQUFBSyxDQUFBO0VBQUFMLGFBQUEsR0FBQUcsQ0FBQTtFQUN6QyxJQUFJRCxlQUFlLEVBQUU7SUFBQTtJQUFBRixhQUFBLEdBQUFPLENBQUE7SUFBQVAsYUFBQSxHQUFBRyxDQUFBO0lBQ25CSyxPQUFPLENBQUNDLElBQUksQ0FBQyw2RUFBNkUsQ0FBQztFQUM3RixDQUFDO0VBQUE7RUFBQTtJQUFBVCxhQUFBLEdBQUFPLENBQUE7RUFBQTtFQUFBUCxhQUFBLEdBQUFHLENBQUE7RUFDREQsZUFBZSxHQUFHLElBQUk7QUFDeEI7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsT0FBTyxTQUFTUSxpQkFBaUJBLENBQUEsRUFBUztFQUFBO0VBQUFWLGFBQUEsR0FBQUssQ0FBQTtFQUFBTCxhQUFBLEdBQUFHLENBQUE7RUFDeEM7RUFDQUQsZUFBZSxHQUFHLEtBQUs7QUFDekI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPLFNBQVNTLGNBQWNBLENBQUNDLFFBQW9CLEVBQVc7RUFBQTtFQUFBWixhQUFBLEdBQUFLLENBQUE7RUFBQUwsYUFBQSxHQUFBRyxDQUFBO0VBQzVELElBQUlELGVBQWUsRUFBRTtJQUFBO0lBQUFGLGFBQUEsR0FBQU8sQ0FBQTtJQUFBUCxhQUFBLEdBQUFHLENBQUE7SUFDbkIsT0FBTyxLQUFLO0VBQ2QsQ0FBQztFQUFBO0VBQUE7SUFBQUgsYUFBQSxHQUFBTyxDQUFBO0VBQUE7RUFBQVAsYUFBQSxHQUFBRyxDQUFBO0VBQ0RTLFFBQVEsQ0FBQyxDQUFDO0VBQUM7RUFBQVosYUFBQSxHQUFBRyxDQUFBO0VBQ1gsT0FBTyxJQUFJO0FBQ2I7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sU0FBU1Usc0JBQXNCQSxDQUFBLEVBQVM7RUFBQTtFQUFBYixhQUFBLEdBQUFLLENBQUE7QUFHL0MsQ0FBQyxDQUZDO0FBQ0EiLCJpZ25vcmVMaXN0IjpbXX0=