{"version":3,"names":["nowSeconds","ms","seconds","Math","round","renderDiff","diff","additions","removals","lines","rendered","map","line","prefix","type","content","join","pickTool","prompt","lower","toLowerCase","globKeywords","some","kw","includes","createMetaTools","_workingDir","tools","name","description","handler","request","tasks","task","idx","args","base","toolName","status","durationMs","push","steps","step","id","dependsOn","length","dryRun","tool","payload","JSON","stringify"],"sources":["metaTools.ts"],"sourcesContent":["import type { ToolDefinition } from '../core/toolRuntime.js';\n\ninterface ToolArgs extends Record<string, unknown> {\n  request?: string;\n  prompt?: string;\n  toolName?: string;\n  args?: Record<string, unknown>;\n  status?: string;\n  result?: string;\n  durationMs?: number;\n  diff?: {\n    additions?: number;\n    removals?: number;\n    lines?: Array<{ type: 'add' | 'remove' | 'context'; content: string; lineNumber?: number }>;\n  };\n  name?: string;\n  steps?: Array<{ id: string; name: string; tool?: string; args?: Record<string, unknown>; dependsOn?: string[] }>;\n  mode?: string;\n  tools?: Array<{ tool: string; args?: Record<string, unknown>; description?: string }>;\n  dryRun?: boolean;\n}\n\nfunction nowSeconds(ms?: number): string {\n  if (!ms || ms < 1000) return '1s';\n  const seconds = Math.round(ms / 1000);\n  return `${seconds}s`;\n}\n\nfunction renderDiff(diff: NonNullable<ToolArgs['diff']>): string {\n  const additions = diff.additions ?? 0;\n  const removals = diff.removals ?? 0;\n  const lines = diff.lines ?? [];\n  const rendered = lines\n    .map((line) => {\n      const prefix = line.type === 'add' ? '+' : line.type === 'remove' ? '-' : ' ';\n      return `${prefix}  ${line.content}`;\n    })\n    .join('\\n');\n  return `+${additions} -${removals}\\n${rendered}`;\n}\n\nfunction pickTool(prompt: string): string {\n  const lower = prompt.toLowerCase();\n  const globKeywords = ['devops', 'education', 'ecommerce', 'hr ', 'real estate', 'travel', 'kanban', 'crm', 'messaging', 'booking'];\n  if (globKeywords.some((kw) => lower.includes(kw))) {\n    return 'Glob';\n  }\n  return 'Bash';\n}\n\nexport function createMetaTools(_workingDir: string): ToolDefinition[] {\n  const tools: ToolDefinition<ToolArgs>[] = [\n    {\n      name: 'CheckFeasibility',\n      description: 'Assess feasibility of a request.',\n      handler: async ({ request }) => {\n        return [\n          'Feasibility Analysis',\n          `Request: ${request ?? ''}`,\n          `Feasible:** Yes`,\n          'Factors: timeline, scope, dependencies',\n        ].join('\\n');\n      },\n    },\n    {\n      name: 'DecomposeTask',\n      description: 'Break a request into sub-tasks.',\n      handler: async ({ request }) => {\n        const tasks = ['research', 'plan', 'implement', 'test', 'deliver'].map((task, idx) => `[task-${idx + 1}] ${task} ${request ?? ''}`);\n        return ['Task Decomposition', ...tasks].join('\\n');\n      },\n    },\n    {\n      name: 'AnalyzeAmbiguity',\n      description: 'Identify unclear parts of a prompt.',\n      handler: async ({ prompt }) => `Ambiguity Analysis\\nPrompt: ${prompt ?? ''}\\nClarifications: none`,\n    },\n    {\n      name: 'SuggestApproach',\n      description: 'Suggest an execution approach.',\n      handler: async ({ prompt }) => `Approach\\nPrompt: ${prompt ?? ''}\\nPlan: iterate, validate, deliver`,\n    },\n    {\n      name: 'ThinkingProcess',\n      description: 'Outline a thinking process.',\n      handler: async () => 'Thinking\\nInterpretation\\nExecution Plan\\nReady for Execution',\n    },\n    {\n      name: 'ExecuteWorkflow',\n      description: 'Represent a workflow execution.',\n      handler: async ({ name }) => `Workflow Execution\\nName: ${name ?? 'Workflow'}\\nReady`,\n    },\n    {\n      name: 'RecordEvidence',\n      description: 'Record execution evidence.',\n      handler: async () => 'Evidence\\nCaptured logs and diffs',\n    },\n    {\n      name: 'ToolExecutionDisplay',\n      description: 'Format tool execution display.',\n      handler: async (args) => {\n        const base = [\n          `⏺ ${args.toolName ?? 'Tool'}`,\n          '⎿',\n          `Status: ${args.status ?? 'completed'}`,\n          `Duration: ${nowSeconds(args.durationMs ?? 1000)}`,\n        ];\n        if (args.diff) {\n          base.push(renderDiff(args.diff));\n        }\n        return base.join('\\n');\n      },\n    },\n    {\n      name: 'WorkflowOrchestrator',\n      description: 'Plan workflow execution.',\n      handler: async ({ name, steps }) => {\n        const lines: string[] = [];\n        lines.push(`Workflow: ${name ?? 'workflow'}`);\n        for (const step of steps ?? []) {\n          lines.push(`[${step.id}] ${step.name}`);\n          if (step.dependsOn?.length) {\n            lines.push(`after: ${step.dependsOn.join(', ')}`);\n          }\n        }\n        return lines.join('\\n');\n      },\n    },\n    {\n      name: 'OperationStatus',\n      description: 'Summarize operation status.',\n      handler: async () => 'Operation Status: active',\n    },\n    {\n      name: 'UnifiedPromptHandler',\n      description: 'Generate unified handling for prompts.',\n      handler: async ({ prompt }) =>\n        ['Thinking', `Interpretation: ${prompt ?? ''}`, 'Execution Plan: steps outlined', 'Ready for Execution'].join('\\n'),\n    },\n    {\n      name: 'RealToolChain',\n      description: 'Describe a tool chain.',\n      handler: async ({ name, tools = [], dryRun }) => {\n        const lines = [`Tool Chain: ${name ?? 'Tool Chain'}`];\n        if (dryRun) lines.push('DRY RUN');\n        for (const tool of tools) {\n          lines.push(`⏺ ${tool.tool}`);\n          if (tool.description) {\n            lines.push(tool.description);\n          }\n        }\n        return lines.join('\\n');\n      },\n    },\n    {\n      name: 'GenerateToolCalls',\n      description: 'Generate tool calls for a prompt.',\n      handler: async ({ prompt = '' }) => {\n        const tool = pickTool(prompt);\n        const payload = { tool, args: { prompt } };\n        return [\n          'Generated Tool Calls',\n          `Primary: ${tool}`,\n          '```json',\n          JSON.stringify(payload, null, 2),\n          '```',\n        ].join('\\n');\n      },\n    },\n  ];\n\n  return tools;\n}\n"],"mappings":"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","ignoreList":[]}