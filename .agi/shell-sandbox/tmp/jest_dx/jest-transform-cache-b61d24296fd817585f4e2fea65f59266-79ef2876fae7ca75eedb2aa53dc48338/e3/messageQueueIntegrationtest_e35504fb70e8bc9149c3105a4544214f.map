{"version":3,"names":["_globals","require","describe","test","pendingMessages","isStreaming","writeLocked","content","payload","endsWith","push","timestamp","Date","now","expect","toHaveLength","toBe","flushedMessages","length","msg","shift","toEqual","allMessages","i","filter","m","includes","t1","t2","t3","toBeGreaterThan","delay1","delay2","toBeGreaterThanOrEqual","messages","addMessage","forEach","maxMessages","toBeLessThanOrEqual","successfullyFlushed","errors","Error","error","flushed","streamingActive","rendererMode","stopStreamingHeartbeat","resetRendererStreamingMode","isProcessing","streamingStuck","warnings","enterStreamingMode","toContain","exitStreamingMode"],"sources":["messageQueueIntegration.test.ts"],"sourcesContent":["/**\n * Message Queue Integration Tests\n * Tests the critical race condition fix in streaming mode\n */\n\nimport { describe, test, expect, jest } from '@jest/globals';\n\ndescribe('Message Queue Integration', () => {\n  test('Messages queue during streaming mode', () => {\n    // Simulate the message queue behavior\n    const pendingMessages: Array<{content: string; timestamp: number}> = [];\n    let isStreaming = true;\n\n    // Simulate writeLocked behavior\n    function writeLocked(content: string): void {\n      const payload = content.endsWith('\\n') ? content : `${content}\\n`;\n\n      if (isStreaming) {\n        pendingMessages.push({\n          content: payload,\n          timestamp: Date.now()\n        });\n      }\n    }\n\n    // Queue messages while streaming\n    writeLocked('Message 1');\n    writeLocked('Message 2');\n    writeLocked('Message 3');\n\n    expect(pendingMessages).toHaveLength(3);\n    expect(pendingMessages[0]?.content).toBe('Message 1\\n');\n    expect(pendingMessages[1]?.content).toBe('Message 2\\n');\n    expect(pendingMessages[2]?.content).toBe('Message 3\\n');\n  });\n\n  test('Messages flush in FIFO order', () => {\n    const pendingMessages: Array<{content: string; timestamp: number}> = [];\n    const flushedMessages: string[] = [];\n\n    // Queue messages\n    pendingMessages.push({ content: 'First\\n', timestamp: Date.now() });\n    pendingMessages.push({ content: 'Second\\n', timestamp: Date.now() + 1 });\n    pendingMessages.push({ content: 'Third\\n', timestamp: Date.now() + 2 });\n\n    // Flush in order\n    while (pendingMessages.length > 0) {\n      const msg = pendingMessages.shift();\n      if (msg) {\n        flushedMessages.push(msg.content);\n      }\n    }\n\n    expect(flushedMessages).toEqual(['First\\n', 'Second\\n', 'Third\\n']);\n  });\n\n  test('No messages lost on rapid streaming toggle', () => {\n    const pendingMessages: Array<{content: string; timestamp: number}> = [];\n    const allMessages: string[] = [];\n    let isStreaming = false;\n\n    function writeLocked(content: string): void {\n      const payload = content.endsWith('\\n') ? content : `${content}\\n`;\n\n      if (isStreaming) {\n        pendingMessages.push({ content: payload, timestamp: Date.now() });\n      } else {\n        // Flush pending first\n        while (pendingMessages.length > 0) {\n          const msg = pendingMessages.shift();\n          if (msg) allMessages.push(msg.content);\n        }\n        allMessages.push(payload);\n      }\n    }\n\n    // Rapid streaming mode changes\n    for (let i = 0; i < 10; i++) {\n      isStreaming = true;\n      writeLocked(`Streaming ${i}`);\n\n      isStreaming = false;\n      writeLocked(`Normal ${i}`);\n    }\n\n    expect(allMessages).toHaveLength(20);\n    expect(allMessages.filter(m => m.includes('Streaming'))).toHaveLength(10);\n    expect(allMessages.filter(m => m.includes('Normal'))).toHaveLength(10);\n  });\n\n  test('Timestamps allow debugging of message delays', () => {\n    const pendingMessages: Array<{content: string; timestamp: number}> = [];\n\n    const t1 = Date.now();\n    pendingMessages.push({ content: 'Msg 1', timestamp: t1 });\n\n    const t2 = Date.now() + 100;\n    pendingMessages.push({ content: 'Msg 2', timestamp: t2 });\n\n    const t3 = Date.now() + 200;\n    pendingMessages.push({ content: 'Msg 3', timestamp: t3 });\n\n    // Verify timestamps are increasing\n    expect(pendingMessages[1]!.timestamp).toBeGreaterThan(pendingMessages[0]!.timestamp);\n    expect(pendingMessages[2]!.timestamp).toBeGreaterThan(pendingMessages[1]!.timestamp);\n\n    // Calculate delays\n    const delay1 = pendingMessages[1]!.timestamp - pendingMessages[0]!.timestamp;\n    const delay2 = pendingMessages[2]!.timestamp - pendingMessages[1]!.timestamp;\n\n    expect(delay1).toBeGreaterThanOrEqual(100);\n    expect(delay2).toBeGreaterThanOrEqual(100);\n  });\n\n  test('Empty messages are handled correctly', () => {\n    const pendingMessages: Array<{content: string; timestamp: number}> = [];\n    let isStreaming = true;\n\n    function writeLocked(content: string): void {\n      if (!content) return; // Guard against empty content\n\n      const payload = content.endsWith('\\n') ? content : `${content}\\n`;\n\n      if (isStreaming) {\n        pendingMessages.push({ content: payload, timestamp: Date.now() });\n      }\n    }\n\n    writeLocked('');\n    writeLocked('Valid message');\n    writeLocked('');\n\n    expect(pendingMessages).toHaveLength(1);\n    expect(pendingMessages[0]?.content).toBe('Valid message\\n');\n  });\n\n  test('Newline handling is consistent', () => {\n    const messages: string[] = [];\n\n    function addMessage(content: string): void {\n      const payload = content.endsWith('\\n') ? content : `${content}\\n`;\n      messages.push(payload);\n    }\n\n    addMessage('Already has newline\\n');\n    addMessage('Needs newline');\n    addMessage('Multiple\\nlines\\nhere');\n\n    expect(messages[0]).toBe('Already has newline\\n');\n    expect(messages[1]).toBe('Needs newline\\n');\n    expect(messages[2]).toBe('Multiple\\nlines\\nhere\\n');\n\n    // All messages should end with exactly one newline\n    messages.forEach(msg => {\n      expect(msg.endsWith('\\n')).toBe(true);\n      expect(msg.endsWith('\\n\\n')).toBe(false);\n    });\n  });\n\n  test('Message queue has bounded growth', () => {\n    const maxMessages = /* TODO: Extract constant */ 1000;\n    const pendingMessages: Array<{content: string; timestamp: number}> = [];\n\n    // Simulate rapid message generation\n    for (let i = 0; i < maxMessages * 2; i++) {\n      pendingMessages.push({ content: `Message ${i}`, timestamp: Date.now() });\n\n      // Simulate periodic flushing to prevent unbounded growth\n      if (pendingMessages.length > maxMessages) {\n        pendingMessages.shift(); // Remove oldest\n      }\n    }\n\n    // Queue should not exceed max size\n    expect(pendingMessages.length).toBeLessThanOrEqual(maxMessages);\n  });\n\n  test('Error during flush does not lose remaining messages', () => {\n    const pendingMessages: Array<{content: string; timestamp: number}> = [];\n    const successfullyFlushed: string[] = [];\n    const errors: string[] = [];\n\n    pendingMessages.push({ content: 'Message 1', timestamp: Date.now() });\n    pendingMessages.push({ content: 'BAD_MESSAGE', timestamp: Date.now() });\n    pendingMessages.push({ content: 'Message 3', timestamp: Date.now() });\n\n    // Flush with error handling\n    while (pendingMessages.length > 0) {\n      const msg = pendingMessages.shift();\n      if (msg) {\n        try {\n          if (msg.content === 'BAD_MESSAGE') {\n            throw new Error('Simulated flush error');\n          }\n          successfullyFlushed.push(msg.content);\n        } catch (error) {\n          errors.push(msg.content);\n          // Continue flushing despite error\n        }\n      }\n    }\n\n    expect(successfullyFlushed).toEqual(['Message 1', 'Message 3']);\n    expect(errors).toEqual(['BAD_MESSAGE']);\n    expect(pendingMessages).toHaveLength(0); // All messages processed\n  });\n\n  test('Stuck streaming state flushes pending messages on reset', () => {\n    const pendingMessages: string[] = ['first\\n', 'second\\n'];\n    const flushed: string[] = [];\n    let streamingActive = true;\n    let rendererMode: 'idle' | 'streaming' = 'streaming';\n\n    // Simulate the stopStreamingHeartbeat logic used by resetRendererStreamingMode\n    function stopStreamingHeartbeat(): void {\n      streamingActive = false;\n      while (pendingMessages.length > 0) {\n        const msg = pendingMessages.shift();\n        if (msg) flushed.push(msg);\n      }\n    }\n\n    function resetRendererStreamingMode(isProcessing: boolean): void {\n      if (isProcessing) return;\n      const streamingStuck = rendererMode === 'streaming' || streamingActive;\n      if (!streamingStuck) return;\n\n      stopStreamingHeartbeat();\n      rendererMode = 'idle';\n    }\n\n    resetRendererStreamingMode(false);\n\n    expect(streamingActive).toBe(false);\n    expect(rendererMode).toBe('idle');\n    expect(flushed).toEqual(['first\\n', 'second\\n']);\n    expect(pendingMessages).toHaveLength(0);\n  });\n});\n\ndescribe('Streaming Mode State Transitions', () => {\n  test('Detects double-entry to streaming mode', () => {\n    const warnings: string[] = [];\n    let streamingActive = false;\n\n    function enterStreamingMode(): void {\n      if (streamingActive) {\n        warnings.push('enterStreamingMode() called while already in streaming mode');\n      }\n      streamingActive = true;\n    }\n\n    enterStreamingMode();\n    enterStreamingMode(); // Should warn\n\n    expect(warnings).toHaveLength(1);\n    expect(warnings[0]).toContain('already in streaming mode');\n  });\n\n  test('Detects exit when not in streaming mode', () => {\n    const warnings: string[] = [];\n    let streamingActive = false;\n\n    function exitStreamingMode(): void {\n      if (!streamingActive) {\n        warnings.push('exitStreamingMode() called while not in streaming mode');\n      }\n      streamingActive = false;\n    }\n\n    exitStreamingMode(); // Should warn\n\n    expect(warnings).toHaveLength(1);\n    expect(warnings[0]).toContain('not in streaming mode');\n  });\n\n  test('Clean state transitions work correctly', () => {\n    const warnings: string[] = [];\n    let streamingActive = false;\n\n    function enterStreamingMode(): void {\n      if (streamingActive) {\n        warnings.push('enterStreamingMode() called while already in streaming mode');\n      }\n      streamingActive = true;\n    }\n\n    function exitStreamingMode(): void {\n      if (!streamingActive) {\n        warnings.push('exitStreamingMode() called while not in streaming mode');\n      }\n      streamingActive = false;\n    }\n\n    // Proper sequence\n    enterStreamingMode();\n    expect(streamingActive).toBe(true);\n\n    exitStreamingMode();\n    expect(streamingActive).toBe(false);\n\n    enterStreamingMode();\n    expect(streamingActive).toBe(true);\n\n    exitStreamingMode();\n    expect(streamingActive).toBe(false);\n\n    expect(warnings).toHaveLength(0);\n  });\n});\n"],"mappings":";;AAKA,IAAAA,QAAA,GAAAC,OAAA;AALA;AACA;AACA;AACA;;AAIA,IAAAC,iBAAQ,EAAC,2BAA2B,EAAE,MAAM;EAC1C,IAAAC,aAAI,EAAC,sCAAsC,EAAE,MAAM;IACjD;IACA,MAAMC,eAA4D,GAAG,EAAE;IACvE,IAAIC,WAAW,GAAG,IAAI;;IAEtB;IACA,SAASC,WAAWA,CAACC,OAAe,EAAQ;MAC1C,MAAMC,OAAO,GAAGD,OAAO,CAACE,QAAQ,CAAC,IAAI,CAAC,GAAGF,OAAO,GAAG,GAAGA,OAAO,IAAI;MAEjE,IAAIF,WAAW,EAAE;QACfD,eAAe,CAACM,IAAI,CAAC;UACnBH,OAAO,EAAEC,OAAO;UAChBG,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC;QACtB,CAAC,CAAC;MACJ;IACF;;IAEA;IACAP,WAAW,CAAC,WAAW,CAAC;IACxBA,WAAW,CAAC,WAAW,CAAC;IACxBA,WAAW,CAAC,WAAW,CAAC;IAExB,IAAAQ,eAAM,EAACV,eAAe,CAAC,CAACW,YAAY,CAAC,CAAC,CAAC;IACvC,IAAAD,eAAM,EAACV,eAAe,CAAC,CAAC,CAAC,EAAEG,OAAO,CAAC,CAACS,IAAI,CAAC,aAAa,CAAC;IACvD,IAAAF,eAAM,EAACV,eAAe,CAAC,CAAC,CAAC,EAAEG,OAAO,CAAC,CAACS,IAAI,CAAC,aAAa,CAAC;IACvD,IAAAF,eAAM,EAACV,eAAe,CAAC,CAAC,CAAC,EAAEG,OAAO,CAAC,CAACS,IAAI,CAAC,aAAa,CAAC;EACzD,CAAC,CAAC;EAEF,IAAAb,aAAI,EAAC,8BAA8B,EAAE,MAAM;IACzC,MAAMC,eAA4D,GAAG,EAAE;IACvE,MAAMa,eAAyB,GAAG,EAAE;;IAEpC;IACAb,eAAe,CAACM,IAAI,CAAC;MAAEH,OAAO,EAAE,SAAS;MAAEI,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC;IAAE,CAAC,CAAC;IACnET,eAAe,CAACM,IAAI,CAAC;MAAEH,OAAO,EAAE,UAAU;MAAEI,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG;IAAE,CAAC,CAAC;IACxET,eAAe,CAACM,IAAI,CAAC;MAAEH,OAAO,EAAE,SAAS;MAAEI,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG;IAAE,CAAC,CAAC;;IAEvE;IACA,OAAOT,eAAe,CAACc,MAAM,GAAG,CAAC,EAAE;MACjC,MAAMC,GAAG,GAAGf,eAAe,CAACgB,KAAK,CAAC,CAAC;MACnC,IAAID,GAAG,EAAE;QACPF,eAAe,CAACP,IAAI,CAACS,GAAG,CAACZ,OAAO,CAAC;MACnC;IACF;IAEA,IAAAO,eAAM,EAACG,eAAe,CAAC,CAACI,OAAO,CAAC,CAAC,SAAS,EAAE,UAAU,EAAE,SAAS,CAAC,CAAC;EACrE,CAAC,CAAC;EAEF,IAAAlB,aAAI,EAAC,4CAA4C,EAAE,MAAM;IACvD,MAAMC,eAA4D,GAAG,EAAE;IACvE,MAAMkB,WAAqB,GAAG,EAAE;IAChC,IAAIjB,WAAW,GAAG,KAAK;IAEvB,SAASC,WAAWA,CAACC,OAAe,EAAQ;MAC1C,MAAMC,OAAO,GAAGD,OAAO,CAACE,QAAQ,CAAC,IAAI,CAAC,GAAGF,OAAO,GAAG,GAAGA,OAAO,IAAI;MAEjE,IAAIF,WAAW,EAAE;QACfD,eAAe,CAACM,IAAI,CAAC;UAAEH,OAAO,EAAEC,OAAO;UAAEG,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC;QAAE,CAAC,CAAC;MACnE,CAAC,MAAM;QACL;QACA,OAAOT,eAAe,CAACc,MAAM,GAAG,CAAC,EAAE;UACjC,MAAMC,GAAG,GAAGf,eAAe,CAACgB,KAAK,CAAC,CAAC;UACnC,IAAID,GAAG,EAAEG,WAAW,CAACZ,IAAI,CAACS,GAAG,CAACZ,OAAO,CAAC;QACxC;QACAe,WAAW,CAACZ,IAAI,CAACF,OAAO,CAAC;MAC3B;IACF;;IAEA;IACA,KAAK,IAAIe,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,EAAE,EAAEA,CAAC,EAAE,EAAE;MAC3BlB,WAAW,GAAG,IAAI;MAClBC,WAAW,CAAC,aAAaiB,CAAC,EAAE,CAAC;MAE7BlB,WAAW,GAAG,KAAK;MACnBC,WAAW,CAAC,UAAUiB,CAAC,EAAE,CAAC;IAC5B;IAEA,IAAAT,eAAM,EAACQ,WAAW,CAAC,CAACP,YAAY,CAAC,EAAE,CAAC;IACpC,IAAAD,eAAM,EAACQ,WAAW,CAACE,MAAM,CAACC,CAAC,IAAIA,CAAC,CAACC,QAAQ,CAAC,WAAW,CAAC,CAAC,CAAC,CAACX,YAAY,CAAC,EAAE,CAAC;IACzE,IAAAD,eAAM,EAACQ,WAAW,CAACE,MAAM,CAACC,CAAC,IAAIA,CAAC,CAACC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAACX,YAAY,CAAC,EAAE,CAAC;EACxE,CAAC,CAAC;EAEF,IAAAZ,aAAI,EAAC,8CAA8C,EAAE,MAAM;IACzD,MAAMC,eAA4D,GAAG,EAAE;IAEvE,MAAMuB,EAAE,GAAGf,IAAI,CAACC,GAAG,CAAC,CAAC;IACrBT,eAAe,CAACM,IAAI,CAAC;MAAEH,OAAO,EAAE,OAAO;MAAEI,SAAS,EAAEgB;IAAG,CAAC,CAAC;IAEzD,MAAMC,EAAE,GAAGhB,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,GAAG;IAC3BT,eAAe,CAACM,IAAI,CAAC;MAAEH,OAAO,EAAE,OAAO;MAAEI,SAAS,EAAEiB;IAAG,CAAC,CAAC;IAEzD,MAAMC,EAAE,GAAGjB,IAAI,CAACC,GAAG,CAAC,CAAC,GAAG,GAAG;IAC3BT,eAAe,CAACM,IAAI,CAAC;MAAEH,OAAO,EAAE,OAAO;MAAEI,SAAS,EAAEkB;IAAG,CAAC,CAAC;;IAEzD;IACA,IAAAf,eAAM,EAACV,eAAe,CAAC,CAAC,CAAC,CAAEO,SAAS,CAAC,CAACmB,eAAe,CAAC1B,eAAe,CAAC,CAAC,CAAC,CAAEO,SAAS,CAAC;IACpF,IAAAG,eAAM,EAACV,eAAe,CAAC,CAAC,CAAC,CAAEO,SAAS,CAAC,CAACmB,eAAe,CAAC1B,eAAe,CAAC,CAAC,CAAC,CAAEO,SAAS,CAAC;;IAEpF;IACA,MAAMoB,MAAM,GAAG3B,eAAe,CAAC,CAAC,CAAC,CAAEO,SAAS,GAAGP,eAAe,CAAC,CAAC,CAAC,CAAEO,SAAS;IAC5E,MAAMqB,MAAM,GAAG5B,eAAe,CAAC,CAAC,CAAC,CAAEO,SAAS,GAAGP,eAAe,CAAC,CAAC,CAAC,CAAEO,SAAS;IAE5E,IAAAG,eAAM,EAACiB,MAAM,CAAC,CAACE,sBAAsB,CAAC,GAAG,CAAC;IAC1C,IAAAnB,eAAM,EAACkB,MAAM,CAAC,CAACC,sBAAsB,CAAC,GAAG,CAAC;EAC5C,CAAC,CAAC;EAEF,IAAA9B,aAAI,EAAC,sCAAsC,EAAE,MAAM;IACjD,MAAMC,eAA4D,GAAG,EAAE;IACvE,IAAIC,WAAW,GAAG,IAAI;IAEtB,SAASC,WAAWA,CAACC,OAAe,EAAQ;MAC1C,IAAI,CAACA,OAAO,EAAE,OAAO,CAAC;;MAEtB,MAAMC,OAAO,GAAGD,OAAO,CAACE,QAAQ,CAAC,IAAI,CAAC,GAAGF,OAAO,GAAG,GAAGA,OAAO,IAAI;MAEjE,IAAIF,WAAW,EAAE;QACfD,eAAe,CAACM,IAAI,CAAC;UAAEH,OAAO,EAAEC,OAAO;UAAEG,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC;QAAE,CAAC,CAAC;MACnE;IACF;IAEAP,WAAW,CAAC,EAAE,CAAC;IACfA,WAAW,CAAC,eAAe,CAAC;IAC5BA,WAAW,CAAC,EAAE,CAAC;IAEf,IAAAQ,eAAM,EAACV,eAAe,CAAC,CAACW,YAAY,CAAC,CAAC,CAAC;IACvC,IAAAD,eAAM,EAACV,eAAe,CAAC,CAAC,CAAC,EAAEG,OAAO,CAAC,CAACS,IAAI,CAAC,iBAAiB,CAAC;EAC7D,CAAC,CAAC;EAEF,IAAAb,aAAI,EAAC,gCAAgC,EAAE,MAAM;IAC3C,MAAM+B,QAAkB,GAAG,EAAE;IAE7B,SAASC,UAAUA,CAAC5B,OAAe,EAAQ;MACzC,MAAMC,OAAO,GAAGD,OAAO,CAACE,QAAQ,CAAC,IAAI,CAAC,GAAGF,OAAO,GAAG,GAAGA,OAAO,IAAI;MACjE2B,QAAQ,CAACxB,IAAI,CAACF,OAAO,CAAC;IACxB;IAEA2B,UAAU,CAAC,uBAAuB,CAAC;IACnCA,UAAU,CAAC,eAAe,CAAC;IAC3BA,UAAU,CAAC,uBAAuB,CAAC;IAEnC,IAAArB,eAAM,EAACoB,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAClB,IAAI,CAAC,uBAAuB,CAAC;IACjD,IAAAF,eAAM,EAACoB,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAClB,IAAI,CAAC,iBAAiB,CAAC;IAC3C,IAAAF,eAAM,EAACoB,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAClB,IAAI,CAAC,yBAAyB,CAAC;;IAEnD;IACAkB,QAAQ,CAACE,OAAO,CAACjB,GAAG,IAAI;MACtB,IAAAL,eAAM,EAACK,GAAG,CAACV,QAAQ,CAAC,IAAI,CAAC,CAAC,CAACO,IAAI,CAAC,IAAI,CAAC;MACrC,IAAAF,eAAM,EAACK,GAAG,CAACV,QAAQ,CAAC,MAAM,CAAC,CAAC,CAACO,IAAI,CAAC,KAAK,CAAC;IAC1C,CAAC,CAAC;EACJ,CAAC,CAAC;EAEF,IAAAb,aAAI,EAAC,kCAAkC,EAAE,MAAM;IAC7C,MAAMkC,WAAW,GAAG,4BAA6B,IAAI;IACrD,MAAMjC,eAA4D,GAAG,EAAE;;IAEvE;IACA,KAAK,IAAImB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGc,WAAW,GAAG,CAAC,EAAEd,CAAC,EAAE,EAAE;MACxCnB,eAAe,CAACM,IAAI,CAAC;QAAEH,OAAO,EAAE,WAAWgB,CAAC,EAAE;QAAEZ,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC;MAAE,CAAC,CAAC;;MAExE;MACA,IAAIT,eAAe,CAACc,MAAM,GAAGmB,WAAW,EAAE;QACxCjC,eAAe,CAACgB,KAAK,CAAC,CAAC,CAAC,CAAC;MAC3B;IACF;;IAEA;IACA,IAAAN,eAAM,EAACV,eAAe,CAACc,MAAM,CAAC,CAACoB,mBAAmB,CAACD,WAAW,CAAC;EACjE,CAAC,CAAC;EAEF,IAAAlC,aAAI,EAAC,qDAAqD,EAAE,MAAM;IAChE,MAAMC,eAA4D,GAAG,EAAE;IACvE,MAAMmC,mBAA6B,GAAG,EAAE;IACxC,MAAMC,MAAgB,GAAG,EAAE;IAE3BpC,eAAe,CAACM,IAAI,CAAC;MAAEH,OAAO,EAAE,WAAW;MAAEI,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC;IAAE,CAAC,CAAC;IACrET,eAAe,CAACM,IAAI,CAAC;MAAEH,OAAO,EAAE,aAAa;MAAEI,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC;IAAE,CAAC,CAAC;IACvET,eAAe,CAACM,IAAI,CAAC;MAAEH,OAAO,EAAE,WAAW;MAAEI,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC;IAAE,CAAC,CAAC;;IAErE;IACA,OAAOT,eAAe,CAACc,MAAM,GAAG,CAAC,EAAE;MACjC,MAAMC,GAAG,GAAGf,eAAe,CAACgB,KAAK,CAAC,CAAC;MACnC,IAAID,GAAG,EAAE;QACP,IAAI;UACF,IAAIA,GAAG,CAACZ,OAAO,KAAK,aAAa,EAAE;YACjC,MAAM,IAAIkC,KAAK,CAAC,uBAAuB,CAAC;UAC1C;UACAF,mBAAmB,CAAC7B,IAAI,CAACS,GAAG,CAACZ,OAAO,CAAC;QACvC,CAAC,CAAC,OAAOmC,KAAK,EAAE;UACdF,MAAM,CAAC9B,IAAI,CAACS,GAAG,CAACZ,OAAO,CAAC;UACxB;QACF;MACF;IACF;IAEA,IAAAO,eAAM,EAACyB,mBAAmB,CAAC,CAAClB,OAAO,CAAC,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC;IAC/D,IAAAP,eAAM,EAAC0B,MAAM,CAAC,CAACnB,OAAO,CAAC,CAAC,aAAa,CAAC,CAAC;IACvC,IAAAP,eAAM,EAACV,eAAe,CAAC,CAACW,YAAY,CAAC,CAAC,CAAC,CAAC,CAAC;EAC3C,CAAC,CAAC;EAEF,IAAAZ,aAAI,EAAC,yDAAyD,EAAE,MAAM;IACpE,MAAMC,eAAyB,GAAG,CAAC,SAAS,EAAE,UAAU,CAAC;IACzD,MAAMuC,OAAiB,GAAG,EAAE;IAC5B,IAAIC,eAAe,GAAG,IAAI;IAC1B,IAAIC,YAAkC,GAAG,WAAW;;IAEpD;IACA,SAASC,sBAAsBA,CAAA,EAAS;MACtCF,eAAe,GAAG,KAAK;MACvB,OAAOxC,eAAe,CAACc,MAAM,GAAG,CAAC,EAAE;QACjC,MAAMC,GAAG,GAAGf,eAAe,CAACgB,KAAK,CAAC,CAAC;QACnC,IAAID,GAAG,EAAEwB,OAAO,CAACjC,IAAI,CAACS,GAAG,CAAC;MAC5B;IACF;IAEA,SAAS4B,0BAA0BA,CAACC,YAAqB,EAAQ;MAC/D,IAAIA,YAAY,EAAE;MAClB,MAAMC,cAAc,GAAGJ,YAAY,KAAK,WAAW,IAAID,eAAe;MACtE,IAAI,CAACK,cAAc,EAAE;MAErBH,sBAAsB,CAAC,CAAC;MACxBD,YAAY,GAAG,MAAM;IACvB;IAEAE,0BAA0B,CAAC,KAAK,CAAC;IAEjC,IAAAjC,eAAM,EAAC8B,eAAe,CAAC,CAAC5B,IAAI,CAAC,KAAK,CAAC;IACnC,IAAAF,eAAM,EAAC+B,YAAY,CAAC,CAAC7B,IAAI,CAAC,MAAM,CAAC;IACjC,IAAAF,eAAM,EAAC6B,OAAO,CAAC,CAACtB,OAAO,CAAC,CAAC,SAAS,EAAE,UAAU,CAAC,CAAC;IAChD,IAAAP,eAAM,EAACV,eAAe,CAAC,CAACW,YAAY,CAAC,CAAC,CAAC;EACzC,CAAC,CAAC;AACJ,CAAC,CAAC;AAEF,IAAAb,iBAAQ,EAAC,kCAAkC,EAAE,MAAM;EACjD,IAAAC,aAAI,EAAC,wCAAwC,EAAE,MAAM;IACnD,MAAM+C,QAAkB,GAAG,EAAE;IAC7B,IAAIN,eAAe,GAAG,KAAK;IAE3B,SAASO,kBAAkBA,CAAA,EAAS;MAClC,IAAIP,eAAe,EAAE;QACnBM,QAAQ,CAACxC,IAAI,CAAC,6DAA6D,CAAC;MAC9E;MACAkC,eAAe,GAAG,IAAI;IACxB;IAEAO,kBAAkB,CAAC,CAAC;IACpBA,kBAAkB,CAAC,CAAC,CAAC,CAAC;;IAEtB,IAAArC,eAAM,EAACoC,QAAQ,CAAC,CAACnC,YAAY,CAAC,CAAC,CAAC;IAChC,IAAAD,eAAM,EAACoC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAACE,SAAS,CAAC,2BAA2B,CAAC;EAC5D,CAAC,CAAC;EAEF,IAAAjD,aAAI,EAAC,yCAAyC,EAAE,MAAM;IACpD,MAAM+C,QAAkB,GAAG,EAAE;IAC7B,IAAIN,eAAe,GAAG,KAAK;IAE3B,SAASS,iBAAiBA,CAAA,EAAS;MACjC,IAAI,CAACT,eAAe,EAAE;QACpBM,QAAQ,CAACxC,IAAI,CAAC,wDAAwD,CAAC;MACzE;MACAkC,eAAe,GAAG,KAAK;IACzB;IAEAS,iBAAiB,CAAC,CAAC,CAAC,CAAC;;IAErB,IAAAvC,eAAM,EAACoC,QAAQ,CAAC,CAACnC,YAAY,CAAC,CAAC,CAAC;IAChC,IAAAD,eAAM,EAACoC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAACE,SAAS,CAAC,uBAAuB,CAAC;EACxD,CAAC,CAAC;EAEF,IAAAjD,aAAI,EAAC,wCAAwC,EAAE,MAAM;IACnD,MAAM+C,QAAkB,GAAG,EAAE;IAC7B,IAAIN,eAAe,GAAG,KAAK;IAE3B,SAASO,kBAAkBA,CAAA,EAAS;MAClC,IAAIP,eAAe,EAAE;QACnBM,QAAQ,CAACxC,IAAI,CAAC,6DAA6D,CAAC;MAC9E;MACAkC,eAAe,GAAG,IAAI;IACxB;IAEA,SAASS,iBAAiBA,CAAA,EAAS;MACjC,IAAI,CAACT,eAAe,EAAE;QACpBM,QAAQ,CAACxC,IAAI,CAAC,wDAAwD,CAAC;MACzE;MACAkC,eAAe,GAAG,KAAK;IACzB;;IAEA;IACAO,kBAAkB,CAAC,CAAC;IACpB,IAAArC,eAAM,EAAC8B,eAAe,CAAC,CAAC5B,IAAI,CAAC,IAAI,CAAC;IAElCqC,iBAAiB,CAAC,CAAC;IACnB,IAAAvC,eAAM,EAAC8B,eAAe,CAAC,CAAC5B,IAAI,CAAC,KAAK,CAAC;IAEnCmC,kBAAkB,CAAC,CAAC;IACpB,IAAArC,eAAM,EAAC8B,eAAe,CAAC,CAAC5B,IAAI,CAAC,IAAI,CAAC;IAElCqC,iBAAiB,CAAC,CAAC;IACnB,IAAAvC,eAAM,EAAC8B,eAAe,CAAC,CAAC5B,IAAI,CAAC,KAAK,CAAC;IAEnC,IAAAF,eAAM,EAACoC,QAAQ,CAAC,CAACnC,YAAY,CAAC,CAAC,CAAC;EAClC,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}