{"version":3,"names":["OutputPatterns","exports","git","success","failure","npm","command","formatVerifiedResult","result","status","details","summary","lines","push","verificationChecks","failedChecks","filter","c","passed","length","check","suggestedActions","action","join","verifiedSuccess","checks","durationMs","verifiedAt","Date","toISOString","verifiedFailure","analyzeOutput","output","patterns","exitCode","normalizedOutput","normalize","pattern","test","isSuccess","isFailure","matchedPattern","source","confidence","undefined","createCommandCheck","checkName","expectedPatterns","foundPattern","some","p","safeTruncate","content","maxLength","_label","hiddenChars","slice"],"sources":["resultVerification.ts"],"sourcesContent":["/**\n * Result Verification - Re-exported from orchestrationCapability\n * Provides verifiedSuccess, verifiedFailure, analyzeOutput, OutputPatterns, etc.\n */\n\nexport type VerificationStatus =\n  | 'VERIFIED_SUCCESS'\n  | 'VERIFIED_FAILURE'\n  | 'UNVERIFIED'\n  | 'PARTIAL_SUCCESS'\n  | 'REQUIRES_USER_ACTION';\n\nexport interface VerifiedResult {\n  status: VerificationStatus;\n  summary: string;\n  details: string;\n  verificationChecks?: VerificationCheck[];\n  suggestedActions?: string[];\n  verifiedAt: string;\n  durationMs?: number;\n}\n\nexport interface VerificationCheck {\n  check: string;\n  passed: boolean;\n  details?: string;\n}\n\nexport const OutputPatterns = {\n  git: {\n    success: [/\\[.+\\s+\\w+\\]/, /pushed/i, /merged/i, /On branch/i, /nothing to commit/i, /Already up to date/i],\n    failure: [/fatal:/i, /error:/i, /conflict/i, /rejected/i, /CONFLICT/, /Aborting/i],\n  },\n  npm: {\n    success: [/npm notice/i, /\\+ .+@\\d+\\.\\d+\\.\\d+/, /published/i],\n    failure: [/npm ERR!/i, /ERESOLVE/i, /E404/i, /EINTEGRITY/i],\n  },\n  command: {\n    success: [/^(success|completed|done|finished)/im, /successfully/i],\n    failure: [/^error/im, /^fatal/im, /failed/i, /command not found/i, /permission denied/i, /ENOENT/i, /EACCES/i],\n  },\n};\n\nfunction formatVerifiedResult(result: VerifiedResult): string {\n  if (result.status === 'VERIFIED_SUCCESS') return result.details || result.summary;\n  const lines: string[] = [];\n  switch (result.status) {\n    case 'VERIFIED_FAILURE': lines.push('═══ FAILED ═══'); break;\n    case 'UNVERIFIED': lines.push('═══ UNVERIFIED ═══'); break;\n    case 'PARTIAL_SUCCESS': lines.push('═══ PARTIAL SUCCESS ═══'); break;\n    case 'REQUIRES_USER_ACTION': lines.push('═══ ACTION REQUIRED ═══'); break;\n  }\n  lines.push('', result.summary, '');\n  if (result.verificationChecks) {\n    const failedChecks = result.verificationChecks.filter(c => !c.passed);\n    if (failedChecks.length > 0) {\n      lines.push('Failed checks:');\n      for (const check of failedChecks) {\n        lines.push(`  ✗ ${check.check}${check.details ? `: ${check.details}` : ''}`);\n      }\n      lines.push('');\n    }\n  }\n  if (result.details) lines.push(result.details, '');\n  if (result.suggestedActions?.length) {\n    lines.push('Suggested actions:');\n    for (const action of result.suggestedActions) lines.push(`  → ${action}`);\n  }\n  return lines.join('\\n');\n}\n\nexport function verifiedSuccess(\n  summary: string,\n  details: string,\n  checks?: VerificationCheck[],\n  durationMs?: number\n): string {\n  return formatVerifiedResult({\n    status: 'VERIFIED_SUCCESS',\n    summary,\n    details,\n    verificationChecks: checks,\n    verifiedAt: new Date().toISOString(),\n    durationMs,\n  });\n}\n\nexport function verifiedFailure(\n  summary: string,\n  details: string,\n  suggestedActions?: string[],\n  checks?: VerificationCheck[],\n  durationMs?: number\n): string {\n  return formatVerifiedResult({\n    status: 'VERIFIED_FAILURE',\n    summary,\n    details,\n    verificationChecks: checks,\n    suggestedActions,\n    verifiedAt: new Date().toISOString(),\n    durationMs,\n  });\n}\n\nexport function analyzeOutput(\n  output: string,\n  patterns: { success: RegExp[]; failure: RegExp[] },\n  exitCode?: number\n): { isSuccess: boolean; isFailure: boolean; matchedPattern?: string; confidence: 'high' | 'medium' | 'low' } {\n  const normalizedOutput = output.normalize('NFC');\n  for (const pattern of patterns.failure) {\n    if (pattern.test(normalizedOutput)) return { isSuccess: false, isFailure: true, matchedPattern: pattern.source, confidence: 'high' };\n  }\n  for (const pattern of patterns.success) {\n    if (pattern.test(normalizedOutput)) return { isSuccess: true, isFailure: false, matchedPattern: pattern.source, confidence: 'high' };\n  }\n  if (exitCode !== undefined) {\n    if (exitCode !== 0) return { isSuccess: false, isFailure: true, confidence: 'high' };\n    return { isSuccess: false, isFailure: false, confidence: 'low' };\n  }\n  return { isSuccess: false, isFailure: false, confidence: 'low' };\n}\n\nexport function createCommandCheck(\n  checkName: string,\n  exitCode: number,\n  output: string,\n  expectedPatterns?: RegExp[]\n): VerificationCheck {\n  let passed = exitCode === 0;\n  let details = exitCode === 0 ? 'Exit code 0' : `Exit code ${exitCode}`;\n  if (expectedPatterns && passed) {\n    const foundPattern = expectedPatterns.some((p) => p.test(output));\n    if (!foundPattern) {\n      passed = false;\n      details = 'Exit code 0 but expected output pattern not found';\n    }\n  }\n  return { check: checkName, passed, details };\n}\n\nexport function safeTruncate(content: string, maxLength: number, _label: string = 'Content'): string {\n  if (content.length <= maxLength) return content;\n  const hiddenChars = content.length - maxLength;\n  return `${content.slice(0, maxLength)}\\n\\n[... ${hiddenChars} characters truncated]`;\n}\n"],"mappings":"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","ignoreList":[]}