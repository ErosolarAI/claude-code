e49b90150fdcff8068611858e05ae466
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.OrchestrationUIBridge = void 0;
var _UIUpdateCoordinator = require("./UIUpdateCoordinator.js");
class OrchestrationUIBridge {
  constructor(options) {
    this.display = options.display;
    this.orchestrator = options.orchestrator;
    this.updateCoordinator = options.updateCoordinator ?? new _UIUpdateCoordinator.UIUpdateCoordinator();
    this.showRealtime = Boolean(options.showRealTimeOutput);
    if (this.orchestrator?.onEvent) {
      this.unsub = this.orchestrator.onEvent(event => this.handleEvent(event));
    }
  }
  async execute(objective) {
    const execConfig = {
      objective
    };
    this.updateCoordinator.setMode('flushing');
    const report = (await this.orchestrator?.execute(execConfig)) ?? {
      id: 'noop',
      objective,
      startTime: Date.now(),
      endTime: Date.now(),
      duration: 0,
      results: [],
      findings: [],
      recommendations: [],
      summary: 'noop',
      success: true
    };
    this.updateCoordinator.setMode('idle');
    return report;
  }
  dispose() {
    this.unsub?.();
  }
  handleEvent(event) {
    if (!this.showRealtime) {
      return;
    }
    const name = event.data && typeof event.data === 'object' ? event.data.toolName ?? '' : '';
    this.display.writeRaw(`[${event.type}] ${name}\n`);
    this.updateCoordinator.enqueue({
      lane: 'status',
      run: () => {
        this.display.writeRaw('');
      }
    });
  }
}
exports.OrchestrationUIBridge = OrchestrationUIBridge;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfVUlVcGRhdGVDb29yZGluYXRvciIsInJlcXVpcmUiLCJPcmNoZXN0cmF0aW9uVUlCcmlkZ2UiLCJjb25zdHJ1Y3RvciIsIm9wdGlvbnMiLCJkaXNwbGF5Iiwib3JjaGVzdHJhdG9yIiwidXBkYXRlQ29vcmRpbmF0b3IiLCJVSVVwZGF0ZUNvb3JkaW5hdG9yIiwic2hvd1JlYWx0aW1lIiwiQm9vbGVhbiIsInNob3dSZWFsVGltZU91dHB1dCIsIm9uRXZlbnQiLCJ1bnN1YiIsImV2ZW50IiwiaGFuZGxlRXZlbnQiLCJleGVjdXRlIiwib2JqZWN0aXZlIiwiZXhlY0NvbmZpZyIsInNldE1vZGUiLCJyZXBvcnQiLCJpZCIsInN0YXJ0VGltZSIsIkRhdGUiLCJub3ciLCJlbmRUaW1lIiwiZHVyYXRpb24iLCJyZXN1bHRzIiwiZmluZGluZ3MiLCJyZWNvbW1lbmRhdGlvbnMiLCJzdW1tYXJ5Iiwic3VjY2VzcyIsImRpc3Bvc2UiLCJuYW1lIiwiZGF0YSIsInRvb2xOYW1lIiwid3JpdGVSYXciLCJ0eXBlIiwiZW5xdWV1ZSIsImxhbmUiLCJydW4iLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiT3JjaGVzdHJhdGlvblVJQnJpZGdlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgT3JjaGVzdHJhdG9yRXZlbnQsIE9wZXJhdGlvbkNvbmZpZywgT3BlcmF0aW9uUmVwb3J0LCBVbmlmaWVkT3JjaGVzdHJhdG9yIH0gZnJvbSAnLi4vLi4vY29yZS91bmlmaWVkT3JjaGVzdHJhdG9yLmpzJztcbmltcG9ydCB7IFVJVXBkYXRlQ29vcmRpbmF0b3IgfSBmcm9tICcuL1VJVXBkYXRlQ29vcmRpbmF0b3IuanMnO1xuXG5pbnRlcmZhY2UgRGlzcGxheSB7XG4gIHdyaXRlUmF3KHRleHQ6IHN0cmluZyk6IHZvaWQ7XG4gIHNob3dFcnJvcih0aXRsZTogc3RyaW5nLCBlcnJvcjogdW5rbm93bik6IHZvaWQ7XG4gIHNob3dTeXN0ZW1NZXNzYWdlKG1lc3NhZ2U6IHN0cmluZyk6IHZvaWQ7XG59XG5cbmludGVyZmFjZSBCcmlkZ2VPcHRpb25zIHtcbiAgZGlzcGxheTogRGlzcGxheTtcbiAgdXBkYXRlQ29vcmRpbmF0b3I/OiBVSVVwZGF0ZUNvb3JkaW5hdG9yO1xuICBvcmNoZXN0cmF0b3I/OiBVbmlmaWVkT3JjaGVzdHJhdG9yO1xuICBzaG93UmVhbFRpbWVPdXRwdXQ/OiBib29sZWFuO1xuICBzaG93UHJvZ3Jlc3NCYXI/OiBib29sZWFuO1xuICB2ZXJib3NlTW9kZT86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjbGFzcyBPcmNoZXN0cmF0aW9uVUlCcmlkZ2Uge1xuICBwcml2YXRlIHJlYWRvbmx5IGRpc3BsYXk6IERpc3BsYXk7XG4gIHByaXZhdGUgcmVhZG9ubHkgb3JjaGVzdHJhdG9yOiBVbmlmaWVkT3JjaGVzdHJhdG9yIHwgdW5kZWZpbmVkO1xuICBwcml2YXRlIHJlYWRvbmx5IHVwZGF0ZUNvb3JkaW5hdG9yOiBVSVVwZGF0ZUNvb3JkaW5hdG9yO1xuICBwcml2YXRlIHJlYWRvbmx5IHNob3dSZWFsdGltZTogYm9vbGVhbjtcbiAgcHJpdmF0ZSB1bnN1Yj86ICgpID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3Iob3B0aW9uczogQnJpZGdlT3B0aW9ucykge1xuICAgIHRoaXMuZGlzcGxheSA9IG9wdGlvbnMuZGlzcGxheTtcbiAgICB0aGlzLm9yY2hlc3RyYXRvciA9IG9wdGlvbnMub3JjaGVzdHJhdG9yO1xuICAgIHRoaXMudXBkYXRlQ29vcmRpbmF0b3IgPSBvcHRpb25zLnVwZGF0ZUNvb3JkaW5hdG9yID8/IG5ldyBVSVVwZGF0ZUNvb3JkaW5hdG9yKCk7XG4gICAgdGhpcy5zaG93UmVhbHRpbWUgPSBCb29sZWFuKG9wdGlvbnMuc2hvd1JlYWxUaW1lT3V0cHV0KTtcblxuICAgIGlmICh0aGlzLm9yY2hlc3RyYXRvcj8ub25FdmVudCkge1xuICAgICAgdGhpcy51bnN1YiA9IHRoaXMub3JjaGVzdHJhdG9yLm9uRXZlbnQoKGV2ZW50KSA9PiB0aGlzLmhhbmRsZUV2ZW50KGV2ZW50KSk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZXhlY3V0ZShvYmplY3RpdmU6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uUmVwb3J0PiB7XG4gICAgY29uc3QgZXhlY0NvbmZpZzogUGFydGlhbDxPcGVyYXRpb25Db25maWc+ID0geyBvYmplY3RpdmUgfTtcbiAgICB0aGlzLnVwZGF0ZUNvb3JkaW5hdG9yLnNldE1vZGUoJ2ZsdXNoaW5nJyk7XG4gICAgY29uc3QgcmVwb3J0ID1cbiAgICAgIChhd2FpdCB0aGlzLm9yY2hlc3RyYXRvcj8uZXhlY3V0ZShleGVjQ29uZmlnKSkgPz9cbiAgICAgICh7XG4gICAgICAgIGlkOiAnbm9vcCcsXG4gICAgICAgIG9iamVjdGl2ZSxcbiAgICAgICAgc3RhcnRUaW1lOiBEYXRlLm5vdygpLFxuICAgICAgICBlbmRUaW1lOiBEYXRlLm5vdygpLFxuICAgICAgICBkdXJhdGlvbjogMCxcbiAgICAgICAgcmVzdWx0czogW10sXG4gICAgICAgIGZpbmRpbmdzOiBbXSxcbiAgICAgICAgcmVjb21tZW5kYXRpb25zOiBbXSxcbiAgICAgICAgc3VtbWFyeTogJ25vb3AnLFxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgfSBzYXRpc2ZpZXMgT3BlcmF0aW9uUmVwb3J0KTtcbiAgICB0aGlzLnVwZGF0ZUNvb3JkaW5hdG9yLnNldE1vZGUoJ2lkbGUnKTtcbiAgICByZXR1cm4gcmVwb3J0O1xuICB9XG5cbiAgZGlzcG9zZSgpOiB2b2lkIHtcbiAgICB0aGlzLnVuc3ViPy4oKTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlRXZlbnQoZXZlbnQ6IE9yY2hlc3RyYXRvckV2ZW50KTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnNob3dSZWFsdGltZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBuYW1lID0gZXZlbnQuZGF0YSAmJiB0eXBlb2YgZXZlbnQuZGF0YSA9PT0gJ29iamVjdCcgPyAoZXZlbnQuZGF0YSBhcyBhbnkpLnRvb2xOYW1lID8/ICcnIDogJyc7XG4gICAgdGhpcy5kaXNwbGF5LndyaXRlUmF3KGBbJHtldmVudC50eXBlfV0gJHtuYW1lfVxcbmApO1xuICAgIHRoaXMudXBkYXRlQ29vcmRpbmF0b3IuZW5xdWV1ZSh7XG4gICAgICBsYW5lOiAnc3RhdHVzJyxcbiAgICAgIHJ1bjogKCkgPT4ge1xuICAgICAgICB0aGlzLmRpc3BsYXkud3JpdGVSYXcoJycpO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQSxJQUFBQSxvQkFBQSxHQUFBQyxPQUFBO0FBaUJPLE1BQU1DLHFCQUFxQixDQUFDO0VBT2pDQyxXQUFXQSxDQUFDQyxPQUFzQixFQUFFO0lBQ2xDLElBQUksQ0FBQ0MsT0FBTyxHQUFHRCxPQUFPLENBQUNDLE9BQU87SUFDOUIsSUFBSSxDQUFDQyxZQUFZLEdBQUdGLE9BQU8sQ0FBQ0UsWUFBWTtJQUN4QyxJQUFJLENBQUNDLGlCQUFpQixHQUFHSCxPQUFPLENBQUNHLGlCQUFpQixJQUFJLElBQUlDLHdDQUFtQixDQUFDLENBQUM7SUFDL0UsSUFBSSxDQUFDQyxZQUFZLEdBQUdDLE9BQU8sQ0FBQ04sT0FBTyxDQUFDTyxrQkFBa0IsQ0FBQztJQUV2RCxJQUFJLElBQUksQ0FBQ0wsWUFBWSxFQUFFTSxPQUFPLEVBQUU7TUFDOUIsSUFBSSxDQUFDQyxLQUFLLEdBQUcsSUFBSSxDQUFDUCxZQUFZLENBQUNNLE9BQU8sQ0FBRUUsS0FBSyxJQUFLLElBQUksQ0FBQ0MsV0FBVyxDQUFDRCxLQUFLLENBQUMsQ0FBQztJQUM1RTtFQUNGO0VBRUEsTUFBTUUsT0FBT0EsQ0FBQ0MsU0FBaUIsRUFBNEI7SUFDekQsTUFBTUMsVUFBb0MsR0FBRztNQUFFRDtJQUFVLENBQUM7SUFDMUQsSUFBSSxDQUFDVixpQkFBaUIsQ0FBQ1ksT0FBTyxDQUFDLFVBQVUsQ0FBQztJQUMxQyxNQUFNQyxNQUFNLEdBQ1YsQ0FBQyxNQUFNLElBQUksQ0FBQ2QsWUFBWSxFQUFFVSxPQUFPLENBQUNFLFVBQVUsQ0FBQyxLQUM1QztNQUNDRyxFQUFFLEVBQUUsTUFBTTtNQUNWSixTQUFTO01BQ1RLLFNBQVMsRUFBRUMsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQztNQUNyQkMsT0FBTyxFQUFFRixJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFDO01BQ25CRSxRQUFRLEVBQUUsQ0FBQztNQUNYQyxPQUFPLEVBQUUsRUFBRTtNQUNYQyxRQUFRLEVBQUUsRUFBRTtNQUNaQyxlQUFlLEVBQUUsRUFBRTtNQUNuQkMsT0FBTyxFQUFFLE1BQU07TUFDZkMsT0FBTyxFQUFFO0lBQ1gsQ0FBNEI7SUFDOUIsSUFBSSxDQUFDeEIsaUJBQWlCLENBQUNZLE9BQU8sQ0FBQyxNQUFNLENBQUM7SUFDdEMsT0FBT0MsTUFBTTtFQUNmO0VBRUFZLE9BQU9BLENBQUEsRUFBUztJQUNkLElBQUksQ0FBQ25CLEtBQUssR0FBRyxDQUFDO0VBQ2hCO0VBRVFFLFdBQVdBLENBQUNELEtBQXdCLEVBQVE7SUFDbEQsSUFBSSxDQUFDLElBQUksQ0FBQ0wsWUFBWSxFQUFFO01BQ3RCO0lBQ0Y7SUFDQSxNQUFNd0IsSUFBSSxHQUFHbkIsS0FBSyxDQUFDb0IsSUFBSSxJQUFJLE9BQU9wQixLQUFLLENBQUNvQixJQUFJLEtBQUssUUFBUSxHQUFJcEIsS0FBSyxDQUFDb0IsSUFBSSxDQUFTQyxRQUFRLElBQUksRUFBRSxHQUFHLEVBQUU7SUFDbkcsSUFBSSxDQUFDOUIsT0FBTyxDQUFDK0IsUUFBUSxDQUFDLElBQUl0QixLQUFLLENBQUN1QixJQUFJLEtBQUtKLElBQUksSUFBSSxDQUFDO0lBQ2xELElBQUksQ0FBQzFCLGlCQUFpQixDQUFDK0IsT0FBTyxDQUFDO01BQzdCQyxJQUFJLEVBQUUsUUFBUTtNQUNkQyxHQUFHLEVBQUVBLENBQUEsS0FBTTtRQUNULElBQUksQ0FBQ25DLE9BQU8sQ0FBQytCLFFBQVEsQ0FBQyxFQUFFLENBQUM7TUFDM0I7SUFDRixDQUFDLENBQUM7RUFDSjtBQUNGO0FBQUNLLE9BQUEsQ0FBQXZDLHFCQUFBLEdBQUFBLHFCQUFBIiwiaWdub3JlTGlzdCI6W119