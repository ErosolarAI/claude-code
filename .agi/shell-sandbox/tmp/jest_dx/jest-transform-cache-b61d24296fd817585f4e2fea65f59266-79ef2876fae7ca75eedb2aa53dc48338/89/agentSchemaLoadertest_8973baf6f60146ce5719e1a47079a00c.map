{"version":3,"names":["_getJestObj","mock","mockSchema","contractVersion","version","providers","id","label","envVars","apiKey","models","provider","profiles","name","description","slashCommands","capabilities","cachedSchema","getAgentSchemas","jest","fn","getProviders","getProvider","providerId","find","p","getModels","getModelsByProvider","filter","m","getModel","modelId","getProfiles","getProfile","profileName","getSlashCommands","getCapabilities","clearSchemaCache","isValidProvider","some","isValidModel","isValidProfile","_agentSchemaLoader","require","describe","beforeEach","it","schemas","expect","toBeDefined","toBe","Array","isArray","length","toBeGreaterThan","openaiProvider","unknownProvider","toBeUndefined","hasGpt4o","openaiModels","every","emptyModels","model","unknownModel","hasCodeProfile","profile","unknownProfile"],"sources":["agentSchemaLoader.test.ts"],"sourcesContent":["/**\n * Tests for centralized agent schema loader\n */\n\n// Mock the agentSchemaLoader module to avoid ESM import.meta issues in Jest\njest.mock('../src/core/agentSchemaLoader.js', () => {\n  const mockSchema = {\n    contractVersion: '1.0.0',\n    version: '2024-11-24',\n    providers: [\n      { id: 'openai', label: 'OpenAI', envVars: { apiKey: 'OPENAI_API_KEY' } },\n      { id: 'anthropic', label: 'Anthropic', envVars: { apiKey: 'ANTHROPIC_API_KEY' } },\n      { id: 'ollama', label: 'Ollama (Local)', envVars: {} }\n    ],\n    models: [\n      { id: 'gpt-4o', label: 'gpt-4o', provider: 'openai' },\n      { id: 'claude-3-opus', label: 'Claude 3 Opus', provider: 'anthropic' }\n    ],\n    profiles: [\n      { name: 'agi-code', label: 'AGI Code', description: 'Coding assistant' }\n    ],\n    slashCommands: [],\n    capabilities: []\n  };\n\n  let cachedSchema: typeof mockSchema | null = mockSchema;\n\n  return {\n    getAgentSchemas: jest.fn(() => {\n      if (!cachedSchema) {\n        cachedSchema = mockSchema;\n      }\n      return cachedSchema;\n    }),\n    getProviders: jest.fn(() => mockSchema.providers),\n    getProvider: jest.fn((providerId: string) => \n      mockSchema.providers.find(p => p.id === providerId)\n    ),\n    getModels: jest.fn(async () => mockSchema.models),\n    getModelsByProvider: jest.fn(async (providerId: string) => \n      mockSchema.models.filter(m => m.provider === providerId)\n    ),\n    getModel: jest.fn(async (modelId: string) => \n      mockSchema.models.find(m => m.id === modelId)\n    ),\n    getProfiles: jest.fn(() => mockSchema.profiles),\n    getProfile: jest.fn((profileName: string) => \n      mockSchema.profiles.find(p => p.name === profileName)\n    ),\n    getSlashCommands: jest.fn(() => mockSchema.slashCommands),\n    getCapabilities: jest.fn(() => mockSchema.capabilities),\n    clearSchemaCache: jest.fn(() => { cachedSchema = null; }),\n    isValidProvider: jest.fn((providerId: string) => \n      mockSchema.providers.some(p => p.id === providerId)\n    ),\n    isValidModel: jest.fn(async (modelId: string) => \n      mockSchema.models.some(m => m.id === modelId)\n    ),\n    isValidProfile: jest.fn((profileName: string) => \n      mockSchema.profiles.some(p => p.name === profileName)\n    )\n  };\n});\n\n// Import after mock\nimport { \n  getAgentSchemas, \n  getProviders, \n  getProvider,\n  getModels,\n  getModelsByProvider,\n  getModel,\n  getProfiles,\n  getProfile,\n  getSlashCommands,\n  getCapabilities,\n  clearSchemaCache,\n  isValidProvider,\n  isValidModel,\n  isValidProfile\n} from '../src/core/agentSchemaLoader.js';\n\ndescribe('agentSchemaLoader', () => {\n  beforeEach(() => {\n    // Clear cache before each test\n    clearSchemaCache();\n  });\n\n  it('should load agent schemas', () => {\n    const schemas = getAgentSchemas();\n    expect(schemas).toBeDefined();\n    expect(schemas.contractVersion).toBe('1.0.0');\n    expect(schemas.version).toBeDefined();\n    expect(Array.isArray(schemas.providers)).toBe(true);\n    expect(Array.isArray(schemas.models)).toBe(true);\n    expect(Array.isArray(schemas.profiles)).toBe(true);\n  });\n\n  it('should get providers list', () => {\n    const providers = getProviders();\n    expect(Array.isArray(providers)).toBe(true);\n    expect(providers.length).toBeGreaterThan(0);\n    \n    const openaiProvider = providers.find(p => p.id === 'openai');\n    expect(openaiProvider).toBeDefined();\n    expect(openaiProvider?.label).toBe('OpenAI');\n  });\n\n  it('should get specific provider', () => {\n    const provider = getProvider('anthropic');\n    expect(provider).toBeDefined();\n    expect(provider?.id).toBe('anthropic');\n    expect(provider?.label).toBe('Anthropic');\n    \n    const unknownProvider = getProvider('unknown' as any);\n    expect(unknownProvider).toBeUndefined();\n  });\n\n  it('should get models asynchronously', async () => {\n    const models = await getModels();\n    expect(Array.isArray(models)).toBe(true);\n    expect(models.length).toBeGreaterThan(0);\n    \n    const hasGpt4o = models.some(m => m.id === 'gpt-4o');\n    expect(hasGpt4o).toBe(true);\n  });\n\n  it('should get models by provider asynchronously', async () => {\n    const openaiModels = await getModelsByProvider('openai');\n    expect(Array.isArray(openaiModels)).toBe(true);\n    expect(openaiModels.length).toBeGreaterThan(0);\n    expect(openaiModels.every(m => m.provider === 'openai')).toBe(true);\n    \n    const emptyModels = await getModelsByProvider('unknown' as any);\n    expect(Array.isArray(emptyModels)).toBe(true);\n    expect(emptyModels.length).toBe(0);\n  });\n\n  it('should get specific model asynchronously', async () => {\n    const model = await getModel('gpt-4o');\n    expect(model).toBeDefined();\n    expect(model?.id).toBe('gpt-4o');\n    expect(model?.provider).toBe('openai');\n    \n    const unknownModel = await getModel('unknown-model');\n    expect(unknownModel).toBeUndefined();\n  });\n\n  it('should get profiles list', () => {\n    const profiles = getProfiles();\n    expect(Array.isArray(profiles)).toBe(true);\n    expect(profiles.length).toBeGreaterThan(0);\n    \n    const hasCodeProfile = profiles.some(p => p.name === 'agi-code');\n    expect(hasCodeProfile).toBe(true);\n  });\n\n  it('should get specific profile', () => {\n    const profile = getProfile('agi-code');\n    expect(profile).toBeDefined();\n    expect(profile?.name).toBe('agi-code');\n    \n    const unknownProfile = getProfile('unknown-profile');\n    expect(unknownProfile).toBeUndefined();\n  });\n\n  it('should get slash commands', () => {\n    const slashCommands = getSlashCommands();\n    expect(Array.isArray(slashCommands)).toBe(true);\n  });\n\n  it('should get capabilities', () => {\n    const capabilities = getCapabilities();\n    expect(Array.isArray(capabilities)).toBe(true);\n  });\n\n  it('should validate provider IDs', () => {\n    expect(isValidProvider('openai')).toBe(true);\n    expect(isValidProvider('anthropic')).toBe(true);\n    expect(isValidProvider('unknown')).toBe(false);\n  });\n\n  it('should validate model IDs asynchronously', async () => {\n    expect(await isValidModel('gpt-4o')).toBe(true);\n    expect(await isValidModel('unknown-model')).toBe(false);\n  });\n\n  it('should validate profile names', () => {\n    expect(isValidProfile('agi-code')).toBe(true);\n    expect(isValidProfile('unknown-profile')).toBe(false);\n  });\n});"],"mappings":"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","ignoreList":[]}