{"version":3,"names":["_nodeFs","require","_nodePath","_unifiedOrchestrator","REPO_UPGRADE_MODE_DEFINITIONS","exports","id","label","description","variants","variantGuidance","primary","refiner","refinerBias","buildRepoWidePlan","workspaceRoot","additionalScopes","areas","scope","candidates","codemodCommands","validationCommands","extra","trim","slug","replace","toLowerCase","push","modules","workspaceModules","detectWorkspaceModules","area","matches","some","candidate","existsSync","join","steps","buildDefaultSteps","length","pkgPath","workspaces","pkg","JSON","parse","readFileSync","parseWorkspaceField","seen","Set","pattern","paths","expandWorkspacePattern","relPath","has","add","cleanPath","name","split","filter","Boolean","pop","normalizedPath","value","Array","isArray","map","entry","record","packages","normalized","includes","target","base","baseDir","entries","readdirSync","withFileTypes","isDirectory","RepoUpgradeOrchestrator","UnifiedOrchestrator","constructor","executor","run","plan","options","mode","continueOnFailure","objective","modeDefinition","getModeDefinition","variantWorkspaceRoots","repoPolicy","undefined","results","findings","moduleReports","variantStats","primaryWins","refinerWins","ties","totalSteps","halted","module","status","emit","type","timestamp","Date","now","data","moduleId","moduleReport","step","outcome","runStep","updateVariantStats","winner","success","baseReport","generateReport","stepId","variant","variantResults","previousResult","result","safeExecuteVariant","winnerVariant","pickWinner","recordOutcomeArtifacts","intent","input","error","message","Error","String","summary","detail","score","durationMs","execution","output","duration","command","notes","definition","primaryScore","refinerScore","stats","refinerScoreRaw","scoresClose","Math","abs","bothSucceeded","prompt"],"sources":["repoUpgradeOrchestrator.ts"],"sourcesContent":["import { existsSync, readFileSync, readdirSync } from 'node:fs';\nimport { join } from 'node:path';\nimport { UnifiedOrchestrator, type ExecutionResult, type Finding, type OperationReport } from './unifiedOrchestrator.js';\n\nexport type RepoUpgradeMode = 'single-continuous' | 'dual-rl-continuous';\nexport type UpgradeVariant = 'primary' | 'refiner';\n\nexport interface RepoUpgradeModeDefinition {\n  id: RepoUpgradeMode;\n  label: string;\n  description: string;\n  /** Ordered list of variants to execute for this mode */\n  variants: UpgradeVariant[];\n  /** Guidance to inject into prompts per variant */\n  variantGuidance?: Partial<Record<UpgradeVariant, string>>;\n  /** Bias to apply to the refiner when scores are tied (encourages RL exploration) */\n  refinerBias?: number;\n}\n\nexport const REPO_UPGRADE_MODE_DEFINITIONS: Record<RepoUpgradeMode, RepoUpgradeModeDefinition> = {\n  'single-continuous': {\n    id: 'single-continuous',\n    label: 'Single continuous',\n    description: 'Single-pass deterministic execution focused on minimal blast radius.',\n    variants: ['primary'],\n    variantGuidance: {\n      primary: 'Plan and execute the best possible upgrade in one pass. Keep edits surgical and runnable.',\n    },\n  },\n  'dual-rl-continuous': {\n    id: 'dual-rl-continuous',\n    label: 'Dual-agent RL continuous',\n    description: 'Primary + refiner loop where the refiner competes to improve safety and quality.',\n    variants: ['primary', 'refiner'],\n    variantGuidance: {\n      primary: 'Primary pass sets the baseline plan and changes with conservative scope and runnable checks.',\n      refiner:\n        'RL refiner critiques the primary, fixes gaps, tightens safety, and only repeats steps if they materially improve the result.',\n    },\n    refinerBias: 0.05,\n  },\n};\n\nexport type UpgradeStepIntent = 'analyze' | 'upgrade' | 'verify' | 'cleanup';\n\nexport interface RepoUpgradeStep {\n  id: string;\n  intent: UpgradeStepIntent;\n  description: string;\n  /** Optional instruction or prompt to feed into the executor */\n  prompt?: string;\n}\n\nexport interface RepoUpgradeModule {\n  id: string;\n  label: string;\n  description: string;\n  scope: string[];\n  /** Suggested codemod commands to run for this module (display only, not executed automatically). */\n  codemodCommands?: string[];\n  /** Suggested validation commands to run for this module (display only, not executed automatically). */\n  validationCommands?: string[];\n  steps: RepoUpgradeStep[];\n}\n\nexport interface RepoUpgradePlan {\n  modules: RepoUpgradeModule[];\n}\n\nexport interface UpgradeStepExecutionInput {\n  module: RepoUpgradeModule;\n  step: RepoUpgradeStep;\n  /** Which path we are taking: single-pass primary or the dual RL refiner */\n  variant: UpgradeVariant;\n  mode: RepoUpgradeMode;\n  previousResult?: UpgradeStepResult;\n  workspaceRoot?: string;\n  repoPolicy?: string;\n}\n\nexport interface UpgradeStepResult {\n  success: boolean;\n  summary: string;\n  detail?: string;\n  score?: number;\n  durationMs?: number;\n  execution?: ExecutionResult;\n  findings?: Finding[];\n  notes?: string[];\n}\n\nexport interface UpgradeStepOutcome {\n  stepId: string;\n  intent: UpgradeStepIntent;\n  description: string;\n  primary: UpgradeStepResult;\n  refiner?: UpgradeStepResult;\n  winner: UpgradeStepResult;\n  winnerVariant: UpgradeVariant;\n  status: 'completed' | 'failed';\n}\n\nexport interface UpgradeModuleReport {\n  id: string;\n  label: string;\n  scope: string[];\n  codemodCommands?: string[];\n  validationCommands?: string[];\n  steps: UpgradeStepOutcome[];\n  status: 'completed' | 'failed' | 'skipped';\n  validations?: ValidationRunResult[];\n}\n\nexport interface RepoUpgradeReport extends OperationReport {\n  mode: RepoUpgradeMode;\n  continueOnFailure: boolean;\n  modules: UpgradeModuleReport[];\n  validationArtifacts?: ValidationRunResult[];\n  /** True when validation commands were executed instead of just suggested */\n  validationsExecuted?: boolean;\n  variantStats: VariantWinStats;\n  /** Paths used per variant when running dual workspaces (for git/worktree integrations). */\n  variantWorkspaceRoots?: Partial<Record<UpgradeVariant, string>>;\n  /** Optional policy that guided the run (e.g., upgrade or change-management policy). */\n  repoPolicy?: string;\n}\n\nexport interface RepoUpgradeRunOptions {\n  objective?: string;\n  mode: RepoUpgradeMode;\n  continueOnFailure?: boolean;\n  /** Optional per-variant workspace roots when running dual RL with separate repos. */\n  variantWorkspaceRoots?: Partial<Record<UpgradeVariant, string>>;\n  /** Optional policy/guideline string to surface in prompts and reports. */\n  repoPolicy?: string;\n}\n\nexport type UpgradeStepExecutor = (input: UpgradeStepExecutionInput) => Promise<UpgradeStepResult>;\n\nexport interface ValidationRunResult {\n  command: string;\n  success: boolean;\n  output: string;\n  error?: string;\n  durationMs: number;\n  skipped?: boolean;\n  reason?: string;\n}\n\nexport interface VariantWinStats {\n  primaryWins: number;\n  refinerWins: number;\n  /** Number of steps where scores were effectively tied and bias picked the winner */\n  ties: number;\n  totalSteps: number;\n}\n\n/**\n * Build a repo-wide upgrade plan using common directories. Falls back to a single\n * catch-all module when no known scopes are found.\n */\nexport function buildRepoWidePlan(workspaceRoot: string, additionalScopes: string[] = []): RepoUpgradePlan {\n  const areas: Array<{\n    id: string;\n    label: string;\n    description: string;\n    scope: string[];\n    candidates: string[];\n    codemodCommands?: string[];\n    validationCommands?: string[];\n  }> = [\n    {\n      id: 'source',\n      label: 'Source',\n      description: 'Core application and library code.',\n      scope: ['src/**/*', 'lib/**/*'],\n      candidates: ['src', 'lib'],\n      codemodCommands: ['npx jscodeshift -t <transform> src'],\n      validationCommands: ['npm run build', 'npm test'],\n    },\n    {\n      id: 'tests',\n      label: 'Tests',\n      description: 'Unit, integration, and smoke tests.',\n      scope: ['test/**/*', '__tests__/**/*'],\n      candidates: ['test', '__tests__'],\n      validationCommands: ['npm test -- --runInBand', 'npm run lint'],\n    },\n    {\n      id: 'docs',\n      label: 'Docs',\n      description: 'Documentation and guides.',\n      scope: ['docs/**/*', 'README.md'],\n      candidates: ['docs', 'README.md'],\n    },\n    {\n      id: 'scripts',\n      label: 'Tooling Scripts',\n      description: 'Build, migration, and maintenance scripts.',\n      scope: ['scripts/**/*'],\n      candidates: ['scripts'],\n      validationCommands: ['npm run lint -- scripts/**/*.ts'],\n    },\n    {\n      id: 'agents',\n      label: 'Agents',\n      description: 'Agent rules and behaviors.',\n      scope: ['agents/**/*'],\n      candidates: ['agents'],\n      validationCommands: ['npm run build'],\n    },\n    {\n      id: 'skills',\n      label: 'Skills',\n      description: 'Skill packs and reusable automation.',\n      scope: ['skills/**/*'],\n      candidates: ['skills'],\n      validationCommands: ['npm run build'],\n    },\n    {\n      id: 'examples',\n      label: 'Examples',\n      description: 'Example flows and templates.',\n      scope: ['examples/**/*'],\n      candidates: ['examples'],\n    },\n    {\n      id: 'configs',\n      label: 'Configuration',\n      description: 'Configuration and deployment settings.',\n      scope: ['config/**/*', '*.config.*', '*.rc', '*.json'],\n      candidates: ['config'],\n    },\n  ];\n\n  for (const extra of additionalScopes) {\n    if (!extra?.trim()) continue;\n    const slug = extra.replace(/[^\\w]/g, '-').toLowerCase() || 'custom';\n    areas.push({\n      id: `custom-${slug}`,\n      label: `Custom: ${extra}`,\n      description: `User-specified scope: ${extra}`,\n      scope: [`${extra}/**/*`],\n      candidates: [extra],\n    });\n  }\n\n  const modules: RepoUpgradeModule[] = [];\n  const workspaceModules = detectWorkspaceModules(workspaceRoot);\n  modules.push(...workspaceModules);\n\n  for (const area of areas) {\n    const matches = area.candidates.some((candidate) => existsSync(join(workspaceRoot, candidate)));\n    if (!matches) {\n      continue;\n    }\n    modules.push({\n      id: area.id,\n      label: area.label,\n      description: area.description,\n      scope: area.scope,\n      codemodCommands: area.codemodCommands,\n      validationCommands: area.validationCommands,\n      steps: buildDefaultSteps(area.id),\n    });\n  }\n\n  if (modules.length === 0) {\n    modules.push({\n      id: 'repo-wide',\n      label: 'Repository',\n      description: 'Fallback repo-wide upgrade module.',\n      scope: ['**/*'],\n      steps: buildDefaultSteps('repo'),\n    });\n  }\n\n  return { modules };\n}\n\nfunction detectWorkspaceModules(workspaceRoot: string): RepoUpgradeModule[] {\n  const pkgPath = join(workspaceRoot, 'package.json');\n  if (!existsSync(pkgPath)) {\n    return [];\n  }\n\n  let workspaces: string[] = [];\n  try {\n    const pkg = JSON.parse(readFileSync(pkgPath, 'utf8'));\n    workspaces = parseWorkspaceField(pkg?.workspaces);\n  } catch {\n    return [];\n  }\n\n  if (!workspaces.length) {\n    return [];\n  }\n\n  const modules: RepoUpgradeModule[] = [];\n  const seen = new Set<string>();\n\n  for (const pattern of workspaces) {\n    const paths = expandWorkspacePattern(workspaceRoot, pattern);\n    for (const relPath of paths) {\n      if (seen.has(relPath)) {\n        continue;\n      }\n      seen.add(relPath);\n\n      const cleanPath = relPath.replace(/\\/+$/, '');\n      const name = cleanPath.split('/').filter(Boolean).pop() ?? cleanPath;\n      const normalizedPath = cleanPath.replace(/[/\\\\]+/g, '-');\n      const slug = `workspace-${normalizedPath.replace(/[^\\w-]+/g, '-').replace(/-+/g, '-').toLowerCase() || 'default'}`;\n\n      modules.push({\n        id: slug,\n        label: `Workspace: ${name}`,\n        description: `Upgrade tasks scoped to workspace \"${name}\" (${cleanPath}).`,\n        scope: [`${cleanPath}/**/*`],\n        validationCommands: [\n          `npm test --workspace ${name} --if-present`,\n          `npm run lint --workspace ${name} --if-present`,\n        ],\n        steps: buildDefaultSteps(slug),\n      });\n    }\n  }\n\n  return modules;\n}\n\nfunction parseWorkspaceField(value: unknown): string[] {\n  if (Array.isArray(value)) {\n    return value.map((entry) => (typeof entry === 'string' ? entry.trim() : '')).filter(Boolean);\n  }\n  if (value && typeof value === 'object') {\n    const record = value as { packages?: unknown };\n    if (Array.isArray(record.packages)) {\n      return record.packages.map((entry) => (typeof entry === 'string' ? entry.trim() : '')).filter(Boolean);\n    }\n  }\n  return [];\n}\n\nfunction expandWorkspacePattern(workspaceRoot: string, pattern: string): string[] {\n  const normalized = pattern.trim();\n  if (!normalized) return [];\n\n  if (!normalized.includes('*')) {\n    const target = join(workspaceRoot, normalized);\n    return existsSync(target) ? [normalized] : [];\n  }\n\n  const base = normalized.split('*')[0]?.replace(/\\/+$/, '') ?? '';\n  if (!base) return [];\n\n  const baseDir = join(workspaceRoot, base);\n  if (!existsSync(baseDir)) return [];\n\n  try {\n    const entries = readdirSync(baseDir, { withFileTypes: true });\n    return entries.filter((entry) => entry.isDirectory()).map((entry) => `${base}/${entry.name}`);\n  } catch {\n    return [];\n  }\n}\n\nexport class RepoUpgradeOrchestrator extends UnifiedOrchestrator {\n  private readonly executor: UpgradeStepExecutor;\n  private variantWorkspaceRoots: Partial<Record<UpgradeVariant, string>> | undefined;\n  private repoPolicy: string | undefined;\n\n  constructor(executor: UpgradeStepExecutor) {\n    super();\n    this.executor = executor;\n  }\n\n  /**\n   * Execute the repo-wide plan using either single continuous or dual RL continuous mode.\n   */\n  async run(plan: RepoUpgradePlan, options: RepoUpgradeRunOptions): Promise<RepoUpgradeReport> {\n    const mode = options.mode;\n    const continueOnFailure = options.continueOnFailure ?? true;\n    const objective = options.objective ?? 'Repository-wide source code upgrade';\n    const modeDefinition = getModeDefinition(mode);\n    this.variantWorkspaceRoots = options.variantWorkspaceRoots;\n    this.repoPolicy = options.repoPolicy ?? undefined;\n\n    // Reset state per run to keep reports clean\n    this.results = [];\n    this.findings = [];\n\n    const moduleReports: UpgradeModuleReport[] = [];\n    const variantStats: VariantWinStats = { primaryWins: 0, refinerWins: 0, ties: 0, totalSteps: 0 };\n    let halted = false;\n\n    for (const module of plan.modules) {\n      if (halted) {\n        moduleReports.push({\n          id: module.id,\n          label: module.label,\n          scope: module.scope,\n          steps: [],\n          status: 'skipped',\n        });\n        continue;\n      }\n\n      this.emit({\n        type: 'upgrade.module.start',\n        timestamp: Date.now(),\n        data: { moduleId: module.id, label: module.label, scope: module.scope, mode },\n      });\n\n      const moduleReport: UpgradeModuleReport = {\n        id: module.id,\n        label: module.label,\n        scope: module.scope,\n        codemodCommands: module.codemodCommands,\n        validationCommands: module.validationCommands,\n        steps: [],\n        status: 'completed',\n      };\n\n      for (const step of module.steps) {\n        const outcome = await this.runStep(module, step, mode);\n        moduleReport.steps.push(outcome);\n        this.updateVariantStats(variantStats, outcome, modeDefinition);\n\n        if (!outcome.winner.success) {\n          moduleReport.status = 'failed';\n          if (!continueOnFailure) {\n            halted = true;\n            break;\n          }\n        }\n      }\n\n      moduleReports.push(moduleReport);\n\n      this.emit({\n        type: 'upgrade.module.complete',\n        timestamp: Date.now(),\n        data: { moduleId: module.id, status: moduleReport.status },\n      });\n    }\n\n    const baseReport = this.generateReport(objective);\n    return {\n      ...baseReport,\n      mode,\n      continueOnFailure,\n      modules: moduleReports,\n      variantStats,\n      variantWorkspaceRoots: this.variantWorkspaceRoots,\n      repoPolicy: this.repoPolicy,\n    };\n  }\n\n  private async runStep(\n    module: RepoUpgradeModule,\n    step: RepoUpgradeStep,\n    mode: RepoUpgradeMode\n  ): Promise<UpgradeStepOutcome> {\n    const modeDefinition = getModeDefinition(mode);\n    this.emit({\n      type: 'upgrade.step.start',\n      timestamp: Date.now(),\n      data: { moduleId: module.id, stepId: step.id, variant: 'primary', mode },\n    });\n\n    const variantResults: Partial<Record<UpgradeVariant, UpgradeStepResult>> = {};\n\n    for (const variant of modeDefinition.variants) {\n      const previousResult = variant === 'refiner' ? variantResults.primary : undefined;\n      const result = await this.safeExecuteVariant({\n        module,\n        step,\n        mode,\n        variant,\n        previousResult,\n        workspaceRoot: this.variantWorkspaceRoots?.[variant] ?? this.variantWorkspaceRoots?.primary,\n        repoPolicy: this.repoPolicy,\n      });\n      variantResults[variant] = result;\n    }\n\n    const primary = variantResults.primary as UpgradeStepResult;\n    const refiner = variantResults.refiner;\n\n    const { winner, winnerVariant } = this.pickWinner(modeDefinition, primary, refiner);\n    this.recordOutcomeArtifacts(module, step, winner, winnerVariant);\n\n    this.emit({\n      type: 'upgrade.step.complete',\n      timestamp: Date.now(),\n      data: { moduleId: module.id, stepId: step.id, variant: winnerVariant, success: winner.success },\n    });\n\n    return {\n      stepId: step.id,\n      intent: step.intent,\n      description: step.description,\n      primary,\n      refiner,\n      winner,\n      winnerVariant,\n      status: winner.success ? 'completed' : 'failed',\n    };\n  }\n\n  private async safeExecuteVariant(input: UpgradeStepExecutionInput): Promise<UpgradeStepResult> {\n    try {\n      return await this.executor(input);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return {\n        success: false,\n        summary: 'Execution failed',\n        detail: message,\n        score: 0,\n        durationMs: 0,\n        execution: {\n          success: false,\n          output: 'Execution failed',\n          duration: 0,\n          command: `${input.module.id}/${input.step.id}/${input.variant}`,\n          error: message,\n        },\n        notes: ['Executor threw an error'],\n      };\n    }\n  }\n\n  private pickWinner(\n    definition: RepoUpgradeModeDefinition,\n    primary: UpgradeStepResult,\n    refiner?: UpgradeStepResult\n  ): { winner: UpgradeStepResult; winnerVariant: UpgradeVariant } {\n    if (!refiner || !definition.variants.includes('refiner')) {\n      return { winner: primary, winnerVariant: 'primary' };\n    }\n\n    if (refiner.success && !primary.success) {\n      return { winner: refiner, winnerVariant: 'refiner' };\n    }\n    if (primary.success && !refiner.success) {\n      return { winner: primary, winnerVariant: 'primary' };\n    }\n\n    const primaryScore = typeof primary.score === 'number' ? primary.score : 0;\n    const refinerScore = (typeof refiner.score === 'number' ? refiner.score : 0) + (definition.refinerBias ?? 0);\n\n    if (refinerScore > primaryScore) {\n      return { winner: refiner, winnerVariant: 'refiner' };\n    }\n    if (primaryScore > refinerScore) {\n      return { winner: primary, winnerVariant: 'primary' };\n    }\n\n    // Tie breaker: prefer refiner to encourage RL exploration\n    return { winner: refiner, winnerVariant: 'refiner' };\n  }\n\n  private recordOutcomeArtifacts(\n    module: RepoUpgradeModule,\n    step: RepoUpgradeStep,\n    result: UpgradeStepResult,\n    variant: 'primary' | 'refiner'\n  ): void {\n    if (result.findings?.length) {\n      this.findings.push(...result.findings);\n    }\n\n    const execution: ExecutionResult = result.execution ?? {\n      success: result.success,\n      output: result.summary,\n      duration: result.durationMs ?? 0,\n      command: `${module.id}/${step.id}/${variant}`,\n      error: result.success ? undefined : result.detail ?? result.summary,\n    };\n\n    // Ensure we only track a single winner record per step to keep reports clean\n    this.results.push(execution);\n  }\n\n  private updateVariantStats(\n    stats: VariantWinStats,\n    outcome: UpgradeStepOutcome,\n    modeDefinition: RepoUpgradeModeDefinition\n  ): void {\n    stats.totalSteps += 1;\n    if (outcome.winnerVariant === 'refiner') {\n      stats.refinerWins += 1;\n    } else {\n      stats.primaryWins += 1;\n    }\n\n    if (!outcome.refiner) {\n      return;\n    }\n\n    const primaryScore = typeof outcome.primary.score === 'number' ? outcome.primary.score : 0;\n    const refinerScoreRaw = typeof outcome.refiner.score === 'number' ? outcome.refiner.score : 0;\n    const refinerScore = refinerScoreRaw + (modeDefinition.refinerBias ?? 0);\n    const scoresClose = Math.abs(primaryScore - refinerScore) < 1e-6;\n    const bothSucceeded = outcome.primary.success && outcome.refiner.success;\n    if (bothSucceeded && scoresClose) {\n      stats.ties += 1;\n    }\n  }\n}\n\nfunction buildDefaultSteps(moduleId: string): RepoUpgradeStep[] {\n  return [\n    {\n      id: `${moduleId}-analyze`,\n      intent: 'analyze',\n      description: `Map the upgrade surface for ${moduleId}. Identify risky files and coupling.`,\n      prompt: 'Inventory files, dependencies, and breaking-change areas before upgrading.',\n    },\n    {\n      id: `${moduleId}-upgrade`,\n      intent: 'upgrade',\n      description: `Apply modular upgrades for ${moduleId} with minimal blast radius.`,\n      prompt: 'Execute codemods or targeted edits. Keep edits small, atomic, and well scoped.',\n    },\n    {\n      id: `${moduleId}-verify`,\n      intent: 'verify',\n      description: `Validate ${moduleId} after the upgrade.`,\n      prompt: 'Run tests/lint/health checks relevant to this scope. Summarize residual risks.',\n    },\n  ];\n}\n\nfunction getModeDefinition(mode: RepoUpgradeMode): RepoUpgradeModeDefinition {\n  return REPO_UPGRADE_MODE_DEFINITIONS[mode] ?? REPO_UPGRADE_MODE_DEFINITIONS['single-continuous'];\n}\n"],"mappings":"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","ignoreList":[]}