5030754a391ec65aa4cd57ca2ebe0960
"use strict";

var _nodeFs = require("node:fs");
var _nodePath = require("node:path");
var _nodeOs = require("node:os");
var _globals = require("@jest/globals");
var _repoUpgradeOrchestrator = require("../src/core/repoUpgradeOrchestrator.js");
const simpleModule = id => ({
  id,
  label: id,
  description: `Module ${id}`,
  scope: [`${id}/**/*`],
  steps: [{
    id: `${id}-analyze`,
    intent: 'analyze',
    description: 'analyze'
  }, {
    id: `${id}-upgrade`,
    intent: 'upgrade',
    description: 'upgrade'
  }, {
    id: `${id}-verify`,
    intent: 'verify',
    description: 'verify'
  }]
});
const makePlan = (...modules) => ({
  modules
});
(0, _globals.describe)('RepoUpgradeOrchestrator - modes', () => {
  (0, _globals.it)('runs primary only in single-continuous mode and records winning executions', async () => {
    const calls = [];
    const executor = _globals.jest.fn(async input => {
      calls.push(input);
      return {
        success: true,
        summary: `${input.step.id}-${input.variant}`,
        score: input.variant === 'primary' ? 0.4 : 0.9,
        execution: {
          success: true,
          output: 'ok',
          duration: 1,
          command: `${input.module.id}/${input.step.id}/${input.variant}`
        }
      };
    });
    const orchestrator = new _repoUpgradeOrchestrator.RepoUpgradeOrchestrator(executor);
    const plan = makePlan(simpleModule('source'));
    const report = await orchestrator.run(plan, {
      mode: 'single-continuous',
      objective: 'upgrade'
    });
    (0, _globals.expect)(report.modules[0]?.steps.map(s => s.winnerVariant)).toEqual(['primary', 'primary', 'primary']);
    (0, _globals.expect)(calls.every(call => call.variant === 'primary')).toBe(true);
    (0, _globals.expect)(report.results).toHaveLength(plan.modules[0]?.steps.length ?? 0);
    (0, _globals.expect)(report.results.every(result => result.command?.endsWith('/primary'))).toBe(true);
  });
  (0, _globals.it)('prefers the refiner path in dual-rl-continuous mode when it scores higher', async () => {
    const executor = _globals.jest.fn(async input => {
      if (input.variant === 'primary') {
        return {
          success: true,
          summary: 'primary version',
          score: 0.2,
          execution: {
            success: true,
            output: 'primary',
            duration: 1,
            command: `${input.module.id}/${input.step.id}/primary`
          }
        };
      }
      return {
        success: true,
        summary: 'refiner wins',
        score: 0.9,
        execution: {
          success: true,
          output: 'refiner',
          duration: 1,
          command: `${input.module.id}/${input.step.id}/refiner`
        }
      };
    });
    const orchestrator = new _repoUpgradeOrchestrator.RepoUpgradeOrchestrator(executor);
    const plan = makePlan(simpleModule('src-only'));
    const report = await orchestrator.run(plan, {
      mode: 'dual-rl-continuous'
    });
    const step = report.modules[0]?.steps[0];
    (0, _globals.expect)(step?.winnerVariant).toBe('refiner');
    (0, _globals.expect)(report.results[0]?.command).toContain('/refiner');
    const expectedCalls = (plan.modules[0]?.steps.length ?? 0) * 2;
    (0, _globals.expect)(executor).toHaveBeenCalledTimes(expectedCalls);
  });
  (0, _globals.it)('halts when continueOnFailure is false and marks remaining modules as skipped', async () => {
    const executor = _globals.jest.fn(async input => {
      if (input.module.id === 'first') {
        return {
          success: false,
          summary: 'failed primary',
          execution: {
            success: false,
            output: 'failed',
            duration: 0,
            command: `${input.module.id}/${input.step.id}/${input.variant}`,
            error: 'failed'
          }
        };
      }
      return {
        success: true,
        summary: 'should not run',
        execution: {
          success: true,
          output: 'ok',
          duration: 0,
          command: `${input.module.id}/${input.step.id}/${input.variant}`
        }
      };
    });
    const orchestrator = new _repoUpgradeOrchestrator.RepoUpgradeOrchestrator(executor);
    const plan = makePlan(simpleModule('first'), simpleModule('second'));
    const report = await orchestrator.run(plan, {
      mode: 'single-continuous',
      continueOnFailure: false
    });
    (0, _globals.expect)(report.modules[0]?.status).toBe('failed');
    (0, _globals.expect)(report.modules[1]?.status).toBe('skipped');
    (0, _globals.expect)(executor).toHaveBeenCalledTimes(1);
    (0, _globals.expect)(report.results[0]?.success).toBe(false);
  });
});
(0, _globals.describe)('buildRepoWidePlan', () => {
  (0, _globals.it)('returns a fallback module when no known scopes exist', () => {
    const dir = (0, _nodeFs.mkdtempSync)((0, _nodePath.join)((0, _nodeOs.tmpdir)(), 'upgrade-fw-'));
    try {
      const plan = (0, _repoUpgradeOrchestrator.buildRepoWidePlan)(dir);
      (0, _globals.expect)(plan.modules).toHaveLength(1);
      (0, _globals.expect)(plan.modules[0]?.id).toBe('repo-wide');
    } finally {
      (0, _nodeFs.rmSync)(dir, {
        recursive: true,
        force: true
      });
    }
  });
  (0, _globals.it)('detects repo-specific scopes like skills/agents/examples and carries validation hints', () => {
    const dir = (0, _nodeFs.mkdtempSync)((0, _nodePath.join)((0, _nodeOs.tmpdir)(), 'upgrade-fw-'));
    try {
      (0, _nodeFs.mkdirSync)((0, _nodePath.join)(dir, 'src'));
      (0, _nodeFs.mkdirSync)((0, _nodePath.join)(dir, 'skills'));
      (0, _nodeFs.mkdirSync)((0, _nodePath.join)(dir, 'agents'));
      (0, _nodeFs.mkdirSync)((0, _nodePath.join)(dir, 'examples'));
      const plan = (0, _repoUpgradeOrchestrator.buildRepoWidePlan)(dir);
      const moduleIds = plan.modules.map(m => m.id);
      (0, _globals.expect)(moduleIds).toEqual(_globals.expect.arrayContaining(['source', 'skills', 'agents', 'examples']));
      const skillsModule = plan.modules.find(m => m.id === 'skills');
      (0, _globals.expect)(skillsModule?.validationCommands?.length).toBeGreaterThan(0);
    } finally {
      (0, _nodeFs.rmSync)(dir, {
        recursive: true,
        force: true
      });
    }
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbm9kZUZzIiwicmVxdWlyZSIsIl9ub2RlUGF0aCIsIl9ub2RlT3MiLCJfZ2xvYmFscyIsIl9yZXBvVXBncmFkZU9yY2hlc3RyYXRvciIsInNpbXBsZU1vZHVsZSIsImlkIiwibGFiZWwiLCJkZXNjcmlwdGlvbiIsInNjb3BlIiwic3RlcHMiLCJpbnRlbnQiLCJtYWtlUGxhbiIsIm1vZHVsZXMiLCJkZXNjcmliZSIsIml0IiwiY2FsbHMiLCJleGVjdXRvciIsImplc3QiLCJmbiIsImlucHV0IiwicHVzaCIsInN1Y2Nlc3MiLCJzdW1tYXJ5Iiwic3RlcCIsInZhcmlhbnQiLCJzY29yZSIsImV4ZWN1dGlvbiIsIm91dHB1dCIsImR1cmF0aW9uIiwiY29tbWFuZCIsIm1vZHVsZSIsIm9yY2hlc3RyYXRvciIsIlJlcG9VcGdyYWRlT3JjaGVzdHJhdG9yIiwicGxhbiIsInJlcG9ydCIsInJ1biIsIm1vZGUiLCJvYmplY3RpdmUiLCJleHBlY3QiLCJtYXAiLCJzIiwid2lubmVyVmFyaWFudCIsInRvRXF1YWwiLCJldmVyeSIsImNhbGwiLCJ0b0JlIiwicmVzdWx0cyIsInRvSGF2ZUxlbmd0aCIsImxlbmd0aCIsInJlc3VsdCIsImVuZHNXaXRoIiwidG9Db250YWluIiwiZXhwZWN0ZWRDYWxscyIsInRvSGF2ZUJlZW5DYWxsZWRUaW1lcyIsImVycm9yIiwiY29udGludWVPbkZhaWx1cmUiLCJzdGF0dXMiLCJkaXIiLCJta2R0ZW1wU3luYyIsImpvaW4iLCJ0bXBkaXIiLCJidWlsZFJlcG9XaWRlUGxhbiIsInJtU3luYyIsInJlY3Vyc2l2ZSIsImZvcmNlIiwibWtkaXJTeW5jIiwibW9kdWxlSWRzIiwibSIsImFycmF5Q29udGFpbmluZyIsInNraWxsc01vZHVsZSIsImZpbmQiLCJ2YWxpZGF0aW9uQ29tbWFuZHMiLCJ0b0JlR3JlYXRlclRoYW4iXSwic291cmNlcyI6WyJyZXBvVXBncmFkZU9yY2hlc3RyYXRvci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IG1rZHRlbXBTeW5jLCBta2RpclN5bmMsIHJtU3luYyB9IGZyb20gJ25vZGU6ZnMnO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ25vZGU6cGF0aCc7XG5pbXBvcnQgeyB0bXBkaXIgfSBmcm9tICdub2RlOm9zJztcbmltcG9ydCB7IGRlc2NyaWJlLCBleHBlY3QsIGl0LCBqZXN0IH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5pbXBvcnQge1xuICBSZXBvVXBncmFkZU9yY2hlc3RyYXRvcixcbiAgYnVpbGRSZXBvV2lkZVBsYW4sXG4gIHR5cGUgUmVwb1VwZ3JhZGVNb2R1bGUsXG4gIHR5cGUgUmVwb1VwZ3JhZGVQbGFuLFxuICB0eXBlIFVwZ3JhZGVTdGVwRXhlY3V0aW9uSW5wdXQsXG59IGZyb20gJy4uL3NyYy9jb3JlL3JlcG9VcGdyYWRlT3JjaGVzdHJhdG9yLmpzJztcblxuY29uc3Qgc2ltcGxlTW9kdWxlID0gKGlkOiBzdHJpbmcpOiBSZXBvVXBncmFkZU1vZHVsZSA9PiAoe1xuICBpZCxcbiAgbGFiZWw6IGlkLFxuICBkZXNjcmlwdGlvbjogYE1vZHVsZSAke2lkfWAsXG4gIHNjb3BlOiBbYCR7aWR9LyoqLypgXSxcbiAgc3RlcHM6IFtcbiAgICB7IGlkOiBgJHtpZH0tYW5hbHl6ZWAsIGludGVudDogJ2FuYWx5emUnLCBkZXNjcmlwdGlvbjogJ2FuYWx5emUnIH0sXG4gICAgeyBpZDogYCR7aWR9LXVwZ3JhZGVgLCBpbnRlbnQ6ICd1cGdyYWRlJywgZGVzY3JpcHRpb246ICd1cGdyYWRlJyB9LFxuICAgIHsgaWQ6IGAke2lkfS12ZXJpZnlgLCBpbnRlbnQ6ICd2ZXJpZnknLCBkZXNjcmlwdGlvbjogJ3ZlcmlmeScgfSxcbiAgXSxcbn0pO1xuXG5jb25zdCBtYWtlUGxhbiA9ICguLi5tb2R1bGVzOiBSZXBvVXBncmFkZU1vZHVsZVtdKTogUmVwb1VwZ3JhZGVQbGFuID0+ICh7IG1vZHVsZXMgfSk7XG5cbmRlc2NyaWJlKCdSZXBvVXBncmFkZU9yY2hlc3RyYXRvciAtIG1vZGVzJywgKCkgPT4ge1xuICBpdCgncnVucyBwcmltYXJ5IG9ubHkgaW4gc2luZ2xlLWNvbnRpbnVvdXMgbW9kZSBhbmQgcmVjb3JkcyB3aW5uaW5nIGV4ZWN1dGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgY2FsbHM6IFVwZ3JhZGVTdGVwRXhlY3V0aW9uSW5wdXRbXSA9IFtdO1xuICAgIGNvbnN0IGV4ZWN1dG9yID0gamVzdC5mbihhc3luYyAoaW5wdXQ6IFVwZ3JhZGVTdGVwRXhlY3V0aW9uSW5wdXQpID0+IHtcbiAgICAgIGNhbGxzLnB1c2goaW5wdXQpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgc3VtbWFyeTogYCR7aW5wdXQuc3RlcC5pZH0tJHtpbnB1dC52YXJpYW50fWAsXG4gICAgICAgIHNjb3JlOiBpbnB1dC52YXJpYW50ID09PSAncHJpbWFyeScgPyAwLjQgOiAwLjksXG4gICAgICAgIGV4ZWN1dGlvbjoge1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgb3V0cHV0OiAnb2snLFxuICAgICAgICAgIGR1cmF0aW9uOiAxLFxuICAgICAgICAgIGNvbW1hbmQ6IGAke2lucHV0Lm1vZHVsZS5pZH0vJHtpbnB1dC5zdGVwLmlkfS8ke2lucHV0LnZhcmlhbnR9YCxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfSk7XG5cbiAgICBjb25zdCBvcmNoZXN0cmF0b3IgPSBuZXcgUmVwb1VwZ3JhZGVPcmNoZXN0cmF0b3IoZXhlY3V0b3IpO1xuICAgIGNvbnN0IHBsYW4gPSBtYWtlUGxhbihzaW1wbGVNb2R1bGUoJ3NvdXJjZScpKTtcblxuICAgIGNvbnN0IHJlcG9ydCA9IGF3YWl0IG9yY2hlc3RyYXRvci5ydW4ocGxhbiwge1xuICAgICAgbW9kZTogJ3NpbmdsZS1jb250aW51b3VzJyxcbiAgICAgIG9iamVjdGl2ZTogJ3VwZ3JhZGUnLFxuICAgIH0pO1xuXG4gICAgZXhwZWN0KHJlcG9ydC5tb2R1bGVzWzBdPy5zdGVwcy5tYXAoKHMpID0+IHMud2lubmVyVmFyaWFudCkpLnRvRXF1YWwoWydwcmltYXJ5JywgJ3ByaW1hcnknLCAncHJpbWFyeSddKTtcbiAgICBleHBlY3QoY2FsbHMuZXZlcnkoKGNhbGwpID0+IGNhbGwudmFyaWFudCA9PT0gJ3ByaW1hcnknKSkudG9CZSh0cnVlKTtcbiAgICBleHBlY3QocmVwb3J0LnJlc3VsdHMpLnRvSGF2ZUxlbmd0aChwbGFuLm1vZHVsZXNbMF0/LnN0ZXBzLmxlbmd0aCA/PyAwKTtcbiAgICBleHBlY3QocmVwb3J0LnJlc3VsdHMuZXZlcnkoKHJlc3VsdCkgPT4gcmVzdWx0LmNvbW1hbmQ/LmVuZHNXaXRoKCcvcHJpbWFyeScpKSkudG9CZSh0cnVlKTtcbiAgfSk7XG5cbiAgaXQoJ3ByZWZlcnMgdGhlIHJlZmluZXIgcGF0aCBpbiBkdWFsLXJsLWNvbnRpbnVvdXMgbW9kZSB3aGVuIGl0IHNjb3JlcyBoaWdoZXInLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgZXhlY3V0b3IgPSBqZXN0LmZuKGFzeW5jIChpbnB1dDogVXBncmFkZVN0ZXBFeGVjdXRpb25JbnB1dCkgPT4ge1xuICAgICAgaWYgKGlucHV0LnZhcmlhbnQgPT09ICdwcmltYXJ5Jykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgc3VtbWFyeTogJ3ByaW1hcnkgdmVyc2lvbicsXG4gICAgICAgICAgc2NvcmU6IDAuMixcbiAgICAgICAgICBleGVjdXRpb246IHtcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgICBvdXRwdXQ6ICdwcmltYXJ5JyxcbiAgICAgICAgICAgIGR1cmF0aW9uOiAxLFxuICAgICAgICAgICAgY29tbWFuZDogYCR7aW5wdXQubW9kdWxlLmlkfS8ke2lucHV0LnN0ZXAuaWR9L3ByaW1hcnlgLFxuICAgICAgICAgIH0sXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBzdW1tYXJ5OiAncmVmaW5lciB3aW5zJyxcbiAgICAgICAgc2NvcmU6IDAuOSxcbiAgICAgICAgZXhlY3V0aW9uOiB7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICBvdXRwdXQ6ICdyZWZpbmVyJyxcbiAgICAgICAgICBkdXJhdGlvbjogMSxcbiAgICAgICAgICBjb21tYW5kOiBgJHtpbnB1dC5tb2R1bGUuaWR9LyR7aW5wdXQuc3RlcC5pZH0vcmVmaW5lcmAsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH0pO1xuXG4gICAgY29uc3Qgb3JjaGVzdHJhdG9yID0gbmV3IFJlcG9VcGdyYWRlT3JjaGVzdHJhdG9yKGV4ZWN1dG9yKTtcbiAgICBjb25zdCBwbGFuID0gbWFrZVBsYW4oc2ltcGxlTW9kdWxlKCdzcmMtb25seScpKTtcblxuICAgIGNvbnN0IHJlcG9ydCA9IGF3YWl0IG9yY2hlc3RyYXRvci5ydW4ocGxhbiwgeyBtb2RlOiAnZHVhbC1ybC1jb250aW51b3VzJyB9KTtcbiAgICBjb25zdCBzdGVwID0gcmVwb3J0Lm1vZHVsZXNbMF0/LnN0ZXBzWzBdO1xuXG4gICAgZXhwZWN0KHN0ZXA/Lndpbm5lclZhcmlhbnQpLnRvQmUoJ3JlZmluZXInKTtcbiAgICBleHBlY3QocmVwb3J0LnJlc3VsdHNbMF0/LmNvbW1hbmQpLnRvQ29udGFpbignL3JlZmluZXInKTtcbiAgICBjb25zdCBleHBlY3RlZENhbGxzID0gKHBsYW4ubW9kdWxlc1swXT8uc3RlcHMubGVuZ3RoID8/IDApICogMjtcbiAgICBleHBlY3QoZXhlY3V0b3IpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcyhleHBlY3RlZENhbGxzKTtcbiAgfSk7XG5cbiAgaXQoJ2hhbHRzIHdoZW4gY29udGludWVPbkZhaWx1cmUgaXMgZmFsc2UgYW5kIG1hcmtzIHJlbWFpbmluZyBtb2R1bGVzIGFzIHNraXBwZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgZXhlY3V0b3IgPSBqZXN0LmZuKGFzeW5jIChpbnB1dDogVXBncmFkZVN0ZXBFeGVjdXRpb25JbnB1dCkgPT4ge1xuICAgICAgaWYgKGlucHV0Lm1vZHVsZS5pZCA9PT0gJ2ZpcnN0Jykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIHN1bW1hcnk6ICdmYWlsZWQgcHJpbWFyeScsXG4gICAgICAgICAgZXhlY3V0aW9uOiB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIG91dHB1dDogJ2ZhaWxlZCcsXG4gICAgICAgICAgICBkdXJhdGlvbjogMCxcbiAgICAgICAgICAgIGNvbW1hbmQ6IGAke2lucHV0Lm1vZHVsZS5pZH0vJHtpbnB1dC5zdGVwLmlkfS8ke2lucHV0LnZhcmlhbnR9YCxcbiAgICAgICAgICAgIGVycm9yOiAnZmFpbGVkJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgc3VtbWFyeTogJ3Nob3VsZCBub3QgcnVuJyxcbiAgICAgICAgZXhlY3V0aW9uOiB7XG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICBvdXRwdXQ6ICdvaycsXG4gICAgICAgICAgZHVyYXRpb246IDAsXG4gICAgICAgICAgY29tbWFuZDogYCR7aW5wdXQubW9kdWxlLmlkfS8ke2lucHV0LnN0ZXAuaWR9LyR7aW5wdXQudmFyaWFudH1gLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9KTtcblxuICAgIGNvbnN0IG9yY2hlc3RyYXRvciA9IG5ldyBSZXBvVXBncmFkZU9yY2hlc3RyYXRvcihleGVjdXRvcik7XG4gICAgY29uc3QgcGxhbiA9IG1ha2VQbGFuKHNpbXBsZU1vZHVsZSgnZmlyc3QnKSwgc2ltcGxlTW9kdWxlKCdzZWNvbmQnKSk7XG5cbiAgICBjb25zdCByZXBvcnQgPSBhd2FpdCBvcmNoZXN0cmF0b3IucnVuKHBsYW4sIHtcbiAgICAgIG1vZGU6ICdzaW5nbGUtY29udGludW91cycsXG4gICAgICBjb250aW51ZU9uRmFpbHVyZTogZmFsc2UsXG4gICAgfSk7XG5cbiAgICBleHBlY3QocmVwb3J0Lm1vZHVsZXNbMF0/LnN0YXR1cykudG9CZSgnZmFpbGVkJyk7XG4gICAgZXhwZWN0KHJlcG9ydC5tb2R1bGVzWzFdPy5zdGF0dXMpLnRvQmUoJ3NraXBwZWQnKTtcbiAgICBleHBlY3QoZXhlY3V0b3IpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICBleHBlY3QocmVwb3J0LnJlc3VsdHNbMF0/LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnYnVpbGRSZXBvV2lkZVBsYW4nLCAoKSA9PiB7XG4gIGl0KCdyZXR1cm5zIGEgZmFsbGJhY2sgbW9kdWxlIHdoZW4gbm8ga25vd24gc2NvcGVzIGV4aXN0JywgKCkgPT4ge1xuICAgIGNvbnN0IGRpciA9IG1rZHRlbXBTeW5jKGpvaW4odG1wZGlyKCksICd1cGdyYWRlLWZ3LScpKTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcGxhbiA9IGJ1aWxkUmVwb1dpZGVQbGFuKGRpcik7XG4gICAgICBleHBlY3QocGxhbi5tb2R1bGVzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocGxhbi5tb2R1bGVzWzBdPy5pZCkudG9CZSgncmVwby13aWRlJyk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHJtU3luYyhkaXIsIHsgcmVjdXJzaXZlOiB0cnVlLCBmb3JjZTogdHJ1ZSB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIGl0KCdkZXRlY3RzIHJlcG8tc3BlY2lmaWMgc2NvcGVzIGxpa2Ugc2tpbGxzL2FnZW50cy9leGFtcGxlcyBhbmQgY2FycmllcyB2YWxpZGF0aW9uIGhpbnRzJywgKCkgPT4ge1xuICAgIGNvbnN0IGRpciA9IG1rZHRlbXBTeW5jKGpvaW4odG1wZGlyKCksICd1cGdyYWRlLWZ3LScpKTtcbiAgICB0cnkge1xuICAgICAgbWtkaXJTeW5jKGpvaW4oZGlyLCAnc3JjJykpO1xuICAgICAgbWtkaXJTeW5jKGpvaW4oZGlyLCAnc2tpbGxzJykpO1xuICAgICAgbWtkaXJTeW5jKGpvaW4oZGlyLCAnYWdlbnRzJykpO1xuICAgICAgbWtkaXJTeW5jKGpvaW4oZGlyLCAnZXhhbXBsZXMnKSk7XG5cbiAgICAgIGNvbnN0IHBsYW4gPSBidWlsZFJlcG9XaWRlUGxhbihkaXIpO1xuICAgICAgY29uc3QgbW9kdWxlSWRzID0gcGxhbi5tb2R1bGVzLm1hcCgobSkgPT4gbS5pZCk7XG5cbiAgICAgIGV4cGVjdChtb2R1bGVJZHMpLnRvRXF1YWwoZXhwZWN0LmFycmF5Q29udGFpbmluZyhbJ3NvdXJjZScsICdza2lsbHMnLCAnYWdlbnRzJywgJ2V4YW1wbGVzJ10pKTtcblxuICAgICAgY29uc3Qgc2tpbGxzTW9kdWxlID0gcGxhbi5tb2R1bGVzLmZpbmQoKG0pID0+IG0uaWQgPT09ICdza2lsbHMnKTtcbiAgICAgIGV4cGVjdChza2lsbHNNb2R1bGU/LnZhbGlkYXRpb25Db21tYW5kcz8ubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHJtU3luYyhkaXIsIHsgcmVjdXJzaXZlOiB0cnVlLCBmb3JjZTogdHJ1ZSB9KTtcbiAgICB9XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBQUEsT0FBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsU0FBQSxHQUFBRCxPQUFBO0FBQ0EsSUFBQUUsT0FBQSxHQUFBRixPQUFBO0FBQ0EsSUFBQUcsUUFBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksd0JBQUEsR0FBQUosT0FBQTtBQVFBLE1BQU1LLFlBQVksR0FBSUMsRUFBVSxLQUF5QjtFQUN2REEsRUFBRTtFQUNGQyxLQUFLLEVBQUVELEVBQUU7RUFDVEUsV0FBVyxFQUFFLFVBQVVGLEVBQUUsRUFBRTtFQUMzQkcsS0FBSyxFQUFFLENBQUMsR0FBR0gsRUFBRSxPQUFPLENBQUM7RUFDckJJLEtBQUssRUFBRSxD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