{"version":3,"names":["_globals","require","_interopRequireWildcard","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","hasProviderKey","Boolean","process","env","ANTHROPIC_API_KEY","OPENAI_API_KEY","GOOGLE_GENAI_API_KEY","realTestsEnabled","RUN_REAL_LLM_TESTS","parsePrompts","defaultPrompts","PROMPTS","parsed","JSON","parse","Array","isArray","every","p","map","trim","filter","describe","test","skip","jest","setTimeout","DEFAULT_PROMPTS","runFullFlow","validateFullFlow","Promise","resolve","then","prompts","result","profile","PROFILE","provider","PROVIDER","model","MODEL","sessionId","Date","now","requireReal","summary","minMessageChars","requireUsage","rejectSimulation","minEvents","requireRunCount","expect","completedRuns","toBe","length","runsWithUsage","toBeGreaterThanOrEqual","session","toBeTruthy","runs","toHaveLength","run","eventsSeen"],"sources":["realFullFlow.test.ts"],"sourcesContent":["/**\n * Real full-flow integration test.\n *\n * Uses the shared full-flow runner to drive the CLI with long-form,\n * human-style prompts and asserts that real provider usage and validated\n * completions occur. Only runs when RUN_REAL_LLM_TESTS=1 and a provider\n * key are present to avoid accidental live calls.\n */\n\nimport { describe, test, jest } from '@jest/globals';\n\nconst hasProviderKey =\n  Boolean(process.env.ANTHROPIC_API_KEY) ||\n  Boolean(process.env.OPENAI_API_KEY) ||\n  Boolean(process.env.GOOGLE_GENAI_API_KEY);\n\nconst realTestsEnabled = process.env.RUN_REAL_LLM_TESTS === '1' && hasProviderKey;\n\nfunction parsePrompts(defaultPrompts: string[]): string[] {\n  if (process.env.PROMPTS) {\n    try {\n      const parsed = JSON.parse(process.env.PROMPTS);\n      if (Array.isArray(parsed) && parsed.every((p) => typeof p === 'string')) {\n        return parsed.map((p) => p.trim()).filter(Boolean);\n      }\n    } catch {\n      // fall back to default prompts\n    }\n  }\n  return defaultPrompts;\n}\n\ndescribe('real full-flow CLI run', () => {\n  (realTestsEnabled ? test : test.skip)('completes long-form prompts end-to-end with validation', async () => {\n    jest.setTimeout(300_000); // allow up to 5 minutes for live provider\n\n    const { DEFAULT_PROMPTS, runFullFlow, validateFullFlow } = await import('../../scripts/full-flow-runner.js');\n    const prompts = parsePrompts(DEFAULT_PROMPTS);\n\n    const result = await runFullFlow({\n      prompts,\n      profile: process.env.PROFILE?.trim() || 'erosolar-code',\n      provider: process.env.PROVIDER?.trim(),\n      model: process.env.MODEL?.trim(),\n      sessionId: `real-flow-${Date.now()}`,\n      requireReal: true,\n    });\n\n    const summary = validateFullFlow(result, {\n      minMessageChars: 120,\n      requireUsage: true,\n      rejectSimulation: true,\n      minEvents: 2,\n      requireRunCount: true,\n    });\n\n    expect(summary.completedRuns).toBe(prompts.length);\n    expect(summary.runsWithUsage).toBeGreaterThanOrEqual(prompts.length);\n    expect(summary.session).toBeTruthy();\n    expect(result.runs).toHaveLength(prompts.length);\n    for (const run of result.runs) {\n      expect(run.eventsSeen).toBeGreaterThanOrEqual(2);\n    }\n  });\n});\n"],"mappings":"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","ignoreList":[]}