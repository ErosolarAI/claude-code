{"version":3,"names":["cov_migjsw7yx","actualCoverage","AgentSession","AgentHost","modules","s","Map","contributions","contributionOwners","moduleContributions","session","disposed","constructor","options","f","context","profile","workspaceContext","workingDir","env","b","process","toolObserver","refreshWorkspaceContext","loadModules","module","registerModule","assertMutable","removeModuleContributions","id","set","result","create","normalized","normalizeContributions","contribution","validateContribution","push","contributionSet","get","Set","add","getSession","toolSuites","collectToolSuites","describeCapabilities","map","moduleId","description","metadata","undefined","dispose","tasks","filter","fn","Promise","all","suites","seen","records","normalizeSuites","suite","has","Error","trim","ids","size","delete","index","findIndex","entry","splice","value","Array","isArray","toolSuite","length"],"sources":["agentHost.ts"],"sourcesContent":["import type { ProfileName } from '../config.js';\nimport { AgentSession, type AgentSessionOptions } from './agentSession.js';\nimport { type ToolRuntimeObserver, type ToolSuite } from '../core/toolRuntime.js';\n\nexport interface CapabilityContext {\n  profile: ProfileName;\n  workspaceContext: string | null;\n  workingDir: string;\n  env: NodeJS.ProcessEnv;\n}\n\nexport interface CapabilityContribution {\n  id: string;\n  description?: string;\n  toolSuite?: ToolSuite;\n  toolSuites?: ToolSuite[];\n  metadata?: Record<string, unknown>;\n  dispose?(): void | Promise<void>;\n}\n\nexport interface CapabilityModule {\n  id: string;\n  description?: string;\n  create(\n    context: CapabilityContext\n  ): CapabilityContribution | CapabilityContribution[] | null | undefined | Promise<CapabilityContribution | CapabilityContribution[] | null | undefined>;\n}\n\nexport interface CapabilityManifestEntry {\n  id: string;\n  moduleId: string;\n  description?: string;\n  metadata?: Record<string, unknown>;\n}\n\nexport interface AgentHostOptions {\n  profile: ProfileName;\n  workspaceContext: string | null;\n  workingDir: string;\n  modules?: CapabilityModule[];\n  toolObserver?: ToolRuntimeObserver;\n  env?: NodeJS.ProcessEnv;\n}\n\nexport class AgentHost {\n  private readonly context: CapabilityContext;\n  private readonly toolObserver?: ToolRuntimeObserver;\n  private readonly modules = new Map<string, CapabilityModule>();\n  private readonly contributions: CapabilityContribution[] = [];\n  private readonly contributionOwners = new Map<string, string>();\n  private readonly moduleContributions = new Map<string, Set<string>>();\n  private session: AgentSession | null = null;\n  private disposed = false;\n\n  constructor(options: AgentHostOptions) {\n    this.context = {\n      profile: options.profile,\n      workspaceContext: options.workspaceContext,\n      workingDir: options.workingDir,\n      env: options.env ? { ...options.env } : { ...process.env },\n    };\n    this.toolObserver = options.toolObserver;\n  }\n\n  get profile(): ProfileName {\n    return this.context.profile;\n  }\n\n  get workspaceContext(): string | null {\n    return this.context.workspaceContext ?? null;\n  }\n\n  get workingDir(): string {\n    return this.context.workingDir;\n  }\n\n  refreshWorkspaceContext(workspaceContext: string | null): void {\n    this.context.workspaceContext = workspaceContext;\n    this.session?.refreshWorkspaceContext(workspaceContext);\n  }\n\n  async loadModules(modules: CapabilityModule[]): Promise<void> {\n    for (const module of modules) {\n      await this.registerModule(module);\n    }\n  }\n\n  async registerModule(module: CapabilityModule): Promise<void> {\n    this.assertMutable();\n    this.removeModuleContributions(module.id);\n    this.modules.set(module.id, module);\n    const result = await module.create(this.context);\n    const normalized = normalizeContributions(result);\n    for (const contribution of normalized) {\n      this.validateContribution(contribution, module.id);\n      this.contributions.push(contribution);\n      this.contributionOwners.set(contribution.id, module.id);\n      const contributionSet = this.moduleContributions.get(module.id) ?? new Set<string>();\n      contributionSet.add(contribution.id);\n      this.moduleContributions.set(module.id, contributionSet);\n    }\n  }\n\n  async getSession(): Promise<AgentSession> {\n    if (this.session) {\n      return this.session;\n    }\n\n    const toolSuites = this.collectToolSuites();\n    this.session = new AgentSession({\n      profile: this.context.profile,\n      workspaceContext: this.context.workspaceContext,\n      toolSuites,\n      toolObserver: this.toolObserver,\n    } satisfies AgentSessionOptions);\n\n    return this.session;\n  }\n\n  describeCapabilities(): CapabilityManifestEntry[] {\n    return this.contributions.map((contribution) => ({\n      id: contribution.id,\n      moduleId: this.contributionOwners.get(contribution.id) ?? 'unknown',\n      description: contribution.description,\n      metadata: contribution.metadata ?? undefined,\n    }));\n  }\n\n  async dispose(): Promise<void> {\n    if (this.disposed) {\n      return;\n    }\n    this.disposed = true;\n    const tasks = this.contributions\n      .map((contribution) => contribution.dispose)\n      .filter((fn): fn is NonNullable<CapabilityContribution['dispose']> => typeof fn === 'function')\n      .map(async (dispose) => {\n        try {\n          await dispose();\n        } catch {\n          // Ignore disposal errors to avoid masking upstream teardown.\n        }\n      });\n    await Promise.all(tasks);\n  }\n\n  private collectToolSuites(): ToolSuite[] {\n    const suites: ToolSuite[] = [];\n    const seen = new Set<string>();\n    for (const contribution of this.contributions) {\n      const records = normalizeSuites(contribution);\n      for (const suite of records) {\n        if (seen.has(suite.id)) {\n          throw new Error(\n            `Duplicate tool suite id \"${suite.id}\" detected while composing capabilities. ` +\n              'Ensure every capability module emits unique suite identifiers.'\n          );\n        }\n        suites.push(suite);\n        seen.add(suite.id);\n      }\n    }\n    return suites;\n  }\n\n  private validateContribution(contribution: CapabilityContribution, moduleId: string): void {\n    if (!contribution?.id?.trim()) {\n      throw new Error(`Capability module \"${moduleId}\" emitted a contribution without an id.`);\n    }\n    const suites = normalizeSuites(contribution);\n    for (const suite of suites) {\n      if (!suite?.id?.trim()) {\n        throw new Error(\n          `Capability contribution \"${contribution.id}\" from module \"${moduleId}\" ` +\n            'emitted a tool suite without an id.'\n        );\n      }\n    }\n  }\n\n  private assertMutable(): void {\n    if (this.session) {\n      throw new Error(\n        'Cannot register an additional capability module after the runtime session has been created. ' +\n          'Instantiate AgentHost earlier in the boot sequence or create a new host instance.'\n      );\n    }\n  }\n\n  private removeModuleContributions(moduleId: string): void {\n    const ids = this.moduleContributions.get(moduleId);\n    if (!ids?.size) {\n      return;\n    }\n    this.moduleContributions.delete(moduleId);\n    for (const id of ids) {\n      const index = this.contributions.findIndex((entry) => entry.id === id);\n      if (index >= 0) {\n        this.contributions.splice(index, 1);\n      }\n      this.contributionOwners.delete(id);\n    }\n  }\n}\n\nfunction normalizeContributions(\n  value: CapabilityContribution | CapabilityContribution[] | null | undefined\n): CapabilityContribution[] {\n  if (!value) {\n    return [];\n  }\n  return Array.isArray(value) ? value : [value];\n}\n\nfunction normalizeSuites(contribution: CapabilityContribution): ToolSuite[] {\n  const suites: ToolSuite[] = [];\n  if (contribution.toolSuite) {\n    suites.push(contribution.toolSuite);\n  }\n  if (contribution.toolSuites?.length) {\n    suites.push(...contribution.toolSuites);\n  }\n  return suites;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}