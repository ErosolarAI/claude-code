6d3a25a054019cde3a1f2e08861c5996
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.RepoUpgradeOrchestrator = void 0;
exports.buildRepoWidePlan = buildRepoWidePlan;
var _nodeFs = require("node:fs");
var _nodePath = require("node:path");
var _unifiedOrchestrator = require("./unifiedOrchestrator.js");
/**
 * Build a repo-wide upgrade plan using common directories. Falls back to a single
 * catch-all module when no known scopes are found.
 */
function buildRepoWidePlan(workspaceRoot, additionalScopes = []) {
  const areas = [{
    id: 'source',
    label: 'Source',
    description: 'Core application and library code.',
    scope: ['src/**/*', 'lib/**/*'],
    candidates: ['src', 'lib']
  }, {
    id: 'tests',
    label: 'Tests',
    description: 'Unit, integration, and smoke tests.',
    scope: ['test/**/*', '__tests__/**/*'],
    candidates: ['test', '__tests__']
  }, {
    id: 'docs',
    label: 'Docs',
    description: 'Documentation and guides.',
    scope: ['docs/**/*', 'README.md'],
    candidates: ['docs', 'README.md']
  }, {
    id: 'scripts',
    label: 'Tooling Scripts',
    description: 'Build, migration, and maintenance scripts.',
    scope: ['scripts/**/*'],
    candidates: ['scripts']
  }];
  for (const extra of additionalScopes) {
    if (!extra?.trim()) continue;
    const slug = extra.replace(/[^\w]/g, '-').toLowerCase() || 'custom';
    areas.push({
      id: `custom-${slug}`,
      label: `Custom: ${extra}`,
      description: `User-specified scope: ${extra}`,
      scope: [`${extra}/**/*`],
      candidates: [extra]
    });
  }
  const modules = [];
  for (const area of areas) {
    const matches = area.candidates.some(candidate => (0, _nodeFs.existsSync)((0, _nodePath.join)(workspaceRoot, candidate)));
    if (!matches) {
      continue;
    }
    modules.push({
      id: area.id,
      label: area.label,
      description: area.description,
      scope: area.scope,
      steps: buildDefaultSteps(area.id)
    });
  }
  if (modules.length === 0) {
    modules.push({
      id: 'repo-wide',
      label: 'Repository',
      description: 'Fallback repo-wide upgrade module.',
      scope: ['**/*'],
      steps: buildDefaultSteps('repo')
    });
  }
  return {
    modules
  };
}
class RepoUpgradeOrchestrator extends _unifiedOrchestrator.UnifiedOrchestrator {
  constructor(executor) {
    super();
    this.executor = executor;
  }

  /**
   * Execute the repo-wide plan using either single continuous or dual RL continuous mode.
   */
  async run(plan, options) {
    const mode = options.mode;
    const continueOnFailure = options.continueOnFailure ?? true;
    const objective = options.objective ?? 'Repository-wide source code upgrade';

    // Reset state per run to keep reports clean
    this.results = [];
    this.findings = [];
    const moduleReports = [];
    let halted = false;
    for (const module of plan.modules) {
      if (halted) {
        moduleReports.push({
          id: module.id,
          label: module.label,
          scope: module.scope,
          steps: [],
          status: 'skipped'
        });
        continue;
      }
      this.emit({
        type: 'upgrade.module.start',
        timestamp: Date.now(),
        data: {
          moduleId: module.id,
          label: module.label,
          scope: module.scope,
          mode
        }
      });
      const moduleReport = {
        id: module.id,
        label: module.label,
        scope: module.scope,
        steps: [],
        status: 'completed'
      };
      for (const step of module.steps) {
        const outcome = await this.runStep(module, step, mode);
        moduleReport.steps.push(outcome);
        if (!outcome.winner.success) {
          moduleReport.status = 'failed';
          if (!continueOnFailure) {
            halted = true;
            break;
          }
        }
      }
      moduleReports.push(moduleReport);
      this.emit({
        type: 'upgrade.module.complete',
        timestamp: Date.now(),
        data: {
          moduleId: module.id,
          status: moduleReport.status
        }
      });
    }
    const baseReport = this.generateReport(objective);
    return {
      ...baseReport,
      mode,
      continueOnFailure,
      modules: moduleReports
    };
  }
  async runStep(module, step, mode) {
    this.emit({
      type: 'upgrade.step.start',
      timestamp: Date.now(),
      data: {
        moduleId: module.id,
        stepId: step.id,
        variant: 'primary'
      }
    });
    const primary = await this.executor({
      module,
      step,
      mode,
      variant: 'primary'
    });
    const refiner = mode === 'dual-rl-continuous' ? await this.executor({
      module,
      step,
      mode,
      variant: 'refiner',
      previousResult: primary
    }) : undefined;
    const {
      winner,
      winnerVariant
    } = this.pickWinner(primary, refiner);
    this.recordOutcomeArtifacts(module, step, winner, winnerVariant);
    this.emit({
      type: 'upgrade.step.complete',
      timestamp: Date.now(),
      data: {
        moduleId: module.id,
        stepId: step.id,
        variant: winnerVariant,
        success: winner.success
      }
    });
    return {
      stepId: step.id,
      intent: step.intent,
      description: step.description,
      primary,
      refiner,
      winner,
      winnerVariant,
      status: winner.success ? 'completed' : 'failed'
    };
  }
  pickWinner(primary, refiner) {
    if (!refiner) {
      return {
        winner: primary,
        winnerVariant: 'primary'
      };
    }
    if (refiner.success && !primary.success) {
      return {
        winner: refiner,
        winnerVariant: 'refiner'
      };
    }
    if (primary.success && !refiner.success) {
      return {
        winner: primary,
        winnerVariant: 'primary'
      };
    }
    const primaryScore = typeof primary.score === 'number' ? primary.score : 0;
    const refinerScore = typeof refiner.score === 'number' ? refiner.score : 0;
    if (refinerScore > primaryScore) {
      return {
        winner: refiner,
        winnerVariant: 'refiner'
      };
    }
    if (primaryScore > refinerScore) {
      return {
        winner: primary,
        winnerVariant: 'primary'
      };
    }

    // Tie breaker: prefer refiner to encourage RL exploration
    return {
      winner: refiner,
      winnerVariant: 'refiner'
    };
  }
  recordOutcomeArtifacts(module, step, result, variant) {
    if (result.findings?.length) {
      this.findings.push(...result.findings);
    }
    const execution = result.execution ?? {
      success: result.success,
      output: result.summary,
      duration: result.durationMs ?? 0,
      command: `${module.id}/${step.id}/${variant}`,
      error: result.success ? undefined : result.detail ?? result.summary
    };

    // Ensure we only track a single winner record per step to keep reports clean
    this.results.push(execution);
  }
}
exports.RepoUpgradeOrchestrator = RepoUpgradeOrchestrator;
function buildDefaultSteps(moduleId) {
  return [{
    id: `${moduleId}-analyze`,
    intent: 'analyze',
    description: `Map the upgrade surface for ${moduleId}. Identify risky files and coupling.`,
    prompt: 'Inventory files, dependencies, and breaking-change areas before upgrading.'
  }, {
    id: `${moduleId}-upgrade`,
    intent: 'upgrade',
    description: `Apply modular upgrades for ${moduleId} with minimal blast radius.`,
    prompt: 'Execute codemods or targeted edits. Keep edits small, atomic, and well scoped.'
  }, {
    id: `${moduleId}-verify`,
    intent: 'verify',
    description: `Validate ${moduleId} after the upgrade.`,
    prompt: 'Run tests/lint/health checks relevant to this scope. Summarize residual risks.'
  }];
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbm9kZUZzIiwicmVxdWlyZSIsIl9ub2RlUGF0aCIsIl91bmlmaWVkT3JjaGVzdHJhdG9yIiwiYnVpbGRSZXBvV2lkZVBsYW4iLCJ3b3Jrc3BhY2VSb290IiwiYWRkaXRpb25hbFNjb3BlcyIsImFyZWFzIiwiaWQiLCJsYWJlbCIsImRlc2NyaXB0aW9uIiwic2NvcGUiLCJjYW5kaWRhdGVzIiwiZXh0cmEiLCJ0cmltIiwic2x1ZyIsInJlcGxhY2UiLCJ0b0xvd2VyQ2FzZSIsInB1c2giLCJtb2R1bGVzIiwiYXJlYSIsIm1hdGNoZXMiLCJzb21lIiwiY2FuZGlkYXRlIiwiZXhpc3RzU3luYyIsImpvaW4iLCJzdGVwcyIsImJ1aWxkRGVmYXVsdFN0ZXBzIiwibGVuZ3RoIiwiUmVwb1VwZ3JhZGVPcmNoZXN0cmF0b3IiLCJVbmlmaWVkT3JjaGVzdHJhdG9yIiwiY29uc3RydWN0b3IiLCJleGVjdXRvciIsInJ1biIsInBsYW4iLCJvcHRpb25zIiwibW9kZSIsImNvbnRpbnVlT25GYWlsdXJlIiwib2JqZWN0aXZlIiwicmVzdWx0cyIsImZpbmRpbmdzIiwibW9kdWxlUmVwb3J0cyIsImhhbHRlZCIsIm1vZHVsZSIsInN0YXR1cyIsImVtaXQiLCJ0eXBlIiwidGltZXN0YW1wIiwiRGF0ZSIsIm5vdyIsImRhdGEiLCJtb2R1bGVJZCIsIm1vZHVsZVJlcG9ydCIsInN0ZXAiLCJvdXRjb21lIiwicnVuU3RlcCIsIndpbm5lciIsInN1Y2Nlc3MiLCJiYXNlUmVwb3J0IiwiZ2VuZXJhdGVSZXBvcnQiLCJzdGVwSWQiLCJ2YXJpYW50IiwicHJpbWFyeSIsInJlZmluZXIiLCJwcmV2aW91c1Jlc3VsdCIsInVuZGVmaW5lZCIsIndpbm5lclZhcmlhbnQiLCJwaWNrV2lubmVyIiwicmVjb3JkT3V0Y29tZUFydGlmYWN0cyIsImludGVudCIsInByaW1hcnlTY29yZSIsInNjb3JlIiwicmVmaW5lclNjb3JlIiwicmVzdWx0IiwiZXhlY3V0aW9uIiwib3V0cHV0Iiwic3VtbWFyeSIsImR1cmF0aW9uIiwiZHVyYXRpb25NcyIsImNvbW1hbmQiLCJlcnJvciIsImRldGFpbCIsImV4cG9ydHMiLCJwcm9tcHQiXSwic291cmNlcyI6WyJyZXBvVXBncmFkZU9yY2hlc3RyYXRvci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBleGlzdHNTeW5jIH0gZnJvbSAnbm9kZTpmcyc7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAnbm9kZTpwYXRoJztcbmltcG9ydCB7IFVuaWZpZWRPcmNoZXN0cmF0b3IsIHR5cGUgRXhlY3V0aW9uUmVzdWx0LCB0eXBlIEZpbmRpbmcsIHR5cGUgT3BlcmF0aW9uUmVwb3J0IH0gZnJvbSAnLi91bmlmaWVkT3JjaGVzdHJhdG9yLmpzJztcblxuZXhwb3J0IHR5cGUgUmVwb1VwZ3JhZGVNb2RlID0gJ3NpbmdsZS1jb250aW51b3VzJyB8ICdkdWFsLXJsLWNvbnRpbnVvdXMnO1xuXG5leHBvcnQgdHlwZSBVcGdyYWRlU3RlcEludGVudCA9ICdhbmFseXplJyB8ICd1cGdyYWRlJyB8ICd2ZXJpZnknIHwgJ2NsZWFudXAnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFJlcG9VcGdyYWRlU3RlcCB7XG4gIGlkOiBzdHJpbmc7XG4gIGludGVudDogVXBncmFkZVN0ZXBJbnRlbnQ7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIC8qKiBPcHRpb25hbCBpbnN0cnVjdGlvbiBvciBwcm9tcHQgdG8gZmVlZCBpbnRvIHRoZSBleGVjdXRvciAqL1xuICBwcm9tcHQ/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVwb1VwZ3JhZGVNb2R1bGUge1xuICBpZDogc3RyaW5nO1xuICBsYWJlbDogc3RyaW5nO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBzY29wZTogc3RyaW5nW107XG4gIHN0ZXBzOiBSZXBvVXBncmFkZVN0ZXBbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSZXBvVXBncmFkZVBsYW4ge1xuICBtb2R1bGVzOiBSZXBvVXBncmFkZU1vZHVsZVtdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZ3JhZGVTdGVwRXhlY3V0aW9uSW5wdXQge1xuICBtb2R1bGU6IFJlcG9VcGdyYWRlTW9kdWxlO1xuICBzdGVwOiBSZXBvVXBncmFkZVN0ZXA7XG4gIC8qKiBXaGljaCBwYXRoIHdlIGFyZSB0YWtpbmc6IHNpbmdsZS1wYXNzIHByaW1hcnkgb3IgdGhlIGR1YWwgUkwgcmVmaW5lciAqL1xuICB2YXJpYW50OiAncHJpbWFyeScgfCAncmVmaW5lcic7XG4gIG1vZGU6IFJlcG9VcGdyYWRlTW9kZTtcbiAgcHJldmlvdXNSZXN1bHQ/OiBVcGdyYWRlU3RlcFJlc3VsdDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGdyYWRlU3RlcFJlc3VsdCB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIHN1bW1hcnk6IHN0cmluZztcbiAgZGV0YWlsPzogc3RyaW5nO1xuICBzY29yZT86IG51bWJlcjtcbiAgZHVyYXRpb25Ncz86IG51bWJlcjtcbiAgZXhlY3V0aW9uPzogRXhlY3V0aW9uUmVzdWx0O1xuICBmaW5kaW5ncz86IEZpbmRpbmdbXTtcbiAgbm90ZXM/OiBzdHJpbmdbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGdyYWRlU3RlcE91dGNvbWUge1xuICBzdGVwSWQ6IHN0cmluZztcbiAgaW50ZW50OiBVcGdyYWRlU3RlcEludGVudDtcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgcHJpbWFyeTogVXBncmFkZVN0ZXBSZXN1bHQ7XG4gIHJlZmluZXI/OiBVcGdyYWRlU3RlcFJlc3VsdDtcbiAgd2lubmVyOiBVcGdyYWRlU3RlcFJlc3VsdDtcbiAgd2lubmVyVmFyaWFudDogJ3ByaW1hcnknIHwgJ3JlZmluZXInO1xuICBzdGF0dXM6ICdjb21wbGV0ZWQnIHwgJ2ZhaWxlZCc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBncmFkZU1vZHVsZVJlcG9ydCB7XG4gIGlkOiBzdHJpbmc7XG4gIGxhYmVsOiBzdHJpbmc7XG4gIHNjb3BlOiBzdHJpbmdbXTtcbiAgc3RlcHM6IFVwZ3JhZGVTdGVwT3V0Y29tZVtdO1xuICBzdGF0dXM6ICdjb21wbGV0ZWQnIHwgJ2ZhaWxlZCcgfCAnc2tpcHBlZCc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVwb1VwZ3JhZGVSZXBvcnQgZXh0ZW5kcyBPcGVyYXRpb25SZXBvcnQge1xuICBtb2RlOiBSZXBvVXBncmFkZU1vZGU7XG4gIGNvbnRpbnVlT25GYWlsdXJlOiBib29sZWFuO1xuICBtb2R1bGVzOiBVcGdyYWRlTW9kdWxlUmVwb3J0W107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVwb1VwZ3JhZGVSdW5PcHRpb25zIHtcbiAgb2JqZWN0aXZlPzogc3RyaW5nO1xuICBtb2RlOiBSZXBvVXBncmFkZU1vZGU7XG4gIGNvbnRpbnVlT25GYWlsdXJlPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IHR5cGUgVXBncmFkZVN0ZXBFeGVjdXRvciA9IChpbnB1dDogVXBncmFkZVN0ZXBFeGVjdXRpb25JbnB1dCkgPT4gUHJvbWlzZTxVcGdyYWRlU3RlcFJlc3VsdD47XG5cbi8qKlxuICogQnVpbGQgYSByZXBvLXdpZGUgdXBncmFkZSBwbGFuIHVzaW5nIGNvbW1vbiBkaXJlY3Rvcmllcy4gRmFsbHMgYmFjayB0byBhIHNpbmdsZVxuICogY2F0Y2gtYWxsIG1vZHVsZSB3aGVuIG5vIGtub3duIHNjb3BlcyBhcmUgZm91bmQuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBidWlsZFJlcG9XaWRlUGxhbih3b3Jrc3BhY2VSb290OiBzdHJpbmcsIGFkZGl0aW9uYWxTY29wZXM6IHN0cmluZ1tdID0gW10pOiBSZXBvVXBncmFkZVBsYW4ge1xuICBjb25zdCBhcmVhczogQXJyYXk8eyBpZDogc3RyaW5nOyBsYWJlbDogc3RyaW5nOyBkZXNjcmlwdGlvbjogc3RyaW5nOyBzY29wZTogc3RyaW5nW107IGNhbmRpZGF0ZXM6IHN0cmluZ1tdIH0+ID0gW1xuICAgIHtcbiAgICAgIGlkOiAnc291cmNlJyxcbiAgICAgIGxhYmVsOiAnU291cmNlJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnQ29yZSBhcHBsaWNhdGlvbiBhbmQgbGlicmFyeSBjb2RlLicsXG4gICAgICBzY29wZTogWydzcmMvKiovKicsICdsaWIvKiovKiddLFxuICAgICAgY2FuZGlkYXRlczogWydzcmMnLCAnbGliJ10sXG4gICAgfSxcbiAgICB7XG4gICAgICBpZDogJ3Rlc3RzJyxcbiAgICAgIGxhYmVsOiAnVGVzdHMnLFxuICAgICAgZGVzY3JpcHRpb246ICdVbml0LCBpbnRlZ3JhdGlvbiwgYW5kIHNtb2tlIHRlc3RzLicsXG4gICAgICBzY29wZTogWyd0ZXN0LyoqLyonLCAnX190ZXN0c19fLyoqLyonXSxcbiAgICAgIGNhbmRpZGF0ZXM6IFsndGVzdCcsICdfX3Rlc3RzX18nXSxcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiAnZG9jcycsXG4gICAgICBsYWJlbDogJ0RvY3MnLFxuICAgICAgZGVzY3JpcHRpb246ICdEb2N1bWVudGF0aW9uIGFuZCBndWlkZXMuJyxcbiAgICAgIHNjb3BlOiBbJ2RvY3MvKiovKicsICdSRUFETUUubWQnXSxcbiAgICAgIGNhbmRpZGF0ZXM6IFsnZG9jcycsICdSRUFETUUubWQnXSxcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiAnc2NyaXB0cycsXG4gICAgICBsYWJlbDogJ1Rvb2xpbmcgU2NyaXB0cycsXG4gICAgICBkZXNjcmlwdGlvbjogJ0J1aWxkLCBtaWdyYXRpb24sIGFuZCBtYWludGVuYW5jZSBzY3JpcHRzLicsXG4gICAgICBzY29wZTogWydzY3JpcHRzLyoqLyonXSxcbiAgICAgIGNhbmRpZGF0ZXM6IFsnc2NyaXB0cyddLFxuICAgIH0sXG4gIF07XG5cbiAgZm9yIChjb25zdCBleHRyYSBvZiBhZGRpdGlvbmFsU2NvcGVzKSB7XG4gICAgaWYgKCFleHRyYT8udHJpbSgpKSBjb250aW51ZTtcbiAgICBjb25zdCBzbHVnID0gZXh0cmEucmVwbGFjZSgvW15cXHddL2csICctJykudG9Mb3dlckNhc2UoKSB8fCAnY3VzdG9tJztcbiAgICBhcmVhcy5wdXNoKHtcbiAgICAgIGlkOiBgY3VzdG9tLSR7c2x1Z31gLFxuICAgICAgbGFiZWw6IGBDdXN0b206ICR7ZXh0cmF9YCxcbiAgICAgIGRlc2NyaXB0aW9uOiBgVXNlci1zcGVjaWZpZWQgc2NvcGU6ICR7ZXh0cmF9YCxcbiAgICAgIHNjb3BlOiBbYCR7ZXh0cmF9LyoqLypgXSxcbiAgICAgIGNhbmRpZGF0ZXM6IFtleHRyYV0sXG4gICAgfSk7XG4gIH1cblxuICBjb25zdCBtb2R1bGVzOiBSZXBvVXBncmFkZU1vZHVsZVtdID0gW107XG5cbiAgZm9yIChjb25zdCBhcmVhIG9mIGFyZWFzKSB7XG4gICAgY29uc3QgbWF0Y2hlcyA9IGFyZWEuY2FuZGlkYXRlcy5zb21lKChjYW5kaWRhdGUpID0+IGV4aXN0c1N5bmMoam9pbih3b3Jrc3BhY2VSb290LCBjYW5kaWRhdGUpKSk7XG4gICAgaWYgKCFtYXRjaGVzKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgbW9kdWxlcy5wdXNoKHtcbiAgICAgIGlkOiBhcmVhLmlkLFxuICAgICAgbGFiZWw6IGFyZWEubGFiZWwsXG4gICAgICBkZXNjcmlwdGlvbjogYXJlYS5kZXNjcmlwdGlvbixcbiAgICAgIHNjb3BlOiBhcmVhLnNjb3BlLFxuICAgICAgc3RlcHM6IGJ1aWxkRGVmYXVsdFN0ZXBzKGFyZWEuaWQpLFxuICAgIH0pO1xuICB9XG5cbiAgaWYgKG1vZHVsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgbW9kdWxlcy5wdXNoKHtcbiAgICAgIGlkOiAncmVwby13aWRlJyxcbiAgICAgIGxhYmVsOiAnUmVwb3NpdG9yeScsXG4gICAgICBkZXNjcmlwdGlvbjogJ0ZhbGxiYWNrIHJlcG8td2lkZSB1cGdyYWRlIG1vZHVsZS4nLFxuICAgICAgc2NvcGU6IFsnKiovKiddLFxuICAgICAgc3RlcHM6IGJ1aWxkRGVmYXVsdFN0ZXBzKCdyZXBvJyksXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4geyBtb2R1bGVzIH07XG59XG5cbmV4cG9ydCBjbGFzcyBSZXBvVXBncmFkZU9yY2hlc3RyYXRvciBleHRlbmRzIFVuaWZpZWRPcmNoZXN0cmF0b3Ige1xuICBwcml2YXRlIHJlYWRvbmx5IGV4ZWN1dG9yOiBVcGdyYWRlU3RlcEV4ZWN1dG9yO1xuXG4gIGNvbnN0cnVjdG9yKGV4ZWN1dG9yOiBVcGdyYWRlU3RlcEV4ZWN1dG9yKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmV4ZWN1dG9yID0gZXhlY3V0b3I7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSB0aGUgcmVwby13aWRlIHBsYW4gdXNpbmcgZWl0aGVyIHNpbmdsZSBjb250aW51b3VzIG9yIGR1YWwgUkwgY29udGludW91cyBtb2RlLlxuICAgKi9cbiAgYXN5bmMgcnVuKHBsYW46IFJlcG9VcGdyYWRlUGxhbiwgb3B0aW9uczogUmVwb1VwZ3JhZGVSdW5PcHRpb25zKTogUHJvbWlzZTxSZXBvVXBncmFkZVJlcG9ydD4ge1xuICAgIGNvbnN0IG1vZGUgPSBvcHRpb25zLm1vZGU7XG4gICAgY29uc3QgY29udGludWVPbkZhaWx1cmUgPSBvcHRpb25zLmNvbnRpbnVlT25GYWlsdXJlID8/IHRydWU7XG4gICAgY29uc3Qgb2JqZWN0aXZlID0gb3B0aW9ucy5vYmplY3RpdmUgPz8gJ1JlcG9zaXRvcnktd2lkZSBzb3VyY2UgY29kZSB1cGdyYWRlJztcblxuICAgIC8vIFJlc2V0IHN0YXRlIHBlciBydW4gdG8ga2VlcCByZXBvcnRzIGNsZWFuXG4gICAgdGhpcy5yZXN1bHRzID0gW107XG4gICAgdGhpcy5maW5kaW5ncyA9IFtdO1xuXG4gICAgY29uc3QgbW9kdWxlUmVwb3J0czogVXBncmFkZU1vZHVsZVJlcG9ydFtdID0gW107XG4gICAgbGV0IGhhbHRlZCA9IGZhbHNlO1xuXG4gICAgZm9yIChjb25zdCBtb2R1bGUgb2YgcGxhbi5tb2R1bGVzKSB7XG4gICAgICBpZiAoaGFsdGVkKSB7XG4gICAgICAgIG1vZHVsZVJlcG9ydHMucHVzaCh7XG4gICAgICAgICAgaWQ6IG1vZHVsZS5pZCxcbiAgICAgICAgICBsYWJlbDogbW9kdWxlLmxhYmVsLFxuICAgICAgICAgIHNjb3BlOiBtb2R1bGUuc2NvcGUsXG4gICAgICAgICAgc3RlcHM6IFtdLFxuICAgICAgICAgIHN0YXR1czogJ3NraXBwZWQnLFxuICAgICAgICB9KTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuZW1pdCh7XG4gICAgICAgIHR5cGU6ICd1cGdyYWRlLm1vZHVsZS5zdGFydCcsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgZGF0YTogeyBtb2R1bGVJZDogbW9kdWxlLmlkLCBsYWJlbDogbW9kdWxlLmxhYmVsLCBzY29wZTogbW9kdWxlLnNjb3BlLCBtb2RlIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgbW9kdWxlUmVwb3J0OiBVcGdyYWRlTW9kdWxlUmVwb3J0ID0ge1xuICAgICAgICBpZDogbW9kdWxlLmlkLFxuICAgICAgICBsYWJlbDogbW9kdWxlLmxhYmVsLFxuICAgICAgICBzY29wZTogbW9kdWxlLnNjb3BlLFxuICAgICAgICBzdGVwczogW10sXG4gICAgICAgIHN0YXR1czogJ2NvbXBsZXRlZCcsXG4gICAgICB9O1xuXG4gICAgICBmb3IgKGNvbnN0IHN0ZXAgb2YgbW9kdWxlLnN0ZXBzKSB7XG4gICAgICAgIGNvbnN0IG91dGNvbWUgPSBhd2FpdCB0aGlzLnJ1blN0ZXAobW9kdWxlLCBzdGVwLCBtb2RlKTtcbiAgICAgICAgbW9kdWxlUmVwb3J0LnN0ZXBzLnB1c2gob3V0Y29tZSk7XG5cbiAgICAgICAgaWYgKCFvdXRjb21lLndpbm5lci5zdWNjZXNzKSB7XG4gICAgICAgICAgbW9kdWxlUmVwb3J0LnN0YXR1cyA9ICdmYWlsZWQnO1xuICAgICAgICAgIGlmICghY29udGludWVPbkZhaWx1cmUpIHtcbiAgICAgICAgICAgIGhhbHRlZCA9IHRydWU7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgbW9kdWxlUmVwb3J0cy5wdXNoKG1vZHVsZVJlcG9ydCk7XG5cbiAgICAgIHRoaXMuZW1pdCh7XG4gICAgICAgIHR5cGU6ICd1cGdyYWRlLm1vZHVsZS5jb21wbGV0ZScsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgZGF0YTogeyBtb2R1bGVJZDogbW9kdWxlLmlkLCBzdGF0dXM6IG1vZHVsZVJlcG9ydC5zdGF0dXMgfSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IGJhc2VSZXBvcnQgPSB0aGlzLmdlbmVyYXRlUmVwb3J0KG9iamVjdGl2ZSk7XG4gICAgcmV0dXJuIHsgLi4uYmFzZVJlcG9ydCwgbW9kZSwgY29udGludWVPbkZhaWx1cmUsIG1vZHVsZXM6IG1vZHVsZVJlcG9ydHMgfTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcnVuU3RlcChcbiAgICBtb2R1bGU6IFJlcG9VcGdyYWRlTW9kdWxlLFxuICAgIHN0ZXA6IFJlcG9VcGdyYWRlU3RlcCxcbiAgICBtb2RlOiBSZXBvVXBncmFkZU1vZGVcbiAgKTogUHJvbWlzZTxVcGdyYWRlU3RlcE91dGNvbWU+IHtcbiAgICB0aGlzLmVtaXQoe1xuICAgICAgdHlwZTogJ3VwZ3JhZGUuc3RlcC5zdGFydCcsXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICBkYXRhOiB7IG1vZHVsZUlkOiBtb2R1bGUuaWQsIHN0ZXBJZDogc3RlcC5pZCwgdmFyaWFudDogJ3ByaW1hcnknIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBwcmltYXJ5ID0gYXdhaXQgdGhpcy5leGVjdXRvcih7IG1vZHVsZSwgc3RlcCwgbW9kZSwgdmFyaWFudDogJ3ByaW1hcnknIH0pO1xuICAgIGNvbnN0IHJlZmluZXIgPVxuICAgICAgbW9kZSA9PT0gJ2R1YWwtcmwtY29udGludW91cydcbiAgICAgICAgPyBhd2FpdCB0aGlzLmV4ZWN1dG9yKHsgbW9kdWxlLCBzdGVwLCBtb2RlLCB2YXJpYW50OiAncmVmaW5lcicsIHByZXZpb3VzUmVzdWx0OiBwcmltYXJ5IH0pXG4gICAgICAgIDogdW5kZWZpbmVkO1xuXG4gICAgY29uc3QgeyB3aW5uZXIsIHdpbm5lclZhcmlhbnQgfSA9IHRoaXMucGlja1dpbm5lcihwcmltYXJ5LCByZWZpbmVyKTtcbiAgICB0aGlzLnJlY29yZE91dGNvbWVBcnRpZmFjdHMobW9kdWxlLCBzdGVwLCB3aW5uZXIsIHdpbm5lclZhcmlhbnQpO1xuXG4gICAgdGhpcy5lbWl0KHtcbiAgICAgIHR5cGU6ICd1cGdyYWRlLnN0ZXAuY29tcGxldGUnLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgZGF0YTogeyBtb2R1bGVJZDogbW9kdWxlLmlkLCBzdGVwSWQ6IHN0ZXAuaWQsIHZhcmlhbnQ6IHdpbm5lclZhcmlhbnQsIHN1Y2Nlc3M6IHdpbm5lci5zdWNjZXNzIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3RlcElkOiBzdGVwLmlkLFxuICAgICAgaW50ZW50OiBzdGVwLmludGVudCxcbiAgICAgIGRlc2NyaXB0aW9uOiBzdGVwLmRlc2NyaXB0aW9uLFxuICAgICAgcHJpbWFyeSxcbiAgICAgIHJlZmluZXIsXG4gICAgICB3aW5uZXIsXG4gICAgICB3aW5uZXJWYXJpYW50LFxuICAgICAgc3RhdHVzOiB3aW5uZXIuc3VjY2VzcyA/ICdjb21wbGV0ZWQnIDogJ2ZhaWxlZCcsXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgcGlja1dpbm5lcihcbiAgICBwcmltYXJ5OiBVcGdyYWRlU3RlcFJlc3VsdCxcbiAgICByZWZpbmVyPzogVXBncmFkZVN0ZXBSZXN1bHRcbiAgKTogeyB3aW5uZXI6IFVwZ3JhZGVTdGVwUmVzdWx0OyB3aW5uZXJWYXJpYW50OiAncHJpbWFyeScgfCAncmVmaW5lcicgfSB7XG4gICAgaWYgKCFyZWZpbmVyKSB7XG4gICAgICByZXR1cm4geyB3aW5uZXI6IHByaW1hcnksIHdpbm5lclZhcmlhbnQ6ICdwcmltYXJ5JyB9O1xuICAgIH1cblxuICAgIGlmIChyZWZpbmVyLnN1Y2Nlc3MgJiYgIXByaW1hcnkuc3VjY2Vzcykge1xuICAgICAgcmV0dXJuIHsgd2lubmVyOiByZWZpbmVyLCB3aW5uZXJWYXJpYW50OiAncmVmaW5lcicgfTtcbiAgICB9XG4gICAgaWYgKHByaW1hcnkuc3VjY2VzcyAmJiAhcmVmaW5lci5zdWNjZXNzKSB7XG4gICAgICByZXR1cm4geyB3aW5uZXI6IHByaW1hcnksIHdpbm5lclZhcmlhbnQ6ICdwcmltYXJ5JyB9O1xuICAgIH1cblxuICAgIGNvbnN0IHByaW1hcnlTY29yZSA9IHR5cGVvZiBwcmltYXJ5LnNjb3JlID09PSAnbnVtYmVyJyA/IHByaW1hcnkuc2NvcmUgOiAwO1xuICAgIGNvbnN0IHJlZmluZXJTY29yZSA9IHR5cGVvZiByZWZpbmVyLnNjb3JlID09PSAnbnVtYmVyJyA/IHJlZmluZXIuc2NvcmUgOiAwO1xuXG4gICAgaWYgKHJlZmluZXJTY29yZSA+IHByaW1hcnlTY29yZSkge1xuICAgICAgcmV0dXJuIHsgd2lubmVyOiByZWZpbmVyLCB3aW5uZXJWYXJpYW50OiAncmVmaW5lcicgfTtcbiAgICB9XG4gICAgaWYgKHByaW1hcnlTY29yZSA+IHJlZmluZXJTY29yZSkge1xuICAgICAgcmV0dXJuIHsgd2lubmVyOiBwcmltYXJ5LCB3aW5uZXJWYXJpYW50OiAncHJpbWFyeScgfTtcbiAgICB9XG5cbiAgICAvLyBUaWUgYnJlYWtlcjogcHJlZmVyIHJlZmluZXIgdG8gZW5jb3VyYWdlIFJMIGV4cGxvcmF0aW9uXG4gICAgcmV0dXJuIHsgd2lubmVyOiByZWZpbmVyLCB3aW5uZXJWYXJpYW50OiAncmVmaW5lcicgfTtcbiAgfVxuXG4gIHByaXZhdGUgcmVjb3JkT3V0Y29tZUFydGlmYWN0cyhcbiAgICBtb2R1bGU6IFJlcG9VcGdyYWRlTW9kdWxlLFxuICAgIHN0ZXA6IFJlcG9VcGdyYWRlU3RlcCxcbiAgICByZXN1bHQ6IFVwZ3JhZGVTdGVwUmVzdWx0LFxuICAgIHZhcmlhbnQ6ICdwcmltYXJ5JyB8ICdyZWZpbmVyJ1xuICApOiB2b2lkIHtcbiAgICBpZiAocmVzdWx0LmZpbmRpbmdzPy5sZW5ndGgpIHtcbiAgICAgIHRoaXMuZmluZGluZ3MucHVzaCguLi5yZXN1bHQuZmluZGluZ3MpO1xuICAgIH1cblxuICAgIGNvbnN0IGV4ZWN1dGlvbjogRXhlY3V0aW9uUmVzdWx0ID0gcmVzdWx0LmV4ZWN1dGlvbiA/PyB7XG4gICAgICBzdWNjZXNzOiByZXN1bHQuc3VjY2VzcyxcbiAgICAgIG91dHB1dDogcmVzdWx0LnN1bW1hcnksXG4gICAgICBkdXJhdGlvbjogcmVzdWx0LmR1cmF0aW9uTXMgPz8gMCxcbiAgICAgIGNvbW1hbmQ6IGAke21vZHVsZS5pZH0vJHtzdGVwLmlkfS8ke3ZhcmlhbnR9YCxcbiAgICAgIGVycm9yOiByZXN1bHQuc3VjY2VzcyA/IHVuZGVmaW5lZCA6IHJlc3VsdC5kZXRhaWwgPz8gcmVzdWx0LnN1bW1hcnksXG4gICAgfTtcblxuICAgIC8vIEVuc3VyZSB3ZSBvbmx5IHRyYWNrIGEgc2luZ2xlIHdpbm5lciByZWNvcmQgcGVyIHN0ZXAgdG8ga2VlcCByZXBvcnRzIGNsZWFuXG4gICAgdGhpcy5yZXN1bHRzLnB1c2goZXhlY3V0aW9uKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBidWlsZERlZmF1bHRTdGVwcyhtb2R1bGVJZDogc3RyaW5nKTogUmVwb1VwZ3JhZGVTdGVwW10ge1xuICByZXR1cm4gW1xuICAgIHtcbiAgICAgIGlkOiBgJHttb2R1bGVJZH0tYW5hbHl6ZWAsXG4gICAgICBpbnRlbnQ6ICdhbmFseXplJyxcbiAgICAgIGRlc2NyaXB0aW9uOiBgTWFwIHRoZSB1cGdyYWRlIHN1cmZhY2UgZm9yICR7bW9kdWxlSWR9LiBJZGVudGlmeSByaXNreSBmaWxlcyBhbmQgY291cGxpbmcuYCxcbiAgICAgIHByb21wdDogJ0ludmVudG9yeSBmaWxlcywgZGVwZW5kZW5jaWVzLCBhbmQgYnJlYWtpbmctY2hhbmdlIGFyZWFzIGJlZm9yZSB1cGdyYWRpbmcuJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiBgJHttb2R1bGVJZH0tdXBncmFkZWAsXG4gICAgICBpbnRlbnQ6ICd1cGdyYWRlJyxcbiAgICAgIGRlc2NyaXB0aW9uOiBgQXBwbHkgbW9kdWxhciB1cGdyYWRlcyBmb3IgJHttb2R1bGVJZH0gd2l0aCBtaW5pbWFsIGJsYXN0IHJhZGl1cy5gLFxuICAgICAgcHJvbXB0OiAnRXhlY3V0ZSBjb2RlbW9kcyBvciB0YXJnZXRlZCBlZGl0cy4gS2VlcCBlZGl0cyBzbWFsbCwgYXRvbWljLCBhbmQgd2VsbCBzY29wZWQuJyxcbiAgICB9LFxuICAgIHtcbiAgICAgIGlkOiBgJHttb2R1bGVJZH0tdmVyaWZ5YCxcbiAgICAgIGludGVudDogJ3ZlcmlmeScsXG4gICAgICBkZXNjcmlwdGlvbjogYFZhbGlkYXRlICR7bW9kdWxlSWR9IGFmdGVyIHRoZSB1cGdyYWRlLmAsXG4gICAgICBwcm9tcHQ6ICdSdW4gdGVzdHMvbGludC9oZWFsdGggY2hlY2tzIHJlbGV2YW50IHRvIHRoaXMgc2NvcGUuIFN1bW1hcml6ZSByZXNpZHVhbCByaXNrcy4nLFxuICAgIH0sXG4gIF07XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQSxJQUFBQSxPQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxTQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxvQkFBQSxHQUFBRixPQUFBO0FBK0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ08sU0FBU0csaUJBQWlCQSxDQUFDQyxhQUFxQixFQUFFQyxnQkFBMEIsR0FBRyxFQUFFLEVBQW1CO0VBQ3pHLE1BQU1DLEtBQXVHLEdBQUcsQ0FDOUc7SUFDRUMsRUFBRSxFQUFFLFFBQVE7SUFDWkMsS0FBSyxFQUFFLFFBQVE7SUFDZkMsV0FBVyxFQUFFLG9DQUFvQztJQUNqREMsS0FBSyxFQUFFLENBQUMsVUFBVSxFQUFFLFVBQVUsQ0FBQztJQUMvQkMsVUFBVSxFQUFFLENBQUMsS0FBSyxFQUFFLEtBQUs7RUFDM0IsQ0FBQyxFQUNEO0lBQ0VKLEVBQUUsRUFBRSxPQUFPO0lBQ1hDLEtB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