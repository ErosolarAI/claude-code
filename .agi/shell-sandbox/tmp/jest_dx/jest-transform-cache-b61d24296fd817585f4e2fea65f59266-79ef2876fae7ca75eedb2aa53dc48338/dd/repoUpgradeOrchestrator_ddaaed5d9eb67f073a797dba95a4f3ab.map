{"version":3,"names":["_nodeFs","require","_nodePath","_unifiedOrchestrator","buildRepoWidePlan","workspaceRoot","additionalScopes","areas","id","label","description","scope","candidates","extra","trim","slug","replace","toLowerCase","push","modules","area","matches","some","candidate","existsSync","join","steps","buildDefaultSteps","length","RepoUpgradeOrchestrator","UnifiedOrchestrator","constructor","executor","run","plan","options","mode","continueOnFailure","objective","results","findings","moduleReports","halted","module","status","emit","type","timestamp","Date","now","data","moduleId","moduleReport","step","outcome","runStep","winner","success","baseReport","generateReport","stepId","variant","primary","refiner","previousResult","undefined","winnerVariant","pickWinner","recordOutcomeArtifacts","intent","primaryScore","score","refinerScore","result","execution","output","summary","duration","durationMs","command","error","detail","exports","prompt"],"sources":["repoUpgradeOrchestrator.ts"],"sourcesContent":["import { existsSync } from 'node:fs';\nimport { join } from 'node:path';\nimport { UnifiedOrchestrator, type ExecutionResult, type Finding, type OperationReport } from './unifiedOrchestrator.js';\n\nexport type RepoUpgradeMode = 'single-continuous' | 'dual-rl-continuous';\n\nexport type UpgradeStepIntent = 'analyze' | 'upgrade' | 'verify' | 'cleanup';\n\nexport interface RepoUpgradeStep {\n  id: string;\n  intent: UpgradeStepIntent;\n  description: string;\n  /** Optional instruction or prompt to feed into the executor */\n  prompt?: string;\n}\n\nexport interface RepoUpgradeModule {\n  id: string;\n  label: string;\n  description: string;\n  scope: string[];\n  steps: RepoUpgradeStep[];\n}\n\nexport interface RepoUpgradePlan {\n  modules: RepoUpgradeModule[];\n}\n\nexport interface UpgradeStepExecutionInput {\n  module: RepoUpgradeModule;\n  step: RepoUpgradeStep;\n  /** Which path we are taking: single-pass primary or the dual RL refiner */\n  variant: 'primary' | 'refiner';\n  mode: RepoUpgradeMode;\n  previousResult?: UpgradeStepResult;\n}\n\nexport interface UpgradeStepResult {\n  success: boolean;\n  summary: string;\n  detail?: string;\n  score?: number;\n  durationMs?: number;\n  execution?: ExecutionResult;\n  findings?: Finding[];\n  notes?: string[];\n}\n\nexport interface UpgradeStepOutcome {\n  stepId: string;\n  intent: UpgradeStepIntent;\n  description: string;\n  primary: UpgradeStepResult;\n  refiner?: UpgradeStepResult;\n  winner: UpgradeStepResult;\n  winnerVariant: 'primary' | 'refiner';\n  status: 'completed' | 'failed';\n}\n\nexport interface UpgradeModuleReport {\n  id: string;\n  label: string;\n  scope: string[];\n  steps: UpgradeStepOutcome[];\n  status: 'completed' | 'failed' | 'skipped';\n}\n\nexport interface RepoUpgradeReport extends OperationReport {\n  mode: RepoUpgradeMode;\n  continueOnFailure: boolean;\n  modules: UpgradeModuleReport[];\n}\n\nexport interface RepoUpgradeRunOptions {\n  objective?: string;\n  mode: RepoUpgradeMode;\n  continueOnFailure?: boolean;\n}\n\nexport type UpgradeStepExecutor = (input: UpgradeStepExecutionInput) => Promise<UpgradeStepResult>;\n\n/**\n * Build a repo-wide upgrade plan using common directories. Falls back to a single\n * catch-all module when no known scopes are found.\n */\nexport function buildRepoWidePlan(workspaceRoot: string, additionalScopes: string[] = []): RepoUpgradePlan {\n  const areas: Array<{ id: string; label: string; description: string; scope: string[]; candidates: string[] }> = [\n    {\n      id: 'source',\n      label: 'Source',\n      description: 'Core application and library code.',\n      scope: ['src/**/*', 'lib/**/*'],\n      candidates: ['src', 'lib'],\n    },\n    {\n      id: 'tests',\n      label: 'Tests',\n      description: 'Unit, integration, and smoke tests.',\n      scope: ['test/**/*', '__tests__/**/*'],\n      candidates: ['test', '__tests__'],\n    },\n    {\n      id: 'docs',\n      label: 'Docs',\n      description: 'Documentation and guides.',\n      scope: ['docs/**/*', 'README.md'],\n      candidates: ['docs', 'README.md'],\n    },\n    {\n      id: 'scripts',\n      label: 'Tooling Scripts',\n      description: 'Build, migration, and maintenance scripts.',\n      scope: ['scripts/**/*'],\n      candidates: ['scripts'],\n    },\n  ];\n\n  for (const extra of additionalScopes) {\n    if (!extra?.trim()) continue;\n    const slug = extra.replace(/[^\\w]/g, '-').toLowerCase() || 'custom';\n    areas.push({\n      id: `custom-${slug}`,\n      label: `Custom: ${extra}`,\n      description: `User-specified scope: ${extra}`,\n      scope: [`${extra}/**/*`],\n      candidates: [extra],\n    });\n  }\n\n  const modules: RepoUpgradeModule[] = [];\n\n  for (const area of areas) {\n    const matches = area.candidates.some((candidate) => existsSync(join(workspaceRoot, candidate)));\n    if (!matches) {\n      continue;\n    }\n    modules.push({\n      id: area.id,\n      label: area.label,\n      description: area.description,\n      scope: area.scope,\n      steps: buildDefaultSteps(area.id),\n    });\n  }\n\n  if (modules.length === 0) {\n    modules.push({\n      id: 'repo-wide',\n      label: 'Repository',\n      description: 'Fallback repo-wide upgrade module.',\n      scope: ['**/*'],\n      steps: buildDefaultSteps('repo'),\n    });\n  }\n\n  return { modules };\n}\n\nexport class RepoUpgradeOrchestrator extends UnifiedOrchestrator {\n  private readonly executor: UpgradeStepExecutor;\n\n  constructor(executor: UpgradeStepExecutor) {\n    super();\n    this.executor = executor;\n  }\n\n  /**\n   * Execute the repo-wide plan using either single continuous or dual RL continuous mode.\n   */\n  async run(plan: RepoUpgradePlan, options: RepoUpgradeRunOptions): Promise<RepoUpgradeReport> {\n    const mode = options.mode;\n    const continueOnFailure = options.continueOnFailure ?? true;\n    const objective = options.objective ?? 'Repository-wide source code upgrade';\n\n    // Reset state per run to keep reports clean\n    this.results = [];\n    this.findings = [];\n\n    const moduleReports: UpgradeModuleReport[] = [];\n    let halted = false;\n\n    for (const module of plan.modules) {\n      if (halted) {\n        moduleReports.push({\n          id: module.id,\n          label: module.label,\n          scope: module.scope,\n          steps: [],\n          status: 'skipped',\n        });\n        continue;\n      }\n\n      this.emit({\n        type: 'upgrade.module.start',\n        timestamp: Date.now(),\n        data: { moduleId: module.id, label: module.label, scope: module.scope, mode },\n      });\n\n      const moduleReport: UpgradeModuleReport = {\n        id: module.id,\n        label: module.label,\n        scope: module.scope,\n        steps: [],\n        status: 'completed',\n      };\n\n      for (const step of module.steps) {\n        const outcome = await this.runStep(module, step, mode);\n        moduleReport.steps.push(outcome);\n\n        if (!outcome.winner.success) {\n          moduleReport.status = 'failed';\n          if (!continueOnFailure) {\n            halted = true;\n            break;\n          }\n        }\n      }\n\n      moduleReports.push(moduleReport);\n\n      this.emit({\n        type: 'upgrade.module.complete',\n        timestamp: Date.now(),\n        data: { moduleId: module.id, status: moduleReport.status },\n      });\n    }\n\n    const baseReport = this.generateReport(objective);\n    return { ...baseReport, mode, continueOnFailure, modules: moduleReports };\n  }\n\n  private async runStep(\n    module: RepoUpgradeModule,\n    step: RepoUpgradeStep,\n    mode: RepoUpgradeMode\n  ): Promise<UpgradeStepOutcome> {\n    this.emit({\n      type: 'upgrade.step.start',\n      timestamp: Date.now(),\n      data: { moduleId: module.id, stepId: step.id, variant: 'primary' },\n    });\n\n    const primary = await this.executor({ module, step, mode, variant: 'primary' });\n    const refiner =\n      mode === 'dual-rl-continuous'\n        ? await this.executor({ module, step, mode, variant: 'refiner', previousResult: primary })\n        : undefined;\n\n    const { winner, winnerVariant } = this.pickWinner(primary, refiner);\n    this.recordOutcomeArtifacts(module, step, winner, winnerVariant);\n\n    this.emit({\n      type: 'upgrade.step.complete',\n      timestamp: Date.now(),\n      data: { moduleId: module.id, stepId: step.id, variant: winnerVariant, success: winner.success },\n    });\n\n    return {\n      stepId: step.id,\n      intent: step.intent,\n      description: step.description,\n      primary,\n      refiner,\n      winner,\n      winnerVariant,\n      status: winner.success ? 'completed' : 'failed',\n    };\n  }\n\n  private pickWinner(\n    primary: UpgradeStepResult,\n    refiner?: UpgradeStepResult\n  ): { winner: UpgradeStepResult; winnerVariant: 'primary' | 'refiner' } {\n    if (!refiner) {\n      return { winner: primary, winnerVariant: 'primary' };\n    }\n\n    if (refiner.success && !primary.success) {\n      return { winner: refiner, winnerVariant: 'refiner' };\n    }\n    if (primary.success && !refiner.success) {\n      return { winner: primary, winnerVariant: 'primary' };\n    }\n\n    const primaryScore = typeof primary.score === 'number' ? primary.score : 0;\n    const refinerScore = typeof refiner.score === 'number' ? refiner.score : 0;\n\n    if (refinerScore > primaryScore) {\n      return { winner: refiner, winnerVariant: 'refiner' };\n    }\n    if (primaryScore > refinerScore) {\n      return { winner: primary, winnerVariant: 'primary' };\n    }\n\n    // Tie breaker: prefer refiner to encourage RL exploration\n    return { winner: refiner, winnerVariant: 'refiner' };\n  }\n\n  private recordOutcomeArtifacts(\n    module: RepoUpgradeModule,\n    step: RepoUpgradeStep,\n    result: UpgradeStepResult,\n    variant: 'primary' | 'refiner'\n  ): void {\n    if (result.findings?.length) {\n      this.findings.push(...result.findings);\n    }\n\n    const execution: ExecutionResult = result.execution ?? {\n      success: result.success,\n      output: result.summary,\n      duration: result.durationMs ?? 0,\n      command: `${module.id}/${step.id}/${variant}`,\n      error: result.success ? undefined : result.detail ?? result.summary,\n    };\n\n    // Ensure we only track a single winner record per step to keep reports clean\n    this.results.push(execution);\n  }\n}\n\nfunction buildDefaultSteps(moduleId: string): RepoUpgradeStep[] {\n  return [\n    {\n      id: `${moduleId}-analyze`,\n      intent: 'analyze',\n      description: `Map the upgrade surface for ${moduleId}. Identify risky files and coupling.`,\n      prompt: 'Inventory files, dependencies, and breaking-change areas before upgrading.',\n    },\n    {\n      id: `${moduleId}-upgrade`,\n      intent: 'upgrade',\n      description: `Apply modular upgrades for ${moduleId} with minimal blast radius.`,\n      prompt: 'Execute codemods or targeted edits. Keep edits small, atomic, and well scoped.',\n    },\n    {\n      id: `${moduleId}-verify`,\n      intent: 'verify',\n      description: `Validate ${moduleId} after the upgrade.`,\n      prompt: 'Run tests/lint/health checks relevant to this scope. Summarize residual risks.',\n    },\n  ];\n}\n"],"mappings":"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","ignoreList":[]}