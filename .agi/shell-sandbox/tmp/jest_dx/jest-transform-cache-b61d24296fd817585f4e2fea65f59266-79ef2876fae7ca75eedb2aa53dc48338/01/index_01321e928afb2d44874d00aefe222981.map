{"version":3,"names":["cov_gc4d24hpc","actualCoverage","OpenAIChatCompletionsProvider","registerProvider","withProviderResilience","registered","s","registerDeepSeekProviderPlugin","f","b","config","baseProvider","apiKey","requireEnv","model","baseURL","providerId","timeout","maxRetries","temperature","maxTokens","maxRequestsPerMinute","baseDelayMs","maxDelayMs","enableCircuitBreaker","circuitBreakerThreshold","circuitBreakerResetMs","name","value","process","env","Error"],"sources":["index.ts"],"sourcesContent":["import { OpenAIChatCompletionsProvider } from '../../../providers/openaiChatCompletionsProvider.js';\nimport { registerProvider } from '../../../providers/providerFactory.js';\nimport { withProviderResilience } from '../../../providers/resilientProvider.js';\n\nlet registered = false;\n\n/**\n * DeepSeek Provider Plugin\n *\n * Registers the DeepSeek provider with hardened error handling for:\n * - Network failures (premature close, connection reset)\n * - Stream errors (gunzip, decompression failures)\n * - Rate limiting with exponential backoff\n * - Circuit breaker for cascading failure prevention\n */\nexport function registerDeepSeekProviderPlugin(): void {\n  if (registered) {\n    return;\n  }\n\n  registerProvider('deepseek', (config) => {\n    const baseProvider = new OpenAIChatCompletionsProvider({\n      apiKey: requireEnv('DEEPSEEK_API_KEY'),\n      model: config.model,\n      baseURL: 'https://api.deepseek.com',\n      providerId: 'deepseek',\n      // DeepSeek can be slower, use longer timeout\n      timeout: 180000, // 3 minutes\n      // Built-in retries at provider level\n      maxRetries: 3,\n      ...(typeof config.temperature === 'number' ? { temperature: config.temperature } : {}),\n      ...(typeof config.maxTokens === 'number' ? { maxTokens: config.maxTokens } : {}),\n    });\n\n    // Wrap with resilience layer for additional protection\n    return withProviderResilience(baseProvider, 'deepseek', {\n      // DeepSeek has lower rate limits\n      maxRequestsPerMinute: 30,\n      // More aggressive retries for DeepSeek's connection issues\n      maxRetries: 5,\n      baseDelayMs: 2000,\n      maxDelayMs: 60000,\n      // Enable circuit breaker to prevent cascading failures\n      enableCircuitBreaker: true,\n      circuitBreakerThreshold: 5,\n      circuitBreakerResetMs: 120000, // 2 minutes\n    });\n  });\n\n  registered = true;\n}\n\nfunction requireEnv(name: string): string {\n  const value = process.env[name];\n  if (!value) {\n    throw new Error(`Missing required environment variable ${name}.`);\n  }\n  return value;\n}\n"],"mappings":"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","ignoreList":[]}