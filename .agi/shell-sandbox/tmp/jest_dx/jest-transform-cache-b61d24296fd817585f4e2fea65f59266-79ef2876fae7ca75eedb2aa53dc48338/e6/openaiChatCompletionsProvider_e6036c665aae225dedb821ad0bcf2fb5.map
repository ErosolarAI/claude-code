{"version":3,"names":["cov_lg9ox1nuu","actualCoverage","OpenAI","sanitizeErrorMessage","safeErrorMessage","logDebug","REQUEST_CHAR_LIMIT","s","RECOVERABLE_ERROR_PATTERNS","ProviderStreamError","Error","constructor","message","providerId","originalError","isRetryable","b","f","name","stack","isRecoverableError","error","toLowerCase","errorName","errorCode","code","allText","some","pattern","includes","OpenAIChatCompletionsProvider","options","clientConfig","apiKey","timeout","maxRetries","baseURL","client","id","model","temperature","undefined","maxTokens","Math","max","sleep","ms","Promise","resolve","setTimeout","getBackoffDelay","attempt","baseDelay","maxDelay","delay","min","pow","random","executeWithRetry","operation","operationName","lastError","String","round","generate","messages","tools","boundedMessages","enforceRequestSizeLimit","request","mapMessages","length","map","mapTool","tool_choice","parallel_tool_calls","stream","max_tokens","completion","result","chat","completions","create","assertHasChoices","apiError","status","choice","choices","usage","mapUsage","type","content","toolCalls","tool_calls","mapToolCall","parseError","extractMessageContent","generateStream","response","Symbol","asyncIterator","pendingToolCalls","Map","chunk","delta","reasoning","extractTextContent","toolCallDelta","idx","index","has","set","function","arguments","pending","get","finish_reason","toolCall","parsed","JSON","parse","recovered","tryRecoverMalformedJson","inputTokens","prompt_tokens","outputTokens","completion_tokens","totalTokens","total_tokens","cachedModelInfo","getModelInfo","modelInfo","models","retrieve","rawInfo","contextWindow","maxOutputTokens","inputTokenLimit","outputTokenLimit","isDeepSeekModel","normalized","isGrokModel","isLocalReasoningModel","supportsReasoningContent","sanitizeMessageSequence","sanitized","pendingToolCallIds","Set","role","tc","add","push","toolCallId","delete","slice","clear","sanitizedMessages","params","includeReasoningContent","assistantMessage","call","stringify","reasoning_content","tool_call_id","definition","parameters","properties","description","strict","truncated","trimmed","size","estimateMessageChars","removeIdx","findIndex","msg","splice","unshift","total","Array","isArray","part","text","trim","refusal","isFunctionToolCall","isCustomToolCall","rawArgs","funcName","custom","input","sanitizedArgs","raw","attempts","pairs","matchAll","match","key","strVal","numVal","boolVal","parseFloat","parseInt","Object","keys","nestedContent","join"],"sources":["openaiChatCompletionsProvider.ts"],"sourcesContent":["import OpenAI from 'openai';\nimport type {\n  ChatCompletion,\n  ChatCompletionMessageParam,\n  ChatCompletionMessageToolCall,\n  ChatCompletionMessageFunctionToolCall,\n  ChatCompletionMessageCustomToolCall,\n  ChatCompletionTool,\n} from 'openai/resources/chat/completions.js';\nimport type { FunctionDefinition } from 'openai/resources/shared.js';\nimport type {\n  ConversationMessage,\n  LLMProvider,\n  ProviderId,\n  ProviderModelInfo,\n  ProviderResponse,\n  ProviderToolDefinition,\n  ToolCallRequest,\n  ProviderUsage,\n  StreamChunk,\n} from '../core/types.js';\nimport { sanitizeErrorMessage, safeErrorMessage } from '../core/secretStore.js';\nimport { logDebug } from '../utils/debugLogger.js';\n\nconst REQUEST_CHAR_LIMIT = 800_000; // Hard cap to avoid provider 413 errors\n\n// ============================================================================\n// Stream/Fetch Error Types for Detection\n// ============================================================================\n\n/**\n * Error types that indicate stream or network failures that should be retried\n */\nconst RECOVERABLE_ERROR_PATTERNS = [\n  'premature close',\n  'premature end',\n  'unexpected end',\n  'aborted',\n  'fetcherror',\n  'invalid response body',\n  'gunzip',\n  'decompress',\n  'econnreset',\n  'econnrefused',\n  'epipe',\n  'socket hang up',\n  'network',\n  'timeout',\n] as const;\n\n/**\n * Custom error class for provider-specific failures\n */\nexport class ProviderStreamError extends Error {\n  readonly isRetryable: boolean;\n  readonly originalError?: Error;\n  readonly providerId: string;\n\n  constructor(message: string, providerId: string, originalError?: Error, isRetryable = true) {\n    // SECURITY: Sanitize the error message to prevent token leakage\n    super(sanitizeErrorMessage(message));\n    this.name = 'ProviderStreamError';\n    this.providerId = providerId;\n    this.originalError = originalError;\n    this.isRetryable = isRetryable;\n\n    // SECURITY: Sanitize stack trace to prevent token leakage\n    if (originalError?.stack) {\n      this.stack = `${this.stack}\\nCaused by: ${sanitizeErrorMessage(originalError.stack)}`;\n    }\n  }\n}\n\n/**\n * Check if an error is recoverable (should be retried)\n */\nfunction isRecoverableError(error: unknown): boolean {\n  if (!(error instanceof Error)) return false;\n\n  const message = error.message.toLowerCase();\n  const errorName = error.name?.toLowerCase() ?? '';\n  const errorCode = (error as { code?: string }).code?.toLowerCase() ?? '';\n\n  // Check all sources for recoverable patterns\n  const allText = `${message} ${errorName} ${errorCode}`;\n\n  return RECOVERABLE_ERROR_PATTERNS.some(pattern => allText.includes(pattern));\n}\n\n// ============================================================================\n// Provider Configuration\n// ============================================================================\n\ninterface OpenAIChatCompletionsOptions {\n  apiKey: string;\n  model: string;\n  providerId?: ProviderId;\n  baseURL?: string;\n  /** Request timeout in milliseconds (default: 120000) */\n  timeout?: number;\n  /** Maximum retries for transient errors (default: 3) */\n  maxRetries?: number;\n  /** Optional temperature override */\n  temperature?: number;\n  /** Maximum completion tokens to request (default: 4096 to avoid runaway outputs) */\n  maxTokens?: number;\n}\n\ntype ChatCompletionsResult = Awaited<ReturnType<OpenAI['chat']['completions']['create']>>;\n\nexport class OpenAIChatCompletionsProvider implements LLMProvider {\n  readonly id: ProviderId;\n  readonly model: string;\n  private readonly client: OpenAI;\n  private readonly maxRetries: number;\n  private readonly temperature?: number;\n  private readonly maxTokens: number;\n  constructor(options: OpenAIChatCompletionsOptions) {\n    const clientConfig: ConstructorParameters<typeof OpenAI>[0] = {\n      apiKey: options.apiKey,\n      timeout: options.timeout ?? 120000,\n      maxRetries: 0, // We handle retries ourselves for better control\n    };\n\n    if (options.baseURL) {\n      clientConfig.baseURL = options.baseURL;\n    }\n\n    this.client = new OpenAI(clientConfig);\n    this.id = options.providerId ?? 'openai';\n    this.model = options.model;\n    this.maxRetries = options.maxRetries ?? 3;\n    this.temperature = typeof options.temperature === 'number' ? options.temperature : undefined;\n    this.maxTokens = Math.max(1, options.maxTokens ?? 4096);\n  }\n\n  /**\n   * Sleep for a given number of milliseconds\n   */\n  private sleep(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  /**\n   * Calculate exponential backoff delay\n   */\n  private getBackoffDelay(attempt: number, baseDelay = 1000, maxDelay = 30000): number {\n    const delay = Math.min(baseDelay * Math.pow(2, attempt), maxDelay);\n    // Add jitter to prevent thundering herd\n    return delay + Math.random() * delay * 0.1;\n  }\n\n  /**\n   * Execute request with retry logic for transient errors\n   */\n  private async executeWithRetry<T>(\n    operation: () => Promise<T>,\n    operationName: string\n  ): Promise<T> {\n    let lastError: Error | undefined;\n\n    for (let attempt = 0; attempt <= this.maxRetries; attempt++) {\n      try {\n        return await operation();\n      } catch (error) {\n        lastError = error instanceof Error ? error : new Error(String(error));\n\n        // Check if this is a recoverable error\n        if (isRecoverableError(error) && attempt < this.maxRetries) {\n          const delay = this.getBackoffDelay(attempt);\n          // SECURITY: Sanitize error message to prevent token leakage\n          logDebug(\n            `[${this.id}] ${operationName} failed (attempt ${attempt + 1}/${this.maxRetries + 1}): ` +\n            `${safeErrorMessage(lastError)}. Retrying in ${Math.round(delay)}ms...`\n          );\n          await this.sleep(delay);\n          continue;\n        }\n\n        // Non-recoverable error or out of retries\n        throw new ProviderStreamError(\n          `${operationName} failed after ${attempt + 1} attempts: ${lastError.message}`,\n          this.id,\n          lastError,\n          isRecoverableError(error)\n        );\n      }\n    }\n\n    // Should not reach here, but TypeScript needs this\n    throw lastError;\n  }\n\n  async generate(messages: ConversationMessage[], tools: ProviderToolDefinition[]): Promise<ProviderResponse> {\n    const { messages: boundedMessages } = enforceRequestSizeLimit(messages);\n\n    return this.executeWithRetry(async () => {\n      const request: Parameters<OpenAI['chat']['completions']['create']>[0] = {\n        model: this.model,\n        messages: mapMessages(boundedMessages, this.model),\n        tools: tools.length ? tools.map(mapTool) : undefined,\n        // Force tool usage when tools are available - prevents text-only rambling\n        tool_choice: tools.length ? 'auto' : undefined,\n        // Enable multiple tool calls in a single response\n        parallel_tool_calls: tools.length ? true : undefined,\n        stream: false,\n        // Guardrails: enforce temperature and output cap to prevent runaway responses\n        temperature: this.temperature,\n        max_tokens: this.maxTokens,\n      };\n\n      let completion: ChatCompletion;\n\n      try {\n        const result = await this.client.chat.completions.create(request);\n        assertHasChoices(result);\n        completion = result;\n      } catch (error) {\n        // Wrap and rethrow with more context\n        if (error instanceof Error) {\n          // Check for specific API error types\n          const apiError = error as { status?: number; code?: string };\n\n          if (apiError.status === 401) {\n            throw new ProviderStreamError(\n              `Authentication failed for ${this.id}. Check your API key.`,\n              this.id,\n              error,\n              false // Not retryable\n            );\n          }\n\n          if (apiError.status === 403) {\n            throw new ProviderStreamError(\n              `Access forbidden for ${this.id}. Check your permissions.`,\n              this.id,\n              error,\n              false // Not retryable\n            );\n          }\n\n          // Let recoverable errors propagate for retry\n          if (isRecoverableError(error)) {\n            throw error;\n          }\n\n          // Wrap other errors\n          throw new ProviderStreamError(\n            `API request failed: ${error.message}`,\n            this.id,\n            error,\n            false\n          );\n        }\n        throw error;\n      }\n\n      const choice = completion.choices[0];\n      const usage = mapUsage(completion.usage);\n\n      if (!choice) {\n        return {\n          type: 'message',\n          content: '',\n          usage,\n        };\n      }\n\n      // Safely extract tool calls with error recovery\n      let toolCalls: ToolCallRequest[] = [];\n      try {\n        toolCalls = (choice.message.tool_calls ?? []).map(mapToolCall);\n      } catch (parseError) {\n        // SECURITY: Sanitize error message to prevent token leakage\n        logDebug(\n          `[${this.id}] Failed to parse tool calls, recovering: ` +\n          `${safeErrorMessage(parseError)}`\n        );\n        // Continue with empty tool calls rather than failing\n      }\n\n      const content = extractMessageContent(choice);\n\n      if (toolCalls.length > 0) {\n        return {\n          type: 'tool_calls',\n          toolCalls,\n          content,\n          usage,\n        };\n      }\n\n      return {\n        type: 'message',\n        content,\n        usage,\n      };\n    }, 'generate');\n  }\n\n  async *generateStream(\n    messages: ConversationMessage[],\n    tools: ProviderToolDefinition[]\n  ): AsyncIterableIterator<StreamChunk> {\n    const { messages: boundedMessages } = enforceRequestSizeLimit(messages);\n\n    const request: Parameters<OpenAI['chat']['completions']['create']>[0] = {\n      model: this.model,\n      messages: mapMessages(boundedMessages, this.model),\n      tools: tools.length ? tools.map(mapTool) : undefined,\n      // Force tool usage when tools are available - prevents text-only rambling\n      tool_choice: tools.length ? 'auto' : undefined,\n      // Enable multiple tool calls in a single response\n      parallel_tool_calls: tools.length ? true : undefined,\n      stream: true,\n      // Guardrails: enforce temperature and output cap to prevent runaway responses\n      temperature: this.temperature,\n      max_tokens: this.maxTokens,\n    };\n\n    const response = await this.client.chat.completions.create(request);\n\n    // TypeScript needs help knowing this is a stream when stream: true\n    if (!Symbol.asyncIterator || !((response as AsyncIterable<unknown>)[Symbol.asyncIterator])) {\n      throw new Error('Expected streaming response but got non-streaming');\n    }\n\n    const stream = response as AsyncIterable<OpenAI.Chat.Completions.ChatCompletionChunk>;\n\n    // Track tool calls being built (by index)\n    const pendingToolCalls = new Map<number, { id: string; name: string; arguments: string }>();\n\n    for await (const chunk of stream) {\n      const choice = chunk.choices[0];\n      if (!choice) continue;\n\n      const delta = choice.delta as Record<string, unknown>;\n\n      // Stream reasoning_content for models like deepseek-reasoner so users see progress\n      const reasoning = extractTextContent(delta['reasoning_content']);\n      if (reasoning) {\n        yield { type: 'reasoning', content: reasoning };\n      }\n\n      // Handle content chunks (support both string and array formats)\n      const content = extractTextContent(delta['content']);\n      if (content) {\n        yield { type: 'content', content };\n      }\n\n      // Handle tool call deltas\n      const toolCalls = delta['tool_calls'] as Array<{\n        index: number;\n        id?: string;\n        function?: { name?: string; arguments?: string };\n      }> | undefined;\n      if (toolCalls) {\n        for (const toolCallDelta of toolCalls) {\n          const idx = toolCallDelta.index;\n\n          if (!pendingToolCalls.has(idx)) {\n            pendingToolCalls.set(idx, {\n              id: toolCallDelta.id ?? `call_${idx}`,\n              name: toolCallDelta.function?.name ?? '',\n              arguments: '',\n            });\n          }\n\n          const pending = pendingToolCalls.get(idx)!;\n\n          // Accumulate function name if provided\n          if (toolCallDelta.function?.name) {\n            pending.name = toolCallDelta.function.name;\n          }\n\n          // Accumulate arguments\n          if (toolCallDelta.function?.arguments) {\n            pending.arguments += toolCallDelta.function.arguments;\n          }\n        }\n      }\n\n      // Check if stream is done\n      if (choice.finish_reason) {\n        // Emit all accumulated tool calls\n        for (const [, toolCall] of pendingToolCalls) {\n          let parsed: Record<string, unknown> = {};\n          try {\n            parsed = JSON.parse(toolCall.arguments || '{}');\n          } catch {\n            // Try recovery for malformed JSON\n            const recovered = tryRecoverMalformedJson(toolCall.arguments);\n            if (recovered) {\n              parsed = recovered;\n            }\n          }\n\n          yield {\n            type: 'tool_call',\n            toolCall: {\n              id: toolCall.id,\n              name: toolCall.name,\n              arguments: parsed,\n            },\n          };\n        }\n\n        // Emit usage if available\n        if ('usage' in chunk && chunk.usage) {\n          const usage = chunk.usage as { prompt_tokens: number; completion_tokens: number; total_tokens: number };\n          yield {\n            type: 'usage',\n            usage: {\n              inputTokens: usage.prompt_tokens,\n              outputTokens: usage.completion_tokens,\n              totalTokens: usage.total_tokens,\n            },\n          };\n        }\n\n        yield { type: 'done' };\n      }\n    }\n  }\n\n  private cachedModelInfo: ProviderModelInfo | null = null;\n\n  /**\n   * Fetch model info from OpenAI API\n   * Returns context window and token limits from the real API\n   */\n  async getModelInfo(): Promise<ProviderModelInfo | null> {\n    if (this.cachedModelInfo) {\n      return this.cachedModelInfo;\n    }\n\n    try {\n      // Use the OpenAI models API to get real model info\n      const modelInfo = await this.client.models.retrieve(this.model);\n\n      if (modelInfo) {\n        // OpenAI models API returns context_length or similar field\n        // The exact field name may vary by model\n        const rawInfo = modelInfo as unknown as Record<string, unknown>;\n        const contextWindow =\n          rawInfo['context_length'] as number | undefined ??\n          rawInfo['context_window'] as number | undefined ??\n          rawInfo['max_context_length'] as number | undefined;\n\n        const maxOutputTokens =\n          rawInfo['max_output_tokens'] as number | undefined ??\n          rawInfo['output_token_limit'] as number | undefined;\n\n        if (contextWindow) {\n          this.cachedModelInfo = {\n            id: this.model,\n            contextWindow,\n            maxOutputTokens,\n            inputTokenLimit: contextWindow,\n            outputTokenLimit: maxOutputTokens,\n          };\n          return this.cachedModelInfo;\n        }\n      }\n    } catch (error) {\n      // Models API may not be available for all models\n      // Fall through to return null\n      const message = error instanceof Error ? error.message : String(error);\n      if (!message.includes('404') && !message.includes('not found')) {\n        // Log unexpected errors but don't fail\n        logDebug(`Failed to fetch model info for ${this.model}:`, message);\n      }\n    }\n\n    return null;\n  }\n}\n\nfunction isDeepSeekModel(model?: string): boolean {\n  if (!model) return false;\n  const normalized = model.toLowerCase();\n  return normalized.includes('deepseek');\n}\n\n/**\n * Check if a model is a Grok model that may output reasoning content\n * Grok 3+, Grok 4, and variants with \"think\" or \"reasoning\" support chain-of-thought\n */\nfunction isGrokModel(model?: string): boolean {\n  if (!model) return false;\n  const normalized = model.toLowerCase();\n  return (\n    normalized.includes('grok') &&\n    (normalized.includes('think') ||\n      normalized.includes('reason') ||\n      normalized.includes('grok-3') ||\n      normalized.includes('grok-4'))\n  );\n}\n\n/**\n * Check if a model is a local reasoning model (via Ollama)\n * QwQ, Qwen reasoning, Llama reasoning variants, etc.\n */\nfunction isLocalReasoningModel(model?: string): boolean {\n  if (!model) return false;\n  const normalized = model.toLowerCase();\n  return (\n    // QwQ is Alibaba's reasoning model\n    normalized.includes('qwq') ||\n    // Qwen with reasoning\n    (normalized.includes('qwen') && normalized.includes('reason')) ||\n    // Llama reasoning variants\n    (normalized.includes('llama') && normalized.includes('reason')) ||\n    // Mistral reasoning\n    (normalized.includes('mistral') && normalized.includes('reason')) ||\n    // Generic reasoning model indicators\n    normalized.includes('-r1') ||\n    normalized.includes('think') ||\n    normalized.includes('cot')\n  );\n}\n\n/**\n * Check if a model supports reasoning/thinking content in responses\n */\nfunction supportsReasoningContent(model?: string): boolean {\n  return isDeepSeekModel(model) || isGrokModel(model) || isLocalReasoningModel(model);\n}\n\n/**\n * Validate and sanitize message sequence to ensure tool messages have preceding tool_calls.\n * OpenAI/DeepSeek APIs require: \"Messages with role 'tool' must be a response to a preceding message with 'tool_calls'\"\n */\nfunction sanitizeMessageSequence(messages: ConversationMessage[]): ConversationMessage[] {\n  const sanitized: ConversationMessage[] = [];\n  const pendingToolCallIds = new Set<string>();\n\n  for (const message of messages) {\n    if (message.role === 'assistant' && message.toolCalls?.length) {\n      // Track tool call IDs that need responses\n      for (const tc of message.toolCalls) {\n        if (tc.id) pendingToolCallIds.add(tc.id);\n      }\n      sanitized.push(message);\n    } else if (message.role === 'tool') {\n      // Only include tool messages if we have a pending tool call for them\n      const toolCallId = message.toolCallId;\n      if (toolCallId && pendingToolCallIds.has(toolCallId)) {\n        pendingToolCallIds.delete(toolCallId);\n        sanitized.push(message);\n      } else {\n        // ORPHANED TOOL MESSAGE - skip it to prevent API error\n        // This can happen after context compaction or message pruning\n        logDebug(`[mapMessages] Skipping orphaned tool message (no preceding tool_call): ${toolCallId?.slice(0, 20) || 'no-id'}`);\n      }\n    } else {\n      // system, user, assistant without tool_calls - pass through\n      // Clear pending tool calls when we hit a user message (new turn)\n      if (message.role === 'user') {\n        pendingToolCallIds.clear();\n      }\n      sanitized.push(message);\n    }\n  }\n\n  return sanitized;\n}\n\nfunction mapMessages(messages: ConversationMessage[], model?: string): ChatCompletionMessageParam[] {\n  // CRITICAL: Sanitize message sequence to prevent \"tool must follow tool_calls\" errors\n  const sanitizedMessages = sanitizeMessageSequence(messages);\n\n  const params: ChatCompletionMessageParam[] = [];\n  const includeReasoningContent = supportsReasoningContent(model);\n\n  for (const message of sanitizedMessages) {\n    switch (message.role) {\n      case 'system':\n      case 'user': {\n        params.push({\n          role: message.role,\n          content: message.content,\n        });\n        break;\n      }\n      case 'assistant': {\n        const assistantMessage: ChatCompletionMessageParam & { reasoning_content?: string } = {\n          role: 'assistant',\n          content: message.content,\n          tool_calls: message.toolCalls?.map((call, index) => ({\n            id: call.id || `call_${index}`,\n            type: 'function',\n            function: {\n              name: call.name,\n              arguments: JSON.stringify(call.arguments ?? {}),\n            },\n          })),\n        };\n        if (includeReasoningContent) {\n          assistantMessage.reasoning_content = message.content ?? '';\n        }\n        params.push(assistantMessage);\n        break;\n      }\n      case 'tool': {\n        params.push({\n          role: 'tool',\n          content: message.content,\n          tool_call_id: message.toolCallId,\n        });\n        break;\n      }\n      default:\n        break;\n    }\n  }\n\n  return params;\n}\n\nfunction mapTool(definition: ProviderToolDefinition): ChatCompletionTool {\n  const parameters = (definition.parameters ?? {\n    type: 'object',\n    properties: {},\n  }) as FunctionDefinition['parameters'];\n\n  return {\n    type: 'function',\n    function: {\n      name: definition.name,\n      description: definition.description,\n      parameters,\n      // Enable strict schema validation for more reliable tool calls\n      strict: false, // Set to false to allow flexible schemas; true requires additionalProperties: false\n    },\n  };\n}\n\n/**\n * Enforce a hard request size limit to prevent provider 413 errors.\n * Drops the oldest non-system messages until the serialized size is under limit.\n */\nfunction enforceRequestSizeLimit(messages: ConversationMessage[]): { messages: ConversationMessage[]; truncated: boolean } {\n  let truncated = false;\n  const trimmed = [...messages];\n  let size = estimateMessageChars(trimmed);\n\n  while (size > REQUEST_CHAR_LIMIT && trimmed.length > 1) {\n    // Remove the oldest non-system message; if only systems remain, drop the second message\n    const removeIdx = trimmed.findIndex(msg => msg.role !== 'system');\n    const idx = removeIdx === -1 ? 1 : removeIdx;\n    trimmed.splice(idx, 1);\n    truncated = true;\n    size = estimateMessageChars(trimmed);\n  }\n\n  if (truncated) {\n    trimmed.unshift({\n      role: 'system',\n      content: '[Context trimmed to fit request size limit. Earlier turns were dropped to avoid provider rejection.]',\n    });\n  }\n\n  return { messages: trimmed, truncated };\n}\n\nfunction estimateMessageChars(messages: ConversationMessage[]): number {\n  let total = 0;\n  for (const msg of messages) {\n    if (typeof msg.content === 'string') {\n      total += msg.content.length;\n    } else if (Array.isArray(msg.content)) {\n      for (const part of msg.content as Array<unknown>) {\n        if (typeof part === 'string') {\n          total += part.length;\n        } else if (part && typeof part === 'object' && 'text' in (part as Record<string, unknown>)) {\n          const text = (part as { text?: string }).text ?? '';\n          total += typeof text === 'string' ? text.length : String(text).length;\n        } else {\n          total += JSON.stringify(part ?? '').length;\n        }\n      }\n    } else if (msg.content != null) {\n      total += JSON.stringify(msg.content).length;\n    }\n\n    const toolCalls = (msg as { toolCalls?: Array<{ name?: string; arguments?: unknown }> }).toolCalls;\n    if (Array.isArray(toolCalls)) {\n      for (const call of toolCalls) {\n        total += (call.name?.length ?? 0);\n        try {\n          total += JSON.stringify(call.arguments ?? {}).length;\n        } catch {\n          total += 100; // Fallback small cost\n        }\n      }\n    }\n  }\n  return total;\n}\n\nfunction extractMessageContent(choice: ChatCompletion.Choice): string {\n  const message = choice.message;\n  const content = extractTextContent(message?.content);\n\n  if (content.trim()) {\n    return content.trim();\n  }\n\n  const reasoning = extractTextContent((message as { reasoning_content?: unknown })?.reasoning_content);\n  if (reasoning.trim()) {\n    return reasoning.trim();\n  }\n\n  const refusal = message?.refusal;\n  if (typeof refusal === 'string' && refusal.trim()) {\n    return refusal.trim();\n  }\n\n  return '';\n}\n\nfunction isFunctionToolCall(call: ChatCompletionMessageToolCall): call is ChatCompletionMessageFunctionToolCall {\n  return call.type === 'function';\n}\n\nfunction isCustomToolCall(call: ChatCompletionMessageToolCall): call is ChatCompletionMessageCustomToolCall {\n  return call.type === 'custom';\n}\n\nfunction mapToolCall(call: ChatCompletionMessageToolCall): ToolCallRequest {\n  let parsed: Record<string, unknown> = {};\n  let rawArgs: string;\n  let funcName: string;\n\n  // Handle both standard function calls and custom tool calls\n  if (isFunctionToolCall(call)) {\n    rawArgs = call.function.arguments ?? '{}';\n    funcName = call.function.name ?? call.id ?? 'unknown';\n  } else if (isCustomToolCall(call)) {\n    rawArgs = call.custom.input ?? '{}';\n    funcName = call.custom.name ?? call.id ?? 'unknown';\n  } else {\n    // Fallback for any future tool call types\n    rawArgs = '{}';\n    funcName = (call as { id?: string }).id ?? 'unknown';\n  }\n\n  try {\n    parsed = JSON.parse(rawArgs);\n  } catch (error) {\n    // Try to recover malformed JSON (common with some models)\n    const recovered = tryRecoverMalformedJson(rawArgs);\n    if (recovered) {\n      parsed = recovered;\n    } else {\n      // SECURITY: Sanitize raw args to prevent token leakage (they could contain API keys in malformed requests)\n      const sanitizedArgs = sanitizeErrorMessage(rawArgs.slice(0, 100));\n      logDebug(`[tool-call] Failed to parse arguments for ${funcName}: ${sanitizedArgs}...`);\n    }\n  }\n\n  return {\n    id: call.id ?? funcName,\n    name: funcName,\n    arguments: parsed,\n  };\n}\n\n/**\n * Try to recover malformed JSON from tool call arguments.\n * Some models return truncated or malformed JSON that can be fixed.\n */\nfunction tryRecoverMalformedJson(raw: string): Record<string, unknown> | null {\n  if (!raw || !raw.trim()) {\n    return null;\n  }\n\n  const attempts = [\n    // Try adding missing closing braces/quotes\n    `${raw  }\"}`,\n    `${raw  }}`,\n    `${raw  }\"` + `}`,\n    `${raw  }\"}}`,\n    `${raw  }}}`,\n  ];\n\n  for (const attempt of attempts) {\n    try {\n      const parsed = JSON.parse(attempt);\n      if (typeof parsed === 'object' && parsed !== null) {\n        return parsed;\n      }\n    } catch {\n      // Continue to next attempt\n    }\n  }\n\n  // Try regex extraction as last resort\n  try {\n    const pairs = raw.matchAll(/\"([^\"]+)\":\\s*(?:\"([^\"]*)\"?|(\\d+(?:\\.\\d+)?)|(\\btrue\\b|\\bfalse\\b|\\bnull\\b))/g);\n    const result: Record<string, unknown> = {};\n\n    for (const match of pairs) {\n      const [, key, strVal, numVal, boolVal] = match;\n      if (key) {\n        if (strVal !== undefined) {\n          result[key] = strVal;\n        } else if (numVal) {\n          result[key] = numVal.includes('.') ? parseFloat(numVal) : parseInt(numVal, 10);\n        } else if (boolVal) {\n          result[key] = boolVal === 'true' ? true : boolVal === 'false' ? false : null;\n        }\n      }\n    }\n\n    if (Object.keys(result).length > 0) {\n      return result;\n    }\n  } catch {\n    // Regex extraction failed\n  }\n\n  return null;\n}\n\n/**\n * Normalize OpenAI content parts into plain text.\n * Supports both legacy string content and the newer array-of-parts format.\n */\nfunction extractTextContent(content: unknown): string {\n  if (!content) {\n    return '';\n  }\n\n  if (typeof content === 'string') {\n    return content;\n  }\n\n  if (Array.isArray(content)) {\n    return content\n      .map((part) => {\n        if (typeof part === 'string') {\n          return part;\n        }\n        if (part && typeof part === 'object') {\n          const { text, content: nestedContent } = part as { text?: unknown; content?: unknown };\n          if (typeof text === 'string') return text;\n          if (typeof nestedContent === 'string') return nestedContent;\n        }\n        return '';\n      })\n      .join('');\n  }\n\n  if (content && typeof content === 'object') {\n    const { text, content: nestedContent } = content as { text?: unknown; content?: unknown };\n    if (typeof text === 'string') return text;\n    if (typeof nestedContent === 'string') return nestedContent;\n  }\n\n  return '';\n}\n\nfunction mapUsage(usage?: ChatCompletion['usage'] | null): ProviderUsage | null {\n  if (!usage) {\n    return null;\n  }\n\n  return {\n    inputTokens: usage.prompt_tokens,\n    outputTokens: usage.completion_tokens,\n    totalTokens: usage.total_tokens,\n  };\n}\n\nfunction assertHasChoices(result: ChatCompletionsResult): asserts result is ChatCompletion {\n  if (!('choices' in result)) {\n    throw new Error('Streaming responses are not supported in this runtime.');\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}