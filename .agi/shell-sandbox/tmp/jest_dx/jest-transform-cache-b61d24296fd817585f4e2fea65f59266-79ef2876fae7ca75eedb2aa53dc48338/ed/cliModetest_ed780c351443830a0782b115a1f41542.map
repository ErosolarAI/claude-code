{"version":3,"names":["_nodeFs","require","_nodePath","_nodeUrl","_cliMode","_packageInfo","describe","it","result","detectCliMode","expect","mode","toBe","argv","toEqual","input","push","expected","JSON","parse","readFileSync","resolve","process","cwd","version","readPackageVersion","pathToFileURL","__filename"],"sources":["cliMode.test.ts"],"sourcesContent":["import { readFileSync } from 'node:fs';\nimport { resolve } from 'node:path';\nimport { pathToFileURL } from 'node:url';\nimport { detectCliMode } from '../src/bin/cliMode.js';\nimport { readPackageVersion } from '../src/utils/packageInfo.js';\n\ndescribe('detectCliMode', () => {\n  it('prefers version flag over other modes', () => {\n    const result = detectCliMode(['--version', '--json', '--self-test']);\n    expect(result.mode).toBe('version');\n    expect(result.argv).toEqual(['--version', '--json', '--self-test']);\n  });\n\n  it('prefers help flag over lower-priority modes', () => {\n    const result = detectCliMode(['-h', '--json']);\n    expect(result.mode).toBe('help');\n  });\n\n  it('detects self-test, json, and eval modes in order', () => {\n    expect(detectCliMode(['--self-test']).mode).toBe('self-test');\n    expect(detectCliMode(['--json']).mode).toBe('json');\n    expect(detectCliMode(['-e', 'prompt']).mode).toBe('eval');\n  });\n\n  it('defaults to shell mode when no flags match', () => {\n    expect(detectCliMode(['prompt text']).mode).toBe('shell');\n  });\n\n  it('returns a defensive copy of argv', () => {\n    const input = ['--json'];\n    const result = detectCliMode(input);\n    input.push('--extra');\n    expect(result.argv).toEqual(['--json']);\n  });\n});\n\ndescribe('readPackageVersion', () => {\n  it('reads the nearest package.json version', () => {\n    const expected = JSON.parse(\n      readFileSync(resolve(process.cwd(), 'package.json'), 'utf8')\n    ).version;\n    const version = readPackageVersion(pathToFileURL(__filename));\n    expect(version).toBe(expected);\n  });\n});\n"],"mappings":";;AAAA,IAAAA,OAAA,GAAAC,OAAA;AACA,IAAAC,SAAA,GAAAD,OAAA;AACA,IAAAE,QAAA,GAAAF,OAAA;AACA,IAAAG,QAAA,GAAAH,OAAA;AACA,IAAAI,YAAA,GAAAJ,OAAA;AAEAK,QAAQ,CAAC,eAAe,EAAE,MAAM;EAC9BC,EAAE,CAAC,uCAAuC,EAAE,MAAM;IAChD,MAAMC,MAAM,GAAG,IAAAC,sBAAa,EAAC,CAAC,WAAW,EAAE,QAAQ,EAAE,aAAa,CAAC,CAAC;IACpEC,MAAM,CAACF,MAAM,CAACG,IAAI,CAAC,CAACC,IAAI,CAAC,SAAS,CAAC;IACnCF,MAAM,CAACF,MAAM,CAACK,IAAI,CAAC,CAACC,OAAO,CAAC,CAAC,WAAW,EAAE,QAAQ,EAAE,aAAa,CAAC,CAAC;EACrE,CAAC,CAAC;EAEFP,EAAE,CAAC,6CAA6C,EAAE,MAAM;IACtD,MAAMC,MAAM,GAAG,IAAAC,sBAAa,EAAC,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;IAC9CC,MAAM,CAACF,MAAM,CAACG,IAAI,CAAC,CAACC,IAAI,CAAC,MAAM,CAAC;EAClC,CAAC,CAAC;EAEFL,EAAE,CAAC,kDAAkD,EAAE,MAAM;IAC3DG,MAAM,CAAC,IAAAD,sBAAa,EAAC,CAAC,aAAa,CAAC,CAAC,CAACE,IAAI,CAAC,CAACC,IAAI,CAAC,WAAW,CAAC;IAC7DF,MAAM,CAAC,IAAAD,sBAAa,EAAC,CAAC,QAAQ,CAAC,CAAC,CAACE,IAAI,CAAC,CAACC,IAAI,CAAC,MAAM,CAAC;IACnDF,MAAM,CAAC,IAAAD,sBAAa,EAAC,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC,CAACE,IAAI,CAAC,CAACC,IAAI,CAAC,MAAM,CAAC;EAC3D,CAAC,CAAC;EAEFL,EAAE,CAAC,4CAA4C,EAAE,MAAM;IACrDG,MAAM,CAAC,IAAAD,sBAAa,EAAC,CAAC,aAAa,CAAC,CAAC,CAACE,IAAI,CAAC,CAACC,IAAI,CAAC,OAAO,CAAC;EAC3D,CAAC,CAAC;EAEFL,EAAE,CAAC,kCAAkC,EAAE,MAAM;IAC3C,MAAMQ,KAAK,GAAG,CAAC,QAAQ,CAAC;IACxB,MAAMP,MAAM,GAAG,IAAAC,sBAAa,EAACM,KAAK,CAAC;IACnCA,KAAK,CAACC,IAAI,CAAC,SAAS,CAAC;IACrBN,MAAM,CAACF,MAAM,CAACK,IAAI,CAAC,CAACC,OAAO,CAAC,CAAC,QAAQ,CAAC,CAAC;EACzC,CAAC,CAAC;AACJ,CAAC,CAAC;AAEFR,QAAQ,CAAC,oBAAoB,EAAE,MAAM;EACnCC,EAAE,CAAC,wCAAwC,EAAE,MAAM;IACjD,MAAMU,QAAQ,GAAGC,IAAI,CAACC,KAAK,CACzB,IAAAC,oBAAY,EAAC,IAAAC,iBAAO,EAACC,OAAO,CAACC,GAAG,CAAC,CAAC,EAAE,cAAc,CAAC,EAAE,MAAM,CAC7D,CAAC,CAACC,OAAO;IACT,MAAMA,OAAO,GAAG,IAAAC,+BAAkB,EAAC,IAAAC,sBAAa,EAACC,UAAU,CAAC,CAAC;IAC7DjB,MAAM,CAACc,OAAO,CAAC,CAACZ,IAAI,CAACK,QAAQ,CAAC;EAChC,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}