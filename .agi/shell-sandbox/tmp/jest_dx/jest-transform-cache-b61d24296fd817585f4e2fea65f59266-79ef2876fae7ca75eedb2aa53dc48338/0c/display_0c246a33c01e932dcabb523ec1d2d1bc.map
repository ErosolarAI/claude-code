{"version":3,"names":["_nodeReadline","_interopRequireDefault","require","_theme","_richText","_layout","_textHighlighter","_designSystem","_outputMode","e","__esModule","default","DISPLAY_CONSTANTS","MIN_BANNER_WIDTH","MAX_BANNER_WIDTH","BANNER_PADDING","MIN_MESSAGE_WIDTH","MAX_MESSAGE_WIDTH","MESSAGE_PADDING","MIN_ACTION_WIDTH","MAX_ACTION_WIDTH","MIN_THOUGHT_WIDTH","MAX_THOUGHT_WIDTH","MIN_CONTENT_WIDTH","MIN_WRAP_WIDTH","Display","renderer","outputInterceptors","Set","inlinePanelHandler","constructor","stream","process","stdout","errorStream","outputStream","setRenderer","hasRenderer","Boolean","setInlinePanelHandler","handler","maybeHandleInlinePanel","payload","normalized","content","trim","enqueueEvent","type","addEvent","registerOutputInterceptor","interceptor","add","delete","notifyBeforeOutput","beforeWrite","notifyAfterOutput","interceptors","Array","from","index","length","afterWrite","writeRaw","write","chunk","writeStreamChunk","getOutputStream","showThinking","_message","updateThinking","stopThinking","_addNewLine","showAssistantMessage","metadata","isThought","isFinal","useRichBlock","wasStreamed","wrapped","buildChatBox","wrapForRenderer","telemetry","formatTelemetryLine","eventType","showNarrative","_content","showAction","text","status","icon","formatActionIcon","rendered","wrapWithPrefix","showSubAction","lines","buildWrappedSubActionLines","join","showMessage","role","showSystemMessage","mode","output","showTestEvent","showInlinePanel","isArray","split","clampInlinePanel","map","line","trimEnd","hasContent","some","clearInlinePanel","rendererSupportsInline","supportsInlinePanel","setInlinePanel","maxLines","overflow","indicator","theme","ui","muted","tailCount","Math","max","tail","slice","captureUserInput","options","captureInput","Promise","resolve","rl","readline","createInterface","input","stdin","question","answer","close","allowEmpty","showError","message","error","details","formatErrorDetails","inlineContent","filter","tone","parts","push","showWarning","warning","showInfo","info","showSuccess","success","showProgressBadge","label","current","total","percentage","round","barWidth","filled","empty","progressBar","repeat","badge","showStatusLine","elapsedMs","_context","elapsed","formatElapsed","isTTY","updateStatusBundle","main","render","showCommandPalette","commands","panel","buildCommandPalette","showPlanningStep","step","width","min","getColumnWidth","heading","renderSectionHeading","subtitle","icons","arrow","showThinkingBlock","durationMs","block","buildClaudeStyleThought","clear","updateStreamingStatus","updateStatus","clearStreamingStatus","isStreamingStatusVisible","parallelAgentStatus","columns","Number","isFinite","getTerminalColumns","Error","stack","highlightError","JSON","stringify","totalSeconds","minutes","floor","seconds","toString","padStart","isPlainOutputMode","body","renderMessageBody","resolveMessageWidth","renderMessagePanel","title","assistant","accentColor","primary","borderColor","border","elapsedLabel","metrics","accent","elapsedValue","secondary","separator","thinkingStyle","thinking","maxBoxWidth","contentWidth","contentLines","wrappedLines","trimmed","wrapLine","result","labelText","undefined","formatElapsedTime","headerLine","padding","footerLine","mins","secs","indent","grouped","groupPaletteCommands","commandWidth","computeCommandColumnWidth","descWidth","intro","gradient","introLines","forEach","category","items","formatPaletteCategory","bold","item","wrappedDesc","description","paddedCommand","command","padEnd","commandLabel","firstLine","colorizePaletteText","extra","FALLBACK","groups","Map","key","toLowerCase","bucket","get","set","order","orderedKeys","has","keys","includes","totalWidth","indentWidth","longest","reduce","visibleLength","maxAllowed","budget","toUpperCase","prefix","prefixWidth","available","continuationPrefix","segments","usedPrefix","segment","pop","isLast","continuation","buildSubActionPrefixes","colorize","resolveStatusColor","subaction","branch","action","words","chunkWord","word","chunks","i","value","stripAnsi","replace","exports","display"],"sources":["display.ts"],"sourcesContent":["/**\n * Display - Simplified UI facade that routes all output through UnifiedUIRenderer\n *\n * This class now serves as a compatibility layer, providing the same API\n * but delegating all actual rendering to UnifiedUIRenderer.\n */\n\nimport readline from 'node:readline';\nimport { theme, icons } from './theme.js';\nimport { renderMessagePanel, renderMessageBody } from './richText.js';\nimport { getTerminalColumns } from './layout.js';\nimport { highlightError } from './textHighlighter.js';\nimport type { ProviderUsage } from '../core/types.js';\nimport { renderSectionHeading } from './designSystem.js';\nimport { isPlainOutputMode } from './outputMode.js';\nimport { UnifiedUIRenderer, type RendererEventType } from './UnifiedUIRenderer.js';\n\ntype OutputStream = NodeJS.WritableStream & { columns?: number; rows?: number; isTTY?: boolean };\n\nexport interface DisplayMessageMetadata {\n  isFinal?: boolean;\n  elapsedMs?: number;\n  usage?: ProviderUsage | null;\n  contextWindowTokens?: number | null;\n  wasStreamed?: boolean;\n  suppressDisplay?: boolean;\n}\n\ninterface StatusLineContextInfo {\n  percentage?: number;\n  tokens?: number;\n  sessionElapsedMs?: number;\n}\n\ntype ActionStatus = 'pending' | 'success' | 'error' | 'info' | 'warning';\n\ninterface PrefixWrapOptions {\n  continuationPrefix?: string;\n}\n\ninterface OutputInterceptor {\n  beforeWrite?: () => void;\n  afterWrite?: (content?: string) => void;\n}\n\ntype CommandPaletteTone = 'info' | 'warn' | 'success' | 'muted';\n\ninterface CommandPaletteItem {\n  command: string;\n  description: string;\n  category?: string | null;\n  tone?: CommandPaletteTone;\n}\n\ntype InlinePanelMode = 'panel' | 'notice';\ntype InlinePanelTone = 'info' | 'warning' | 'error' | 'success';\n\ninterface InlinePanelPayload {\n  content: string;\n  mode?: InlinePanelMode;\n  tone?: InlinePanelTone;\n}\n\n// Display configuration constants\nconst DISPLAY_CONSTANTS = {\n  MIN_BANNER_WIDTH: 32,\n  MAX_BANNER_WIDTH: 120,\n  BANNER_PADDING: 4,\n  MIN_MESSAGE_WIDTH: 42,\n  MAX_MESSAGE_WIDTH: 110,\n  MESSAGE_PADDING: 4,\n  MIN_ACTION_WIDTH: 40,\n  MAX_ACTION_WIDTH: 90,\n  MIN_THOUGHT_WIDTH: 48,\n  MAX_THOUGHT_WIDTH: 96,\n  MIN_CONTENT_WIDTH: 10,\n  MIN_WRAP_WIDTH: 12,\n} as const;\n\n/**\n * Display class - now a thin wrapper around UnifiedUIRenderer\n *\n * Provides backward-compatible API while routing all output through the renderer.\n */\nexport class Display {\n  private readonly outputStream: OutputStream;\n  private readonly errorStream: OutputStream;\n  private renderer: UnifiedUIRenderer | null = null;\n  private readonly outputInterceptors = new Set<OutputInterceptor>();\n  private inlinePanelHandler: ((payload: InlinePanelPayload) => boolean) | null = null;\n\n  constructor(stream: OutputStream = process.stdout, errorStream?: OutputStream) {\n    this.outputStream = stream;\n    this.errorStream = errorStream ?? stream;\n  }\n\n  setRenderer(renderer: UnifiedUIRenderer | null): void {\n    this.renderer = renderer;\n  }\n\n  hasRenderer(): boolean {\n    return Boolean(this.renderer);\n  }\n\n  setInlinePanelHandler(handler: ((payload: InlinePanelPayload) => boolean) | null): void {\n    this.inlinePanelHandler = handler;\n  }\n\n  private maybeHandleInlinePanel(payload: InlinePanelPayload): boolean {\n    if (!this.inlinePanelHandler) {\n      return false;\n    }\n\n    const normalized = payload.content?.trim();\n    if (!normalized) {\n      return false;\n    }\n\n    try {\n      return this.inlinePanelHandler({ ...payload, content: normalized }) === true;\n    } catch {\n      return false;\n    }\n  }\n\n  private enqueueEvent(type: RendererEventType, content: string): boolean {\n    if (!this.renderer || !content) {\n      return false;\n    }\n    this.renderer.addEvent(type, content);\n    return true;\n  }\n\n  registerOutputInterceptor(interceptor: OutputInterceptor): () => void {\n    if (!interceptor) {\n      return () => {};\n    }\n    this.outputInterceptors.add(interceptor);\n    return () => {\n      this.outputInterceptors.delete(interceptor);\n    };\n  }\n\n  private notifyBeforeOutput(): void {\n    for (const interceptor of this.outputInterceptors) {\n      interceptor.beforeWrite?.();\n    }\n  }\n\n  private notifyAfterOutput(content?: string): void {\n    const interceptors = Array.from(this.outputInterceptors);\n    for (let index = interceptors.length - 1; index >= 0; index -= 1) {\n      interceptors[index]?.afterWrite?.(content);\n    }\n  }\n\n\n  /**\n   * Write raw content directly\n   */\n  writeRaw(content: string): void {\n    if (!content) return;\n\n    this.notifyBeforeOutput();\n    if (this.enqueueEvent('raw', content)) {\n      this.notifyAfterOutput(content);\n      return;\n    }\n\n    // Fallback if no renderer\n    this.outputStream.write(content);\n    this.notifyAfterOutput(content);\n  }\n\n  /**\n   * Stream chunk (for streaming responses)\n   */\n  stream(chunk: string): void {\n    if (!chunk) return;\n\n    this.notifyBeforeOutput();\n    if (this.enqueueEvent('streaming', chunk)) {\n      this.notifyAfterOutput(chunk);\n      return;\n    }\n\n    // Fallback\n    this.outputStream.write(chunk);\n    this.notifyAfterOutput(chunk);\n  }\n\n  /**\n   * Backward-compatible alias\n   */\n  writeStreamChunk(chunk: string): void {\n    this.stream(chunk);\n  }\n\n  /**\n   * Get the output stream for direct access\n   */\n  getOutputStream(): OutputStream {\n    return this.outputStream;\n  }\n\n  /**\n   * Show thinking indicator\n   * NO-OP: Don't emit events during SSE streaming.\n   * The animated spinner in the status line shows thinking state.\n   */\n  showThinking(_message: string = 'Thinking…') {\n    // NO-OP: Spinner animation handles thinking state visually.\n    // No events emitted - final message handler renders complete content.\n  }\n\n  /**\n   * Update thinking indicator (status line only, not scrollback)\n   * This is called frequently during streaming to show progress snippets.\n   * The actual content will be rendered as a complete block later.\n   */\n  updateThinking(_message: string) {\n    // NO-OP: Don't emit events for transient thinking updates.\n    // Thinking snippets are shown only in the status indicator (animated spinner).\n    // The complete thought/response will be rendered as a block when ready.\n  }\n\n  /**\n   * Stop thinking (no-op - renderer handles state)\n   */\n  stopThinking(_addNewLine: boolean = true) {\n    // No-op - renderer handles thinking state\n  }\n\n  /**\n   * Show assistant message\n   */\n  showAssistantMessage(content: string, metadata?: DisplayMessageMetadata) {\n    const normalized = content.trim();\n    if (!normalized) return;\n\n    const isThought = metadata?.isFinal === false;\n    const useRichBlock = !isThought && metadata?.wasStreamed !== true;\n    const wrapped = useRichBlock ? this.buildChatBox(normalized, metadata) : this.wrapForRenderer(normalized);\n    const telemetry = !useRichBlock && metadata?.isFinal !== false ? this.formatTelemetryLine(metadata) : '';\n    const payload = telemetry ? `${wrapped}\\n${telemetry}` : wrapped;\n    const eventType: RendererEventType = isThought ? 'thought' : useRichBlock ? 'banner' : 'response';\n\n    this.notifyBeforeOutput();\n    if (!this.enqueueEvent(eventType, payload)) {\n      this.outputStream.write(`${payload}\\n`);\n    }\n    this.notifyAfterOutput(payload);\n  }\n\n  /**\n   * Show narrative (thought)\n   * NO-OP: Don't emit events during SSE streaming.\n   * Narratives are buffered and rendered as part of the final response.\n   */\n  showNarrative(_content: string) {\n    // NO-OP: Don't emit intermediate narrative events.\n    // Final message handler renders complete thought + response.\n  }\n\n  /**\n   * Show action\n   */\n  showAction(text: string, status: ActionStatus = 'info') {\n    if (!text.trim()) return;\n\n    const icon = this.formatActionIcon(status);\n    const rendered = this.wrapWithPrefix(text, `${icon} `);\n    this.enqueueEvent('raw', `${rendered}\\n`);\n  }\n\n  /**\n   * Show sub-action\n   */\n  showSubAction(text: string, status: ActionStatus = 'info') {\n    if (!text.trim()) return;\n\n    const lines = this.buildWrappedSubActionLines(text, status);\n    if (!lines.length) return;\n\n    this.enqueueEvent('raw', `${lines.join('\\n')}\\n\\n`);\n  }\n\n  /**\n   * Show message\n   */\n  showMessage(content: string, role: 'assistant' | 'system' = 'assistant') {\n    if (role === 'system') {\n      this.showSystemMessage(content);\n    } else {\n      this.showAssistantMessage(content);\n    }\n  }\n\n  /**\n   * Show system message\n   */\n  showSystemMessage(content: string) {\n    const normalized = content.trim();\n    if (!normalized) return;\n\n    if (this.maybeHandleInlinePanel({ content: normalized, mode: 'panel' })) {\n      return;\n    }\n\n    const output = `${normalized}\\n\\n`;\n    this.notifyBeforeOutput();\n    if (!this.enqueueEvent('response', output)) {\n      this.outputStream.write(output);\n    }\n    this.notifyAfterOutput(output);\n  }\n\n  /**\n   * Show test event (renders in unified UI \"test\" lane)\n   */\n  showTestEvent(content: string) {\n    const normalized = content.trim();\n    if (!normalized) return;\n\n    this.notifyBeforeOutput();\n    if (!this.enqueueEvent('test', normalized)) {\n      this.outputStream.write(`${normalized}\\n\\n`);\n    }\n    this.notifyAfterOutput(normalized);\n  }\n\n  /**\n   * Show an inline panel pinned below the prompt (overlay only, no scrollback).\n   */\n  showInlinePanel(content: string | string[]) {\n    const lines = Array.isArray(content) ? content : content.split('\\n');\n    const normalized = this.clampInlinePanel(lines.map(line => line.trimEnd()));\n    const hasContent = normalized.some(line => line.trim().length > 0);\n    if (!hasContent) {\n      this.clearInlinePanel();\n      return;\n    }\n\n    const rendererSupportsInline = this.renderer?.supportsInlinePanel?.() ?? false;\n    if (this.renderer && typeof this.renderer.setInlinePanel === 'function') {\n      // Always set renderer state so overlays get the latest content when available\n      this.renderer.setInlinePanel(normalized);\n      if (rendererSupportsInline) {\n        return;\n      }\n    }\n\n    // Fallback for plain/pipe mode: emit directly without relying on inline overlays\n    const output = `${normalized.join('\\n')}\\n`;\n    this.notifyBeforeOutput();\n    this.outputStream.write(output);\n    this.notifyAfterOutput(output);\n  }\n\n  clearInlinePanel() {\n    if (this.renderer && typeof this.renderer.clearInlinePanel === 'function') {\n      this.renderer.clearInlinePanel();\n    }\n  }\n\n  private clampInlinePanel(lines: string[]): string[] {\n    if (!lines.length) return lines;\n    const maxLines = 64;\n    if (lines.length <= maxLines) {\n      return lines;\n    }\n    const overflow = lines.length - maxLines;\n    const indicator = theme.ui.muted(`… ${overflow} more lines`);\n    const tailCount = Math.max(1, maxLines - 1);\n    const tail = lines.slice(-tailCount);\n    return [indicator, ...tail];\n  }\n\n  /**\n   * Capture a single line of user input without logging it to scrollback.\n   * Uses the unified renderer when available, with a readline fallback.\n   */\n  async captureUserInput(options: { allowEmpty?: boolean; trim?: boolean; resetBuffer?: boolean } = {}): Promise<string> {\n    if (this.renderer && typeof this.renderer.captureInput === 'function') {\n      return this.renderer.captureInput(options);\n    }\n\n    return new Promise<string>((resolve) => {\n      const rl = readline.createInterface({\n        input: process.stdin,\n        output: process.stdout,\n      });\n      rl.question('', (answer) => {\n        rl.close();\n        const normalized = options.trim === false ? answer : answer.trim();\n        if (!normalized && !options.allowEmpty) {\n          resolve('');\n        } else {\n          resolve(normalized);\n        }\n      });\n    });\n  }\n\n  /**\n   * Show error\n   */\n  showError(message: string, error?: unknown) {\n    const normalized = message?.trim() ?? '';\n    const details = this.formatErrorDetails(error);\n    const inlineContent = [normalized, details].filter(Boolean).join('\\n');\n    if (inlineContent && this.maybeHandleInlinePanel({\n      content: inlineContent,\n      tone: 'error',\n      mode: 'notice',\n    })) {\n      return;\n    }\n\n    const parts = [`${theme.error('✗')} ${normalized || message || 'Error'}`];\n    if (details) {\n      parts.push(`  ${details}`);\n    }\n    const output = `${parts.join('\\n')}\\n`;\n    this.notifyBeforeOutput();\n    if (!this.enqueueEvent('response', output)) {\n      this.outputStream.write(output);\n    }\n    this.notifyAfterOutput(output);\n  }\n\n  /**\n   * Show warning\n   */\n  showWarning(message: string) {\n    const normalized = message.trim();\n    if (!normalized) return;\n\n    if (this.maybeHandleInlinePanel({\n      content: normalized,\n      tone: 'warning',\n      mode: 'notice',\n    })) {\n      return;\n    }\n\n    const output = `${theme.warning('!')} ${normalized}\\n`;\n    this.notifyBeforeOutput();\n    if (!this.enqueueEvent('response', output)) {\n      this.outputStream.write(output);\n    }\n    this.notifyAfterOutput(output);\n  }\n\n  /**\n   * Show info\n   */\n  showInfo(message: string) {\n    const normalized = message.trim();\n    if (!normalized) return;\n\n    if (this.maybeHandleInlinePanel({\n      content: normalized,\n      tone: 'info',\n      mode: 'notice',\n    })) {\n      return;\n    }\n\n    const output = `${theme.info('ℹ')} ${normalized}\\n`;\n    this.notifyBeforeOutput();\n    if (!this.enqueueEvent('response', output)) {\n      this.outputStream.write(output);\n    }\n    this.notifyAfterOutput(output);\n  }\n\n  /**\n   * Show success\n   */\n  showSuccess(message: string) {\n    const normalized = message.trim();\n    if (!normalized) return;\n\n    if (this.maybeHandleInlinePanel({\n      content: normalized,\n      tone: 'success',\n      mode: 'notice',\n    })) {\n      return;\n    }\n\n    const output = `${theme.success('✓')} ${normalized}\\n`;\n    this.notifyBeforeOutput();\n    if (!this.enqueueEvent('response', output)) {\n      this.outputStream.write(output);\n    }\n    this.notifyAfterOutput(output);\n  }\n\n  /**\n   * Show progress badge\n   */\n  showProgressBadge(label: string, current: number, total: number) {\n    const percentage = Math.round((current / total) * 100);\n    const barWidth = 20;\n    const filled = Math.round((current / total) * barWidth);\n    const empty = barWidth - filled;\n\n    const progressBar = `${'█'.repeat(filled)}${'░'.repeat(empty)}`;\n    const badge = `[${label}] ${progressBar} ${percentage}%`;\n\n    this.stream(`\\r${theme.info(badge)}`);\n    if (current >= total) {\n      this.stream('\\n');\n    }\n  }\n\n  /**\n   * Show status line\n   */\n  showStatusLine(status: string, elapsedMs?: number, _context?: StatusLineContextInfo) {\n    const normalized = status?.trim();\n    if (!normalized) return;\n\n    const elapsed = this.formatElapsed(elapsedMs);\n    const parts: string[] = [`• ${normalized}`];\n    if (elapsed) {\n      parts.push(elapsed);\n    }\n    if (process.stdout.isTTY) {\n      parts.push('esc to interrupt');\n    }\n\n    // Status is kept internal; avoid forcing re-render of the overlay.\n    this.renderer?.updateStatusBundle({ main: parts.join(' • ') }, { render: false });\n  }\n\n  /**\n   * Show command palette\n   */\n  showCommandPalette(\n    commands: CommandPaletteItem[],\n    options?: { title?: string; intro?: string }\n  ) {\n    if (!commands || commands.length === 0) return;\n\n    const panel = this.buildCommandPalette(commands, options);\n    if (!panel.trim()) return;\n\n    const output = `\\n${panel}\\n\\n`;\n    this.notifyBeforeOutput();\n    if (!this.enqueueEvent('response', output)) {\n      this.outputStream.write(output);\n    }\n    this.notifyAfterOutput(output);\n  }\n\n  /**\n   * Show planning step\n   */\n  showPlanningStep(step: string, index: number, total: number) {\n    if (!step?.trim() || index < 1 || total < 1 || index > total) return;\n\n    const width = Math.max(\n      DISPLAY_CONSTANTS.MIN_THOUGHT_WIDTH,\n      Math.min(this.getColumnWidth(), DISPLAY_CONSTANTS.MAX_MESSAGE_WIDTH)\n    );\n\n    const heading = renderSectionHeading(`Plan ${index}/${total}`, {\n      subtitle: step,\n      icon: icons.arrow,\n      tone: 'info',\n      width,\n    });\n\n    this.enqueueEvent('raw', `${heading}\\n`);\n  }\n\n  /**\n   * Show thinking block\n   */\n  showThinkingBlock(content: string, durationMs?: number) {\n    const block = this.buildClaudeStyleThought(content, durationMs);\n    this.enqueueEvent('raw', `\\n${block}\\n\\n`);\n  }\n\n  /**\n   * Clear screen\n   */\n  clear() {\n    // Renderer handles this\n  }\n\n  /**\n   * Update streaming status (routes to renderer)\n   */\n  updateStreamingStatus(status: string | null): void {\n    this.renderer?.updateStatus(status);\n  }\n\n  /**\n   * Clear streaming status\n   */\n  clearStreamingStatus(): void {\n    this.renderer?.updateStatus(null);\n  }\n\n  /**\n   * Check if streaming status is visible\n   */\n  isStreamingStatusVisible(): boolean {\n    return false; // Renderer manages this\n  }\n\n  parallelAgentStatus(content: string): void {\n    if (!content) return;\n    this.enqueueEvent('streaming', `${content}\\n`);\n  }\n\n  // ==================== Private Helper Methods ====================\n\n  private getColumnWidth(): number {\n    if (\n      typeof this.outputStream.columns === 'number' &&\n      Number.isFinite(this.outputStream.columns) &&\n      this.outputStream.columns > 0\n    ) {\n      return this.outputStream.columns;\n    }\n    return getTerminalColumns();\n  }\n\n  private formatErrorDetails(error?: unknown): string | null {\n    if (!error) return null;\n\n    if (error instanceof Error) {\n      if (error.stack) return highlightError(error.stack);\n      return highlightError(error.message);\n    }\n\n    if (typeof error === 'string') {\n      return highlightError(error);\n    }\n\n    try {\n      return highlightError(JSON.stringify(error, null, 2));\n    } catch {\n      return null;\n    }\n  }\n\n  private formatElapsed(elapsedMs?: number): string | null {\n    if (typeof elapsedMs !== 'number' || !Number.isFinite(elapsedMs) || elapsedMs < 0) {\n      return null;\n    }\n    const totalSeconds = Math.max(0, Math.round(elapsedMs / 1000));\n    const minutes = Math.floor(totalSeconds / 60);\n    const seconds = totalSeconds % 60;\n    if (minutes > 0) {\n      return `${minutes}m ${seconds.toString().padStart(2, '0')}s`;\n    }\n    return `${seconds}s`;\n  }\n\n  private buildChatBox(content: string, metadata?: DisplayMessageMetadata): string {\n    const normalized = content.trim();\n    if (!normalized) return '';\n\n    if (isPlainOutputMode()) {\n      const body = renderMessageBody(normalized, this.resolveMessageWidth());\n      const telemetry = this.formatTelemetryLine(metadata);\n      return telemetry ? `${body}\\n${telemetry}` : body;\n    }\n\n    const width = this.resolveMessageWidth();\n    const panel = renderMessagePanel(normalized, {\n      width,\n      title: 'Assistant',\n      icon: icons.assistant,\n      accentColor: theme.assistant ?? theme.primary,\n      borderColor: theme.ui.border,\n    });\n\n    const telemetry = this.formatTelemetryLine(metadata);\n    return telemetry ? `${panel}\\n${telemetry}` : panel;\n  }\n\n  private resolveMessageWidth(): number {\n    const columns = this.getColumnWidth();\n    return Math.max(\n      DISPLAY_CONSTANTS.MIN_MESSAGE_WIDTH,\n      columns - DISPLAY_CONSTANTS.MESSAGE_PADDING\n    );\n  }\n\n  private formatTelemetryLine(metadata?: DisplayMessageMetadata): string {\n    if (!metadata) return '';\n\n    const parts: string[] = [];\n    const elapsed = this.formatElapsed(metadata.elapsedMs);\n    if (elapsed) {\n      const elapsedLabel = theme.metrics?.elapsedLabel ?? theme.accent;\n      const elapsedValue = theme.metrics?.elapsedValue ?? theme.secondary;\n      parts.push(`${elapsedLabel('elapsed')} ${elapsedValue(elapsed)}`);\n    }\n\n    if (!parts.length) return '';\n\n    const separator = theme.ui.muted(' • ');\n    return `  ${parts.join(separator)}`;\n  }\n\n  /**\n   * Build a Claude-style thinking block with enhanced visual design.\n   *\n   * Design:\n   *   ╭─ thinking ──────────────────────╮\n   *   │ Content of the thinking block   │\n   *   │ wrapped nicely to fit width     │\n   *   ╰─────────────────────────────────╯\n   *\n   * Or with duration:\n   *   ╭─ thought · 3s ──────────────────╮\n   *   │ Content here                    │\n   *   ╰─────────────────────────────────╯\n   */\n  private buildClaudeStyleThought(content: string, durationMs?: number): string {\n    const thinkingStyle = theme.thinking || {\n      icon: theme.info,\n      text: theme.ui.muted,\n      border: theme.ui.border,\n      label: theme.info,\n    };\n\n    // Determine box width\n    const maxBoxWidth = Math.min(this.getColumnWidth() - 2, 72);\n    const contentWidth = maxBoxWidth - 4; // Account for border and padding\n\n    // Word-wrap content\n    const contentLines = content.split('\\n');\n    const wrappedLines: string[] = [];\n\n    for (const line of contentLines) {\n      const trimmed = line.trim();\n      if (!trimmed) {\n        wrappedLines.push('');\n        continue;\n      }\n      const wrapped = this.wrapLine(trimmed, contentWidth);\n      wrappedLines.push(...wrapped);\n    }\n\n    // Build the box\n    const result: string[] = [];\n\n    // Header with label (and optional duration)\n    const labelText = durationMs !== undefined\n      ? ` thought · ${this.formatElapsedTime(Math.floor(durationMs / 1000))} `\n      : ' thinking ';\n    const headerLine = `╭─${labelText}${'─'.repeat(Math.max(0, maxBoxWidth - labelText.length - 4))}─╮`;\n    result.push(thinkingStyle.border(headerLine));\n\n    // Content lines\n    for (const line of wrappedLines) {\n      const padding = ' '.repeat(Math.max(0, maxBoxWidth - 4 - line.length));\n      result.push(`${thinkingStyle.border('│')} ${thinkingStyle.text(line)}${padding} ${thinkingStyle.border('│')}`);\n    }\n\n    // Footer\n    const footerLine = `╰${'─'.repeat(maxBoxWidth - 2)}╯`;\n    result.push(thinkingStyle.border(footerLine));\n\n    return result.join('\\n');\n  }\n\n  private formatElapsedTime(seconds: number): string {\n    if (seconds < 60) {\n      return `${seconds}s`;\n    }\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return secs > 0 ? `${mins}m ${secs}s` : `${mins}m`;\n  }\n\n  private buildCommandPalette(\n    commands: CommandPaletteItem[],\n    options?: { title?: string; intro?: string }\n  ): string {\n    if (!commands.length) return '';\n\n    const width = Math.max(\n      DISPLAY_CONSTANTS.MIN_MESSAGE_WIDTH,\n      this.getColumnWidth() - 2\n    );\n\n    const indent = '  ';\n    const grouped = this.groupPaletteCommands(commands);\n    const commandWidth = this.computeCommandColumnWidth(commands, width, indent.length);\n    const descWidth = Math.max(\n      DISPLAY_CONSTANTS.MIN_WRAP_WIDTH,\n      width - indent.length - commandWidth - 1\n    );\n\n    const title = options?.title ?? 'Slash commands';\n    const intro = options?.intro ?? 'Describe a task or pick a command below:';\n\n    const lines: string[] = [];\n    lines.push(theme.gradient.primary(title));\n\n    const introLines = this.wrapLine(intro, width);\n    for (const line of introLines) {\n      lines.push(theme.ui.muted(line));\n    }\n\n    lines.push('');\n\n    grouped.forEach(({ category, items }, index) => {\n      const label = this.formatPaletteCategory(category);\n      if (label) {\n        lines.push(theme.bold(label));\n      }\n\n      for (const item of items) {\n        const wrappedDesc = this.wrapLine(item.description, descWidth);\n        const paddedCommand = item.command.padEnd(commandWidth);\n        const commandLabel = theme.primary(paddedCommand);\n\n        const firstLine = wrappedDesc[0] ?? '';\n        lines.push(`${indent}${commandLabel} ${this.colorizePaletteText(firstLine, item.tone)}`);\n\n        for (const extra of wrappedDesc.slice(1)) {\n          lines.push(`${indent}${' '.repeat(commandWidth)} ${this.colorizePaletteText(extra, item.tone)}`);\n        }\n      }\n\n      if (index < grouped.length - 1) {\n        lines.push('');\n      }\n    });\n\n    return lines.join('\\n').trimEnd();\n  }\n\n  private groupPaletteCommands(commands: CommandPaletteItem[]): Array<{ category: string; items: CommandPaletteItem[] }> {\n    const FALLBACK = 'other';\n    const groups = new Map<string, CommandPaletteItem[]>();\n\n    for (const item of commands) {\n      const key = (item.category ?? FALLBACK).toLowerCase();\n      const bucket = groups.get(key) ?? [];\n      bucket.push(item);\n      groups.set(key, bucket);\n    }\n\n    const order = ['configuration', 'workspace', 'diagnostics', 'other'];\n    const orderedKeys = [\n      ...order.filter((key) => groups.has(key)),\n      ...Array.from(groups.keys()).filter((key) => !order.includes(key)),\n    ];\n\n    return orderedKeys.map((category) => ({ category, items: groups.get(category) ?? [] }));\n  }\n\n  private computeCommandColumnWidth(commands: CommandPaletteItem[], totalWidth: number, indentWidth: number): number {\n    const longest = commands.reduce((max, item) => Math.max(max, this.visibleLength(item.command)), 0);\n    const maxAllowed = Math.max(12, Math.min(longest + 2, Math.floor(totalWidth * 0.35)));\n    const budget = Math.max(10, totalWidth - indentWidth - DISPLAY_CONSTANTS.MIN_WRAP_WIDTH);\n    return Math.min(maxAllowed, budget);\n  }\n\n  private formatPaletteCategory(category?: string | null): string {\n    if (!category) return 'Other';\n\n    switch (category.toLowerCase()) {\n      case 'configuration': return 'Configuration';\n      case 'workspace': return 'Workspace';\n      case 'diagnostics': return 'Diagnostics';\n      case 'other': return 'Other';\n      default: return category[0]?.toUpperCase() + category.slice(1);\n    }\n  }\n\n  private colorizePaletteText(text: string, tone?: CommandPaletteTone): string {\n    switch (tone) {\n      case 'warn': return theme.warning(text);\n      case 'success': return theme.success(text);\n      case 'info': return theme.info(text);\n      case 'muted':\n      default: return theme.ui.muted(text);\n    }\n  }\n\n  private wrapWithPrefix(text: string, prefix: string, options?: PrefixWrapOptions): string {\n    if (!text) {\n      return prefix.trimEnd();\n    }\n\n    const width = Math.max(\n      DISPLAY_CONSTANTS.MIN_ACTION_WIDTH,\n      Math.min(this.getColumnWidth(), DISPLAY_CONSTANTS.MAX_ACTION_WIDTH)\n    );\n    const prefixWidth = this.visibleLength(prefix);\n    const available = Math.max(DISPLAY_CONSTANTS.MIN_CONTENT_WIDTH, width - prefixWidth);\n    const indent =\n      typeof options?.continuationPrefix === 'string'\n        ? options.continuationPrefix\n        : ' '.repeat(Math.max(0, prefixWidth));\n\n    const segments = text.split('\\n');\n    const lines: string[] = [];\n    let usedPrefix = false;\n\n    for (const segment of segments) {\n      if (!segment.trim()) {\n        if (usedPrefix) {\n          lines.push(indent);\n        } else {\n          lines.push(prefix.trimEnd());\n          usedPrefix = true;\n        }\n        continue;\n      }\n\n      const wrapped = this.wrapLine(segment.trim(), available);\n      for (const line of wrapped) {\n        lines.push(!usedPrefix ? `${prefix}${line}` : `${indent}${line}`);\n        usedPrefix = true;\n      }\n    }\n\n    return lines.join('\\n');\n  }\n\n  private buildWrappedSubActionLines(text: string, status: ActionStatus): string[] {\n    const lines = text.split('\\n').map((line) => line.trimEnd());\n    while (lines.length && !lines[lines.length - 1]?.trim()) {\n      lines.pop();\n    }\n    if (!lines.length) return [];\n\n    const rendered: string[] = [];\n    for (let index = 0; index < lines.length; index += 1) {\n      const segment = lines[index] ?? '';\n      const isLast = index === lines.length - 1;\n      const { prefix, continuation } = this.buildSubActionPrefixes(status, isLast);\n      rendered.push(this.wrapWithPrefix(segment, prefix, { continuationPrefix: continuation }));\n    }\n    return rendered;\n  }\n\n  private buildSubActionPrefixes(status: ActionStatus, isLast: boolean) {\n    if (isLast) {\n      const colorize = this.resolveStatusColor(status);\n      return {\n        prefix: `  ${colorize(icons.subaction)} `,\n        continuation: '    ',\n      };\n    }\n    const branch = theme.ui.muted('│');\n    return {\n      prefix: `  ${branch} `,\n      continuation: `  ${branch} `,\n    };\n  }\n\n  private resolveStatusColor(status: ActionStatus) {\n    switch (status) {\n      case 'success': return theme.success;\n      case 'error': return theme.error;\n      case 'warning': return theme.warning;\n      case 'pending': return theme.info;\n      default: return theme.secondary;\n    }\n  }\n\n  private formatActionIcon(status: ActionStatus): string {\n    const colorize = this.resolveStatusColor(status);\n    return colorize(`${icons.action}`);\n  }\n\n  private wrapForRenderer(text: string): string {\n    const width = Math.max(\n      DISPLAY_CONSTANTS.MIN_WRAP_WIDTH,\n      this.getColumnWidth() - 4\n    );\n    const lines: string[] = [];\n    for (const line of text.split('\\n')) {\n      const trimmed = line.trimEnd();\n      const wrapped = this.wrapLine(trimmed, width);\n      lines.push(...wrapped);\n    }\n    return lines.join('\\n').trimEnd();\n  }\n\n  private wrapLine(text: string, width: number): string[] {\n    if (width <= 0) return [text];\n    if (!text) return [''];\n    if (text.length <= width) return [text];\n\n    const words = text.split(/\\s+/).filter(Boolean);\n    if (!words.length) return this.chunkWord(text, width);\n\n    const lines: string[] = [];\n    let current = '';\n\n    for (const word of words) {\n      if (!current) {\n        if (word.length <= width) {\n          current = word;\n        } else {\n          const chunks = this.chunkWord(word, width);\n          lines.push(...chunks.slice(0, -1));\n          current = chunks[chunks.length - 1] ?? '';\n        }\n      } else if (current.length + 1 + word.length <= width) {\n        current = `${current} ${word}`;\n      } else {\n        lines.push(current);\n        if (word.length <= width) {\n          current = word;\n        } else {\n          const chunks = this.chunkWord(word, width);\n          lines.push(...chunks.slice(0, -1));\n          current = chunks[chunks.length - 1] ?? '';\n        }\n      }\n    }\n\n    if (current) {\n      lines.push(current);\n    }\n\n    return lines.length ? lines : [''];\n  }\n\n  private chunkWord(word: string, width: number): string[] {\n    if (width <= 0 || !word) return word ? [word] : [''];\n\n    const chunks: string[] = [];\n    for (let i = 0; i < word.length; i += width) {\n      chunks.push(word.slice(i, i + width));\n    }\n\n    return chunks.length > 0 ? chunks : [''];\n  }\n\n  private visibleLength(value: string): number {\n    if (!value) return 0;\n    return this.stripAnsi(value).length;\n  }\n\n  private stripAnsi(value: string): string {\n    if (!value) return '';\n    // eslint-disable-next-line no-control-regex\n    return value.replace(/\\u001B\\[[0-?]*[ -/]*[@-~]/g, '');\n  }\n}\n\nexport const display = new Display();\n"],"mappings":"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","ignoreList":[]}