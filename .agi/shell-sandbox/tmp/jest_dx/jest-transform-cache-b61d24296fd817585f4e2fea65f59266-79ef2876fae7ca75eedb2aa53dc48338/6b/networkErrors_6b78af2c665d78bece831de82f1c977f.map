{"version":3,"names":["cov_rapn0hpvq","actualCoverage","detectNetworkError","error","f","s","toStringValue","value","b","Error","message","code","toUpperCase","undefined","toLowerCase","causeCode","cause","text","NETWORK_CODES","Set","NETWORK_PHRASES","isNetworkCode","Boolean","has","matchesPhrase","some","phrase","includes","type","retryable"],"sources":["networkErrors.ts"],"sourcesContent":["import type { ProviderId } from '../types.js';\n\nexport interface NetworkErrorInfo {\n  type: 'network';\n  message: string;\n  code?: string;\n  provider?: ProviderId | string;\n  retryable: boolean;\n}\n\n/**\n * Heuristically detect network connectivity errors from provider/client failures.\n * Covers DNS, TLS, socket, fetch, and generic \"connection error\" cases.\n */\nexport function detectNetworkError(error: unknown): NetworkErrorInfo | null {\n  const toStringValue = (value: unknown): string =>\n    typeof value === 'string' ? value : value instanceof Error ? value.message : '';\n\n  const code = typeof (error as { code?: unknown })?.code === 'string'\n    ? ((error as { code: string }).code || '').toUpperCase()\n    : undefined;\n\n  const message = toStringValue(error).toLowerCase();\n  const causeCode = typeof (error as { cause?: { code?: string } })?.cause?.code === 'string'\n    ? (error as { cause: { code: string } }).cause.code.toUpperCase()\n    : undefined;\n\n  const text = `${code ?? ''} ${causeCode ?? ''} ${message}`;\n\n  const NETWORK_CODES = new Set([\n    'ECONNREFUSED',\n    'ECONNRESET',\n    'EAI_AGAIN',\n    'ENOTFOUND',\n    'EHOSTUNREACH',\n    'ENETUNREACH',\n    'ETIMEDOUT',\n    'EPIPE',\n  ]);\n\n  const NETWORK_PHRASES = [\n    'network error',\n    'connection error',\n    'failed to fetch',\n    'fetch failed',\n    'socket hang up',\n    'connect ECONNREFUSED',\n    'getaddrinfo ENOTFOUND',\n    'getaddrinfo EAI_AGAIN',\n    'tls handshake timeout',\n    'client network socket disconnected',\n    'self signed certificate',\n    'unexpected end of file',\n    'unable to verify the first certificate',\n    'network is unreachable',\n  ];\n\n  const isNetworkCode = (value?: string): boolean => Boolean(value && NETWORK_CODES.has(value));\n  const matchesPhrase = NETWORK_PHRASES.some((phrase) => text.includes(phrase));\n\n  if (!isNetworkCode(code) && !isNetworkCode(causeCode) && !matchesPhrase) {\n    return null;\n  }\n\n  return {\n    type: 'network',\n    message: toStringValue(error) || 'Network connectivity issue detected.',\n    code: code ?? causeCode,\n    retryable: true,\n  };\n}\n"],"mappings":"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","ignoreList":[]}