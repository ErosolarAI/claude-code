{"version":3,"names":["_globals","require","_unifiedOrchestrator","makeResult","overrides","success","output","duration","command","describe","it","orchestrator","UnifiedOrchestrator","results","error","findings","severity","category","title","description","evidence","recommendation","report","generateReport","expect","filter","f","toHaveLength","mergedSecret","find","toContain","recommendations","toEqual","exitReason","toBe","statusSummary","toMatch","length","toBeGreaterThan","some","r","toLowerCase","includes"],"sources":["unifiedOrchestrator.report.test.ts"],"sourcesContent":["import { describe, expect, it } from '@jest/globals';\nimport { UnifiedOrchestrator, type ExecutionResult, type Finding } from '../src/core/unifiedOrchestrator.js';\n\nconst makeResult = (overrides: Partial<ExecutionResult> = {}): ExecutionResult => ({\n  success: true,\n  output: 'ok',\n  duration: 1,\n  command: 'echo ok',\n  ...overrides,\n});\n\ndescribe('UnifiedOrchestrator reporting', () => {\n  it('deduplicates findings/recommendations and surfaces failed commands clearly', () => {\n    const orchestrator = new UnifiedOrchestrator();\n\n    (orchestrator as any).results = [\n      makeResult({ command: 'echo ok' }),\n      makeResult({ command: 'npm run lint', success: false, error: 'lint failed', output: 'lint failed', duration: 2 }),\n      makeResult({ command: 'echo done' }),\n    ];\n\n    (orchestrator as any).findings = [\n      {\n        severity: 'critical',\n        category: 'Security',\n        title: 'Potential secrets in code',\n        description: 'hit',\n        evidence: 'secret-one',\n        recommendation: 'Remove secrets',\n      },\n      {\n        severity: 'critical',\n        category: 'Security',\n        title: 'Potential secrets in code',\n        description: 'hit again',\n        evidence: 'secret-two',\n        recommendation: 'Remove secrets',\n      },\n      {\n        severity: 'medium',\n        category: 'Code Quality',\n        title: 'Linting errors',\n        description: 'lint',\n        evidence: '2 errors',\n        recommendation: 'Run lint',\n      },\n    ] satisfies Finding[];\n\n    const report = orchestrator.generateReport('Test run');\n\n    expect(report.findings.filter(f => f.title === 'Potential secrets in code')).toHaveLength(1);\n    const mergedSecret = report.findings.find(f => f.title === 'Potential secrets in code');\n    expect(mergedSecret?.evidence).toContain('secret-one');\n    expect(mergedSecret?.evidence).toContain('secret-two');\n    expect(report.recommendations).toEqual(['Remove secrets', 'Run lint']);\n    expect(report.exitReason).toBe('failed-commands');\n    expect(report.statusSummary).toMatch(/failed/i);\n  });\n\n  it('marks critical findings when commands succeed', () => {\n    const orchestrator = new UnifiedOrchestrator();\n    (orchestrator as any).results = [\n      makeResult({ command: 'echo ok' }),\n      makeResult({ command: 'echo ok 2' }),\n    ];\n    (orchestrator as any).findings = [\n      {\n        severity: 'critical',\n        category: 'Security',\n        title: 'High risk',\n        description: 'risk',\n        evidence: 'evidence',\n      },\n    ] satisfies Finding[];\n\n    const report = orchestrator.generateReport('Audit');\n\n    expect(report.exitReason).toBe('critical-findings');\n    expect(report.success).toBe(false);\n  });\n\n  it('ALWAYS generates next steps even when no findings exist', () => {\n    const orchestrator = new UnifiedOrchestrator();\n    (orchestrator as any).results = [\n      makeResult({ command: 'python pipeline.py', output: 'wrote cancer_data.csv' }),\n      makeResult({ command: 'python train.py', output: 'model trained' }),\n    ];\n    (orchestrator as any).findings = []; // No findings\n\n    const report = orchestrator.generateReport('cure cancer research');\n\n    // Should generate meaningful next steps even without findings\n    expect(report.recommendations.length).toBeGreaterThan(0);\n    // Should include research-specific next steps\n    expect(report.recommendations.some(r => r.toLowerCase().includes('validate') || r.toLowerCase().includes('expert') || r.toLowerCase().includes('peer review'))).toBe(true);\n  });\n\n  it('generates context-aware next steps for ML tasks', () => {\n    const orchestrator = new UnifiedOrchestrator();\n    (orchestrator as any).results = [\n      makeResult({ command: 'python train_model.py', output: 'model.json created' }),\n    ];\n    (orchestrator as any).findings = [];\n\n    const report = orchestrator.generateReport('train ML model');\n\n    expect(report.recommendations.length).toBeGreaterThan(0);\n    expect(report.recommendations.some(r => r.toLowerCase().includes('model') || r.toLowerCase().includes('test'))).toBe(true);\n  });\n\n  it('generates generic next steps for unknown task types', () => {\n    const orchestrator = new UnifiedOrchestrator();\n    (orchestrator as any).results = [\n      makeResult({ command: 'do something', output: 'done' }),\n    ];\n    (orchestrator as any).findings = [];\n\n    const report = orchestrator.generateReport('random task');\n\n    expect(report.recommendations.length).toBeGreaterThan(0);\n    expect(report.recommendations.some(r => r.toLowerCase().includes('review') || r.toLowerCase().includes('verify'))).toBe(true);\n  });\n});\n"],"mappings":"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","ignoreList":[]}