{"version":3,"names":["_nodeFs","require","_nodePath","_bashCommandGuidance","EDIT_WITHOUT_READ","exports","validateToolPreconditions","toolName","args","warnings","toolLower","toLowerCase","oldString","newString","filePath","startsWith","push","code","message","severity","suggestion","placeholderPatterns","hasStandalonePlaceholder","some","p","includes","test","oldHasTabs","newHasTabs","patternArg","pattern","trim","isGrepTool","isBroadBasePattern","isVeryBroadRegex","hasFileFilters","command","String","flowWarnings","analyzeBashFlow","flow","validateAIFlowPatterns","toolHistory","targetPath","normalizeFilePath","isNewFileCreation","isNewFileEdit","hasRecentRead","hasMatchingRead","now","Date","recencyWindowMs","recentValidations","filter","call","timestamp","length","recentStatusCalls","cmd","normalized","callLower","readPath","Boolean","pathValue","trimmed","normalizePath","absolutePath","isAbsolute","resolvePath","process","cwd","currentDir","dirname","suffix","basename","existsSync","realDir","realpathSync","join","parentDir"],"sources":["toolPreconditions.ts"],"sourcesContent":["import { existsSync, realpathSync } from 'node:fs';\nimport { basename, dirname, isAbsolute, join, normalize as normalizePath, resolve as resolvePath } from 'node:path';\nimport { analyzeBashFlow } from './bashCommandGuidance.js';\n\n/**\n * Pre-flight validation patterns for AI flow design.\n * Catches common tool usage failures before execution and provides actionable guidance.\n */\nexport interface PreflightWarning {\n  readonly code: string;\n  readonly message: string;\n  readonly severity: 'critical' | 'warning' | 'info';\n  readonly suggestion: string;\n}\n\nexport const EDIT_WITHOUT_READ = 'EDIT_WITHOUT_READ';\n\ntype ToolHistoryCall = {\n  toolName: string;\n  args: Record<string, unknown>;\n  timestamp?: number;\n};\n\n/**\n * Validate tool preconditions before execution to prevent common AI flow failures.\n *\n * This function implements the critical AI flow design principle: validate before execute.\n * It catches common patterns that lead to tool failures and provides actionable guidance.\n *\n * @param toolName - Name of the tool being called\n * @param args - Tool arguments\n * @returns Array of pre-flight warnings (empty if all validations pass)\n */\nexport function validateToolPreconditions(\n  toolName: string,\n  args: Record<string, unknown>\n): PreflightWarning[] {\n  const warnings: PreflightWarning[] = [];\n  const toolLower = toolName.toLowerCase();\n\n  // -------------------------------------------------------------------------\n  // Edit Tool Validation - Critical for AI software engineering flow\n  // -------------------------------------------------------------------------\n  if (toolLower === 'edit') {\n    const oldString = args['old_string'] as string | undefined;\n    const newString = args['new_string'] as string | undefined;\n    const filePath = args['file_path'] as string | undefined;\n\n    if (!oldString) {\n      // Empty old_string = new file creation - validate path structure\n      if (filePath && !filePath.startsWith('/')) {\n        warnings.push({\n          code: 'EDIT_RELATIVE_PATH',\n          message: 'Edit file_path should be absolute path for new file creation',\n          severity: 'warning',\n          suggestion: 'Use absolute path starting with / for file creation',\n        });\n      }\n    } else {\n      // PATTERN 1: Placeholder patterns - AI is guessing content (but NOT \"TODO\" which is legitimate code)\n      const placeholderPatterns = ['[content]', '[code]', '/* ... */', '// ...'];\n      // Only flag \"...\" if it's standalone, not as part of spread operator or ellipsis in comments\n      const hasStandalonePlaceholder = placeholderPatterns.some((p) => oldString.includes(p)) ||\n        /(?<!\\.)\\.\\.\\.(?!\\.)/.test(oldString); // Matches ... but not .... or .....\n      if (hasStandalonePlaceholder) {\n        warnings.push({\n          code: 'EDIT_PLACEHOLDER',\n          message: 'Placeholder patterns detected - HALLUCINATION ALERT',\n          severity: 'critical',\n          suggestion:\n            'AI is guessing content instead of reading actual file. ALWAYS use Read tool to get exact file content including whitespace.',\n        });\n      }\n\n      // PATTERN 2: Tab vs space mismatch (legitimate concern)\n      if (oldString && newString) {\n        const oldHasTabs = oldString.includes('\\t');\n        const newHasTabs = newString.includes('\\t');\n        if (oldHasTabs && !newHasTabs) {\n          warnings.push({\n            code: 'EDIT_WHITESPACE_MISMATCH',\n            message: 'old_string uses tabs, new_string uses spaces',\n            severity: 'warning',\n            suggestion: 'Whitespace type mismatch may cause Edit to fail.',\n          });\n        }\n      }\n    }\n  }\n\n  // -------------------------------------------------------------------------\n  // Search Operations Validation - Only flag truly problematic patterns\n  // -------------------------------------------------------------------------\n  if (toolLower === 'grep' || toolLower === 'glob' || toolLower.includes('search')) {\n    const patternArg = args['pattern'];\n    const pattern = typeof patternArg === 'string' ? patternArg.trim() : '';\n    const isGrepTool = toolLower.includes('grep');\n\n    if (pattern) {\n      // Only warn on truly broad patterns that would match everything\n      if (isBroadBasePattern(pattern)) {\n        warnings.push({\n          code: 'SEARCH_BROAD_PATTERN',\n          message: `Pattern '${pattern}' is too broad and may return thousands of files`,\n          severity: 'critical',\n          suggestion: \"Use targeted patterns like '**/*.ts' or 'src/**/*.js'.\",\n        });\n      }\n\n      // For grep: only warn on patterns that literally match everything\n      if (isGrepTool && isVeryBroadRegex(pattern)) {\n        const hasFileFilters = typeof args['glob'] === 'string' || typeof args['type'] === 'string';\n        if (!hasFileFilters) {\n          warnings.push({\n            code: 'SEARCH_CONTEXT_OVERFLOW_RISK',\n            message: `Regex pattern '${pattern}' matches everything`,\n            severity: 'warning',\n            suggestion: 'Use a more specific pattern or add a glob/type filter.',\n          });\n        }\n      }\n    }\n  }\n\n  // -------------------------------------------------------------------------\n  // Bash Command Efficiency\n  // -------------------------------------------------------------------------\n  if (toolLower === 'bash' || toolLower === 'execute_bash') {\n    const command = String(args['command'] || '');\n    const flowWarnings = analyzeBashFlow(command);\n\n    for (const flow of flowWarnings) {\n      warnings.push({\n        code: flow.code,\n        message: flow.message,\n        severity: flow.severity === 'critical' ? 'critical' : flow.severity === 'info' ? 'info' : 'warning',\n        suggestion: flow.suggestion ?? flow.message,\n      });\n    }\n  }\n\n  return warnings;\n}\n\n/**\n * Enhanced AI flow validation for TypeScript software engineering\n * Provides comprehensive validation of AI tool usage patterns\n */\nexport function validateAIFlowPatterns(\n  toolName: string,\n  args: Record<string, unknown>,\n  toolHistory: readonly ToolHistoryCall[]\n): PreflightWarning[] {\n  const warnings: PreflightWarning[] = [];\n  const toolLower = toolName.toLowerCase();\n\n  // Pattern: Edit without prior Read - Critical for hallucination reduction\n  if (toolLower === 'edit') {\n    const targetPath = normalizeFilePath(args['file_path']);\n    const isNewFileCreation = isNewFileEdit(args['old_string']);\n    const hasRecentRead = hasMatchingRead(toolHistory, targetPath);\n\n    if (!isNewFileCreation && !hasRecentRead) {\n      warnings.push({\n        code: EDIT_WITHOUT_READ,\n        message: 'Edit attempted without prior file read - HIGH HALLUCINATION RISK',\n        severity: 'critical',\n        suggestion: 'ALWAYS use Read tool first to get exact text including whitespace and indentation. Never guess file content.',\n      });\n    }\n  }\n\n  // Pattern: Multiple validation runs\n  if (toolLower === 'run_repo_checks' || toolLower === 'run_tests' || toolLower === 'run_build') {\n    const now = Date.now();\n    const recencyWindowMs = 15 * 60 * 1000; // Only warn when validations are clustered\n    const recentValidations = toolHistory\n      .filter((call) =>\n        call.toolName.toLowerCase().includes('run_') ||\n        call.toolName.toLowerCase().includes('test') ||\n        call.toolName.toLowerCase().includes('build')\n      )\n      .filter((call) => {\n        if (typeof call.timestamp !== 'number') {\n          return true;\n        }\n        return now - call.timestamp <= recencyWindowMs;\n      });\n\n    if (recentValidations.length > 0) {\n      warnings.push({\n        code: 'DEFERRED_VALIDATION_REMINDER',\n        message: 'Validation already ran recently; batch edits and run one final pass at the end.',\n        severity: 'info',\n        suggestion: 'Finish implementation work first, then run a single build/test/check step to validate.',\n      });\n    }\n  }\n\n  // Pattern: Excessive git status calls (actually wasteful)\n  // Note: Multiple git operations in sequence (add, commit, push) is fine - don't warn on that\n  if (toolLower.includes('git')) {\n    const command = String(args['command'] || '');\n    if (command.includes('git status')) {\n      const recentStatusCalls = toolHistory.filter(\n        (call) => {\n          const cmd = String(call.args['command'] || '');\n          return cmd.includes('git status');\n        }\n      );\n      // Only warn if there are 3+ status calls - 2 is normal (before and after operations)\n      if (recentStatusCalls.length >= 3) {\n        warnings.push({\n          code: 'GIT_REDUNDANT_STATUS',\n          message: 'Multiple git status calls detected',\n          severity: 'info',\n          suggestion: 'One git status call is usually sufficient.',\n        });\n      }\n    }\n  }\n\n  return warnings;\n}\n\nfunction isBroadBasePattern(pattern: string): boolean {\n  // Only the truly universal patterns that match everything\n  return pattern === '.' || pattern === '*' || pattern === '**' || pattern === '**/*';\n}\n\nfunction isVeryBroadRegex(pattern: string): boolean {\n  const normalized = pattern.trim();\n  return normalized === '.*' || normalized === '.+' || normalized === '.';\n}\n\nfunction hasMatchingRead(\n  toolHistory: readonly ToolHistoryCall[],\n  targetPath: string | null\n): boolean {\n  if (!targetPath) return false;\n\n  return toolHistory.some((call) => {\n    const callLower = call.toolName.toLowerCase();\n    if (!callLower.includes('read')) {\n      return false;\n    }\n\n    const readPath = normalizeFilePath(call.args['path'] ?? call.args['file_path']);\n    return Boolean(readPath && readPath === targetPath);\n  });\n}\n\nfunction isNewFileEdit(oldString: unknown): boolean {\n  return typeof oldString === 'string' && oldString.length === 0;\n}\n\nfunction normalizeFilePath(pathValue: unknown): string | null {\n  if (typeof pathValue !== 'string') {\n    return null;\n  }\n\n  const trimmed = pathValue.trim();\n  if (!trimmed) {\n    return null;\n  }\n\n  try {\n    const normalized = normalizePath(trimmed);\n    const absolutePath = isAbsolute(normalized) ? normalized : resolvePath(process.cwd(), normalized);\n\n    // Resolve symlinks on the deepest existing directory to avoid /var vs /private/var mismatches\n    let currentDir = dirname(absolutePath);\n    let suffix = basename(absolutePath);\n\n    // Loop until we find an existing ancestor or hit the filesystem root.\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      if (existsSync(currentDir)) {\n        try {\n          const realDir = realpathSync(currentDir);\n          return normalizePath(join(realDir, suffix));\n        } catch {\n          // If realpath fails, fall through to the default normalization\n          break;\n        }\n      }\n\n      const parentDir = dirname(currentDir);\n      if (parentDir === currentDir) {\n        break;\n      }\n\n      suffix = join(basename(currentDir), suffix);\n      currentDir = parentDir;\n    }\n\n    return normalizePath(absolutePath);\n  } catch {\n    return trimmed;\n  }\n}\n"],"mappings":";;;;;;;;AAAA,IAAAA,OAAA,GAAAC,OAAA;AACA,IAAAC,SAAA,GAAAD,OAAA;AACA,IAAAE,oBAAA,GAAAF,OAAA;AAEA;AACA;AACA;AACA;;AAQO,MAAMG,iBAAiB,GAAAC,OAAA,CAAAD,iBAAA,GAAG,mBAAmB;AAQpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASE,yBAAyBA,CACvCC,QAAgB,EAChBC,IAA6B,EACT;EACpB,MAAMC,QAA4B,GAAG,EAAE;EACvC,MAAMC,SAAS,GAAGH,QAAQ,CAACI,WAAW,CAAC,CAAC;;EAExC;EACA;EACA;EACA,IAAID,SAAS,KAAK,MAAM,EAAE;IACxB,MAAME,SAAS,GAAGJ,IAAI,CAAC,YAAY,CAAuB;IAC1D,MAAMK,SAAS,GAAGL,IAAI,CAAC,YAAY,CAAuB;IAC1D,MAAMM,QAAQ,GAAGN,IAAI,CAAC,WAAW,CAAuB;IAExD,IAAI,CAACI,SAAS,EAAE;MACd;MACA,IAAIE,QAAQ,IAAI,CAACA,QAAQ,CAACC,UAAU,CAAC,GAAG,CAAC,EAAE;QACzCN,QAAQ,CAACO,IAAI,CAAC;UACZC,IAAI,EAAE,oBAAoB;UAC1BC,OAAO,EAAE,8DAA8D;UACvEC,QAAQ,EAAE,SAAS;UACnBC,UAAU,EAAE;QACd,CAAC,CAAC;MACJ;IACF,CAAC,MAAM;MACL;MACA,MAAMC,mBAAmB,GAAG,CAAC,WAAW,EAAE,QAAQ,EAAE,WAAW,EAAE,QAAQ,CAAC;MAC1E;MACA,MAAMC,wBAAwB,GAAGD,mBAAmB,CAACE,IAAI,CAAEC,CAAC,IAAKZ,SAAS,CAACa,QAAQ,CAACD,CAAC,CAAC,CAAC,IACrF,qBAAqB,CAACE,IAAI,CAACd,SAAS,CAAC,CAAC,CAAC;MACzC,IAAIU,wBAAwB,EAAE;QAC5Bb,QAAQ,CAACO,IAAI,CAAC;UACZC,IAAI,EAAE,kBAAkB;UACxBC,OAAO,EAAE,qDAAqD;UAC9DC,QAAQ,EAAE,UAAU;UACpBC,UAAU,EACR;QACJ,CAAC,CAAC;MACJ;;MAEA;MACA,IAAIR,SAAS,IAAIC,SAAS,EAAE;QAC1B,MAAMc,UAAU,GAAGf,SAAS,CAACa,QAAQ,CAAC,IAAI,CAAC;QAC3C,MAAMG,UAAU,GAAGf,SAAS,CAACY,QAAQ,CAAC,IAAI,CAAC;QAC3C,IAAIE,UAAU,IAAI,CAACC,UAAU,EAAE;UAC7BnB,QAAQ,CAACO,IAAI,CAAC;YACZC,IAAI,EAAE,0BAA0B;YAChCC,OAAO,EAAE,8CAA8C;YACvDC,QAAQ,EAAE,SAAS;YACnBC,UAAU,EAAE;UACd,CAAC,CAAC;QACJ;MACF;IACF;EACF;;EAEA;EACA;EACA;EACA,IAAIV,SAAS,KAAK,MAAM,IAAIA,SAAS,KAAK,MAAM,IAAIA,SAAS,CAACe,QAAQ,CAAC,QAAQ,CAAC,EAAE;IAChF,MAAMI,UAAU,GAAGrB,IAAI,CAAC,SAAS,CAAC;IAClC,MAAMsB,OAAO,GAAG,OAAOD,UAAU,KAAK,QAAQ,GAAGA,UAAU,CAACE,IAAI,CAAC,CAAC,GAAG,EAAE;IACvE,MAAMC,UAAU,GAAGtB,SAAS,CAACe,QAAQ,CAAC,MAAM,CAAC;IAE7C,IAAIK,OAAO,EAAE;MACX;MACA,IAAIG,kBAAkB,CAACH,OAAO,CAAC,EAAE;QAC/BrB,QAAQ,CAACO,IAAI,CAAC;UACZC,IAAI,EAAE,sBAAsB;UAC5BC,OAAO,EAAE,YAAYY,OAAO,kDAAkD;UAC9EX,QAAQ,EAAE,UAAU;UACpBC,UAAU,EAAE;QACd,CAAC,CAAC;MACJ;;MAEA;MACA,IAAIY,UAAU,IAAIE,gBAAgB,CAACJ,OAAO,CAAC,EAAE;QAC3C,MAAMK,cAAc,GAAG,OAAO3B,IAAI,CAAC,MAAM,CAAC,KAAK,QAAQ,IAAI,OAAOA,IAAI,CAAC,MAAM,CAAC,KAAK,QAAQ;QAC3F,IAAI,CAAC2B,cAAc,EAAE;UACnB1B,QAAQ,CAACO,IAAI,CAAC;YACZC,IAAI,EAAE,8BAA8B;YACpCC,OAAO,EAAE,kBAAkBY,OAAO,sBAAsB;YACxDX,QAAQ,EAAE,SAAS;YACnBC,UAAU,EAAE;UACd,CAAC,CAAC;QACJ;MACF;IACF;EACF;;EAEA;EACA;EACA;EACA,IAAIV,SAAS,KAAK,MAAM,IAAIA,SAAS,KAAK,cAAc,EAAE;IACxD,MAAM0B,OAAO,GAAGC,MAAM,CAAC7B,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;IAC7C,MAAM8B,YAAY,GAAG,IAAAC,oCAAe,EAACH,OAAO,CAAC;IAE7C,KAAK,MAAMI,IAAI,IAAIF,YAAY,EAAE;MAC/B7B,QAAQ,CAACO,IAAI,CAAC;QACZC,IAAI,EAAEuB,IAAI,CAACvB,IAAI;QACfC,OAAO,EAAEsB,IAAI,CAACtB,OAAO;QACrBC,QAAQ,EAAEqB,IAAI,CAACrB,QAAQ,KAAK,UAAU,GAAG,UAAU,GAAGqB,IAAI,CAACrB,QAAQ,KAAK,MAAM,GAAG,MAAM,GAAG,SAAS;QACnGC,UAAU,EAAEoB,IAAI,CAACpB,UAAU,IAAIoB,IAAI,CAACtB;MACtC,CAAC,CAAC;IACJ;EACF;EAEA,OAAOT,QAAQ;AACjB;;AAEA;AACA;AACA;AACA;AACO,SAASgC,sBAAsBA,CACpClC,QAAgB,EAChBC,IAA6B,EAC7BkC,WAAuC,EACnB;EACpB,MAAMjC,QAA4B,GAAG,EAAE;EACvC,MAAMC,SAAS,GAAGH,QAAQ,CAACI,WAAW,CAAC,CAAC;;EAExC;EACA,IAAID,SAAS,KAAK,MAAM,EAAE;IACxB,MAAMiC,UAAU,GAAGC,iBAAiB,CAACpC,IAAI,CAAC,WAAW,CAAC,CAAC;IACvD,MAAMqC,iBAAiB,GAAGC,aAAa,CAACtC,IAAI,CAAC,YAAY,CAAC,CAAC;IAC3D,MAAMuC,aAAa,GAAGC,eAAe,CAACN,WAAW,EAAEC,UAAU,CAAC;IAE9D,IAAI,CAACE,iBAAiB,IAAI,CAACE,aAAa,EAAE;MACxCtC,QAAQ,CAACO,IAAI,CAAC;QACZC,IAAI,EAAEb,iBAAiB;QACvBc,OAAO,EAAE,kEAAkE;QAC3EC,QAAQ,EAAE,UAAU;QACpBC,UAAU,EAAE;MACd,CAAC,CAAC;IACJ;EACF;;EAEA;EACA,IAAIV,SAAS,KAAK,iBAAiB,IAAIA,SAAS,KAAK,WAAW,IAAIA,SAAS,KAAK,WAAW,EAAE;IAC7F,MAAMuC,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;IACtB,MAAME,eAAe,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;IACxC,MAAMC,iBAAiB,GAAGV,WAAW,CAClCW,MAAM,CAAEC,IAAI,IACXA,IAAI,CAAC/C,QAAQ,CAACI,WAAW,CAAC,CAAC,CAACc,QAAQ,CAAC,MAAM,CAAC,IAC5C6B,IAAI,CAAC/C,QAAQ,CAACI,WAAW,CAAC,CAAC,CAACc,QAAQ,CAAC,MAAM,CAAC,IAC5C6B,IAAI,CAAC/C,QAAQ,CAACI,WAAW,CAAC,CAAC,CAACc,QAAQ,CAAC,OAAO,CAC9C,CAAC,CACA4B,MAAM,CAAEC,IAAI,IAAK;MAChB,IAAI,OAAOA,IAAI,CAACC,SAAS,KAAK,QAAQ,EAAE;QACtC,OAAO,IAAI;MACb;MACA,OAAON,GAAG,GAAGK,IAAI,CAACC,SAAS,IAAIJ,eAAe;IAChD,CAAC,CAAC;IAEJ,IAAIC,iBAAiB,CAACI,MAAM,GAAG,CAAC,EAAE;MAChC/C,QAAQ,CAACO,IAAI,CAAC;QACZC,IAAI,EAAE,8BAA8B;QACpCC,OAAO,EAAE,iFAAiF;QAC1FC,QAAQ,EAAE,MAAM;QAChBC,UAAU,EAAE;MACd,CAAC,CAAC;IACJ;EACF;;EAEA;EACA;EACA,IAAIV,SAAS,CAACe,QAAQ,CAAC,KAAK,CAAC,EAAE;IAC7B,MAAMW,OAAO,GAAGC,MAAM,CAAC7B,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;IAC7C,IAAI4B,OAAO,CAACX,QAAQ,CAAC,YAAY,CAAC,EAAE;MAClC,MAAMgC,iBAAiB,GAAGf,WAAW,CAACW,MAAM,CACzCC,IAAI,IAAK;QACR,MAAMI,GAAG,GAAGrB,MAAM,CAACiB,IAAI,CAAC9C,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;QAC9C,OAAOkD,GAAG,CAACjC,QAAQ,CAAC,YAAY,CAAC;MACnC,CACF,CAAC;MACD;MACA,IAAIgC,iBAAiB,CAACD,MAAM,IAAI,CAAC,EAAE;QACjC/C,QAAQ,CAACO,IAAI,CAAC;UACZC,IAAI,EAAE,sBAAsB;UAC5BC,OAAO,EAAE,oCAAoC;UAC7CC,QAAQ,EAAE,MAAM;UAChBC,UAAU,EAAE;QACd,CAAC,CAAC;MACJ;IACF;EACF;EAEA,OAAOX,QAAQ;AACjB;AAEA,SAASwB,kBAAkBA,CAACH,OAAe,EAAW;EACpD;EACA,OAAOA,OAAO,KAAK,GAAG,IAAIA,OAAO,KAAK,GAAG,IAAIA,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,MAAM;AACrF;AAEA,SAASI,gBAAgBA,CAACJ,OAAe,EAAW;EAClD,MAAM6B,UAAU,GAAG7B,OAAO,CAACC,IAAI,CAAC,CAAC;EACjC,OAAO4B,UAAU,KAAK,IAAI,IAAIA,UAAU,KAAK,IAAI,IAAIA,UAAU,KAAK,GAAG;AACzE;AAEA,SAASX,eAAeA,CACtBN,WAAuC,EACvCC,UAAyB,EAChB;EACT,IAAI,CAACA,UAAU,EAAE,OAAO,KAAK;EAE7B,OAAOD,WAAW,CAACnB,IAAI,CAAE+B,IAAI,IAAK;IAChC,MAAMM,SAAS,GAAGN,IAAI,CAAC/C,QAAQ,CAACI,WAAW,CAAC,CAAC;IAC7C,IAAI,CAACiD,SAAS,CAACnC,QAAQ,CAAC,MAAM,CAAC,EAAE;MAC/B,OAAO,KAAK;IACd;IAEA,MAAMoC,QAAQ,GAAGjB,iBAAiB,CAACU,IAAI,CAAC9C,IAAI,CAAC,MAAM,CAAC,IAAI8C,IAAI,CAAC9C,IAAI,CAAC,WAAW,CAAC,CAAC;IAC/E,OAAOsD,OAAO,CAACD,QAAQ,IAAIA,QAAQ,KAAKlB,UAAU,CAAC;EACrD,CAAC,CAAC;AACJ;AAEA,SAASG,aAAaA,CAAClC,SAAkB,EAAW;EAClD,OAAO,OAAOA,SAAS,KAAK,QAAQ,IAAIA,SAAS,CAAC4C,MAAM,KAAK,CAAC;AAChE;AAEA,SAASZ,iBAAiBA,CAACmB,SAAkB,EAAiB;EAC5D,IAAI,OAAOA,SAAS,KAAK,QAAQ,EAAE;IACjC,OAAO,IAAI;EACb;EAEA,MAAMC,OAAO,GAAGD,SAAS,CAAChC,IAAI,CAAC,CAAC;EAChC,IAAI,CAACiC,OAAO,EAAE;IACZ,OAAO,IAAI;EACb;EAEA,IAAI;IACF,MAAML,UAAU,GAAG,IAAAM,mBAAa,EAACD,OAAO,CAAC;IACzC,MAAME,YAAY,GAAG,IAAAC,oBAAU,EAACR,UAAU,CAAC,GAAGA,UAAU,GAAG,IAAAS,iBAAW,EAACC,OAAO,CAACC,GAAG,CAAC,CAAC,EAAEX,UAAU,CAAC;;IAEjG;IACA,IAAIY,UAAU,GAAG,IAAAC,iBAAO,EAACN,YAAY,CAAC;IACtC,IAAIO,MAAM,GAAG,IAAAC,kBAAQ,EAACR,YAAY,CAAC;;IAEnC;IACA;IACA,OAAO,IAAI,EAAE;MACX,IAAI,IAAAS,kBAAU,EAACJ,UAAU,CAAC,EAAE;QAC1B,IAAI;UACF,MAAMK,OAAO,GAAG,IAAAC,oBAAY,EAACN,UAAU,CAAC;UACxC,OAAO,IAAAN,mBAAa,EAAC,IAAAa,cAAI,EAACF,OAAO,EAAEH,MAAM,CAAC,CAAC;QAC7C,CAAC,CAAC,MAAM;UACN;UACA;QACF;MACF;MAEA,MAAMM,SAAS,GAAG,IAAAP,iBAAO,EAACD,UAAU,CAAC;MACrC,IAAIQ,SAAS,KAAKR,UAAU,EAAE;QAC5B;MACF;MAEAE,MAAM,GAAG,IAAAK,cAAI,EAAC,IAAAJ,kBAAQ,EAACH,UAAU,CAAC,EAAEE,MAAM,CAAC;MAC3CF,UAAU,GAAGQ,SAAS;IACxB;IAEA,OAAO,IAAAd,mBAAa,EAACC,YAAY,CAAC;EACpC,CAAC,CAAC,MAAM;IACN,OAAOF,OAAO;EAChB;AACF","ignoreList":[]}