{"version":3,"names":["_nodeChild_process","require","_nodeUtil","_nodeFs","_nodePath","_nodeOs","_agiCore","execAsync","promisify","exec","loadHooks","workingDir","hooks","userSettingsPaths","join","homedir","projectSettingsPaths","settingsPath","existsSync","content","readFileSync","settings","JSON","parse","event","eventHooks","Object","entries","push","matchesHook","hook","context","matcher","regex","RegExp","toolName","test","executeCommandHook","command","success","error","timeout","env","process","HOOK_EVENT","HOOK_TOOL_NAME","HOOK_TOOL_ARGS","toolArgs","stringify","HOOK_TOOL_RESULT","toolResult","HOOK_USER_INPUT","userInput","HOOK_SESSION_ID","sessionId","HOOK_WORKING_DIR","stdout","cwd","output","trim","parsed","decision","reason","blocked","message","Error","String","includes","serializeArgs","args","_key","value","toString","buildPromptForHook","parts","prompt","filter","Boolean","assessPromptRisk","promptText","_analysis","lower","toLowerCase","reasons","destructivePatterns","cmd","some","re","score","length","formatPromptHookOutput","analysis","risk","lines","interpretation","intent","category","confidence","toFixed","tasks","map","t","id","description","clarificationNeeded","executePromptHook","start","Date","now","agi","getAGI","analyzePrompt","highRiskEvent","recordOperation","timestamp","duration","toolsUsed","errors","undefined","executeHook","type","HooksManager","constructor","reload","hasHooks","getHooks","executeHooks","results","result","executePreToolHooks","r","allowed","executePostToolHooks","executeUserPromptHooks","executeSessionHook","exports","createHooksManager"],"sources":["hooks.ts"],"sourcesContent":["/**\n * Hooks System\n *\n * Event-triggered scripts that automate workflows, based on AGI CLI's hooks architecture.\n * Hooks can execute shell commands or query an LLM for decisions.\n */\n\nimport { exec } from 'node:child_process';\nimport { promisify } from 'node:util';\nimport { existsSync, readFileSync } from 'node:fs';\nimport { join } from 'node:path';\nimport { homedir } from 'node:os';\nimport { getAGI, type PromptAnalysis } from './agiCore.js';\n\nconst execAsync = promisify(exec);\n\n/**\n * Hook event types\n */\nexport type HookEvent =\n  | 'PreToolUse'       // Before tool execution\n  | 'PostToolUse'      // After tool completes\n  | 'PermissionRequest' // User approval needed\n  | 'UserPromptSubmit' // User enters input\n  | 'SessionStart'     // Session begins\n  | 'SessionEnd'       // Session ends\n  | 'Stop'             // Main agent stops\n  | 'SubagentStop'     // Subagent finishes\n  | 'Notification';    // System alerts\n\n/**\n * Hook types\n */\nexport type HookType = 'command' | 'prompt';\n\n/**\n * Hook definition\n */\nexport interface HookDefinition {\n  /** Regex pattern to match tool names or events */\n  matcher?: string;\n  /** Type of hook: 'command' for shell, 'prompt' for LLM */\n  type: HookType;\n  /** Shell command to execute (for command hooks) */\n  command?: string;\n  /** Prompt to send to LLM (for prompt hooks) */\n  prompt?: string;\n  /** Timeout in milliseconds */\n  timeout?: number;\n}\n\n/**\n * Hook execution result\n */\nexport interface HookResult {\n  success: boolean;\n  output?: string;\n  decision?: 'allow' | 'deny' | 'continue';\n  reason?: string;\n  error?: string;\n  blocked?: boolean;\n}\n\n/**\n * Hook execution context\n */\nexport interface HookContext {\n  event: HookEvent;\n  toolName?: string;\n  toolArgs?: Record<string, unknown>;\n  toolResult?: string;\n  userInput?: string;\n  sessionId?: string;\n  workingDir: string;\n}\n\n/**\n * Hooks configuration\n */\nexport interface HooksConfig {\n  [event: string]: HookDefinition[];\n}\n\n/**\n * Settings file structure\n */\ninterface SettingsFile {\n  hooks?: HooksConfig;\n}\n\n/**\n * Load hooks from settings files\n */\nexport function loadHooks(workingDir: string): HooksConfig {\n  const hooks: HooksConfig = {};\n\n  // Load from user settings (~/.claude/settings.json or ~/.agi/settings.json)\n  const userSettingsPaths = [\n    join(homedir(), '.claude', 'settings.json'),\n    join(homedir(), '.agi', 'settings.json'),\n    join(homedir(), '.erosolar', 'settings.json'),\n  ];\n\n  // Load from project settings (.claude/settings.json or .agi/settings.json)\n  const projectSettingsPaths = [\n    join(workingDir, '.claude', 'settings.json'),\n    join(workingDir, '.agi', 'settings.json'),\n    join(workingDir, '.erosolar', 'settings.json'),\n  ];\n\n  // Load user settings first, then override with project settings\n  for (const settingsPath of [...userSettingsPaths, ...projectSettingsPaths]) {\n    if (existsSync(settingsPath)) {\n      try {\n        const content = readFileSync(settingsPath, 'utf-8');\n        const settings: SettingsFile = JSON.parse(content);\n\n        if (settings.hooks) {\n          for (const [event, eventHooks] of Object.entries(settings.hooks)) {\n            if (!hooks[event]) {\n              hooks[event] = [];\n            }\n            hooks[event].push(...eventHooks);\n          }\n        }\n      } catch {\n        // Ignore invalid settings files\n      }\n    }\n  }\n\n  return hooks;\n}\n\n/**\n * Check if a hook matches the given context\n */\nfunction matchesHook(hook: HookDefinition, context: HookContext): boolean {\n  if (!hook.matcher) {\n    return true;\n  }\n\n  try {\n    const regex = new RegExp(hook.matcher);\n\n    // Match against tool name if available\n    if (context.toolName) {\n      return regex.test(context.toolName);\n    }\n\n    // Match against event name\n    return regex.test(context.event);\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Execute a command hook\n */\nasync function executeCommandHook(\n  hook: HookDefinition,\n  context: HookContext\n): Promise<HookResult> {\n  if (!hook.command) {\n    return { success: false, error: 'No command specified' };\n  }\n\n      const timeout = hook.timeout ?? 24 * 60 * 60 * 1000;\n\n  // Prepare environment variables for the hook\n  const env = {\n    ...process.env,\n    HOOK_EVENT: context.event,\n    HOOK_TOOL_NAME: context.toolName ?? '',\n    HOOK_TOOL_ARGS: context.toolArgs ? JSON.stringify(context.toolArgs) : '',\n    HOOK_TOOL_RESULT: context.toolResult ?? '',\n    HOOK_USER_INPUT: context.userInput ?? '',\n    HOOK_SESSION_ID: context.sessionId ?? '',\n    HOOK_WORKING_DIR: context.workingDir,\n  };\n\n  try {\n    const { stdout } = await execAsync(hook.command, {\n      cwd: context.workingDir,\n      timeout,\n      env,\n    });\n\n    // Try to parse JSON output for structured results\n    const output = stdout.trim();\n    try {\n      const parsed = JSON.parse(output);\n      return {\n        success: true,\n        output,\n        decision: parsed.decision,\n        reason: parsed.reason,\n        blocked: parsed.blocked,\n      };\n    } catch {\n      // Return raw output if not JSON\n      return {\n        success: true,\n        output,\n      };\n    }\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n\n    // Exit code 2 means blocking\n    if (message.includes('exit code 2')) {\n      return {\n        success: false,\n        blocked: true,\n        error: message,\n      };\n    }\n\n    return {\n      success: false,\n      error: message,\n    };\n  }\n}\n\ninterface RiskAssessment {\n  score: number;\n  reasons: string[];\n}\n\nfunction serializeArgs(args?: Record<string, unknown>): string {\n  if (!args) return '';\n  try {\n    return JSON.stringify(args, (_key, value) => {\n      if (typeof value === 'bigint') {\n        return value.toString();\n      }\n      return value;\n    });\n  } catch {\n    return String(args);\n  }\n}\n\nfunction buildPromptForHook(hook: HookDefinition, context: HookContext): string {\n  const parts: string[] = [];\n\n  if (hook.prompt) {\n    parts.push(hook.prompt.trim());\n  }\n  parts.push(`Event: ${context.event}`);\n\n  if (context.userInput) {\n    parts.push(`User input: ${context.userInput}`);\n  }\n  if (context.toolName) {\n    parts.push(`Tool: ${context.toolName}`);\n  }\n  if (context.toolArgs) {\n    parts.push(`Args: ${serializeArgs(context.toolArgs)}`);\n  }\n  if (context.toolResult) {\n    parts.push(`Result: ${context.toolResult}`);\n  }\n\n  return parts.filter(Boolean).join('\\n');\n}\n\nfunction assessPromptRisk(promptText: string, context: HookContext, _analysis: PromptAnalysis): RiskAssessment {\n  const lower = promptText.toLowerCase();\n  const reasons: string[] = [];\n\n  const destructivePatterns = [\n    /rm\\s+-rf\\s+\\/?/,\n    /sudo\\s+rm\\s+-rf/,\n    /:\\(\\)\\s*{.*:.*\\|.*:.*;.*};\\s*:/, // fork bomb\n    /mkfs/i,\n    /format\\s+c:/i,\n    /shutdown\\s+-h/i,\n    /kill\\s+-9\\s+1/,\n    /dd\\s+if=\\/dev\\//i,\n  ];\n\n  if (typeof context.toolArgs?.['command'] === 'string') {\n    const cmd = String(context.toolArgs['command']).toLowerCase();\n    if (/rm\\s+-rf/.test(cmd) || /(^|\\s)del\\s+\\/f/i.test(cmd)) {\n      reasons.push('Destructive shell command');\n    }\n    if (/shutdown|reboot/.test(cmd)) {\n      reasons.push('System shutdown command');\n    }\n  }\n\n  if (destructivePatterns.some((re) => re.test(lower))) {\n    reasons.push('Destructive content detected');\n  }\n\n  const score = reasons.length > 0 ? 0.9 : 0.05;\n  return { score, reasons };\n}\n\nfunction formatPromptHookOutput(analysis: PromptAnalysis, risk: RiskAssessment): string {\n  const lines: string[] = [];\n  lines.push(`Interpretation: ${analysis.interpretation}`);\n  lines.push(`Intent: ${analysis.intent} (${analysis.category}, ${(analysis.confidence * 100).toFixed(0)}% conf)`);\n  lines.push(\n    analysis.tasks.length\n      ? `Tasks: ${analysis.tasks.map((t) => `[${t.id}] ${t.description}`).join(' | ')}`\n      : 'Tasks: none'\n  );\n  lines.push(`Risk: ${(risk.score * 100).toFixed(0)}%${risk.reasons.length ? ` (${risk.reasons.join('; ')})` : ''}`);\n  if (analysis.clarificationNeeded.length) {\n    lines.push(`Clarifications: ${analysis.clarificationNeeded.join('; ')}`);\n  }\n  return lines.join('\\n');\n}\n\n/**\n * Execute a prompt hook (would query LLM in full implementation)\n */\nasync function executePromptHook(\n  hook: HookDefinition,\n  context: HookContext\n): Promise<HookResult> {\n  if (!hook.prompt) {\n    return { success: false, error: 'No prompt specified' };\n  }\n\n  const start = Date.now();\n  const promptText = buildPromptForHook(hook, context);\n  const agi = getAGI(context.workingDir);\n  const analysis = agi.analyzePrompt(promptText);\n  const risk = assessPromptRisk(promptText, context, analysis);\n\n  const highRiskEvent =\n    context.event === 'PreToolUse' || context.event === 'PermissionRequest' || context.event === 'UserPromptSubmit';\n  const blocked = highRiskEvent && risk.score >= 0.75;\n  const decision: HookResult['decision'] = blocked ? 'deny' : 'continue';\n\n  agi.recordOperation({\n    id: `hook-${context.event}-${Date.now()}`,\n    prompt: promptText,\n    interpretation: analysis.interpretation,\n    tasks: analysis.tasks.map((t) => t.description),\n    success: !blocked,\n    timestamp: Date.now(),\n    duration: Date.now() - start,\n    toolsUsed: ['AGIHook'],\n    errors: blocked ? risk.reasons : undefined,\n  });\n\n  return {\n    success: true,\n    decision,\n    blocked,\n    reason: blocked\n      ? `High-risk content detected: ${risk.reasons.join('; ') || 'unspecified'}`\n      : `AGI analysis: ${analysis.interpretation} (risk ${(risk.score * 100).toFixed(0)}%)`,\n    output: formatPromptHookOutput(analysis, risk),\n  };\n}\n\n/**\n * Execute a single hook\n */\nasync function executeHook(\n  hook: HookDefinition,\n  context: HookContext\n): Promise<HookResult> {\n  switch (hook.type) {\n    case 'command':\n      return executeCommandHook(hook, context);\n    case 'prompt':\n      return executePromptHook(hook, context);\n    default:\n      return { success: false, error: `Unknown hook type: ${hook.type}` };\n  }\n}\n\n/**\n * HooksManager class for managing and executing hooks\n */\nexport class HooksManager {\n  private hooks: HooksConfig;\n  private workingDir: string;\n\n  constructor(workingDir: string) {\n    this.workingDir = workingDir;\n    this.hooks = loadHooks(workingDir);\n  }\n\n  /**\n   * Reload hooks from settings files\n   */\n  reload(): void {\n    this.hooks = loadHooks(this.workingDir);\n  }\n\n  /**\n   * Check if hooks are configured for an event\n   */\n  hasHooks(event: HookEvent): boolean {\n    return Boolean(this.hooks[event]?.length);\n  }\n\n  /**\n   * Get all hooks for an event\n   */\n  getHooks(event: HookEvent): HookDefinition[] {\n    return this.hooks[event] ?? [];\n  }\n\n  /**\n   * Execute all matching hooks for an event\n   */\n  async executeHooks(context: HookContext): Promise<HookResult[]> {\n    const eventHooks = this.hooks[context.event] ?? [];\n    const results: HookResult[] = [];\n\n    for (const hook of eventHooks) {\n      if (matchesHook(hook, context)) {\n        const result = await executeHook(hook, context);\n        results.push(result);\n\n        // Stop on blocking result\n        if (result.blocked) {\n          break;\n        }\n      }\n    }\n\n    return results;\n  }\n\n  /**\n   * Execute pre-tool hooks and check if tool should proceed\n   */\n  async executePreToolHooks(\n    toolName: string,\n    args: Record<string, unknown>\n  ): Promise<{ allowed: boolean; results: HookResult[] }> {\n    const context: HookContext = {\n      event: 'PreToolUse',\n      toolName,\n      toolArgs: args,\n      workingDir: this.workingDir,\n    };\n\n    const results = await this.executeHooks(context);\n\n    // Check if any hook blocked the operation\n    const blocked = results.some((r) => r.blocked || r.decision === 'deny');\n\n    return { allowed: !blocked, results };\n  }\n\n  /**\n   * Execute post-tool hooks\n   */\n  async executePostToolHooks(\n    toolName: string,\n    args: Record<string, unknown>,\n    result: string\n  ): Promise<HookResult[]> {\n    const context: HookContext = {\n      event: 'PostToolUse',\n      toolName,\n      toolArgs: args,\n      toolResult: result,\n      workingDir: this.workingDir,\n    };\n\n    return this.executeHooks(context);\n  }\n\n  /**\n   * Execute user prompt hooks\n   */\n  async executeUserPromptHooks(\n    userInput: string\n  ): Promise<{ allowed: boolean; results: HookResult[] }> {\n    const context: HookContext = {\n      event: 'UserPromptSubmit',\n      userInput,\n      workingDir: this.workingDir,\n    };\n\n    const results = await this.executeHooks(context);\n    const blocked = results.some((r) => r.blocked || r.decision === 'deny');\n\n    return { allowed: !blocked, results };\n  }\n\n  /**\n   * Execute session lifecycle hooks\n   */\n  async executeSessionHook(\n    event: 'SessionStart' | 'SessionEnd',\n    sessionId: string\n  ): Promise<HookResult[]> {\n    const context: HookContext = {\n      event,\n      sessionId,\n      workingDir: this.workingDir,\n    };\n\n    return this.executeHooks(context);\n  }\n}\n\n/**\n * Create a hooks manager for the given working directory\n */\nexport function createHooksManager(workingDir: string): HooksManager {\n  return new HooksManager(workingDir);\n}\n"],"mappings":"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","ignoreList":[]}