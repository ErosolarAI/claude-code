{"version":3,"names":["_nodeChild_process","require","_nodeFs","_nodePath","_nodeOs","SecurityUtils","sanitizeInput","input","replace","trim","slice","validateTarget","target","sanitized","ipPattern","hostnamePattern","test","executeSafe","command","args","timeout","Promise","resolve","reject","child","spawn","stdio","stdout","stderr","on","data","toString","code","exports","makeEvidenceFile","prefix","dir","mkdtempSync","join","tmpdir","filePath","writeFileSync","Date","toISOString","safeNmapScan","ports","sanitizedPorts","result","error","message","createSecureTaoTools","tools","addTool","name","description","handler","push","JSON","stringify","split","timestamp","security","system","capabilities","services","count","length","id"],"sources":["secureTaoTools.ts"],"sourcesContent":["\n/**\n * SECURE TAO TOOLS - Security Patched Version\n * All command injection vulnerabilities fixed\n * Input validation and sanitization implemented\n */\n\nimport { spawn } from 'node:child_process';\nimport { mkdtempSync, writeFileSync } from 'node:fs';\nimport { join } from 'node:path';\nimport { tmpdir } from 'node:os';\nimport type { ToolDefinition } from '../core/toolRuntime.js';\n\nexport class SecurityUtils {\n  static sanitizeInput(input: string): string {\n    if (!input) return '';\n    // Remove shell metacharacters\n    return input\n      .replace(/[;&|\\`$(){}[\\]<>!]/g, '')\n      .replace(/\\n/g, '')\n      .replace(/\\r/g, '')\n      .trim()\n      .slice(0, 255); // Limit length\n  }\n\n  static validateTarget(target: string): boolean {\n    const sanitized = this.sanitizeInput(target);\n    const ipPattern = /^(\\d{1,3}\\.){3}\\d{1,3}$/;\n    const hostnamePattern = /^[a-zA-Z0-9]([a-zA-Z0-9\\-]*[a-zA-Z0-9])?(\\.[a-zA-Z0-9]([a-zA-Z0-9\\-]*[a-zA-Z0-9])?)*$/;\n    return ipPattern.test(sanitized) || hostnamePattern.test(sanitized);\n  }\n\n  static async executeSafe(command: string, args: string[], timeout = 30000): Promise<{ stdout: string; stderr: string; code: number | null }> {\n    return new Promise<{ stdout: string; stderr: string; code: number | null }>((resolve, reject) => {\n      const child = spawn(command, args, {\n        timeout,\n        stdio: ['ignore', 'pipe', 'pipe']\n      });\n      \n      let stdout = '';\n      let stderr = '';\n      \n      child.stdout?.on('data', (data) => stdout += data.toString());\n      child.stderr?.on('data', (data) => stderr += data.toString());\n      \n      child.on('close', (code) => {\n        resolve({ stdout, stderr, code });\n      });\n      \n      child.on('error', reject);\n    });\n  }\n}\n\nexport function makeEvidenceFile(prefix: string): string {\n  const dir = mkdtempSync(join(tmpdir(), `${prefix}-`));\n  const filePath = join(dir, 'evidence.txt');\n  writeFileSync(filePath, `Secure execution - ${new Date().toISOString()}`);\n  return filePath;\n}\n\nexport async function safeNmapScan(target: string, ports = '80,443'): Promise<string> {\n  try {\n    if (!SecurityUtils.validateTarget(target)) {\n      return 'Invalid target';\n    }\n    \n    const sanitizedPorts = SecurityUtils.sanitizeInput(ports);\n    const result = await SecurityUtils.executeSafe('nmap', [\n      '-sT', '-T4', '-p', sanitizedPorts, target\n    ], 60000);\n    \n    if (result.code === 0) {\n      return result.stdout;\n    } else {\n      return `Scan failed: ${result.stderr}`;\n    }\n  } catch (error: any) {\n    return `Error: ${error.message}`;\n  }\n}\n\n// Main secure tools creation\nexport function createSecureTaoTools() {\n  const tools = [];\n  \n  const addTool = (name, description, handler) => {\n    tools.push({ name, description, handler });\n  };\n  \n  addTool('SecureScan', 'Safe network scanning', async (args) => {\n    const result = await safeNmapScan(args.target || 'localhost', args.ports);\n    return JSON.stringify({\n      target: args.target,\n      result: result.split('\\n').slice(0, 20),\n      timestamp: new Date().toISOString(),\n      security: 'VALIDATED'\n    }, null, 2);\n  });\n  \n  addTool('SafeInfo', 'Safe information gathering', async (args) => {\n    return JSON.stringify({\n      system: 'Secure AGI Core',\n      capabilities: ['safe_scanning', 'info_gathering'],\n      timestamp: new Date().toISOString()\n    }, null, 2);\n  });\n  \n  // Google-specific safe tools\n  addTool('GoogleSafeRecon', 'Safe Google service discovery', async (args) => {\n    const services = [\n      'www.google.com',\n      'mail.google.com',\n      'drive.google.com'\n    ];\n    \n    return JSON.stringify({\n      services,\n      count: services.length,\n      timestamp: new Date().toISOString(),\n      security: 'STATIC_LIST_NO_EXEC'\n    }, null, 2);\n  });\n  \n  return { id: 'secure-tao-tools', tools };\n}\n"],"mappings":"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","ignoreList":[]}