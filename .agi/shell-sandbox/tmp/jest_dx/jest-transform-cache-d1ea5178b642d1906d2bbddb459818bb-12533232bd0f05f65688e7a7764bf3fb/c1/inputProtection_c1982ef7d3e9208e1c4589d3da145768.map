{"version":3,"names":["_events","require","inputProtectionInstance","InputProtection","EventEmitter","inputTimings","lastKeystroke","burstCounter","suspicionScore","blockedAttacks","sanitizedInputs","isInPasteMode","pasteStartTime","dangerousEscapes","dangerousControls","unicodeAttacks","pattern","name","constructor","config","maxCharactersPerSecond","maxPasteSize","maxBufferSize","detectTimingAttacks","minKeystrokeInterval","maxBurstSize","strictMode","verbose","onAttackDetected","validateInput","input","isPaste","now","Date","sanitized","blocked","reason","attackType","riskScore","push","timestamp","charCount","length","cleanOldTimings","slice","interval","Math","round","log","max","recentChars","getRecentCharCount","escapeResult","checkEscapeSequences","found","type","controlResult","checkControlCharacters","chars","join","unicodeResult","checkUnicodeAttacks","cps","calculateCPS","emit","allowed","enterPasteMode","exitPasteMode","duration","isPasting","validatePromptSubmission","prompt","reset","getStats","currentSuspicion","currentCPS","test","source","replace","RegExp","foundChars","i","code","charCodeAt","includes","toString","padStart","attack","cutoff","filter","t","windowMs","reduce","sum","recentTimings","totalChars","timeSpan","message","process","env","console","error","exports","initializeInputProtection","getInputProtection","validateChatInput","protection","validatePromptSubmit"],"sources":["inputProtection.ts"],"sourcesContent":["/**\n * Input Protection System - Guards against remote attacks on chat input\n *\n * Protects against:\n * 1. Remote stdin injection attacks\n * 2. Automated paste attacks (superhuman typing speed)\n * 3. Escape sequence injection via clipboard\n * 4. Buffer overflow attempts (massive pastes)\n * 5. Control character injection\n * 6. Unicode-based attacks (homoglyphs, RTL override)\n * 7. Timing-based attacks (burst injection)\n *\n * @module inputProtection\n */\n\nimport { EventEmitter } from 'events';\n\n/** Input validation result */\nexport interface InputValidation {\n  allowed: boolean;\n  sanitized: string;\n  blocked: boolean;\n  reason?: string;\n  attackType?: InputAttackType;\n  riskScore: number; // 0-100\n}\n\n/** Types of input attacks */\nexport type InputAttackType =\n  | 'automated_injection'   // Input faster than human typing\n  | 'escape_injection'      // Terminal escape sequences\n  | 'control_injection'     // Control characters (Ctrl+C, etc.)\n  | 'overflow_attempt'      // Extremely large input\n  | 'unicode_attack'        // RTL override, homoglyphs\n  | 'timing_burst'          // Rapid burst of inputs\n  | 'remote_paste'          // Detected remote paste attack\n  | 'stdin_hijack';         // Stdin manipulation\n\n/** Input protection configuration */\nexport interface InputProtectionConfig {\n  /** Maximum characters per second (human ~12 CPS, paste unlimited) */\n  maxCharactersPerSecond?: number;\n  /** Maximum paste size in characters */\n  maxPasteSize?: number;\n  /** Maximum total buffer size */\n  maxBufferSize?: number;\n  /** Enable timing-based attack detection */\n  detectTimingAttacks?: boolean;\n  /** Minimum interval between keystrokes in ms (human ~50ms+) */\n  minKeystrokeInterval?: number;\n  /** Maximum burst size before suspicion */\n  maxBurstSize?: number;\n  /** Enable strict mode (blocks suspicious input instead of sanitizing) */\n  strictMode?: boolean;\n  /** Verbose logging */\n  verbose?: boolean;\n  /** Callback on attack detection */\n  onAttackDetected?: (type: InputAttackType, details: string) => void;\n}\n\n/** Input timing tracking */\ninterface InputTiming {\n  timestamp: number;\n  charCount: number;\n}\n\n/** Singleton instance */\nlet inputProtectionInstance: InputProtection | null = null;\n\n/**\n * Input Protection System\n */\nexport class InputProtection extends EventEmitter {\n  private config: Required<InputProtectionConfig>;\n  private inputTimings: InputTiming[] = [];\n  private lastKeystroke = 0;\n  private burstCounter = 0;\n  private suspicionScore = 0;\n  private blockedAttacks = 0;\n  private sanitizedInputs = 0;\n  private isInPasteMode = false;\n  private pasteStartTime = 0;\n\n  // Dangerous escape sequences to block\n  private readonly dangerousEscapes: RegExp[] = [\n    /\\x1b\\][0-9]+;/,           // OSC sequences (can change terminal title, etc.)\n    /\\x1b[PX^_]/,              // DCS, SOS, PM, APC sequences\n    /\\x1b\\[[\\d;]*[pls]/i,      // Soft reset, various terminal modes\n    /\\x1b\\[\\?[\\d;]*[hl]/,      // Private mode sets (can enable dangerous modes)\n    /\\x1b\\[[\\d;]*n/,           // Device status queries (info leak)\n    /\\x1b\\[[\\d;]*q/,           // Keyboard LED control\n    /\\x1bP[^\\\\]*\\x1b\\\\/,       // Complete DCS sequence\n    /\\x1b\\]0;[^\\x07]*\\x07/,    // Title set sequence\n    /\\x1b\\]52;/,               // Clipboard manipulation sequence\n  ];\n\n  // Dangerous control characters\n  private readonly dangerousControls: number[] = [\n    0x00, // NUL - can cause issues\n    0x01, // SOH\n    0x02, // STX\n    0x03, // ETX (Ctrl+C) - allow but track\n    0x04, // EOT (Ctrl+D) - allow but track\n    0x05, // ENQ\n    0x06, // ACK\n    0x07, // BEL - annoying beep\n    0x0E, // SO - shift out\n    0x0F, // SI - shift in\n    0x10, // DLE\n    0x11, // DC1 (XON)\n    0x12, // DC2\n    0x13, // DC3 (XOFF)\n    0x14, // DC4\n    0x15, // NAK\n    0x16, // SYN\n    0x17, // ETB\n    0x18, // CAN\n    0x19, // EM\n    0x1A, // SUB (Ctrl+Z)\n    0x1C, // FS\n    0x1D, // GS\n    0x1E, // RS\n    0x1F, // US\n    0x7F, // DEL\n  ];\n\n  // Unicode attack patterns\n  private readonly unicodeAttacks: Array<{ pattern: RegExp | string; name: string }> = [\n    { pattern: /\\u202E/, name: 'RTL override' },      // Right-to-left override\n    { pattern: /\\u202D/, name: 'LTR override' },      // Left-to-right override\n    { pattern: /\\u202A/, name: 'LTR embedding' },     // Left-to-right embedding\n    { pattern: /\\u202B/, name: 'RTL embedding' },     // Right-to-left embedding\n    { pattern: /\\u202C/, name: 'Pop direction' },     // Pop directional formatting\n    { pattern: /\\u2066/, name: 'LTR isolate' },       // Left-to-right isolate\n    { pattern: /\\u2067/, name: 'RTL isolate' },       // Right-to-left isolate\n    { pattern: /\\u2068/, name: 'First strong isolate' },\n    { pattern: /\\u2069/, name: 'Pop isolate' },       // Pop directional isolate\n    { pattern: /\\u200E/, name: 'LTR mark' },          // Left-to-right mark\n    { pattern: /\\u200F/, name: 'RTL mark' },          // Right-to-left mark\n    { pattern: /\\uFEFF/, name: 'BOM' },               // Byte order mark\n    { pattern: /[\\u200B-\\u200D]/, name: 'Zero-width chars' }, // Zero-width spaces/joiners\n  ];\n\n  constructor(config: InputProtectionConfig = {}) {\n    super();\n    this.config = {\n      maxCharactersPerSecond: config.maxCharactersPerSecond ?? 500,  // Allow fast paste\n      maxPasteSize: config.maxPasteSize ?? 100000,                   // 100KB max paste\n      maxBufferSize: config.maxBufferSize ?? 500000,                 // 500KB max buffer\n      detectTimingAttacks: config.detectTimingAttacks ?? true,\n      minKeystrokeInterval: config.minKeystrokeInterval ?? 5,        // 5ms minimum (200 CPS)\n      maxBurstSize: config.maxBurstSize ?? 1000,                     // Chars before suspicion\n      strictMode: config.strictMode ?? false,\n      verbose: config.verbose ?? false,\n      onAttackDetected: config.onAttackDetected ?? (() => {}),\n    };\n  }\n\n  /**\n   * Validate and sanitize input before it enters the chat buffer\n   */\n  validateInput(input: string, isPaste = false): InputValidation {\n    const now = Date.now();\n    let sanitized = input;\n    let blocked = false;\n    let reason: string | undefined;\n    let attackType: InputAttackType | undefined;\n    let riskScore = 0;\n\n    // Track timing\n    this.inputTimings.push({ timestamp: now, charCount: input.length });\n    this.cleanOldTimings();\n\n    // === Size validation ===\n    if (isPaste && input.length > this.config.maxPasteSize) {\n      riskScore += 30;\n      if (this.config.strictMode) {\n        blocked = true;\n        reason = `Paste size ${input.length} exceeds limit ${this.config.maxPasteSize}`;\n        attackType = 'overflow_attempt';\n      } else {\n        sanitized = input.slice(0, this.config.maxPasteSize);\n        reason = `Truncated paste from ${input.length} to ${this.config.maxPasteSize}`;\n      }\n      this.sanitizedInputs++;\n    }\n\n    // === Timing analysis ===\n    if (this.config.detectTimingAttacks && !isPaste) {\n      const interval = now - this.lastKeystroke;\n      if (interval > 0 && interval < this.config.minKeystrokeInterval) {\n        // Suspiciously fast keystrokes\n        this.suspicionScore += 5;\n        riskScore += 10;\n\n        if (this.suspicionScore > 50) {\n          attackType = 'automated_injection';\n          reason = `Automated input detected (${Math.round(1000 / interval)} CPS)`;\n          this.log(`Suspicion score: ${this.suspicionScore}, interval: ${interval}ms`);\n        }\n      } else {\n        // Normal typing - decrease suspicion\n        this.suspicionScore = Math.max(0, this.suspicionScore - 1);\n      }\n    }\n    this.lastKeystroke = now;\n\n    // === Burst detection ===\n    const recentChars = this.getRecentCharCount(100); // Last 100ms\n    if (recentChars > this.config.maxBurstSize) {\n      this.burstCounter++;\n      riskScore += 20;\n\n      if (this.burstCounter > 3) {\n        attackType = 'timing_burst';\n        reason = `Burst injection detected (${recentChars} chars in 100ms)`;\n        if (this.config.strictMode) {\n          blocked = true;\n        }\n      }\n    } else {\n      this.burstCounter = Math.max(0, this.burstCounter - 1);\n    }\n\n    // === Escape sequence validation ===\n    const escapeResult = this.checkEscapeSequences(sanitized);\n    if (escapeResult.found) {\n      riskScore += 40;\n      attackType = 'escape_injection';\n      reason = `Dangerous escape sequence: ${escapeResult.type}`;\n      sanitized = escapeResult.sanitized;\n      this.sanitizedInputs++;\n\n      if (this.config.strictMode) {\n        blocked = true;\n      }\n    }\n\n    // === Control character validation ===\n    const controlResult = this.checkControlCharacters(sanitized);\n    if (controlResult.found) {\n      riskScore += 15;\n      if (!attackType) {\n        attackType = 'control_injection';\n        reason = `Control characters detected: ${controlResult.chars.join(', ')}`;\n      }\n      sanitized = controlResult.sanitized;\n      this.sanitizedInputs++;\n    }\n\n    // === Unicode attack detection ===\n    const unicodeResult = this.checkUnicodeAttacks(sanitized);\n    if (unicodeResult.found) {\n      riskScore += 30;\n      if (!attackType) {\n        attackType = 'unicode_attack';\n        reason = `Unicode attack: ${unicodeResult.type}`;\n      }\n      sanitized = unicodeResult.sanitized;\n      this.sanitizedInputs++;\n    }\n\n    // === Rate limiting check ===\n    const cps = this.calculateCPS();\n    if (cps > this.config.maxCharactersPerSecond && !isPaste) {\n      riskScore += 25;\n      if (!attackType) {\n        attackType = 'automated_injection';\n        reason = `Rate limit exceeded: ${Math.round(cps)} CPS`;\n      }\n\n      if (this.config.strictMode && cps > this.config.maxCharactersPerSecond * 2) {\n        blocked = true;\n      }\n    }\n\n    // Log attack detection\n    if (attackType && riskScore > 30) {\n      this.blockedAttacks++;\n      this.config.onAttackDetected?.(attackType, reason || 'Unknown');\n      this.emit('attack_detected', { type: attackType, reason, riskScore });\n      this.log(`Attack detected: ${attackType} - ${reason} (risk: ${riskScore})`);\n    }\n\n    return {\n      allowed: !blocked,\n      sanitized: blocked ? '' : sanitized,\n      blocked,\n      reason,\n      attackType,\n      riskScore,\n    };\n  }\n\n  /**\n   * Enter paste mode (more lenient validation)\n   */\n  enterPasteMode(): void {\n    this.isInPasteMode = true;\n    this.pasteStartTime = Date.now();\n    this.log('Entered paste mode');\n  }\n\n  /**\n   * Exit paste mode\n   */\n  exitPasteMode(): void {\n    const duration = Date.now() - this.pasteStartTime;\n    this.isInPasteMode = false;\n    this.log(`Exited paste mode (duration: ${duration}ms)`);\n  }\n\n  /**\n   * Check if currently in paste mode\n   */\n  isPasting(): boolean {\n    return this.isInPasteMode;\n  }\n\n  /**\n   * Validate a complete prompt before submission\n   */\n  validatePromptSubmission(prompt: string): InputValidation {\n    // Final validation before sending to AI\n    let sanitized = prompt;\n    let riskScore = 0;\n    let attackType: InputAttackType | undefined;\n    let reason: string | undefined;\n\n    // Check total size\n    if (prompt.length > this.config.maxBufferSize) {\n      riskScore += 50;\n      attackType = 'overflow_attempt';\n      reason = `Prompt exceeds buffer limit`;\n      sanitized = prompt.slice(0, this.config.maxBufferSize);\n    }\n\n    // Final escape sequence check\n    const escapeResult = this.checkEscapeSequences(sanitized);\n    if (escapeResult.found) {\n      riskScore += 30;\n      sanitized = escapeResult.sanitized;\n    }\n\n    // Final unicode check\n    const unicodeResult = this.checkUnicodeAttacks(sanitized);\n    if (unicodeResult.found) {\n      riskScore += 20;\n      sanitized = unicodeResult.sanitized;\n    }\n\n    return {\n      allowed: true,\n      sanitized,\n      blocked: false,\n      reason,\n      attackType,\n      riskScore,\n    };\n  }\n\n  /**\n   * Reset protection state (e.g., after idle period)\n   */\n  reset(): void {\n    this.inputTimings = [];\n    this.lastKeystroke = 0;\n    this.burstCounter = 0;\n    this.suspicionScore = 0;\n    this.isInPasteMode = false;\n  }\n\n  /**\n   * Get protection statistics\n   */\n  getStats(): {\n    blockedAttacks: number;\n    sanitizedInputs: number;\n    currentSuspicion: number;\n    currentCPS: number;\n  } {\n    return {\n      blockedAttacks: this.blockedAttacks,\n      sanitizedInputs: this.sanitizedInputs,\n      currentSuspicion: this.suspicionScore,\n      currentCPS: this.calculateCPS(),\n    };\n  }\n\n  // === Private helper methods ===\n\n  private checkEscapeSequences(input: string): { found: boolean; type?: string; sanitized: string } {\n    let sanitized = input;\n    let found = false;\n    let type: string | undefined;\n\n    for (const pattern of this.dangerousEscapes) {\n      if (pattern.test(sanitized)) {\n        found = true;\n        type = pattern.source;\n        sanitized = sanitized.replace(new RegExp(pattern.source, 'g'), '');\n      }\n    }\n\n    return { found, type, sanitized };\n  }\n\n  private checkControlCharacters(input: string): { found: boolean; chars: string[]; sanitized: string } {\n    const foundChars: string[] = [];\n    let sanitized = '';\n\n    for (let i = 0; i < input.length; i++) {\n      const code = input.charCodeAt(i);\n\n      // Allow normal control characters: Tab (9), Newline (10), Carriage Return (13), Escape (27 - for legit sequences)\n      if (code === 9 || code === 10 || code === 13) {\n        sanitized += input[i];\n        continue;\n      }\n\n      // Block dangerous control characters\n      if (this.dangerousControls.includes(code)) {\n        foundChars.push(`0x${code.toString(16).padStart(2, '0')}`);\n        continue;\n      }\n\n      sanitized += input[i];\n    }\n\n    return {\n      found: foundChars.length > 0,\n      chars: foundChars,\n      sanitized,\n    };\n  }\n\n  private checkUnicodeAttacks(input: string): { found: boolean; type?: string; sanitized: string } {\n    let sanitized = input;\n    let found = false;\n    let type: string | undefined;\n\n    for (const attack of this.unicodeAttacks) {\n      const pattern = typeof attack.pattern === 'string'\n        ? new RegExp(attack.pattern.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'), 'g')\n        : attack.pattern;\n\n      if (pattern.test(sanitized)) {\n        found = true;\n        type = attack.name;\n        sanitized = sanitized.replace(pattern, '');\n      }\n    }\n\n    return { found, type, sanitized };\n  }\n\n  private cleanOldTimings(): void {\n    const cutoff = Date.now() - 1000; // Keep last 1 second\n    this.inputTimings = this.inputTimings.filter(t => t.timestamp > cutoff);\n  }\n\n  private getRecentCharCount(windowMs: number): number {\n    const cutoff = Date.now() - windowMs;\n    return this.inputTimings\n      .filter(t => t.timestamp > cutoff)\n      .reduce((sum, t) => sum + t.charCount, 0);\n  }\n\n  private calculateCPS(): number {\n    if (this.inputTimings.length < 2) return 0;\n\n    const now = Date.now();\n    const windowMs = 1000;\n    const cutoff = now - windowMs;\n    const recentTimings = this.inputTimings.filter(t => t.timestamp > cutoff);\n\n    if (recentTimings.length === 0) return 0;\n\n    const totalChars = recentTimings.reduce((sum, t) => sum + t.charCount, 0);\n    const timeSpan = now - recentTimings[0].timestamp;\n\n    return timeSpan > 0 ? (totalChars / timeSpan) * 1000 : 0;\n  }\n\n  private log(message: string): void {\n    if (this.config.verbose || process.env['AGI_DEBUG']) {\n      console.error(`[InputProtection] ${message}`);\n    }\n  }\n}\n\n/**\n * Initialize global input protection (singleton)\n */\nexport function initializeInputProtection(config?: InputProtectionConfig): InputProtection {\n  if (!inputProtectionInstance) {\n    inputProtectionInstance = new InputProtection(config);\n  }\n  return inputProtectionInstance;\n}\n\n/**\n * Get input protection instance\n */\nexport function getInputProtection(): InputProtection | null {\n  return inputProtectionInstance;\n}\n\n/**\n * Quick validate function for input\n */\nexport function validateChatInput(input: string, isPaste = false): InputValidation {\n  const protection = inputProtectionInstance ?? new InputProtection();\n  return protection.validateInput(input, isPaste);\n}\n\n/**\n * Validate final prompt before submission\n */\nexport function validatePromptSubmit(prompt: string): InputValidation {\n  const protection = inputProtectionInstance ?? new InputProtection();\n  return protection.validatePromptSubmission(prompt);\n}\n\n// Auto-initialize if environment variable is set\nif (process.env['AGI_INPUT_PROTECTION'] === '1' || process.env['AGI_PROTECTED_MODE'] === '1') {\n  initializeInputProtection({ verbose: process.env['AGI_DEBUG'] === '1' });\n}\n"],"mappings":"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","ignoreList":[]}