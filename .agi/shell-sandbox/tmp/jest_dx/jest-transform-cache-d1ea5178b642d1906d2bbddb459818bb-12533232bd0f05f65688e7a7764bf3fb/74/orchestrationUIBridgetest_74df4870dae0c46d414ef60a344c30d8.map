{"version":3,"names":["_nodeEvents","require","_OrchestrationUIBridge","_UIUpdateCoordinator","FakeDisplay","writes","writeRaw","text","push","showError","_title","_error","showSystemMessage","_message","FakeOrchestrator","EventEmitter","executeCalls","objectives","constructor","results","findings","execute","config","objective","start","Date","now","emitEvent","type","timestamp","data","toolId","toolName","description","index","success","output","duration","end","id","startTime","endTime","summary","onEvent","callback","on","off","getResults","getFindings","analyze","exec","command","Promise","resolve","event","emit","describe","test","coordinator","UIUpdateCoordinator","display","orchestrator","bridge","OrchestrationUIBridge","updateCoordinator","showRealTimeOutput","showProgressBar","verboseMode","report","expect","toBe","toContain","getMode","dispose","executed","enqueue","lane","run","setTimeout","isDisposed","toEqual"],"sources":["orchestrationUIBridge.test.ts"],"sourcesContent":["import { EventEmitter } from 'node:events';\nimport { OrchestrationUIBridge } from '../src/ui/orchestration/OrchestrationUIBridge.js';\nimport { UIUpdateCoordinator } from '../src/ui/orchestration/UIUpdateCoordinator.js';\nimport type {\n  ExecutionResult,\n  Finding,\n  OperationConfig,\n  OperationReport,\n  OrchestratorEvent,\n} from '../src/core/unifiedOrchestrator.js';\n\nclass FakeDisplay {\n  writes: string[] = [];\n  writeRaw(text: string): void {\n    this.writes.push(text);\n  }\n  showError(_title: string, _error: unknown): void {}\n  showSystemMessage(_message: string): void {}\n}\n\nclass FakeOrchestrator extends EventEmitter {\n  executeCalls = 0;\n  objectives: string[] = [];\n  private readonly results: ExecutionResult[];\n  private readonly findings: Finding[];\n\n  constructor(results: ExecutionResult[] = [], findings: Finding[] = []) {\n    super();\n    this.results = results;\n    this.findings = findings;\n  }\n\n  async execute(config: Partial<OperationConfig>): Promise<OperationReport> {\n    this.executeCalls++;\n    if (config.objective) {\n      this.objectives.push(config.objective);\n    }\n\n    const start = Date.now();\n\n    this.emitEvent({\n      type: 'tool:start',\n      timestamp: start,\n      data: { toolId: '1', toolName: 'test', description: 'running', index: 1 },\n    });\n    this.emitEvent({\n      type: 'tool:complete',\n      timestamp: start + 5,\n      data: { toolId: '1', toolName: 'test', success: true, output: 'ok', duration: 5 },\n    });\n\n    const end = start + 10;\n    return {\n      id: 'fake',\n      objective: config.objective ?? '',\n      startTime: start,\n      endTime: end,\n      duration: end - start,\n      results: this.results,\n      findings: this.findings,\n      summary: 'ok',\n      success: true,\n    };\n  }\n\n  onEvent(callback: (event: OrchestratorEvent) => void): () => void {\n    this.on('orchestrator:event', callback);\n    return () => this.off('orchestrator:event', callback);\n  }\n\n  getResults(): ExecutionResult[] {\n    return this.results;\n  }\n\n  getFindings(): Finding[] {\n    return this.findings;\n  }\n\n  analyze(): Finding[] {\n    return [];\n  }\n\n  exec(command: string): Promise<ExecutionResult> {\n    return Promise.resolve({ success: true, output: '', duration: 0, command });\n  }\n\n  private emitEvent(event: OrchestratorEvent): void {\n    this.emit('orchestrator:event', event);\n  }\n}\n\ndescribe('OrchestrationUIBridge with external wiring', () => {\n  test('reuses provided orchestrator and leaves shared coordinator active', async () => {\n    const coordinator = new UIUpdateCoordinator();\n    const display = new FakeDisplay();\n    const orchestrator = new FakeOrchestrator([\n      { success: true, output: 'ok', duration: 5, command: 'echo ok' },\n    ]);\n\n    const bridge = new OrchestrationUIBridge({\n      display,\n      updateCoordinator: coordinator,\n      orchestrator,\n      showRealTimeOutput: false,\n      showProgressBar: false,\n      verboseMode: false,\n    });\n\n    const report = await bridge.execute('demo objective');\n\n    expect(report.success).toBe(true);\n    expect(orchestrator.executeCalls).toBe(1);\n    expect(orchestrator.objectives).toContain('demo objective');\n    expect(coordinator.getMode()).toBe('idle');\n\n    bridge.dispose();\n\n    const executed: string[] = [];\n    coordinator.enqueue({\n      lane: 'status',\n      run: () => executed.push('after'),\n    });\n    await new Promise((resolve) => setTimeout(resolve, 15));\n\n    expect(coordinator.isDisposed()).toBe(false);\n    expect(executed).toEqual(['after']);\n  });\n});\n"],"mappings":";;AAAA,IAAAA,WAAA,GAAAC,OAAA;AACA,IAAAC,sBAAA,GAAAD,OAAA;AACA,IAAAE,oBAAA,GAAAF,OAAA;AASA,MAAMG,WAAW,CAAC;EAChBC,MAAM,GAAa,EAAE;EACrBC,QAAQA,CAACC,IAAY,EAAQ;IAC3B,IAAI,CAACF,MAAM,CAACG,IAAI,CAACD,IAAI,CAAC;EACxB;EACAE,SAASA,CAACC,MAAc,EAAEC,MAAe,EAAQ,CAAC;EAClDC,iBAAiBA,CAACC,QAAgB,EAAQ,CAAC;AAC7C;AAEA,MAAMC,gBAAgB,SAASC,wBAAY,CAAC;EAC1CC,YAAY,GAAG,CAAC;EAChBC,UAAU,GAAa,EAAE;EAIzBC,WAAWA,CAACC,OAA0B,GAAG,EAAE,EAAEC,QAAmB,GAAG,EAAE,EAAE;IACrE,KAAK,CAAC,CAAC;IACP,IAAI,CAACD,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACC,QAAQ,GAAGA,QAAQ;EAC1B;EAEA,MAAMC,OAAOA,CAACC,MAAgC,EAA4B;IACxE,IAAI,CAACN,YAAY,EAAE;IACnB,IAAIM,MAAM,CAACC,SAAS,EAAE;MACpB,IAAI,CAACN,UAAU,CAACT,IAAI,CAACc,MAAM,CAACC,SAAS,CAAC;IACxC;IAEA,MAAMC,KAAK,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;IAExB,IAAI,CAACC,SAAS,CAAC;MACbC,IAAI,EAAE,YAAY;MAClBC,SAAS,EAAEL,KAAK;MAChBM,IAAI,EAAE;QAAEC,MAAM,EAAE,GAAG;QAAEC,QAAQ,EAAE,MAAM;QAAEC,WAAW,EAAE,SAAS;QAAEC,KAAK,EAAE;MAAE;IAC1E,CAAC,CAAC;IACF,IAAI,CAACP,SAAS,CAAC;MACbC,IAAI,EAAE,eAAe;MACrBC,SAAS,EAAEL,KAAK,GAAG,CAAC;MACpBM,IAAI,EAAE;QAAEC,MAAM,EAAE,GAAG;QAAEC,QAAQ,EAAE,MAAM;QAAEG,OAAO,EAAE,IAAI;QAAEC,MAAM,EAAE,IAAI;QAAEC,QAAQ,EAAE;MAAE;IAClF,CAAC,CAAC;IAEF,MAAMC,GAAG,GAAGd,KAAK,GAAG,EAAE;IACtB,OAAO;MACLe,EAAE,EAAE,MAAM;MACVhB,SAAS,EAAED,MAAM,CAACC,SAAS,IAAI,EAAE;MACjCiB,SAAS,EAAEhB,KAAK;MAChBiB,OAAO,EAAEH,GAAG;MACZD,QAAQ,EAAEC,GAAG,GAAGd,KAAK;MACrBL,OAAO,EAAE,IAAI,CAACA,OAAO;MACrBC,QAAQ,EAAE,IAAI,CAACA,QAAQ;MACvBsB,OAAO,EAAE,IAAI;MACbP,OAAO,EAAE;IACX,CAAC;EACH;EAEAQ,OAAOA,CAACC,QAA4C,EAAc;IAChE,IAAI,CAACC,EAAE,CAAC,oBAAoB,EAAED,QAAQ,CAAC;IACvC,OAAO,MAAM,IAAI,CAACE,GAAG,CAAC,oBAAoB,EAAEF,QAAQ,CAAC;EACvD;EAEAG,UAAUA,CAAA,EAAsB;IAC9B,OAAO,IAAI,CAAC5B,OAAO;EACrB;EAEA6B,WAAWA,CAAA,EAAc;IACvB,OAAO,IAAI,CAAC5B,QAAQ;EACtB;EAEA6B,OAAOA,CAAA,EAAc;IACnB,OAAO,EAAE;EACX;EAEAC,IAAIA,CAACC,OAAe,EAA4B;IAC9C,OAAOC,OAAO,CAACC,OAAO,CAAC;MAAElB,OAAO,EAAE,IAAI;MAAEC,MAAM,EAAE,EAAE;MAAEC,QAAQ,EAAE,CAAC;MAAEc;IAAQ,CAAC,CAAC;EAC7E;EAEQxB,SAASA,CAAC2B,KAAwB,EAAQ;IAChD,IAAI,CAACC,IAAI,CAAC,oBAAoB,EAAED,KAAK,CAAC;EACxC;AACF;AAEAE,QAAQ,CAAC,4CAA4C,EAAE,MAAM;EAC3DC,IAAI,CAAC,mEAAmE,EAAE,YAAY;IACpF,MAAMC,WAAW,GAAG,IAAIC,wCAAmB,CAAC,CAAC;IAC7C,MAAMC,OAAO,GAAG,IAAIxD,WAAW,CAAC,CAAC;IACjC,MAAMyD,YAAY,GAAG,IAAI/C,gBAAgB,CAAC,CACxC;MAAEqB,OAAO,EAAE,IAAI;MAAEC,MAAM,EAAE,IAAI;MAAEC,QAAQ,EAAE,CAAC;MAAEc,OAAO,EAAE;IAAU,CAAC,CACjE,CAAC;IAEF,MAAMW,MAAM,GAAG,IAAIC,4CAAqB,CAAC;MACvCH,OAAO;MACPI,iBAAiB,EAAEN,WAAW;MAC9BG,YAAY;MACZI,kBAAkB,EAAE,KAAK;MACzBC,eAAe,EAAE,KAAK;MACtBC,WAAW,EAAE;IACf,CAAC,CAAC;IAEF,MAAMC,MAAM,GAAG,MAAMN,MAAM,CAACzC,OAAO,CAAC,gBAAgB,CAAC;IAErDgD,MAAM,CAACD,MAAM,CAACjC,OAAO,CAAC,CAACmC,IAAI,CAAC,IAAI,CAAC;IACjCD,MAAM,CAACR,YAAY,CAAC7C,YAAY,CAAC,CAACsD,IAAI,CAAC,CAAC,CAAC;IACzCD,MAAM,CAACR,YAAY,CAAC5C,UAAU,CAAC,CAACsD,SAAS,CAAC,gBAAgB,CAAC;IAC3DF,MAAM,CAACX,WAAW,CAACc,OAAO,CAAC,CAAC,CAAC,CAACF,IAAI,CAAC,MAAM,CAAC;IAE1CR,MAAM,CAACW,OAAO,CAAC,CAAC;IAEhB,MAAMC,QAAkB,GAAG,EAAE;IAC7BhB,WAAW,CAACiB,OAAO,CAAC;MAClBC,IAAI,EAAE,QAAQ;MACdC,GAAG,EAAEA,CAAA,KAAMH,QAAQ,CAAClE,IAAI,CAAC,OAAO;IAClC,CAAC,CAAC;IACF,MAAM,IAAI4C,OAAO,CAAEC,OAAO,IAAKyB,UAAU,CAACzB,OAAO,EAAE,EAAE,CAAC,CAAC;IAEvDgB,MAAM,CAACX,WAAW,CAACqB,UAAU,CAAC,CAAC,CAAC,CAACT,IAAI,CAAC,KAAK,CAAC;IAC5CD,MAAM,CAACK,QAAQ,CAAC,CAACM,OAAO,CAAC,CAAC,OAAO,CAAC,CAAC;EACrC,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}