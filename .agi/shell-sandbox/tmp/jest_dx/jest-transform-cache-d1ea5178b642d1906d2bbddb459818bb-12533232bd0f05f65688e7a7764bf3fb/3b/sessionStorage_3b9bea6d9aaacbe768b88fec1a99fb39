259b0d4873bcc38e30475c08be6ce7b3
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createInMemorySessionStorage = createInMemorySessionStorage;
exports.getSessionStorage = getSessionStorage;
exports.setSessionStorage = setSessionStorage;
var _nodeFs = require("node:fs");
var _nodePath = require("node:path");
const fsStorage = {
  ensureDir(path) {
    (0, _nodeFs.mkdirSync)(path, {
      recursive: true
    });
  },
  writeFile(path, content) {
    (0, _nodeFs.mkdirSync)((0, _nodePath.dirname)(path), {
      recursive: true
    });
    (0, _nodeFs.writeFileSync)(path, content, 'utf8');
  },
  readFile(path) {
    return (0, _nodeFs.readFileSync)(path, 'utf8');
  },
  exists(path) {
    return (0, _nodeFs.existsSync)(path);
  }
};
let activeStorage = fsStorage;
function setSessionStorage(storage) {
  activeStorage = storage;
}
function getSessionStorage() {
  return activeStorage;
}
function createInMemorySessionStorage() {
  const files = new Map();
  return {
    ensureDir(_path) {
      // no-op for memory
    },
    writeFile(path, content) {
      files.set(path, content);
    },
    readFile(path) {
      const content = files.get(path);
      if (content === undefined) {
        throw new Error(`File not found: ${path}`);
      }
      return content;
    },
    exists(path) {
      return files.has(path);
    }
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbm9kZUZzIiwicmVxdWlyZSIsIl9ub2RlUGF0aCIsImZzU3RvcmFnZSIsImVuc3VyZURpciIsInBhdGgiLCJta2RpclN5bmMiLCJyZWN1cnNpdmUiLCJ3cml0ZUZpbGUiLCJjb250ZW50IiwiZGlybmFtZSIsIndyaXRlRmlsZVN5bmMiLCJyZWFkRmlsZSIsInJlYWRGaWxlU3luYyIsImV4aXN0cyIsImV4aXN0c1N5bmMiLCJhY3RpdmVTdG9yYWdlIiwic2V0U2Vzc2lvblN0b3JhZ2UiLCJzdG9yYWdlIiwiZ2V0U2Vzc2lvblN0b3JhZ2UiLCJjcmVhdGVJbk1lbW9yeVNlc3Npb25TdG9yYWdlIiwiZmlsZXMiLCJNYXAiLCJfcGF0aCIsInNldCIsImdldCIsInVuZGVmaW5lZCIsIkVycm9yIiwiaGFzIl0sInNvdXJjZXMiOlsic2Vzc2lvblN0b3JhZ2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbWtkaXJTeW5jLCByZWFkRmlsZVN5bmMsIHdyaXRlRmlsZVN5bmMsIGV4aXN0c1N5bmMgfSBmcm9tICdub2RlOmZzJztcbmltcG9ydCB7IGRpcm5hbWUgfSBmcm9tICdub2RlOnBhdGgnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFNlc3Npb25TdG9yYWdlIHtcbiAgZW5zdXJlRGlyKHBhdGg6IHN0cmluZyk6IHZvaWQ7XG4gIHdyaXRlRmlsZShwYXRoOiBzdHJpbmcsIGNvbnRlbnQ6IHN0cmluZyk6IHZvaWQ7XG4gIHJlYWRGaWxlKHBhdGg6IHN0cmluZyk6IHN0cmluZztcbiAgZXhpc3RzKHBhdGg6IHN0cmluZyk6IGJvb2xlYW47XG59XG5cbmNvbnN0IGZzU3RvcmFnZTogU2Vzc2lvblN0b3JhZ2UgPSB7XG4gIGVuc3VyZURpcihwYXRoOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBta2RpclN5bmMocGF0aCwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gIH0sXG4gIHdyaXRlRmlsZShwYXRoOiBzdHJpbmcsIGNvbnRlbnQ6IHN0cmluZyk6IHZvaWQge1xuICAgIG1rZGlyU3luYyhkaXJuYW1lKHBhdGgpLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICB3cml0ZUZpbGVTeW5jKHBhdGgsIGNvbnRlbnQsICd1dGY4Jyk7XG4gIH0sXG4gIHJlYWRGaWxlKHBhdGg6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHJlYWRGaWxlU3luYyhwYXRoLCAndXRmOCcpO1xuICB9LFxuICBleGlzdHMocGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIGV4aXN0c1N5bmMocGF0aCk7XG4gIH0sXG59O1xuXG5sZXQgYWN0aXZlU3RvcmFnZTogU2Vzc2lvblN0b3JhZ2UgPSBmc1N0b3JhZ2U7XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXRTZXNzaW9uU3RvcmFnZShzdG9yYWdlOiBTZXNzaW9uU3RvcmFnZSk6IHZvaWQge1xuICBhY3RpdmVTdG9yYWdlID0gc3RvcmFnZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFNlc3Npb25TdG9yYWdlKCk6IFNlc3Npb25TdG9yYWdlIHtcbiAgcmV0dXJuIGFjdGl2ZVN0b3JhZ2U7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVJbk1lbW9yeVNlc3Npb25TdG9yYWdlKCk6IFNlc3Npb25TdG9yYWdlIHtcbiAgY29uc3QgZmlsZXMgPSBuZXcgTWFwPHN0cmluZywgc3RyaW5nPigpO1xuICByZXR1cm4ge1xuICAgIGVuc3VyZURpcihfcGF0aDogc3RyaW5nKTogdm9pZCB7XG4gICAgICAvLyBuby1vcCBmb3IgbWVtb3J5XG4gICAgfSxcbiAgICB3cml0ZUZpbGUocGF0aDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgIGZpbGVzLnNldChwYXRoLCBjb250ZW50KTtcbiAgICB9LFxuICAgIHJlYWRGaWxlKHBhdGg6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgICBjb25zdCBjb250ZW50ID0gZmlsZXMuZ2V0KHBhdGgpO1xuICAgICAgaWYgKGNvbnRlbnQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZpbGUgbm90IGZvdW5kOiAke3BhdGh9YCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gY29udGVudDtcbiAgICB9LFxuICAgIGV4aXN0cyhwYXRoOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAgIHJldHVybiBmaWxlcy5oYXMocGF0aCk7XG4gICAgfSxcbiAgfTtcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSxJQUFBQSxPQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxTQUFBLEdBQUFELE9BQUE7QUFTQSxNQUFNRSxTQUF5QixHQUFHO0VBQ2hDQyxTQUFTQSxDQUFDQyxJQUFZLEVBQVE7SUFDNUIsSUFBQUMsaUJBQVMsRUFBQ0QsSUFBSSxFQUFFO01BQUVFLFNBQVMsRUFBRTtJQUFLLENBQUMsQ0FBQztFQUN0QyxDQUFDO0VBQ0RDLFNBQVNBLENBQUNILElBQVksRUFBRUksT0FBZSxFQUFRO0lBQzdDLElBQUFILGlCQUFTLEVBQUMsSUFBQUksaUJBQU8sRUFBQ0wsSUFBSSxDQUFDLEVBQUU7TUFBRUUsU0FBUyxFQUFFO0lBQUssQ0FBQyxDQUFDO0lBQzdDLElBQUFJLHFCQUFhLEVBQUNOLElBQUksRUFBRUksT0FBTyxFQUFFLE1BQU0sQ0FBQztFQUN0QyxDQUFDO0VBQ0RHLFFBQVFBLENBQUNQLElBQVksRUFBVTtJQUM3QixPQUFPLElBQUFRLG9CQUFZLEVBQUNSLElBQUksRUFBRSxNQUFNLENBQUM7RUFDbkMsQ0FBQztFQUNEUyxNQUFNQSxDQUFDVCxJQUFZLEVBQVc7SUFDNUIsT0FBTyxJQUFBVSxrQkFBVSxFQUFDVixJQUFJLENBQUM7RUFDekI7QUFDRixDQUFDO0FBRUQsSUFBSVcsYUFBNkIsR0FBR2IsU0FBUztBQUV0QyxTQUFTYyxpQkFBaUJBLENBQUNDLE9BQXVCLEVBQVE7RUFDL0RGLGFBQWEsR0FBR0UsT0FBTztBQUN6QjtBQUVPLFNBQVNDLGlCQUFpQkEsQ0FBQSxFQUFtQjtFQUNsRCxPQUFPSCxhQUFhO0FBQ3RCO0FBRU8sU0FBU0ksNEJBQTRCQSxDQUFBLEVBQW1CO0VBQzdELE1BQU1DLEtBQUssR0FBRyxJQUFJQyxHQUFHLENBQWlCLENBQUM7RUFDdkMsT0FBTztJQUNMbEIsU0FBU0EsQ0FBQ21CLEtBQWEsRUFBUTtNQUM3QjtJQUFBLENBQ0Q7SUFDRGYsU0FBU0EsQ0FBQ0gsSUFBWSxFQUFFSSxPQUFlLEVBQVE7TUFDN0NZLEtBQUssQ0FBQ0csR0FBRyxDQUFDbkIsSUFBSSxFQUFFSSxPQUFPLENBQUM7SUFDMUIsQ0FBQztJQUNERyxRQUFRQSxDQUFDUCxJQUFZLEVBQVU7TUFDN0IsTUFBTUksT0FBTyxHQUFHWSxLQUFLLENBQUNJLEdBQUcsQ0FBQ3BCLElBQUksQ0FBQztNQUMvQixJQUFJSSxPQUFPLEtBQUtpQixTQUFTLEVBQUU7UUFDekIsTUFBTSxJQUFJQyxLQUFLLENBQUMsbUJBQW1CdEIsSUFBSSxFQUFFLENBQUM7TUFDNUM7TUFDQSxPQUFPSSxPQUFPO0lBQ2hCLENBQUM7SUFDREssTUFBTUEsQ0FBQ1QsSUFBWSxFQUFXO01BQzVCLE9BQU9nQixLQUFLLENBQUNPLEdBQUcsQ0FBQ3ZCLElBQUksQ0FBQztJQUN4QjtFQUNGLENBQUM7QUFDSCIsImlnbm9yZUxpc3QiOltdfQ==