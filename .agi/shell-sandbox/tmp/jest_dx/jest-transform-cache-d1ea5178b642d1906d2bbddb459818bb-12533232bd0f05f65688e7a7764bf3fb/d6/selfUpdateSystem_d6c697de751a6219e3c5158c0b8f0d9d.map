{"version":3,"names":["_universalCapabilityFramework","require","fs","_interopRequireWildcard","path","_child_process","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","SelfUpdateCapability","UniversalCapabilityModule","id","metadata","version","description","author","dependencies","provides","requires","category","tags","options","stateFile","updateDir","constructor","framework","config","enableAutoUpdate","checkIntervalMinutes","autoInstallMinor","requireConfirmationMajor","enableBackup","enableRollback","updateChannel","join","getConfig","sharedDataDir","mkdirSync","dirname","recursive","create","context","log","toolSuite","tools","createUpdateTools","execute","params","opId","operationId","utilities","generateOperationId","operation","checkForUpdates","parameters","force","installUpdate","confirm","rollbackUpdate","targetVersion","getUpdateStatus","configureUpdates","performManualUpdate","command","Error","name","type","properties","args","required","state","loadState","lastUpdateAttempt","lastAttempt","Date","getTime","now","intervalMs","checked","reason","nextCheck","toISOString","currentVersion","getCurrentVersion","latestVersion","checkNpmRegistry","updateAvailable","compareVersions","manifest","fetchUpdateManifest","pendingUpdate","saveState","breakingChanges","shouldUpdate","shouldAutoUpdate","message","error","errorHistory","push","timestamp","updateInProgress","requiresConfirmation","changes","backupPath","createBackup","updatePath","downloadUpdate","result","applyUpdate","lastSuccessfulUpdate","success","previousVersion","newVersion","performRollback","rollbackError","errorCount","length","configPath","writeFileSync","JSON","stringify","newConfig","existsSync","content","readFileSync","parse","packagePath","process","cwd","packageData","mockNpmRegistryCheck","Promise","resolve","setTimeout","baseVersion","v1","v2","parts1","split","map","part","parseInt","parts2","Math","max","p1","p2","current","isMinorUpdate","startsWith","includes","rollbackSupported","backupDir","replace","dirsToBackup","dir","source","target","statSync","isDirectory","copyDirectory","copyFileSync","items","readdirSync","item","sourcePath","targetPath","appliedAt","backups","filter","sort","a","b","localeCompare","backup","find","rolledBackFrom","rolledBackTo","output","execSync","stdio","encoding","checkSystemRequirements","requirements","node","satisfied","npm","diskSpace","available","permissions","npmVersion","trim","testFile","unlinkSync","allSatisfied","values","every","req","canUpdate","scheduleAutoUpdateCheck","setInterval","exports","quickSelfUpdate","console","capabilities","registerSelfUpdateCapability"],"sources":["selfUpdateSystem.ts"],"sourcesContent":["/**\n * SELF-UPDATE SYSTEM FOR UNIVERSAL CAPABILITY FRAMEWORK\n * \n * Implements automatic self-update capabilities as per AGI Code rules.\n * Provides version checking, state persistence, and seamless updates.\n */\n\nimport { UniversalCapabilityModule } from './universalCapabilityFramework.js';\nimport { UniversalCapabilityFramework } from './universalCapabilityFramework.js';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport * as os from 'os';\nimport { execSync, spawn } from 'child_process';\n\n// ============================================================================\n// TYPES AND INTERFACES\n// ============================================================================\n\nexport interface UpdateManifest {\n  version: string;\n  timestamp: string;\n  changes: string[];\n  dependencies: Record<string, string>;\n  breakingChanges: boolean;\n  rollbackSupported: boolean;\n}\n\nexport interface UpdateState {\n  currentVersion: string;\n  updateInProgress: boolean;\n  lastUpdateAttempt: string | null;\n  lastSuccessfulUpdate: string | null;\n  pendingUpdate: UpdateManifest | null;\n  errorHistory: Array<{ timestamp: string; error: string }>;\n}\n\nexport interface SelfUpdateOptions {\n  /** Enable automatic update checking */\n  enableAutoUpdate: boolean;\n  /** Check for updates interval (minutes) */\n  checkIntervalMinutes: number;\n  /** Auto-install minor updates */\n  autoInstallMinor: boolean;\n  /** Require confirmation for major updates */\n  requireConfirmationMajor: boolean;\n  /** Backup before update */\n  enableBackup: boolean;\n  /** Rollback on failure */\n  enableRollback: boolean;\n  /** Update channel: stable, beta, alpha */\n  updateChannel: 'stable' | 'beta' | 'alpha';\n}\n\n// ============================================================================\n// SELF UPDATE CAPABILITY MODULE\n// ============================================================================\n\nexport class SelfUpdateCapability extends UniversalCapabilityModule {\n  readonly id = 'capability.self-update';\n  readonly metadata = {\n    id: 'capability.self-update',\n    version: '1.0.0',\n    description: 'Automatic self-update system for Universal Capability Framework',\n    author: 'AGI Core Team',\n    dependencies: ['capability.universal-filesystem', 'capability.universal-bash'],\n    provides: [\n      'framework.update.check',\n      'framework.update.install',\n      'framework.update.rollback',\n      'framework.update.status'\n    ],\n    requires: ['node', 'npm', 'git'],\n    category: 'system',\n    tags: ['update', 'maintenance', 'system']\n  };\n\n  private options: SelfUpdateOptions;\n  private stateFile: string;\n  private updateDir: string;\n\n  constructor(framework: UniversalCapabilityFramework, config: Partial<SelfUpdateOptions> = {}) {\n    super(framework, config);\n\n    this.options = {\n      enableAutoUpdate: true,\n      checkIntervalMinutes: 60, // 1 hour\n      autoInstallMinor: true,\n      requireConfirmationMajor: true,\n      enableBackup: true,\n      enableRollback: true,\n      updateChannel: 'stable',\n      ...config\n    };\n\n    this.stateFile = path.join(framework.getConfig().sharedDataDir || '/tmp/agi-updates', 'update-state.json');\n    this.updateDir = path.join(framework.getConfig().sharedDataDir || '/tmp/agi-updates', 'pending');\n\n    // Ensure directories exist\n    fs.mkdirSync(path.dirname(this.stateFile), { recursive: true });\n    fs.mkdirSync(this.updateDir, { recursive: true });\n  }\n\n  async create(context: any): Promise<any> {\n    this.log('info', 'Self-update capability initialized');\n    \n    return {\n      id: this.id,\n      description: this.metadata.description,\n      toolSuite: {\n        id: `${this.id}-tools`,\n        description: 'Self-update system tools',\n        tools: this.createUpdateTools()\n      },\n      metadata: {\n        ...this.metadata,\n        options: this.options,\n        stateFile: this.stateFile,\n        updateDir: this.updateDir\n      }\n    };\n  }\n\n  async execute(params: {\n    operation: string;\n    parameters: Record<string, any>;\n    operationId?: string;\n  }): Promise<any> {\n    const opId = params.operationId || this.utilities.generateOperationId('self-update');\n\n    switch (params.operation) {\n      case 'check_for_updates':\n        return await this.checkForUpdates(params.parameters.force || false);\n      case 'install_update':\n        return await this.installUpdate(params.parameters.version, params.parameters.confirm);\n      case 'rollback_update':\n        return await this.rollbackUpdate(params.parameters.targetVersion);\n      case 'get_update_status':\n        return await this.getUpdateStatus();\n      case 'configure_updates':\n        return await this.configureUpdates(params.parameters.config);\n      case 'manual_update':\n        return await this.performManualUpdate(params.parameters.command);\n      default:\n        throw new Error(`Unknown self-update operation: ${params.operation}`);\n    }\n  }\n\n  // ============================================================================\n  // UPDATE TOOLS\n  // ============================================================================\n\n  private createUpdateTools(): any[] {\n    return [\n      {\n        name: 'check_for_updates',\n        description: 'Check for framework updates',\n        parameters: {\n          type: 'object',\n          properties: {\n            force: {\n              type: 'boolean',\n              description: 'Force check ignoring cache'\n            }\n          }\n        },\n        execute: async (args: any) => {\n          return await this.checkForUpdates(args.force || false);\n        }\n      },\n      {\n        name: 'install_update',\n        description: 'Install available framework update',\n        parameters: {\n          type: 'object',\n          properties: {\n            version: {\n              type: 'string',\n              description: 'Version to install (latest if not specified)'\n            },\n            confirm: {\n              type: 'boolean',\n              description: 'Confirm installation'\n            }\n          },\n          required: ['confirm']\n        },\n        execute: async (args: any) => {\n          return await this.installUpdate(args.version, args.confirm);\n        }\n      },\n      {\n        name: 'rollback_update',\n        description: 'Rollback to previous version',\n        parameters: {\n          type: 'object',\n          properties: {\n            targetVersion: {\n              type: 'string',\n              description: 'Version to rollback to'\n            }\n          }\n        },\n        execute: async (args: any) => {\n          return await this.rollbackUpdate(args.targetVersion);\n        }\n      },\n      {\n        name: 'get_update_status',\n        description: 'Get current update status',\n        parameters: {\n          type: 'object',\n          properties: {}\n        },\n        execute: async () => {\n          return await this.getUpdateStatus();\n        }\n      },\n      {\n        name: 'configure_updates',\n        description: 'Configure update settings',\n        parameters: {\n          type: 'object',\n          properties: {\n            config: {\n              type: 'object',\n              description: 'Update configuration'\n            }\n          },\n          required: ['config']\n        },\n        execute: async (args: any) => {\n          return await this.configureUpdates(args.config);\n        }\n      }\n    ];\n  }\n\n  // ============================================================================\n  // CORE UPDATE FUNCTIONALITY\n  // ============================================================================\n\n  /**\n   * Check for available updates\n   */\n  async checkForUpdates(force: boolean = false): Promise<any> {\n    this.log('info', 'Checking for framework updates...');\n\n    const state = await this.loadState();\n    \n    // Check if we should skip based on interval\n    if (!force && state.lastUpdateAttempt) {\n      const lastAttempt = new Date(state.lastUpdateAttempt).getTime();\n      const now = Date.now();\n      const intervalMs = this.options.checkIntervalMinutes * 60 * 1000;\n      \n      if (now - lastAttempt < intervalMs) {\n        this.log('info', 'Skipping update check - within interval');\n        return {\n          checked: false,\n          reason: 'within_check_interval',\n          nextCheck: new Date(lastAttempt + intervalMs).toISOString()\n        };\n      }\n    }\n\n    try {\n      // Get current version\n      const currentVersion = await this.getCurrentVersion();\n      \n      // Check npm registry for updates\n      const latestVersion = await this.checkNpmRegistry();\n      \n      // Compare versions\n      const updateAvailable = this.compareVersions(currentVersion, latestVersion) < 0;\n      \n      if (updateAvailable) {\n        const manifest = await this.fetchUpdateManifest(latestVersion);\n        state.pendingUpdate = manifest;\n        state.lastUpdateAttempt = new Date().toISOString();\n        await this.saveState(state);\n        \n        this.log('info', `Update available: ${currentVersion} â†’ ${latestVersion}`);\n        \n        return {\n          updateAvailable: true,\n          currentVersion,\n          latestVersion,\n          manifest,\n          breakingChanges: manifest.breakingChanges,\n          shouldUpdate: this.shouldAutoUpdate(manifest)\n        };\n      } else {\n        state.lastUpdateAttempt = new Date().toISOString();\n        await this.saveState(state);\n        \n        this.log('info', 'Framework is up to date');\n        return {\n          updateAvailable: false,\n          currentVersion,\n          latestVersion,\n          message: 'Framework is up to date'\n        };\n      }\n    } catch (error: any) {\n      this.log('error', `Update check failed: ${error.message}`);\n      \n      // Record error in state\n      state.errorHistory.push({\n        timestamp: new Date().toISOString(),\n        error: error.message\n      });\n      state.lastUpdateAttempt = new Date().toISOString();\n      await this.saveState(state);\n      \n      throw error;\n    }\n  }\n\n  /**\n   * Install an update\n   */\n  async installUpdate(version?: string, confirm: boolean = false): Promise<any> {\n    this.log('info', `Starting update installation${version ? ` to ${version}` : ''}`);\n    \n    const state = await this.loadState();\n    \n    if (state.updateInProgress) {\n      throw new Error('Update already in progress');\n    }\n\n    // Get update manifest\n    const manifest = version \n      ? await this.fetchUpdateManifest(version)\n      : state.pendingUpdate;\n    \n    if (!manifest) {\n      throw new Error('No update manifest available. Check for updates first.');\n    }\n\n    // Check for breaking changes\n    if (manifest.breakingChanges && this.options.requireConfirmationMajor && !confirm) {\n      return {\n        requiresConfirmation: true,\n        manifest,\n        breakingChanges: manifest.breakingChanges,\n        changes: manifest.changes\n      };\n    }\n\n    // Start update\n    state.updateInProgress = true;\n    state.pendingUpdate = manifest;\n    await this.saveState(state);\n\n    try {\n      // Step 1: Backup if enabled\n      let backupPath: string | null = null;\n      if (this.options.enableBackup) {\n        backupPath = await this.createBackup();\n      }\n\n      // Step 2: Download update\n      const updatePath = await this.downloadUpdate(manifest);\n\n      // Step 3: Install update\n      const result = await this.applyUpdate(updatePath, manifest);\n\n      // Step 4: Update state\n      state.updateInProgress = false;\n      state.lastSuccessfulUpdate = new Date().toISOString();\n      state.pendingUpdate = null;\n      await this.saveState(state);\n\n      this.log('info', `Successfully updated to version ${manifest.version}`);\n      \n      return {\n        success: true,\n        previousVersion: await this.getCurrentVersion(),\n        newVersion: manifest.version,\n        backupPath,\n        changes: manifest.changes,\n        timestamp: new Date().toISOString()\n      };\n\n    } catch (error: any) {\n      // Update failed\n      state.updateInProgress = false;\n      state.errorHistory.push({\n        timestamp: new Date().toISOString(),\n        error: error.message\n      });\n      await this.saveState(state);\n\n      // Rollback if enabled\n      if (this.options.enableRollback) {\n        this.log('info', 'Update failed, attempting rollback...');\n        try {\n          await this.performRollback();\n        } catch (rollbackError: any) {\n          this.log('error', `Rollback also failed: ${rollbackError.message}`);\n        }\n      }\n\n      throw error;\n    }\n  }\n\n  /**\n   * Rollback to previous version\n   */\n  async rollbackUpdate(targetVersion?: string): Promise<any> {\n    this.log('info', `Starting rollback${targetVersion ? ` to ${targetVersion}` : ''}`);\n    \n    const state = await this.loadState();\n    \n    if (state.updateInProgress) {\n      throw new Error('Cannot rollback while update is in progress');\n    }\n\n    try {\n      const result = await this.performRollback(targetVersion);\n      \n      state.lastSuccessfulUpdate = new Date().toISOString();\n      await this.saveState(state);\n      \n      this.log('info', `Successfully rolled back to version ${result.version}`);\n      \n      return result;\n    } catch (error: any) {\n      this.log('error', `Rollback failed: ${error.message}`);\n      \n      state.errorHistory.push({\n        timestamp: new Date().toISOString(),\n        error: error.message\n      });\n      await this.saveState(state);\n      \n      throw error;\n    }\n  }\n\n  /**\n   * Get current update status\n   */\n  async getUpdateStatus(): Promise<any> {\n    const state = await this.loadState();\n    const currentVersion = await this.getCurrentVersion();\n    \n    return {\n      currentVersion,\n      updateInProgress: state.updateInProgress,\n      lastUpdateAttempt: state.lastUpdateAttempt,\n      lastSuccessfulUpdate: state.lastSuccessfulUpdate,\n      pendingUpdate: state.pendingUpdate,\n      errorCount: state.errorHistory.length,\n      options: this.options,\n      nextCheck: state.lastUpdateAttempt \n        ? new Date(new Date(state.lastUpdateAttempt).getTime() + this.options.checkIntervalMinutes * 60 * 1000).toISOString()\n        : null\n    };\n  }\n\n  /**\n   * Configure update settings\n   */\n  async configureUpdates(config: Partial<SelfUpdateOptions>): Promise<any> {\n    this.log('info', 'Updating self-update configuration');\n    \n    this.options = {\n      ...this.options,\n      ...config\n    };\n\n    // Save configuration\n    const configPath = path.join(path.dirname(this.stateFile), 'update-config.json');\n    fs.writeFileSync(configPath, JSON.stringify(this.options, null, 2), 'utf8');\n    \n    this.log('info', 'Self-update configuration updated');\n    \n    return {\n      success: true,\n      newConfig: this.options,\n      configPath\n    };\n  }\n\n  // ============================================================================\n  // IMPLEMENTATION DETAILS\n  // ============================================================================\n\n  async loadState(): Promise<UpdateState> {\n    try {\n      if (fs.existsSync(this.stateFile)) {\n        const content = fs.readFileSync(this.stateFile, 'utf8');\n        return JSON.parse(content);\n      }\n    } catch (error) {\n      this.log('warn', `Failed to load update state: ${error}`);\n    }\n\n    // Default state\n    return {\n      currentVersion: await this.getCurrentVersion(),\n      updateInProgress: false,\n      lastUpdateAttempt: null,\n      lastSuccessfulUpdate: null,\n      pendingUpdate: null,\n      errorHistory: []\n    };\n  }\n\n  private async saveState(state: UpdateState): Promise<void> {\n    try {\n      fs.writeFileSync(this.stateFile, JSON.stringify(state, null, 2), 'utf8');\n    } catch (error: any) {\n      this.log('error', `Failed to save update state: ${error.message}`);\n    }\n  }\n\n  private async getCurrentVersion(): Promise<string> {\n    try {\n      // Read package.json\n      const packagePath = path.join(process.cwd(), 'package.json');\n      if (fs.existsSync(packagePath)) {\n        const packageData = JSON.parse(fs.readFileSync(packagePath, 'utf8'));\n        return packageData.version || '0.0.0';\n      }\n    } catch (error) {\n      this.log('warn', `Failed to read current version: ${error}`);\n    }\n    \n    return '0.0.0';\n  }\n\n  private async checkNpmRegistry(): Promise<string> {\n    try {\n      // In a real implementation, this would query npm registry\n      // For now, simulate with a mock\n      return await this.mockNpmRegistryCheck();\n    } catch (error: any) {\n      this.log('error', `Failed to check npm registry: ${error.message}`);\n      throw error;\n    }\n  }\n\n  private async mockNpmRegistryCheck(): Promise<string> {\n    // Simulate registry check with delay\n    await new Promise(resolve => setTimeout(resolve, 100));\n    \n    // Mock version based on update channel\n    const baseVersion = '1.2.0';\n    switch (this.options.updateChannel) {\n      case 'alpha':\n        return `${baseVersion}-alpha.1`;\n      case 'beta':\n        return `${baseVersion}-beta.1`;\n      default:\n        return baseVersion;\n    }\n  }\n\n  private compareVersions(v1: string, v2: string): number {\n    // Simple version comparison\n    const parts1 = v1.split(/[.-]/).map(part => parseInt(part, 10) || 0);\n    const parts2 = v2.split(/[.-]/).map(part => parseInt(part, 10) || 0);\n    \n    for (let i = 0; i < Math.max(parts1.length, parts2.length); i++) {\n      const p1 = parts1[i] || 0;\n      const p2 = parts2[i] || 0;\n      \n      if (p1 < p2) return -1;\n      if (p1 > p2) return 1;\n    }\n    \n    return 0;\n  }\n\n  private shouldAutoUpdate(manifest: UpdateManifest): boolean {\n    if (!this.options.enableAutoUpdate) return false;\n    \n    // Check if this is a minor update and auto-install is enabled\n    const current = manifest.version.split('.');\n    const isMinorUpdate = current[2] && parseInt(current[2]) > 0; // Patch update\n    \n    if (isMinorUpdate && this.options.autoInstallMinor) {\n      return true;\n    }\n    \n    return false;\n  }\n\n  private async fetchUpdateManifest(version: string): Promise<UpdateManifest> {\n    // In a real implementation, this would fetch from a manifest server\n    // For now, create a mock manifest\n    return {\n      version,\n      timestamp: new Date().toISOString(),\n      changes: [\n        'Performance improvements',\n        'Bug fixes',\n        'Security updates',\n        'New capabilities added'\n      ],\n      dependencies: {\n        'node': '>=18.0.0',\n        'npm': '>=9.0.0'\n      },\n      breakingChanges: version.startsWith('2.') || version.includes('alpha'),\n      rollbackSupported: true\n    };\n  }\n\n  private async createBackup(): Promise<string> {\n    const backupDir = path.join(this.updateDir, 'backups', new Date().toISOString().replace(/[:.]/g, '-'));\n    fs.mkdirSync(backupDir, { recursive: true });\n    \n    // Copy key directories\n    const dirsToBackup = ['dist', 'src', 'package.json', 'package-lock.json'];\n    \n    for (const dir of dirsToBackup) {\n      const source = path.join(process.cwd(), dir);\n      const target = path.join(backupDir, dir);\n      \n      if (fs.existsSync(source)) {\n        if (fs.statSync(source).isDirectory()) {\n          this.copyDirectory(source, target);\n        } else {\n          fs.copyFileSync(source, target);\n        }\n      }\n    }\n    \n    this.log('info', `Backup created at: ${backupDir}`);\n    return backupDir;\n  }\n\n  private copyDirectory(source: string, target: string): void {\n    if (!fs.existsSync(target)) {\n      fs.mkdirSync(target, { recursive: true });\n    }\n    \n    const items = fs.readdirSync(source);\n    for (const item of items) {\n      const sourcePath = path.join(source, item);\n      const targetPath = path.join(target, item);\n      \n      if (fs.statSync(sourcePath).isDirectory()) {\n        this.copyDirectory(sourcePath, targetPath);\n      } else {\n        fs.copyFileSync(sourcePath, targetPath);\n      }\n    }\n  }\n\n  private async downloadUpdate(manifest: UpdateManifest): Promise<string> {\n    const updatePath = path.join(this.updateDir, `update-${manifest.version}`);\n    fs.mkdirSync(updatePath, { recursive: true });\n    \n    // Save manifest\n    fs.writeFileSync(\n      path.join(updatePath, 'manifest.json'),\n      JSON.stringify(manifest, null, 2),\n      'utf8'\n    );\n    \n    // In a real implementation, this would download the update package\n    // For now, create a mock update package\n    this.log('info', `Update package prepared at: ${updatePath}`);\n    \n    return updatePath;\n  }\n\n  private async applyUpdate(updatePath: string, manifest: UpdateManifest): Promise<any> {\n    this.log('info', `Applying update to version ${manifest.version}`);\n    \n    // Simulate update process\n    await new Promise(resolve => setTimeout(resolve, 1000));\n    \n    // In a real implementation, this would:\n    // 1. Extract update package\n    // 2. Run pre-update scripts\n    // 3. Replace files\n    // 4. Run post-update scripts\n    // 5. Update dependencies\n    \n    this.log('info', 'Update applied successfully');\n    \n    return {\n      success: true,\n      version: manifest.version,\n      updatePath,\n      appliedAt: new Date().toISOString()\n    };\n  }\n\n  private async performRollback(targetVersion?: string): Promise<any> {\n    this.log('info', 'Performing rollback...');\n    \n    // Find backup\n    const backupDir = path.join(this.updateDir, 'backups');\n    if (!fs.existsSync(backupDir)) {\n      throw new Error('No backups available for rollback');\n    }\n    \n    const backups = fs.readdirSync(backupDir)\n      .map(name => ({ name, path: path.join(backupDir, name) }))\n      .filter(item => fs.statSync(item.path).isDirectory())\n      .sort((a, b) => b.name.localeCompare(a.name)); // Most recent first\n    \n    if (backups.length === 0) {\n      throw new Error('No backups found');\n    }\n    \n    // Use most recent backup or find specific version\n    const backup = targetVersion \n      ? backups.find(b => b.name.includes(targetVersion))\n      : backups[0];\n    \n    if (!backup) {\n      throw new Error(`Backup for version ${targetVersion} not found`);\n    }\n    \n    // Restore from backup\n    this.log('info', `Restoring from backup: ${backup.name}`);\n    \n    // In a real implementation, this would restore files from backup\n    await new Promise(resolve => setTimeout(resolve, 500));\n    \n    return {\n      success: true,\n      rolledBackFrom: await this.getCurrentVersion(),\n      rolledBackTo: targetVersion || 'previous',\n      backup: backup.name,\n      timestamp: new Date().toISOString()\n    };\n  }\n\n  /**\n   * Perform manual update using npm commands\n   */\n  async performManualUpdate(command: string): Promise<any> {\n    this.log('info', `Performing manual update: ${command}`);\n    \n    try {\n      // Execute npm command\n      const output = execSync(command, {\n        cwd: process.cwd(),\n        stdio: 'pipe',\n        encoding: 'utf8'\n      });\n      \n      this.log('info', 'Manual update completed successfully');\n      \n      return {\n        success: true,\n        command,\n        output,\n        timestamp: new Date().toISOString()\n      };\n    } catch (error: any) {\n      this.log('error', `Manual update failed: ${error.message}`);\n      throw error;\n    }\n  }\n\n  /**\n   * Check system requirements\n   */\n  async checkSystemRequirements(): Promise<any> {\n    const requirements = {\n      node: {\n        required: '>=18.0.0',\n        current: process.version,\n        satisfied: false\n      },\n      npm: {\n        required: '>=9.0.0',\n        current: '',\n        satisfied: false\n      },\n      diskSpace: {\n        required: '100MB',\n        available: '',\n        satisfied: false\n      },\n      permissions: {\n        required: 'write access to project directory',\n        satisfied: false\n      }\n    };\n    \n    try {\n      // Check npm version\n      const npmVersion = execSync('npm --version', { encoding: 'utf8' }).trim();\n      requirements.npm.current = npmVersion;\n      requirements.npm.satisfied = this.compareVersions(npmVersion, '9.0.0') >= 0;\n      \n      // Check disk space (simplified)\n      requirements.diskSpace.available = '1GB'; // Mock\n      requirements.diskSpace.satisfied = true;\n      \n      // Check permissions\n      try {\n        const testFile = path.join(process.cwd(), '.permission-test');\n        fs.writeFileSync(testFile, 'test');\n        fs.unlinkSync(testFile);\n        requirements.permissions.satisfied = true;\n      } catch {\n        requirements.permissions.satisfied = false;\n      }\n      \n      // Check node version\n      requirements.node.satisfied = this.compareVersions(process.version.replace('v', ''), '18.0.0') >= 0;\n      \n      const allSatisfied = Object.values(requirements).every(req => \n        typeof req === 'object' && 'satisfied' in req ? req.satisfied : true\n      );\n      \n      return {\n        requirements,\n        allSatisfied,\n        canUpdate: allSatisfied\n      };\n    } catch (error: any) {\n      this.log('error', `System check failed: ${error.message}`);\n      throw error;\n    }\n  }\n\n  /**\n   * Schedule automatic update check\n   */\n  scheduleAutoUpdateCheck(): void {\n    if (!this.options.enableAutoUpdate) return;\n    \n    const intervalMs = this.options.checkIntervalMinutes * 60 * 1000;\n    \n    setInterval(async () => {\n      try {\n        this.log('info', 'Performing scheduled update check');\n        const result = await this.checkForUpdates(false);\n        \n        if (result.updateAvailable && result.shouldUpdate) {\n          this.log('info', 'Auto-installing update...');\n          await this.installUpdate(result.latestVersion, false);\n        }\n      } catch (error: any) {\n        this.log('error', `Scheduled update check failed: ${error.message}`);\n      }\n    }, intervalMs);\n    \n    this.log('info', `Scheduled update check every ${this.options.checkIntervalMinutes} minutes`);\n  }\n}\n\n// ============================================================================\n// QUICK SELF-UPDATE UTILITIES\n// ============================================================================\n\n/**\n * Quick self-update utility\n */\nexport async function quickSelfUpdate(options?: Partial<SelfUpdateOptions>): Promise<any> {\n  console.log('Self-update capability ready for integration');\n  return {\n    message: 'Self-update system initialized',\n    version: '1.0.0',\n    capabilities: ['check', 'install', 'rollback', 'status']\n  };\n}\n\n/**\n * Register self-update capability with framework factory\n */\nexport function registerSelfUpdateCapability(): void {\n  // This would register with UniversalCapabilityFactory\n  // For now, export the capability class\n  console.log('Self-update capability ready for integration');\n}"],"mappings":"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","ignoreList":[]}