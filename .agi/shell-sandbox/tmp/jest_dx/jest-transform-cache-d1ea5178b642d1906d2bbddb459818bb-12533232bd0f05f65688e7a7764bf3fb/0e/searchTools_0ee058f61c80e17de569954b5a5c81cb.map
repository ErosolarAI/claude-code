{"version":3,"names":["_nodeFs","require","_nodePath","_errors","_grepTools","MAX_FILE_SIZE","IGNORED_DIRS","Set","BINARY_EXTENSIONS","FILE_TYPE_MAP","js","ts","py","rust","go","java","cpp","c","ruby","php","html","css","json","yaml","md","swift","kotlin","createSearchTools","workingDir","tools","name","description","parameters","type","properties","pattern","mode","enum","path","glob","ignoreCase","context","limit","required","additionalProperties","handler","args","trim","inferMode","pathArg","fileType","globPattern","contextLines","Math","min","searchPath","resolvePath","searchFiles","searchDefinitions","definitionType","searchContent","undefined","error","buildError","String","push","createGrepTools","includes","startsWith","normalized","join","options","regex","globToRegex","matches","walk","dir","length","entries","readdirSync","withFileTypes","entry","has","fullPath","isDirectory","test","stat","statSync","mtime","mtimeMs","sort","a","b","MAX_DISPLAY_LINES","limited","slice","relativePaths","map","m","rel","relative","result","escaped","replace","RegExp","flags","maxScan","searchFile","filePath","matchesFileType","matchesGlob","isBinary","size","content","readFileSync","lines","split","i","file","line","lastIndex","relPath","displayPath","patterns","function","class","interface","const","any","patternStr","isCodeFile","ext","extname","toLowerCase","extensions","codeExts"],"sources":["searchTools.ts"],"sourcesContent":["/**\n * Unified Search Tools - Combines file pattern matching and content search\n *\n * Provides a single, powerful Search tool that handles:\n * - File pattern matching (glob)\n * - Content search (regex/grep)\n * - Definition finding\n */\n\nimport { readFileSync, readdirSync, statSync } from 'node:fs';\nimport { join, relative, extname } from 'node:path';\nimport type { ToolDefinition } from '../core/toolRuntime.js';\nimport { buildError } from '../core/errors.js';\nimport { createGrepTools } from './grepTools.js';\n\nconst MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB\n\nconst IGNORED_DIRS = new Set([\n  '.git', 'node_modules', 'dist', '.next', 'build', 'coverage',\n  '.turbo', '.cache', '__pycache__', '.pytest_cache', '.venv', 'venv',\n  '.agi',\n]);\n\nconst BINARY_EXTENSIONS = new Set([\n  '.png', '.jpg', '.jpeg', '.gif', '.bmp', '.ico', '.svg',\n  '.pdf', '.zip', '.tar', '.gz', '.7z', '.rar',\n  '.exe', '.dll', '.so', '.dylib', '.bin',\n  '.mp3', '.mp4', '.avi', '.mov', '.flv',\n  '.woff', '.woff2', '.ttf', '.eot',\n]);\n\nconst FILE_TYPE_MAP: Record<string, string[]> = {\n  js: ['.js', '.jsx', '.mjs', '.cjs'],\n  ts: ['.ts', '.tsx'],\n  py: ['.py'],\n  rust: ['.rs'],\n  go: ['.go'],\n  java: ['.java'],\n  cpp: ['.cpp', '.cc', '.cxx', '.hpp', '.h'],\n  c: ['.c', '.h'],\n  ruby: ['.rb'],\n  php: ['.php'],\n  html: ['.html', '.htm'],\n  css: ['.css', '.scss', '.sass', '.less'],\n  json: ['.json'],\n  yaml: ['.yaml', '.yml'],\n  md: ['.md', '.markdown'],\n  swift: ['.swift'],\n  kotlin: ['.kt', '.kts'],\n};\n\nexport function createSearchTools(workingDir: string): ToolDefinition[] {\n  const tools: ToolDefinition[] = [\n    {\n      name: 'Search',\n      description: 'Unified search tool for files and content. Use mode=\"files\" for glob patterns, mode=\"content\" for regex search, mode=\"definition\" for code definitions.',\n      parameters: {\n        type: 'object',\n        properties: {\n          pattern: {\n            type: 'string',\n            description: 'Search pattern - glob pattern for files mode, regex for content/definition mode',\n          },\n          mode: {\n            type: 'string',\n            enum: ['files', 'content', 'definition'],\n            description: 'Search mode: \"files\" (glob), \"content\" (grep), \"definition\" (find functions/classes)',\n          },\n          path: {\n            type: 'string',\n            description: 'Directory to search in (defaults to working directory)',\n          },\n          type: {\n            type: 'string',\n            description: 'File type filter (js, ts, py, go, etc.) or definition type (function, class, interface)',\n          },\n          glob: {\n            type: 'string',\n            description: 'Glob pattern to filter files (e.g., \"*.ts\", \"src/**/*.js\")',\n          },\n          ignoreCase: {\n            type: 'boolean',\n            description: 'Case insensitive search (default: true for content, false for files)',\n          },\n          context: {\n            type: 'number',\n            description: 'Lines of context around matches (content mode only)',\n          },\n          limit: {\n            type: 'number',\n            description: 'Maximum results to return (default: 20)',\n          },\n        },\n        required: ['pattern'],\n        additionalProperties: true,\n      },\n      handler: async (args) => {\n        const pattern = args['pattern'];\n        if (typeof pattern !== 'string' || !pattern.trim()) {\n          return 'Error: pattern is required';\n        }\n\n        const mode = (args['mode'] as string) || inferMode(pattern);\n        const pathArg = args['path'];\n        const fileType = args['type'];\n        const globPattern = args['glob'];\n        const ignoreCase = args['ignoreCase'] === true || (args['ignoreCase'] !== false && mode === 'content');\n        const contextLines = typeof args['context'] === 'number' ? args['context'] : 0;\n        const limit = typeof args['limit'] === 'number' ? Math.min(args['limit'], 100) : 20;\n\n        const searchPath = pathArg && typeof pathArg === 'string'\n          ? resolvePath(workingDir, pathArg)\n          : workingDir;\n\n        try {\n          switch (mode) {\n            case 'files':\n              return searchFiles(searchPath, workingDir, pattern, { limit });\n\n            case 'definition':\n              return searchDefinitions(searchPath, workingDir, pattern, {\n                definitionType: typeof fileType === 'string' ? fileType : 'any',\n                limit,\n              });\n\n            case 'content':\n            default:\n              return searchContent(searchPath, workingDir, pattern, {\n                ignoreCase,\n                fileType: typeof fileType === 'string' ? fileType : undefined,\n                globPattern: typeof globPattern === 'string' ? globPattern : undefined,\n                contextLines,\n                limit,\n              });\n          }\n        } catch (error) {\n          return buildError('search', error, { pattern: String(pattern), mode: String(mode) });\n        }\n      },\n    },\n  ];\n\n  // Add grep-style search as a complementary tool for backward compatibility\n  tools.push(...createGrepTools(workingDir));\n\n  return tools;\n}\n\nfunction inferMode(pattern: string): string {\n  // Glob patterns\n  if (pattern.includes('*') || pattern.includes('?') || pattern.includes('[')) {\n    if (pattern.includes('/') || pattern.startsWith('*.')) {\n      return 'files';\n    }\n  }\n  return 'content';\n}\n\nfunction resolvePath(workingDir: string, path: string): string {\n  const normalized = path.trim();\n  return normalized.startsWith('/') ? normalized : join(workingDir, normalized);\n}\n\n// ============================================================================\n// FILES MODE - Glob pattern matching\n// ============================================================================\n\nfunction searchFiles(\n  searchPath: string,\n  workingDir: string,\n  pattern: string,\n  options: { limit: number }\n): string {\n  const regex = globToRegex(pattern);\n  const matches: Array<{ path: string; mtime: number }> = [];\n\n  function walk(dir: string) {\n    if (matches.length >= options.limit * 2) return;\n    try {\n      const entries = readdirSync(dir, { withFileTypes: true });\n      for (const entry of entries) {\n        if (IGNORED_DIRS.has(entry.name)) continue;\n        const fullPath = join(dir, entry.name);\n        if (entry.isDirectory()) {\n          walk(fullPath);\n        } else if (regex.test(fullPath)) {\n          try {\n            const stat = statSync(fullPath);\n            matches.push({ path: fullPath, mtime: stat.mtimeMs });\n          } catch { /* skip */ }\n        }\n      }\n    } catch { /* skip */ }\n  }\n\n  walk(searchPath);\n\n  // Sort by modification time (newest first)\n  matches.sort((a, b) => b.mtime - a.mtime);\n\n  const MAX_DISPLAY_LINES = 5;\n  const limited = matches.slice(0, Math.min(options.limit, MAX_DISPLAY_LINES));\n  if (limited.length === 0) {\n    return `No files matching: ${pattern}`;\n  }\n\n  const relativePaths = limited.map(m => {\n    const rel = relative(workingDir, m.path);\n    return rel && !rel.startsWith('..') ? rel : m.path;\n  });\n\n  let result = `${matches.length} file(s) matching \"${pattern}\":\\n${relativePaths.join('\\n')}`;\n  if (matches.length > MAX_DISPLAY_LINES) {\n    result += `\\n... +${matches.length - MAX_DISPLAY_LINES} more files`;\n  }\n\n  return result;\n}\n\nfunction globToRegex(pattern: string): RegExp {\n  const escaped = pattern\n    .replace(/[.+^${}()|[\\]\\\\]/g, '\\\\$&')\n    .replace(/\\*\\*/g, '<!GLOBSTAR!>')\n    .replace(/\\*/g, '[^/]*')\n    .replace(/<!GLOBSTAR!>/g, '.*')\n    .replace(/\\?/g, '.');\n  return new RegExp(`${escaped}$`);\n}\n\n// ============================================================================\n// CONTENT MODE - Regex search in file contents\n// ============================================================================\n\ninterface ContentMatch {\n  file: string;\n  line: number;\n  content: string;\n}\n\nfunction searchContent(\n  searchPath: string,\n  workingDir: string,\n  pattern: string,\n  options: {\n    ignoreCase: boolean;\n    fileType?: string;\n    globPattern?: string;\n    contextLines: number;\n    limit: number;\n  }\n): string {\n  const flags = options.ignoreCase ? 'gi' : 'g';\n  const regex = new RegExp(pattern, flags);\n  const matches: ContentMatch[] = [];\n  const maxScan = options.limit * 3;\n\n  function walk(dir: string) {\n    if (matches.length >= maxScan) return;\n    try {\n      const entries = readdirSync(dir, { withFileTypes: true });\n      for (const entry of entries) {\n        if (IGNORED_DIRS.has(entry.name)) continue;\n        if (matches.length >= maxScan) break;\n        const fullPath = join(dir, entry.name);\n        if (entry.isDirectory()) {\n          walk(fullPath);\n        } else {\n          searchFile(fullPath);\n        }\n      }\n    } catch { /* skip */ }\n  }\n\n  function searchFile(filePath: string) {\n    // Filter by type\n    if (options.fileType && !matchesFileType(filePath, options.fileType)) return;\n    if (options.globPattern && !matchesGlob(filePath, options.globPattern)) return;\n    if (isBinary(filePath)) return;\n\n    try {\n      const stat = statSync(filePath);\n      if (stat.size > MAX_FILE_SIZE) return;\n\n      const content = readFileSync(filePath, 'utf-8');\n      const lines = content.split('\\n');\n\n      for (let i = 0; i < lines.length && matches.length < maxScan; i++) {\n        if (regex.test(lines[i]!)) {\n          matches.push({\n            file: filePath,\n            line: i + 1,\n            content: lines[i]!.trim(),\n          });\n        }\n        regex.lastIndex = 0; // Reset for next test\n      }\n    } catch { /* skip */ }\n  }\n\n  walk(searchPath);\n\n  if (matches.length === 0) {\n    return `No matches for: ${pattern}`;\n  }\n\n  const MAX_DISPLAY_LINES = 5;\n  const limited = matches.slice(0, Math.min(options.limit, MAX_DISPLAY_LINES));\n  const lines: string[] = [];\n\n  for (const m of limited) {\n    const relPath = relative(workingDir, m.file);\n    const displayPath = relPath && !relPath.startsWith('..') ? relPath : m.file;\n    lines.push(`${displayPath}:${m.line}: ${m.content.slice(0, 80)}${m.content.length > 80 ? '...' : ''}`);\n  }\n\n  let result = lines.join('\\n');\n  if (matches.length > MAX_DISPLAY_LINES) {\n    result += `\\n... +${matches.length - MAX_DISPLAY_LINES} more matches`;\n  }\n\n  return result;\n}\n\n// ============================================================================\n// DEFINITION MODE - Find code definitions\n// ============================================================================\n\nfunction searchDefinitions(\n  searchPath: string,\n  workingDir: string,\n  name: string,\n  options: { definitionType: string; limit: number }\n): string {\n  const patterns: Record<string, string> = {\n    function: `(function\\\\s+${name}|const\\\\s+${name}\\\\s*=.*=>|${name}\\\\s*\\\\([^)]*\\\\)\\\\s*\\\\{)`,\n    class: `class\\\\s+${name}`,\n    interface: `interface\\\\s+${name}`,\n    type: `type\\\\s+${name}`,\n    const: `const\\\\s+${name}`,\n    any: `(function\\\\s+${name}|class\\\\s+${name}|interface\\\\s+${name}|type\\\\s+${name}|const\\\\s+${name})`,\n  };\n\n  const patternStr = patterns[options.definitionType] || patterns['any'];\n  const regex = new RegExp(patternStr!, 'gi');\n  const matches: ContentMatch[] = [];\n\n  function walk(dir: string) {\n    if (matches.length >= options.limit * 2) return;\n    try {\n      const entries = readdirSync(dir, { withFileTypes: true });\n      for (const entry of entries) {\n        if (IGNORED_DIRS.has(entry.name)) continue;\n        if (matches.length >= options.limit * 2) break;\n        const fullPath = join(dir, entry.name);\n        if (entry.isDirectory()) {\n          walk(fullPath);\n        } else if (isCodeFile(fullPath)) {\n          searchFile(fullPath);\n        }\n      }\n    } catch { /* skip */ }\n  }\n\n  function searchFile(filePath: string) {\n    try {\n      const stat = statSync(filePath);\n      if (stat.size > MAX_FILE_SIZE) return;\n\n      const content = readFileSync(filePath, 'utf-8');\n      const lines = content.split('\\n');\n\n      for (let i = 0; i < lines.length && matches.length < options.limit * 2; i++) {\n        if (regex.test(lines[i]!)) {\n          matches.push({\n            file: filePath,\n            line: i + 1,\n            content: lines[i]!.trim(),\n          });\n        }\n        regex.lastIndex = 0;\n      }\n    } catch { /* skip */ }\n  }\n\n  walk(searchPath);\n\n  if (matches.length === 0) {\n    return `No definitions found for: ${name}`;\n  }\n\n  const MAX_DISPLAY_LINES = 5;\n  const limited = matches.slice(0, Math.min(options.limit, MAX_DISPLAY_LINES));\n  const lines: string[] = [];\n\n  for (const m of limited) {\n    const relPath = relative(workingDir, m.file);\n    const displayPath = relPath && !relPath.startsWith('..') ? relPath : m.file;\n    lines.push(`${displayPath}:${m.line}: ${m.content.slice(0, 80)}${m.content.length > 80 ? '...' : ''}`);\n  }\n\n  if (matches.length > MAX_DISPLAY_LINES) {\n    lines.push(`... +${matches.length - MAX_DISPLAY_LINES} more definitions`);\n  }\n\n  return lines.join('\\n');\n}\n\n// ============================================================================\n// Utility functions\n// ============================================================================\n\nfunction matchesFileType(filePath: string, fileType: string): boolean {\n  const ext = extname(filePath).toLowerCase();\n  const extensions = FILE_TYPE_MAP[fileType.toLowerCase()];\n  return extensions ? extensions.includes(ext) : false;\n}\n\nfunction matchesGlob(filePath: string, pattern: string): boolean {\n  const regex = globToRegex(pattern);\n  return regex.test(filePath);\n}\n\nfunction isBinary(filePath: string): boolean {\n  return BINARY_EXTENSIONS.has(extname(filePath).toLowerCase());\n}\n\nfunction isCodeFile(filePath: string): boolean {\n  const ext = extname(filePath).toLowerCase();\n  const codeExts = ['.ts', '.tsx', '.js', '.jsx', '.py', '.go', '.rs', '.java', '.rb', '.swift', '.kt'];\n  return codeExts.includes(ext);\n}\n\n// Legacy exports for backward compatibility\nexport { createSearchTools as createGrepTools };\n"],"mappings":";;;;;;AASA,IAAAA,OAAA,GAAAC,OAAA;AACA,IAAAC,SAAA,GAAAD,OAAA;AAEA,IAAAE,OAAA,GAAAF,OAAA;AACA,IAAAG,UAAA,GAAAH,OAAA;AAbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAQA,MAAMI,aAAa,GAAG,CAAC,GAAG,IAAI,GAAG,IAAI,CAAC,CAAC;;AAEvC,MAAMC,YAAY,GAAG,IAAIC,GAAG,CAAC,CAC3B,MAAM,EAAE,cAAc,EAAE,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,UAAU,EAC5D,QAAQ,EAAE,QAAQ,EAAE,aAAa,EAAE,eAAe,EAAE,OAAO,EAAE,MAAM,EACnE,MAAM,CACP,CAAC;AAEF,MAAMC,iBAAiB,GAAG,IAAID,GAAG,CAAC,CAChC,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EACvD,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAC5C,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,MAAM,EACvC,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EACtC,OAAO,EAAE,QAAQ,EAAE,MAAM,EAAE,MAAM,CAClC,CAAC;AAEF,MAAME,aAAuC,GAAG;EAC9CC,EAAE,EAAE,CAAC,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,CAAC;EACnCC,EAAE,EAAE,CAAC,KAAK,EAAE,MAAM,CAAC;EACnBC,EAAE,EAAE,CAAC,KAAK,CAAC;EACXC,IAAI,EAAE,CAAC,KAAK,CAAC;EACbC,EAAE,EAAE,CAAC,KAAK,CAAC;EACXC,IAAI,EAAE,CAAC,OAAO,CAAC;EACfC,GAAG,EAAE,CAAC,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,EAAE,IAAI,CAAC;EAC1CC,CAAC,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC;EACfC,IAAI,EAAE,CAAC,KAAK,CAAC;EACbC,GAAG,EAAE,CAAC,MAAM,CAAC;EACbC,IAAI,EAAE,CAAC,OAAO,EAAE,MAAM,CAAC;EACvBC,GAAG,EAAE,CAAC,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,OAAO,CAAC;EACxCC,IAAI,EAAE,CAAC,OAAO,CAAC;EACfC,IAAI,EAAE,CAAC,OAAO,EAAE,MAAM,CAAC;EACvBC,EAAE,EAAE,CAAC,KAAK,EAAE,WAAW,CAAC;EACxBC,KAAK,EAAE,CAAC,QAAQ,CAAC;EACjBC,MAAM,EAAE,CAAC,KAAK,EAAE,MAAM;AACxB,CAAC;AAEM,SAASC,iBAAiBA,CAACC,UAAkB,EAAoB;EACtE,MAAMC,KAAuB,GAAG,CAC9B;IACEC,IAAI,EAAE,QAAQ;IACdC,WAAW,EAAE,yJAAyJ;IACtKC,UAAU,EAAE;MACVC,IAAI,EAAE,QAAQ;MACdC,UAAU,EAAE;QACVC,OAAO,EAAE;UACPF,IAAI,EAAE,QAAQ;UACdF,WAAW,EAAE;QACf,CAAC;QACDK,IAAI,EAAE;UACJH,IAAI,EAAE,QAAQ;UACdI,IAAI,EAAE,CAAC,OAAO,EAAE,SAAS,EAAE,YAAY,CAAC;UACxCN,WAAW,EAAE;QACf,CAAC;QACDO,IAAI,EAAE;UACJL,IAAI,EAAE,QAAQ;UACdF,WAAW,EAAE;QACf,CAAC;QACDE,IAAI,EAAE;UACJA,IAAI,EAAE,QAAQ;UACdF,WAAW,EAAE;QACf,CAAC;QACDQ,IAAI,EAAE;UACJN,IAAI,EAAE,QAAQ;UACdF,WAAW,EAAE;QACf,CAAC;QACDS,UAAU,EAAE;UACVP,IAAI,EAAE,SAAS;UACfF,WAAW,EAAE;QACf,CAAC;QACDU,OAAO,EAAE;UACPR,IAAI,EAAE,QAAQ;UACdF,WAAW,EAAE;QACf,CAAC;QACDW,KAAK,EAAE;UACLT,IAAI,EAAE,QAAQ;UACdF,WAAW,EAAE;QACf;MACF,CAAC;MACDY,QAAQ,EAAE,CAAC,SAAS,CAAC;MACrBC,oBAAoB,EAAE;IACxB,CAAC;IACDC,OAAO,EAAE,MAAOC,IAAI,IAAK;MACvB,MAAMX,OAAO,GAAGW,IAAI,CAAC,SAAS,CAAC;MAC/B,IAAI,OAAOX,OAAO,KAAK,QAAQ,IAAI,CAACA,OAAO,CAACY,IAAI,CAAC,CAAC,EAAE;QAClD,OAAO,4BAA4B;MACrC;MAEA,MAAMX,IAAI,GAAIU,IAAI,CAAC,MAAM,CAAC,IAAeE,SAAS,CAACb,OAAO,CAAC;MAC3D,MAAMc,OAAO,GAAGH,IAAI,CAAC,MAAM,CAAC;MAC5B,MAAMI,QAAQ,GAAGJ,IAAI,CAAC,MAAM,CAAC;MAC7B,MAAMK,WAAW,GAAGL,IAAI,CAAC,MAAM,CAAC;MAChC,MAAMN,UAAU,GAAGM,IAAI,CAAC,YAAY,CAAC,KAAK,IAAI,IAAKA,IAAI,CAAC,YAAY,CAAC,KAAK,KAAK,IAAIV,IAAI,KAAK,SAAU;MACtG,MAAMgB,YAAY,GAAG,OAAON,IAAI,CAAC,SAAS,CAAC,KAAK,QAAQ,GAAGA,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC;MAC9E,MAAMJ,KAAK,GAAG,OAAOI,IAAI,CAAC,OAAO,CAAC,KAAK,QAAQ,GAAGO,IAAI,CAACC,GAAG,CAACR,IAAI,CAAC,OAAO,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE;MAEnF,MAAMS,UAAU,GAAGN,OAAO,IAAI,OAAOA,OAAO,KAAK,QAAQ,GACrDO,WAAW,CAAC5B,UAAU,EAAEqB,OAAO,CAAC,GAChCrB,UAAU;MAEd,IAAI;QACF,QAAQQ,IAAI;UACV,KAAK,OAAO;YACV,OAAOqB,WAAW,CAACF,UAAU,EAAE3B,UAAU,EAAEO,OAAO,EAAE;cAAEO;YAAM,CAAC,CAAC;UAEhE,KAAK,YAAY;YACf,OAAOgB,iBAAiB,CAACH,UAAU,EAAE3B,UAAU,EAAEO,OAAO,EAAE;cACxDwB,cAAc,EAAE,OAAOT,QAAQ,KAAK,QAAQ,GAAGA,QAAQ,GAAG,KAAK;cAC/DR;YACF,CAAC,CAAC;UAEJ,KAAK,SAAS;UACd;YACE,OAAOkB,aAAa,CAACL,UAAU,EAAE3B,UAAU,EAAEO,OAAO,EAAE;cACpDK,UAAU;cACVU,QAAQ,EAAE,OAAOA,QAAQ,KAAK,QAAQ,GAAGA,QAAQ,GAAGW,SAAS;cAC7DV,WAAW,EAAE,OAAOA,WAAW,KAAK,QAAQ,GAAGA,WAAW,GAAGU,SAAS;cACtET,YAAY;cACZV;YACF,CAAC,CAAC;QACN;MACF,CAAC,CAAC,OAAOoB,KAAK,EAAE;QACd,OAAO,IAAAC,kBAAU,EAAC,QAAQ,EAAED,KAAK,EAAE;UAAE3B,OAAO,EAAE6B,MAAM,CAAC7B,OAAO,CAAC;UAAEC,IAAI,EAAE4B,MAAM,CAAC5B,IAAI;QAAE,CAAC,CAAC;MACtF;IACF;EACF,CAAC,CACF;;EAED;EACAP,KAAK,CAACoC,IAAI,CAAC,GAAG,IAAAC,0BAAe,EAACtC,UAAU,CAAC,CAAC;EAE1C,OAAOC,KAAK;AACd;AAEA,SAASmB,SAASA,CAACb,OAAe,EAAU;EAC1C;EACA,IAAIA,OAAO,CAACgC,QAAQ,CAAC,GAAG,CAAC,IAAIhC,OAAO,CAACgC,QAAQ,CAAC,GAAG,CAAC,IAAIhC,OAAO,CAACgC,QAAQ,CAAC,GAAG,CAAC,EAAE;IAC3E,IAAIhC,OAAO,CAACgC,QAAQ,CAAC,GAAG,CAAC,IAAIhC,OAAO,CAACiC,UAAU,CAAC,IAAI,CAAC,EAAE;MACrD,OAAO,OAAO;IAChB;EACF;EACA,OAAO,SAAS;AAClB;AAEA,SAASZ,WAAWA,CAAC5B,UAAkB,EAAEU,IAAY,EAAU;EAC7D,MAAM+B,UAAU,GAAG/B,IAAI,CAACS,IAAI,CAAC,CAAC;EAC9B,OAAOsB,UAAU,CAACD,UAAU,CAAC,GAAG,CAAC,GAAGC,UAAU,GAAG,IAAAC,cAAI,EAAC1C,UAAU,EAAEyC,UAAU,CAAC;AAC/E;;AAEA;AACA;AACA;;AAEA,SAASZ,WAAWA,CAClBF,UAAkB,EAClB3B,UAAkB,EAClBO,OAAe,EACfoC,OAA0B,EAClB;EACR,MAAMC,KAAK,GAAGC,WAAW,CAACtC,OAAO,CAAC;EAClC,MAAMuC,OAA+C,GAAG,EAAE;EAE1D,SAASC,IAAIA,CAACC,GAAW,EAAE;IACzB,IAAIF,OAAO,CAACG,MAAM,IAAIN,OAAO,CAAC7B,KAAK,GAAG,CAAC,EAAE;IACzC,IAAI;MACF,MAAMoC,OAAO,GAAG,IAAAC,mBAAW,EAACH,GAAG,EAAE;QAAEI,aAAa,EAAE;MAAK,CAAC,CAAC;MACzD,KAAK,MAAMC,KAAK,IAAIH,OAAO,EAAE;QAC3B,IAAIxE,YAAY,CAAC4E,GAAG,CAACD,KAAK,CAACnD,IAAI,CAAC,EAAE;QAClC,MAAMqD,QAAQ,GAAG,IAAAb,cAAI,EAACM,GAAG,EAAEK,KAAK,CAACnD,IAAI,CAAC;QACtC,IAAImD,KAAK,CAACG,WAAW,CAAC,CAAC,EAAE;UACvBT,IAAI,CAACQ,QAAQ,CAAC;QAChB,CAAC,MAAM,IAAIX,KAAK,CAACa,IAAI,CAACF,QAAQ,CAAC,EAAE;UAC/B,IAAI;YACF,MAAMG,IAAI,GAAG,IAAAC,gBAAQ,EAACJ,QAAQ,CAAC;YAC/BT,OAAO,CAACT,IAAI,CAAC;cAAE3B,IAAI,EAAE6C,QAAQ;cAAEK,KAAK,EAAEF,IAAI,CAACG;YAAQ,CAAC,CAAC;UACvD,CAAC,CAAC,MAAM,CAAE;QACZ;MACF;IACF,CAAC,CAAC,MAAM,CAAE;EACZ;EAEAd,IAAI,CAACpB,UAAU,CAAC;;EAEhB;EACAmB,OAAO,CAACgB,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKA,CAAC,CAACJ,KAAK,GAAGG,CAAC,CAACH,KAAK,CAAC;EAEzC,MAAMK,iBAAiB,GAAG,CAAC;EAC3B,MAAMC,OAAO,GAAGpB,OAAO,CAACqB,KAAK,CAAC,CAAC,EAAE1C,IAAI,CAACC,GAAG,CAACiB,OAAO,CAAC7B,KAAK,EAAEmD,iBAAiB,CAAC,CAAC;EAC5E,IAAIC,OAAO,CAACjB,MAAM,KAAK,CAAC,EAAE;IACxB,OAAO,sBAAsB1C,OAAO,EAAE;EACxC;EAEA,MAAM6D,aAAa,GAAGF,OAAO,CAACG,GAAG,CAACC,CAAC,IAAI;IACrC,MAAMC,GAAG,GAAG,IAAAC,kBAAQ,EAACxE,UAAU,EAAEsE,CAAC,CAAC5D,IAAI,CAAC;IACxC,OAAO6D,GAAG,IAAI,CAACA,GAAG,CAAC/B,UAAU,CAAC,IAAI,CAAC,GAAG+B,GAAG,GAAGD,CAAC,CAAC5D,IAAI;EACpD,CAAC,CAAC;EAEF,IAAI+D,MAAM,GAAG,GAAG3B,OAAO,CAACG,MAAM,sBAAsB1C,OAAO,OAAO6D,aAAa,CAAC1B,IAAI,CAAC,IAAI,CAAC,EAAE;EAC5F,IAAII,OAAO,CAACG,MAAM,GAAGgB,iBAAiB,EAAE;IACtCQ,MAAM,IAAI,UAAU3B,OAAO,CAACG,MAAM,GAAGgB,iBAAiB,aAAa;EACrE;EAEA,OAAOQ,MAAM;AACf;AAEA,SAAS5B,WAAWA,CAACtC,OAAe,EAAU;EAC5C,MAAMmE,OAAO,GAAGnE,OAAO,CACpBoE,OAAO,CAAC,mBAAmB,EAAE,MAAM,CAAC,CACpCA,OAAO,CAAC,OAAO,EAAE,cAAc,CAAC,CAChCA,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,CACvBA,OAAO,CAAC,eAAe,EAAE,IAAI,CAAC,CAC9BA,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC;EACtB,OAAO,IAAIC,MAAM,CAAC,GAAGF,OAAO,GAAG,CAAC;AAClC;;AAEA;AACA;AACA;;AAQA,SAAS1C,aAAaA,CACpBL,UAAkB,EAClB3B,UAAkB,EAClBO,OAAe,EACfoC,OAMC,EACO;EACR,MAAMkC,KAAK,GAAGlC,OAAO,CAAC/B,UAAU,GAAG,IAAI,GAAG,GAAG;EAC7C,MAAMgC,KAAK,GAAG,IAAIgC,MAAM,CAACrE,OAAO,EAAEsE,KAAK,CAAC;EACxC,MAAM/B,OAAuB,GAAG,EAAE;EAClC,MAAMgC,OAAO,GAAGnC,OAAO,CAAC7B,KAAK,GAAG,CAAC;EAEjC,SAASiC,IAAIA,CAACC,GAAW,EAAE;IACzB,IAAIF,OAAO,CAACG,MAAM,IAAI6B,OAAO,EAAE;IAC/B,IAAI;MACF,MAAM5B,OAAO,GAAG,IAAAC,mBAAW,EAACH,GAAG,EAAE;QAAEI,aAAa,EAAE;MAAK,CAAC,CAAC;MACzD,KAAK,MAAMC,KAAK,IAAIH,OAAO,EAAE;QAC3B,IAAIxE,YAAY,CAAC4E,GAAG,CAACD,KAAK,CAACnD,IAAI,CAAC,EAAE;QAClC,IAAI4C,OAAO,CAACG,MAAM,IAAI6B,OAAO,EAAE;QAC/B,MAAMvB,QAAQ,GAAG,IAAAb,cAAI,EAACM,GAAG,EAAEK,KAAK,CAACnD,IAAI,CAAC;QACtC,IAAImD,KAAK,CAACG,WAAW,CAAC,CAAC,EAAE;UACvBT,IAAI,CAACQ,QAAQ,CAAC;QAChB,CAAC,MAAM;UACLwB,UAAU,CAACxB,QAAQ,CAAC;QACtB;MACF;IACF,CAAC,CAAC,MAAM,CAAE;EACZ;EAEA,SAASwB,UAAUA,CAACC,QAAgB,EAAE;IACpC;IACA,IAAIrC,OAAO,CAACrB,QAAQ,IAAI,CAAC2D,eAAe,CAACD,QAAQ,EAAErC,OAAO,CAACrB,QAAQ,CAAC,EAAE;IACtE,IAAIqB,OAAO,CAACpB,WAAW,IAAI,CAAC2D,WAAW,CAACF,QAAQ,EAAErC,OAAO,CAACpB,WAAW,CAAC,EAAE;IACxE,IAAI4D,QAAQ,CAACH,QAAQ,CAAC,EAAE;IAExB,IAAI;MACF,MAAMtB,IAAI,GAAG,IAAAC,gBAAQ,EAACqB,QAAQ,CAAC;MAC/B,IAAItB,IAAI,CAAC0B,IAAI,GAAG3G,aAAa,EAAE;MAE/B,MAAM4G,OAAO,GAAG,IAAAC,oBAAY,EAACN,QAAQ,EAAE,OAAO,CAAC;MAC/C,MAAMO,KAAK,GAAGF,OAAO,CAACG,KAAK,CAAC,IAAI,CAAC;MAEjC,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,KAAK,CAACtC,MAAM,IAAIH,OAAO,CAACG,MAAM,GAAG6B,OAAO,EAAEW,CAAC,EAAE,EAAE;QACjE,IAAI7C,KAAK,CAACa,IAAI,CAAC8B,KAAK,CAACE,CAAC,CAAE,CAAC,EAAE;UACzB3C,OAAO,CAACT,IAAI,CAAC;YACXqD,IAAI,EAAEV,QAAQ;YACdW,IAAI,EAAEF,CAAC,GAAG,CAAC;YACXJ,OAAO,EAAEE,KAAK,CAACE,CAAC,CAAC,CAAEtE,IAAI,CAAC;UAC1B,CAAC,CAAC;QACJ;QACAyB,KAAK,CAACgD,SAAS,GAAG,CAAC,CAAC,CAAC;MACvB;IACF,CAAC,CAAC,MAAM,CAAE;EACZ;EAEA7C,IAAI,CAACpB,UAAU,CAAC;EAEhB,IAAImB,OAAO,CAACG,MAAM,KAAK,CAAC,EAAE;IACxB,OAAO,mBAAmB1C,OAAO,EAAE;EACrC;EAEA,MAAM0D,iBAAiB,GAAG,CAAC;EAC3B,MAAMC,OAAO,GAAGpB,OAAO,CAACqB,KAAK,CAAC,CAAC,EAAE1C,IAAI,CAACC,GAAG,CAACiB,OAAO,CAAC7B,KAAK,EAAEmD,iBAAiB,CAAC,CAAC;EAC5E,MAAMsB,KAAe,GAAG,EAAE;EAE1B,KAAK,MAAMjB,CAAC,IAAIJ,OAAO,EAAE;IACvB,MAAM2B,OAAO,GAAG,IAAArB,kBAAQ,EAACxE,UAAU,EAAEsE,CAAC,CAACoB,IAAI,CAAC;IAC5C,MAAMI,WAAW,GAAGD,OAAO,IAAI,CAACA,OAAO,CAACrD,UAAU,CAAC,IAAI,CAAC,GAAGqD,OAAO,GAAGvB,CAAC,CAACoB,IAAI;IAC3EH,KAAK,CAAClD,IAAI,CAAC,GAAGyD,WAAW,IAAIxB,CAAC,CAACqB,IAAI,KAAKrB,CAAC,CAACe,OAAO,CAAClB,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,GAAGG,CAAC,CAACe,OAAO,CAACpC,MAAM,GAAG,EAAE,GAAG,KAAK,GAAG,EAAE,EAAE,CAAC;EACxG;EAEA,IAAIwB,MAAM,GAAGc,KAAK,CAAC7C,IAAI,CAAC,IAAI,CAAC;EAC7B,IAAII,OAAO,CAACG,MAAM,GAAGgB,iBAAiB,EAAE;IACtCQ,MAAM,IAAI,UAAU3B,OAAO,CAACG,MAAM,GAAGgB,iBAAiB,eAAe;EACvE;EAEA,OAAOQ,MAAM;AACf;;AAEA;AACA;AACA;;AAEA,SAAS3C,iBAAiBA,CACxBH,UAAkB,EAClB3B,UAAkB,EAClBE,IAAY,EACZyC,OAAkD,EAC1C;EACR,MAAMoD,QAAgC,GAAG;IACvCC,QAAQ,EAAE,gBAAgB9F,IAAI,aAAaA,IAAI,aAAaA,IAAI,yBAAyB;IACzF+F,KAAK,EAAE,YAAY/F,IAAI,EAAE;IACzBgG,SAAS,EAAE,gBAAgBhG,IAAI,EAAE;IACjCG,IAAI,EAAE,WAAWH,IAAI,EAAE;IACvBiG,KAAK,EAAE,YAAYjG,IAAI,EAAE;IACzBkG,GAAG,EAAE,gBAAgBlG,IAAI,aAAaA,IAAI,iBAAiBA,IAAI,YAAYA,IAAI,aAAaA,IAAI;EAClG,CAAC;EAED,MAAMmG,UAAU,GAAGN,QAAQ,CAACpD,OAAO,CAACZ,cAAc,CAAC,IAAIgE,QAAQ,CAAC,KAAK,CAAC;EACtE,MAAMnD,KAAK,GAAG,IAAIgC,MAAM,CAACyB,UAAU,EAAG,IAAI,CAAC;EAC3C,MAAMvD,OAAuB,GAAG,EAAE;EAElC,SAASC,IAAIA,CAACC,GAAW,EAAE;IACzB,IAAIF,OAAO,CAACG,MAAM,IAAIN,OAAO,CAAC7B,KAAK,GAAG,CAAC,EAAE;IACzC,IAAI;MACF,MAAMoC,OAAO,GAAG,IAAAC,mBAAW,EAACH,GAAG,EAAE;QAAEI,aAAa,EAAE;MAAK,CAAC,CAAC;MACzD,KAAK,MAAMC,KAAK,IAAIH,OAAO,EAAE;QAC3B,IAAIxE,YAAY,CAAC4E,GAAG,CAACD,KAAK,CAACnD,IAAI,CAAC,EAAE;QAClC,IAAI4C,OAAO,CAACG,MAAM,IAAIN,OAAO,CAAC7B,KAAK,GAAG,CAAC,EAAE;QACzC,MAAMyC,QAAQ,GAAG,IAAAb,cAAI,EAACM,GAAG,EAAEK,KAAK,CAACnD,IAAI,CAAC;QACtC,IAAImD,KAAK,CAACG,WAAW,CAAC,CAAC,EAAE;UACvBT,IAAI,CAACQ,QAAQ,CAAC;QAChB,CAAC,MAAM,IAAI+C,UAAU,CAAC/C,QAAQ,CAAC,EAAE;UAC/BwB,UAAU,CAACxB,QAAQ,CAAC;QACtB;MACF;IACF,CAAC,CAAC,MAAM,CAAE;EACZ;EAEA,SAASwB,UAAUA,CAACC,QAAgB,EAAE;IACpC,IAAI;MACF,MAAMtB,IAAI,GAAG,IAAAC,gBAAQ,EAACqB,QAAQ,CAAC;MAC/B,IAAItB,IAAI,CAAC0B,IAAI,GAAG3G,aAAa,EAAE;MAE/B,MAAM4G,OAAO,GAAG,IAAAC,oBAAY,EAACN,QAAQ,EAAE,OAAO,CAAC;MAC/C,MAAMO,KAAK,GAAGF,OAAO,CAACG,KAAK,CAAC,IAAI,CAAC;MAEjC,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,KAAK,CAACtC,MAAM,IAAIH,OAAO,CAACG,MAAM,GAAGN,OAAO,CAAC7B,KAAK,GAAG,CAAC,EAAE2E,CAAC,EAAE,EAAE;QAC3E,IAAI7C,KAAK,CAACa,IAAI,CAAC8B,KAAK,CAACE,CAAC,CAAE,CAAC,EAAE;UACzB3C,OAAO,CAACT,IAAI,CAAC;YACXqD,IAAI,EAAEV,QAAQ;YACdW,IAAI,EAAEF,CAAC,GAAG,CAAC;YACXJ,OAAO,EAAEE,KAAK,CAACE,CAAC,CAAC,CAAEtE,IAAI,CAAC;UAC1B,CAAC,CAAC;QACJ;QACAyB,KAAK,CAACgD,SAAS,GAAG,CAAC;MACrB;IACF,CAAC,CAAC,MAAM,CAAE;EACZ;EAEA7C,IAAI,CAACpB,UAAU,CAAC;EAEhB,IAAImB,OAAO,CAACG,MAAM,KAAK,CAAC,EAAE;IACxB,OAAO,6BAA6B/C,IAAI,EAAE;EAC5C;EAEA,MAAM+D,iBAAiB,GAAG,CAAC;EAC3B,MAAMC,OAAO,GAAGpB,OAAO,CAACqB,KAAK,CAAC,CAAC,EAAE1C,IAAI,CAACC,GAAG,CAACiB,OAAO,CAAC7B,KAAK,EAAEmD,iBAAiB,CAAC,CAAC;EAC5E,MAAMsB,KAAe,GAAG,EAAE;EAE1B,KAAK,MAAMjB,CAAC,IAAIJ,OAAO,EAAE;IACvB,MAAM2B,OAAO,GAAG,IAAArB,kBAAQ,EAACxE,UAAU,EAAEsE,CAAC,CAACoB,IAAI,CAAC;IAC5C,MAAMI,WAAW,GAAGD,OAAO,IAAI,CAACA,OAAO,CAACrD,UAAU,CAAC,IAAI,CAAC,GAAGqD,OAAO,GAAGvB,CAAC,CAACoB,IAAI;IAC3EH,KAAK,CAAClD,IAAI,CAAC,GAAGyD,WAAW,IAAIxB,CAAC,CAACqB,IAAI,KAAKrB,CAAC,CAACe,OAAO,CAAClB,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,GAAGG,CAAC,CAACe,OAAO,CAACpC,MAAM,GAAG,EAAE,GAAG,KAAK,GAAG,EAAE,EAAE,CAAC;EACxG;EAEA,IAAIH,OAAO,CAACG,MAAM,GAAGgB,iBAAiB,EAAE;IACtCsB,KAAK,CAAClD,IAAI,CAAC,QAAQS,OAAO,CAACG,MAAM,GAAGgB,iBAAiB,mBAAmB,CAAC;EAC3E;EAEA,OAAOsB,KAAK,CAAC7C,IAAI,CAAC,IAAI,CAAC;AACzB;;AAEA;AACA;AACA;;AAEA,SAASuC,eAAeA,CAACD,QAAgB,EAAE1D,QAAgB,EAAW;EACpE,MAAMiF,GAAG,GAAG,IAAAC,iBAAO,EAACxB,QAAQ,CAAC,CAACyB,WAAW,CAAC,CAAC;EAC3C,MAAMC,UAAU,GAAG7H,aAAa,CAACyC,QAAQ,CAACmF,WAAW,CAAC,CAAC,CAAC;EACxD,OAAOC,UAAU,GAAGA,UAAU,CAACnE,QAAQ,CAACgE,GAAG,CAAC,GAAG,KAAK;AACtD;AAEA,SAASrB,WAAWA,CAACF,QAAgB,EAAEzE,OAAe,EAAW;EAC/D,MAAMqC,KAAK,GAAGC,WAAW,CAACtC,OAAO,CAAC;EAClC,OAAOqC,KAAK,CAACa,IAAI,CAACuB,QAAQ,CAAC;AAC7B;AAEA,SAASG,QAAQA,CAACH,QAAgB,EAAW;EAC3C,OAAOpG,iBAAiB,CAAC0E,GAAG,CAAC,IAAAkD,iBAAO,EAACxB,QAAQ,CAAC,CAACyB,WAAW,CAAC,CAAC,CAAC;AAC/D;AAEA,SAASH,UAAUA,CAACtB,QAAgB,EAAW;EAC7C,MAAMuB,GAAG,GAAG,IAAAC,iBAAO,EAACxB,QAAQ,CAAC,CAACyB,WAAW,CAAC,CAAC;EAC3C,MAAME,QAAQ,GAAG,CAAC,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,OAAO,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,CAAC;EACrG,OAAOA,QAAQ,CAACpE,QAAQ,CAACgE,GAAG,CAAC;AAC/B;;AAEA","ignoreList":[]}