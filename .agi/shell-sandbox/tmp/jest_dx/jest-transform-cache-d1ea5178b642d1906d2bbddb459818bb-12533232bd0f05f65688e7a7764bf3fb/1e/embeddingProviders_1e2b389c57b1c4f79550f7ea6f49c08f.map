{"version":3,"names":["cov_1s1gm0w1yf","actualCoverage","OpenAIEmbeddingProvider","name","s","dimension","apiKey","model","baseUrl","constructor","config","f","b","embed","text","response","fetch","method","headers","body","JSON","stringify","input","ok","error","Error","status","data","json","embedding","OllamaEmbeddingProvider","prompt","DeepSeekEmbeddingProvider","CachedEmbeddingProvider","provider","cache","Map","maxCacheSize","cached","get","size","firstKey","keys","next","value","delete","set","clearCache","clear","getCacheStats","maxSize","createEmbeddingProvider","options","type","tokens","toLowerCase","replace","split","filter","t","length","vector","Array","fill","token","hash","i","charCodeAt","Math","abs","mag","sqrt","reduce","v","map","useCache","autoDetectEmbeddingProvider","openaiKey","process","env","deepseekKey"],"sources":["embeddingProviders.ts"],"sourcesContent":["/**\n * Embedding Providers - Pluggable vector embedding backends\n *\n * Supports:\n * - Simple (built-in, no dependencies)\n * - OpenAI text-embedding-3-small/large\n * - Ollama local embeddings\n * - Custom providers via interface\n */\n\nimport type { EmbeddingProvider } from './episodicMemory.js';\n\n// ============================================================================\n// OPENAI EMBEDDING PROVIDER\n// ============================================================================\n\nexport interface OpenAIEmbeddingConfig {\n  apiKey: string;\n  model?: 'text-embedding-3-small' | 'text-embedding-3-large' | 'text-embedding-ada-002';\n  baseUrl?: string;\n}\n\nexport class OpenAIEmbeddingProvider implements EmbeddingProvider {\n  readonly name = 'openai';\n  readonly dimension: number;\n\n  private apiKey: string;\n  private model: string;\n  private baseUrl: string;\n\n  constructor(config: OpenAIEmbeddingConfig) {\n    this.apiKey = config.apiKey;\n    this.model = config.model || 'text-embedding-3-small';\n    this.baseUrl = config.baseUrl || 'https://api.openai.com/v1';\n\n    // Set dimension based on model\n    switch (this.model) {\n      case 'text-embedding-3-large':\n        this.dimension = 3072;\n        break;\n      case 'text-embedding-ada-002':\n        this.dimension = 1536;\n        break;\n      case 'text-embedding-3-small':\n      default:\n        this.dimension = 1536;\n        break;\n    }\n  }\n\n  async embed(text: string): Promise<number[]> {\n    const response = await fetch(`${this.baseUrl}/embeddings`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.apiKey}`,\n      },\n      body: JSON.stringify({\n        model: this.model,\n        input: text,\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`OpenAI embedding failed: ${response.status} ${error}`);\n    }\n\n    const data = await response.json() as {\n      data: Array<{ embedding: number[] }>;\n    };\n\n    return data.data[0]?.embedding || [];\n  }\n}\n\n// ============================================================================\n// OLLAMA EMBEDDING PROVIDER\n// ============================================================================\n\nexport interface OllamaEmbeddingConfig {\n  model?: string;\n  baseUrl?: string;\n}\n\nexport class OllamaEmbeddingProvider implements EmbeddingProvider {\n  readonly name = 'ollama';\n  readonly dimension = 4096; // Default for most Ollama models\n\n  private model: string;\n  private baseUrl: string;\n\n  constructor(config: OllamaEmbeddingConfig = {}) {\n    this.model = config.model || 'nomic-embed-text';\n    this.baseUrl = config.baseUrl || 'http://localhost:11434';\n  }\n\n  async embed(text: string): Promise<number[]> {\n    const response = await fetch(`${this.baseUrl}/api/embeddings`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        model: this.model,\n        prompt: text,\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Ollama embedding failed: ${response.status} ${error}`);\n    }\n\n    const data = await response.json() as {\n      embedding: number[];\n    };\n\n    return data.embedding || [];\n  }\n}\n\n// ============================================================================\n// DEEPSEEK EMBEDDING PROVIDER\n// ============================================================================\n\nexport interface DeepSeekEmbeddingConfig {\n  apiKey: string;\n  baseUrl?: string;\n}\n\nexport class DeepSeekEmbeddingProvider implements EmbeddingProvider {\n  readonly name = 'deepseek';\n  readonly dimension = 1024;\n\n  private apiKey: string;\n  private baseUrl: string;\n\n  constructor(config: DeepSeekEmbeddingConfig) {\n    this.apiKey = config.apiKey;\n    this.baseUrl = config.baseUrl || 'https://api.deepseek.com/v1';\n  }\n\n  async embed(text: string): Promise<number[]> {\n    // DeepSeek uses OpenAI-compatible API\n    const response = await fetch(`${this.baseUrl}/embeddings`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.apiKey}`,\n      },\n      body: JSON.stringify({\n        model: 'deepseek-embedding',\n        input: text,\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`DeepSeek embedding failed: ${response.status} ${error}`);\n    }\n\n    const data = await response.json() as {\n      data: Array<{ embedding: number[] }>;\n    };\n\n    return data.data[0]?.embedding || [];\n  }\n}\n\n// ============================================================================\n// CACHED EMBEDDING PROVIDER WRAPPER\n// ============================================================================\n\nexport class CachedEmbeddingProvider implements EmbeddingProvider {\n  readonly name: string;\n  readonly dimension: number;\n\n  private provider: EmbeddingProvider;\n  private cache: Map<string, number[]> = new Map();\n  private maxCacheSize: number;\n\n  constructor(provider: EmbeddingProvider, maxCacheSize = 10000) {\n    this.provider = provider;\n    this.name = `cached-${provider.name}`;\n    this.dimension = provider.dimension;\n    this.maxCacheSize = maxCacheSize;\n  }\n\n  async embed(text: string): Promise<number[]> {\n    // Check cache first\n    const cached = this.cache.get(text);\n    if (cached) {\n      return cached;\n    }\n\n    // Generate embedding\n    const embedding = await this.provider.embed(text);\n\n    // Cache result\n    if (this.cache.size >= this.maxCacheSize) {\n      // Remove oldest entry (first key)\n      const firstKey = this.cache.keys().next().value;\n      if (firstKey) this.cache.delete(firstKey);\n    }\n    this.cache.set(text, embedding);\n\n    return embedding;\n  }\n\n  clearCache(): void {\n    this.cache.clear();\n  }\n\n  getCacheStats(): { size: number; maxSize: number } {\n    return {\n      size: this.cache.size,\n      maxSize: this.maxCacheSize,\n    };\n  }\n}\n\n// ============================================================================\n// FACTORY\n// ============================================================================\n\nexport type EmbeddingProviderType = 'simple' | 'openai' | 'ollama' | 'deepseek';\n\nexport interface EmbeddingProviderOptions {\n  type: EmbeddingProviderType;\n  apiKey?: string;\n  model?: string;\n  baseUrl?: string;\n  useCache?: boolean;\n  maxCacheSize?: number;\n}\n\n/**\n * Create an embedding provider based on configuration\n */\nexport function createEmbeddingProvider(options: EmbeddingProviderOptions): EmbeddingProvider {\n  let provider: EmbeddingProvider;\n\n  switch (options.type) {\n    case 'openai':\n      if (!options.apiKey) {\n        throw new Error('OpenAI embedding provider requires apiKey');\n      }\n      provider = new OpenAIEmbeddingProvider({\n        apiKey: options.apiKey,\n        model: options.model as OpenAIEmbeddingConfig['model'],\n        baseUrl: options.baseUrl,\n      });\n      break;\n\n    case 'ollama':\n      provider = new OllamaEmbeddingProvider({\n        model: options.model,\n        baseUrl: options.baseUrl,\n      });\n      break;\n\n    case 'deepseek':\n      if (!options.apiKey) {\n        throw new Error('DeepSeek embedding provider requires apiKey');\n      }\n      provider = new DeepSeekEmbeddingProvider({\n        apiKey: options.apiKey,\n        baseUrl: options.baseUrl,\n      });\n      break;\n\n    case 'simple':\n    default:\n      // Simple provider is built into episodicMemory.ts\n      // Return a placeholder that will use the default\n      return {\n        name: 'simple',\n        dimension: 256,\n        embed: async (text: string) => {\n          // This is a simplified version - the real one is in episodicMemory.ts\n          const tokens = text.toLowerCase().replace(/[^a-z0-9\\s]/g, ' ').split(/\\s+/).filter(t => t.length > 2);\n          const vector = new Array(256).fill(0);\n          for (const token of tokens) {\n            let hash = 0;\n            for (let i = 0; i < token.length; i++) {\n              hash = ((hash << 5) - hash) + token.charCodeAt(i);\n              hash = hash & hash;\n            }\n            vector[Math.abs(hash) % 256] += 1;\n          }\n          const mag = Math.sqrt(vector.reduce((s, v) => s + v * v, 0));\n          return mag > 0 ? vector.map(v => v / mag) : vector;\n        },\n      };\n  }\n\n  // Wrap with cache if requested\n  if (options.useCache) {\n    return new CachedEmbeddingProvider(provider, options.maxCacheSize);\n  }\n\n  return provider;\n}\n\n/**\n * Auto-detect best available embedding provider\n */\nexport function autoDetectEmbeddingProvider(): EmbeddingProvider {\n  // Check for API keys in environment\n  const openaiKey = process.env['OPENAI_API_KEY'];\n  const deepseekKey = process.env['DEEPSEEK_API_KEY'];\n\n  if (openaiKey) {\n    return createEmbeddingProvider({\n      type: 'openai',\n      apiKey: openaiKey,\n      useCache: true,\n    });\n  }\n\n  if (deepseekKey) {\n    return createEmbeddingProvider({\n      type: 'deepseek',\n      apiKey: deepseekKey,\n      useCache: true,\n    });\n  }\n\n  // Try Ollama (local)\n  // Could add a ping check here, but for now just use simple\n  return createEmbeddingProvider({ type: 'simple' });\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}