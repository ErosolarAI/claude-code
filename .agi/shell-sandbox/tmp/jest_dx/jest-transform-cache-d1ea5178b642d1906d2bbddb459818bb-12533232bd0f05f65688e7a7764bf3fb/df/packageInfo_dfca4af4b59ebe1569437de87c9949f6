bc3b71c3ed1bc0703948df5210178d77
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.readPackageInfo = readPackageInfo;
exports.readPackageVersion = readPackageVersion;
var _nodeFs = require("node:fs");
var _nodePath = require("node:path");
var _nodeUrl = require("node:url");
/**
 * Locate and read the nearest package.json starting from the caller's module URL.
 * This mirrors prior per-file helpers but centralizes the logic so CLI entrypoints
 * and tests stay consistent even if their relative paths change.
 */
function readPackageInfo(importMetaUrl, options) {
  const maxDepth = options?.maxDepth ?? 6;
  const startDir = (0, _nodePath.dirname)((0, _nodeUrl.fileURLToPath)(importMetaUrl));
  const packagePath = findNearestPackageJson(startDir, maxDepth);
  if (!packagePath) {
    return {};
  }
  try {
    const payload = JSON.parse((0, _nodeFs.readFileSync)(packagePath, 'utf8'));
    return {
      name: typeof payload.name === 'string' ? payload.name : undefined,
      version: typeof payload.version === 'string' ? payload.version : undefined
    };
  } catch {
    return {};
  }
}
function readPackageVersion(importMetaUrl, fallback = '0.0.0') {
  return readPackageInfo(importMetaUrl).version ?? fallback;
}
function findNearestPackageJson(startDir, maxDepth) {
  let current = startDir;
  for (let depth = 0; depth <= maxDepth; depth += 1) {
    const candidate = (0, _nodePath.resolve)(current, 'package.json');
    if ((0, _nodeFs.existsSync)(candidate)) {
      return candidate;
    }
    const parent = (0, _nodePath.dirname)(current);
    if (parent === current) {
      break;
    }
    current = parent;
  }
  return null;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbm9kZUZzIiwicmVxdWlyZSIsIl9ub2RlUGF0aCIsIl9ub2RlVXJsIiwicmVhZFBhY2thZ2VJbmZvIiwiaW1wb3J0TWV0YVVybCIsIm9wdGlvbnMiLCJtYXhEZXB0aCIsInN0YXJ0RGlyIiwiZGlybmFtZSIsImZpbGVVUkxUb1BhdGgiLCJwYWNrYWdlUGF0aCIsImZpbmROZWFyZXN0UGFja2FnZUpzb24iLCJwYXlsb2FkIiwiSlNPTiIsInBhcnNlIiwicmVhZEZpbGVTeW5jIiwibmFtZSIsInVuZGVmaW5lZCIsInZlcnNpb24iLCJyZWFkUGFja2FnZVZlcnNpb24iLCJmYWxsYmFjayIsImN1cnJlbnQiLCJkZXB0aCIsImNhbmRpZGF0ZSIsInJlc29sdmUiLCJleGlzdHNTeW5jIiwicGFyZW50Il0sInNvdXJjZXMiOlsicGFja2FnZUluZm8udHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVhZEZpbGVTeW5jLCBleGlzdHNTeW5jIH0gZnJvbSAnbm9kZTpmcyc7XG5pbXBvcnQgeyBkaXJuYW1lLCByZXNvbHZlIH0gZnJvbSAnbm9kZTpwYXRoJztcbmltcG9ydCB7IGZpbGVVUkxUb1BhdGggfSBmcm9tICdub2RlOnVybCc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGFja2FnZUluZm8ge1xuICBuYW1lPzogc3RyaW5nO1xuICB2ZXJzaW9uPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIExvY2F0ZSBhbmQgcmVhZCB0aGUgbmVhcmVzdCBwYWNrYWdlLmpzb24gc3RhcnRpbmcgZnJvbSB0aGUgY2FsbGVyJ3MgbW9kdWxlIFVSTC5cbiAqIFRoaXMgbWlycm9ycyBwcmlvciBwZXItZmlsZSBoZWxwZXJzIGJ1dCBjZW50cmFsaXplcyB0aGUgbG9naWMgc28gQ0xJIGVudHJ5cG9pbnRzXG4gKiBhbmQgdGVzdHMgc3RheSBjb25zaXN0ZW50IGV2ZW4gaWYgdGhlaXIgcmVsYXRpdmUgcGF0aHMgY2hhbmdlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVhZFBhY2thZ2VJbmZvKFxuICBpbXBvcnRNZXRhVXJsOiBzdHJpbmcgfCBVUkwsXG4gIG9wdGlvbnM/OiB7IG1heERlcHRoPzogbnVtYmVyIH1cbik6IFBhY2thZ2VJbmZvIHtcbiAgY29uc3QgbWF4RGVwdGggPSBvcHRpb25zPy5tYXhEZXB0aCA/PyA2O1xuICBjb25zdCBzdGFydERpciA9IGRpcm5hbWUoZmlsZVVSTFRvUGF0aChpbXBvcnRNZXRhVXJsKSk7XG4gIGNvbnN0IHBhY2thZ2VQYXRoID0gZmluZE5lYXJlc3RQYWNrYWdlSnNvbihzdGFydERpciwgbWF4RGVwdGgpO1xuICBpZiAoIXBhY2thZ2VQYXRoKSB7XG4gICAgcmV0dXJuIHt9O1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBwYXlsb2FkID0gSlNPTi5wYXJzZShyZWFkRmlsZVN5bmMocGFja2FnZVBhdGgsICd1dGY4JykpIGFzIFBhY2thZ2VJbmZvO1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiB0eXBlb2YgcGF5bG9hZC5uYW1lID09PSAnc3RyaW5nJyA/IHBheWxvYWQubmFtZSA6IHVuZGVmaW5lZCxcbiAgICAgIHZlcnNpb246IHR5cGVvZiBwYXlsb2FkLnZlcnNpb24gPT09ICdzdHJpbmcnID8gcGF5bG9hZC52ZXJzaW9uIDogdW5kZWZpbmVkLFxuICAgIH07XG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiB7fTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVhZFBhY2thZ2VWZXJzaW9uKGltcG9ydE1ldGFVcmw6IHN0cmluZyB8IFVSTCwgZmFsbGJhY2sgPSAnMC4wLjAnKTogc3RyaW5nIHtcbiAgcmV0dXJuIHJlYWRQYWNrYWdlSW5mbyhpbXBvcnRNZXRhVXJsKS52ZXJzaW9uID8/IGZhbGxiYWNrO1xufVxuXG5mdW5jdGlvbiBmaW5kTmVhcmVzdFBhY2thZ2VKc29uKHN0YXJ0RGlyOiBzdHJpbmcsIG1heERlcHRoOiBudW1iZXIpOiBzdHJpbmcgfCBudWxsIHtcbiAgbGV0IGN1cnJlbnQgPSBzdGFydERpcjtcbiAgZm9yIChsZXQgZGVwdGggPSAwOyBkZXB0aCA8PSBtYXhEZXB0aDsgZGVwdGggKz0gMSkge1xuICAgIGNvbnN0IGNhbmRpZGF0ZSA9IHJlc29sdmUoY3VycmVudCwgJ3BhY2thZ2UuanNvbicpO1xuICAgIGlmIChleGlzdHNTeW5jKGNhbmRpZGF0ZSkpIHtcbiAgICAgIHJldHVybiBjYW5kaWRhdGU7XG4gICAgfVxuICAgIGNvbnN0IHBhcmVudCA9IGRpcm5hbWUoY3VycmVudCk7XG4gICAgaWYgKHBhcmVudCA9PT0gY3VycmVudCkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICAgIGN1cnJlbnQgPSBwYXJlbnQ7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQSxJQUFBQSxPQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxTQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxRQUFBLEdBQUFGLE9BQUE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ08sU0FBU0csZUFBZUEsQ0FDN0JDLGFBQTJCLEVBQzNCQyxPQUErQixFQUNsQjtFQUNiLE1BQU1DLFFBQVEsR0FBR0QsT0FBTyxFQUFFQyxRQUFRLElBQUksQ0FBQztFQUN2QyxNQUFNQyxRQUFRLEdBQUcsSUFBQUMsaUJBQU8sRUFBQyxJQUFBQyxzQkFBYSxFQUFDTCxhQUFhLENBQUMsQ0FBQztFQUN0RCxNQUFNTSxXQUFXLEdBQUdDLHNCQUFzQixDQUFDSixRQUFRLEVBQUVELFFBQVEsQ0FBQztFQUM5RCxJQUFJLENBQUNJLFdBQVcsRUFBRTtJQUNoQixPQUFPLENBQUMsQ0FBQztFQUNYO0VBRUEsSUFBSTtJQUNGLE1BQU1FLE9BQU8sR0FBR0MsSUFBSSxDQUFDQyxLQUFLLENBQUMsSUFBQUMsb0JBQVksRUFBQ0wsV0FBVyxFQUFFLE1BQU0sQ0FBQyxDQUFnQjtJQUM1RSxPQUFPO01BQ0xNLElBQUksRUFBRSxPQUFPSixPQUFPLENBQUNJLElBQUksS0FBSyxRQUFRLEdBQUdKLE9BQU8sQ0FBQ0ksSUFBSSxHQUFHQyxTQUFTO01BQ2pFQyxPQUFPLEVBQUUsT0FBT04sT0FBTyxDQUFDTSxPQUFPLEtBQUssUUFBUSxHQUFHTixPQUFPLENBQUNNLE9BQU8sR0FBR0Q7SUFDbkUsQ0FBQztFQUNILENBQUMsQ0FBQyxNQUFNO0lBQ04sT0FBTyxDQUFDLENBQUM7RUFDWDtBQUNGO0FBRU8sU0FBU0Usa0JBQWtCQSxDQUFDZixhQUEyQixFQUFFZ0IsUUFBUSxHQUFHLE9BQU8sRUFBVTtFQUMxRixPQUFPakIsZUFBZSxDQUFDQyxhQUFhLENBQUMsQ0FBQ2MsT0FBTyxJQUFJRSxRQUFRO0FBQzNEO0FBRUEsU0FBU1Qsc0JBQXNCQSxDQUFDSixRQUFnQixFQUFFRCxRQUFnQixFQUFpQjtFQUNqRixJQUFJZSxPQUFPLEdBQUdkLFFBQVE7RUFDdEIsS0FBSyxJQUFJZSxLQUFLLEdBQUcsQ0FBQyxFQUFFQSxLQUFLLElBQUloQixRQUFRLEVBQUVnQixLQUFLLElBQUksQ0FBQyxFQUFFO0lBQ2pELE1BQU1DLFNBQVMsR0FBRyxJQUFBQyxpQkFBTyxFQUFDSCxPQUFPLEVBQUUsY0FBYyxDQUFDO0lBQ2xELElBQUksSUFBQUksa0JBQVUsRUFBQ0YsU0FBUyxDQUFDLEVBQUU7TUFDekIsT0FBT0EsU0FBUztJQUNsQjtJQUNBLE1BQU1HLE1BQU0sR0FBRyxJQUFBbEIsaUJBQU8sRUFBQ2EsT0FBTyxDQUFDO0lBQy9CLElBQUlLLE1BQU0sS0FBS0wsT0FBTyxFQUFFO01BQ3RCO0lBQ0Y7SUFDQUEsT0FBTyxHQUFHSyxNQUFNO0VBQ2xCO0VBQ0EsT0FBTyxJQUFJO0FBQ2IiLCJpZ25vcmVMaXN0IjpbXX0=