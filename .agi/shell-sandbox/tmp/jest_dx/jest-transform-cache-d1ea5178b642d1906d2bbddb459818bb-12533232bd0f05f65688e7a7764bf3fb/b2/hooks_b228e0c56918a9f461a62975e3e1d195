9394197abd7df8d00fee78b403adeb1e
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.HooksManager = void 0;
exports.createHooksManager = createHooksManager;
exports.loadHooks = loadHooks;
var _nodeChild_process = require("node:child_process");
var _nodeUtil = require("node:util");
var _nodeFs = require("node:fs");
var _nodePath = require("node:path");
var _nodeOs = require("node:os");
var _agiCore = require("./agiCore.js");
/**
 * Hooks System
 *
 * Event-triggered scripts that automate workflows, based on AGI CLI's hooks architecture.
 * Hooks can execute shell commands or query an LLM for decisions.
 */

const execAsync = (0, _nodeUtil.promisify)(_nodeChild_process.exec);

/**
 * Hook event types
 */

// System alerts

/**
 * Hook types
 */

/**
 * Hook definition
 */

/**
 * Hook execution result
 */

/**
 * Hook execution context
 */

/**
 * Hooks configuration
 */

/**
 * Settings file structure
 */

/**
 * Load hooks from settings files
 */
function loadHooks(workingDir) {
  const hooks = {};

  // Load from user settings (~/.claude/settings.json or ~/.agi/settings.json)
  const userSettingsPaths = [(0, _nodePath.join)((0, _nodeOs.homedir)(), '.claude', 'settings.json'), (0, _nodePath.join)((0, _nodeOs.homedir)(), '.agi', 'settings.json'), (0, _nodePath.join)((0, _nodeOs.homedir)(), '.erosolar', 'settings.json')];

  // Load from project settings (.claude/settings.json or .agi/settings.json)
  const projectSettingsPaths = [(0, _nodePath.join)(workingDir, '.claude', 'settings.json'), (0, _nodePath.join)(workingDir, '.agi', 'settings.json'), (0, _nodePath.join)(workingDir, '.erosolar', 'settings.json')];

  // Load user settings first, then override with project settings
  for (const settingsPath of [...userSettingsPaths, ...projectSettingsPaths]) {
    if ((0, _nodeFs.existsSync)(settingsPath)) {
      try {
        const content = (0, _nodeFs.readFileSync)(settingsPath, 'utf-8');
        const settings = JSON.parse(content);
        if (settings.hooks) {
          for (const [event, eventHooks] of Object.entries(settings.hooks)) {
            if (!hooks[event]) {
              hooks[event] = [];
            }
            hooks[event].push(...eventHooks);
          }
        }
      } catch {
        // Ignore invalid settings files
      }
    }
  }
  return hooks;
}

/**
 * Check if a hook matches the given context
 */
function matchesHook(hook, context) {
  if (!hook.matcher) {
    return true;
  }
  try {
    const regex = new RegExp(hook.matcher);

    // Match against tool name if available
    if (context.toolName) {
      return regex.test(context.toolName);
    }

    // Match against event name
    return regex.test(context.event);
  } catch {
    return false;
  }
}

/**
 * Execute a command hook
 */
async function executeCommandHook(hook, context) {
  if (!hook.command) {
    return {
      success: false,
      error: 'No command specified'
    };
  }
  const timeout = hook.timeout ?? 24 * 60 * 60 * 1000;

  // Prepare environment variables for the hook
  const env = {
    ...process.env,
    HOOK_EVENT: context.event,
    HOOK_TOOL_NAME: context.toolName ?? '',
    HOOK_TOOL_ARGS: context.toolArgs ? JSON.stringify(context.toolArgs) : '',
    HOOK_TOOL_RESULT: context.toolResult ?? '',
    HOOK_USER_INPUT: context.userInput ?? '',
    HOOK_SESSION_ID: context.sessionId ?? '',
    HOOK_WORKING_DIR: context.workingDir
  };
  try {
    const {
      stdout
    } = await execAsync(hook.command, {
      cwd: context.workingDir,
      timeout,
      env
    });

    // Try to parse JSON output for structured results
    const output = stdout.trim();
    try {
      const parsed = JSON.parse(output);
      return {
        success: true,
        output,
        decision: parsed.decision,
        reason: parsed.reason,
        blocked: parsed.blocked
      };
    } catch {
      // Return raw output if not JSON
      return {
        success: true,
        output
      };
    }
  } catch (error) {
    const message = error instanceof Error ? error.message : String(error);

    // Exit code 2 means blocking
    if (message.includes('exit code 2')) {
      return {
        success: false,
        blocked: true,
        error: message
      };
    }
    return {
      success: false,
      error: message
    };
  }
}
function serializeArgs(args) {
  if (!args) return '';
  try {
    return JSON.stringify(args, (_key, value) => {
      if (typeof value === 'bigint') {
        return value.toString();
      }
      return value;
    });
  } catch {
    return String(args);
  }
}
function buildPromptForHook(hook, context) {
  const parts = [];
  if (hook.prompt) {
    parts.push(hook.prompt.trim());
  }
  parts.push(`Event: ${context.event}`);
  if (context.userInput) {
    parts.push(`User input: ${context.userInput}`);
  }
  if (context.toolName) {
    parts.push(`Tool: ${context.toolName}`);
  }
  if (context.toolArgs) {
    parts.push(`Args: ${serializeArgs(context.toolArgs)}`);
  }
  if (context.toolResult) {
    parts.push(`Result: ${context.toolResult}`);
  }
  return parts.filter(Boolean).join('\n');
}
function assessPromptRisk(promptText, context, _analysis) {
  const lower = promptText.toLowerCase();
  const reasons = [];
  const destructivePatterns = [/rm\s+-rf\s+\/?/, /sudo\s+rm\s+-rf/, /:\(\)\s*{.*:.*\|.*:.*;.*};\s*:/,
  // fork bomb
  /mkfs/i, /format\s+c:/i, /shutdown\s+-h/i, /kill\s+-9\s+1/, /dd\s+if=\/dev\//i];
  if (typeof context.toolArgs?.['command'] === 'string') {
    const cmd = String(context.toolArgs['command']).toLowerCase();
    if (/rm\s+-rf/.test(cmd) || /(^|\s)del\s+\/f/i.test(cmd)) {
      reasons.push('Destructive shell command');
    }
    if (/shutdown|reboot/.test(cmd)) {
      reasons.push('System shutdown command');
    }
  }
  if (destructivePatterns.some(re => re.test(lower))) {
    reasons.push('Destructive content detected');
  }
  const score = reasons.length > 0 ? 0.9 : 0.05;
  return {
    score,
    reasons
  };
}
function formatPromptHookOutput(analysis, risk) {
  const lines = [];
  lines.push(`Interpretation: ${analysis.interpretation}`);
  lines.push(`Intent: ${analysis.intent} (${analysis.category}, ${(analysis.confidence * 100).toFixed(0)}% conf)`);
  lines.push(analysis.tasks.length ? `Tasks: ${analysis.tasks.map(t => `[${t.id}] ${t.description}`).join(' | ')}` : 'Tasks: none');
  lines.push(`Risk: ${(risk.score * 100).toFixed(0)}%${risk.reasons.length ? ` (${risk.reasons.join('; ')})` : ''}`);
  if (analysis.clarificationNeeded.length) {
    lines.push(`Clarifications: ${analysis.clarificationNeeded.join('; ')}`);
  }
  return lines.join('\n');
}

/**
 * Execute a prompt hook (would query LLM in full implementation)
 */
async function executePromptHook(hook, context) {
  if (!hook.prompt) {
    return {
      success: false,
      error: 'No prompt specified'
    };
  }
  const start = Date.now();
  const promptText = buildPromptForHook(hook, context);
  const agi = (0, _agiCore.getAGI)(context.workingDir);
  const analysis = agi.analyzePrompt(promptText);
  const risk = assessPromptRisk(promptText, context, analysis);
  const highRiskEvent = context.event === 'PreToolUse' || context.event === 'PermissionRequest' || context.event === 'UserPromptSubmit';
  const blocked = highRiskEvent && risk.score >= 0.75;
  const decision = blocked ? 'deny' : 'continue';
  agi.recordOperation({
    id: `hook-${context.event}-${Date.now()}`,
    prompt: promptText,
    interpretation: analysis.interpretation,
    tasks: analysis.tasks.map(t => t.description),
    success: !blocked,
    timestamp: Date.now(),
    duration: Date.now() - start,
    toolsUsed: ['AGIHook'],
    errors: blocked ? risk.reasons : undefined
  });
  return {
    success: true,
    decision,
    blocked,
    reason: blocked ? `High-risk content detected: ${risk.reasons.join('; ') || 'unspecified'}` : `AGI analysis: ${analysis.interpretation} (risk ${(risk.score * 100).toFixed(0)}%)`,
    output: formatPromptHookOutput(analysis, risk)
  };
}

/**
 * Execute a single hook
 */
async function executeHook(hook, context) {
  switch (hook.type) {
    case 'command':
      return executeCommandHook(hook, context);
    case 'prompt':
      return executePromptHook(hook, context);
    default:
      return {
        success: false,
        error: `Unknown hook type: ${hook.type}`
      };
  }
}

/**
 * HooksManager class for managing and executing hooks
 */
class HooksManager {
  hooks;
  workingDir;
  constructor(workingDir) {
    this.workingDir = workingDir;
    this.hooks = loadHooks(workingDir);
  }

  /**
   * Reload hooks from settings files
   */
  reload() {
    this.hooks = loadHooks(this.workingDir);
  }

  /**
   * Check if hooks are configured for an event
   */
  hasHooks(event) {
    return Boolean(this.hooks[event]?.length);
  }

  /**
   * Get all hooks for an event
   */
  getHooks(event) {
    return this.hooks[event] ?? [];
  }

  /**
   * Execute all matching hooks for an event
   */
  async executeHooks(context) {
    const eventHooks = this.hooks[context.event] ?? [];
    const results = [];
    for (const hook of eventHooks) {
      if (matchesHook(hook, context)) {
        const result = await executeHook(hook, context);
        results.push(result);

        // Stop on blocking result
        if (result.blocked) {
          break;
        }
      }
    }
    return results;
  }

  /**
   * Execute pre-tool hooks and check if tool should proceed
   */
  async executePreToolHooks(toolName, args) {
    const context = {
      event: 'PreToolUse',
      toolName,
      toolArgs: args,
      workingDir: this.workingDir
    };
    const results = await this.executeHooks(context);

    // Check if any hook blocked the operation
    const blocked = results.some(r => r.blocked || r.decision === 'deny');
    return {
      allowed: !blocked,
      results
    };
  }

  /**
   * Execute post-tool hooks
   */
  async executePostToolHooks(toolName, args, result) {
    const context = {
      event: 'PostToolUse',
      toolName,
      toolArgs: args,
      toolResult: result,
      workingDir: this.workingDir
    };
    return this.executeHooks(context);
  }

  /**
   * Execute user prompt hooks
   */
  async executeUserPromptHooks(userInput) {
    const context = {
      event: 'UserPromptSubmit',
      userInput,
      workingDir: this.workingDir
    };
    const results = await this.executeHooks(context);
    const blocked = results.some(r => r.blocked || r.decision === 'deny');
    return {
      allowed: !blocked,
      results
    };
  }

  /**
   * Execute session lifecycle hooks
   */
  async executeSessionHook(event, sessionId) {
    const context = {
      event,
      sessionId,
      workingDir: this.workingDir
    };
    return this.executeHooks(context);
  }
}

/**
 * Create a hooks manager for the given working directory
 */
exports.HooksManager = HooksManager;
function createHooksManager(workingDir) {
  return new HooksManager(workingDir);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbm9kZUNoaWxkX3Byb2Nlc3MiLCJyZXF1aXJlIiwiX25vZGVVdGlsIiwiX25vZGVGcyIsIl9ub2RlUGF0aCIsIl9ub2RlT3MiLCJfYWdpQ29yZSIsImV4ZWNBc3luYyIsInByb21pc2lmeSIsImV4ZWMiLCJsb2FkSG9va3MiLCJ3b3JraW5nRGlyIiwiaG9va3MiLCJ1c2VyU2V0dGluZ3NQYXRocyIsImpvaW4iLCJob21lZGlyIiwicHJvamVjdFNldHRpbmdzUGF0aHMiLCJzZXR0aW5nc1BhdGgiLCJleGlzdHNTeW5jIiwiY29udGVudCIsInJlYWRGaWxlU3luYyIsInNldHRpbmdzIiwiSlNPTiIsInBhcnNlIiwiZXZlbnQiLCJldmVudEhvb2tzIiwiT2JqZWN0IiwiZW50cmllcyIsInB1c2giLCJtYXRjaGVzSG9vayIsImhvb2siLCJjb250ZXh0IiwibWF0Y2hlciIsInJlZ2V4IiwiUmVnRXhwIiwidG9vbE5hbWUiLCJ0ZXN0IiwiZXhlY3V0ZUNvbW1hbmRIb29rIiwiY29tbWFuZCIsInN1Y2Nlc3MiLCJlcnJvciIsInRpbWVvdXQiLCJlbnYiLCJwcm9jZXNzIiwiSE9PS19FVkVOVCIsIkhPT0tfVE9PTF9OQU1FIiwiSE9PS19UT09MX0FSR1MiLCJ0b29sQXJncyIsInN0cmluZ2lmeSIsIkhPT0tfVE9PTF9SRVNVTFQiLCJ0b29sUmVzdWx0IiwiSE9PS19VU0VSX0lOUFVUIiwidXNlcklucHV0IiwiSE9PS19TRVNTSU9OX0lEIiwic2Vzc2lvbklkIiwiSE9PS19XT1JLSU5HX0RJUiIsInN0ZG91dCIsImN3ZCIsIm91dHB1dCIsInRyaW0iLCJwYXJzZWQiLCJkZWNpc2lvbiIsInJlYXNvbiIsImJsb2NrZWQiLCJtZXNzYWdlIiwiRXJyb3IiLCJTdHJpbmciLCJpbmNsdWRlcyIsInNlcmlhbGl6ZUFyZ3MiLCJhcmdzIiwiX2tleSIsInZhbHVlIiwidG9TdHJpbmciLCJidWlsZFByb21wdEZvckhvb2siLCJwYXJ0cyIsInByb21wdCIsImZpbHRlciIsIkJvb2xlYW4iLCJhc3Nlc3NQcm9tcHRSaXNrIiwicHJvbXB0VGV4dCIsIl9hbmFseXNpcyIsImxvd2VyIiwidG9Mb3dlckNhc2UiLCJyZWFzb25zIiwiZGVzdHJ1Y3RpdmVQYXR0ZXJucyIsImNtZCIsInNvbWUiLCJyZSIsInNjb3JlIiwibGVuZ3RoIiwiZm9ybWF0UHJvbXB0SG9va091dHB1dCIsImFuYWx5c2lzIiwicmlzayIsImxpbmVzIiwiaW50ZXJwcmV0YXRpb24iLCJpbnRlbnQiLCJjYXRlZ29yeSIsImNvbmZpZGVuY2UiLCJ0b0ZpeGVkIiwidGFza3MiLCJtYXAiLCJ0IiwiaWQiLCJkZXNjcmlwdGlvbiIsImNsYXJpZmljYXRpb25OZWVkZWQiLCJleGVjdXRlUHJvbXB0SG9vayIsInN0YXJ0IiwiRGF0ZSIsIm5vdyIsImFnaSIsImdldEFHSSIsImFuYWx5emVQcm9tcHQiLCJoaWdoUmlza0V2ZW50IiwicmVjb3JkT3BlcmF0aW9uIiwidGltZXN0YW1wIiwiZHVyYXRpb24iLCJ0b29sc1VzZWQiLCJlcnJvcnMiLCJ1bmRlZmluZWQiLCJleGVjdXRlSG9vayIsInR5cGUiLCJIb29rc01hbmFnZXIiLCJjb25zdHJ1Y3RvciIsInJlbG9hZCIsImhhc0hvb2tzIiwiZ2V0SG9va3MiLCJleGVjdXRlSG9va3MiLCJyZXN1bHRzIiwicmVzdWx0IiwiZXhlY3V0ZVByZVRvb2xIb29rcyIsInIiLCJhbGxvd2VkIiwiZXhlY3V0ZVBvc3RUb29sSG9va3MiLCJleGVjdXRlVXNlclByb21wdEhvb2tzIiwiZXhlY3V0ZVNlc3Npb25Ib29rIiwiZXhwb3J0cyIsImNyZWF0ZUhvb2tzTWFuYWdlciJdLCJzb3VyY2VzIjpbImhvb2tzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSG9va3MgU3lzdGVtXG4gKlxuICogRXZlbnQtdHJpZ2dlcmVkIHNjcmlwdHMgdGhhdCBhdXRvbWF0ZSB3b3JrZmxvd3MsIGJhc2VkIG9uIEFHSSBDTEkncyBob29rcyBhcmNoaXRlY3R1cmUuXG4gKiBIb29rcyBjYW4gZXhlY3V0ZSBzaGVsbCBjb21tYW5kcyBvciBxdWVyeSBhbiBMTE0gZm9yIGRlY2lzaW9ucy5cbiAqL1xuXG5pbXBvcnQgeyBleGVjIH0gZnJvbSAnbm9kZTpjaGlsZF9wcm9jZXNzJztcbmltcG9ydCB7IHByb21pc2lmeSB9IGZyb20gJ25vZGU6dXRpbCc7XG5pbXBvcnQgeyBleGlzdHNTeW5jLCByZWFkRmlsZVN5bmMgfSBmcm9tICdub2RlOmZzJztcbmltcG9ydCB7IGpvaW4gfSBmcm9tICdub2RlOnBhdGgnO1xuaW1wb3J0IHsgaG9tZWRpciB9IGZyb20gJ25vZGU6b3MnO1xuaW1wb3J0IHsgZ2V0QUdJLCB0eXBlIFByb21wdEFuYWx5c2lzIH0gZnJvbSAnLi9hZ2lDb3JlLmpzJztcblxuY29uc3QgZXhlY0FzeW5jID0gcHJvbWlzaWZ5KGV4ZWMpO1xuXG4vKipcbiAqIEhvb2sgZXZlbnQgdHlwZXNcbiAqL1xuZXhwb3J0IHR5cGUgSG9va0V2ZW50ID1cbiAgfCAnUHJlVG9vbFVzZScgICAgICAgLy8gQmVmb3JlIHRvb2wgZXhlY3V0aW9uXG4gIHwgJ1Bvc3RUb29sVXNlJyAgICAgIC8vIEFmdGVyIHRvb2wgY29tcGxldGVzXG4gIHwgJ1Blcm1pc3Npb25SZXF1ZXN0JyAvLyBVc2VyIGFwcHJvdmFsIG5lZWRlZFxuICB8ICdVc2VyUHJvbXB0U3VibWl0JyAvLyBVc2VyIGVudGVycyBpbnB1dFxuICB8ICdTZXNzaW9uU3RhcnQnICAgICAvLyBTZXNzaW9uIGJlZ2luc1xuICB8ICdTZXNzaW9uRW5kJyAgICAgICAvLyBTZXNzaW9uIGVuZHNcbiAgfCAnU3RvcCcgICAgICAgICAgICAgLy8gTWFpbiBhZ2VudCBzdG9wc1xuICB8ICdTdWJhZ2VudFN0b3AnICAgICAvLyBTdWJhZ2VudCBmaW5pc2hlc1xuICB8ICdOb3RpZmljYXRpb24nOyAgICAvLyBTeXN0ZW0gYWxlcnRzXG5cbi8qKlxuICogSG9vayB0eXBlc1xuICovXG5leHBvcnQgdHlwZSBIb29rVHlwZSA9ICdjb21tYW5kJyB8ICdwcm9tcHQnO1xuXG4vKipcbiAqIEhvb2sgZGVmaW5pdGlvblxuICovXG5leHBvcnQgaW50ZXJmYWNlIEhvb2tEZWZpbml0aW9uIHtcbiAgLyoqIFJlZ2V4IHBhdHRlcm4gdG8gbWF0Y2ggdG9vbCBuYW1lcyBvciBldmVudHMgKi9cbiAgbWF0Y2hlcj86IHN0cmluZztcbiAgLyoqIFR5cGUgb2YgaG9vazogJ2NvbW1hbmQnIGZvciBzaGVsbCwgJ3Byb21wdCcgZm9yIExMTSAqL1xuICB0eXBlOiBIb29rVHlwZTtcbiAgLyoqIFNoZWxsIGNvbW1hbmQgdG8gZXhlY3V0ZSAoZm9yIGNvbW1hbmQgaG9va3MpICovXG4gIGNvbW1hbmQ/OiBzdHJpbmc7XG4gIC8qKiBQcm9tcHQgdG8gc2VuZCB0byBMTE0gKGZvciBwcm9tcHQgaG9va3MpICovXG4gIHByb21wdD86IHN0cmluZztcbiAgLyoqIFRpbWVvdXQgaW4gbWlsbGlzZWNvbmRzICovXG4gIHRpbWVvdXQ/OiBudW1iZXI7XG59XG5cbi8qKlxuICogSG9vayBleGVjdXRpb24gcmVzdWx0XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSG9va1Jlc3VsdCB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIG91dHB1dD86IHN0cmluZztcbiAgZGVjaXNpb24/OiAnYWxsb3cnIHwgJ2RlbnknIHwgJ2NvbnRpbnVlJztcbiAgcmVhc29uPzogc3RyaW5nO1xuICBlcnJvcj86IHN0cmluZztcbiAgYmxvY2tlZD86IGJvb2xlYW47XG59XG5cbi8qKlxuICogSG9vayBleGVjdXRpb24gY29udGV4dFxuICovXG5leHBvcnQgaW50ZXJmYWNlIEhvb2tDb250ZXh0IHtcbiAgZXZlbnQ6IEhvb2tFdmVudDtcbiAgdG9vbE5hbWU/OiBzdHJpbmc7XG4gIHRvb2xBcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gIHRvb2xSZXN1bHQ/OiBzdHJpbmc7XG4gIHVzZXJJbnB1dD86IHN0cmluZztcbiAgc2Vzc2lvbklkPzogc3RyaW5nO1xuICB3b3JraW5nRGlyOiBzdHJpbmc7XG59XG5cbi8qKlxuICogSG9va3MgY29uZmlndXJhdGlvblxuICovXG5leHBvcnQgaW50ZXJmYWNlIEhvb2tzQ29uZmlnIHtcbiAgW2V2ZW50OiBzdHJpbmddOiBIb29rRGVmaW5pdGlvbltdO1xufVxuXG4vKipcbiAqIFNldHRpbmdzIGZpbGUgc3RydWN0dXJlXG4gKi9cbmludGVyZmFjZSBTZXR0aW5nc0ZpbGUge1xuICBob29rcz86IEhvb2tzQ29uZmlnO1xufVxuXG4vKipcbiAqIExvYWQgaG9va3MgZnJvbSBzZXR0aW5ncyBmaWxlc1xuICovXG5leHBvcnQgZnVuY3Rpb24gbG9hZEhvb2tzKHdvcmtpbmdEaXI6IHN0cmluZyk6IEhvb2tzQ29uZmlnIHtcbiAgY29uc3QgaG9va3M6IEhvb2tzQ29uZmlnID0ge307XG5cbiAgLy8gTG9hZCBmcm9tIHVzZXIgc2V0dGluZ3MgKH4vLmNsYXVkZS9zZXR0aW5ncy5qc29uIG9yIH4vLmFnaS9zZXR0aW5ncy5qc29uKVxuICBjb25zdCB1c2VyU2V0dGluZ3NQYXRocyA9IFtcbiAgICBqb2luKGhvbWVkaXIoKSwgJy5jbGF1ZGUnLCAnc2V0dGluZ3MuanNvbicpLFxuICAgIGpvaW4oaG9tZWRpcigpLCAnLmFnaScsICdzZXR0aW5ncy5qc29uJyksXG4gICAgam9pbihob21lZGlyKCksICcuZXJvc29sYXInLCAnc2V0dGluZ3MuanNvbicpLFxuICBdO1xuXG4gIC8vIExvYWQgZnJvbSBwcm9qZWN0IHNldHRpbmdzICguY2xhdWRlL3NldHRpbmdzLmpzb24gb3IgLmFnaS9zZXR0aW5ncy5qc29uKVxuICBjb25zdCBwcm9qZWN0U2V0dGluZ3NQYXRocyA9IFtcbiAgICBqb2luKHdvcmtpbmdEaXIsICcuY2xhdWRlJywgJ3NldHRpbmdzLmpzb24nKSxcbiAgICBqb2luKHdvcmtpbmdEaXIsICcuYWdpJywgJ3NldHRpbmdzLmpzb24nKSxcbiAgICBqb2luKHdvcmtpbmdEaXIsICcuZXJvc29sYXInLCAnc2V0dGluZ3MuanNvbicpLFxuICBdO1xuXG4gIC8vIExvYWQgdXNlciBzZXR0aW5ncyBmaXJzdCwgdGhlbiBvdmVycmlkZSB3aXRoIHByb2plY3Qgc2V0dGluZ3NcbiAgZm9yIChjb25zdCBzZXR0aW5nc1BhdGggb2YgWy4uLnVzZXJTZXR0aW5nc1BhdGhzLCAuLi5wcm9qZWN0U2V0dGluZ3NQYXRoc10pIHtcbiAgICBpZiAoZXhpc3RzU3luYyhzZXR0aW5nc1BhdGgpKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZW50ID0gcmVhZEZpbGVTeW5jKHNldHRpbmdzUGF0aCwgJ3V0Zi04Jyk7XG4gICAgICAgIGNvbnN0IHNldHRpbmdzOiBTZXR0aW5nc0ZpbGUgPSBKU09OLnBhcnNlKGNvbnRlbnQpO1xuXG4gICAgICAgIGlmIChzZXR0aW5ncy5ob29rcykge1xuICAgICAgICAgIGZvciAoY29uc3QgW2V2ZW50LCBldmVudEhvb2tzXSBvZiBPYmplY3QuZW50cmllcyhzZXR0aW5ncy5ob29rcykpIHtcbiAgICAgICAgICAgIGlmICghaG9va3NbZXZlbnRdKSB7XG4gICAgICAgICAgICAgIGhvb2tzW2V2ZW50XSA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaG9va3NbZXZlbnRdLnB1c2goLi4uZXZlbnRIb29rcyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gSWdub3JlIGludmFsaWQgc2V0dGluZ3MgZmlsZXNcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gaG9va3M7XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgYSBob29rIG1hdGNoZXMgdGhlIGdpdmVuIGNvbnRleHRcbiAqL1xuZnVuY3Rpb24gbWF0Y2hlc0hvb2soaG9vazogSG9va0RlZmluaXRpb24sIGNvbnRleHQ6IEhvb2tDb250ZXh0KTogYm9vbGVhbiB7XG4gIGlmICghaG9vay5tYXRjaGVyKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICB0cnkge1xuICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChob29rLm1hdGNoZXIpO1xuXG4gICAgLy8gTWF0Y2ggYWdhaW5zdCB0b29sIG5hbWUgaWYgYXZhaWxhYmxlXG4gICAgaWYgKGNvbnRleHQudG9vbE5hbWUpIHtcbiAgICAgIHJldHVybiByZWdleC50ZXN0KGNvbnRleHQudG9vbE5hbWUpO1xuICAgIH1cblxuICAgIC8vIE1hdGNoIGFnYWluc3QgZXZlbnQgbmFtZVxuICAgIHJldHVybiByZWdleC50ZXN0KGNvbnRleHQuZXZlbnQpO1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuLyoqXG4gKiBFeGVjdXRlIGEgY29tbWFuZCBob29rXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVDb21tYW5kSG9vayhcbiAgaG9vazogSG9va0RlZmluaXRpb24sXG4gIGNvbnRleHQ6IEhvb2tDb250ZXh0XG4pOiBQcm9taXNlPEhvb2tSZXN1bHQ+IHtcbiAgaWYgKCFob29rLmNvbW1hbmQpIHtcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdObyBjb21tYW5kIHNwZWNpZmllZCcgfTtcbiAgfVxuXG4gICAgICBjb25zdCB0aW1lb3V0ID0gaG9vay50aW1lb3V0ID8/IDI0ICogNjAgKiA2MCAqIDEwMDA7XG5cbiAgLy8gUHJlcGFyZSBlbnZpcm9ubWVudCB2YXJpYWJsZXMgZm9yIHRoZSBob29rXG4gIGNvbnN0IGVudiA9IHtcbiAgICAuLi5wcm9jZXNzLmVudixcbiAgICBIT09LX0VWRU5UOiBjb250ZXh0LmV2ZW50LFxuICAgIEhPT0tfVE9PTF9OQU1FOiBjb250ZXh0LnRvb2xOYW1lID8/ICcnLFxuICAgIEhPT0tfVE9PTF9BUkdTOiBjb250ZXh0LnRvb2xBcmdzID8gSlNPTi5zdHJpbmdpZnkoY29udGV4dC50b29sQXJncykgOiAnJyxcbiAgICBIT09LX1RPT0xfUkVTVUxUOiBjb250ZXh0LnRvb2xSZXN1bHQgPz8gJycsXG4gICAgSE9PS19VU0VSX0lOUFVUOiBjb250ZXh0LnVzZXJJbnB1dCA/PyAnJyxcbiAgICBIT09LX1NFU1NJT05fSUQ6IGNvbnRleHQuc2Vzc2lvbklkID8/ICcnLFxuICAgIEhPT0tfV09SS0lOR19ESVI6IGNvbnRleHQud29ya2luZ0RpcixcbiAgfTtcblxuICB0cnkge1xuICAgIGNvbnN0IHsgc3Rkb3V0IH0gPSBhd2FpdCBleGVjQXN5bmMoaG9vay5jb21tYW5kLCB7XG4gICAgICBjd2Q6IGNvbnRleHQud29ya2luZ0RpcixcbiAgICAgIHRpbWVvdXQsXG4gICAgICBlbnYsXG4gICAgfSk7XG5cbiAgICAvLyBUcnkgdG8gcGFyc2UgSlNPTiBvdXRwdXQgZm9yIHN0cnVjdHVyZWQgcmVzdWx0c1xuICAgIGNvbnN0IG91dHB1dCA9IHN0ZG91dC50cmltKCk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2Uob3V0cHV0KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG91dHB1dCxcbiAgICAgICAgZGVjaXNpb246IHBhcnNlZC5kZWNpc2lvbixcbiAgICAgICAgcmVhc29uOiBwYXJzZWQucmVhc29uLFxuICAgICAgICBibG9ja2VkOiBwYXJzZWQuYmxvY2tlZCxcbiAgICAgIH07XG4gICAgfSBjYXRjaCB7XG4gICAgICAvLyBSZXR1cm4gcmF3IG91dHB1dCBpZiBub3QgSlNPTlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgb3V0cHV0LFxuICAgICAgfTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKTtcblxuICAgIC8vIEV4aXQgY29kZSAyIG1lYW5zIGJsb2NraW5nXG4gICAgaWYgKG1lc3NhZ2UuaW5jbHVkZXMoJ2V4aXQgY29kZSAyJykpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBibG9ja2VkOiB0cnVlLFxuICAgICAgICBlcnJvcjogbWVzc2FnZSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IG1lc3NhZ2UsXG4gICAgfTtcbiAgfVxufVxuXG5pbnRlcmZhY2UgUmlza0Fzc2Vzc21lbnQge1xuICBzY29yZTogbnVtYmVyO1xuICByZWFzb25zOiBzdHJpbmdbXTtcbn1cblxuZnVuY3Rpb24gc2VyaWFsaXplQXJncyhhcmdzPzogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pOiBzdHJpbmcge1xuICBpZiAoIWFyZ3MpIHJldHVybiAnJztcbiAgdHJ5IHtcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoYXJncywgKF9rZXksIHZhbHVlKSA9PiB7XG4gICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnYmlnaW50Jykge1xuICAgICAgICByZXR1cm4gdmFsdWUudG9TdHJpbmcoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9KTtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIFN0cmluZyhhcmdzKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBidWlsZFByb21wdEZvckhvb2soaG9vazogSG9va0RlZmluaXRpb24sIGNvbnRleHQ6IEhvb2tDb250ZXh0KTogc3RyaW5nIHtcbiAgY29uc3QgcGFydHM6IHN0cmluZ1tdID0gW107XG5cbiAgaWYgKGhvb2sucHJvbXB0KSB7XG4gICAgcGFydHMucHVzaChob29rLnByb21wdC50cmltKCkpO1xuICB9XG4gIHBhcnRzLnB1c2goYEV2ZW50OiAke2NvbnRleHQuZXZlbnR9YCk7XG5cbiAgaWYgKGNvbnRleHQudXNlcklucHV0KSB7XG4gICAgcGFydHMucHVzaChgVXNlciBpbnB1dDogJHtjb250ZXh0LnVzZXJJbnB1dH1gKTtcbiAgfVxuICBpZiAoY29udGV4dC50b29sTmFtZSkge1xuICAgIHBhcnRzLnB1c2goYFRvb2w6ICR7Y29udGV4dC50b29sTmFtZX1gKTtcbiAgfVxuICBpZiAoY29udGV4dC50b29sQXJncykge1xuICAgIHBhcnRzLnB1c2goYEFyZ3M6ICR7c2VyaWFsaXplQXJncyhjb250ZXh0LnRvb2xBcmdzKX1gKTtcbiAgfVxuICBpZiAoY29udGV4dC50b29sUmVzdWx0KSB7XG4gICAgcGFydHMucHVzaChgUmVzdWx0OiAke2NvbnRleHQudG9vbFJlc3VsdH1gKTtcbiAgfVxuXG4gIHJldHVybiBwYXJ0cy5maWx0ZXIoQm9vbGVhbikuam9pbignXFxuJyk7XG59XG5cbmZ1bmN0aW9uIGFzc2Vzc1Byb21wdFJpc2socHJvbXB0VGV4dDogc3RyaW5nLCBjb250ZXh0OiBIb29rQ29udGV4dCwgX2FuYWx5c2lzOiBQcm9tcHRBbmFseXNpcyk6IFJpc2tBc3Nlc3NtZW50IHtcbiAgY29uc3QgbG93ZXIgPSBwcm9tcHRUZXh0LnRvTG93ZXJDYXNlKCk7XG4gIGNvbnN0IHJlYXNvbnM6IHN0cmluZ1tdID0gW107XG5cbiAgY29uc3QgZGVzdHJ1Y3RpdmVQYXR0ZXJucyA9IFtcbiAgICAvcm1cXHMrLXJmXFxzK1xcLz8vLFxuICAgIC9zdWRvXFxzK3JtXFxzKy1yZi8sXG4gICAgLzpcXChcXClcXHMqey4qOi4qXFx8Lio6Lio7Lip9O1xccyo6LywgLy8gZm9yayBib21iXG4gICAgL21rZnMvaSxcbiAgICAvZm9ybWF0XFxzK2M6L2ksXG4gICAgL3NodXRkb3duXFxzKy1oL2ksXG4gICAgL2tpbGxcXHMrLTlcXHMrMS8sXG4gICAgL2RkXFxzK2lmPVxcL2RldlxcLy9pLFxuICBdO1xuXG4gIGlmICh0eXBlb2YgY29udGV4dC50b29sQXJncz8uWydjb21tYW5kJ10gPT09ICdzdHJpbmcnKSB7XG4gICAgY29uc3QgY21kID0gU3RyaW5nKGNvbnRleHQudG9vbEFyZ3NbJ2NvbW1hbmQnXSkudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoL3JtXFxzKy1yZi8udGVzdChjbWQpIHx8IC8oXnxcXHMpZGVsXFxzK1xcL2YvaS50ZXN0KGNtZCkpIHtcbiAgICAgIHJlYXNvbnMucHVzaCgnRGVzdHJ1Y3RpdmUgc2hlbGwgY29tbWFuZCcpO1xuICAgIH1cbiAgICBpZiAoL3NodXRkb3dufHJlYm9vdC8udGVzdChjbWQpKSB7XG4gICAgICByZWFzb25zLnB1c2goJ1N5c3RlbSBzaHV0ZG93biBjb21tYW5kJyk7XG4gICAgfVxuICB9XG5cbiAgaWYgKGRlc3RydWN0aXZlUGF0dGVybnMuc29tZSgocmUpID0+IHJlLnRlc3QobG93ZXIpKSkge1xuICAgIHJlYXNvbnMucHVzaCgnRGVzdHJ1Y3RpdmUgY29udGVudCBkZXRlY3RlZCcpO1xuICB9XG5cbiAgY29uc3Qgc2NvcmUgPSByZWFzb25zLmxlbmd0aCA+IDAgPyAwLjkgOiAwLjA1O1xuICByZXR1cm4geyBzY29yZSwgcmVhc29ucyB9O1xufVxuXG5mdW5jdGlvbiBmb3JtYXRQcm9tcHRIb29rT3V0cHV0KGFuYWx5c2lzOiBQcm9tcHRBbmFseXNpcywgcmlzazogUmlza0Fzc2Vzc21lbnQpOiBzdHJpbmcge1xuICBjb25zdCBsaW5lczogc3RyaW5nW10gPSBbXTtcbiAgbGluZXMucHVzaChgSW50ZXJwcmV0YXRpb246ICR7YW5hbHlzaXMuaW50ZXJwcmV0YXRpb259YCk7XG4gIGxpbmVzLnB1c2goYEludGVudDogJHthbmFseXNpcy5pbnRlbnR9ICgke2FuYWx5c2lzLmNhdGVnb3J5fSwgJHsoYW5hbHlzaXMuY29uZmlkZW5jZSAqIDEwMCkudG9GaXhlZCgwKX0lIGNvbmYpYCk7XG4gIGxpbmVzLnB1c2goXG4gICAgYW5hbHlzaXMudGFza3MubGVuZ3RoXG4gICAgICA/IGBUYXNrczogJHthbmFseXNpcy50YXNrcy5tYXAoKHQpID0+IGBbJHt0LmlkfV0gJHt0LmRlc2NyaXB0aW9ufWApLmpvaW4oJyB8ICcpfWBcbiAgICAgIDogJ1Rhc2tzOiBub25lJ1xuICApO1xuICBsaW5lcy5wdXNoKGBSaXNrOiAkeyhyaXNrLnNjb3JlICogMTAwKS50b0ZpeGVkKDApfSUke3Jpc2sucmVhc29ucy5sZW5ndGggPyBgICgke3Jpc2sucmVhc29ucy5qb2luKCc7ICcpfSlgIDogJyd9YCk7XG4gIGlmIChhbmFseXNpcy5jbGFyaWZpY2F0aW9uTmVlZGVkLmxlbmd0aCkge1xuICAgIGxpbmVzLnB1c2goYENsYXJpZmljYXRpb25zOiAke2FuYWx5c2lzLmNsYXJpZmljYXRpb25OZWVkZWQuam9pbignOyAnKX1gKTtcbiAgfVxuICByZXR1cm4gbGluZXMuam9pbignXFxuJyk7XG59XG5cbi8qKlxuICogRXhlY3V0ZSBhIHByb21wdCBob29rICh3b3VsZCBxdWVyeSBMTE0gaW4gZnVsbCBpbXBsZW1lbnRhdGlvbilcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZVByb21wdEhvb2soXG4gIGhvb2s6IEhvb2tEZWZpbml0aW9uLFxuICBjb250ZXh0OiBIb29rQ29udGV4dFxuKTogUHJvbWlzZTxIb29rUmVzdWx0PiB7XG4gIGlmICghaG9vay5wcm9tcHQpIHtcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdObyBwcm9tcHQgc3BlY2lmaWVkJyB9O1xuICB9XG5cbiAgY29uc3Qgc3RhcnQgPSBEYXRlLm5vdygpO1xuICBjb25zdCBwcm9tcHRUZXh0ID0gYnVpbGRQcm9tcHRGb3JIb29rKGhvb2ssIGNvbnRleHQpO1xuICBjb25zdCBhZ2kgPSBnZXRBR0koY29udGV4dC53b3JraW5nRGlyKTtcbiAgY29uc3QgYW5hbHlzaXMgPSBhZ2kuYW5hbHl6ZVByb21wdChwcm9tcHRUZXh0KTtcbiAgY29uc3QgcmlzayA9IGFzc2Vzc1Byb21wdFJpc2socHJvbXB0VGV4dCwgY29udGV4dCwgYW5hbHlzaXMpO1xuXG4gIGNvbnN0IGhpZ2hSaXNrRXZlbnQgPVxuICAgIGNvbnRleHQuZXZlbnQgPT09ICdQcmVUb29sVXNlJyB8fCBjb250ZXh0LmV2ZW50ID09PSAnUGVybWlzc2lvblJlcXVlc3QnIHx8IGNvbnRleHQuZXZlbnQgPT09ICdVc2VyUHJvbXB0U3VibWl0JztcbiAgY29uc3QgYmxvY2tlZCA9IGhpZ2hSaXNrRXZlbnQgJiYgcmlzay5zY29yZSA+PSAwLjc1O1xuICBjb25zdCBkZWNpc2lvbjogSG9va1Jlc3VsdFsnZGVjaXNpb24nXSA9IGJsb2NrZWQgPyAnZGVueScgOiAnY29udGludWUnO1xuXG4gIGFnaS5yZWNvcmRPcGVyYXRpb24oe1xuICAgIGlkOiBgaG9vay0ke2NvbnRleHQuZXZlbnR9LSR7RGF0ZS5ub3coKX1gLFxuICAgIHByb21wdDogcHJvbXB0VGV4dCxcbiAgICBpbnRlcnByZXRhdGlvbjogYW5hbHlzaXMuaW50ZXJwcmV0YXRpb24sXG4gICAgdGFza3M6IGFuYWx5c2lzLnRhc2tzLm1hcCgodCkgPT4gdC5kZXNjcmlwdGlvbiksXG4gICAgc3VjY2VzczogIWJsb2NrZWQsXG4gICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgIGR1cmF0aW9uOiBEYXRlLm5vdygpIC0gc3RhcnQsXG4gICAgdG9vbHNVc2VkOiBbJ0FHSUhvb2snXSxcbiAgICBlcnJvcnM6IGJsb2NrZWQgPyByaXNrLnJlYXNvbnMgOiB1bmRlZmluZWQsXG4gIH0pO1xuXG4gIHJldHVybiB7XG4gICAgc3VjY2VzczogdHJ1ZSxcbiAgICBkZWNpc2lvbixcbiAgICBibG9ja2VkLFxuICAgIHJlYXNvbjogYmxvY2tlZFxuICAgICAgPyBgSGlnaC1yaXNrIGNvbnRlbnQgZGV0ZWN0ZWQ6ICR7cmlzay5yZWFzb25zLmpvaW4oJzsgJykgfHwgJ3Vuc3BlY2lmaWVkJ31gXG4gICAgICA6IGBBR0kgYW5hbHlzaXM6ICR7YW5hbHlzaXMuaW50ZXJwcmV0YXRpb259IChyaXNrICR7KHJpc2suc2NvcmUgKiAxMDApLnRvRml4ZWQoMCl9JSlgLFxuICAgIG91dHB1dDogZm9ybWF0UHJvbXB0SG9va091dHB1dChhbmFseXNpcywgcmlzayksXG4gIH07XG59XG5cbi8qKlxuICogRXhlY3V0ZSBhIHNpbmdsZSBob29rXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVIb29rKFxuICBob29rOiBIb29rRGVmaW5pdGlvbixcbiAgY29udGV4dDogSG9va0NvbnRleHRcbik6IFByb21pc2U8SG9va1Jlc3VsdD4ge1xuICBzd2l0Y2ggKGhvb2sudHlwZSkge1xuICAgIGNhc2UgJ2NvbW1hbmQnOlxuICAgICAgcmV0dXJuIGV4ZWN1dGVDb21tYW5kSG9vayhob29rLCBjb250ZXh0KTtcbiAgICBjYXNlICdwcm9tcHQnOlxuICAgICAgcmV0dXJuIGV4ZWN1dGVQcm9tcHRIb29rKGhvb2ssIGNvbnRleHQpO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGBVbmtub3duIGhvb2sgdHlwZTogJHtob29rLnR5cGV9YCB9O1xuICB9XG59XG5cbi8qKlxuICogSG9va3NNYW5hZ2VyIGNsYXNzIGZvciBtYW5hZ2luZyBhbmQgZXhlY3V0aW5nIGhvb2tzXG4gKi9cbmV4cG9ydCBjbGFzcyBIb29rc01hbmFnZXIge1xuICBwcml2YXRlIGhvb2tzOiBIb29rc0NvbmZpZztcbiAgcHJpdmF0ZSB3b3JraW5nRGlyOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3Iod29ya2luZ0Rpcjogc3RyaW5nKSB7XG4gICAgdGhpcy53b3JraW5nRGlyID0gd29ya2luZ0RpcjtcbiAgICB0aGlzLmhvb2tzID0gbG9hZEhvb2tzKHdvcmtpbmdEaXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbG9hZCBob29rcyBmcm9tIHNldHRpbmdzIGZpbGVzXG4gICAqL1xuICByZWxvYWQoKTogdm9pZCB7XG4gICAgdGhpcy5ob29rcyA9IGxvYWRIb29rcyh0aGlzLndvcmtpbmdEaXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGhvb2tzIGFyZSBjb25maWd1cmVkIGZvciBhbiBldmVudFxuICAgKi9cbiAgaGFzSG9va3MoZXZlbnQ6IEhvb2tFdmVudCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBCb29sZWFuKHRoaXMuaG9va3NbZXZlbnRdPy5sZW5ndGgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbGwgaG9va3MgZm9yIGFuIGV2ZW50XG4gICAqL1xuICBnZXRIb29rcyhldmVudDogSG9va0V2ZW50KTogSG9va0RlZmluaXRpb25bXSB7XG4gICAgcmV0dXJuIHRoaXMuaG9va3NbZXZlbnRdID8/IFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgYWxsIG1hdGNoaW5nIGhvb2tzIGZvciBhbiBldmVudFxuICAgKi9cbiAgYXN5bmMgZXhlY3V0ZUhvb2tzKGNvbnRleHQ6IEhvb2tDb250ZXh0KTogUHJvbWlzZTxIb29rUmVzdWx0W10+IHtcbiAgICBjb25zdCBldmVudEhvb2tzID0gdGhpcy5ob29rc1tjb250ZXh0LmV2ZW50XSA/PyBbXTtcbiAgICBjb25zdCByZXN1bHRzOiBIb29rUmVzdWx0W10gPSBbXTtcblxuICAgIGZvciAoY29uc3QgaG9vayBvZiBldmVudEhvb2tzKSB7XG4gICAgICBpZiAobWF0Y2hlc0hvb2soaG9vaywgY29udGV4dCkpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZXhlY3V0ZUhvb2soaG9vaywgY29udGV4dCk7XG4gICAgICAgIHJlc3VsdHMucHVzaChyZXN1bHQpO1xuXG4gICAgICAgIC8vIFN0b3Agb24gYmxvY2tpbmcgcmVzdWx0XG4gICAgICAgIGlmIChyZXN1bHQuYmxvY2tlZCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBwcmUtdG9vbCBob29rcyBhbmQgY2hlY2sgaWYgdG9vbCBzaG91bGQgcHJvY2VlZFxuICAgKi9cbiAgYXN5bmMgZXhlY3V0ZVByZVRvb2xIb29rcyhcbiAgICB0b29sTmFtZTogc3RyaW5nLFxuICAgIGFyZ3M6IFJlY29yZDxzdHJpbmcsIHVua25vd24+XG4gICk6IFByb21pc2U8eyBhbGxvd2VkOiBib29sZWFuOyByZXN1bHRzOiBIb29rUmVzdWx0W10gfT4ge1xuICAgIGNvbnN0IGNvbnRleHQ6IEhvb2tDb250ZXh0ID0ge1xuICAgICAgZXZlbnQ6ICdQcmVUb29sVXNlJyxcbiAgICAgIHRvb2xOYW1lLFxuICAgICAgdG9vbEFyZ3M6IGFyZ3MsXG4gICAgICB3b3JraW5nRGlyOiB0aGlzLndvcmtpbmdEaXIsXG4gICAgfTtcblxuICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCB0aGlzLmV4ZWN1dGVIb29rcyhjb250ZXh0KTtcblxuICAgIC8vIENoZWNrIGlmIGFueSBob29rIGJsb2NrZWQgdGhlIG9wZXJhdGlvblxuICAgIGNvbnN0IGJsb2NrZWQgPSByZXN1bHRzLnNvbWUoKHIpID0+IHIuYmxvY2tlZCB8fCByLmRlY2lzaW9uID09PSAnZGVueScpO1xuXG4gICAgcmV0dXJuIHsgYWxsb3dlZDogIWJsb2NrZWQsIHJlc3VsdHMgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIHBvc3QtdG9vbCBob29rc1xuICAgKi9cbiAgYXN5bmMgZXhlY3V0ZVBvc3RUb29sSG9va3MoXG4gICAgdG9vbE5hbWU6IHN0cmluZyxcbiAgICBhcmdzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPixcbiAgICByZXN1bHQ6IHN0cmluZ1xuICApOiBQcm9taXNlPEhvb2tSZXN1bHRbXT4ge1xuICAgIGNvbnN0IGNvbnRleHQ6IEhvb2tDb250ZXh0ID0ge1xuICAgICAgZXZlbnQ6ICdQb3N0VG9vbFVzZScsXG4gICAgICB0b29sTmFtZSxcbiAgICAgIHRvb2xBcmdzOiBhcmdzLFxuICAgICAgdG9vbFJlc3VsdDogcmVzdWx0LFxuICAgICAgd29ya2luZ0RpcjogdGhpcy53b3JraW5nRGlyLFxuICAgIH07XG5cbiAgICByZXR1cm4gdGhpcy5leGVjdXRlSG9va3MoY29udGV4dCk7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSB1c2VyIHByb21wdCBob29rc1xuICAgKi9cbiAgYXN5bmMgZXhlY3V0ZVVzZXJQcm9tcHRIb29rcyhcbiAgICB1c2VySW5wdXQ6IHN0cmluZ1xuICApOiBQcm9taXNlPHsgYWxsb3dlZDogYm9vbGVhbjsgcmVzdWx0czogSG9va1Jlc3VsdFtdIH0+IHtcbiAgICBjb25zdCBjb250ZXh0OiBIb29rQ29udGV4dCA9IHtcbiAgICAgIGV2ZW50OiAnVXNlclByb21wdFN1Ym1pdCcsXG4gICAgICB1c2VySW5wdXQsXG4gICAgICB3b3JraW5nRGlyOiB0aGlzLndvcmtpbmdEaXIsXG4gICAgfTtcblxuICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCB0aGlzLmV4ZWN1dGVIb29rcyhjb250ZXh0KTtcbiAgICBjb25zdCBibG9ja2VkID0gcmVzdWx0cy5zb21lKChyKSA9PiByLmJsb2NrZWQgfHwgci5kZWNpc2lvbiA9PT0gJ2RlbnknKTtcblxuICAgIHJldHVybiB7IGFsbG93ZWQ6ICFibG9ja2VkLCByZXN1bHRzIH07XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBzZXNzaW9uIGxpZmVjeWNsZSBob29rc1xuICAgKi9cbiAgYXN5bmMgZXhlY3V0ZVNlc3Npb25Ib29rKFxuICAgIGV2ZW50OiAnU2Vzc2lvblN0YXJ0JyB8ICdTZXNzaW9uRW5kJyxcbiAgICBzZXNzaW9uSWQ6IHN0cmluZ1xuICApOiBQcm9taXNlPEhvb2tSZXN1bHRbXT4ge1xuICAgIGNvbnN0IGNvbnRleHQ6IEhvb2tDb250ZXh0ID0ge1xuICAgICAgZXZlbnQsXG4gICAgICBzZXNzaW9uSWQsXG4gICAgICB3b3JraW5nRGlyOiB0aGlzLndvcmtpbmdEaXIsXG4gICAgfTtcblxuICAgIHJldHVybiB0aGlzLmV4ZWN1dGVIb29rcyhjb250ZXh0KTtcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhIGhvb2tzIG1hbmFnZXIgZm9yIHRoZSBnaXZlbiB3b3JraW5nIGRpcmVjdG9yeVxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlSG9va3NNYW5hZ2VyKHdvcmtpbmdEaXI6IHN0cmluZyk6IEhvb2tzTWFuYWdlciB7XG4gIHJldHVybiBuZXcgSG9va3NNYW5hZ2VyKHdvcmtpbmdEaXIpO1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQU9BLElBQUFB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