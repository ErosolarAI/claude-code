373318c9484f154e8fb170116a6a2bbe
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.HypothesisEngine = exports.BugHypothesisAnalyzer = void 0;
var _nodeCrypto = require("node:crypto");
class BugHypothesisAnalyzer {
  scoreEvidence(evidence) {
    if (!evidence.length) return 0.3;
    const totalWeight = evidence.reduce((sum, item) => sum + item.weight, 0);
    const normalized = Math.max(0, Math.min(1, 0.5 + totalWeight / (evidence.length * 2)));
    return normalized;
  }
}
exports.BugHypothesisAnalyzer = BugHypothesisAnalyzer;
class HypothesisEngine {
  maxHypotheses;
  analyzer;
  hypotheses = new Map();
  constructor(maxHypotheses = 10) {
    this.maxHypotheses = Math.max(1, maxHypotheses);
    this.analyzer = new BugHypothesisAnalyzer();
  }
  generateHypothesis(description, evidence = []) {
    // Keep memory bounded
    if (this.hypotheses.size >= this.maxHypotheses) {
      const oldest = [...this.hypotheses.keys()][0];
      if (oldest) this.hypotheses.delete(oldest);
    }
    const confidence = this.analyzer.scoreEvidence(evidence);
    const hypothesis = {
      id: (0, _nodeCrypto.randomUUID)(),
      description,
      confidence,
      evidence: [...evidence],
      status: 'pending'
    };
    this.hypotheses.set(hypothesis.id, hypothesis);
    return hypothesis;
  }
  addEvidence(id, evidence) {
    const hyp = this.hypotheses.get(id);
    if (!hyp) return;
    hyp.evidence.push(evidence);
    hyp.confidence = this.analyzer.scoreEvidence(hyp.evidence);
    hyp.status = 'pending';
  }
  getHypothesis(id) {
    return this.hypotheses.get(id);
  }
  getBestHypothesis() {
    let best;
    for (const hyp of this.hypotheses.values()) {
      if (!best || hyp.confidence > best.confidence) {
        best = hyp;
      }
    }
    return best;
  }
}
exports.HypothesisEngine = HypothesisEngine;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbm9kZUNyeXB0byIsInJlcXVpcmUiLCJCdWdIeXBvdGhlc2lzQW5hbHl6ZXIiLCJzY29yZUV2aWRlbmNlIiwiZXZpZGVuY2UiLCJsZW5ndGgiLCJ0b3RhbFdlaWdodCIsInJlZHVjZSIsInN1bSIsIml0ZW0iLCJ3ZWlnaHQiLCJub3JtYWxpemVkIiwiTWF0aCIsIm1heCIsIm1pbiIsImV4cG9ydHMiLCJIeXBvdGhlc2lzRW5naW5lIiwibWF4SHlwb3RoZXNlcyIsImFuYWx5emVyIiwiaHlwb3RoZXNlcyIsIk1hcCIsImNvbnN0cnVjdG9yIiwiZ2VuZXJhdGVIeXBvdGhlc2lzIiwiZGVzY3JpcHRpb24iLCJzaXplIiwib2xkZXN0Iiwia2V5cyIsImRlbGV0ZSIsImNvbmZpZGVuY2UiLCJoeXBvdGhlc2lzIiwiaWQiLCJyYW5kb21VVUlEIiwic3RhdHVzIiwic2V0IiwiYWRkRXZpZGVuY2UiLCJoeXAiLCJnZXQiLCJwdXNoIiwiZ2V0SHlwb3RoZXNpcyIsImdldEJlc3RIeXBvdGhlc2lzIiwiYmVzdCIsInZhbHVlcyJdLCJzb3VyY2VzIjpbImh5cG90aGVzaXNFbmdpbmUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmFuZG9tVVVJRCB9IGZyb20gJ25vZGU6Y3J5cHRvJztcblxuZXhwb3J0IHR5cGUgRXZpZGVuY2UgPSB7XG4gIHR5cGU6ICdvYnNlcnZhdGlvbicgfCAnZGF0YScgfCAndGVzdF9yZXN1bHQnIHwgJ3VzZXJfZmVlZGJhY2snO1xuICBjb250ZW50OiBzdHJpbmc7XG4gIHdlaWdodDogbnVtYmVyO1xuICB0aW1lc3RhbXA6IERhdGU7XG59O1xuXG5leHBvcnQgaW50ZXJmYWNlIEh5cG90aGVzaXMge1xuICBpZDogc3RyaW5nO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBjb25maWRlbmNlOiBudW1iZXI7XG4gIGV2aWRlbmNlOiBFdmlkZW5jZVtdO1xuICBzdGF0dXM6ICdwZW5kaW5nJyB8ICd0ZXN0aW5nJyB8ICd2YWxpZGF0ZWQnIHwgJ3JlamVjdGVkJztcbn1cblxuZXhwb3J0IGNsYXNzIEJ1Z0h5cG90aGVzaXNBbmFseXplciB7XG4gIHNjb3JlRXZpZGVuY2UoZXZpZGVuY2U6IEV2aWRlbmNlW10pOiBudW1iZXIge1xuICAgIGlmICghZXZpZGVuY2UubGVuZ3RoKSByZXR1cm4gMC4zO1xuICAgIGNvbnN0IHRvdGFsV2VpZ2h0ID0gZXZpZGVuY2UucmVkdWNlKChzdW0sIGl0ZW0pID0+IHN1bSArIGl0ZW0ud2VpZ2h0LCAwKTtcbiAgICBjb25zdCBub3JtYWxpemVkID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgMC41ICsgdG90YWxXZWlnaHQgLyAoZXZpZGVuY2UubGVuZ3RoICogMikpKTtcbiAgICByZXR1cm4gbm9ybWFsaXplZDtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgSHlwb3RoZXNpc0VuZ2luZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgbWF4SHlwb3RoZXNlczogbnVtYmVyO1xuICBwcml2YXRlIHJlYWRvbmx5IGFuYWx5emVyOiBCdWdIeXBvdGhlc2lzQW5hbHl6ZXI7XG4gIHByaXZhdGUgaHlwb3RoZXNlczogTWFwPHN0cmluZywgSHlwb3RoZXNpcz4gPSBuZXcgTWFwKCk7XG5cbiAgY29uc3RydWN0b3IobWF4SHlwb3RoZXNlcyA9IDEwKSB7XG4gICAgdGhpcy5tYXhIeXBvdGhlc2VzID0gTWF0aC5tYXgoMSwgbWF4SHlwb3RoZXNlcyk7XG4gICAgdGhpcy5hbmFseXplciA9IG5ldyBCdWdIeXBvdGhlc2lzQW5hbHl6ZXIoKTtcbiAgfVxuXG4gIGdlbmVyYXRlSHlwb3RoZXNpcyhkZXNjcmlwdGlvbjogc3RyaW5nLCBldmlkZW5jZTogRXZpZGVuY2VbXSA9IFtdKTogSHlwb3RoZXNpcyB7XG4gICAgLy8gS2VlcCBtZW1vcnkgYm91bmRlZFxuICAgIGlmICh0aGlzLmh5cG90aGVzZXMuc2l6ZSA+PSB0aGlzLm1heEh5cG90aGVzZXMpIHtcbiAgICAgIGNvbnN0IG9sZGVzdCA9IFsuLi50aGlzLmh5cG90aGVzZXMua2V5cygpXVswXTtcbiAgICAgIGlmIChvbGRlc3QpIHRoaXMuaHlwb3RoZXNlcy5kZWxldGUob2xkZXN0KTtcbiAgICB9XG5cbiAgICBjb25zdCBjb25maWRlbmNlID0gdGhpcy5hbmFseXplci5zY29yZUV2aWRlbmNlKGV2aWRlbmNlKTtcbiAgICBjb25zdCBoeXBvdGhlc2lzOiBIeXBvdGhlc2lzID0ge1xuICAgICAgaWQ6IHJhbmRvbVVVSUQoKSxcbiAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgY29uZmlkZW5jZSxcbiAgICAgIGV2aWRlbmNlOiBbLi4uZXZpZGVuY2VdLFxuICAgICAgc3RhdHVzOiAncGVuZGluZycsXG4gICAgfTtcblxuICAgIHRoaXMuaHlwb3RoZXNlcy5zZXQoaHlwb3RoZXNpcy5pZCwgaHlwb3RoZXNpcyk7XG4gICAgcmV0dXJuIGh5cG90aGVzaXM7XG4gIH1cblxuICBhZGRFdmlkZW5jZShpZDogc3RyaW5nLCBldmlkZW5jZTogRXZpZGVuY2UpOiB2b2lkIHtcbiAgICBjb25zdCBoeXAgPSB0aGlzLmh5cG90aGVzZXMuZ2V0KGlkKTtcbiAgICBpZiAoIWh5cCkgcmV0dXJuO1xuICAgIGh5cC5ldmlkZW5jZS5wdXNoKGV2aWRlbmNlKTtcbiAgICBoeXAuY29uZmlkZW5jZSA9IHRoaXMuYW5hbHl6ZXIuc2NvcmVFdmlkZW5jZShoeXAuZXZpZGVuY2UpO1xuICAgIGh5cC5zdGF0dXMgPSAncGVuZGluZyc7XG4gIH1cblxuICBnZXRIeXBvdGhlc2lzKGlkOiBzdHJpbmcpOiBIeXBvdGhlc2lzIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdGhpcy5oeXBvdGhlc2VzLmdldChpZCk7XG4gIH1cblxuICBnZXRCZXN0SHlwb3RoZXNpcygpOiBIeXBvdGhlc2lzIHwgdW5kZWZpbmVkIHtcbiAgICBsZXQgYmVzdDogSHlwb3RoZXNpcyB8IHVuZGVmaW5lZDtcbiAgICBmb3IgKGNvbnN0IGh5cCBvZiB0aGlzLmh5cG90aGVzZXMudmFsdWVzKCkpIHtcbiAgICAgIGlmICghYmVzdCB8fCBoeXAuY29uZmlkZW5jZSA+IGJlc3QuY29uZmlkZW5jZSkge1xuICAgICAgICBiZXN0ID0gaHlwO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYmVzdDtcbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxJQUFBQSxXQUFBLEdBQUFDLE9BQUE7QUFpQk8sTUFBTUMscUJBQXFCLENBQUM7RUFDakNDLGFBQWFBLENBQUNDLFFBQW9CLEVBQVU7SUFDMUMsSUFBSSxDQUFDQSxRQUFRLENBQUNDLE1BQU0sRUFBRSxPQUFPLEdBQUc7SUFDaEMsTUFBTUMsV0FBVyxHQUFHRixRQUFRLENBQUNHLE1BQU0sQ0FBQyxDQUFDQyxHQUFHLEVBQUVDLElBQUksS0FBS0QsR0FBRyxHQUFHQyxJQUFJLENBQUNDLE1BQU0sRUFBRSxDQUFDLENBQUM7SUFDeEUsTUFBTUMsVUFBVSxHQUFHQyxJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFDLEVBQUVELElBQUksQ0FBQ0UsR0FBRyxDQUFDLENBQUMsRUFBRSxHQUFHLEdBQUdSLFdBQVcsSUFBSUYsUUFBUSxDQUFDQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN0RixPQUFPTSxVQUFVO0VBQ25CO0FBQ0Y7QUFBQ0ksT0FBQSxDQUFBYixxQkFBQSxHQUFBQSxxQkFBQTtBQUVNLE1BQU1jLGdCQUFnQixDQUFDO0VBQ1hDLGFBQWE7RUFDYkMsUUFBUTtFQUNqQkMsVUFBVSxHQUE0QixJQUFJQyxHQUFHLENBQUMsQ0FBQztFQUV2REMsV0FBV0EsQ0FBQ0osYUFBYSxHQUFHLEVBQUUsRUFBRTtJQUM5QixJQUFJLENBQUNBLGFBQWEsR0FBR0wsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQyxFQUFFSSxhQUFhLENBQUM7SUFDL0MsSUFBSSxDQUFDQyxRQUFRLEdBQUcsSUFBSWhCLHFCQUFxQixDQUFDLENBQUM7RUFDN0M7RUFFQW9CLGtCQUFrQkEsQ0FBQ0MsV0FBbUIsRUFBRW5CLFFBQW9CLEdBQUcsRUFBRSxFQUFjO0lBQzdFO0lBQ0EsSUFBSSxJQUFJLENBQUNlLFVBQVUsQ0FBQ0ssSUFBSSxJQUFJLElBQUksQ0FBQ1AsYUFBYSxFQUFFO01BQzlDLE1BQU1RLE1BQU0sR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDTixVQUFVLENBQUNPLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7TUFDN0MsSUFBSUQsTUFBTSxFQUFFLElBQUksQ0FBQ04sVUFBVSxDQUFDUSxNQUFNLENBQUNGLE1BQU0sQ0FBQztJQUM1QztJQUVBLE1BQU1HLFVBQVUsR0FBRyxJQUFJLENBQUNWLFFBQVEsQ0FBQ2YsYUFBYSxDQUFDQyxRQUFRLENBQUM7SUFDeEQsTUFBTXlCLFVBQXNCLEdBQUc7TUFDN0JDLEVBQUUsRUFBRSxJQUFBQyxzQkFBVSxFQUFDLENBQUM7TUFDaEJSLFdBQVc7TUFDWEssVUFBVTtNQUNWeEIsUUFBUSxFQUFFLENBQUMsR0FBR0EsUUFBUSxDQUFDO01BQ3ZCNEIsTUFBTSxFQUFFO0lBQ1YsQ0FBQztJQUVELElBQUksQ0FBQ2IsVUFBVSxDQUFDYyxHQUFHLENBQUNKLFVBQVUsQ0FBQ0MsRUFBRSxFQUFFRCxVQUFVLENBQUM7SUFDOUMsT0FBT0EsVUFBVTtFQUNuQjtFQUVBSyxXQUFXQSxDQUFDSixFQUFVLEVBQUUxQixRQUFrQixFQUFRO0lBQ2hELE1BQU0rQixHQUFHLEdBQUcsSUFBSSxDQUFDaEIsVUFBVSxDQUFDaUIsR0FBRyxDQUFDTixFQUFFLENBQUM7SUFDbkMsSUFBSSxDQUFDSyxHQUFHLEVBQUU7SUFDVkEsR0FBRyxDQUFDL0IsUUFBUSxDQUFDaUMsSUFBSSxDQUFDakMsUUFBUSxDQUFDO0lBQzNCK0IsR0FBRyxDQUFDUCxVQUFVLEdBQUcsSUFBSSxDQUFDVixRQUFRLENBQUNmLGFBQWEsQ0FBQ2dDLEdBQUcsQ0FBQy9CLFFBQVEsQ0FBQztJQUMxRCtCLEdBQUcsQ0FBQ0gsTUFBTSxHQUFHLFNBQVM7RUFDeEI7RUFFQU0sYUFBYUEsQ0FBQ1IsRUFBVSxFQUEwQjtJQUNoRCxPQUFPLElBQUksQ0FBQ1gsVUFBVSxDQUFDaUIsR0FBRyxDQUFDTixFQUFFLENBQUM7RUFDaEM7RUFFQVMsaUJBQWlCQSxDQUFBLEVBQTJCO0lBQzFDLElBQUlDLElBQTRCO0lBQ2hDLEtBQUssTUFBTUwsR0FBRyxJQUFJLElBQUksQ0FBQ2hCLFVBQVUsQ0FBQ3NCLE1BQU0sQ0FBQyxDQUFDLEVBQUU7TUFDMUMsSUFBSSxDQUFDRCxJQUFJLElBQUlMLEdBQUcsQ0FBQ1AsVUFBVSxHQUFHWSxJQUFJLENBQUNaLFVBQVUsRUFBRTtRQUM3Q1ksSUFBSSxHQUFHTCxHQUFHO01BQ1o7SUFDRjtJQUNBLE9BQU9LLElBQUk7RUFDYjtBQUNGO0FBQUN6QixPQUFBLENBQUFDLGdCQUFBLEdBQUFBLGdCQUFBIiwiaWdub3JlTGlzdCI6W119