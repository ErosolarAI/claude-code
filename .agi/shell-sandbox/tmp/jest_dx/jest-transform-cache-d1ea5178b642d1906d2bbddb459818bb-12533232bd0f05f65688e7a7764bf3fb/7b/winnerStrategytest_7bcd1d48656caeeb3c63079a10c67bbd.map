{"version":3,"names":["_winnerStrategy","require","_repoUpgradeOrchestrator","modeDefinition","REPO_UPGRADE_MODE_DEFINITIONS","makeResult","summary","success","detail","score","describe","it","primary","refiner","outcome","task","id","goal","ranked","candidateId","aggregateScore","humanAccuracy","rank","correctnessScore","qualityScore","learnedScore","evaluatorScore","pairwise","evaluatorBreakdown","winnerVariant","winner","resolveWinner","variantResults","tournamentOutcome","expect","toBe","pickWinner","jest","fn","mockReturnValue","toHaveBeenCalledWith"],"sources":["winnerStrategy.test.ts"],"sourcesContent":["import { resolveWinner } from '../../src/core/winnerStrategy.js';\nimport {\n  REPO_UPGRADE_MODE_DEFINITIONS,\n  type UpgradeStepResult,\n} from '../../src/core/repoUpgradeOrchestrator.js';\nimport type { TournamentOutcome } from '../../src/core/dualTournament.js';\n\nconst modeDefinition = REPO_UPGRADE_MODE_DEFINITIONS['dual-rl-tournament'];\n\nfunction makeResult(summary: string): UpgradeStepResult {\n  return { success: true, summary, detail: summary, score: 0.5 };\n}\n\ndescribe('resolveWinner', () => {\n  it('uses tournament outcome when available', () => {\n    const primary = makeResult('primary');\n    const refiner = makeResult('refiner');\n\n    const outcome: TournamentOutcome = {\n      task: { id: 't', goal: 'g' },\n      ranked: [\n        {\n          candidateId: 'refiner',\n          aggregateScore: 0.9,\n          humanAccuracy: 1,\n          rank: 1,\n          correctnessScore: 1,\n          qualityScore: 1,\n          learnedScore: 1,\n          evaluatorScore: 1,\n        },\n      ],\n      pairwise: {},\n      evaluatorBreakdown: {},\n    };\n\n    const { winnerVariant, winner } = resolveWinner(\n      { modeDefinition, variantResults: { primary, refiner }, tournamentOutcome: outcome },\n      () => ({ winner: primary, winnerVariant: 'primary' })\n    );\n\n    expect(winnerVariant).toBe('refiner');\n    expect(winner.summary).toBe('refiner');\n  });\n\n  it('falls back to pickWinner when no tournament outcome', () => {\n    const primary = makeResult('primary');\n    const refiner = makeResult('refiner');\n    const pickWinner = jest.fn().mockReturnValue({ winner: refiner, winnerVariant: 'refiner' as const });\n\n    const { winnerVariant } = resolveWinner(\n      { modeDefinition, variantResults: { primary, refiner }, tournamentOutcome: null },\n      pickWinner\n    );\n\n    expect(pickWinner).toHaveBeenCalledWith(modeDefinition, primary, refiner);\n    expect(winnerVariant).toBe('refiner');\n  });\n});\n"],"mappings":";;AAAA,IAAAA,eAAA,GAAAC,OAAA;AACA,IAAAC,wBAAA,GAAAD,OAAA;AAMA,MAAME,cAAc,GAAGC,sDAA6B,CAAC,oBAAoB,CAAC;AAE1E,SAASC,UAAUA,CAACC,OAAe,EAAqB;EACtD,OAAO;IAAEC,OAAO,EAAE,IAAI;IAAED,OAAO;IAAEE,MAAM,EAAEF,OAAO;IAAEG,KAAK,EAAE;EAAI,CAAC;AAChE;AAEAC,QAAQ,CAAC,eAAe,EAAE,MAAM;EAC9BC,EAAE,CAAC,wCAAwC,EAAE,MAAM;IACjD,MAAMC,OAAO,GAAGP,UAAU,CAAC,SAAS,CAAC;IACrC,MAAMQ,OAAO,GAAGR,UAAU,CAAC,SAAS,CAAC;IAErC,MAAMS,OAA0B,GAAG;MACjCC,IAAI,EAAE;QAAEC,EAAE,EAAE,GAAG;QAAEC,IAAI,EAAE;MAAI,CAAC;MAC5BC,MAAM,EAAE,CACN;QACEC,WAAW,EAAE,SAAS;QACtBC,cAAc,EAAE,GAAG;QACnBC,aAAa,EAAE,CAAC;QAChBC,IAAI,EAAE,CAAC;QACPC,gBAAgB,EAAE,CAAC;QACnBC,YAAY,EAAE,CAAC;QACfC,YAAY,EAAE,CAAC;QACfC,cAAc,EAAE;MAClB,CAAC,CACF;MACDC,QAAQ,EAAE,CAAC,CAAC;MACZC,kBAAkB,EAAE,CAAC;IACvB,CAAC;IAED,MAAM;MAAEC,aAAa;MAAEC;IAAO,CAAC,GAAG,IAAAC,6BAAa,EAC7C;MAAE5B,cAAc;MAAE6B,cAAc,EAAE;QAAEpB,OAAO;QAAEC;MAAQ,CAAC;MAAEoB,iBAAiB,EAAEnB;IAAQ,CAAC,EACpF,OAAO;MAAEgB,MAAM,EAAElB,OAAO;MAAEiB,aAAa,EAAE;IAAU,CAAC,CACtD,CAAC;IAEDK,MAAM,CAACL,aAAa,CAAC,CAACM,IAAI,CAAC,SAAS,CAAC;IACrCD,MAAM,CAACJ,MAAM,CAACxB,OAAO,CAAC,CAAC6B,IAAI,CAAC,SAAS,CAAC;EACxC,CAAC,CAAC;EAEFxB,EAAE,CAAC,qDAAqD,EAAE,MAAM;IAC9D,MAAMC,OAAO,GAAGP,UAAU,CAAC,SAAS,CAAC;IACrC,MAAMQ,OAAO,GAAGR,UAAU,CAAC,SAAS,CAAC;IACrC,MAAM+B,UAAU,GAAGC,IAAI,CAACC,EAAE,CAAC,CAAC,CAACC,eAAe,CAAC;MAAET,MAAM,EAAEjB,OAAO;MAAEgB,aAAa,EAAE;IAAmB,CAAC,CAAC;IAEpG,MAAM;MAAEA;IAAc,CAAC,GAAG,IAAAE,6BAAa,EACrC;MAAE5B,cAAc;MAAE6B,cAAc,EAAE;QAAEpB,OAAO;QAAEC;MAAQ,CAAC;MAAEoB,iBAAiB,EAAE;IAAK,CAAC,EACjFG,UACF,CAAC;IAEDF,MAAM,CAACE,UAAU,CAAC,CAACI,oBAAoB,CAACrC,cAAc,EAAES,OAAO,EAAEC,OAAO,CAAC;IACzEqB,MAAM,CAACL,aAAa,CAAC,CAACM,IAAI,CAAC,SAAS,CAAC;EACvC,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}