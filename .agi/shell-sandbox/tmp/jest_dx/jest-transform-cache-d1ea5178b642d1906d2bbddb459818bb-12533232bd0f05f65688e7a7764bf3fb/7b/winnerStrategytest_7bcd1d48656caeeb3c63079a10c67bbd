e688456460d0112fe9abb0b5828d3bfc
"use strict";

var _winnerStrategy = require("../../src/core/winnerStrategy.js");
var _repoUpgradeOrchestrator = require("../../src/core/repoUpgradeOrchestrator.js");
const modeDefinition = _repoUpgradeOrchestrator.REPO_UPGRADE_MODE_DEFINITIONS['dual-rl-tournament'];
function makeResult(summary) {
  return {
    success: true,
    summary,
    detail: summary,
    score: 0.5
  };
}
describe('resolveWinner', () => {
  it('uses tournament outcome when available', () => {
    const primary = makeResult('primary');
    const refiner = makeResult('refiner');
    const outcome = {
      task: {
        id: 't',
        goal: 'g'
      },
      ranked: [{
        candidateId: 'refiner',
        aggregateScore: 0.9,
        humanAccuracy: 1,
        rank: 1,
        correctnessScore: 1,
        qualityScore: 1,
        learnedScore: 1,
        evaluatorScore: 1
      }],
      pairwise: {},
      evaluatorBreakdown: {}
    };
    const {
      winnerVariant,
      winner
    } = (0, _winnerStrategy.resolveWinner)({
      modeDefinition,
      variantResults: {
        primary,
        refiner
      },
      tournamentOutcome: outcome
    }, () => ({
      winner: primary,
      winnerVariant: 'primary'
    }));
    expect(winnerVariant).toBe('refiner');
    expect(winner.summary).toBe('refiner');
  });
  it('falls back to pickWinner when no tournament outcome', () => {
    const primary = makeResult('primary');
    const refiner = makeResult('refiner');
    const pickWinner = jest.fn().mockReturnValue({
      winner: refiner,
      winnerVariant: 'refiner'
    });
    const {
      winnerVariant
    } = (0, _winnerStrategy.resolveWinner)({
      modeDefinition,
      variantResults: {
        primary,
        refiner
      },
      tournamentOutcome: null
    }, pickWinner);
    expect(pickWinner).toHaveBeenCalledWith(modeDefinition, primary, refiner);
    expect(winnerVariant).toBe('refiner');
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfd2lubmVyU3RyYXRlZ3kiLCJyZXF1aXJlIiwiX3JlcG9VcGdyYWRlT3JjaGVzdHJhdG9yIiwibW9kZURlZmluaXRpb24iLCJSRVBPX1VQR1JBREVfTU9ERV9ERUZJTklUSU9OUyIsIm1ha2VSZXN1bHQiLCJzdW1tYXJ5Iiwic3VjY2VzcyIsImRldGFpbCIsInNjb3JlIiwiZGVzY3JpYmUiLCJpdCIsInByaW1hcnkiLCJyZWZpbmVyIiwib3V0Y29tZSIsInRhc2siLCJpZCIsImdvYWwiLCJyYW5rZWQiLCJjYW5kaWRhdGVJZCIsImFnZ3JlZ2F0ZVNjb3JlIiwiaHVtYW5BY2N1cmFjeSIsInJhbmsiLCJjb3JyZWN0bmVzc1Njb3JlIiwicXVhbGl0eVNjb3JlIiwibGVhcm5lZFNjb3JlIiwiZXZhbHVhdG9yU2NvcmUiLCJwYWlyd2lzZSIsImV2YWx1YXRvckJyZWFrZG93biIsIndpbm5lclZhcmlhbnQiLCJ3aW5uZXIiLCJyZXNvbHZlV2lubmVyIiwidmFyaWFudFJlc3VsdHMiLCJ0b3VybmFtZW50T3V0Y29tZSIsImV4cGVjdCIsInRvQmUiLCJwaWNrV2lubmVyIiwiamVzdCIsImZuIiwibW9ja1JldHVyblZhbHVlIiwidG9IYXZlQmVlbkNhbGxlZFdpdGgiXSwic291cmNlcyI6WyJ3aW5uZXJTdHJhdGVneS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHJlc29sdmVXaW5uZXIgfSBmcm9tICcuLi8uLi9zcmMvY29yZS93aW5uZXJTdHJhdGVneS5qcyc7XG5pbXBvcnQge1xuICBSRVBPX1VQR1JBREVfTU9ERV9ERUZJTklUSU9OUyxcbiAgdHlwZSBVcGdyYWRlU3RlcFJlc3VsdCxcbn0gZnJvbSAnLi4vLi4vc3JjL2NvcmUvcmVwb1VwZ3JhZGVPcmNoZXN0cmF0b3IuanMnO1xuaW1wb3J0IHR5cGUgeyBUb3VybmFtZW50T3V0Y29tZSB9IGZyb20gJy4uLy4uL3NyYy9jb3JlL2R1YWxUb3VybmFtZW50LmpzJztcblxuY29uc3QgbW9kZURlZmluaXRpb24gPSBSRVBPX1VQR1JBREVfTU9ERV9ERUZJTklUSU9OU1snZHVhbC1ybC10b3VybmFtZW50J107XG5cbmZ1bmN0aW9uIG1ha2VSZXN1bHQoc3VtbWFyeTogc3RyaW5nKTogVXBncmFkZVN0ZXBSZXN1bHQge1xuICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzdW1tYXJ5LCBkZXRhaWw6IHN1bW1hcnksIHNjb3JlOiAwLjUgfTtcbn1cblxuZGVzY3JpYmUoJ3Jlc29sdmVXaW5uZXInLCAoKSA9PiB7XG4gIGl0KCd1c2VzIHRvdXJuYW1lbnQgb3V0Y29tZSB3aGVuIGF2YWlsYWJsZScsICgpID0+IHtcbiAgICBjb25zdCBwcmltYXJ5ID0gbWFrZVJlc3VsdCgncHJpbWFyeScpO1xuICAgIGNvbnN0IHJlZmluZXIgPSBtYWtlUmVzdWx0KCdyZWZpbmVyJyk7XG5cbiAgICBjb25zdCBvdXRjb21lOiBUb3VybmFtZW50T3V0Y29tZSA9IHtcbiAgICAgIHRhc2s6IHsgaWQ6ICd0JywgZ29hbDogJ2cnIH0sXG4gICAgICByYW5rZWQ6IFtcbiAgICAgICAge1xuICAgICAgICAgIGNhbmRpZGF0ZUlkOiAncmVmaW5lcicsXG4gICAgICAgICAgYWdncmVnYXRlU2NvcmU6IDAuOSxcbiAgICAgICAgICBodW1hbkFjY3VyYWN5OiAxLFxuICAgICAgICAgIHJhbms6IDEsXG4gICAgICAgICAgY29ycmVjdG5lc3NTY29yZTogMSxcbiAgICAgICAgICBxdWFsaXR5U2NvcmU6IDEsXG4gICAgICAgICAgbGVhcm5lZFNjb3JlOiAxLFxuICAgICAgICAgIGV2YWx1YXRvclNjb3JlOiAxLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIHBhaXJ3aXNlOiB7fSxcbiAgICAgIGV2YWx1YXRvckJyZWFrZG93bjoge30sXG4gICAgfTtcblxuICAgIGNvbnN0IHsgd2lubmVyVmFyaWFudCwgd2lubmVyIH0gPSByZXNvbHZlV2lubmVyKFxuICAgICAgeyBtb2RlRGVmaW5pdGlvbiwgdmFyaWFudFJlc3VsdHM6IHsgcHJpbWFyeSwgcmVmaW5lciB9LCB0b3VybmFtZW50T3V0Y29tZTogb3V0Y29tZSB9LFxuICAgICAgKCkgPT4gKHsgd2lubmVyOiBwcmltYXJ5LCB3aW5uZXJWYXJpYW50OiAncHJpbWFyeScgfSlcbiAgICApO1xuXG4gICAgZXhwZWN0KHdpbm5lclZhcmlhbnQpLnRvQmUoJ3JlZmluZXInKTtcbiAgICBleHBlY3Qod2lubmVyLnN1bW1hcnkpLnRvQmUoJ3JlZmluZXInKTtcbiAgfSk7XG5cbiAgaXQoJ2ZhbGxzIGJhY2sgdG8gcGlja1dpbm5lciB3aGVuIG5vIHRvdXJuYW1lbnQgb3V0Y29tZScsICgpID0+IHtcbiAgICBjb25zdCBwcmltYXJ5ID0gbWFrZVJlc3VsdCgncHJpbWFyeScpO1xuICAgIGNvbnN0IHJlZmluZXIgPSBtYWtlUmVzdWx0KCdyZWZpbmVyJyk7XG4gICAgY29uc3QgcGlja1dpbm5lciA9IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyB3aW5uZXI6IHJlZmluZXIsIHdpbm5lclZhcmlhbnQ6ICdyZWZpbmVyJyBhcyBjb25zdCB9KTtcblxuICAgIGNvbnN0IHsgd2lubmVyVmFyaWFudCB9ID0gcmVzb2x2ZVdpbm5lcihcbiAgICAgIHsgbW9kZURlZmluaXRpb24sIHZhcmlhbnRSZXN1bHRzOiB7IHByaW1hcnksIHJlZmluZXIgfSwgdG91cm5hbWVudE91dGNvbWU6IG51bGwgfSxcbiAgICAgIHBpY2tXaW5uZXJcbiAgICApO1xuXG4gICAgZXhwZWN0KHBpY2tXaW5uZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKG1vZGVEZWZpbml0aW9uLCBwcmltYXJ5LCByZWZpbmVyKTtcbiAgICBleHBlY3Qod2lubmVyVmFyaWFudCkudG9CZSgncmVmaW5lcicpO1xuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUFBLGVBQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLHdCQUFBLEdBQUFELE9BQUE7QUFNQSxNQUFNRSxjQUFjLEdBQUdDLHNEQUE2QixDQUFDLG9CQUFvQixD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