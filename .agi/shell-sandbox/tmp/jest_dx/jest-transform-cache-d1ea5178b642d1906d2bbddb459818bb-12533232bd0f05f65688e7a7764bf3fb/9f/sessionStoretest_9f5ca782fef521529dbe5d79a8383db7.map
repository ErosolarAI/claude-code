{"version":3,"names":["_nodeFs","require","_nodePath","_nodeOs","_interopRequireWildcard","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","describe","tempDir","saveSessionSnapshot","listSessions","loadSessionById","deleteSession","saveAutosaveSnapshot","loadAutosaveSnapshot","clearAutosaveSnapshot","baseMessages","role","content","beforeEach","mkdtempSync","join","tmpdir","process","env","jest","resetModules","Promise","resolve","then","afterEach","rmSync","recursive","force","it","summary","profile","provider","model","workspaceRoot","messages","title","expect","id","toBeTruthy","sessions","toHaveLength","first","toBe","loaded","length","autosaved","cleared","toBeNull"],"sources":["sessionStore.test.ts"],"sourcesContent":["import { mkdtempSync, rmSync } from 'node:fs';\nimport { join } from 'node:path';\nimport { tmpdir } from 'node:os';\nimport type { ConversationMessage } from '../src/core/types.js';\n\ndescribe('sessionStore', () => {\n  let tempDir: string;\n  let saveSessionSnapshot: typeof import('../src/core/sessionStore.js').saveSessionSnapshot;\n  let listSessions: typeof import('../src/core/sessionStore.js').listSessions;\n  let loadSessionById: typeof import('../src/core/sessionStore.js').loadSessionById;\n  let deleteSession: typeof import('../src/core/sessionStore.js').deleteSession;\n  let saveAutosaveSnapshot: typeof import('../src/core/sessionStore.js').saveAutosaveSnapshot;\n  let loadAutosaveSnapshot: typeof import('../src/core/sessionStore.js').loadAutosaveSnapshot;\n  let clearAutosaveSnapshot: typeof import('../src/core/sessionStore.js').clearAutosaveSnapshot;\n\n  const baseMessages: ConversationMessage[] = [\n    { role: 'system', content: 'system prompt' },\n    { role: 'user', content: 'Initial request' },\n    { role: 'assistant', content: 'Response' },\n  ];\n\n  beforeEach(async () => {\n    tempDir = mkdtempSync(join(tmpdir(), 'erosolar-session-store-'));\n    process.env['EROSOLAR_DATA_DIR'] = tempDir;\n    jest.resetModules();\n\n    ({\n      saveSessionSnapshot,\n      listSessions,\n      loadSessionById,\n      deleteSession,\n      saveAutosaveSnapshot,\n      loadAutosaveSnapshot,\n      clearAutosaveSnapshot,\n    } = await import('../src/core/sessionStore.js'));\n  });\n\n  afterEach(() => {\n    delete process.env['EROSOLAR_DATA_DIR'];\n    rmSync(tempDir, { recursive: true, force: true });\n  });\n\n  it('saves, lists, and loads sessions', () => {\n    const summary = saveSessionSnapshot({\n      profile: 'general',\n      provider: 'openai',\n      model: 'gpt-5.1',\n      workspaceRoot: '/tmp/project',\n      messages: baseMessages,\n      title: 'My session',\n    });\n\n    expect(summary.id).toBeTruthy();\n\n    const sessions = listSessions('general');\n    expect(sessions).toHaveLength(1);\n\n    const first = sessions[0];\n    expect(first?.title).toBe('My session');\n\n    const loaded = loadSessionById(summary.id);\n    expect(loaded?.messages.length).toBe(baseMessages.length);\n    expect(loaded?.workspaceRoot).toBe('/tmp/project');\n\n    expect(deleteSession(summary.id)).toBe(true);\n    expect(listSessions('general')).toHaveLength(0);\n  });\n\n  it('autosave helpers round trip', () => {\n    saveAutosaveSnapshot('general', {\n      provider: 'openai',\n      model: 'gpt-5.1',\n      workspaceRoot: '/tmp/project',\n      messages: baseMessages,\n      title: 'Autosave session',\n    });\n\n    const autosaved = loadAutosaveSnapshot('general');\n    expect(autosaved?.title).toBe('Autosave session');\n    expect(autosaved?.messages[1]?.role).toBe('user');\n\n    clearAutosaveSnapshot('general');\n    const cleared = loadAutosaveSnapshot('general');\n    expect(cleared).toBeNull();\n  });\n});\n"],"mappings":";;AAAA,IAAAA,OAAA,GAAAC,OAAA;AACA,IAAAC,SAAA,GAAAD,OAAA;AACA,IAAAE,OAAA,GAAAF,OAAA;AAAiC,SAAAG,wBAAAC,CAAA,EAAAC,CAAA,6BAAAC,OAAA,MAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAH,uBAAA,YAAAA,CAAAC,CAAA,EAAAC,CAAA,SAAAA,CAAA,IAAAD,CAAA,IAAAA,CAAA,CAAAK,UAAA,SAAAL,CAAA,MAAAM,CAAA,EAAAC,CAAA,EAAAC,CAAA,KAAAC,SAAA,QAAAC,OAAA,EAAAV,CAAA,iBAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,SAAAQ,CAAA,MAAAF,CAAA,GAAAL,CAAA,GAAAG,CAAA,GAAAD,CAAA,QAAAG,CAAA,CAAAK,GAAA,CAAAX,CAAA,UAAAM,CAAA,CAAAM,GAAA,CAAAZ,CAAA,GAAAM,CAAA,CAAAO,GAAA,CAAAb,CAAA,EAAAQ,CAAA,gBAAAP,CAAA,IAAAD,CAAA,gBAAAC,CAAA,OAAAa,cAAA,CAAAC,IAAA,CAAAf,CAAA,EAAAC,CAAA,OAAAM,CAAA,IAAAD,CAAA,GAAAU,MAAA,CAAAC,cAAA,KAAAD,MAAA,CAAAE,wBAAA,CAAAlB,CAAA,EAAAC,CAAA,OAAAM,CAAA,CAAAK,GAAA,IAAAL,CAAA,CAAAM,GAAA,IAAAP,CAAA,CAAAE,CAAA,EAAAP,CAAA,EAAAM,CAAA,IAAAC,CAAA,CAAAP,CAAA,IAAAD,CAAA,CAAAC,CAAA,WAAAO,CAAA,KAAAR,CAAA,EAAAC,CAAA;AAGjCkB,QAAQ,CAAC,cAAc,EAAE,MAAM;EAC7B,IAAIC,OAAe;EACnB,IAAIC,mBAAqF;EACzF,IAAIC,YAAuE;EAC3E,IAAIC,eAA6E;EACjF,IAAIC,aAAyE;EAC7E,IAAIC,oBAAuF;EAC3F,IAAIC,oBAAuF;EAC3F,IAAIC,qBAAyF;EAE7F,MAAMC,YAAmC,GAAG,CAC1C;IAAEC,IAAI,EAAE,QAAQ;IAAEC,OAAO,EAAE;EAAgB,CAAC,EAC5C;IAAED,IAAI,EAAE,MAAM;IAAEC,OAAO,EAAE;EAAkB,CAAC,EAC5C;IAAED,IAAI,EAAE,WAAW;IAAEC,OAAO,EAAE;EAAW,CAAC,CAC3C;EAEDC,UAAU,CAAC,YAAY;IACrBX,OAAO,GAAG,IAAAY,mBAAW,EAAC,IAAAC,cAAI,EAAC,IAAAC,cAAM,EAAC,CAAC,EAAE,yBAAyB,CAAC,CAAC;IAChEC,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAC,GAAGhB,OAAO;IAC1CiB,IAAI,CAACC,YAAY,CAAC,CAAC;IAEnB,CAAC;MACCjB,mBAAmB;MACnBC,YAAY;MACZC,eAAe;MACfC,aAAa;MACbC,oBAAoB;MACpBC,oBAAoB;MACpBC;IACF,CAAC,GAAG,MAAAY,OAAA,CAAAC,OAAA,GAAAC,IAAA,OAAA1C,uBAAA,CAAAH,OAAA,CAAa,6BAA6B,GAAC;EACjD,CAAC,CAAC;EAEF8C,SAAS,CAAC,MAAM;IACd,OAAOP,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAC;IACvC,IAAAO,cAAM,EAACvB,OAAO,EAAE;MAAEwB,SAAS,EAAE,IAAI;MAAEC,KAAK,EAAE;IAAK,CAAC,CAAC;EACnD,CAAC,CAAC;EAEFC,EAAE,CAAC,kCAAkC,EAAE,MAAM;IAC3C,MAAMC,OAAO,GAAG1B,mBAAmB,CAAC;MAClC2B,OAAO,EAAE,SAAS;MAClBC,QAAQ,EAAE,QAAQ;MAClBC,KAAK,EAAE,SAAS;MAChBC,aAAa,EAAE,cAAc;MAC7BC,QAAQ,EAAExB,YAAY;MACtByB,KAAK,EAAE;IACT,CAAC,CAAC;IAEFC,MAAM,CAACP,OAAO,CAACQ,EAAE,CAAC,CAACC,UAAU,CAAC,CAAC;IAE/B,MAAMC,QAAQ,GAAGnC,YAAY,CAAC,SAAS,CAAC;IACxCgC,MAAM,CAACG,QAAQ,CAAC,CAACC,YAAY,CAAC,CAAC,CAAC;IAEhC,MAAMC,KAAK,GAAGF,QAAQ,CAAC,CAAC,CAAC;IACzBH,MAAM,CAACK,KAAK,EAAEN,KAAK,CAAC,CAACO,IAAI,CAAC,YAAY,CAAC;IAEvC,MAAMC,MAAM,GAAGtC,eAAe,CAACwB,OAAO,CAACQ,EAAE,CAAC;IAC1CD,MAAM,CAACO,MAAM,EAAET,QAAQ,CAACU,MAAM,CAAC,CAACF,IAAI,CAAChC,YAAY,CAACkC,MAAM,CAAC;IACzDR,MAAM,CAACO,MAAM,EAAEV,aAAa,CAAC,CAACS,IAAI,CAAC,cAAc,CAAC;IAElDN,MAAM,CAAC9B,aAAa,CAACuB,OAAO,CAACQ,EAAE,CAAC,CAAC,CAACK,IAAI,CAAC,IAAI,CAAC;IAC5CN,MAAM,CAAChC,YAAY,CAAC,SAAS,CAAC,CAAC,CAACoC,YAAY,CAAC,CAAC,CAAC;EACjD,CAAC,CAAC;EAEFZ,EAAE,CAAC,6BAA6B,EAAE,MAAM;IACtCrB,oBAAoB,CAAC,SAAS,EAAE;MAC9BwB,QAAQ,EAAE,QAAQ;MAClBC,KAAK,EAAE,SAAS;MAChBC,aAAa,EAAE,cAAc;MAC7BC,QAAQ,EAAExB,YAAY;MACtByB,KAAK,EAAE;IACT,CAAC,CAAC;IAEF,MAAMU,SAAS,GAAGrC,oBAAoB,CAAC,SAAS,CAAC;IACjD4B,MAAM,CAACS,SAAS,EAAEV,KAAK,CAAC,CAACO,IAAI,CAAC,kBAAkB,CAAC;IACjDN,MAAM,CAACS,SAAS,EAAEX,QAAQ,CAAC,CAAC,CAAC,EAAEvB,IAAI,CAAC,CAAC+B,IAAI,CAAC,MAAM,CAAC;IAEjDjC,qBAAqB,CAAC,SAAS,CAAC;IAChC,MAAMqC,OAAO,GAAGtC,oBAAoB,CAAC,SAAS,CAAC;IAC/C4B,MAAM,CAACU,OAAO,CAAC,CAACC,QAAQ,CAAC,CAAC;EAC5B,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}