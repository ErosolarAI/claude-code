5cae5aea9661f3e7e52d23889c740920
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ToolRuntimeUtils = exports.ToolRuntime = void 0;
exports.createDefaultToolRuntime = createDefaultToolRuntime;
exports.reportToolProgress = reportToolProgress;
var _nodeAsync_hooks = require("node:async_hooks");
var _schemaValidator = require("./schemaValidator.js");
var _toolPreconditions = require("./toolPreconditions.js");
var _resultVerification = require("./resultVerification.js");
var _debugLogger = require("../utils/debugLogger.js");
/* eslint-disable @typescript-eslint/no-namespace */

/**
 * Execution context for tool operations with strict TypeScript typing
 */

/**
 * Type-safe tool observer with generic parameter inference for AI flow monitoring
 */

/**
 * Generic tool handler with parameter type inference for AI flow execution
 */

/**
 * Enhanced tool definition with parameter type safety for AI software engineering
 */

/**
 * Collection of related tools grouped by functionality
 */

const toolExecutionContext = new _nodeAsync_hooks.AsyncLocalStorage();

/**
 * Report incremental progress for the currently executing tool.
 * Tools can call this to surface live status updates (e.g., indexing files).
 */
function reportToolProgress(progress) {
  const context = toolExecutionContext.getStore();
  if (!context?.observer?.onToolProgress) {
    return;
  }
  const current = Number.isFinite(progress.current) ? Math.max(0, progress.current) : 0;
  const total = progress.total !== undefined ? Math.max(current, progress.total) : current;
  try {
    context.observer.onToolProgress(context.call, {
      current,
      total,
      message: progress.message
    });
  } catch {
    // Swallow observer errors so they don't break tool execution
  }
}

// Idempotent tools that can be safely cached
const CACHEABLE_TOOLS = new Set(['Read', 'read_file', 'Glob', 'glob_search', 'Grep', 'grep_search', 'find_definition', 'analyze_code_quality', 'extract_exports']);
function buildOptimizationHint(warning) {
  const code = warning.code;
  const suggestion = warning.suggestion || warning.message;
  switch (code) {
    case 'SEARCH_BROAD_PATTERN':
    case 'SEARCH_CONTEXT_OVERFLOW_RISK':
      return `\n\n<optimization-hint>\n` + `⚡ SEARCH: ${suggestion}\n` + `</optimization-hint>`;
    case _toolPreconditions.EDIT_WITHOUT_READ:
    case 'EDIT_PLACEHOLDER':
      return `\n\n<optimization-hint>\n` + `⚡ EDIT: Read the file first to copy exact whitespace. ${suggestion}\n` + `</optimization-hint>`;
    case 'NPM_INCOMPLETE_WORKFLOW':
      return `\n\n<optimization-hint>\n` + `⚡ PUBLISH: ${suggestion}\n` + `</optimization-hint>`;
    default:
      return null;
  }
}

/**
 * Type-safe utility functions for tool runtime operations
 */
let ToolRuntimeUtils = exports.ToolRuntimeUtils = void 0;
(function (_ToolRuntimeUtils) {
  function createToolDefinition(definition) {
    return definition;
  }
  _ToolRuntimeUtils.createToolDefinition = createToolDefinition;
  function createToolSuite(suite) {
    return suite;
  }
  _ToolRuntimeUtils.createToolSuite = createToolSuite;
  function isToolDefinition(__tool, expectedSchema) {
    if (!expectedSchema) return true;
    // In a real implementation, this would validate against the schema
    return true;
  }
  _ToolRuntimeUtils.isToolDefinition = isToolDefinition;
})(ToolRuntimeUtils || (exports.ToolRuntimeUtils = ToolRuntimeUtils = {}));
/**
 * Interface describing the public API of ToolRuntime.
 * Used by wrapper implementations like RestrictedToolRuntime.
 */
class ToolRuntime {
  registry = new Map();
  registrationOrder = [];
  cache = new Map();
  toolHistory = [];
  maxHistorySize = 50; // Keep last 50 tool calls for AI flow pattern detection
  diffSnapshots = [];
  maxDiffSnapshots = 5; // Keep only the most recent git diff outputs
  maxDiffSnapshotLength = 4000;
  constructor(baseTools = [], options = {}) {
    this.observer = options.observer ?? null;
    this.contextManager = options.contextManager ?? null;
    this.enableCache = options.enableCache ?? true;
    this.cacheTTLMs = options.cacheTTLMs ?? 5 * 60 * 1000; // 5 minutes default
    if (baseTools.length) {
      this.registerSuite({
        id: 'runtime.core',
        description: 'Core runtime metadata tools',
        tools: baseTools
      });
    }
  }
  registerSuite(suite) {
    if (!suite?.id?.trim()) {
      throw new Error('Tool suite id cannot be blank.');
    }
    this.unregisterSuite(suite.id);
    for (const definition of suite.tools ?? []) {
      this.addTool(definition, suite.id);
    }
  }
  unregisterSuite(id) {
    if (!id?.trim()) {
      return;
    }
    for (const [name, record] of this.registry.entries()) {
      if (record.suiteId === id) {
        this.registry.delete(name);
        this.removeFromOrder(name);
      }
    }
  }
  listProviderTools() {
    return this.registrationOrder.map(name => this.registry.get(name)).filter(record => Boolean(record)).map(({
      definition
    }) => ({
      name: definition.name,
      description: definition.description,
      ...(definition.parameters && {
        parameters: definition.parameters
      })
    }));
  }
  async execute(call, _context) {
    const record = this.registry.get(call.name);
    const rawArgs = normalizeToolArguments(call.arguments);
    const args = (0, _schemaValidator.coerceToolArguments)(record?.definition.parameters, rawArgs);
    const augmentedCall = {
      ...call,
      args
    };
    if (!record) {
      const message = `Tool "${call.name}" is not available.`;
      this.observer?.onToolError?.(augmentedCall, message);
      // Performance monitoring removed - no legacy components
      return message;
    }

    // Check if tool is cacheable
    const isCacheable = record.definition.cacheable ?? CACHEABLE_TOOLS.has(call.name);
    const cacheTtl = typeof record.definition.cacheTtlMs === 'number' && Number.isFinite(record.definition.cacheTtlMs) ? Math.max(0, Math.floor(record.definition.cacheTtlMs)) : this.cacheTTLMs;
    const canUseCache = this.enableCache && isCacheable && cacheTtl > 0;

    // Try to get from cache
    if (canUseCache) {
      const cacheKey = this.getCacheKey({
        ...call,
        arguments: args
      });
      const cached = this.cache.get(cacheKey);
      if (cached && Date.now() - cached.timestamp < cacheTtl) {
        this.observer?.onCacheHit?.(augmentedCall);
        this.observer?.onToolResult?.(augmentedCall, cached.result);

        // Record cache hit as successful execution with 0ms time
        // Performance monitoring removed - no legacy components
        this.recordToolHistory({
          toolName: call.name,
          args,
          timestamp: Date.now(),
          success: true,
          hasOutput: hasNonEmptyOutput(cached.result)
        });
        return cached.result;
      }
    }
    this.observer?.onToolStart?.(augmentedCall);

    // Performance monitoring removed - no legacy components

    try {
      (0, _schemaValidator.validateToolArguments)(record.definition.name, record.definition.parameters, args);

      // Pre-flight AI flow validation - catch common tool usage failures
      const preflightWarnings = (0, _toolPreconditions.validateToolPreconditions)(call.name, args);
      for (const warning of preflightWarnings) {
        this.observer?.onToolWarning?.(augmentedCall, warning);
      }

      // Advanced AI flow pattern validation using tool history
      const aiFlowWarnings = (0, _toolPreconditions.validateAIFlowPatterns)(call.name, args, this.toolHistory);
      for (const warning of aiFlowWarnings) {
        this.observer?.onToolWarning?.(augmentedCall, warning);
      }

      // Collect optimization hints to inject into result
      const optimizationHints = [];
      const seenOptimizationCodes = new Set();
      for (const warning of [...preflightWarnings, ...aiFlowWarnings]) {
        if (warning.code && seenOptimizationCodes.has(warning.code)) {
          continue;
        }
        const hint = buildOptimizationHint(warning);
        if (hint) {
          if (warning.code) {
            seenOptimizationCodes.add(warning.code);
          }
          optimizationHints.push(hint);
        }
      }
      const result = await toolExecutionContext.run({
        call: augmentedCall,
        observer: this.observer ?? undefined
      }, async () => record.definition.handler(args));
      let output = typeof result === 'string' ? result : JSON.stringify(result, null, 2);
      let snapshotCandidate = output;

      // Truncate output if context manager is available
      if (this.contextManager) {
        const truncated = this.contextManager.truncateToolOutput(output, call.name);
        if (truncated.wasTruncated) {
          output = truncated.content;
          // Log truncation for debugging
          if (process.env['DEBUG_CONTEXT']) {
            (0, _debugLogger.logDebug)(`[Context Manager] Truncated ${call.name} output: ${truncated.originalLength} -> ${truncated.truncatedLength} chars`);
          }
        }
        snapshotCandidate = output;
      }
      this.recordDiffSnapshot(args, snapshotCandidate);

      // Cache the result if cacheable
      if (canUseCache) {
        const cacheKey = this.getCacheKey({
          ...call,
          arguments: args
        });
        this.cache.set(cacheKey, {
          result: output,
          timestamp: Date.now()
        });
      }

      // Append optimization hints to guide future LLM behavior
      if (optimizationHints.length > 0) {
        output = output + optimizationHints.join('');
      }
      this.observer?.onToolResult?.(augmentedCall, output);
      this.recordToolHistory({
        toolName: call.name,
        args,
        timestamp: Date.now(),
        success: true,
        hasOutput: hasNonEmptyOutput(output)
      });

      // Record successful execution
      // Performance monitoring removed - no legacy components
      return output;
    } catch (error) {
      let formatted;
      if (error instanceof _schemaValidator.ToolArgumentValidationError) {
        formatted = error.message;
      } else {
        const message = error instanceof Error ? error.message : String(error);
        formatted = `Failed to run "${call.name}": ${message}`;
      }
      this.observer?.onToolError?.(augmentedCall, formatted);
      this.recordToolHistory({
        toolName: call.name,
        args,
        timestamp: Date.now(),
        success: false,
        hasOutput: hasNonEmptyOutput(formatted),
        error: formatted
      });

      // Record failed execution - no legacy performance monitoring
      return formatted;
    }
  }
  getCacheKey(call) {
    return `${call.name}:${JSON.stringify(call.arguments)}`;
  }
  clearCache() {
    this.cache.clear();
  }
  getCacheStats() {
    let totalSize = 0;
    for (const entry of this.cache.values()) {
      totalSize += entry.result.length;
    }
    return {
      size: totalSize,
      entries: this.cache.size
    };
  }
  clearToolHistory() {
    this.toolHistory.length = 0;
  }
  getToolHistory() {
    return this.toolHistory;
  }
  recordToolHistory(entry) {
    this.toolHistory.push(entry);
    if (this.toolHistory.length > this.maxHistorySize) {
      this.toolHistory.shift();
    }
  }
  clearDiffSnapshots() {
    this.diffSnapshots.length = 0;
  }
  getDiffSnapshots() {
    return this.diffSnapshots;
  }
  addTool(definition, suiteId) {
    if (!definition?.name?.trim()) {
      throw new Error(`Tool names cannot be blank (suite "${suiteId}").`);
    }
    if (this.registry.has(definition.name)) {
      const owner = this.registry.get(definition.name)?.suiteId ?? 'unknown';
      throw new Error(`Tool "${definition.name}" already registered by suite "${owner}".`);
    }
    this.registry.set(definition.name, {
      suiteId,
      definition
    });
    this.registrationOrder.push(definition.name);
  }
  removeFromOrder(name) {
    const index = this.registrationOrder.indexOf(name);
    if (index >= 0) {
      this.registrationOrder.splice(index, 1);
    }
  }
  recordDiffSnapshot(args, output) {
    const command = this.findGitDiffCommand(args);
    if (!command || !output) {
      return;
    }
    this.diffSnapshots.push({
      command,
      output: (0, _resultVerification.safeTruncate)(output, this.maxDiffSnapshotLength, 'git-diff'),
      timestamp: Date.now()
    });
    if (this.diffSnapshots.length > this.maxDiffSnapshots) {
      this.diffSnapshots.shift();
    }
  }
  findGitDiffCommand(args) {
    for (const command of this.extractCommands(args)) {
      if (this.isGitDiffCommand(command)) {
        return command;
      }
    }
    return null;
  }
  extractCommands(args) {
    const commands = [];
    const command = args['command'];
    if (typeof command === 'string' && command.trim()) {
      commands.push(command.trim());
    }
    const commandList = args['commands'];
    if (Array.isArray(commandList)) {
      for (const value of commandList) {
        if (typeof value === 'string' && value.trim()) {
          commands.push(value.trim());
        }
      }
    }
    return commands;
  }
  isGitDiffCommand(command) {
    return /\bgit\s+(?:--no-pager\s+)?(?:diff|show)\b/i.test(command);
  }
}
exports.ToolRuntime = ToolRuntime;
function createDefaultToolRuntime(context, toolSuites = [], options = {}) {
  // Start with no default introspection tools - they waste tokens
  // Model knows its capabilities from tool definitions
  const runtime = new ToolRuntime([], options);
  for (const suite of toolSuites) {
    runtime.registerSuite(suite);
  }
  return runtime;
}

// Removed unused introspection tools (context_snapshot, capabilities_overview, profile_details)
// Model already knows capabilities from tool definitions; these just wasted tokens

function hasNonEmptyOutput(output) {
  return typeof output === 'string' && output.trim().length > 0;
}
function normalizeToolArguments(value) {
  if (value instanceof Map) {
    return Object.fromEntries(value.entries());
  }
  if (isRecord(value)) {
    return value;
  }
  if (typeof value === 'string') {
    const trimmed = value.trim();
    if (!trimmed) {
      return {};
    }
    try {
      const parsed = JSON.parse(trimmed);
      return isRecord(parsed) ? parsed : {};
    } catch {
      return {};
    }
  }
  return {};
}
function isRecord(value) {
  return typeof value === 'object' && value !== null && !Array.isArray(value);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbm9kZUFzeW5jX2hvb2tzIiwicmVxdWlyZSIsIl9zY2hlbWFWYWxpZGF0b3IiLCJfdG9vbFByZWNvbmRpdGlvbnMiLCJfcmVzdWx0VmVyaWZpY2F0aW9uIiwiX2RlYnVnTG9nZ2VyIiwidG9vbEV4ZWN1dGlvbkNvbnRleHQiLCJBc3luY0xvY2FsU3RvcmFnZSIsInJlcG9ydFRvb2xQcm9ncmVzcyIsInByb2dyZXNzIiwiY29udGV4dCIsImdldFN0b3JlIiwib2JzZXJ2ZXIiLCJvblRvb2xQcm9ncmVzcyIsImN1cnJlbnQiLCJOdW1iZXIiLCJpc0Zpbml0ZSIsIk1hdGgiLCJtYXgiLCJ0b3RhbCIsInVuZGVmaW5lZCIsImNhbGwiLCJtZXNzYWdlIiwiQ0FDSEVBQkxFX1RPT0xTIiwiU2V0IiwiYnVpbGRPcHRpbWl6YXRpb25IaW50Iiwid2FybmluZyIsImNvZGUiLCJzdWdnZXN0aW9uIiwiRURJVF9XSVRIT1VUX1JFQUQiLCJUb29sUnVudGltZVV0aWxzIiwiZXhwb3J0cyIsIl9Ub29sUnVudGltZVV0aWxzIiwiY3JlYXRlVG9vbERlZmluaXRpb24iLCJkZWZpbml0aW9uIiwiY3JlYXRlVG9vbFN1aXRlIiwic3VpdGUiLCJpc1Rvb2xEZWZpbml0aW9uIiwiX190b29sIiwiZXhwZWN0ZWRTY2hlbWEiLCJUb29sUnVudGltZSIsInJlZ2lzdHJ5IiwiTWFwIiwicmVnaXN0cmF0aW9uT3JkZXIiLCJjYWNoZSIsInRvb2xIaXN0b3J5IiwibWF4SGlzdG9yeVNpemUiLCJkaWZmU25hcHNob3RzIiwibWF4RGlmZlNuYXBzaG90cyIsIm1heERpZmZTbmFwc2hvdExlbmd0aCIsImNvbnN0cnVjdG9yIiwiYmFzZVRvb2xzIiwib3B0aW9ucyIsImNvbnRleHRNYW5hZ2VyIiwiZW5hYmxlQ2FjaGUiLCJjYWNoZVRUTE1zIiwibGVuZ3RoIiwicmVnaXN0ZXJTdWl0ZSIsImlkIiwiZGVzY3JpcHRpb24iLCJ0b29scyIsInRyaW0iLCJFcnJvciIsInVucmVnaXN0ZXJTdWl0ZSIsImFkZFRvb2wiLCJuYW1lIiwicmVjb3JkIiwiZW50cmllcyIsInN1aXRlSWQiLCJkZWxldGUiLCJyZW1vdmVGcm9tT3JkZXIiLCJsaXN0UHJvdmlkZXJUb29scyIsIm1hcCIsImdldCIsImZpbHRlciIsIkJvb2xlYW4iLCJwYXJhbWV0ZXJzIiwiZXhlY3V0ZSIsIl9jb250ZXh0IiwicmF3QXJncyIsIm5vcm1hbGl6ZVRvb2xBcmd1bWVudHMiLCJhcmd1bWVudHMiLCJhcmdzIiwiY29lcmNlVG9vbEFyZ3VtZW50cyIsImF1Z21lbnRlZENhbGwiLCJvblRvb2xFcnJvciIsImlzQ2FjaGVhYmxlIiwiY2FjaGVhYmxlIiwiaGFzIiwiY2FjaGVUdGwiLCJjYWNoZVR0bE1zIiwiZmxvb3IiLCJjYW5Vc2VDYWNoZSIsImNhY2hlS2V5IiwiZ2V0Q2FjaGVLZXkiLCJjYWNoZWQiLCJEYXRlIiwibm93IiwidGltZXN0YW1wIiwib25DYWNoZUhpdCIsIm9uVG9vbFJlc3VsdCIsInJlc3VsdCIsInJlY29yZFRvb2xIaXN0b3J5IiwidG9vbE5hbWUiLCJzdWNjZXNzIiwiaGFzT3V0cHV0IiwiaGFzTm9uRW1wdHlPdXRwdXQiLCJvblRvb2xTdGFydCIsInZhbGlkYXRlVG9vbEFyZ3VtZW50cyIsInByZWZsaWdodFdhcm5pbmdzIiwidmFsaWRhdGVUb29sUHJlY29uZGl0aW9ucyIsIm9uVG9vbFdhcm5pbmciLCJhaUZsb3dXYXJuaW5ncyIsInZhbGlkYXRlQUlGbG93UGF0dGVybnMiLCJvcHRpbWl6YXRpb25IaW50cyIsInNlZW5PcHRpbWl6YXRpb25Db2RlcyIsImhpbnQiLCJhZGQiLCJwdXNoIiwicnVuIiwiaGFuZGxlciIsIm91dHB1dCIsIkpTT04iLCJzdHJpbmdpZnkiLCJzbmFwc2hvdENhbmRpZGF0ZSIsInRydW5jYXRlZCIsInRydW5jYXRlVG9vbE91dHB1dCIsIndhc1RydW5jYXRlZCIsImNvbnRlbnQiLCJwcm9jZXNzIiwiZW52IiwibG9nRGVidWciLCJvcmlnaW5hbExlbmd0aCIsInRydW5jYXRlZExlbmd0aCIsInJlY29yZERpZmZTbmFwc2hvdCIsInNldCIsImpvaW4iLCJlcnJvciIsImZvcm1hdHRlZCIsIlRvb2xBcmd1bWVudFZhbGlkYXRpb25FcnJvciIsIlN0cmluZyIsImNsZWFyQ2FjaGUiLCJjbGVhciIsImdldENhY2hlU3RhdHMiLCJ0b3RhbFNpemUiLCJlbnRyeSIsInZhbHVlcyIsInNpemUiLCJjbGVhclRvb2xIaXN0b3J5IiwiZ2V0VG9vbEhpc3RvcnkiLCJzaGlmdCIsImNsZWFyRGlmZlNuYXBzaG90cyIsImdldERpZmZTbmFwc2hvdHMiLCJvd25lciIsImluZGV4IiwiaW5kZXhPZiIsInNwbGljZSIsImNvbW1hbmQiLCJmaW5kR2l0RGlmZkNvbW1hbmQiLCJzYWZlVHJ1bmNhdGUiLCJleHRyYWN0Q29tbWFuZHMiLCJpc0dpdERpZmZDb21tYW5kIiwiY29tbWFuZHMiLCJjb21tYW5kTGlzdCIsIkFycmF5IiwiaXNBcnJheSIsInZhbHVlIiwidGVzdCIsImNyZWF0ZURlZmF1bHRUb29sUnVudGltZSIsInRvb2xTdWl0ZXMiLCJydW50aW1lIiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJpc1JlY29yZCIsInRyaW1tZWQiLCJwYXJzZWQiLCJwYXJzZSJdLCJzb3VyY2VzIjpbInRvb2xSdW50aW1lLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby1uYW1lc3BhY2UgKi9cbmltcG9ydCB7IEFzeW5jTG9jYWxTdG9yYWdlIH0gZnJvbSAnbm9kZTphc3luY19ob29rcyc7XG5pbXBvcnQge1xuICB0eXBlIEpTT05TY2hlbWFPYmplY3QsXG4gIHR5cGUgUHJvdmlkZXJJZCxcbiAgdHlwZSBQcm92aWRlclRvb2xEZWZpbml0aW9uLFxuICB0eXBlIFRvb2xDYWxsUmVxdWVzdCxcbn0gZnJvbSAnLi90eXBlcy5qcyc7XG5pbXBvcnQge1xuICBUb29sQXJndW1lbnRWYWxpZGF0aW9uRXJyb3IsXG4gIGNvZXJjZVRvb2xBcmd1bWVudHMsXG4gIHZhbGlkYXRlVG9vbEFyZ3VtZW50cyxcbn0gZnJvbSAnLi9zY2hlbWFWYWxpZGF0b3IuanMnO1xuaW1wb3J0IHsgQ29udGV4dE1hbmFnZXIgfSBmcm9tICcuL2NvbnRleHRNYW5hZ2VyLmpzJztcblxuaW1wb3J0IHsgdmFsaWRhdGVUb29sUHJlY29uZGl0aW9ucywgdmFsaWRhdGVBSUZsb3dQYXR0ZXJucywgRURJVF9XSVRIT1VUX1JFQUQsIHR5cGUgUHJlZmxpZ2h0V2FybmluZyB9IGZyb20gJy4vdG9vbFByZWNvbmRpdGlvbnMuanMnO1xuaW1wb3J0IHsgc2FmZVRydW5jYXRlIH0gZnJvbSAnLi9yZXN1bHRWZXJpZmljYXRpb24uanMnO1xuaW1wb3J0IHsgbG9nRGVidWcgfSBmcm9tICcuLi91dGlscy9kZWJ1Z0xvZ2dlci5qcyc7XG5cbi8qKlxuICogRXhlY3V0aW9uIGNvbnRleHQgZm9yIHRvb2wgb3BlcmF0aW9ucyB3aXRoIHN0cmljdCBUeXBlU2NyaXB0IHR5cGluZ1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFRvb2xFeGVjdXRpb25Db250ZXh0IHtcbiAgcmVhZG9ubHkgcHJvZmlsZU5hbWU6IHN0cmluZztcbiAgcmVhZG9ubHkgcHJvdmlkZXI6IFByb3ZpZGVySWQ7XG4gIHJlYWRvbmx5IG1vZGVsOiBzdHJpbmc7XG4gIHJlYWRvbmx5IHdvcmtzcGFjZUNvbnRleHQ/OiBzdHJpbmcgfCBudWxsO1xufVxuXG4vKipcbiAqIFR5cGUtc2FmZSB0b29sIG9ic2VydmVyIHdpdGggZ2VuZXJpYyBwYXJhbWV0ZXIgaW5mZXJlbmNlIGZvciBBSSBmbG93IG1vbml0b3JpbmdcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBUb29sUnVudGltZU9ic2VydmVyPFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiA9IFJlY29yZDxzdHJpbmcsIHVua25vd24+PiB7XG4gIC8qKiBDYWxsZWQgd2hlbiB0b29sIGV4ZWN1dGlvbiBiZWdpbnMgKi9cbiAgb25Ub29sU3RhcnQ/KGNhbGw6IFRvb2xDYWxsUmVxdWVzdCAmIHsgYXJnczogVCB9KTogdm9pZDtcbiAgXG4gIC8qKiBDYWxsZWQgd2hlbiB0b29sIGV4ZWN1dGlvbiBjb21wbGV0ZXMgc3VjY2Vzc2Z1bGx5ICovXG4gIG9uVG9vbFJlc3VsdD8oY2FsbDogVG9vbENhbGxSZXF1ZXN0ICYgeyBhcmdzOiBUIH0sIG91dHB1dDogc3RyaW5nKTogdm9pZDtcbiAgXG4gIC8qKiBDYWxsZWQgd2hlbiB0b29sIGV4ZWN1dGlvbiBmYWlscyAqL1xuICBvblRvb2xFcnJvcj8oY2FsbDogVG9vbENhbGxSZXF1ZXN0ICYgeyBhcmdzOiBUIH0sIGVycm9yOiBzdHJpbmcpOiB2b2lkO1xuICBcbiAgLyoqIENhbGxlZCB3aGVuIGNhY2hlZCByZXN1bHQgaXMgdXNlZCBpbnN0ZWFkIG9mIGV4ZWN1dGlvbiAqL1xuICBvbkNhY2hlSGl0PyhjYWxsOiBUb29sQ2FsbFJlcXVlc3QgJiB7IGFyZ3M6IFQgfSk6IHZvaWQ7XG4gIFxuICAvKiogQ2FsbGVkIGZvciBwcm9ncmVzcyB1cGRhdGVzIGR1cmluZyBsb25nLXJ1bm5pbmcgb3BlcmF0aW9ucyAqL1xuICBvblRvb2xQcm9ncmVzcz8oY2FsbDogVG9vbENhbGxSZXF1ZXN0ICYgeyBhcmdzOiBUIH0sIHByb2dyZXNzOiBUb29sUHJvZ3Jlc3NVcGRhdGUpOiB2b2lkO1xuICBcbiAgLyoqIENhbGxlZCBmb3IgcHJlLWZsaWdodCB3YXJuaW5ncyBiZWZvcmUgdG9vbCBleGVjdXRpb24gKi9cbiAgb25Ub29sV2FybmluZz8oY2FsbDogVG9vbENhbGxSZXF1ZXN0ICYgeyBhcmdzOiBUIH0sIHdhcm5pbmc6IFByZWZsaWdodFdhcm5pbmcgfCBzdHJpbmcpOiB2b2lkO1xufVxuXG5pbnRlcmZhY2UgVG9vbFJ1bnRpbWVPcHRpb25zIHtcbiAgcmVhZG9ubHkgb2JzZXJ2ZXI/OiBUb29sUnVudGltZU9ic2VydmVyO1xuICByZWFkb25seSBjb250ZXh0TWFuYWdlcj86IENvbnRleHRNYW5hZ2VyO1xuICByZWFkb25seSBlbmFibGVDYWNoZT86IGJvb2xlYW47XG4gIHJlYWRvbmx5IGNhY2hlVFRMTXM/OiBudW1iZXI7XG59XG5cbi8qKlxuICogR2VuZXJpYyB0b29sIGhhbmRsZXIgd2l0aCBwYXJhbWV0ZXIgdHlwZSBpbmZlcmVuY2UgZm9yIEFJIGZsb3cgZXhlY3V0aW9uXG4gKi9cbnR5cGUgVG9vbEhhbmRsZXI8VCBleHRlbmRzIFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0gUmVjb3JkPHN0cmluZywgdW5rbm93bj4+ID0gKFxuICBhcmdzOiBUXG4pID0+IFByb21pc2U8c3RyaW5nPiB8IHN0cmluZztcblxuLyoqXG4gKiBFbmhhbmNlZCB0b29sIGRlZmluaXRpb24gd2l0aCBwYXJhbWV0ZXIgdHlwZSBzYWZldHkgZm9yIEFJIHNvZnR3YXJlIGVuZ2luZWVyaW5nXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVG9vbERlZmluaXRpb248VCBleHRlbmRzIFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0gUmVjb3JkPHN0cmluZywgdW5rbm93bj4+IHtcbiAgLyoqIFVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgdG9vbCAqL1xuICByZWFkb25seSBuYW1lOiBzdHJpbmc7XG4gIFxuICAvKiogSHVtYW4tcmVhZGFibGUgZGVzY3JpcHRpb24gZm9yIEFJIHVuZGVyc3RhbmRpbmcgKi9cbiAgcmVhZG9ubHkgZGVzY3JpcHRpb246IHN0cmluZztcbiAgXG4gIC8qKiBKU09OIFNjaGVtYSBkZWZpbmluZyB0aGUgdG9vbCdzIHBhcmFtZXRlciBzdHJ1Y3R1cmUgKi9cbiAgcmVhZG9ubHkgcGFyYW1ldGVycz86IEpTT05TY2hlbWFPYmplY3Q7XG4gIFxuICAvKiogRnVuY3Rpb24gdGhhdCBpbXBsZW1lbnRzIHRoZSB0b29sJ3MgYmVoYXZpb3IgKi9cbiAgcmVhZG9ubHkgaGFuZGxlcjogVG9vbEhhbmRsZXI8VD47XG4gIFxuICAvKiogV2hldGhlciByZXN1bHRzIGNhbiBiZSBjYWNoZWQgZm9yIHBlcmZvcm1hbmNlIG9wdGltaXphdGlvbiAqL1xuICByZWFkb25seSBjYWNoZWFibGU/OiBib29sZWFuO1xuXG4gIC8qKiBPcHRpb25hbCBwZXItdG9vbCBjYWNoZSBUVEwgaW4gbWlsbGlzZWNvbmRzIChmYWxscyBiYWNrIHRvIHJ1bnRpbWUgZGVmYXVsdCkgKi9cbiAgcmVhZG9ubHkgY2FjaGVUdGxNcz86IG51bWJlcjtcbn1cblxuLyoqXG4gKiBDb2xsZWN0aW9uIG9mIHJlbGF0ZWQgdG9vbHMgZ3JvdXBlZCBieSBmdW5jdGlvbmFsaXR5XG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVG9vbFN1aXRlIHtcbiAgLyoqIFVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgdG9vbCBzdWl0ZSAqL1xuICByZWFkb25seSBpZDogc3RyaW5nO1xuICBcbiAgLyoqIEh1bWFuLXJlYWRhYmxlIGRlc2NyaXB0aW9uIG9mIHRoZSBzdWl0ZSdzIHB1cnBvc2UgKi9cbiAgcmVhZG9ubHkgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIFxuICAvKiogQXJyYXkgb2YgdG9vbCBkZWZpbml0aW9ucyBpbiB0aGlzIHN1aXRlICovXG4gIHJlYWRvbmx5IHRvb2xzOiByZWFkb25seSBUb29sRGVmaW5pdGlvbltdO1xufVxuXG5pbnRlcmZhY2UgVG9vbFJlY29yZCB7XG4gIHN1aXRlSWQ6IHN0cmluZztcbiAgZGVmaW5pdGlvbjogVG9vbERlZmluaXRpb247XG59XG5cbmludGVyZmFjZSBDYWNoZUVudHJ5IHtcbiAgcmVzdWx0OiBzdHJpbmc7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRvb2xIaXN0b3J5RW50cnkge1xuICB0b29sTmFtZTogc3RyaW5nO1xuICBhcmdzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgdGltZXN0YW1wOiBudW1iZXI7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIGhhc091dHB1dDogYm9vbGVhbjtcbiAgZXJyb3I/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGlmZlNuYXBzaG90UmVjb3JkIHtcbiAgY29tbWFuZDogc3RyaW5nO1xuICBvdXRwdXQ6IHN0cmluZztcbiAgdGltZXN0YW1wOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVG9vbFByb2dyZXNzVXBkYXRlIHtcbiAgY3VycmVudDogbnVtYmVyO1xuICB0b3RhbD86IG51bWJlcjtcbiAgbWVzc2FnZT86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIFRvb2xFeGVjdXRpb25TdG9yZSB7XG4gIGNhbGw6IFRvb2xDYWxsUmVxdWVzdCAmIHsgYXJnczogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gfTtcbiAgb2JzZXJ2ZXI/OiBUb29sUnVudGltZU9ic2VydmVyO1xufVxuXG5jb25zdCB0b29sRXhlY3V0aW9uQ29udGV4dCA9IG5ldyBBc3luY0xvY2FsU3RvcmFnZTxUb29sRXhlY3V0aW9uU3RvcmU+KCk7XG5cbi8qKlxuICogUmVwb3J0IGluY3JlbWVudGFsIHByb2dyZXNzIGZvciB0aGUgY3VycmVudGx5IGV4ZWN1dGluZyB0b29sLlxuICogVG9vbHMgY2FuIGNhbGwgdGhpcyB0byBzdXJmYWNlIGxpdmUgc3RhdHVzIHVwZGF0ZXMgKGUuZy4sIGluZGV4aW5nIGZpbGVzKS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlcG9ydFRvb2xQcm9ncmVzcyhwcm9ncmVzczogVG9vbFByb2dyZXNzVXBkYXRlKTogdm9pZCB7XG4gIGNvbnN0IGNvbnRleHQgPSB0b29sRXhlY3V0aW9uQ29udGV4dC5nZXRTdG9yZSgpO1xuICBpZiAoIWNvbnRleHQ/Lm9ic2VydmVyPy5vblRvb2xQcm9ncmVzcykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGN1cnJlbnQgPSBOdW1iZXIuaXNGaW5pdGUocHJvZ3Jlc3MuY3VycmVudCkgPyBNYXRoLm1heCgwLCBwcm9ncmVzcy5jdXJyZW50KSA6IDA7XG4gIGNvbnN0IHRvdGFsID0gcHJvZ3Jlc3MudG90YWwgIT09IHVuZGVmaW5lZCA/IE1hdGgubWF4KGN1cnJlbnQsIHByb2dyZXNzLnRvdGFsKSA6IGN1cnJlbnQ7XG5cbiAgdHJ5IHtcbiAgICBjb250ZXh0Lm9ic2VydmVyLm9uVG9vbFByb2dyZXNzKGNvbnRleHQuY2FsbCwge1xuICAgICAgY3VycmVudCxcbiAgICAgIHRvdGFsLFxuICAgICAgbWVzc2FnZTogcHJvZ3Jlc3MubWVzc2FnZSxcbiAgICB9KTtcbiAgfSBjYXRjaCB7XG4gICAgLy8gU3dhbGxvdyBvYnNlcnZlciBlcnJvcnMgc28gdGhleSBkb24ndCBicmVhayB0b29sIGV4ZWN1dGlvblxuICB9XG59XG5cbi8vIElkZW1wb3RlbnQgdG9vbHMgdGhhdCBjYW4gYmUgc2FmZWx5IGNhY2hlZFxuY29uc3QgQ0FDSEVBQkxFX1RPT0xTID0gbmV3IFNldChbXG4gICdSZWFkJyxcbiAgJ3JlYWRfZmlsZScsXG4gICdHbG9iJyxcbiAgJ2dsb2Jfc2VhcmNoJyxcbiAgJ0dyZXAnLFxuICAnZ3JlcF9zZWFyY2gnLFxuICAnZmluZF9kZWZpbml0aW9uJyxcbiAgJ2FuYWx5emVfY29kZV9xdWFsaXR5JyxcbiAgJ2V4dHJhY3RfZXhwb3J0cycsXG5dKTtcblxuZnVuY3Rpb24gYnVpbGRPcHRpbWl6YXRpb25IaW50KFxuICB3YXJuaW5nOiBQcmVmbGlnaHRXYXJuaW5nIHwgeyBjb2RlPzogc3RyaW5nOyBzdWdnZXN0aW9uPzogc3RyaW5nOyBtZXNzYWdlOiBzdHJpbmcgfVxuKTogc3RyaW5nIHwgbnVsbCB7XG4gIGNvbnN0IGNvZGUgPSB3YXJuaW5nLmNvZGU7XG4gIGNvbnN0IHN1Z2dlc3Rpb24gPSB3YXJuaW5nLnN1Z2dlc3Rpb24gfHwgd2FybmluZy5tZXNzYWdlO1xuXG4gIHN3aXRjaCAoY29kZSkge1xuICAgIGNhc2UgJ1NFQVJDSF9CUk9BRF9QQVRURVJOJzpcbiAgICBjYXNlICdTRUFSQ0hfQ09OVEVYVF9PVkVSRkxPV19SSVNLJzpcbiAgICAgIHJldHVybiAoXG4gICAgICAgIGBcXG5cXG48b3B0aW1pemF0aW9uLWhpbnQ+XFxuYCArXG4gICAgICAgIGDimqEgU0VBUkNIOiAke3N1Z2dlc3Rpb259XFxuYCArXG4gICAgICAgIGA8L29wdGltaXphdGlvbi1oaW50PmBcbiAgICAgICk7XG4gICAgY2FzZSBFRElUX1dJVEhPVVRfUkVBRDpcbiAgICBjYXNlICdFRElUX1BMQUNFSE9MREVSJzpcbiAgICAgIHJldHVybiAoXG4gICAgICAgIGBcXG5cXG48b3B0aW1pemF0aW9uLWhpbnQ+XFxuYCArXG4gICAgICAgIGDimqEgRURJVDogUmVhZCB0aGUgZmlsZSBmaXJzdCB0byBjb3B5IGV4YWN0IHdoaXRlc3BhY2UuICR7c3VnZ2VzdGlvbn1cXG5gICtcbiAgICAgICAgYDwvb3B0aW1pemF0aW9uLWhpbnQ+YFxuICAgICAgKTtcbiAgICBjYXNlICdOUE1fSU5DT01QTEVURV9XT1JLRkxPVyc6XG4gICAgICByZXR1cm4gKFxuICAgICAgICBgXFxuXFxuPG9wdGltaXphdGlvbi1oaW50PlxcbmAgK1xuICAgICAgICBg4pqhIFBVQkxJU0g6ICR7c3VnZ2VzdGlvbn1cXG5gICtcbiAgICAgICAgYDwvb3B0aW1pemF0aW9uLWhpbnQ+YFxuICAgICAgKTtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLyoqXG4gKiBUeXBlLXNhZmUgdXRpbGl0eSBmdW5jdGlvbnMgZm9yIHRvb2wgcnVudGltZSBvcGVyYXRpb25zXG4gKi9cbmV4cG9ydCBuYW1lc3BhY2UgVG9vbFJ1bnRpbWVVdGlscyB7XG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgdHlwZS1zYWZlIHRvb2wgZGVmaW5pdGlvbiB3aXRoIGluZmVycmVkIHBhcmFtZXRlciB0eXBlc1xuICAgKi9cbiAgZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVRvb2xEZWZpbml0aW9uPFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4oXG4gICAgZGVmaW5pdGlvbjogVG9vbERlZmluaXRpb248VD5cbiAgKTogVG9vbERlZmluaXRpb248VD4ge1xuICAgIHJldHVybiBkZWZpbml0aW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSB0eXBlLXNhZmUgdG9vbCBzdWl0ZSB3aXRoIGluZmVycmVkIHRvb2wgdHlwZXNcbiAgICovXG4gIGV4cG9ydCBmdW5jdGlvbiBjcmVhdGVUb29sU3VpdGUoXG4gICAgc3VpdGU6IFRvb2xTdWl0ZVxuICApOiBUb29sU3VpdGUge1xuICAgIHJldHVybiBzdWl0ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUeXBlIGd1YXJkIHRvIGNoZWNrIGlmIGEgdG9vbCBkZWZpbml0aW9uIG1hdGNoZXMgZXhwZWN0ZWQgcGFyYW1ldGVyIHNjaGVtYVxuICAgKi9cbiAgZXhwb3J0IGZ1bmN0aW9uIGlzVG9vbERlZmluaXRpb24oXG4gICAgX190b29sOiBUb29sRGVmaW5pdGlvbixcbiAgICBleHBlY3RlZFNjaGVtYT86IEpTT05TY2hlbWFPYmplY3RcbiAgKTogYm9vbGVhbiB7XG4gICAgaWYgKCFleHBlY3RlZFNjaGVtYSkgcmV0dXJuIHRydWU7XG4gICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIHZhbGlkYXRlIGFnYWluc3QgdGhlIHNjaGVtYVxuICAgIHJldHVybiB0cnVlO1xuICB9XG59XG5cbi8qKlxuICogSW50ZXJmYWNlIGRlc2NyaWJpbmcgdGhlIHB1YmxpYyBBUEkgb2YgVG9vbFJ1bnRpbWUuXG4gKiBVc2VkIGJ5IHdyYXBwZXIgaW1wbGVtZW50YXRpb25zIGxpa2UgUmVzdHJpY3RlZFRvb2xSdW50aW1lLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIElUb29sUnVudGltZSB7XG4gIGxpc3RQcm92aWRlclRvb2xzKCk6IFByb3ZpZGVyVG9vbERlZmluaXRpb25bXTtcbiAgZXhlY3V0ZShjYWxsOiBUb29sQ2FsbFJlcXVlc3QsIGNvbnRleHQ/OiB7IHByb2ZpbGVOYW1lPzogc3RyaW5nOyBwcm92aWRlcj86IHN0cmluZzsgbW9kZWw/OiBzdHJpbmcgfSk6IFByb21pc2U8c3RyaW5nPjtcbiAgcmVnaXN0ZXJTdWl0ZShzdWl0ZTogVG9vbFN1aXRlKTogdm9pZDtcbiAgdW5yZWdpc3RlclN1aXRlKGlkOiBzdHJpbmcpOiB2b2lkO1xuICBjbGVhckNhY2hlKCk6IHZvaWQ7XG4gIGdldENhY2hlU3RhdHMoKTogeyBzaXplOiBudW1iZXI7IGVudHJpZXM6IG51bWJlciB9O1xuICBjbGVhclRvb2xIaXN0b3J5KCk6IHZvaWQ7XG4gIGdldFRvb2xIaXN0b3J5KCk6IHJlYWRvbmx5IFRvb2xIaXN0b3J5RW50cnlbXTtcbiAgY2xlYXJEaWZmU25hcHNob3RzKCk6IHZvaWQ7XG4gIGdldERpZmZTbmFwc2hvdHMoKTogcmVhZG9ubHkgRGlmZlNuYXBzaG90UmVjb3JkW107XG59XG5cbmV4cG9ydCBjbGFzcyBUb29sUnVudGltZSBpbXBsZW1lbnRzIElUb29sUnVudGltZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgcmVnaXN0cnkgPSBuZXcgTWFwPHN0cmluZywgVG9vbFJlY29yZD4oKTtcbiAgcHJpdmF0ZSByZWFkb25seSByZWdpc3RyYXRpb25PcmRlcjogc3RyaW5nW10gPSBbXTtcbiAgcHJpdmF0ZSByZWFkb25seSBvYnNlcnZlcjogVG9vbFJ1bnRpbWVPYnNlcnZlciB8IG51bGw7XG4gIHByaXZhdGUgcmVhZG9ubHkgY29udGV4dE1hbmFnZXI6IENvbnRleHRNYW5hZ2VyIHwgbnVsbDtcbiAgcHJpdmF0ZSByZWFkb25seSBjYWNoZSA9IG5ldyBNYXA8c3RyaW5nLCBDYWNoZUVudHJ5PigpO1xuICBwcml2YXRlIHJlYWRvbmx5IGVuYWJsZUNhY2hlOiBib29sZWFuO1xuICBwcml2YXRlIHJlYWRvbmx5IGNhY2hlVFRMTXM6IG51bWJlcjtcbiAgcHJpdmF0ZSByZWFkb25seSB0b29sSGlzdG9yeTogVG9vbEhpc3RvcnlFbnRyeVtdID0gW107XG4gIHByaXZhdGUgcmVhZG9ubHkgbWF4SGlzdG9yeVNpemUgPSA1MDsgLy8gS2VlcCBsYXN0IDUwIHRvb2wgY2FsbHMgZm9yIEFJIGZsb3cgcGF0dGVybiBkZXRlY3Rpb25cbiAgcHJpdmF0ZSByZWFkb25seSBkaWZmU25hcHNob3RzOiBEaWZmU25hcHNob3RSZWNvcmRbXSA9IFtdO1xuICBwcml2YXRlIHJlYWRvbmx5IG1heERpZmZTbmFwc2hvdHMgPSA1OyAvLyBLZWVwIG9ubHkgdGhlIG1vc3QgcmVjZW50IGdpdCBkaWZmIG91dHB1dHNcbiAgcHJpdmF0ZSByZWFkb25seSBtYXhEaWZmU25hcHNob3RMZW5ndGggPSA0MDAwO1xuXG4gIGNvbnN0cnVjdG9yKGJhc2VUb29sczogVG9vbERlZmluaXRpb25bXSA9IFtdLCBvcHRpb25zOiBUb29sUnVudGltZU9wdGlvbnMgPSB7fSkge1xuICAgIHRoaXMub2JzZXJ2ZXIgPSBvcHRpb25zLm9ic2VydmVyID8/IG51bGw7XG4gICAgdGhpcy5jb250ZXh0TWFuYWdlciA9IG9wdGlvbnMuY29udGV4dE1hbmFnZXIgPz8gbnVsbDtcbiAgICB0aGlzLmVuYWJsZUNhY2hlID0gb3B0aW9ucy5lbmFibGVDYWNoZSA/PyB0cnVlO1xuICAgIHRoaXMuY2FjaGVUVExNcyA9IG9wdGlvbnMuY2FjaGVUVExNcyA/PyA1ICogNjAgKiAxMDAwOyAvLyA1IG1pbnV0ZXMgZGVmYXVsdFxuICAgIGlmIChiYXNlVG9vbHMubGVuZ3RoKSB7XG4gICAgICB0aGlzLnJlZ2lzdGVyU3VpdGUoe1xuICAgICAgICBpZDogJ3J1bnRpbWUuY29yZScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnQ29yZSBydW50aW1lIG1ldGFkYXRhIHRvb2xzJyxcbiAgICAgICAgdG9vbHM6IGJhc2VUb29scyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIHJlZ2lzdGVyU3VpdGUoc3VpdGU6IFRvb2xTdWl0ZSk6IHZvaWQge1xuICAgIGlmICghc3VpdGU/LmlkPy50cmltKCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVG9vbCBzdWl0ZSBpZCBjYW5ub3QgYmUgYmxhbmsuJyk7XG4gICAgfVxuICAgIHRoaXMudW5yZWdpc3RlclN1aXRlKHN1aXRlLmlkKTtcbiAgICBmb3IgKGNvbnN0IGRlZmluaXRpb24gb2Ygc3VpdGUudG9vbHMgPz8gW10pIHtcbiAgICAgIHRoaXMuYWRkVG9vbChkZWZpbml0aW9uLCBzdWl0ZS5pZCk7XG4gICAgfVxuICB9XG5cbiAgdW5yZWdpc3RlclN1aXRlKGlkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAoIWlkPy50cmltKCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZm9yIChjb25zdCBbbmFtZSwgcmVjb3JkXSBvZiB0aGlzLnJlZ2lzdHJ5LmVudHJpZXMoKSkge1xuICAgICAgaWYgKHJlY29yZC5zdWl0ZUlkID09PSBpZCkge1xuICAgICAgICB0aGlzLnJlZ2lzdHJ5LmRlbGV0ZShuYW1lKTtcbiAgICAgICAgdGhpcy5yZW1vdmVGcm9tT3JkZXIobmFtZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgbGlzdFByb3ZpZGVyVG9vbHMoKTogUHJvdmlkZXJUb29sRGVmaW5pdGlvbltdIHtcbiAgICByZXR1cm4gdGhpcy5yZWdpc3RyYXRpb25PcmRlclxuICAgICAgLm1hcCgobmFtZSkgPT4gdGhpcy5yZWdpc3RyeS5nZXQobmFtZSkpXG4gICAgICAuZmlsdGVyKChyZWNvcmQpOiByZWNvcmQgaXMgVG9vbFJlY29yZCA9PiBCb29sZWFuKHJlY29yZCkpXG4gICAgICAubWFwKCh7IGRlZmluaXRpb24gfSkgPT4gKHtcbiAgICAgICAgbmFtZTogZGVmaW5pdGlvbi5uYW1lLFxuICAgICAgICBkZXNjcmlwdGlvbjogZGVmaW5pdGlvbi5kZXNjcmlwdGlvbixcbiAgICAgICAgLi4uKGRlZmluaXRpb24ucGFyYW1ldGVycyAmJiB7IHBhcmFtZXRlcnM6IGRlZmluaXRpb24ucGFyYW1ldGVycyB9KSxcbiAgICAgIH0pKTtcbiAgfVxuXG4gIGFzeW5jIGV4ZWN1dGUoY2FsbDogVG9vbENhbGxSZXF1ZXN0LCBfY29udGV4dD86IHsgcHJvZmlsZU5hbWU/OiBzdHJpbmc7IHByb3ZpZGVyPzogc3RyaW5nOyBtb2RlbD86IHN0cmluZyB9KTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCByZWNvcmQgPSB0aGlzLnJlZ2lzdHJ5LmdldChjYWxsLm5hbWUpO1xuICAgIGNvbnN0IHJhd0FyZ3MgPSBub3JtYWxpemVUb29sQXJndW1lbnRzKGNhbGwuYXJndW1lbnRzKTtcbiAgICBjb25zdCBhcmdzID0gY29lcmNlVG9vbEFyZ3VtZW50cyhyZWNvcmQ/LmRlZmluaXRpb24ucGFyYW1ldGVycywgcmF3QXJncyk7XG4gICAgY29uc3QgYXVnbWVudGVkQ2FsbCA9IHsgLi4uY2FsbCwgYXJncyB9O1xuXG4gICAgaWYgKCFyZWNvcmQpIHtcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSBgVG9vbCBcIiR7Y2FsbC5uYW1lfVwiIGlzIG5vdCBhdmFpbGFibGUuYDtcbiAgICAgIHRoaXMub2JzZXJ2ZXI/Lm9uVG9vbEVycm9yPy4oYXVnbWVudGVkQ2FsbCwgbWVzc2FnZSk7XG4gICAgICAvLyBQZXJmb3JtYW5jZSBtb25pdG9yaW5nIHJlbW92ZWQgLSBubyBsZWdhY3kgY29tcG9uZW50c1xuICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgdG9vbCBpcyBjYWNoZWFibGVcbiAgICBjb25zdCBpc0NhY2hlYWJsZSA9IHJlY29yZC5kZWZpbml0aW9uLmNhY2hlYWJsZSA/PyBDQUNIRUFCTEVfVE9PTFMuaGFzKGNhbGwubmFtZSk7XG4gICAgY29uc3QgY2FjaGVUdGwgPVxuICAgICAgdHlwZW9mIHJlY29yZC5kZWZpbml0aW9uLmNhY2hlVHRsTXMgPT09ICdudW1iZXInICYmIE51bWJlci5pc0Zpbml0ZShyZWNvcmQuZGVmaW5pdGlvbi5jYWNoZVR0bE1zKVxuICAgICAgICA/IE1hdGgubWF4KDAsIE1hdGguZmxvb3IocmVjb3JkLmRlZmluaXRpb24uY2FjaGVUdGxNcykpXG4gICAgICAgIDogdGhpcy5jYWNoZVRUTE1zO1xuICAgIGNvbnN0IGNhblVzZUNhY2hlID0gdGhpcy5lbmFibGVDYWNoZSAmJiBpc0NhY2hlYWJsZSAmJiBjYWNoZVR0bCA+IDA7XG5cbiAgICAvLyBUcnkgdG8gZ2V0IGZyb20gY2FjaGVcbiAgICBpZiAoY2FuVXNlQ2FjaGUpIHtcbiAgICAgIGNvbnN0IGNhY2hlS2V5ID0gdGhpcy5nZXRDYWNoZUtleSh7IC4uLmNhbGwsIGFyZ3VtZW50czogYXJncyB9KTtcbiAgICAgIGNvbnN0IGNhY2hlZCA9IHRoaXMuY2FjaGUuZ2V0KGNhY2hlS2V5KTtcblxuICAgICAgaWYgKGNhY2hlZCAmJiBEYXRlLm5vdygpIC0gY2FjaGVkLnRpbWVzdGFtcCA8IGNhY2hlVHRsKSB7XG4gICAgICAgIHRoaXMub2JzZXJ2ZXI/Lm9uQ2FjaGVIaXQ/LihhdWdtZW50ZWRDYWxsKTtcbiAgICAgICAgdGhpcy5vYnNlcnZlcj8ub25Ub29sUmVzdWx0Py4oYXVnbWVudGVkQ2FsbCwgY2FjaGVkLnJlc3VsdCk7XG5cbiAgICAgICAgLy8gUmVjb3JkIGNhY2hlIGhpdCBhcyBzdWNjZXNzZnVsIGV4ZWN1dGlvbiB3aXRoIDBtcyB0aW1lXG4gICAgICAgIC8vIFBlcmZvcm1hbmNlIG1vbml0b3JpbmcgcmVtb3ZlZCAtIG5vIGxlZ2FjeSBjb21wb25lbnRzXG4gICAgICAgIHRoaXMucmVjb3JkVG9vbEhpc3Rvcnkoe1xuICAgICAgICAgIHRvb2xOYW1lOiBjYWxsLm5hbWUsXG4gICAgICAgICAgYXJncyxcbiAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICBoYXNPdXRwdXQ6IGhhc05vbkVtcHR5T3V0cHV0KGNhY2hlZC5yZXN1bHQpLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGNhY2hlZC5yZXN1bHQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5vYnNlcnZlcj8ub25Ub29sU3RhcnQ/LihhdWdtZW50ZWRDYWxsKTtcblxuICAgIC8vIFBlcmZvcm1hbmNlIG1vbml0b3JpbmcgcmVtb3ZlZCAtIG5vIGxlZ2FjeSBjb21wb25lbnRzXG5cbiAgICB0cnkge1xuICAgICAgdmFsaWRhdGVUb29sQXJndW1lbnRzKHJlY29yZC5kZWZpbml0aW9uLm5hbWUsIHJlY29yZC5kZWZpbml0aW9uLnBhcmFtZXRlcnMsIGFyZ3MpO1xuXG4gICAgICAvLyBQcmUtZmxpZ2h0IEFJIGZsb3cgdmFsaWRhdGlvbiAtIGNhdGNoIGNvbW1vbiB0b29sIHVzYWdlIGZhaWx1cmVzXG4gICAgICBjb25zdCBwcmVmbGlnaHRXYXJuaW5ncyA9IHZhbGlkYXRlVG9vbFByZWNvbmRpdGlvbnMoY2FsbC5uYW1lLCBhcmdzKTtcbiAgICAgIGZvciAoY29uc3Qgd2FybmluZyBvZiBwcmVmbGlnaHRXYXJuaW5ncykge1xuICAgICAgICB0aGlzLm9ic2VydmVyPy5vblRvb2xXYXJuaW5nPy4oYXVnbWVudGVkQ2FsbCwgd2FybmluZyk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkdmFuY2VkIEFJIGZsb3cgcGF0dGVybiB2YWxpZGF0aW9uIHVzaW5nIHRvb2wgaGlzdG9yeVxuICAgICAgY29uc3QgYWlGbG93V2FybmluZ3MgPSB2YWxpZGF0ZUFJRmxvd1BhdHRlcm5zKGNhbGwubmFtZSwgYXJncywgdGhpcy50b29sSGlzdG9yeSk7XG4gICAgICBmb3IgKGNvbnN0IHdhcm5pbmcgb2YgYWlGbG93V2FybmluZ3MpIHtcbiAgICAgICAgdGhpcy5vYnNlcnZlcj8ub25Ub29sV2FybmluZz8uKGF1Z21lbnRlZENhbGwsIHdhcm5pbmcpO1xuICAgICAgfVxuXG4gICAgICAvLyBDb2xsZWN0IG9wdGltaXphdGlvbiBoaW50cyB0byBpbmplY3QgaW50byByZXN1bHRcbiAgICAgIGNvbnN0IG9wdGltaXphdGlvbkhpbnRzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgY29uc3Qgc2Vlbk9wdGltaXphdGlvbkNvZGVzID0gbmV3IFNldDxzdHJpbmc+KCk7XG4gICAgICBmb3IgKGNvbnN0IHdhcm5pbmcgb2YgWy4uLnByZWZsaWdodFdhcm5pbmdzLCAuLi5haUZsb3dXYXJuaW5nc10pIHtcbiAgICAgICAgaWYgKHdhcm5pbmcuY29kZSAmJiBzZWVuT3B0aW1pemF0aW9uQ29kZXMuaGFzKHdhcm5pbmcuY29kZSkpIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBoaW50ID0gYnVpbGRPcHRpbWl6YXRpb25IaW50KHdhcm5pbmcpO1xuICAgICAgICBpZiAoaGludCkge1xuICAgICAgICAgIGlmICh3YXJuaW5nLmNvZGUpIHtcbiAgICAgICAgICAgIHNlZW5PcHRpbWl6YXRpb25Db2Rlcy5hZGQod2FybmluZy5jb2RlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgb3B0aW1pemF0aW9uSGludHMucHVzaChoaW50KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0b29sRXhlY3V0aW9uQ29udGV4dC5ydW4oXG4gICAgICAgIHsgY2FsbDogYXVnbWVudGVkQ2FsbCwgb2JzZXJ2ZXI6IHRoaXMub2JzZXJ2ZXIgPz8gdW5kZWZpbmVkIH0sXG4gICAgICAgIGFzeW5jICgpID0+IHJlY29yZC5kZWZpbml0aW9uLmhhbmRsZXIoYXJncylcbiAgICAgICk7XG4gICAgICBsZXQgb3V0cHV0ID0gdHlwZW9mIHJlc3VsdCA9PT0gJ3N0cmluZycgPyByZXN1bHQgOiBKU09OLnN0cmluZ2lmeShyZXN1bHQsIG51bGwsIDIpO1xuICAgICAgbGV0IHNuYXBzaG90Q2FuZGlkYXRlID0gb3V0cHV0O1xuXG4gICAgICAvLyBUcnVuY2F0ZSBvdXRwdXQgaWYgY29udGV4dCBtYW5hZ2VyIGlzIGF2YWlsYWJsZVxuICAgICAgaWYgKHRoaXMuY29udGV4dE1hbmFnZXIpIHtcbiAgICAgICAgY29uc3QgdHJ1bmNhdGVkID0gdGhpcy5jb250ZXh0TWFuYWdlci50cnVuY2F0ZVRvb2xPdXRwdXQob3V0cHV0LCBjYWxsLm5hbWUpO1xuICAgICAgICBpZiAodHJ1bmNhdGVkLndhc1RydW5jYXRlZCkge1xuICAgICAgICAgIG91dHB1dCA9IHRydW5jYXRlZC5jb250ZW50O1xuICAgICAgICAgIC8vIExvZyB0cnVuY2F0aW9uIGZvciBkZWJ1Z2dpbmdcbiAgICAgICAgICBpZiAocHJvY2Vzcy5lbnZbJ0RFQlVHX0NPTlRFWFQnXSkge1xuICAgICAgICAgICAgbG9nRGVidWcoXG4gICAgICAgICAgICAgIGBbQ29udGV4dCBNYW5hZ2VyXSBUcnVuY2F0ZWQgJHtjYWxsLm5hbWV9IG91dHB1dDogJHt0cnVuY2F0ZWQub3JpZ2luYWxMZW5ndGh9IC0+ICR7dHJ1bmNhdGVkLnRydW5jYXRlZExlbmd0aH0gY2hhcnNgXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBzbmFwc2hvdENhbmRpZGF0ZSA9IG91dHB1dDtcbiAgICAgIH1cblxuICAgICAgdGhpcy5yZWNvcmREaWZmU25hcHNob3QoYXJncywgc25hcHNob3RDYW5kaWRhdGUpO1xuXG4gICAgICAvLyBDYWNoZSB0aGUgcmVzdWx0IGlmIGNhY2hlYWJsZVxuICAgICAgaWYgKGNhblVzZUNhY2hlKSB7XG4gICAgICAgIGNvbnN0IGNhY2hlS2V5ID0gdGhpcy5nZXRDYWNoZUtleSh7IC4uLmNhbGwsIGFyZ3VtZW50czogYXJncyB9KTtcbiAgICAgICAgdGhpcy5jYWNoZS5zZXQoY2FjaGVLZXksIHtcbiAgICAgICAgICByZXN1bHQ6IG91dHB1dCxcbiAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBBcHBlbmQgb3B0aW1pemF0aW9uIGhpbnRzIHRvIGd1aWRlIGZ1dHVyZSBMTE0gYmVoYXZpb3JcbiAgICAgIGlmIChvcHRpbWl6YXRpb25IaW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIG91dHB1dCA9IG91dHB1dCArIG9wdGltaXphdGlvbkhpbnRzLmpvaW4oJycpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLm9ic2VydmVyPy5vblRvb2xSZXN1bHQ/LihhdWdtZW50ZWRDYWxsLCBvdXRwdXQpO1xuXG4gICAgICB0aGlzLnJlY29yZFRvb2xIaXN0b3J5KHtcbiAgICAgICAgdG9vbE5hbWU6IGNhbGwubmFtZSxcbiAgICAgICAgYXJncyxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBoYXNPdXRwdXQ6IGhhc05vbkVtcHR5T3V0cHV0KG91dHB1dCksXG4gICAgICB9KTtcblxuICAgICAgLy8gUmVjb3JkIHN1Y2Nlc3NmdWwgZXhlY3V0aW9uXG4gICAgICAvLyBQZXJmb3JtYW5jZSBtb25pdG9yaW5nIHJlbW92ZWQgLSBubyBsZWdhY3kgY29tcG9uZW50c1xuICAgICAgcmV0dXJuIG91dHB1dDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbGV0IGZvcm1hdHRlZDogc3RyaW5nO1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgVG9vbEFyZ3VtZW50VmFsaWRhdGlvbkVycm9yKSB7XG4gICAgICAgIGZvcm1hdHRlZCA9IGVycm9yLm1lc3NhZ2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBtZXNzYWdlID0gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpO1xuICAgICAgICBmb3JtYXR0ZWQgPSBgRmFpbGVkIHRvIHJ1biBcIiR7Y2FsbC5uYW1lfVwiOiAke21lc3NhZ2V9YDtcbiAgICAgIH1cbiAgICAgIHRoaXMub2JzZXJ2ZXI/Lm9uVG9vbEVycm9yPy4oYXVnbWVudGVkQ2FsbCwgZm9ybWF0dGVkKTtcbiAgICAgIHRoaXMucmVjb3JkVG9vbEhpc3Rvcnkoe1xuICAgICAgICB0b29sTmFtZTogY2FsbC5uYW1lLFxuICAgICAgICBhcmdzLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBoYXNPdXRwdXQ6IGhhc05vbkVtcHR5T3V0cHV0KGZvcm1hdHRlZCksXG4gICAgICAgIGVycm9yOiBmb3JtYXR0ZWQsXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gUmVjb3JkIGZhaWxlZCBleGVjdXRpb24gLSBubyBsZWdhY3kgcGVyZm9ybWFuY2UgbW9uaXRvcmluZ1xuICAgICAgcmV0dXJuIGZvcm1hdHRlZDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldENhY2hlS2V5KGNhbGw6IFRvb2xDYWxsUmVxdWVzdCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGAke2NhbGwubmFtZX06JHtKU09OLnN0cmluZ2lmeShjYWxsLmFyZ3VtZW50cyl9YDtcbiAgfVxuXG4gIGNsZWFyQ2FjaGUoKTogdm9pZCB7XG4gICAgdGhpcy5jYWNoZS5jbGVhcigpO1xuICB9XG5cbiAgZ2V0Q2FjaGVTdGF0cygpOiB7IHNpemU6IG51bWJlcjsgZW50cmllczogbnVtYmVyIH0ge1xuICAgIGxldCB0b3RhbFNpemUgPSAwO1xuICAgIGZvciAoY29uc3QgZW50cnkgb2YgdGhpcy5jYWNoZS52YWx1ZXMoKSkge1xuICAgICAgdG90YWxTaXplICs9IGVudHJ5LnJlc3VsdC5sZW5ndGg7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBzaXplOiB0b3RhbFNpemUsXG4gICAgICBlbnRyaWVzOiB0aGlzLmNhY2hlLnNpemUsXG4gICAgfTtcbiAgfVxuXG4gIGNsZWFyVG9vbEhpc3RvcnkoKTogdm9pZCB7XG4gICAgdGhpcy50b29sSGlzdG9yeS5sZW5ndGggPSAwO1xuICB9XG5cbiAgZ2V0VG9vbEhpc3RvcnkoKTogcmVhZG9ubHkgVG9vbEhpc3RvcnlFbnRyeVtdIHtcbiAgICByZXR1cm4gdGhpcy50b29sSGlzdG9yeTtcbiAgfVxuXG4gIHByaXZhdGUgcmVjb3JkVG9vbEhpc3RvcnkoZW50cnk6IFRvb2xIaXN0b3J5RW50cnkpOiB2b2lkIHtcbiAgICB0aGlzLnRvb2xIaXN0b3J5LnB1c2goZW50cnkpO1xuICAgIGlmICh0aGlzLnRvb2xIaXN0b3J5Lmxlbmd0aCA+IHRoaXMubWF4SGlzdG9yeVNpemUpIHtcbiAgICAgIHRoaXMudG9vbEhpc3Rvcnkuc2hpZnQoKTtcbiAgICB9XG4gIH1cblxuICBjbGVhckRpZmZTbmFwc2hvdHMoKTogdm9pZCB7XG4gICAgdGhpcy5kaWZmU25hcHNob3RzLmxlbmd0aCA9IDA7XG4gIH1cblxuICBnZXREaWZmU25hcHNob3RzKCk6IHJlYWRvbmx5IERpZmZTbmFwc2hvdFJlY29yZFtdIHtcbiAgICByZXR1cm4gdGhpcy5kaWZmU25hcHNob3RzO1xuICB9XG5cbiAgcHJpdmF0ZSBhZGRUb29sKGRlZmluaXRpb246IFRvb2xEZWZpbml0aW9uLCBzdWl0ZUlkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAoIWRlZmluaXRpb24/Lm5hbWU/LnRyaW0oKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUb29sIG5hbWVzIGNhbm5vdCBiZSBibGFuayAoc3VpdGUgXCIke3N1aXRlSWR9XCIpLmApO1xuICAgIH1cbiAgICBpZiAodGhpcy5yZWdpc3RyeS5oYXMoZGVmaW5pdGlvbi5uYW1lKSkge1xuICAgICAgY29uc3Qgb3duZXIgPSB0aGlzLnJlZ2lzdHJ5LmdldChkZWZpbml0aW9uLm5hbWUpPy5zdWl0ZUlkID8/ICd1bmtub3duJztcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVG9vbCBcIiR7ZGVmaW5pdGlvbi5uYW1lfVwiIGFscmVhZHkgcmVnaXN0ZXJlZCBieSBzdWl0ZSBcIiR7b3duZXJ9XCIuYCk7XG4gICAgfVxuICAgIHRoaXMucmVnaXN0cnkuc2V0KGRlZmluaXRpb24ubmFtZSwge1xuICAgICAgc3VpdGVJZCxcbiAgICAgIGRlZmluaXRpb24sXG4gICAgfSk7XG4gICAgdGhpcy5yZWdpc3RyYXRpb25PcmRlci5wdXNoKGRlZmluaXRpb24ubmFtZSk7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZUZyb21PcmRlcihuYW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMucmVnaXN0cmF0aW9uT3JkZXIuaW5kZXhPZihuYW1lKTtcbiAgICBpZiAoaW5kZXggPj0gMCkge1xuICAgICAgdGhpcy5yZWdpc3RyYXRpb25PcmRlci5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcmVjb3JkRGlmZlNuYXBzaG90KGFyZ3M6IFJlY29yZDxzdHJpbmcsIHVua25vd24+LCBvdXRwdXQ6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGNvbW1hbmQgPSB0aGlzLmZpbmRHaXREaWZmQ29tbWFuZChhcmdzKTtcbiAgICBpZiAoIWNvbW1hbmQgfHwgIW91dHB1dCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuZGlmZlNuYXBzaG90cy5wdXNoKHtcbiAgICAgIGNvbW1hbmQsXG4gICAgICBvdXRwdXQ6IHNhZmVUcnVuY2F0ZShvdXRwdXQsIHRoaXMubWF4RGlmZlNuYXBzaG90TGVuZ3RoLCAnZ2l0LWRpZmYnKSxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICB9KTtcblxuICAgIGlmICh0aGlzLmRpZmZTbmFwc2hvdHMubGVuZ3RoID4gdGhpcy5tYXhEaWZmU25hcHNob3RzKSB7XG4gICAgICB0aGlzLmRpZmZTbmFwc2hvdHMuc2hpZnQoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGZpbmRHaXREaWZmQ29tbWFuZChhcmdzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik6IHN0cmluZyB8IG51bGwge1xuICAgIGZvciAoY29uc3QgY29tbWFuZCBvZiB0aGlzLmV4dHJhY3RDb21tYW5kcyhhcmdzKSkge1xuICAgICAgaWYgKHRoaXMuaXNHaXREaWZmQ29tbWFuZChjb21tYW5kKSkge1xuICAgICAgICByZXR1cm4gY29tbWFuZDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBwcml2YXRlIGV4dHJhY3RDb21tYW5kcyhhcmdzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBjb21tYW5kczogc3RyaW5nW10gPSBbXTtcblxuICAgIGNvbnN0IGNvbW1hbmQgPSBhcmdzWydjb21tYW5kJ107XG4gICAgaWYgKHR5cGVvZiBjb21tYW5kID09PSAnc3RyaW5nJyAmJiBjb21tYW5kLnRyaW0oKSkge1xuICAgICAgY29tbWFuZHMucHVzaChjb21tYW5kLnRyaW0oKSk7XG4gICAgfVxuXG4gICAgY29uc3QgY29tbWFuZExpc3QgPSBhcmdzWydjb21tYW5kcyddO1xuICAgIGlmIChBcnJheS5pc0FycmF5KGNvbW1hbmRMaXN0KSkge1xuICAgICAgZm9yIChjb25zdCB2YWx1ZSBvZiBjb21tYW5kTGlzdCkge1xuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJiB2YWx1ZS50cmltKCkpIHtcbiAgICAgICAgICBjb21tYW5kcy5wdXNoKHZhbHVlLnRyaW0oKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY29tbWFuZHM7XG4gIH1cblxuICBwcml2YXRlIGlzR2l0RGlmZkNvbW1hbmQoY29tbWFuZDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIC9cXGJnaXRcXHMrKD86LS1uby1wYWdlclxccyspPyg/OmRpZmZ8c2hvdylcXGIvaS50ZXN0KGNvbW1hbmQpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEZWZhdWx0VG9vbFJ1bnRpbWUoXG4gIGNvbnRleHQ6IFRvb2xFeGVjdXRpb25Db250ZXh0LFxuICB0b29sU3VpdGVzOiBUb29sU3VpdGVbXSA9IFtdLFxuICBvcHRpb25zOiBUb29sUnVudGltZU9wdGlvbnMgPSB7fVxuKTogVG9vbFJ1bnRpbWUge1xuICAvLyBTdGFydCB3aXRoIG5vIGRlZmF1bHQgaW50cm9zcGVjdGlvbiB0b29scyAtIHRoZXkgd2FzdGUgdG9rZW5zXG4gIC8vIE1vZGVsIGtub3dzIGl0cyBjYXBhYmlsaXRpZXMgZnJvbSB0b29sIGRlZmluaXRpb25zXG4gIGNvbnN0IHJ1bnRpbWUgPSBuZXcgVG9vbFJ1bnRpbWUoW10sIG9wdGlvbnMpO1xuXG4gIGZvciAoY29uc3Qgc3VpdGUgb2YgdG9vbFN1aXRlcykge1xuICAgIHJ1bnRpbWUucmVnaXN0ZXJTdWl0ZShzdWl0ZSk7XG4gIH1cblxuICByZXR1cm4gcnVudGltZTtcbn1cblxuLy8gUmVtb3ZlZCB1bnVzZWQgaW50cm9zcGVjdGlvbiB0b29scyAoY29udGV4dF9zbmFwc2hvdCwgY2FwYWJpbGl0aWVzX292ZXJ2aWV3LCBwcm9maWxlX2RldGFpbHMpXG4vLyBNb2RlbCBhbHJlYWR5IGtub3dzIGNhcGFiaWxpdGllcyBmcm9tIHRvb2wgZGVmaW5pdGlvbnM7IHRoZXNlIGp1c3Qgd2FzdGVkIHRva2Vuc1xuXG5mdW5jdGlvbiBoYXNOb25FbXB0eU91dHB1dChvdXRwdXQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICByZXR1cm4gdHlwZW9mIG91dHB1dCA9PT0gJ3N0cmluZycgJiYgb3V0cHV0LnRyaW0oKS5sZW5ndGggPiAwO1xufVxuXG5mdW5jdGlvbiBub3JtYWxpemVUb29sQXJndW1lbnRzKHZhbHVlOiB1bmtub3duKTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4ge1xuICBpZiAodmFsdWUgaW5zdGFuY2VvZiBNYXApIHtcbiAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKHZhbHVlLmVudHJpZXMoKSk7XG4gIH1cbiAgaWYgKGlzUmVjb3JkKHZhbHVlKSkge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xuICAgIGNvbnN0IHRyaW1tZWQgPSB2YWx1ZS50cmltKCk7XG4gICAgaWYgKCF0cmltbWVkKSB7XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKHRyaW1tZWQpO1xuICAgICAgcmV0dXJuIGlzUmVjb3JkKHBhcnNlZCkgPyBwYXJzZWQgOiB7fTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHt9O1xufVxuXG5mdW5jdGlvbiBpc1JlY29yZCh2YWx1ZTogdW5rbm93bik6IHZhbHVlIGlzIFJlY29yZDxzdHJpbmcsIHVua25vd24+IHtcbiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgIT09IG51bGwgJiYgIUFycmF5LmlzQXJyYXkodmFsdWUpO1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUNBLElBQUFBLGdCQUFBLEdBQUFDLE9BQUE7QUFPQSxJQUFBQyxnQkFBQSxHQUFBRCxPQUFBO0FBT0EsSUFBQUUsa0JBQUEsR0FBQUYsT0FBQTtBQUNBLElBQUFHLG1CQUFBLEdBQUFILE9BQUE7QUFDQSxJQUFBSSxZQUFBLEdBQUFKLE9BQUE7QUFqQkE7O0FBbUJBO0FBQ0E7QUFDQTs7QUFRQTtBQUNBO0FBQ0E7O0FBNEJBO0FBQ0E7QUFDQTs7QUFLQTtBQUNBO0FBQ0E7O0FBcUJBO0FBQ0E7QUFDQTs7QUFnREEsTUFBTUssb0JBQW9CLEdBQUcsSUFBSUMsa0NBQWlCLENBQXFCLENBQUM7O0FBRXhFO0FBQ0E7QUFDQTtBQUNBO0FBQ08sU0FBU0Msa0JBQWtCQSxDQUFDQyxRQUE0QixFQUFRO0VBQ3JFLE1BQU1DLE9BQU8sR0FBR0osb0JBQW9CLENBQUNLLFFBQVEsQ0FBQyxDQUFDO0VBQy9DLElBQUksQ0FBQ0QsT0FBTyxFQUFFRSxRQUFRLEVBQUVDLGNBQWMsRUFBRTtJQUN0QztFQUNGO0VBRUEsTUFBTUMsT0FBTyxHQUFHQyxNQUFNLENBQUNDLFFBQVEsQ0FBQ1AsUUFBUSxDQUFDSyxPQUFPLENBQUMsR0FBR0csSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQyxFQUFFVCxRQUFRLENBQUNLLE9BQU8sQ0FBQyxHQUFHLENBQUM7RUFDckYsTUFBTUssS0FBSyxHQUFHVixRQUFRLENBQUNVLEtBQUssS0FBS0MsU0FBUyxHQUFHSCxJQUFJLENBQUNDLEdBQUcsQ0FBQ0osT0FBTyxFQUFFTCxRQUFRLENBQUNVLEtBQUssQ0FBQyxHQUFHTCxPQUFPO0VBRXhGLElBQUk7SUFDRkosT0FBTyxDQUFDRSxRQUFRLENBQUNDLGNBQWMsQ0FBQ0gsT0FBTyxDQUFDVyxJ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