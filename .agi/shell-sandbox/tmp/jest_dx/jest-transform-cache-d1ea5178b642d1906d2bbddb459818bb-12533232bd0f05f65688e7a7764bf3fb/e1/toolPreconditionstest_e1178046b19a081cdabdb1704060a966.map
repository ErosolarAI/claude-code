{"version":3,"names":["_nodeFs","require","_nodeOs","_nodePath","_toolPreconditions","describe","it","warnings","validateAIFlowPatterns","file_path","old_string","expect","some","warning","code","EDIT_WITHOUT_READ","toBe","tempDir","mkdtempSync","join","tmpdir","originalCwd","process","cwd","chdir","relativePath","toolName","args","path","timestamp","Date","now","rmSync","recursive","force"],"sources":["toolPreconditions.test.ts"],"sourcesContent":["import { mkdtempSync, rmSync } from 'node:fs';\nimport { tmpdir } from 'node:os';\nimport { join } from 'node:path';\nimport { EDIT_WITHOUT_READ, validateAIFlowPatterns } from '../src/core/toolPreconditions.js';\n\ndescribe('validateAIFlowPatterns edit/read requirements', () => {\n  it('does not warn when creating a new file without a prior read', () => {\n    const warnings = validateAIFlowPatterns(\n      'Edit',\n      { file_path: '/tmp/new-file.txt', old_string: '' },\n      []\n    );\n\n    expect(warnings.some((warning) => warning.code === EDIT_WITHOUT_READ)).toBe(false);\n  });\n\n  it('recognizes a prior read when paths differ only by relative vs absolute', () => {\n    const tempDir = mkdtempSync(join(tmpdir(), 'preconditions-'));\n    const originalCwd = process.cwd();\n\n    try {\n      process.chdir(tempDir);\n      const relativePath = 'src/example.ts';\n      const warnings = validateAIFlowPatterns(\n        'Edit',\n        { file_path: join(tempDir, relativePath), old_string: 'const x = 1;' },\n        [\n          { toolName: 'read_file', args: { path: relativePath }, timestamp: Date.now() },\n        ]\n      );\n\n      expect(warnings.some((warning) => warning.code === EDIT_WITHOUT_READ)).toBe(false);\n    } finally {\n      process.chdir(originalCwd);\n      rmSync(tempDir, { recursive: true, force: true });\n    }\n  });\n\n  it('recognizes a prior read when history uses file_path key', () => {\n    const warnings = validateAIFlowPatterns(\n      'Edit',\n      { file_path: '/tmp/file-path-key.ts', old_string: 'const y = 2;' },\n      [\n        { toolName: 'read_file', args: { file_path: '/tmp/file-path-key.ts' }, timestamp: Date.now() },\n      ]\n    );\n\n    expect(warnings.some((warning) => warning.code === EDIT_WITHOUT_READ)).toBe(false);\n  });\n\n  it('warns when editing an existing file without any prior read', () => {\n    const warnings = validateAIFlowPatterns(\n      'Edit',\n      { file_path: '/tmp/existing-file.ts', old_string: 'const value = 1;' },\n      []\n    );\n\n    expect(warnings.some((warning) => warning.code === EDIT_WITHOUT_READ)).toBe(true);\n  });\n});\n"],"mappings":";;AAAA,IAAAA,OAAA,GAAAC,OAAA;AACA,IAAAC,OAAA,GAAAD,OAAA;AACA,IAAAE,SAAA,GAAAF,OAAA;AACA,IAAAG,kBAAA,GAAAH,OAAA;AAEAI,QAAQ,CAAC,+CAA+C,EAAE,MAAM;EAC9DC,EAAE,CAAC,6DAA6D,EAAE,MAAM;IACtE,MAAMC,QAAQ,GAAG,IAAAC,yCAAsB,EACrC,MAAM,EACN;MAAEC,SAAS,EAAE,mBAAmB;MAAEC,UAAU,EAAE;IAAG,CAAC,EAClD,EACF,CAAC;IAEDC,MAAM,CAACJ,QAAQ,CAACK,IAAI,CAAEC,OAAO,IAAKA,OAAO,CAACC,IAAI,KAAKC,oCAAiB,CAAC,CAAC,CAACC,IAAI,CAAC,KAAK,CAAC;EACpF,CAAC,CAAC;EAEFV,EAAE,CAAC,wEAAwE,EAAE,MAAM;IACjF,MAAMW,OAAO,GAAG,IAAAC,mBAAW,EAAC,IAAAC,cAAI,EAAC,IAAAC,cAAM,EAAC,CAAC,EAAE,gBAAgB,CAAC,CAAC;IAC7D,MAAMC,WAAW,GAAGC,OAAO,CAACC,GAAG,CAAC,CAAC;IAEjC,IAAI;MACFD,OAAO,CAACE,KAAK,CAACP,OAAO,CAAC;MACtB,MAAMQ,YAAY,GAAG,gBAAgB;MACrC,MAAMlB,QAAQ,GAAG,IAAAC,yCAAsB,EACrC,MAAM,EACN;QAAEC,SAAS,EAAE,IAAAU,cAAI,EAACF,OAAO,EAAEQ,YAAY,CAAC;QAAEf,UAAU,EAAE;MAAe,CAAC,EACtE,CACE;QAAEgB,QAAQ,EAAE,WAAW;QAAEC,IAAI,EAAE;UAAEC,IAAI,EAAEH;QAAa,CAAC;QAAEI,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC;MAAE,CAAC,CAElF,CAAC;MAEDpB,MAAM,CAACJ,QAAQ,CAACK,IAAI,CAAEC,OAAO,IAAKA,OAAO,CAACC,IAAI,KAAKC,oCAAiB,CAAC,CAAC,CAACC,IAAI,CAAC,KAAK,CAAC;IACpF,CAAC,SAAS;MACRM,OAAO,CAACE,KAAK,CAACH,WAAW,CAAC;MAC1B,IAAAW,cAAM,EAACf,OAAO,EAAE;QAAEgB,SAAS,EAAE,IAAI;QAAEC,KAAK,EAAE;MAAK,CAAC,CAAC;IACnD;EACF,CAAC,CAAC;EAEF5B,EAAE,CAAC,yDAAyD,EAAE,MAAM;IAClE,MAAMC,QAAQ,GAAG,IAAAC,yCAAsB,EACrC,MAAM,EACN;MAAEC,SAAS,EAAE,uBAAuB;MAAEC,UAAU,EAAE;IAAe,CAAC,EAClE,CACE;MAAEgB,QAAQ,EAAE,WAAW;MAAEC,IAAI,EAAE;QAAElB,SAAS,EAAE;MAAwB,CAAC;MAAEoB,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC;IAAE,CAAC,CAElG,CAAC;IAEDpB,MAAM,CAACJ,QAAQ,CAACK,IAAI,CAAEC,OAAO,IAAKA,OAAO,CAACC,IAAI,KAAKC,oCAAiB,CAAC,CAAC,CAACC,IAAI,CAAC,KAAK,CAAC;EACpF,CAAC,CAAC;EAEFV,EAAE,CAAC,4DAA4D,EAAE,MAAM;IACrE,MAAMC,QAAQ,GAAG,IAAAC,yCAAsB,EACrC,MAAM,EACN;MAAEC,SAAS,EAAE,uBAAuB;MAAEC,UAAU,EAAE;IAAmB,CAAC,EACtE,EACF,CAAC;IAEDC,MAAM,CAACJ,QAAQ,CAACK,IAAI,CAAEC,OAAO,IAAKA,OAAO,CAACC,IAAI,KAAKC,oCAAiB,CAAC,CAAC,CAACC,IAAI,CAAC,IAAI,CAAC;EACnF,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}