bbd338923df0925dbbc5c83342918bbe
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.UIUpdateCoordinator = void 0;
class UIUpdateCoordinator {
  queue = [];
  flushing = false;
  scheduled = false;
  disposed = false;
  mode = 'idle';
  enqueue(task) {
    if (this.disposed) return;
    this.queue.push(task);
    if (!this.scheduled) {
      this.scheduled = true;
      queueMicrotask(() => void this.flush());
    }
  }
  getMode() {
    return this.mode;
  }
  isDisposed() {
    return this.disposed;
  }
  setMode(mode) {
    this.mode = mode;
  }
  dispose() {
    this.disposed = true;
    this.queue.length = 0;
    this.mode = 'idle';
  }
  async flush() {
    if (this.disposed || this.flushing) {
      this.scheduled = false;
      return;
    }
    this.flushing = true;
    this.scheduled = false;
    this.mode = 'flushing';
    while (this.queue.length && !this.disposed) {
      const task = this.queue.shift();
      if (!task) {
        continue;
      }
      try {
        await task.run();
      } catch {
        // Ignore individual task errors to keep UI updates flowing
      }
    }
    this.flushing = false;
    this.mode = 'idle';

    // In case more tasks were enqueued after the loop ended
    if (this.queue.length && !this.scheduled && !this.disposed) {
      this.scheduled = true;
      queueMicrotask(() => void this.flush());
    }
  }
}
exports.UIUpdateCoordinator = UIUpdateCoordinator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJVSVVwZGF0ZUNvb3JkaW5hdG9yIiwicXVldWUiLCJmbHVzaGluZyIsInNjaGVkdWxlZCIsImRpc3Bvc2VkIiwibW9kZSIsImVucXVldWUiLCJ0YXNrIiwicHVzaCIsInF1ZXVlTWljcm90YXNrIiwiZmx1c2giLCJnZXRNb2RlIiwiaXNEaXNwb3NlZCIsInNldE1vZGUiLCJkaXNwb3NlIiwibGVuZ3RoIiwic2hpZnQiLCJydW4iLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiVUlVcGRhdGVDb29yZGluYXRvci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgaW50ZXJmYWNlIFVJVXBkYXRlVGFzayB7XG4gIGxhbmU6IHN0cmluZztcbiAgcnVuOiAoKSA9PiBQcm9taXNlPHZvaWQ+IHwgdm9pZDtcbn1cblxudHlwZSBNb2RlID0gJ2lkbGUnIHwgJ2ZsdXNoaW5nJztcblxuZXhwb3J0IGNsYXNzIFVJVXBkYXRlQ29vcmRpbmF0b3Ige1xuICBwcml2YXRlIHJlYWRvbmx5IHF1ZXVlOiBVSVVwZGF0ZVRhc2tbXSA9IFtdO1xuICBwcml2YXRlIGZsdXNoaW5nID0gZmFsc2U7XG4gIHByaXZhdGUgc2NoZWR1bGVkID0gZmFsc2U7XG4gIHByaXZhdGUgZGlzcG9zZWQgPSBmYWxzZTtcbiAgcHJpdmF0ZSBtb2RlOiBNb2RlID0gJ2lkbGUnO1xuXG4gIGVucXVldWUodGFzazogVUlVcGRhdGVUYXNrKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuZGlzcG9zZWQpIHJldHVybjtcbiAgICB0aGlzLnF1ZXVlLnB1c2godGFzayk7XG4gICAgaWYgKCF0aGlzLnNjaGVkdWxlZCkge1xuICAgICAgdGhpcy5zY2hlZHVsZWQgPSB0cnVlO1xuICAgICAgcXVldWVNaWNyb3Rhc2soKCkgPT4gdm9pZCB0aGlzLmZsdXNoKCkpO1xuICAgIH1cbiAgfVxuXG4gIGdldE1vZGUoKTogTW9kZSB7XG4gICAgcmV0dXJuIHRoaXMubW9kZTtcbiAgfVxuXG4gIGlzRGlzcG9zZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZGlzcG9zZWQ7XG4gIH1cblxuICBzZXRNb2RlKG1vZGU6IE1vZGUpOiB2b2lkIHtcbiAgICB0aGlzLm1vZGUgPSBtb2RlO1xuICB9XG5cbiAgZGlzcG9zZSgpOiB2b2lkIHtcbiAgICB0aGlzLmRpc3Bvc2VkID0gdHJ1ZTtcbiAgICB0aGlzLnF1ZXVlLmxlbmd0aCA9IDA7XG4gICAgdGhpcy5tb2RlID0gJ2lkbGUnO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBmbHVzaCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAodGhpcy5kaXNwb3NlZCB8fCB0aGlzLmZsdXNoaW5nKSB7XG4gICAgICB0aGlzLnNjaGVkdWxlZCA9IGZhbHNlO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmZsdXNoaW5nID0gdHJ1ZTtcbiAgICB0aGlzLnNjaGVkdWxlZCA9IGZhbHNlO1xuICAgIHRoaXMubW9kZSA9ICdmbHVzaGluZyc7XG5cbiAgICB3aGlsZSAodGhpcy5xdWV1ZS5sZW5ndGggJiYgIXRoaXMuZGlzcG9zZWQpIHtcbiAgICAgIGNvbnN0IHRhc2sgPSB0aGlzLnF1ZXVlLnNoaWZ0KCk7XG4gICAgICBpZiAoIXRhc2spIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0YXNrLnJ1bigpO1xuICAgICAgfSBjYXRjaCB7XG4gICAgICAgIC8vIElnbm9yZSBpbmRpdmlkdWFsIHRhc2sgZXJyb3JzIHRvIGtlZXAgVUkgdXBkYXRlcyBmbG93aW5nXG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5mbHVzaGluZyA9IGZhbHNlO1xuICAgIHRoaXMubW9kZSA9ICdpZGxlJztcblxuICAgIC8vIEluIGNhc2UgbW9yZSB0YXNrcyB3ZXJlIGVucXVldWVkIGFmdGVyIHRoZSBsb29wIGVuZGVkXG4gICAgaWYgKHRoaXMucXVldWUubGVuZ3RoICYmICF0aGlzLnNjaGVkdWxlZCAmJiAhdGhpcy5kaXNwb3NlZCkge1xuICAgICAgdGhpcy5zY2hlZHVsZWQgPSB0cnVlO1xuICAgICAgcXVldWVNaWNyb3Rhc2soKCkgPT4gdm9pZCB0aGlzLmZsdXNoKCkpO1xuICAgIH1cbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFPTyxNQUFNQSxtQkFBbUIsQ0FBQztFQUNkQyxLQUFLLEdBQW1CLEVBQUU7RUFDbkNDLFFBQVEsR0FBRyxLQUFLO0VBQ2hCQyxTQUFTLEdBQUcsS0FBSztFQUNqQkMsUUFBUSxHQUFHLEtBQUs7RUFDaEJDLElBQUksR0FBUyxNQUFNO0VBRTNCQyxPQUFPQSxDQUFDQyxJQUFrQixFQUFRO0lBQ2hDLElBQUksSUFBSSxDQUFDSCxRQUFRLEVBQUU7SUFDbkIsSUFBSSxDQUFDSCxLQUFLLENBQUNPLElBQUksQ0FBQ0QsSUFBSSxDQUFDO0lBQ3JCLElBQUksQ0FBQyxJQUFJLENBQUNKLFNBQVMsRUFBRTtNQUNuQixJQUFJLENBQUNBLFNBQVMsR0FBRyxJQUFJO01BQ3JCTSxjQUFjLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQ0MsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUN6QztFQUNGO0VBRUFDLE9BQU9BLENBQUEsRUFBUztJQUNkLE9BQU8sSUFBSSxDQUFDTixJQUFJO0VBQ2xCO0VBRUFPLFVBQVVBLENBQUEsRUFBWTtJQUNwQixPQUFPLElBQUksQ0FBQ1IsUUFBUTtFQUN0QjtFQUVBUyxPQUFPQSxDQUFDUixJQUFVLEVBQVE7SUFDeEIsSUFBSSxDQUFDQSxJQUFJLEdBQUdBLElBQUk7RUFDbEI7RUFFQVMsT0FBT0EsQ0FBQSxFQUFTO0lBQ2QsSUFBSSxDQUFDVixRQUFRLEdBQUcsSUFBSTtJQUNwQixJQUFJLENBQUNILEtBQUssQ0FBQ2MsTUFBTSxHQUFHLENBQUM7SUFDckIsSUFBSSxDQUFDVixJQUFJLEdBQUcsTUFBTTtFQUNwQjtFQUVBLE1BQWNLLEtBQUtBLENBQUEsRUFBa0I7SUFDbkMsSUFBSSxJQUFJLENBQUNOLFFBQVEsSUFBSSxJQUFJLENBQUNGLFFBQVEsRUFBRTtNQUNsQyxJQUFJLENBQUNDLFNBQVMsR0FBRyxLQUFLO01BQ3RCO0lBQ0Y7SUFDQSxJQUFJLENBQUNELFFBQVEsR0FBRyxJQUFJO0lBQ3BCLElBQUksQ0FBQ0MsU0FBUyxHQUFHLEtBQUs7SUFDdEIsSUFBSSxDQUFDRSxJQUFJLEdBQUcsVUFBVTtJQUV0QixPQUFPLElBQUksQ0FBQ0osS0FBSyxDQUFDYyxNQUFNLElBQUksQ0FBQyxJQUFJLENBQUNYLFFBQVEsRUFBRTtNQUMxQyxNQUFNRyxJQUFJLEdBQUcsSUFBSSxDQUFDTixLQUFLLENBQUNlLEtBQUssQ0FBQyxDQUFDO01BQy9CLElBQUksQ0FBQ1QsSUFBSSxFQUFFO1FBQ1Q7TUFDRjtNQUNBLElBQUk7UUFDRixNQUFNQSxJQUFJLENBQUNVLEdBQUcsQ0FBQyxDQUFDO01BQ2xCLENBQUMsQ0FBQyxNQUFNO1FBQ047TUFBQTtJQUVKO0lBRUEsSUFBSSxDQUFDZixRQUFRLEdBQUcsS0FBSztJQUNyQixJQUFJLENBQUNHLElBQUksR0FBRyxNQUFNOztJQUVsQjtJQUNBLElBQUksSUFBSSxDQUFDSixLQUFLLENBQUNjLE1BQU0sSUFBSSxDQUFDLElBQUksQ0FBQ1osU0FBUyxJQUFJLENBQUMsSUFBSSxDQUFDQyxRQUFRLEVBQUU7TUFDMUQsSUFBSSxDQUFDRCxTQUFTLEdBQUcsSUFBSTtNQUNyQk0sY0FBYyxDQUFDLE1BQU0sS0FBSyxJQUFJLENBQUNDLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDekM7RUFDRjtBQUNGO0FBQUNRLE9BQUEsQ0FBQWxCLG1CQUFBLEdBQUFBLG1CQUFBIiwiaWdub3JlTGlzdCI6W119