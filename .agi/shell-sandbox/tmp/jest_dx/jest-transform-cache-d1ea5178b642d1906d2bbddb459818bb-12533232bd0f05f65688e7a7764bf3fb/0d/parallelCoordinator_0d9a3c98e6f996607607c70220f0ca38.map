{"version":3,"names":["ParallelCoordinator","constructor","createRunner","runModules","context","modules","tasks","map","module","id","label","parallelizable","execute","processModule","runner","batch","reports","result","results","find","m","taskId","report","scope","steps","status","push","continueOnFailure","exports"],"sources":["parallelCoordinator.ts"],"sourcesContent":["import type { ParallelTask, BatchResult } from './parallelExecutor.js';\nimport type { RepoUpgradeModule, UpgradeModuleReport, RepoUpgradeModeDefinition, RepoUpgradeMode } from './repoUpgradeOrchestrator.js';\n\ninterface RunModulesContext {\n  concurrency: number;\n  mode: RepoUpgradeMode;\n  modeDefinition: RepoUpgradeModeDefinition;\n  parallelVariants?: boolean;\n  continueOnFailure: boolean;\n  variantStats: Record<string, unknown>;\n  processModule: (module: RepoUpgradeModule) => Promise<UpgradeModuleReport>;\n  emit: (event: unknown) => void;\n}\n\nexport class ParallelCoordinator {\n  constructor(\n    private readonly createRunner: () => { execute: (tasks: ParallelTask<UpgradeModuleReport>[]) => Promise<BatchResult<UpgradeModuleReport>> }\n  ) {}\n\n  async runModules(context: RunModulesContext, modules: RepoUpgradeModule[]): Promise<UpgradeModuleReport[]> {\n    const tasks: ParallelTask<UpgradeModuleReport>[] = modules.map((module) => ({\n      id: module.id,\n      label: module.label,\n      parallelizable: true,\n      execute: () => context.processModule(module),\n    }));\n\n    const runner = this.createRunner();\n    const batch = await runner.execute(tasks);\n    const reports: UpgradeModuleReport[] = [];\n\n    for (const result of batch.results) {\n      const module = modules.find((m) => m.id === result.taskId);\n      let report: UpgradeModuleReport;\n      if (result.result) {\n        report = result.result;\n      } else {\n        report = {\n          id: module?.id ?? result.taskId,\n          label: module?.label ?? result.taskId,\n          scope: module?.scope ?? [],\n          steps: [],\n          status: result.status === 'completed' ? 'completed' : 'failed',\n        };\n      }\n\n      if (result.status !== 'completed') {\n        report.status = 'failed';\n      }\n\n      reports.push(report);\n\n      if (result.status === 'failed' && !context.continueOnFailure) {\n        break;\n      }\n    }\n\n    return reports;\n  }\n}\n"],"mappings":";;;;;;AAcO,MAAMA,mBAAmB,CAAC;EAC/BC,WAAWA,CACQC,YAA0H,EAC3I;IAAA,KADiBA,YAA0H,GAA1HA,YAA0H;EAC1I;EAEH,MAAMC,UAAUA,CAACC,OAA0B,EAAEC,OAA4B,EAAkC;IACzG,MAAMC,KAA0C,GAAGD,OAAO,CAACE,GAAG,CAAEC,MAAM,KAAM;MAC1EC,EAAE,EAAED,MAAM,CAACC,EAAE;MACbC,KAAK,EAAEF,MAAM,CAACE,KAAK;MACnBC,cAAc,EAAE,IAAI;MACpBC,OAAO,EAAEA,CAAA,KAAMR,OAAO,CAACS,aAAa,CAACL,MAAM;IAC7C,CAAC,CAAC,CAAC;IAEH,MAAMM,MAAM,GAAG,IAAI,CAACZ,YAAY,CAAC,CAAC;IAClC,MAAMa,KAAK,GAAG,MAAMD,MAAM,CAACF,OAAO,CAACN,KAAK,CAAC;IACzC,MAAMU,OAA8B,GAAG,EAAE;IAEzC,KAAK,MAAMC,MAAM,IAAIF,KAAK,CAACG,OAAO,EAAE;MAClC,MAAMV,MAAM,GAAGH,OAAO,CAACc,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACX,EAAE,KAAKQ,MAAM,CAACI,MAAM,CAAC;MAC1D,IAAIC,MAA2B;MAC/B,IAAIL,MAAM,CAACA,MAAM,EAAE;QACjBK,MAAM,GAAGL,MAAM,CAACA,MAAM;MACxB,CAAC,MAAM;QACLK,MAAM,GAAG;UACPb,EAAE,EAAED,MAAM,EAAEC,EAAE,IAAIQ,MAAM,CAACI,MAAM;UAC/BX,KAAK,EAAEF,MAAM,EAAEE,KAAK,IAAIO,MAAM,CAACI,MAAM;UACrCE,KAAK,EAAEf,MAAM,EAAEe,KAAK,IAAI,EAAE;UAC1BC,KAAK,EAAE,EAAE;UACTC,MAAM,EAAER,MAAM,CAACQ,MAAM,KAAK,WAAW,GAAG,WAAW,GAAG;QACxD,CAAC;MACH;MAEA,IAAIR,MAAM,CAACQ,MAAM,KAAK,WAAW,EAAE;QACjCH,MAAM,CAACG,MAAM,GAAG,QAAQ;MAC1B;MAEAT,OAAO,CAACU,IAAI,CAACJ,MAAM,CAAC;MAEpB,IAAIL,MAAM,CAACQ,MAAM,KAAK,QAAQ,IAAI,CAACrB,OAAO,CAACuB,iBAAiB,EAAE;QAC5D;MACF;IACF;IAEA,OAAOX,OAAO;EAChB;AACF;AAACY,OAAA,CAAA5B,mBAAA,GAAAA,mBAAA","ignoreList":[]}