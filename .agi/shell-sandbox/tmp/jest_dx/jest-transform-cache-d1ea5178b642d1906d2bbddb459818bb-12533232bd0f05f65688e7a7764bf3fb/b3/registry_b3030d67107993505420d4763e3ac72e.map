{"version":3,"names":["cov_2otalvqma3","actualCoverage","registry","s","Map","registerToolPlugin","plugin","f","id","trim","b","Error","set","normalizePlugin","unregisterToolPlugin","delete","listRegisteredToolPlugins","Array","from","values","instantiateToolPlugins","target","context","options","modules","supportsTarget","filter","result","create","isArray","entry","push","targets","length","Set","includes"],"sources":["registry.ts"],"sourcesContent":["import type { CapabilityModule } from '../../runtime/agentHost.js';\n\nexport type ToolPluginTarget = 'node' | 'browser' | 'cloud' | 'universal';\n\nexport interface ToolPluginContext {\n  workingDir: string;\n  env: Record<string, string | undefined>;\n}\n\nexport type ToolPluginResult =\n  | CapabilityModule\n  | CapabilityModule[]\n  | null\n  | undefined\n  | Promise<CapabilityModule | CapabilityModule[] | null | undefined>;\n\nexport interface ToolPlugin {\n  id: string;\n  description?: string;\n  targets: ToolPluginTarget[];\n  create(context: ToolPluginContext): ToolPluginResult;\n}\n\ninterface InstantiateOptions {\n  filter?: (plugin: ToolPlugin) => boolean;\n}\n\nconst registry = new Map<string, ToolPlugin>();\n\nexport function registerToolPlugin(plugin: ToolPlugin): void {\n  if (!plugin?.id?.trim()) {\n    throw new Error('Tool plugin id cannot be blank.');\n  }\n  registry.set(plugin.id, normalizePlugin(plugin));\n}\n\nexport function unregisterToolPlugin(id: string): void {\n  registry.delete(id);\n}\n\nexport function listRegisteredToolPlugins(): ToolPlugin[] {\n  return Array.from(registry.values());\n}\n\nexport async function instantiateToolPlugins(\n  target: ToolPluginTarget,\n  context: ToolPluginContext,\n  options: InstantiateOptions = {}\n): Promise<CapabilityModule[]> {\n  const modules: CapabilityModule[] = [];\n\n  for (const plugin of registry.values()) {\n    if (!supportsTarget(plugin, target)) {\n      continue;\n    }\n\n    if (options.filter && !options.filter(plugin)) {\n      continue;\n    }\n\n    const result = await plugin.create(context);\n    if (!result) {\n      continue;\n    }\n\n    if (Array.isArray(result)) {\n      for (const entry of result) {\n        if (entry) {\n          modules.push(entry);\n        }\n      }\n    } else {\n      modules.push(result);\n    }\n  }\n\n  return modules;\n}\n\nfunction normalizePlugin(plugin: ToolPlugin): ToolPlugin {\n  if (!plugin.targets?.length) {\n    return {\n      ...plugin,\n      targets: ['universal'],\n    };\n  }\n\n  return {\n    ...plugin,\n    targets: Array.from(new Set(plugin.targets)),\n  };\n}\n\nfunction supportsTarget(plugin: ToolPlugin, target: ToolPluginTarget): boolean {\n  if (plugin.targets.includes('universal')) {\n    return true;\n  }\n  return plugin.targets.includes(target);\n}\n"],"mappings":"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","ignoreList":[]}