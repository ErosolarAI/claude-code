e7131dc16fe51318372fd503ed9e32cc
"use strict";

var _liveStatus = require("../src/shell/liveStatus");
describe('LiveStatusTracker timing', () => {
  beforeEach(() => {
    jest.useFakeTimers();
    jest.setSystemTime(new Date('2024-01-01T00:00:00Z'));
  });
  afterEach(() => {
    jest.useRealTimers();
  });
  it('preserves startedAt when the base status text stays the same', () => {
    const tracker = new _liveStatus.LiveStatusTracker();
    tracker.setBase('Ready for prompts');
    let current = null;
    const unsubscribe = tracker.subscribe(state => {
      current = state;
    });
    const firstStartedAt = current?.startedAt;

    // Move time forward and update the base status with the same text but new detail
    jest.advanceTimersByTime(1500);
    tracker.setBase('Ready for prompts', {
      detail: 'details change without resetting timer'
    });
    expect(current?.startedAt).toBe(firstStartedAt);
    unsubscribe();
  });
  it('preserves startedAt when updating an existing override with the same text', () => {
    const tracker = new _liveStatus.LiveStatusTracker();
    let current = null;
    tracker.subscribe(state => {
      current = state;
    });
    tracker.pushOverride('streaming', 'Processing');
    const firstStartedAt = current?.startedAt;
    jest.advanceTimersByTime(1200);
    tracker.pushOverride('streaming', 'Processing', {
      detail: 'still running'
    });
    expect(current?.startedAt).toBe(firstStartedAt);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbGl2ZVN0YXR1cyIsInJlcXVpcmUiLCJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJqZXN0IiwidXNlRmFrZVRpbWVycyIsInNldFN5c3RlbVRpbWUiLCJEYXRlIiwiYWZ0ZXJFYWNoIiwidXNlUmVhbFRpbWVycyIsIml0IiwidHJhY2tlciIsIkxpdmVTdGF0dXNUcmFja2VyIiwic2V0QmFzZSIsImN1cnJlbnQiLCJ1bnN1YnNjcmliZSIsInN1YnNjcmliZSIsInN0YXRlIiwiZmlyc3RTdGFydGVkQXQiLCJzdGFydGVkQXQiLCJhZHZhbmNlVGltZXJzQnlUaW1lIiwiZGV0YWlsIiwiZXhwZWN0IiwidG9CZSIsInB1c2hPdmVycmlkZSJdLCJzb3VyY2VzIjpbImxpdmVTdGF0dXMudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMaXZlU3RhdHVzVHJhY2tlciwgdHlwZSBMaXZlU3RhdHVzU3RhdGUgfSBmcm9tICcuLi9zcmMvc2hlbGwvbGl2ZVN0YXR1cyc7XG5cbmRlc2NyaWJlKCdMaXZlU3RhdHVzVHJhY2tlciB0aW1pbmcnLCAoKSA9PiB7XG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QudXNlRmFrZVRpbWVycygpO1xuICAgIGplc3Quc2V0U3lzdGVtVGltZShuZXcgRGF0ZSgnMjAyNC0wMS0wMVQwMDowMDowMFonKSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC51c2VSZWFsVGltZXJzKCk7XG4gIH0pO1xuXG4gIGl0KCdwcmVzZXJ2ZXMgc3RhcnRlZEF0IHdoZW4gdGhlIGJhc2Ugc3RhdHVzIHRleHQgc3RheXMgdGhlIHNhbWUnLCAoKSA9PiB7XG4gICAgY29uc3QgdHJhY2tlciA9IG5ldyBMaXZlU3RhdHVzVHJhY2tlcigpO1xuXG4gICAgdHJhY2tlci5zZXRCYXNlKCdSZWFkeSBmb3IgcHJvbXB0cycpO1xuXG4gICAgbGV0IGN1cnJlbnQ6IExpdmVTdGF0dXNTdGF0ZSB8IG51bGwgPSBudWxsO1xuICAgIGNvbnN0IHVuc3Vic2NyaWJlID0gdHJhY2tlci5zdWJzY3JpYmUoKHN0YXRlKSA9PiB7XG4gICAgICBjdXJyZW50ID0gc3RhdGU7XG4gICAgfSk7XG5cbiAgICBjb25zdCBmaXJzdFN0YXJ0ZWRBdCA9IGN1cnJlbnQ/LnN0YXJ0ZWRBdDtcblxuICAgIC8vIE1vdmUgdGltZSBmb3J3YXJkIGFuZCB1cGRhdGUgdGhlIGJhc2Ugc3RhdHVzIHdpdGggdGhlIHNhbWUgdGV4dCBidXQgbmV3IGRldGFpbFxuICAgIGplc3QuYWR2YW5jZVRpbWVyc0J5VGltZSgxNTAwKTtcbiAgICB0cmFja2VyLnNldEJhc2UoJ1JlYWR5IGZvciBwcm9tcHRzJywgeyBkZXRhaWw6ICdkZXRhaWxzIGNoYW5nZSB3aXRob3V0IHJlc2V0dGluZyB0aW1lcicgfSk7XG5cbiAgICBleHBlY3QoY3VycmVudD8uc3RhcnRlZEF0KS50b0JlKGZpcnN0U3RhcnRlZEF0KTtcblxuICAgIHVuc3Vic2NyaWJlKCk7XG4gIH0pO1xuXG4gIGl0KCdwcmVzZXJ2ZXMgc3RhcnRlZEF0IHdoZW4gdXBkYXRpbmcgYW4gZXhpc3Rpbmcgb3ZlcnJpZGUgd2l0aCB0aGUgc2FtZSB0ZXh0JywgKCkgPT4ge1xuICAgIGNvbnN0IHRyYWNrZXIgPSBuZXcgTGl2ZVN0YXR1c1RyYWNrZXIoKTtcbiAgICBsZXQgY3VycmVudDogTGl2ZVN0YXR1c1N0YXRlIHwgbnVsbCA9IG51bGw7XG5cbiAgICB0cmFja2VyLnN1YnNjcmliZSgoc3RhdGUpID0+IHtcbiAgICAgIGN1cnJlbnQgPSBzdGF0ZTtcbiAgICB9KTtcblxuICAgIHRyYWNrZXIucHVzaE92ZXJyaWRlKCdzdHJlYW1pbmcnLCAnUHJvY2Vzc2luZycpO1xuICAgIGNvbnN0IGZpcnN0U3RhcnRlZEF0ID0gY3VycmVudD8uc3RhcnRlZEF0O1xuXG4gICAgamVzdC5hZHZhbmNlVGltZXJzQnlUaW1lKDEyMDApO1xuICAgIHRyYWNrZXIucHVzaE92ZXJyaWRlKCdzdHJlYW1pbmcnLCAnUHJvY2Vzc2luZycsIHsgZGV0YWlsOiAnc3RpbGwgcnVubmluZycgfSk7XG5cbiAgICBleHBlY3QoY3VycmVudD8uc3RhcnRlZEF0KS50b0JlKGZpcnN0U3RhcnRlZEF0KTtcbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFBQSxXQUFBLEdBQUFDLE9BQUE7QUFFQUMsUUFBUSxDQUFDLDBCQUEwQixFQUFFLE1BQU07RUFDekNDLFVBQVUsQ0FBQyxNQUFNO0lBQ2ZDLElBQUksQ0FBQ0MsYUFBYSxDQUFDLENBQUM7SUFDcEJELElBQUksQ0FBQ0UsYUFBYSxDQUFDLElBQUlDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0VBQ3RELENBQUMsQ0FBQztFQUVGQyxTQUFTLENBQUMsTUFBTTtJQUNkSixJQUFJLENBQUNLLGFBQWEsQ0FBQyxDQUFDO0VBQ3RCLENBQUMsQ0FBQztFQUVGQyxFQUFFLENBQUMsOERBQThELEVBQUUsTUFBTTtJQUN2RSxNQUFNQyxPQUFPLEdBQUcsSUFBSUMsNkJBQWlCLENBQUMsQ0FBQztJQUV2Q0QsT0FBTyxDQUFDRSxPQUFPLENBQUMsbUJBQW1CLENBQUM7SUFFcEMsSUFBSUMsT0FBK0IsR0FBRyxJQUFJO0lBQzFDLE1BQU1DLFdBQVcsR0FBR0osT0FBTyxDQUFDSyxTQUFTLENBQUVDLEtBQUssSUFBSztNQUMvQ0gsT0FBTyxHQUFHRyxLQUFLO0lBQ2pCLENBQUMsQ0FBQztJQUVGLE1BQU1DLGNBQWMsR0FBR0osT0FBTyxFQUFFSyxTQUFTOztJQUV6QztJQUNBZixJQUFJLENBQUNnQixtQkFBbUIsQ0FBQyxJQUFJLENBQUM7SUFDOUJULE9BQU8sQ0FBQ0UsT0FBTyxDQUFDLG1CQUFtQixFQUFFO01BQUVRLE1BQU0sRUFBRTtJQUF5QyxDQUFDLENBQUM7SUFFMUZDLE1BQU0sQ0FBQ1IsT0FBTyxFQUFFSyxTQUFTLENBQUMsQ0FBQ0ksSUFBSSxDQUFDTCxjQUFjLENBQUM7SUFFL0NILFdBQVcsQ0FBQyxDQUFDO0VBQ2YsQ0FBQyxDQUFDO0VBRUZMLEVBQUUsQ0FBQywyRUFBMkUsRUFBRSxNQUFNO0lBQ3BGLE1BQU1DLE9BQU8sR0FBRyxJQUFJQyw2QkFBaUIsQ0FBQyxDQUFDO0lBQ3ZDLElBQUlFLE9BQStCLEdBQUcsSUFBSTtJQUUxQ0gsT0FBTyxDQUFDSyxTQUFTLENBQUVDLEtBQUssSUFBSztNQUMzQkgsT0FBTyxHQUFHRyxLQUFLO0lBQ2pCLENBQUMsQ0FBQztJQUVGTixPQUFPLENBQUNhLFlBQVksQ0FBQyxXQUFXLEVBQUUsWUFBWSxDQUFDO0lBQy9DLE1BQU1OLGNBQWMsR0FBR0osT0FBTyxFQUFFSyxTQUFTO0lBRXpDZixJQUFJLENBQUNnQixtQkFBbUIsQ0FBQyxJQUFJLENBQUM7SUFDOUJULE9BQU8sQ0FBQ2EsWUFBWSxDQUFDLFdBQVcsRUFBRSxZQUFZLEVBQUU7TUFBRUgsTUFBTSxFQUFFO0lBQWdCLENBQUMsQ0FBQztJQUU1RUMsTUFBTSxDQUFDUixPQUFPLEVBQUVLLFNBQVMsQ0FBQyxDQUFDSSxJQUFJLENBQUNMLGNBQWMsQ0FBQztFQUNqRCxDQUFDLENBQUM7QUFDSixDQUFDLENBQUMiLCJpZ25vcmVMaXN0IjpbXX0=