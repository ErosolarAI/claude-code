{"version":3,"names":["_liveStatus","require","describe","beforeEach","jest","useFakeTimers","setSystemTime","Date","afterEach","useRealTimers","it","tracker","LiveStatusTracker","setBase","current","unsubscribe","subscribe","state","firstStartedAt","startedAt","advanceTimersByTime","detail","expect","toBe","pushOverride"],"sources":["liveStatus.test.ts"],"sourcesContent":["import { LiveStatusTracker, type LiveStatusState } from '../src/shell/liveStatus';\n\ndescribe('LiveStatusTracker timing', () => {\n  beforeEach(() => {\n    jest.useFakeTimers();\n    jest.setSystemTime(new Date('2024-01-01T00:00:00Z'));\n  });\n\n  afterEach(() => {\n    jest.useRealTimers();\n  });\n\n  it('preserves startedAt when the base status text stays the same', () => {\n    const tracker = new LiveStatusTracker();\n\n    tracker.setBase('Ready for prompts');\n\n    let current: LiveStatusState | null = null;\n    const unsubscribe = tracker.subscribe((state) => {\n      current = state;\n    });\n\n    const firstStartedAt = current?.startedAt;\n\n    // Move time forward and update the base status with the same text but new detail\n    jest.advanceTimersByTime(1500);\n    tracker.setBase('Ready for prompts', { detail: 'details change without resetting timer' });\n\n    expect(current?.startedAt).toBe(firstStartedAt);\n\n    unsubscribe();\n  });\n\n  it('preserves startedAt when updating an existing override with the same text', () => {\n    const tracker = new LiveStatusTracker();\n    let current: LiveStatusState | null = null;\n\n    tracker.subscribe((state) => {\n      current = state;\n    });\n\n    tracker.pushOverride('streaming', 'Processing');\n    const firstStartedAt = current?.startedAt;\n\n    jest.advanceTimersByTime(1200);\n    tracker.pushOverride('streaming', 'Processing', { detail: 'still running' });\n\n    expect(current?.startedAt).toBe(firstStartedAt);\n  });\n});\n"],"mappings":";;AAAA,IAAAA,WAAA,GAAAC,OAAA;AAEAC,QAAQ,CAAC,0BAA0B,EAAE,MAAM;EACzCC,UAAU,CAAC,MAAM;IACfC,IAAI,CAACC,aAAa,CAAC,CAAC;IACpBD,IAAI,CAACE,aAAa,CAAC,IAAIC,IAAI,CAAC,sBAAsB,CAAC,CAAC;EACtD,CAAC,CAAC;EAEFC,SAAS,CAAC,MAAM;IACdJ,IAAI,CAACK,aAAa,CAAC,CAAC;EACtB,CAAC,CAAC;EAEFC,EAAE,CAAC,8DAA8D,EAAE,MAAM;IACvE,MAAMC,OAAO,GAAG,IAAIC,6BAAiB,CAAC,CAAC;IAEvCD,OAAO,CAACE,OAAO,CAAC,mBAAmB,CAAC;IAEpC,IAAIC,OAA+B,GAAG,IAAI;IAC1C,MAAMC,WAAW,GAAGJ,OAAO,CAACK,SAAS,CAAEC,KAAK,IAAK;MAC/CH,OAAO,GAAGG,KAAK;IACjB,CAAC,CAAC;IAEF,MAAMC,cAAc,GAAGJ,OAAO,EAAEK,SAAS;;IAEzC;IACAf,IAAI,CAACgB,mBAAmB,CAAC,IAAI,CAAC;IAC9BT,OAAO,CAACE,OAAO,CAAC,mBAAmB,EAAE;MAAEQ,MAAM,EAAE;IAAyC,CAAC,CAAC;IAE1FC,MAAM,CAACR,OAAO,EAAEK,SAAS,CAAC,CAACI,IAAI,CAACL,cAAc,CAAC;IAE/CH,WAAW,CAAC,CAAC;EACf,CAAC,CAAC;EAEFL,EAAE,CAAC,2EAA2E,EAAE,MAAM;IACpF,MAAMC,OAAO,GAAG,IAAIC,6BAAiB,CAAC,CAAC;IACvC,IAAIE,OAA+B,GAAG,IAAI;IAE1CH,OAAO,CAACK,SAAS,CAAEC,KAAK,IAAK;MAC3BH,OAAO,GAAGG,KAAK;IACjB,CAAC,CAAC;IAEFN,OAAO,CAACa,YAAY,CAAC,WAAW,EAAE,YAAY,CAAC;IAC/C,MAAMN,cAAc,GAAGJ,OAAO,EAAEK,SAAS;IAEzCf,IAAI,CAACgB,mBAAmB,CAAC,IAAI,CAAC;IAC9BT,OAAO,CAACa,YAAY,CAAC,WAAW,EAAE,YAAY,EAAE;MAAEH,MAAM,EAAE;IAAgB,CAAC,CAAC;IAE5EC,MAAM,CAACR,OAAO,EAAEK,SAAS,CAAC,CAACI,IAAI,CAACL,cAAc,CAAC;EACjD,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}