404d4fd4cc29d9af7141b6b3bb55ece2
"use strict";

var _events = require("events");
var _UnifiedUIRenderer = require("../../src/ui/UnifiedUIRenderer.js");
const makeMockStream = () => {
  const emitter = new _events.EventEmitter();
  const stream = {
    isTTY: false,
    rows: 24,
    columns: 80,
    write: jest.fn(),
    on: emitter.on.bind(emitter),
    off: emitter.off.bind(emitter),
    removeListener: emitter.removeListener.bind(emitter),
    once: emitter.once.bind(emitter),
    emit: emitter.emit.bind(emitter),
    listenerCount: emitter.listenerCount.bind(emitter),
    setMaxListeners: emitter.setMaxListeners.bind(emitter),
    getMaxListeners: emitter.getMaxListeners.bind(emitter),
    resume: jest.fn(),
    pause: jest.fn(),
    setRawMode: jest.fn()
  };
  return stream;
};
const makeLines = count => Array.from({
  length: count
}, (_, index) => `line-${index + 1}`);
describe('inline panel clamping', () => {
  test('UnifiedUIRenderer.limitInlinePanel caps lines and prepends overflow indicator', () => {
    const renderer = new _UnifiedUIRenderer.UnifiedUIRenderer(makeMockStream(), makeMockStream());
    // Simulate a taller terminal to make the math predictable
    renderer.rows = 32;
    const input = makeLines(20);
    const result = renderer.limitInlinePanel(input);
    const expectedMax = Math.max(4, Math.min(renderer.maxInlinePanelLines, Math.max(2, 32 - 8)));
    const expectedTailCount = Math.max(1, expectedMax - 1);
    expect(result[0]).toContain('more lines');
    expect(result.length).toBe(expectedTailCount + 1);
    expect(result.slice(1)).toEqual(input.slice(-expectedTailCount));
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXZlbnRzIiwicmVxdWlyZSIsIl9VbmlmaWVkVUlSZW5kZXJlciIsIm1ha2VNb2NrU3RyZWFtIiwiZW1pdHRlciIsIkV2ZW50RW1pdHRlciIsInN0cmVhbSIsImlzVFRZIiwicm93cyIsImNvbHVtbnMiLCJ3cml0ZSIsImplc3QiLCJmbiIsIm9uIiwiYmluZCIsIm9mZiIsInJlbW92ZUxpc3RlbmVyIiwib25jZSIsImVtaXQiLCJsaXN0ZW5lckNvdW50Iiwic2V0TWF4TGlzdGVuZXJzIiwiZ2V0TWF4TGlzdGVuZXJzIiwicmVzdW1lIiwicGF1c2UiLCJzZXRSYXdNb2RlIiwibWFrZUxpbmVzIiwiY291bnQiLCJBcnJheSIsImZyb20iLCJsZW5ndGgiLCJfIiwiaW5kZXgiLCJkZXNjcmliZSIsInRlc3QiLCJyZW5kZXJlciIsIlVuaWZpZWRVSVJlbmRlcmVyIiwiaW5wdXQiLCJyZXN1bHQiLCJsaW1pdElubGluZVBhbmVsIiwiZXhwZWN0ZWRNYXgiLCJNYXRoIiwibWF4IiwibWluIiwibWF4SW5saW5lUGFuZWxMaW5lcyIsImV4cGVjdGVkVGFpbENvdW50IiwiZXhwZWN0IiwidG9Db250YWluIiwidG9CZSIsInNsaWNlIiwidG9FcXVhbCJdLCJzb3VyY2VzIjpbImlubGluZVBhbmVsLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcbmltcG9ydCB7IFVuaWZpZWRVSVJlbmRlcmVyIH0gZnJvbSAnLi4vLi4vc3JjL3VpL1VuaWZpZWRVSVJlbmRlcmVyLmpzJztcblxudHlwZSBXcml0YWJsZUxpa2UgPSBOb2RlSlMuV3JpdGVTdHJlYW0gJiB7IGlzVFRZPzogYm9vbGVhbjsgcm93cz86IG51bWJlcjsgY29sdW1ucz86IG51bWJlciB9O1xudHlwZSBSZWFkYWJsZUxpa2UgPSBOb2RlSlMuUmVhZFN0cmVhbSAmIHsgaXNUVFk/OiBib29sZWFuIH07XG5cbmNvbnN0IG1ha2VNb2NrU3RyZWFtID0gKCk6IFdyaXRhYmxlTGlrZSAmIFJlYWRhYmxlTGlrZSA9PiB7XG4gIGNvbnN0IGVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIGNvbnN0IHN0cmVhbTogUGFydGlhbDxXcml0YWJsZUxpa2UgJiBSZWFkYWJsZUxpa2U+ID0ge1xuICAgIGlzVFRZOiBmYWxzZSxcbiAgICByb3dzOiAyNCxcbiAgICBjb2x1bW5zOiA4MCxcbiAgICB3cml0ZTogamVzdC5mbigpLFxuICAgIG9uOiBlbWl0dGVyLm9uLmJpbmQoZW1pdHRlciksXG4gICAgb2ZmOiBlbWl0dGVyLm9mZi5iaW5kKGVtaXR0ZXIpLFxuICAgIHJlbW92ZUxpc3RlbmVyOiBlbWl0dGVyLnJlbW92ZUxpc3RlbmVyLmJpbmQoZW1pdHRlciksXG4gICAgb25jZTogZW1pdHRlci5vbmNlLmJpbmQoZW1pdHRlciksXG4gICAgZW1pdDogZW1pdHRlci5lbWl0LmJpbmQoZW1pdHRlciksXG4gICAgbGlzdGVuZXJDb3VudDogZW1pdHRlci5saXN0ZW5lckNvdW50LmJpbmQoZW1pdHRlciksXG4gICAgc2V0TWF4TGlzdGVuZXJzOiBlbWl0dGVyLnNldE1heExpc3RlbmVycy5iaW5kKGVtaXR0ZXIpLFxuICAgIGdldE1heExpc3RlbmVyczogZW1pdHRlci5nZXRNYXhMaXN0ZW5lcnMuYmluZChlbWl0dGVyKSxcbiAgICByZXN1bWU6IGplc3QuZm4oKSxcbiAgICBwYXVzZTogamVzdC5mbigpLFxuICAgIHNldFJhd01vZGU6IGplc3QuZm4oKSxcbiAgfTtcbiAgcmV0dXJuIHN0cmVhbSBhcyBXcml0YWJsZUxpa2UgJiBSZWFkYWJsZUxpa2U7XG59O1xuXG5jb25zdCBtYWtlTGluZXMgPSAoY291bnQ6IG51bWJlcik6IHN0cmluZ1tdID0+XG4gIEFycmF5LmZyb20oeyBsZW5ndGg6IGNvdW50IH0sIChfLCBpbmRleCkgPT4gYGxpbmUtJHtpbmRleCArIDF9YCk7XG5cbmRlc2NyaWJlKCdpbmxpbmUgcGFuZWwgY2xhbXBpbmcnLCAoKSA9PiB7XG4gIHRlc3QoJ1VuaWZpZWRVSVJlbmRlcmVyLmxpbWl0SW5saW5lUGFuZWwgY2FwcyBsaW5lcyBhbmQgcHJlcGVuZHMgb3ZlcmZsb3cgaW5kaWNhdG9yJywgKCkgPT4ge1xuICAgIGNvbnN0IHJlbmRlcmVyID0gbmV3IFVuaWZpZWRVSVJlbmRlcmVyKG1ha2VNb2NrU3RyZWFtKCksIG1ha2VNb2NrU3RyZWFtKCkpO1xuICAgIC8vIFNpbXVsYXRlIGEgdGFsbGVyIHRlcm1pbmFsIHRvIG1ha2UgdGhlIG1hdGggcHJlZGljdGFibGVcbiAgICAocmVuZGVyZXIgYXMgYW55KS5yb3dzID0gMzI7XG5cbiAgICBjb25zdCBpbnB1dCA9IG1ha2VMaW5lcygyMCk7XG4gICAgY29uc3QgcmVzdWx0ID0gKHJlbmRlcmVyIGFzIGFueSkubGltaXRJbmxpbmVQYW5lbChpbnB1dCkgYXMgc3RyaW5nW107XG5cbiAgICBjb25zdCBleHBlY3RlZE1heCA9IE1hdGgubWF4KDQsIE1hdGgubWluKChyZW5kZXJlciBhcyBhbnkpLm1heElubGluZVBhbmVsTGluZXMsIE1hdGgubWF4KDIsIDMyIC0gOCkpKTtcbiAgICBjb25zdCBleHBlY3RlZFRhaWxDb3VudCA9IE1hdGgubWF4KDEsIGV4cGVjdGVkTWF4IC0gMSk7XG5cbiAgICBleHBlY3QocmVzdWx0WzBdKS50b0NvbnRhaW4oJ21vcmUgbGluZXMnKTtcbiAgICBleHBlY3QocmVzdWx0Lmxlbmd0aCkudG9CZShleHBlY3RlZFRhaWxDb3VudCArIDEpO1xuICAgIGV4cGVjdChyZXN1bHQuc2xpY2UoMSkpLnRvRXF1YWwoaW5wdXQuc2xpY2UoLWV4cGVjdGVkVGFpbENvdW50KSk7XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBQUEsT0FBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsa0JBQUEsR0FBQUQsT0FBQTtBQUtBLE1BQU1FLGNBQWMsR0FBR0EsQ0FBQSxLQUFtQztFQUN4RCxNQUFNQyxPQUFPLEdBQUcsSUFBSUMsb0JBQVksQ0FBQyxDQUFDO0VBQ2xD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