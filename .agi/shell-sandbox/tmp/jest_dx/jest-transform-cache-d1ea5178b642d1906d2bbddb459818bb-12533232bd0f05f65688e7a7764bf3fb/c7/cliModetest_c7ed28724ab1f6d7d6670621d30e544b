bc6bf23602cd55b7fb9d259aea789f5d
"use strict";

var _nodeFs = require("node:fs");
var _nodePath = require("node:path");
var _nodeUrl = require("node:url");
var _cliMode = require("../src/bin/cliMode.js");
var _packageInfo = require("../src/utils/packageInfo.js");
describe('detectCliMode', () => {
  it('prefers version flag over other modes', () => {
    const result = (0, _cliMode.detectCliMode)(['--version', '--json', '--self-test']);
    expect(result.mode).toBe('version');
    expect(result.argv).toEqual(['--version', '--json', '--self-test']);
  });
  it('prefers help flag over lower-priority modes', () => {
    const result = (0, _cliMode.detectCliMode)(['-h', '--json']);
    expect(result.mode).toBe('help');
  });
  it('detects self-test, json, and eval modes in order', () => {
    expect((0, _cliMode.detectCliMode)(['--self-test']).mode).toBe('self-test');
    expect((0, _cliMode.detectCliMode)(['--json']).mode).toBe('json');
    expect((0, _cliMode.detectCliMode)(['-e', 'prompt']).mode).toBe('eval');
  });
  it('defaults to shell mode when no flags match', () => {
    expect((0, _cliMode.detectCliMode)(['prompt text']).mode).toBe('shell');
  });
  it('returns a defensive copy of argv', () => {
    const input = ['--json'];
    const result = (0, _cliMode.detectCliMode)(input);
    input.push('--extra');
    expect(result.argv).toEqual(['--json']);
  });
});
describe('readPackageVersion', () => {
  it('reads the nearest package.json version', () => {
    const expected = JSON.parse((0, _nodeFs.readFileSync)((0, _nodePath.resolve)(process.cwd(), 'package.json'), 'utf8')).version;
    const version = (0, _packageInfo.readPackageVersion)((0, _nodeUrl.pathToFileURL)(__filename));
    expect(version).toBe(expected);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbm9kZUZzIiwicmVxdWlyZSIsIl9ub2RlUGF0aCIsIl9ub2RlVXJsIiwiX2NsaU1vZGUiLCJfcGFja2FnZUluZm8iLCJkZXNjcmliZSIsIml0IiwicmVzdWx0IiwiZGV0ZWN0Q2xpTW9kZSIsImV4cGVjdCIsIm1vZGUiLCJ0b0JlIiwiYXJndiIsInRvRXF1YWwiLCJpbnB1dCIsInB1c2giLCJleHBlY3RlZCIsIkpTT04iLCJwYXJzZSIsInJlYWRGaWxlU3luYyIsInJlc29sdmUiLCJwcm9jZXNzIiwiY3dkIiwidmVyc2lvbiIsInJlYWRQYWNrYWdlVmVyc2lvbiIsInBhdGhUb0ZpbGVVUkwiLCJfX2ZpbGVuYW1lIl0sInNvdXJjZXMiOlsiY2xpTW9kZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHJlYWRGaWxlU3luYyB9IGZyb20gJ25vZGU6ZnMnO1xuaW1wb3J0IHsgcmVzb2x2ZSB9IGZyb20gJ25vZGU6cGF0aCc7XG5pbXBvcnQgeyBwYXRoVG9GaWxlVVJMIH0gZnJvbSAnbm9kZTp1cmwnO1xuaW1wb3J0IHsgZGV0ZWN0Q2xpTW9kZSB9IGZyb20gJy4uL3NyYy9iaW4vY2xpTW9kZS5qcyc7XG5pbXBvcnQgeyByZWFkUGFja2FnZVZlcnNpb24gfSBmcm9tICcuLi9zcmMvdXRpbHMvcGFja2FnZUluZm8uanMnO1xuXG5kZXNjcmliZSgnZGV0ZWN0Q2xpTW9kZScsICgpID0+IHtcbiAgaXQoJ3ByZWZlcnMgdmVyc2lvbiBmbGFnIG92ZXIgb3RoZXIgbW9kZXMnLCAoKSA9PiB7XG4gICAgY29uc3QgcmVzdWx0ID0gZGV0ZWN0Q2xpTW9kZShbJy0tdmVyc2lvbicsICctLWpzb24nLCAnLS1zZWxmLXRlc3QnXSk7XG4gICAgZXhwZWN0KHJlc3VsdC5tb2RlKS50b0JlKCd2ZXJzaW9uJyk7XG4gICAgZXhwZWN0KHJlc3VsdC5hcmd2KS50b0VxdWFsKFsnLS12ZXJzaW9uJywgJy0tanNvbicsICctLXNlbGYtdGVzdCddKTtcbiAgfSk7XG5cbiAgaXQoJ3ByZWZlcnMgaGVscCBmbGFnIG92ZXIgbG93ZXItcHJpb3JpdHkgbW9kZXMnLCAoKSA9PiB7XG4gICAgY29uc3QgcmVzdWx0ID0gZGV0ZWN0Q2xpTW9kZShbJy1oJywgJy0tanNvbiddKTtcbiAgICBleHBlY3QocmVzdWx0Lm1vZGUpLnRvQmUoJ2hlbHAnKTtcbiAgfSk7XG5cbiAgaXQoJ2RldGVjdHMgc2VsZi10ZXN0LCBqc29uLCBhbmQgZXZhbCBtb2RlcyBpbiBvcmRlcicsICgpID0+IHtcbiAgICBleHBlY3QoZGV0ZWN0Q2xpTW9kZShbJy0tc2VsZi10ZXN0J10pLm1vZGUpLnRvQmUoJ3NlbGYtdGVzdCcpO1xuICAgIGV4cGVjdChkZXRlY3RDbGlNb2RlKFsnLS1qc29uJ10pLm1vZGUpLnRvQmUoJ2pzb24nKTtcbiAgICBleHBlY3QoZGV0ZWN0Q2xpTW9kZShbJy1lJywgJ3Byb21wdCddKS5tb2RlKS50b0JlKCdldmFsJyk7XG4gIH0pO1xuXG4gIGl0KCdkZWZhdWx0cyB0byBzaGVsbCBtb2RlIHdoZW4gbm8gZmxhZ3MgbWF0Y2gnLCAoKSA9PiB7XG4gICAgZXhwZWN0KGRldGVjdENsaU1vZGUoWydwcm9tcHQgdGV4dCddKS5tb2RlKS50b0JlKCdzaGVsbCcpO1xuICB9KTtcblxuICBpdCgncmV0dXJucyBhIGRlZmVuc2l2ZSBjb3B5IG9mIGFyZ3YnLCAoKSA9PiB7XG4gICAgY29uc3QgaW5wdXQgPSBbJy0tanNvbiddO1xuICAgIGNvbnN0IHJlc3VsdCA9IGRldGVjdENsaU1vZGUoaW5wdXQpO1xuICAgIGlucHV0LnB1c2goJy0tZXh0cmEnKTtcbiAgICBleHBlY3QocmVzdWx0LmFyZ3YpLnRvRXF1YWwoWyctLWpzb24nXSk7XG4gIH0pO1xufSk7XG5cbmRlc2NyaWJlKCdyZWFkUGFja2FnZVZlcnNpb24nLCAoKSA9PiB7XG4gIGl0KCdyZWFkcyB0aGUgbmVhcmVzdCBwYWNrYWdlLmpzb24gdmVyc2lvbicsICgpID0+IHtcbiAgICBjb25zdCBleHBlY3RlZCA9IEpTT04ucGFyc2UoXG4gICAgICByZWFkRmlsZVN5bmMocmVzb2x2ZShwcm9jZXNzLmN3ZCgpLCAncGFja2FnZS5qc29uJyksICd1dGY4JylcbiAgICApLnZlcnNpb247XG4gICAgY29uc3QgdmVyc2lvbiA9IHJlYWRQYWNrYWdlVmVyc2lvbihwYXRoVG9GaWxlVVJMKF9fZmlsZW5hbWUpKTtcbiAgICBleHBlY3QodmVyc2lvbikudG9CZShleHBlY3RlZCk7XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBQUEsT0FBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsU0FBQSxHQUFBRCxPQUFBO0FBQ0EsSUFBQUUsUUFBQSxHQUFBRixPQUFBO0FBQ0EsSUFBQUcsUUFBQSxHQUFBSCxPQUFBO0FBQ0EsSUFBQUksWUFBQSxHQUFBSixPQUFBO0FBRUFLLFFBQVEsQ0FBQyxlQUFlLEVBQUUsTUFBTTtFQUM5QkMsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLE1BQU07SUFDaEQsTUFBTUMsTUFBTSxHQUFHLElBQUFDLHNCQUFhLEVBQUMsQ0FBQyxXQUFXLEVBQUUsUUFBUSxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBQ3BFQyxNQUFNLENBQUNGLE1BQU0sQ0FBQ0csSUFBSSxDQUFDLENBQUNDLElBQUksQ0FBQyxTQUFTLENBQUM7SUFDbkNGLE1BQU0sQ0FBQ0YsTUFBTSxDQUFDSyxJQUFJLENBQUMsQ0FBQ0MsT0FBTyxDQUFDLENBQUMsV0FBVyxFQUFFLFFBQVEsRUFBRSxhQUFhLENBQUMsQ0FBQztFQUNyRSxDQUFDLENBQUM7RUFFRlAsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLE1BQU07SUFDdEQsTUFBTUMsTUFBTSxHQUFHLElBQUFDLHNCQUFhLEVBQUMsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDOUNDLE1BQU0sQ0FBQ0YsTUFBTSxDQUFDRyxJQUFJLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLE1BQU0sQ0FBQztFQUNsQyxDQUFDLENBQUM7RUFFRkwsRUFBRSxDQUFDLGtEQUFrRCxFQUFFLE1BQU07SUFDM0RHLE1BQU0sQ0FBQyxJQUFBRCxzQkFBYSxFQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQ0UsSUFBSSxDQUFDLENBQUNDLElBQUksQ0FBQyxXQUFXLENBQUM7SUFDN0RGLE1BQU0sQ0FBQyxJQUFBRCxzQkFBYSxFQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQ0UsSUFBSSxDQUFDLENBQUNDLElBQUksQ0FBQyxNQUFNLENBQUM7SUFDbkRGLE1BQU0sQ0FBQyxJQUFBRCxzQkFBYSxFQUFDLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUNFLElBQUksQ0FBQyxDQUFDQyxJQUFJLENBQUMsTUFBTSxDQUFDO0VBQzNELENBQUMsQ0FBQztFQUVGTCxFQUFFLENBQUMsNENBQTRDLEVBQUUsTUFBTTtJQUNyREcsTUFBTSxDQUFDLElBQUFELHNCQUFhLEVBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDRSxJQUFJLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLE9BQU8sQ0FBQztFQUMzRCxDQUFDLENBQUM7RUFFRkwsRUFBRSxDQUFDLGtDQUFrQyxFQUFFLE1BQU07SUFDM0MsTUFBTVEsS0FBSyxHQUFHLENBQUMsUUFBUSxDQUFDO0lBQ3hCLE1BQU1QLE1BQU0sR0FBRyxJQUFBQyxzQkFBYSxFQUFDTSxLQUFLLENBQUM7SUFDbkNBLEtBQUssQ0FBQ0MsSUFBSSxDQUFDLFNBQVMsQ0FBQztJQUNyQk4sTUFBTSxDQUFDRixNQUFNLENBQUNLLElBQUksQ0FBQyxDQUFDQyxPQUFPLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQztFQUN6QyxDQUFDLENBQUM7QUFDSixDQUFDLENBQUM7QUFFRlIsUUFBUSxDQUFDLG9CQUFvQixFQUFFLE1BQU07RUFDbkNDLEVBQUUsQ0FBQyx3Q0FBd0MsRUFBRSxNQUFNO0lBQ2pELE1BQU1VLFFBQVEsR0FBR0MsSUFBSSxDQUFDQyxLQUFLLENBQ3pCLElBQUFDLG9CQUFZLEVBQUMsSUFBQUMsaUJBQU8sRUFBQ0MsT0FBTyxDQUFDQyxHQUFHLENBQUMsQ0FBQyxFQUFFLGNBQWMsQ0FBQyxFQUFFLE1BQU0sQ0FDN0QsQ0FBQyxDQUFDQyxPQUFPO0lBQ1QsTUFBTUEsT0FBTyxHQUFHLElBQUFDLCtCQUFrQixFQUFDLElBQUFDLHNCQUFhLEVBQUNDLFVBQVUsQ0FBQyxDQUFDO0lBQzdEakIsTUFBTSxDQUFDYyxPQUFPLENBQUMsQ0FBQ1osSUFBSSxDQUFDSyxRQUFRLENBQUM7RUFDaEMsQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDIiwiaWdub3JlTGlzdCI6W119