273d761f8f88f5c9772b0190e5995198
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.OrchestrationUIBridge = void 0;
var _UIUpdateCoordinator = require("./UIUpdateCoordinator.js");
class OrchestrationUIBridge {
  constructor(options) {
    this.display = options.display;
    this.orchestrator = options.orchestrator;
    this.updateCoordinator = options.updateCoordinator ?? new _UIUpdateCoordinator.UIUpdateCoordinator();
    this.showRealtime = Boolean(options.showRealTimeOutput);
    if (this.orchestrator?.onEvent) {
      this.unsub = this.orchestrator.onEvent(event => this.handleEvent(event));
    }
  }
  async execute(objective) {
    const execConfig = {
      objective
    };
    this.updateCoordinator.setMode('flushing');
    const report = (await this.orchestrator?.execute(execConfig)) ?? {
      id: 'noop',
      objective,
      startTime: Date.now(),
      endTime: Date.now(),
      duration: 0,
      results: [],
      findings: [],
      recommendations: [],
      summary: 'noop',
      success: true
    };
    this.updateCoordinator.setMode('idle');
    return report;
  }
  dispose() {
    this.unsub?.();
  }
  handleEvent(event) {
    if (!this.showRealtime) {
      return;
    }
    const data = event.data;
    let name = '';
    if (data && typeof data === 'object' && 'toolName' in data) {
      name = String(data.toolName);
    }
    this.display.writeRaw(`[${event.type}] ${name}\n`);
    this.updateCoordinator.enqueue({
      lane: 'status',
      run: () => {
        this.display.writeRaw('');
      }
    });
  }
}
exports.OrchestrationUIBridge = OrchestrationUIBridge;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfVUlVcGRhdGVDb29yZGluYXRvciIsInJlcXVpcmUiLCJPcmNoZXN0cmF0aW9uVUlCcmlkZ2UiLCJjb25zdHJ1Y3RvciIsIm9wdGlvbnMiLCJkaXNwbGF5Iiwib3JjaGVzdHJhdG9yIiwidXBkYXRlQ29vcmRpbmF0b3IiLCJVSVVwZGF0ZUNvb3JkaW5hdG9yIiwic2hvd1JlYWx0aW1lIiwiQm9vbGVhbiIsInNob3dSZWFsVGltZU91dHB1dCIsIm9uRXZlbnQiLCJ1bnN1YiIsImV2ZW50IiwiaGFuZGxlRXZlbnQiLCJleGVjdXRlIiwib2JqZWN0aXZlIiwiZXhlY0NvbmZpZyIsInNldE1vZGUiLCJyZXBvcnQiLCJpZCIsInN0YXJ0VGltZSIsIkRhdGUiLCJub3ciLCJlbmRUaW1lIiwiZHVyYXRpb24iLCJyZXN1bHRzIiwiZmluZGluZ3MiLCJyZWNvbW1lbmRhdGlvbnMiLCJzdW1tYXJ5Iiwic3VjY2VzcyIsImRpc3Bvc2UiLCJkYXRhIiwibmFtZSIsIlN0cmluZyIsInRvb2xOYW1lIiwid3JpdGVSYXciLCJ0eXBlIiwiZW5xdWV1ZSIsImxhbmUiLCJydW4iLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiT3JjaGVzdHJhdGlvblVJQnJpZGdlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgT3JjaGVzdHJhdG9yRXZlbnQsIE9wZXJhdGlvbkNvbmZpZywgT3BlcmF0aW9uUmVwb3J0LCBVbmlmaWVkT3JjaGVzdHJhdG9yIH0gZnJvbSAnLi4vLi4vY29yZS91bmlmaWVkT3JjaGVzdHJhdG9yLmpzJztcbmltcG9ydCB7IFVJVXBkYXRlQ29vcmRpbmF0b3IgfSBmcm9tICcuL1VJVXBkYXRlQ29vcmRpbmF0b3IuanMnO1xuXG5pbnRlcmZhY2UgRGlzcGxheSB7XG4gIHdyaXRlUmF3KHRleHQ6IHN0cmluZyk6IHZvaWQ7XG4gIHNob3dFcnJvcih0aXRsZTogc3RyaW5nLCBlcnJvcjogdW5rbm93bik6IHZvaWQ7XG4gIHNob3dTeXN0ZW1NZXNzYWdlKG1lc3NhZ2U6IHN0cmluZyk6IHZvaWQ7XG59XG5cbmludGVyZmFjZSBCcmlkZ2VPcHRpb25zIHtcbiAgZGlzcGxheTogRGlzcGxheTtcbiAgdXBkYXRlQ29vcmRpbmF0b3I/OiBVSVVwZGF0ZUNvb3JkaW5hdG9yO1xuICBvcmNoZXN0cmF0b3I/OiBVbmlmaWVkT3JjaGVzdHJhdG9yO1xuICBzaG93UmVhbFRpbWVPdXRwdXQ/OiBib29sZWFuO1xuICBzaG93UHJvZ3Jlc3NCYXI/OiBib29sZWFuO1xuICB2ZXJib3NlTW9kZT86IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjbGFzcyBPcmNoZXN0cmF0aW9uVUlCcmlkZ2Uge1xuICBwcml2YXRlIHJlYWRvbmx5IGRpc3BsYXk6IERpc3BsYXk7XG4gIHByaXZhdGUgcmVhZG9ubHkgb3JjaGVzdHJhdG9yOiBVbmlmaWVkT3JjaGVzdHJhdG9yIHwgdW5kZWZpbmVkO1xuICBwcml2YXRlIHJlYWRvbmx5IHVwZGF0ZUNvb3JkaW5hdG9yOiBVSVVwZGF0ZUNvb3JkaW5hdG9yO1xuICBwcml2YXRlIHJlYWRvbmx5IHNob3dSZWFsdGltZTogYm9vbGVhbjtcbiAgcHJpdmF0ZSB1bnN1Yj86ICgpID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3Iob3B0aW9uczogQnJpZGdlT3B0aW9ucykge1xuICAgIHRoaXMuZGlzcGxheSA9IG9wdGlvbnMuZGlzcGxheTtcbiAgICB0aGlzLm9yY2hlc3RyYXRvciA9IG9wdGlvbnMub3JjaGVzdHJhdG9yO1xuICAgIHRoaXMudXBkYXRlQ29vcmRpbmF0b3IgPSBvcHRpb25zLnVwZGF0ZUNvb3JkaW5hdG9yID8/IG5ldyBVSVVwZGF0ZUNvb3JkaW5hdG9yKCk7XG4gICAgdGhpcy5zaG93UmVhbHRpbWUgPSBCb29sZWFuKG9wdGlvbnMuc2hvd1JlYWxUaW1lT3V0cHV0KTtcblxuICAgIGlmICh0aGlzLm9yY2hlc3RyYXRvcj8ub25FdmVudCkge1xuICAgICAgdGhpcy51bnN1YiA9IHRoaXMub3JjaGVzdHJhdG9yLm9uRXZlbnQoKGV2ZW50KSA9PiB0aGlzLmhhbmRsZUV2ZW50KGV2ZW50KSk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZXhlY3V0ZShvYmplY3RpdmU6IHN0cmluZyk6IFByb21pc2U8T3BlcmF0aW9uUmVwb3J0PiB7XG4gICAgY29uc3QgZXhlY0NvbmZpZzogUGFydGlhbDxPcGVyYXRpb25Db25maWc+ID0geyBvYmplY3RpdmUgfTtcbiAgICB0aGlzLnVwZGF0ZUNvb3JkaW5hdG9yLnNldE1vZGUoJ2ZsdXNoaW5nJyk7XG4gICAgY29uc3QgcmVwb3J0ID1cbiAgICAgIChhd2FpdCB0aGlzLm9yY2hlc3RyYXRvcj8uZXhlY3V0ZShleGVjQ29uZmlnKSkgPz9cbiAgICAgICh7XG4gICAgICAgIGlkOiAnbm9vcCcsXG4gICAgICAgIG9iamVjdGl2ZSxcbiAgICAgICAgc3RhcnRUaW1lOiBEYXRlLm5vdygpLFxuICAgICAgICBlbmRUaW1lOiBEYXRlLm5vdygpLFxuICAgICAgICBkdXJhdGlvbjogMCxcbiAgICAgICAgcmVzdWx0czogW10sXG4gICAgICAgIGZpbmRpbmdzOiBbXSxcbiAgICAgICAgcmVjb21tZW5kYXRpb25zOiBbXSxcbiAgICAgICAgc3VtbWFyeTogJ25vb3AnLFxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgfSBzYXRpc2ZpZXMgT3BlcmF0aW9uUmVwb3J0KTtcbiAgICB0aGlzLnVwZGF0ZUNvb3JkaW5hdG9yLnNldE1vZGUoJ2lkbGUnKTtcbiAgICByZXR1cm4gcmVwb3J0O1xuICB9XG5cbiAgZGlzcG9zZSgpOiB2b2lkIHtcbiAgICB0aGlzLnVuc3ViPy4oKTtcbiAgfVxuXG4gIHByaXZhdGUgaGFuZGxlRXZlbnQoZXZlbnQ6IE9yY2hlc3RyYXRvckV2ZW50KTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnNob3dSZWFsdGltZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBkYXRhID0gZXZlbnQuZGF0YTtcbiAgICBsZXQgbmFtZSA9ICcnO1xuICAgIGlmIChkYXRhICYmIHR5cGVvZiBkYXRhID09PSAnb2JqZWN0JyAmJiAndG9vbE5hbWUnIGluIGRhdGEpIHtcbiAgICAgIG5hbWUgPSBTdHJpbmcoKGRhdGEgYXMge3Rvb2xOYW1lOiB1bmtub3dufSkudG9vbE5hbWUpO1xuICAgIH1cbiAgICB0aGlzLmRpc3BsYXkud3JpdGVSYXcoYFske2V2ZW50LnR5cGV9XSAke25hbWV9XFxuYCk7XG4gICAgdGhpcy51cGRhdGVDb29yZGluYXRvci5lbnF1ZXVlKHtcbiAgICAgIGxhbmU6ICdzdGF0dXMnLFxuICAgICAgcnVuOiAoKSA9PiB7XG4gICAgICAgIHRoaXMuZGlzcGxheS53cml0ZVJhdygnJyk7XG4gICAgICB9LFxuICAgIH0pO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUNBLElBQUFBLG9CQUFBLEdBQUFDLE9BQUE7QUFpQk8sTUFBTUMscUJBQXFCLENBQUM7RUFPakNDLFdBQVdBLENBQUNDLE9BQXNCLEVBQUU7SUFDbEMsSUFBSSxDQUFDQyxPQUFPLEdBQUdELE9BQU8sQ0FBQ0MsT0FBTztJQUM5QixJQUFJLENBQUNDLFlBQVksR0FBR0YsT0FBTyxDQUFDRSxZQUFZO0lBQ3hDLElBQUksQ0FBQ0MsaUJBQWlCLEdBQUdILE9BQU8sQ0FBQ0csaUJBQWlCLElBQUksSUFBSUMsd0NBQW1CLENBQUMsQ0FBQztJQUMvRSxJQUFJLENBQUNDLFlBQVksR0FBR0MsT0FBTyxDQUFDTixPQUFPLENBQUNPLGtCQUFrQixDQUFDO0lBRXZELElBQUksSUFBSSxDQUFDTCxZQUFZLEVBQUVNLE9BQU8sRUFBRTtNQUM5QixJQUFJLENBQUNDLEtBQUssR0FBRyxJQUFJLENBQUNQLFlBQVksQ0FBQ00sT0FBTyxDQUFFRSxLQUFLLElBQUssSUFBSSxDQUFDQyxXQUFXLENBQUNELEtBQUssQ0FBQyxDQUFDO0lBQzVFO0VBQ0Y7RUFFQSxNQUFNRSxPQUFPQSxDQUFDQyxTQUFpQixFQUE0QjtJQUN6RCxNQUFNQyxVQUFvQyxHQUFHO01BQUVEO0lBQVUsQ0FBQztJQUMxRCxJQUFJLENBQUNWLGlCQUFpQixDQUFDWSxPQUFPLENBQUMsVUFBVSxDQUFDO0lBQzFDLE1BQU1DLE1BQU0sR0FDVixDQUFDLE1BQU0sSUFBSSxDQUFDZCxZQUFZLEVBQUVVLE9BQU8sQ0FBQ0UsVUFBVSxDQUFDLEtBQzVDO01BQ0NHLEVBQUUsRUFBRSxNQUFNO01BQ1ZKLFNBQVM7TUFDVEssU0FBUyxFQUFFQyxJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFDO01BQ3JCQyxPQUFPLEVBQUVGLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUM7TUFDbkJFLFFBQVEsRUFBRSxDQUFDO01BQ1hDLE9BQU8sRUFBRSxFQUFFO01BQ1hDLFFBQVEsRUFBRSxFQUFFO01BQ1pDLGVBQWUsRUFBRSxFQUFFO01BQ25CQyxPQUFPLEVBQUUsTUFBTTtNQUNmQyxPQUFPLEVBQUU7SUFDWCxDQUE0QjtJQUM5QixJQUFJLENBQUN4QixpQkFBaUIsQ0FBQ1ksT0FBTyxDQUFDLE1BQU0sQ0FBQztJQUN0QyxPQUFPQyxNQUFNO0VBQ2Y7RUFFQVksT0FBT0EsQ0FBQSxFQUFTO0lBQ2QsSUFBSSxDQUFDbkIsS0FBSyxHQUFHLENBQUM7RUFDaEI7RUFFUUUsV0FBV0EsQ0FBQ0QsS0FBd0IsRUFBUTtJQUNsRCxJQUFJLENBQUMsSUFBSSxDQUFDTCxZQUFZLEVBQUU7TUFDdEI7SUFDRjtJQUNBLE1BQU13QixJQUFJLEdBQUduQixLQUFLLENBQUNtQixJQUFJO0lBQ3ZCLElBQUlDLElBQUksR0FBRyxFQUFFO0lBQ2IsSUFBSUQsSUFBSSxJQUFJLE9BQU9BLElBQUksS0FBSyxRQUFRLElBQUksVUFBVSxJQUFJQSxJQUFJLEVBQUU7TUFDMURDLElBQUksR0FBR0MsTUFBTSxDQUFFRixJQUFJLENBQXlCRyxRQUFRLENBQUM7SUFDdkQ7SUFDQSxJQUFJLENBQUMvQixPQUFPLENBQUNnQyxRQUFRLENBQUMsSUFBSXZCLEtBQUssQ0FBQ3dCLElBQUksS0FBS0osSUFBSSxJQUFJLENBQUM7SUFDbEQsSUFBSSxDQUFDM0IsaUJBQWlCLENBQUNnQyxPQUFPLENBQUM7TUFDN0JDLElBQUksRUFBRSxRQUFRO01BQ2RDLEdBQUcsRUFBRUEsQ0FBQSxLQUFNO1FBQ1QsSUFBSSxDQUFDcEMsT0FBTyxDQUFDZ0MsUUFBUSxDQUFDLEVBQUUsQ0FBQztNQUMzQjtJQUNGLENBQUMsQ0FBQztFQUNKO0FBQ0Y7QUFBQ0ssT0FBQSxDQUFBeEMscUJBQUEsR0FBQUEscUJBQUEiLCJpZ25vcmVMaXN0IjpbXX0=