ca219f4cde337614c479dabc172adc6d
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ParallelCoordinator = void 0;
class ParallelCoordinator {
  constructor(createRunner) {
    this.createRunner = createRunner;
  }
  async runModules(context, modules) {
    const tasks = modules.map(module => ({
      id: module.id,
      label: module.label,
      parallelizable: true,
      execute: () => context.processModule(module)
    }));
    const runner = this.createRunner();
    const batch = await runner.execute(tasks);
    const reports = [];
    for (const result of batch.results) {
      const module = modules.find(m => m.id === result.taskId);
      let report;
      if (result.result) {
        report = result.result;
      } else {
        report = {
          id: module?.id ?? result.taskId,
          label: module?.label ?? result.taskId,
          scope: module?.scope ?? [],
          steps: [],
          status: result.status === 'completed' ? 'completed' : 'failed'
        };
      }
      if (result.status !== 'completed') {
        report.status = 'failed';
      }
      reports.push(report);
      if (result.status === 'failed' && !context.continueOnFailure) {
        break;
      }
    }
    return reports;
  }
}
exports.ParallelCoordinator = ParallelCoordinator;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJQYXJhbGxlbENvb3JkaW5hdG9yIiwiY29uc3RydWN0b3IiLCJjcmVhdGVSdW5uZXIiLCJydW5Nb2R1bGVzIiwiY29udGV4dCIsIm1vZHVsZXMiLCJ0YXNrcyIsIm1hcCIsIm1vZHVsZSIsImlkIiwibGFiZWwiLCJwYXJhbGxlbGl6YWJsZSIsImV4ZWN1dGUiLCJwcm9jZXNzTW9kdWxlIiwicnVubmVyIiwiYmF0Y2giLCJyZXBvcnRzIiwicmVzdWx0IiwicmVzdWx0cyIsImZpbmQiLCJtIiwidGFza0lkIiwicmVwb3J0Iiwic2NvcGUiLCJzdGVwcyIsInN0YXR1cyIsInB1c2giLCJjb250aW51ZU9uRmFpbHVyZSIsImV4cG9ydHMiXSwic291cmNlcyI6WyJwYXJhbGxlbENvb3JkaW5hdG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgUGFyYWxsZWxUYXNrLCBCYXRjaFJlc3VsdCB9IGZyb20gJy4vcGFyYWxsZWxFeGVjdXRvci5qcyc7XG5pbXBvcnQgdHlwZSB7IFJlcG9VcGdyYWRlTW9kdWxlLCBVcGdyYWRlTW9kdWxlUmVwb3J0LCBSZXBvVXBncmFkZU1vZGVEZWZpbml0aW9uLCBSZXBvVXBncmFkZU1vZGUgfSBmcm9tICcuL3JlcG9VcGdyYWRlT3JjaGVzdHJhdG9yLmpzJztcblxuaW50ZXJmYWNlIFJ1bk1vZHVsZXNDb250ZXh0IHtcbiAgY29uY3VycmVuY3k6IG51bWJlcjtcbiAgbW9kZTogUmVwb1VwZ3JhZGVNb2RlO1xuICBtb2RlRGVmaW5pdGlvbjogUmVwb1VwZ3JhZGVNb2RlRGVmaW5pdGlvbjtcbiAgcGFyYWxsZWxWYXJpYW50cz86IGJvb2xlYW47XG4gIGNvbnRpbnVlT25GYWlsdXJlOiBib29sZWFuO1xuICB2YXJpYW50U3RhdHM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICBwcm9jZXNzTW9kdWxlOiAobW9kdWxlOiBSZXBvVXBncmFkZU1vZHVsZSkgPT4gUHJvbWlzZTxVcGdyYWRlTW9kdWxlUmVwb3J0PjtcbiAgZW1pdDogKGV2ZW50OiB1bmtub3duKSA9PiB2b2lkO1xufVxuXG5leHBvcnQgY2xhc3MgUGFyYWxsZWxDb29yZGluYXRvciB7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgY3JlYXRlUnVubmVyOiAoKSA9PiB7IGV4ZWN1dGU6ICh0YXNrczogUGFyYWxsZWxUYXNrPFVwZ3JhZGVNb2R1bGVSZXBvcnQ+W10pID0+IFByb21pc2U8QmF0Y2hSZXN1bHQ8VXBncmFkZU1vZHVsZVJlcG9ydD4+IH1cbiAgKSB7fVxuXG4gIGFzeW5jIHJ1bk1vZHVsZXMoY29udGV4dDogUnVuTW9kdWxlc0NvbnRleHQsIG1vZHVsZXM6IFJlcG9VcGdyYWRlTW9kdWxlW10pOiBQcm9taXNlPFVwZ3JhZGVNb2R1bGVSZXBvcnRbXT4ge1xuICAgIGNvbnN0IHRhc2tzOiBQYXJhbGxlbFRhc2s8VXBncmFkZU1vZHVsZVJlcG9ydD5bXSA9IG1vZHVsZXMubWFwKChtb2R1bGUpID0+ICh7XG4gICAgICBpZDogbW9kdWxlLmlkLFxuICAgICAgbGFiZWw6IG1vZHVsZS5sYWJlbCxcbiAgICAgIHBhcmFsbGVsaXphYmxlOiB0cnVlLFxuICAgICAgZXhlY3V0ZTogKCkgPT4gY29udGV4dC5wcm9jZXNzTW9kdWxlKG1vZHVsZSksXG4gICAgfSkpO1xuXG4gICAgY29uc3QgcnVubmVyID0gdGhpcy5jcmVhdGVSdW5uZXIoKTtcbiAgICBjb25zdCBiYXRjaCA9IGF3YWl0IHJ1bm5lci5leGVjdXRlKHRhc2tzKTtcbiAgICBjb25zdCByZXBvcnRzOiBVcGdyYWRlTW9kdWxlUmVwb3J0W10gPSBbXTtcblxuICAgIGZvciAoY29uc3QgcmVzdWx0IG9mIGJhdGNoLnJlc3VsdHMpIHtcbiAgICAgIGNvbnN0IG1vZHVsZSA9IG1vZHVsZXMuZmluZCgobSkgPT4gbS5pZCA9PT0gcmVzdWx0LnRhc2tJZCk7XG4gICAgICBsZXQgcmVwb3J0OiBVcGdyYWRlTW9kdWxlUmVwb3J0O1xuICAgICAgaWYgKHJlc3VsdC5yZXN1bHQpIHtcbiAgICAgICAgcmVwb3J0ID0gcmVzdWx0LnJlc3VsdDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlcG9ydCA9IHtcbiAgICAgICAgICBpZDogbW9kdWxlPy5pZCA/PyByZXN1bHQudGFza0lkLFxuICAgICAgICAgIGxhYmVsOiBtb2R1bGU/LmxhYmVsID8/IHJlc3VsdC50YXNrSWQsXG4gICAgICAgICAgc2NvcGU6IG1vZHVsZT8uc2NvcGUgPz8gW10sXG4gICAgICAgICAgc3RlcHM6IFtdLFxuICAgICAgICAgIHN0YXR1czogcmVzdWx0LnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcgPyAnY29tcGxldGVkJyA6ICdmYWlsZWQnLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICBpZiAocmVzdWx0LnN0YXR1cyAhPT0gJ2NvbXBsZXRlZCcpIHtcbiAgICAgICAgcmVwb3J0LnN0YXR1cyA9ICdmYWlsZWQnO1xuICAgICAgfVxuXG4gICAgICByZXBvcnRzLnB1c2gocmVwb3J0KTtcblxuICAgICAgaWYgKHJlc3VsdC5zdGF0dXMgPT09ICdmYWlsZWQnICYmICFjb250ZXh0LmNvbnRpbnVlT25GYWlsdXJlKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZXBvcnRzO1xuICB9XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQWNPLE1BQU1BLG1CQUFtQixDQUFDO0VBQy9CQyxXQUFXQSxDQUNRQyxZQUEwSCxFQUMzSTtJQUFBLEtBRGlCQSxZQUEwSCxHQUExSEEsWUFBMEg7RUFDMUk7RUFFSCxNQUFNQyxVQUFVQSxDQUFDQyxPQUEwQixFQUFFQyxPQUE0QixFQUFrQztJQUN6RyxNQUFNQyxLQUEwQyxHQUFHRCxPQUFPLENBQUNFLEdBQUcsQ0FBRUMsTUFBTSxLQUFNO01BQzFFQyxFQUFFLEVBQUVELE1BQU0sQ0FBQ0MsRUFBRTtNQUNiQyxLQUFLLEVBQUVGLE1BQU0sQ0FBQ0UsS0FBSztNQUNuQkMsY0FBYyxFQUFFLElBQUk7TUFDcEJDLE9BQU8sRUFBRUEsQ0FBQSxLQUFNUixPQUFPLENBQUNTLGFBQWEsQ0FBQ0wsTUFBTTtJQUM3QyxDQUFDLENBQUMsQ0FBQztJQUVILE1BQU1NLE1BQU0sR0FBRyxJQUFJLENBQUNaLFlBQVksQ0FBQyxDQUFDO0lBQ2xDLE1BQU1hLEtBQUssR0FBRyxNQUFNRCxNQUFNLENBQUNGLE9BQU8sQ0FBQ04sS0FBSyxDQUFDO0lBQ3pDLE1BQU1VLE9BQThCLEdBQUcsRUFBRTtJQUV6QyxLQUFLLE1BQU1DLE1BQU0sSUFBSUYsS0FBSyxDQUFDRyxPQUFPLEVBQUU7TUFDbEMsTUFBTVYsTUFBTSxHQUFHSCxPQUFPLENBQUNjLElBQUksQ0FBRUMsQ0FBQyxJQUFLQSxDQUFDLENBQUNYLEVBQUUsS0FBS1EsTUFBTSxDQUFDSSxNQUFNLENBQUM7TUFDMUQsSUFBSUMsTUFBMkI7TUFDL0IsSUFBSUwsTUFBTSxDQUFDQSxNQUFNLEVBQUU7UUFDakJLLE1BQU0sR0FBR0wsTUFBTSxDQUFDQSxNQUFNO01BQ3hCLENBQUMsTUFBTTtRQUNMSyxNQUFNLEdBQUc7VUFDUGIsRUFBRSxFQUFFRCxNQUFNLEVBQUVDLEVBQUUsSUFBSVEsTUFBTSxDQUFDSSxNQUFNO1VBQy9CWCxLQUFLLEVBQUVGLE1BQU0sRUFBRUUsS0FBSyxJQUFJTyxNQUFNLENBQUNJLE1BQU07VUFDckNFLEtBQUssRUFBRWYsTUFBTSxFQUFFZSxLQUFLLElBQUksRUFBRTtVQUMxQkMsS0FBSyxFQUFFLEVBQUU7VUFDVEMsTUFBTSxFQUFFUixNQUFNLENBQUNRLE1BQU0sS0FBSyxXQUFXLEdBQUcsV0FBVyxHQUFHO1FBQ3hELENBQUM7TUFDSDtNQUVBLElBQUlSLE1BQU0sQ0FBQ1EsTUFBTSxLQUFLLFdBQVcsRUFBRTtRQUNqQ0gsTUFBTSxDQUFDRyxNQUFNLEdBQUcsUUFBUTtNQUMxQjtNQUVBVCxPQUFPLENBQUNVLElBQUksQ0FBQ0osTUFBTSxDQUFDO01BRXBCLElBQUlMLE1BQU0sQ0FBQ1EsTUFBTSxLQUFLLFFBQVEsSUFBSSxDQUFDckIsT0FBTyxDQUFDdUIsaUJBQWlCLEVBQUU7UUFDNUQ7TUFDRjtJQUNGO0lBRUEsT0FBT1gsT0FBTztFQUNoQjtBQUNGO0FBQUNZLE9BQUEsQ0FBQTVCLG1CQUFBLEdBQUFBLG1CQUFBIiwiaWdub3JlTGlzdCI6W119