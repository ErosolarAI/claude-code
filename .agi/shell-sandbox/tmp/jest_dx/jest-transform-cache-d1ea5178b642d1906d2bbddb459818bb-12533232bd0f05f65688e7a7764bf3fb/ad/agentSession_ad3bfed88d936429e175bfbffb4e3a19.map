{"version":3,"names":["cov_a6gegww43","actualCoverage","resolveProfileConfig","createDefaultToolRuntime","createProvider","AgentRuntime","registerDefaultProviderPlugins","createDefaultContextManager","CONTEXT_CLEANUP_SYSTEM_PROMPT","s","AgentSession","state","constructor","options","f","profileConfig","profile","workspaceContext","toolContext","profileName","provider","model","contextManager","createContextManagerWithSummarization","toolSuites","b","toolRuntime","observer","toolObserver","summarizationCallback","messages","temperature","maxTokens","emptyToolContext","summarizer","systemPrompt","callbacks","serialized","map","msg","serializeMessage","filter","text","length","chunks","chunkMessages","runningSummary","chunk","prompt","send","trim","error","Error","message","useLLMSummarization","createAgent","selection","toolRuntimeOverride","asProviderConfig","explainEdits","updateToolContext","refreshWorkspaceContext","resolved","rulebook","role","content","name","maxCharsPerChunk","buffer","entry","segment","push","reasoningEffort","textVerbosity","thinking","thinkingLevel"],"sources":["agentSession.ts"],"sourcesContent":["import { resolveProfileConfig, type ProfileName, type ResolvedProfileConfig } from '../config.js';\nimport {\n  createDefaultToolRuntime,\n  type ToolExecutionContext,\n  type ToolRuntime,\n  type IToolRuntime,\n  type ToolRuntimeObserver,\n  type ToolSuite,\n} from '../core/toolRuntime.js';\nimport type { ProviderId, ReasoningEffortLevel, TextVerbosityLevel, ConversationMessage, ThinkingBudgetConfig, ThinkingLevel } from '../core/types.js';\nimport { createProvider, type ProviderConfig } from '../providers/providerFactory.js';\nimport { AgentRuntime, type AgentCallbacks } from '../core/agent.js';\nimport { registerDefaultProviderPlugins } from '../plugins/providers/index.js';\nimport { createDefaultContextManager, ContextManager, type SummarizationCallback } from '../core/contextManager.js';\n/**\n * System prompt for context summarization\n * Instructs the LLM to create concise summaries of conversation history\n */\nconst CONTEXT_CLEANUP_SYSTEM_PROMPT = `Summarize earlier conversation logs to preserve context while staying within token limits.\n- Merge any prior summary with the new chunk.\n- Capture decisions, tasks, file changes/paths, tool observations, and open questions.\n- Separate completed work from follow-ups; keep it under ~180 words with tight bullets.\n- Respond in plain Markdown only (no tool or command calls).`;\n\nexport interface AgentSessionOptions {\n  profile: ProfileName;\n  workspaceContext: string | null;\n  toolSuites?: ToolSuite[];\n  toolObserver?: ToolRuntimeObserver;\n}\n\nexport interface ModelSelection {\n  provider: ProviderId;\n  model: string;\n  temperature?: number;\n  maxTokens?: number;\n  systemPrompt?: string;\n  reasoningEffort?: ReasoningEffortLevel;\n  textVerbosity?: TextVerbosityLevel;\n  /** Extended thinking configuration for supported models (Anthropic Claude 4/3.7, Gemini 2.5+) */\n  thinking?: ThinkingBudgetConfig;\n  /** Thinking level for models that support discrete intensities (Gemini 3 Pro) */\n  thinkingLevel?: ThinkingLevel;\n}\n\ninterface AgentSessionState {\n  readonly profile: ProfileName;\n  workspaceContext: string | null;\n  profileConfig: ResolvedProfileConfig;\n  toolContext: ToolExecutionContext; // Mutable - updated during model switching\n  toolRuntime: ToolRuntime;\n  readonly toolSuites: ToolSuite[];\n  readonly toolObserver?: ToolRuntimeObserver;\n  readonly contextManager: ContextManager;\n}\n\nexport class AgentSession {\n  private readonly state: AgentSessionState;\n\n  constructor(options: AgentSessionOptions) {\n    registerDefaultProviderPlugins();\n    const profileConfig = resolveProfileConfig(options.profile, options.workspaceContext);\n    const toolContext: ToolExecutionContext = {\n      profileName: profileConfig.profile,\n      provider: profileConfig.provider,\n      model: profileConfig.model,\n      workspaceContext: options.workspaceContext,\n    };\n\n    // Create context manager with LLM-based summarization callback\n    const contextManager = this.createContextManagerWithSummarization(profileConfig);\n\n    const toolSuites = options.toolSuites ? [...options.toolSuites] : [];\n    const toolRuntime = createDefaultToolRuntime(\n      toolContext,\n      toolSuites,\n      {\n        observer: options.toolObserver,\n        contextManager, // Pass context manager for output truncation\n      }\n    );\n\n    this.state = {\n      profile: options.profile,\n      workspaceContext: options.workspaceContext,\n      profileConfig,\n      toolContext,\n      toolRuntime,\n      toolSuites,\n      toolObserver: options.toolObserver,\n      contextManager,\n    };\n  }\n\n  /**\n   * Creates a context manager with LLM-based summarization support\n   */\n  private createContextManagerWithSummarization(profileConfig: ResolvedProfileConfig): ContextManager {\n    // Create summarization callback that doesn't reference this.state\n    const summarizationCallback: SummarizationCallback = async (messages: ConversationMessage[]) => {\n      try {\n        // Create a lightweight agent for summarization\n        const provider = createProvider({\n          provider: profileConfig.provider,\n          model: profileConfig.model,\n          temperature: 0, // Use deterministic summarization\n          maxTokens: 500, // Keep summaries concise\n        });\n\n        // Create empty tool context for summarization (no tools needed)\n        const emptyToolContext: ToolExecutionContext = {\n          profileName: profileConfig.profile,\n          provider: profileConfig.provider,\n          model: profileConfig.model,\n          workspaceContext: null,\n        };\n\n        const summarizer = new AgentRuntime({\n          provider,\n          toolRuntime: createDefaultToolRuntime(emptyToolContext, []), // No tools for summarization\n          systemPrompt: CONTEXT_CLEANUP_SYSTEM_PROMPT,\n          callbacks: {}, // No callbacks needed for summarization\n        });\n\n        // Serialize messages into chunks\n        const serialized = messages.map((msg) => serializeMessage(msg)).filter((text) => text.length > 0);\n\n        if (!serialized.length) {\n          return '[No content to summarize]';\n        }\n\n        // Chunk messages to avoid overwhelming the summarizer\n        const chunks = chunkMessages(serialized, 6000);\n\n        // Iteratively summarize chunks\n        let runningSummary = '';\n        for (const chunk of chunks) {\n          const prompt = runningSummary\n            ? `Existing summary:\\n${runningSummary}\\n\\nNew conversation chunk:\\n${chunk}\\n\\nMerge the chunk into the running summary, keeping it concise (<200 words).`\n            : `Summarize this conversation concisely (<200 words):\\n\\n${chunk}`;\n\n          runningSummary = (await summarizer.send(prompt)).trim();\n        }\n\n        return runningSummary || '[Summary generation failed]';\n      } catch (error) {\n        // If summarization fails, return a fallback message\n        return `[Summarization failed: ${error instanceof Error ? error.message : 'Unknown error'}]`;\n      }\n    };\n\n    return createDefaultContextManager({\n      useLLMSummarization: true,\n      summarizationCallback,\n    }, profileConfig.model);\n  }\n\n\n  get profile(): ProfileName {\n    return this.state.profile;\n  }\n\n  get profileConfig(): ResolvedProfileConfig {\n    return this.state.profileConfig;\n  }\n\n  get workspaceContext(): string | null {\n    return this.state.workspaceContext ?? null;\n  }\n\n  get toolRuntime(): ToolRuntime {\n    return this.state.toolRuntime;\n  }\n\n  get toolContext(): ToolExecutionContext {\n    return this.state.toolContext;\n  }\n\n  createAgent(\n    selection: ModelSelection,\n    callbacks?: AgentCallbacks,\n    toolRuntimeOverride?: IToolRuntime,\n    options?: { explainEdits?: boolean }\n  ): AgentRuntime {\n    const provider = createProvider(asProviderConfig(selection));\n    const systemPrompt = (selection.systemPrompt ?? this.state.profileConfig.systemPrompt).trim();\n\n    return new AgentRuntime({\n      provider,\n      toolRuntime: toolRuntimeOverride ?? this.state.toolRuntime,\n      systemPrompt,\n      callbacks,\n      contextManager: this.state.contextManager, // Pass context manager for history pruning\n      explainEdits: options?.explainEdits,\n    });\n  }\n\n  updateToolContext(selection: ModelSelection): void {\n    // Create new context with updated provider/model (properties are readonly)\n    this.state.toolContext = {\n      ...this.state.toolContext,\n      provider: selection.provider,\n      model: selection.model,\n    };\n  }\n\n  refreshWorkspaceContext(workspaceContext: string | null): ResolvedProfileConfig {\n    const resolved = resolveProfileConfig(this.state.profile, workspaceContext);\n    this.state.workspaceContext = workspaceContext;\n    // Create new context with updated workspace (properties are readonly)\n    this.state.toolContext = {\n      ...this.state.toolContext,\n      workspaceContext,\n    };\n    this.state.profileConfig = {\n      ...this.state.profileConfig,\n      systemPrompt: resolved.systemPrompt,\n      rulebook: resolved.rulebook,\n    };\n    this.state.toolRuntime = createDefaultToolRuntime(\n      this.state.toolContext,\n      this.state.toolSuites,\n      {\n        observer: this.state.toolObserver,\n        contextManager: this.state.contextManager, // Preserve context manager\n      }\n    );\n    return this.state.profileConfig;\n  }\n\n  get contextManager(): ContextManager {\n    return this.state.contextManager;\n  }\n\n  get toolSuites(): ToolSuite[] {\n    return this.state.toolSuites;\n  }\n}\n\n/**\n * Serialize a message for summarization\n */\nfunction serializeMessage(message: ConversationMessage): string {\n  switch (message.role) {\n    case 'user':\n      return `User: ${message.content}`;\n    case 'assistant':\n      return `Assistant: ${message.content}`;\n    case 'tool':\n      return `Tool(${message.name ?? 'unknown'}): ${message.content}`;\n    case 'system':\n      return `System: ${message.content}`;\n    default:\n      return '';\n  }\n}\n\n/**\n * Chunk messages by character count\n */\nfunction chunkMessages(serialized: string[], maxCharsPerChunk: number): string[] {\n  const chunks: string[] = [];\n  let buffer = '';\n\n  for (const entry of serialized) {\n    const segment = buffer ? `\\n\\n${entry}` : entry;\n    if (buffer && buffer.length + segment.length > maxCharsPerChunk) {\n      chunks.push(buffer.trim());\n      buffer = entry;\n      continue;\n    }\n    buffer += buffer ? `\\n\\n${entry}` : entry;\n  }\n\n  if (buffer) {\n    chunks.push(buffer.trim());\n  }\n\n  return chunks;\n}\n\nfunction asProviderConfig(selection: ModelSelection): ProviderConfig {\n  return {\n    provider: selection.provider,\n    model: selection.model,\n    temperature: selection.temperature,\n    maxTokens: selection.maxTokens,\n    reasoningEffort: selection.reasoningEffort,\n    textVerbosity: selection.textVerbosity,\n    // Pass thinking configuration for extended thinking models\n    thinking: selection.thinking,\n    thinkingLevel: selection.thinkingLevel,\n  };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}