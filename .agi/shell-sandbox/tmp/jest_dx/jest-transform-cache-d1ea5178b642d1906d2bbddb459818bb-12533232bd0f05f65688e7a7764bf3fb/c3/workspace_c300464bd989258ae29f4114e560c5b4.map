{"version":3,"names":["cov_1ywkuq3b8o","actualCoverage","existsSync","readFileSync","readdirSync","join","safeWorkspaceContext","validateWorkspaceOptions","PRIORITY_DOCS","s","IGNORED_DIRS","Set","IGNORED_FILES","DEFAULT_TREE_DEPTH","DEFAULT_MAX_ENTRIES","DEFAULT_DOC_LIMIT","DEBUG_CONTEXT_ERRORS","Boolean","process","env","resolveWorkspaceCaptureOptions","b","f","treeDepth","parsePositiveInt","maxEntries","docExcerptLimit","buildWorkspaceContext","root","options","optionsValidation","valid","console","error","errors","Error","warnings","length","warn","docLimit","treeLines","formatFileTree","docSnippets","capturePriorityDocs","sections","push","rawContent","filter","section","trim","safe","truncate","throwOnError","log","stats","content","message","String","name","map","safeLimit","Math","min","snippet","slice","maxDepth","lines","walk","dir","depth","prefix","entries","safeReadDir","entry","has","sort","a","localeCompare","isFile","isDir","isDirectory","withFileTypes","raw","undefined","value","Number","parseInt","isFinite"],"sources":["workspace.ts"],"sourcesContent":["import { existsSync, readFileSync, readdirSync } from 'node:fs';\nimport type { Dirent } from 'node:fs';\nimport { join } from 'node:path';\nimport { safeWorkspaceContext, validateWorkspaceOptions } from './workspace.validator.js';\n\nconst PRIORITY_DOCS = ['README.md']; // Removed package.json to save context\nconst IGNORED_DIRS = new Set([\n  '.git', 'node_modules', 'dist', '.agi', 'build', 'coverage', '.next', 'out',\n  '__pycache__', '.pytest_cache', '.mypy_cache', 'venv', '.venv', 'env',\n  'target', 'bin', 'obj', '.idea', '.vscode', '.DS_Store'\n]);\nconst IGNORED_FILES = new Set(['package-lock.json', 'yarn.lock', 'pnpm-lock.yaml']);\nconst DEFAULT_TREE_DEPTH = 1;  // Reduced from 2 to 1 for critical context savings\nconst DEFAULT_MAX_ENTRIES = 30;  // Further reduced from 50 to 30 - emergency reduction\nconst DEFAULT_DOC_LIMIT = 200;  // Further reduced from 300 to 200 - emergency reduction\nconst DEBUG_CONTEXT_ERRORS = Boolean(process.env['DEBUG_CONTEXT_ERRORS']);\n\nexport interface WorkspaceCaptureOptions {\n  treeDepth?: number;\n  maxEntries?: number;\n  docExcerptLimit?: number;\n}\n\nexport function resolveWorkspaceCaptureOptions(env: NodeJS.ProcessEnv = process.env): WorkspaceCaptureOptions {\n  return {\n    treeDepth: parsePositiveInt(env['AGI_CONTEXT_TREE_DEPTH']),\n    maxEntries: parsePositiveInt(env['AGI_CONTEXT_MAX_ENTRIES']),\n    docExcerptLimit: parsePositiveInt(env['AGI_CONTEXT_DOC_LIMIT']),\n  };\n}\n\nexport function buildWorkspaceContext(root: string, options: WorkspaceCaptureOptions = {}): string | null {\n  // CRITICAL: Validate options BEFORE building context\n  const optionsValidation = validateWorkspaceOptions(options);\n  if (!optionsValidation.valid) {\n    // Only log in debug mode to avoid polluting chat\n    if (process.env['DEBUG_CONTEXT']) {\n      console.error('[Workspace Context] Invalid options:', optionsValidation.errors);\n    }\n    throw new Error(`Invalid workspace options: ${optionsValidation.errors.join(', ')}`);\n  }\n\n  // Warnings only in debug mode\n  if (optionsValidation.warnings.length > 0 && process.env['DEBUG_CONTEXT']) {\n    console.warn('[Workspace Context] Warnings:', optionsValidation.warnings);\n  }\n\n  const treeDepth = options.treeDepth ?? DEFAULT_TREE_DEPTH;\n  const maxEntries = options.maxEntries ?? DEFAULT_MAX_ENTRIES;\n  const docLimit = options.docExcerptLimit ?? DEFAULT_DOC_LIMIT;\n\n  try {\n    const treeLines = formatFileTree(root, treeDepth, maxEntries);\n    const docSnippets = capturePriorityDocs(root, docLimit);\n\n    const sections: string[] = [`cwd: ${root}`];\n    if (treeLines.length) {\n      sections.push('files:', ...treeLines);\n    }\n    if (docSnippets.length) {\n      sections.push(docSnippets.join('\\n\\n'));\n    }\n\n    const rawContent = sections.filter((section) => section.trim().length > 0).join('\\n');\n\n    const safe = safeWorkspaceContext(rawContent, {\n      truncate: true,\n      throwOnError: false,\n    });\n\n    if (process.env['DEBUG_CONTEXT']) {\n      console.log('[Workspace Context] Stats:', safe.stats);\n    }\n\n    if (!safe.content.trim()) {\n      if (DEBUG_CONTEXT_ERRORS) {\n        console.warn('[Workspace Context] Captured context is empty after filtering.');\n      }\n      return null;\n    }\n\n    return safe.content;\n  } catch (error) {\n    // Only log errors in debug mode to avoid polluting chat\n    if (DEBUG_CONTEXT_ERRORS || process.env['DEBUG_CONTEXT']) {\n      const message = error instanceof Error ? error.message : String(error);\n      console.error('[Workspace Context] Failed to build context:', message);\n      console.error(error);\n    }\n    return null;\n  }\n}\n\nfunction capturePriorityDocs(root: string, docLimit: number): string[] {\n  return PRIORITY_DOCS.filter((name) => existsSync(join(root, name))).map((name) => {\n    try {\n      const content = readFileSync(join(root, name), 'utf8');\n      // Safety: Hard limit to prevent context explosion\n      const safeLimit = Math.min(docLimit, 300);\n      const snippet = content.length > safeLimit ? `${content.slice(0, safeLimit)}\\n...` : content;\n      return `--- ${name} ---\\n${snippet.trim()}`;\n    } catch {\n      return `--- ${name} ---\\n[Could not read file]`;\n    }\n  });\n}\n\nfunction formatFileTree(root: string, maxDepth: number, maxEntries: number): string[] {\n  const lines: string[] = [];\n  const walk = (dir: string, depth: number, prefix: string) => {\n    if (depth > maxDepth || lines.length >= maxEntries) {\n      return;\n    }\n\n    const entries = safeReadDir(dir)\n      .filter((entry) => !IGNORED_DIRS.has(entry.name))\n      .sort((a, b) => a.name.localeCompare(b.name));\n\n    for (const entry of entries) {\n      if (entry.isFile() && IGNORED_FILES.has(entry.name)) {\n        continue;\n      }\n\n      if (lines.length >= maxEntries) {\n        break;\n      }\n\n      const isDir = entry.isDirectory();\n      lines.push(`${prefix}${entry.name}${isDir ? '/' : ''}`);\n      if (isDir && depth < maxDepth) {\n        walk(join(dir, entry.name), depth + 1, `${prefix}  `);\n      }\n    }\n  };\n\n  walk(root, 0, '');\n  return lines;\n}\n\nfunction safeReadDir(dir: string): Dirent[] {\n  try {\n    return readdirSync(dir, { withFileTypes: true });\n  } catch (error) {\n    if (DEBUG_CONTEXT_ERRORS) {\n      const message = error instanceof Error ? error.message : String(error);\n      console.warn(`[Workspace Context] Skipping ${dir}: ${message}`);\n    }\n    return [];\n  }\n}\n\nfunction parsePositiveInt(raw?: string): number | undefined {\n  if (!raw) {\n    return undefined;\n  }\n  const value = Number.parseInt(raw, 10);\n  return Number.isFinite(value) && value > 0 ? value : undefined;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}