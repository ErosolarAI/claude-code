{"version":3,"names":["_theme","require","_AnimationScheduler","_uiConstants","globalScheduler","schedulerDisposed","schedulerRefCount","getScheduler","createNoOpScheduler","AnimationScheduler","scheduler","dispose","releaseScheduler","AnimatedSpinner","frameIndex","intervalId","currentFrame","constructor","message","style","color","theme","info","frames","spinnerFrames","start","onUpdate","setInterval","length","render","stop","clearInterval","undefined","setMessage","spinnerChar","isRunning","exports","AnimatedProgressBar","current","target","animationId","transitionHandler","total","width","update","value","Math","min","removeListener","unregister","Date","now","createTransition","Easing","easeOutQuad","data","id","on","percentage","filled","floor","partial","empty","bar","progress","progressChars","repeat","partialIndex","partialChar","max","percentText","round","AnimatedElapsedTime","currentDisplay","startTime","format","elapsed","seconds","minutes","hours","toString","padStart","ui","muted","PulsingText","intensity","increasing","text","setText","highlight","ThinkingIndicator","dotCount","label","setLabel","dots","padding","thinking","icon","StreamingStatus","isActive","spinner","spinnerPart","elapsedPart","updateMessage","finalTime","success","ContextMeter","targetPercentage","animationFrame","animate","clearTimeout","step","diff","abs","setTimeout","pct","clampPercentage","getContextColor","error","warning","TypingIndicator","WaveIndicator","disposeAnimations","resetAnimationScheduler"],"sources":["animatedStatus.ts"],"sourcesContent":["/**\n * AnimatedStatus - Provides smooth, dynamic status indicators with animations\n * Integrates with the AnimationScheduler for real-time UI updates\n */\n\nimport { theme, spinnerFrames, progressChars } from './theme.js';\nimport { AnimationScheduler } from './animation/AnimationScheduler.js';\nimport { clampPercentage, getContextColor } from './uiConstants.js';\n\n// Singleton scheduler for global animation coordination\nlet globalScheduler: AnimationScheduler | null = null;\nlet schedulerDisposed = false; // Prevent recreation after disposal\nlet schedulerRefCount = 0; // Reference counting for proper cleanup\n\n/**\n * Get or create the global animation scheduler\n * Uses lazy initialization and reference counting\n */\nfunction getScheduler(): AnimationScheduler {\n  if (schedulerDisposed) {\n    // Return a no-op scheduler if disposed to prevent recreation\n    // This handles edge cases where animations try to register after cleanup\n    if (!globalScheduler) {\n      globalScheduler = createNoOpScheduler();\n    }\n    return globalScheduler;\n  }\n  if (!globalScheduler) {\n    globalScheduler = new AnimationScheduler(30); // 30 FPS for smooth animations\n  }\n  schedulerRefCount++;\n  return globalScheduler;\n}\n\n/**\n * Create a no-op scheduler for disposed state\n */\nfunction createNoOpScheduler(): AnimationScheduler {\n  const scheduler = new AnimationScheduler(30);\n  scheduler.dispose(); // Immediately dispose - it's a stub\n  return scheduler;\n}\n\n/**\n * Release a reference to the scheduler\n */\nfunction releaseScheduler(): void {\n  if (schedulerRefCount > 0) {\n    schedulerRefCount--;\n  }\n}\n\n/**\n * Animated spinner that cycles through frames\n */\nexport class AnimatedSpinner {\n  private frameIndex = 0;\n  private readonly frames: string[];\n  private intervalId: NodeJS.Timeout | null = null;\n  private message: string;\n  private readonly color: (text: string) => string;\n  private currentFrame = '';\n  private onUpdate?: (frame: string) => void;\n\n  constructor(\n    message: string = '',\n    style: 'dots' | 'arc' | 'circle' | 'bounce' | 'braille' = 'dots',\n    color: (text: string) => string = theme.info\n  ) {\n    this.frames = spinnerFrames[style];\n    this.message = message;\n    this.color = color;\n    this.currentFrame = this.frames[0] ?? '⠋';\n  }\n\n  start(onUpdate?: (frame: string) => void): void {\n    this.onUpdate = onUpdate;\n    this.frameIndex = 0;\n    this.intervalId = setInterval(() => {\n      this.frameIndex = (this.frameIndex + 1) % this.frames.length;\n      this.currentFrame = this.frames[this.frameIndex] ?? '⠋';\n      if (this.onUpdate) {\n        this.onUpdate(this.render());\n      }\n    }, 80); // ~12 FPS for smooth spinner animations\n  }\n\n  stop(): void {\n    if (this.intervalId) {\n      clearInterval(this.intervalId);\n      this.intervalId = null;\n    }\n    this.onUpdate = undefined;\n  }\n\n  setMessage(message: string): void {\n    this.message = message;\n  }\n\n  render(): string {\n    const spinnerChar = this.color(this.currentFrame);\n    return this.message ? `${spinnerChar} ${this.message}` : spinnerChar;\n  }\n\n  isRunning(): boolean {\n    return this.intervalId !== null;\n  }\n\n  /**\n   * Dispose of the spinner and clean up resources\n   */\n  dispose(): void {\n    this.stop();\n  }\n}\n\n/**\n * Animated progress bar with smooth transitions\n */\nexport class AnimatedProgressBar {\n  private current = 0;\n  private target = 0;\n  private readonly total: number;\n  private readonly width: number;\n  private animationId: string | null = null;\n  // Store the bound listener so we can remove it to prevent memory leaks\n  private transitionHandler: ((data: { id: string; value: number }) => void) | null = null;\n\n  constructor(total: number, width: number = 20) {\n    this.total = total;\n    this.width = width;\n  }\n\n  update(value: number): void {\n    this.target = Math.min(value, this.total);\n\n    // Smooth transition to target\n    const scheduler = getScheduler();\n\n    // Remove old listener before creating new animation to prevent accumulation\n    if (this.transitionHandler) {\n      scheduler.removeListener('transition:update', this.transitionHandler);\n      this.transitionHandler = null;\n    }\n\n    if (this.animationId) {\n      scheduler.unregister(this.animationId);\n    }\n\n    this.animationId = `progress-${Date.now()}`;\n    scheduler.createTransition(\n      this.animationId,\n      this.current,\n      this.target,\n      'progress',\n      300,\n      AnimationScheduler.Easing.easeOutQuad\n    );\n\n    // Create and store the listener for proper cleanup\n    this.transitionHandler = (data: { id: string; value: number }) => {\n      if (data.id === this.animationId && typeof data.value === 'number') {\n        this.current = data.value;\n      }\n    };\n    scheduler.on('transition:update', this.transitionHandler);\n  }\n\n  render(): string {\n    const percentage = this.total > 0 ? this.current / this.total : 0;\n    const filled = Math.floor(percentage * this.width);\n    const partial = (percentage * this.width) % 1;\n    const empty = this.width - filled - (partial > 0 ? 1 : 0);\n\n    let bar = theme.progress.bar(progressChars.filled.repeat(filled));\n\n    if (partial > 0 && filled < this.width) {\n      const partialIndex = Math.floor(partial * progressChars.partial.length);\n      const partialChar = progressChars.partial[partialIndex] ?? progressChars.partial[0];\n      bar += theme.progress.bar(partialChar);\n    }\n\n    bar += theme.progress.empty(progressChars.empty.repeat(Math.max(0, empty)));\n\n    const percentText = theme.progress.percentage(`${Math.round(percentage * 100)}%`);\n    return `${bar} ${percentText}`;\n  }\n\n  dispose(): void {\n    // Remove the transition listener to prevent memory leaks\n    if (this.transitionHandler) {\n      try {\n        getScheduler().removeListener('transition:update', this.transitionHandler);\n      } catch {\n        // Ignore errors during cleanup\n      }\n      this.transitionHandler = null;\n    }\n    if (this.animationId) {\n      try {\n        getScheduler().unregister(this.animationId);\n      } catch {\n        // Ignore errors during cleanup\n      }\n      this.animationId = null;\n    }\n    releaseScheduler();\n  }\n}\n\n/**\n * Animated elapsed time display\n */\nexport class AnimatedElapsedTime {\n  private startTime: number;\n  private intervalId: NodeJS.Timeout | null = null;\n  private currentDisplay = '0s';\n  private onUpdate?: (display: string) => void;\n\n  constructor() {\n    this.startTime = Date.now();\n  }\n\n  start(onUpdate?: (display: string) => void): void {\n    this.startTime = Date.now();\n    this.onUpdate = onUpdate;\n    this.intervalId = setInterval(() => {\n      this.currentDisplay = this.format();\n      if (this.onUpdate) {\n        this.onUpdate(this.currentDisplay);\n      }\n    }, 1000); // Update every second\n  }\n\n  stop(): string {\n    if (this.intervalId) {\n      clearInterval(this.intervalId);\n      this.intervalId = null;\n    }\n    this.onUpdate = undefined;\n    return this.format();\n  }\n\n  format(): string {\n    const elapsed = Date.now() - this.startTime;\n    const seconds = Math.floor(elapsed / 1000);\n    const minutes = Math.floor(seconds / 60);\n    const hours = Math.floor(minutes / 60);\n\n    if (hours > 0) {\n      return `${hours}h ${minutes % 60}m ${seconds % 60}s`;\n    } else if (minutes > 0) {\n      return `${minutes}:${(seconds % 60).toString().padStart(2, '0')}`;\n    } else {\n      return `${seconds}s`;\n    }\n  }\n\n  render(): string {\n    return theme.ui.muted(this.currentDisplay);\n  }\n\n  dispose(): void {\n    this.stop();\n  }\n}\n\n/**\n * Pulsing text effect for emphasis\n */\nexport class PulsingText {\n  private text: string;\n  private intensity = 0;\n  private increasing = true;\n  private intervalId: NodeJS.Timeout | null = null;\n  private onUpdate?: (rendered: string) => void;\n\n  constructor(text: string) {\n    this.text = text;\n  }\n\n  start(onUpdate?: (rendered: string) => void): void {\n    this.onUpdate = onUpdate;\n    this.intervalId = setInterval(() => {\n      if (this.increasing) {\n        this.intensity += 0.1;\n        if (this.intensity >= 1) {\n          this.intensity = 1;\n          this.increasing = false;\n        }\n      } else {\n        this.intensity -= 0.1;\n        if (this.intensity <= 0.3) {\n          this.intensity = 0.3;\n          this.increasing = true;\n        }\n      }\n      if (this.onUpdate) {\n        this.onUpdate(this.render());\n      }\n    }, 50); // 20 FPS for pulse\n  }\n\n  stop(): void {\n    if (this.intervalId) {\n      clearInterval(this.intervalId);\n      this.intervalId = null;\n    }\n    this.onUpdate = undefined;\n  }\n\n  setText(text: string): void {\n    this.text = text;\n  }\n\n  render(): string {\n    // Use intensity to vary between dim and bright\n    if (this.intensity > 0.7) {\n      return theme.ui.highlight(this.text);\n    } else if (this.intensity > 0.4) {\n      return theme.info(this.text);\n    } else {\n      return theme.ui.muted(this.text);\n    }\n  }\n\n  dispose(): void {\n    this.stop();\n  }\n}\n\n/**\n * Thinking indicator with animated dots\n */\nexport class ThinkingIndicator {\n  private dotCount = 0;\n  private intervalId: NodeJS.Timeout | null = null;\n  private label: string;\n  private onUpdate?: (rendered: string) => void;\n\n  constructor(label: string = 'Thinking') {\n    this.label = label;\n  }\n\n  start(onUpdate?: (rendered: string) => void): void {\n    this.onUpdate = onUpdate;\n    this.dotCount = 0;\n    this.intervalId = setInterval(() => {\n      this.dotCount = (this.dotCount + 1) % 4;\n      if (this.onUpdate) {\n        this.onUpdate(this.render());\n      }\n    }, 400); // Slower animation for thinking\n  }\n\n  stop(): void {\n    if (this.intervalId) {\n      clearInterval(this.intervalId);\n      this.intervalId = null;\n    }\n    this.onUpdate = undefined;\n  }\n\n  setLabel(label: string): void {\n    this.label = label;\n  }\n\n  render(): string {\n    const dots = '.'.repeat(this.dotCount);\n    const padding = ' '.repeat(3 - this.dotCount);\n    return `${theme.thinking.icon('◐')} ${theme.thinking.label(this.label)}${theme.thinking.text(dots)}${padding}`;\n  }\n\n  dispose(): void {\n    this.stop();\n  }\n}\n\n/**\n * Streaming status with spinner and message\n */\nexport class StreamingStatus {\n  private spinner: AnimatedSpinner;\n  private elapsed: AnimatedElapsedTime;\n  private isActive = false;\n\n  constructor() {\n    this.spinner = new AnimatedSpinner('', 'braille', theme.info);\n    this.elapsed = new AnimatedElapsedTime();\n  }\n\n  start(message: string, onUpdate?: (status: string) => void): void {\n    this.isActive = true;\n    this.spinner.setMessage(message);\n\n    const update = () => {\n      if (this.isActive && onUpdate) {\n        const spinnerPart = this.spinner.render();\n        const elapsedPart = this.elapsed.render();\n        onUpdate(`${spinnerPart} ${theme.ui.muted('·')} ${elapsedPart}`);\n      }\n    };\n\n    this.spinner.start(update);\n    this.elapsed.start(update);\n  }\n\n  updateMessage(message: string): void {\n    this.spinner.setMessage(message);\n  }\n\n  stop(): string {\n    this.isActive = false;\n    this.spinner.stop();\n    const finalTime = this.elapsed.stop();\n    return `${theme.success('✓')} ${theme.ui.muted('Completed')} ${theme.ui.muted('·')} ${theme.ui.muted(finalTime)}`;\n  }\n}\n\n/**\n * Context usage meter with color transitions\n */\nexport class ContextMeter {\n  private percentage = 0;\n  private targetPercentage = 0;\n  private animationFrame: NodeJS.Timeout | null = null;\n\n  update(percentage: number): void {\n    this.targetPercentage = Math.min(100, Math.max(0, percentage));\n    this.animate();\n  }\n\n  private animate(): void {\n    if (this.animationFrame) {\n      clearTimeout(this.animationFrame);\n    }\n\n    const step = () => {\n      const diff = this.targetPercentage - this.percentage;\n      if (Math.abs(diff) < 0.5) {\n        this.percentage = this.targetPercentage;\n        return;\n      }\n\n      // Smooth easing\n      this.percentage += diff * 0.15;\n      this.animationFrame = setTimeout(step, 16); // ~60 FPS\n    };\n\n    step();\n  }\n\n  render(): string {\n    const pct = Math.round(clampPercentage(this.percentage));\n    const color = getContextColor(pct, {\n      error: theme.error,\n      warning: theme.warning,\n      info: theme.info,\n      success: theme.success,\n    });\n\n    return `${theme.ui.muted('ctx')} ${color(`${pct}%`)}`;\n  }\n\n  dispose(): void {\n    if (this.animationFrame) {\n      clearTimeout(this.animationFrame);\n    }\n  }\n}\n\n/**\n * Animated typing indicator (for showing AI is responding)\n */\nexport class TypingIndicator {\n  private frames = ['▌', '▐', '▌', ' '];\n  private frameIndex = 0;\n  private intervalId: NodeJS.Timeout | null = null;\n  private onUpdate?: (frame: string) => void;\n\n  start(onUpdate?: (frame: string) => void): void {\n    this.onUpdate = onUpdate;\n    this.intervalId = setInterval(() => {\n      this.frameIndex = (this.frameIndex + 1) % this.frames.length;\n      if (this.onUpdate) {\n        this.onUpdate(this.render());\n      }\n    }, 530); // Blink at cursor rate\n  }\n\n  stop(): void {\n    if (this.intervalId) {\n      clearInterval(this.intervalId);\n      this.intervalId = null;\n    }\n    this.onUpdate = undefined;\n  }\n\n  render(): string {\n    return theme.info(this.frames[this.frameIndex] ?? '▌');\n  }\n\n  dispose(): void {\n    this.stop();\n  }\n}\n\n/**\n * Wave animation for processing states\n */\nexport class WaveIndicator {\n  private frames = ['∙∙∙∙∙', '●∙∙∙∙', '∙●∙∙∙', '∙∙●∙∙', '∙∙∙●∙', '∙∙∙∙●', '∙∙∙∙∙'];\n  private frameIndex = 0;\n  private intervalId: NodeJS.Timeout | null = null;\n  private onUpdate?: (frame: string) => void;\n\n  start(onUpdate?: (frame: string) => void): void {\n    this.onUpdate = onUpdate;\n    this.intervalId = setInterval(() => {\n      this.frameIndex = (this.frameIndex + 1) % this.frames.length;\n      if (this.onUpdate) {\n        this.onUpdate(this.render());\n      }\n    }, 120);\n  }\n\n  stop(): void {\n    if (this.intervalId) {\n      clearInterval(this.intervalId);\n      this.intervalId = null;\n    }\n    this.onUpdate = undefined;\n  }\n\n  render(): string {\n    return theme.info(this.frames[this.frameIndex] ?? '∙∙∙∙∙');\n  }\n\n  dispose(): void {\n    this.stop();\n  }\n}\n\n// Export singleton cleanup\nexport function disposeAnimations(): void {\n  schedulerDisposed = true; // Prevent recreation\n  if (globalScheduler) {\n    globalScheduler.dispose();\n    globalScheduler = null;\n  }\n}\n\n// Reset function for testing or re-initialization scenarios\nexport function resetAnimationScheduler(): void {\n  if (globalScheduler) {\n    globalScheduler.dispose();\n    globalScheduler = null;\n  }\n  schedulerDisposed = false;\n}\n"],"mappings":"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","ignoreList":[]}