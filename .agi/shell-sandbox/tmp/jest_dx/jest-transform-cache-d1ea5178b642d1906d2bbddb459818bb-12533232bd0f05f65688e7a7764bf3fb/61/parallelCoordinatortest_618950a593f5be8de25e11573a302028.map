{"version":3,"names":["_parallelCoordinator","require","moduleA","id","label","scope","steps","moduleB","makeResult","module","status","describe","it","runner","execute","tasks","batchId","results","taskId","result","durationMs","attempts","startedAt","completedAt","undefined","totalDurationMs","successCount","failureCount","parallelismAchieved","coordinator","ParallelCoordinator","reports","runModules","concurrency","mode","modeDefinition","description","variants","parallelVariants","continueOnFailure","variantStats","primaryWins","refinerWins","ties","totalSteps","processModule","emit","expect","toHaveLength","toBe"],"sources":["parallelCoordinator.test.ts"],"sourcesContent":["import { ParallelCoordinator } from '../../src/core/parallelCoordinator.js';\nimport type { RepoUpgradeModule, UpgradeModuleReport } from '../../src/core/repoUpgradeOrchestrator.js';\nimport type { ParallelTask, BatchResult } from '../../src/core/parallelExecutor.js';\n\nconst moduleA: RepoUpgradeModule = { id: 'a', label: 'A', scope: [], steps: [] };\nconst moduleB: RepoUpgradeModule = { id: 'b', label: 'B', scope: [], steps: [] };\n\nfunction makeResult(module: RepoUpgradeModule): UpgradeModuleReport {\n  return { id: module.id, label: module.label, scope: module.scope, steps: [], status: 'completed' };\n}\n\ndescribe('ParallelCoordinator', () => {\n  it('returns all results when continueOnFailure is true', async () => {\n    const runner = {\n      execute: async (tasks: ParallelTask<UpgradeModuleReport>[]): Promise<BatchResult<UpgradeModuleReport>> => ({\n        batchId: 'batch',\n        results: [\n          { taskId: tasks[0]!.id, status: 'completed', result: makeResult(moduleA), durationMs: 1, attempts: 1, startedAt: 0, completedAt: 1 },\n          { taskId: tasks[1]!.id, status: 'failed', result: undefined, durationMs: 1, attempts: 1, startedAt: 0, completedAt: 1 },\n        ],\n        totalDurationMs: 2,\n        successCount: 1,\n        failureCount: 1,\n        parallelismAchieved: 1,\n      }),\n    };\n\n    const coordinator = new ParallelCoordinator(() => runner);\n    const reports = await coordinator.runModules(\n      {\n        concurrency: 2,\n        mode: 'dual-rl-tournament',\n        modeDefinition: { id: 'dual-rl-tournament', label: '', description: '', variants: ['primary', 'refiner'] },\n        parallelVariants: true,\n        continueOnFailure: true,\n        variantStats: { primaryWins: 0, refinerWins: 0, ties: 0, totalSteps: 0 },\n        processModule: async (module) => makeResult(module),\n        emit: () => undefined,\n      },\n      [moduleA, moduleB]\n    );\n\n    expect(reports).toHaveLength(2);\n    expect(reports[0]?.status).toBe('completed');\n    expect(reports[1]?.status).toBe('failed');\n  });\n\n  it('truncates after first failure when continueOnFailure is false', async () => {\n    const runner = {\n      execute: async (tasks: ParallelTask<UpgradeModuleReport>[]): Promise<BatchResult<UpgradeModuleReport>> => ({\n        batchId: 'batch',\n        results: [\n          { taskId: tasks[0]!.id, status: 'completed', result: makeResult(moduleA), durationMs: 1, attempts: 1, startedAt: 0, completedAt: 1 },\n          { taskId: tasks[1]!.id, status: 'failed', result: undefined, durationMs: 1, attempts: 1, startedAt: 0, completedAt: 1 },\n          { taskId: tasks[2]!.id, status: 'completed', result: makeResult(moduleB), durationMs: 1, attempts: 1, startedAt: 0, completedAt: 1 },\n        ],\n        totalDurationMs: 3,\n        successCount: 2,\n        failureCount: 1,\n        parallelismAchieved: 1,\n      }),\n    };\n\n    const coordinator = new ParallelCoordinator(() => runner);\n    const reports = await coordinator.runModules(\n      {\n        concurrency: 2,\n        mode: 'dual-rl-tournament',\n        modeDefinition: { id: 'dual-rl-tournament', label: '', description: '', variants: ['primary', 'refiner'] },\n        parallelVariants: true,\n        continueOnFailure: false,\n        variantStats: { primaryWins: 0, refinerWins: 0, ties: 0, totalSteps: 0 },\n        processModule: async (module) => makeResult(module),\n        emit: () => undefined,\n      },\n      [moduleA, moduleB, { ...moduleB, id: 'c', label: 'C' }]\n    );\n\n    expect(reports).toHaveLength(2); // includes the failed one, truncates after\n    expect(reports[1]?.status).toBe('failed');\n  });\n});\n"],"mappings":"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","ignoreList":[]}