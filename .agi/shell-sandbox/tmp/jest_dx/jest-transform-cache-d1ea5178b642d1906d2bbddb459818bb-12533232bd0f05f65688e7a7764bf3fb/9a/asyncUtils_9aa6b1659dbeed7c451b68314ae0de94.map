{"version":3,"names":["RateLimiter","tokens","lastRefill","maxTokens","refillRate","constructor","config","maxRequests","windowMs","Date","now","refill","elapsed","tokensToAdd","Math","min","acquire","waitTime","sleep","tryAcquire","availableTokens","floor","exports","throttle","fn","lastCall","lastResult","pendingCall","pendingArgs","intervalMs","leading","trailing","throttled","args","setTimeout","debounce","delayMs","timeoutId","debounced","clearTimeout","TTLCache","cache","Map","ttlMs","maxSize","Infinity","get","key","entry","undefined","expiresAt","delete","value","set","size","has","oldestKey","keys","next","clear","prune","keysToDelete","forEach","push","memoize","keyFn","JSON","stringify","memoized","cached","result","ConcurrencyPool","running","queue","maxConcurrent","timeout","run","withTimeout","release","Promise","resolve","reject","shift","pending","length","active","parallelMap","items","concurrency","pool","all","map","item","index","ms","promise","timeoutMs","errorMessage","timeoutPromise","_","Error","race","retry","maxRetries","baseDelayMs","maxDelayMs","backoffMultiplier","shouldRetry","lastError","attempt","error","delay","pow","_default","default"],"sources":["asyncUtils.ts"],"sourcesContent":["/**\n * Async Utilities Module\n *\n * Production-ready async patterns for rate limiting, throttling,\n * concurrency control, and caching with TTL.\n *\n * Principal Investigator: Bo Shang\n * Framework: agi-cli\n */\n\n// ============================================================================\n// Types\n// ============================================================================\n\nexport interface RateLimiterConfig {\n  maxRequests: number;\n  windowMs: number;\n}\n\nexport interface ThrottleConfig {\n  intervalMs: number;\n  leading?: boolean;\n  trailing?: boolean;\n}\n\nexport interface CacheEntry<T> {\n  value: T;\n  expiresAt: number;\n}\n\nexport interface CacheConfig {\n  ttlMs: number;\n  maxSize?: number;\n}\n\nexport interface ConcurrencyConfig {\n  maxConcurrent: number;\n  timeout?: number;\n}\n\n// ============================================================================\n// Rate Limiter (Token Bucket)\n// ============================================================================\n\nexport class RateLimiter {\n  private tokens: number;\n  private lastRefill: number;\n  private readonly maxTokens: number;\n  private readonly refillRate: number;\n\n  constructor(config: RateLimiterConfig) {\n    this.maxTokens = config.maxRequests;\n    this.tokens = config.maxRequests;\n    this.refillRate = config.maxRequests / config.windowMs;\n    this.lastRefill = Date.now();\n  }\n\n  private refill(): void {\n    const now = Date.now();\n    const elapsed = now - this.lastRefill;\n    const tokensToAdd = elapsed * this.refillRate;\n    this.tokens = Math.min(this.maxTokens, this.tokens + tokensToAdd);\n    this.lastRefill = now;\n  }\n\n  async acquire(): Promise<void> {\n    this.refill();\n\n    if (this.tokens >= 1) {\n      this.tokens -= 1;\n      return;\n    }\n\n    // Wait for a token to become available\n    const waitTime = (1 - this.tokens) / this.refillRate;\n    await sleep(waitTime);\n    this.refill();\n    this.tokens -= 1;\n  }\n\n  tryAcquire(): boolean {\n    this.refill();\n    if (this.tokens >= 1) {\n      this.tokens -= 1;\n      return true;\n    }\n    return false;\n  }\n\n  get availableTokens(): number {\n    this.refill();\n    return Math.floor(this.tokens);\n  }\n}\n\n// ============================================================================\n// Throttle & Debounce\n// ============================================================================\n\nexport function throttle<T extends (...args: unknown[]) => unknown>(\n  fn: T,\n  config: ThrottleConfig\n): (...args: Parameters<T>) => ReturnType<T> | undefined {\n  let lastCall = 0;\n  let lastResult: ReturnType<T> | undefined;\n  let pendingCall: NodeJS.Timeout | null = null;\n  let pendingArgs: Parameters<T> | null = null;\n\n  const { intervalMs, leading = true, trailing = true } = config;\n\n  return function throttled(...args: Parameters<T>): ReturnType<T> | undefined {\n    const now = Date.now();\n    const elapsed = now - lastCall;\n\n    if (elapsed >= intervalMs) {\n      // Enough time has passed\n      if (leading || lastCall !== 0) {\n        lastCall = now;\n        lastResult = fn(...args) as ReturnType<T>;\n        return lastResult;\n      }\n    }\n\n    // Store args for potential trailing call\n    if (trailing) {\n      pendingArgs = args;\n\n      if (!pendingCall) {\n        pendingCall = setTimeout(() => {\n          if (pendingArgs) {\n            lastCall = Date.now();\n            lastResult = fn(...pendingArgs) as ReturnType<T>;\n            pendingArgs = null;\n          }\n          pendingCall = null;\n        }, intervalMs - elapsed);\n      }\n    }\n\n    return lastResult;\n  };\n}\n\nexport function debounce<T extends (...args: unknown[]) => unknown>(\n  fn: T,\n  delayMs: number\n): (...args: Parameters<T>) => void {\n  let timeoutId: NodeJS.Timeout | null = null;\n\n  return function debounced(...args: Parameters<T>): void {\n    if (timeoutId) {\n      clearTimeout(timeoutId);\n    }\n    timeoutId = setTimeout(() => {\n      fn(...args);\n      timeoutId = null;\n    }, delayMs);\n  };\n}\n\n// ============================================================================\n// TTL Cache\n// ============================================================================\n\nexport class TTLCache<K, V> {\n  private cache = new Map<K, CacheEntry<V>>();\n  private readonly ttlMs: number;\n  private readonly maxSize: number;\n\n  constructor(config: CacheConfig) {\n    this.ttlMs = config.ttlMs;\n    this.maxSize = config.maxSize ?? Infinity;\n  }\n\n  get(key: K): V | undefined {\n    const entry = this.cache.get(key);\n    if (!entry) return undefined;\n\n    if (Date.now() > entry.expiresAt) {\n      this.cache.delete(key);\n      return undefined;\n    }\n\n    return entry.value;\n  }\n\n  set(key: K, value: V, ttlMs?: number): void {\n    // Evict oldest if at capacity\n    if (this.cache.size >= this.maxSize && !this.cache.has(key)) {\n      const oldestKey = this.cache.keys().next().value;\n      if (oldestKey !== undefined) {\n        this.cache.delete(oldestKey);\n      }\n    }\n\n    this.cache.set(key, {\n      value,\n      expiresAt: Date.now() + (ttlMs ?? this.ttlMs),\n    });\n  }\n\n  has(key: K): boolean {\n    return this.get(key) !== undefined;\n  }\n\n  delete(key: K): boolean {\n    return this.cache.delete(key);\n  }\n\n  clear(): void {\n    this.cache.clear();\n  }\n\n  get size(): number {\n    this.prune();\n    return this.cache.size;\n  }\n\n  private prune(): void {\n    const now = Date.now();\n    const keysToDelete: K[] = [];\n    this.cache.forEach((entry, key) => {\n      if (now > entry.expiresAt) {\n        keysToDelete.push(key);\n      }\n    });\n    keysToDelete.forEach(key => this.cache.delete(key));\n  }\n}\n\n// ============================================================================\n// Memoize with TTL\n// ============================================================================\n\nexport function memoize<T extends (...args: unknown[]) => unknown>(\n  fn: T,\n  config: CacheConfig & { keyFn?: (...args: Parameters<T>) => string }\n): T {\n  const cache = new TTLCache<string, ReturnType<T>>(config);\n  const keyFn = config.keyFn ?? ((...args) => JSON.stringify(args));\n\n  return function memoized(...args: Parameters<T>): ReturnType<T> {\n    const key = keyFn(...args);\n    const cached = cache.get(key);\n\n    if (cached !== undefined) {\n      return cached;\n    }\n\n    const result = fn(...args) as ReturnType<T>;\n    cache.set(key, result);\n    return result;\n  } as T;\n}\n\n// ============================================================================\n// Concurrency Pool\n// ============================================================================\n\nexport class ConcurrencyPool {\n  private running = 0;\n  private queue: Array<{ resolve: () => void; reject: (err: Error) => void }> = [];\n  private readonly maxConcurrent: number;\n  private readonly timeout: number | undefined;\n\n  constructor(config: ConcurrencyConfig) {\n    this.maxConcurrent = config.maxConcurrent;\n    this.timeout = config.timeout;\n  }\n\n  async run<T>(fn: () => Promise<T>): Promise<T> {\n    await this.acquire();\n\n    try {\n      if (this.timeout) {\n        return await withTimeout(fn(), this.timeout);\n      }\n      return await fn();\n    } finally {\n      this.release();\n    }\n  }\n\n  private async acquire(): Promise<void> {\n    if (this.running < this.maxConcurrent) {\n      this.running++;\n      return;\n    }\n\n    return new Promise((resolve, reject) => {\n      this.queue.push({ resolve, reject });\n    });\n  }\n\n  private release(): void {\n    this.running--;\n    const next = this.queue.shift();\n    if (next) {\n      this.running++;\n      next.resolve();\n    }\n  }\n\n  get pending(): number {\n    return this.queue.length;\n  }\n\n  get active(): number {\n    return this.running;\n  }\n}\n\n// ============================================================================\n// Parallel Map with Concurrency Limit\n// ============================================================================\n\nexport async function parallelMap<T, R>(\n  items: T[],\n  fn: (item: T, index: number) => Promise<R>,\n  concurrency: number = 5\n): Promise<R[]> {\n  const pool = new ConcurrencyPool({ maxConcurrent: concurrency });\n  return Promise.all(\n    items.map((item, index) => pool.run(() => fn(item, index)))\n  );\n}\n\n// ============================================================================\n// Utility Functions\n// ============================================================================\n\nexport function sleep(ms: number): Promise<void> {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nexport async function withTimeout<T>(\n  promise: Promise<T>,\n  timeoutMs: number,\n  errorMessage = 'Operation timed out'\n): Promise<T> {\n  let timeoutId: NodeJS.Timeout;\n\n  const timeoutPromise = new Promise<never>((_, reject) => {\n    timeoutId = setTimeout(() => reject(new Error(errorMessage)), timeoutMs);\n  });\n\n  try {\n    return await Promise.race([promise, timeoutPromise]);\n  } finally {\n    clearTimeout(timeoutId!);\n  }\n}\n\nexport async function retry<T>(\n  fn: () => Promise<T>,\n  config: {\n    maxRetries?: number;\n    baseDelayMs?: number;\n    maxDelayMs?: number;\n    backoffMultiplier?: number;\n    shouldRetry?: (error: unknown) => boolean;\n  } = {}\n): Promise<T> {\n  const {\n    maxRetries = 3,\n    baseDelayMs = 1000,\n    maxDelayMs = 30000,\n    backoffMultiplier = 2,\n    shouldRetry = () => true,\n  } = config;\n\n  let lastError: unknown;\n\n  for (let attempt = 0; attempt <= maxRetries; attempt++) {\n    try {\n      return await fn();\n    } catch (error) {\n      lastError = error;\n\n      if (attempt === maxRetries || !shouldRetry(error)) {\n        throw error;\n      }\n\n      const delay = Math.min(\n        baseDelayMs * Math.pow(backoffMultiplier, attempt),\n        maxDelayMs\n      );\n      await sleep(delay);\n    }\n  }\n\n  throw lastError;\n}\n\n// ============================================================================\n// Exports\n// ============================================================================\n\nexport default {\n  RateLimiter,\n  TTLCache,\n  ConcurrencyPool,\n  throttle,\n  debounce,\n  memoize,\n  parallelMap,\n  sleep,\n  withTimeout,\n  retry,\n};\n"],"mappings":"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","ignoreList":[]}