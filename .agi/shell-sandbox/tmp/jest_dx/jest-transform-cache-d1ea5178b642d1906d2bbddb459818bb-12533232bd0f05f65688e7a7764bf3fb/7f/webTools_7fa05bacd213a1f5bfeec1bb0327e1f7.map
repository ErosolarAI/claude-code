{"version":3,"names":["cov_2962i44vzn","actualCoverage","getSecretValue","buildError","createWebTools","f","s","name","description","parameters","type","properties","query","maxResults","searchDepth","enum","includeAnswer","required","additionalProperties","handler","args","b","trim","Math","min","tavilyKey","searchTavily","error","urls","items","url","Array","isArray","filter","u","length","slice","extractTavily","join","apiKey","options","controller","AbortController","timeout","setTimeout","abort","response","fetch","method","headers","body","JSON","stringify","api_key","search_depth","include_answer","max_results","signal","ok","text","Error","status","data","json","formatTavilyResults","clearTimeout","formatExtractResults","provider","lines","answer","push","results","i","result","title","content","snippet","published_date","raw_content"],"sources":["webTools.ts"],"sourcesContent":["/**\n * Web Tools - Web search and content extraction capabilities\n *\n * Provides:\n * - WebSearch: Search the web using Tavily\n * - WebExtract: Extract and summarize content from URLs\n */\n\nimport type { ToolDefinition } from '../core/toolRuntime.js';\nimport { getSecretValue } from '../core/secretStore.js';\nimport { buildError } from '../core/errors.js';\n\ninterface TavilySearchResult {\n  title: string;\n  url: string;\n  content: string;\n  score?: number;\n  published_date?: string;\n}\n\ninterface TavilySearchResponse {\n  results: TavilySearchResult[];\n  answer?: string;\n  query: string;\n}\n\ninterface TavilyExtractResponse {\n  results: Array<{\n    url: string;\n    raw_content: string;\n  }>;\n}\n\n/**\n * Create web tools for search and extraction.\n */\nexport function createWebTools(): ToolDefinition[] {\n  return [\n    {\n      name: 'WebSearch',\n      description: 'Search the web for information using Tavily. Returns relevant results from search engines. Requires TAVILY_API_KEY.',\n      parameters: {\n        type: 'object',\n        properties: {\n          query: {\n            type: 'string',\n            description: 'The search query',\n          },\n          maxResults: {\n            type: 'number',\n            description: 'Maximum number of results to return (default: 5, max: 10)',\n          },\n          searchDepth: {\n            type: 'string',\n            enum: ['basic', 'advanced'],\n            description: 'Search depth: basic (fast) or advanced (thorough). Default: basic',\n          },\n          includeAnswer: {\n            type: 'boolean',\n            description: 'Include AI-generated answer summary. Default: true',\n          },\n        },\n        required: ['query'],\n        additionalProperties: false,\n      },\n      handler: async (args) => {\n        const query = args['query'];\n        if (typeof query !== 'string' || !query.trim()) {\n          return 'Error: query is required';\n        }\n\n        const maxResults = Math.min(\n          typeof args['maxResults'] === 'number' ? args['maxResults'] : 5,\n          10\n        );\n        const searchDepth = args['searchDepth'] === 'advanced' ? 'advanced' : 'basic';\n        const includeAnswer = args['includeAnswer'] !== false;\n\n        try {\n          const tavilyKey = getSecretValue('TAVILY_API_KEY');\n          if (!tavilyKey) {\n            return 'WebSearch requires TAVILY_API_KEY to be configured. Use /secrets set TAVILY_API_KEY to configure.';\n          }\n\n          return await searchTavily(query, tavilyKey, { maxResults, searchDepth, includeAnswer });\n        } catch (error) {\n          return buildError('WebSearch', error, { query });\n        }\n      },\n    },\n    {\n      name: 'WebExtract',\n      description: 'Extract and summarize content from one or more URLs. Uses Tavily for high-quality extraction. Requires TAVILY_API_KEY.',\n      parameters: {\n        type: 'object',\n        properties: {\n          urls: {\n            type: 'array',\n            items: { type: 'string' },\n            description: 'URLs to extract content from (max 5)',\n          },\n          url: {\n            type: 'string',\n            description: 'Single URL to extract content from (alternative to urls array)',\n          },\n        },\n        additionalProperties: false,\n      },\n      handler: async (args) => {\n        let urls: string[] = [];\n\n        if (Array.isArray(args['urls'])) {\n          urls = args['urls'].filter((u): u is string => typeof u === 'string');\n        } else if (typeof args['url'] === 'string') {\n          urls = [args['url']];\n        }\n\n        if (urls.length === 0) {\n          return 'Error: at least one URL is required';\n        }\n\n        // Limit to 5 URLs\n        urls = urls.slice(0, 5);\n\n        const tavilyKey = getSecretValue('TAVILY_API_KEY');\n        if (!tavilyKey) {\n          return 'WebExtract requires TAVILY_API_KEY to be configured. Use /secrets set TAVILY_API_KEY to configure.';\n        }\n\n        try {\n          return await extractTavily(urls, tavilyKey);\n        } catch (error) {\n          return buildError('WebExtract', error, { urls: urls.join(', ') });\n        }\n      },\n    },\n  ];\n}\n\n/**\n * Search using Tavily API (recommended provider)\n */\nasync function searchTavily(\n  query: string,\n  apiKey: string,\n  options: { maxResults: number; searchDepth: string; includeAnswer: boolean }\n): Promise<string> {\n  const controller = new AbortController();\n  const timeout = setTimeout(() => controller.abort(), 24 * 60 * 60 * 1000); // 24 hour timeout\n\n  try {\n    const response = await fetch('https://api.tavily.com/search', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        api_key: apiKey,\n        query,\n        search_depth: options.searchDepth,\n        include_answer: options.includeAnswer,\n        max_results: options.maxResults,\n      }),\n      signal: controller.signal,\n    });\n    if (!response.ok) {\n      const text = await response.text();\n      throw new Error(`Tavily API error: ${response.status} ${text}`);\n    }\n\n    const data = (await response.json()) as TavilySearchResponse;\n    return formatTavilyResults(data, 'Tavily');\n  } catch (error) {\n    if (error instanceof Error && error.name === 'AbortError') {\n      throw new Error('Tavily search timed out after 30 seconds');\n    }\n    throw error;\n  } finally {\n    clearTimeout(timeout);\n  }\n}\n\n/**\n * Extract content using Tavily Extract API\n */\nasync function extractTavily(urls: string[], apiKey: string): Promise<string> {\n  const response = await fetch('https://api.tavily.com/extract', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      api_key: apiKey,\n      urls,\n    }),\n  });\n\n  if (!response.ok) {\n    const text = await response.text();\n    throw new Error(`Tavily Extract API error: ${response.status} ${text}`);\n  }\n\n  const data = (await response.json()) as TavilyExtractResponse;\n  return formatExtractResults(data);\n}\n\n/**\n * Format Tavily search results with enhanced markdown formatting\n */\nfunction formatTavilyResults(data: TavilySearchResponse, provider: string): string {\n  const lines: string[] = [`[WebSearch via ${provider}]`, ''];\n\n  if (data.answer) {\n    lines.push('**Summary:**', data.answer, '');\n  }\n\n  if (!data.results || data.results.length === 0) {\n    lines.push('No results found.');\n    return lines.join('\\n');\n  }\n\n  if (data.results.length > 0) {\n    lines.push('**Search Results:**');\n    lines.push('');\n\n    for (let i = 0; i < data.results.length; i++) {\n      const result = data.results[i];\n\n      // Format as numbered list with clickable title link\n      lines.push(`${i + 1}. **[${result.title}](${result.url})**`);\n\n      if (result.content) {\n        const snippet = result.content.length > 300\n          ? result.content.slice(0, 300) + '...'\n          : result.content;\n        lines.push(`   ${snippet}`);\n      }\n\n      if (result.published_date) {\n        lines.push(`   *Published: ${result.published_date}*`);\n      }\n\n      lines.push('');\n    }\n  }\n\n  return lines.join('\\n');\n}\n\n/**\n * Format Tavily extract results with enhanced markdown formatting\n */\nfunction formatExtractResults(data: TavilyExtractResponse): string {\n  const lines: string[] = ['[WebExtract via Tavily]', ''];\n\n  if (!data.results || data.results.length === 0) {\n    lines.push('No content extracted.');\n    return lines.join('\\n');\n  }\n\n  for (let i = 0; i < data.results.length; i++) {\n    const result = data.results[i];\n\n    lines.push(`### Source ${i + 1}: [${result.url}](${result.url})`);\n    lines.push('');\n    if (result.raw_content) {\n      // Truncate very long content\n      const content = result.raw_content.length > 5000\n        ? result.raw_content.slice(0, 5000) + '\\n\\n*[Content truncated...]*'\n        : result.raw_content;\n      lines.push(content);\n    }\n    lines.push('');\n    if (i < data.results.length - 1) {\n      lines.push('---');\n      lines.push('');\n    }\n  }\n\n  return lines.join('\\n');\n}\n\n// Export types for testing\nexport type { TavilySearchResponse };\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}