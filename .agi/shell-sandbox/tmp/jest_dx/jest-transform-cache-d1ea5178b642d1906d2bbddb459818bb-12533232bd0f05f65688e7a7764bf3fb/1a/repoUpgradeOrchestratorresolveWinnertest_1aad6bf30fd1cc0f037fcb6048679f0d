422a5e040e56b4a95c9f05b04f586668
"use strict";

var _repoUpgradeOrchestrator = require("../src/core/repoUpgradeOrchestrator.js");
var _winnerStrategy = require("../src/core/winnerStrategy.js");
describe('RepoUpgradeOrchestrator.resolveWinner core-first', () => {
  it('prefers refiner when scores tie but accuracy is higher', async () => {
    const orchestrator = new _repoUpgradeOrchestrator.RepoUpgradeOrchestrator(async () => ({
      success: true,
      summary: 'noop',
      score: 0
    }));
    const mode = _repoUpgradeOrchestrator.REPO_UPGRADE_MODE_DEFINITIONS['dual-rl-tournament'];
    const primary = {
      success: true,
      summary: 'p',
      score: 0.5,
      humanAccuracy: 0.2
    };
    const refiner = {
      success: true,
      summary: 'r',
      score: 0.5,
      humanAccuracy: 0.8
    };

    // @ts-expect-error private helper exposed for test
    const pickWinner = orchestrator.pickWinner.bind(orchestrator);
    const outcome = (0, _winnerStrategy.resolveWinner)({
      modeDefinition: mode,
      variantResults: {
        primary,
        refiner
      },
      tournamentOutcome: null
    }, pickWinner);
    expect(outcome.winnerVariant).toBe('refiner');
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfcmVwb1VwZ3JhZGVPcmNoZXN0cmF0b3IiLCJyZXF1aXJlIiwiX3dpbm5lclN0cmF0ZWd5IiwiZGVzY3JpYmUiLCJpdCIsIm9yY2hlc3RyYXRvciIsIlJlcG9VcGdyYWRlT3JjaGVzdHJhdG9yIiwic3VjY2VzcyIsInN1bW1hcnkiLCJzY29yZSIsIm1vZGUiLCJSRVBPX1VQR1JBREVfTU9ERV9ERUZJTklUSU9OUyIsInByaW1hcnkiLCJodW1hbkFjY3VyYWN5IiwicmVmaW5lciIsInBpY2tXaW5uZXIiLCJiaW5kIiwib3V0Y29tZSIsInJlc29sdmVXaW5uZXJTdHJhdGVneSIsIm1vZGVEZWZpbml0aW9uIiwidmFyaWFudFJlc3VsdHMiLCJ0b3VybmFtZW50T3V0Y29tZSIsImV4cGVjdCIsIndpbm5lclZhcmlhbnQiLCJ0b0JlIl0sInNvdXJjZXMiOlsicmVwb1VwZ3JhZGVPcmNoZXN0cmF0b3IucmVzb2x2ZVdpbm5lci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlcG9VcGdyYWRlT3JjaGVzdHJhdG9yLCBSRVBPX1VQR1JBREVfTU9ERV9ERUZJTklUSU9OUywgdHlwZSBVcGdyYWRlU3RlcFJlc3VsdCB9IGZyb20gJy4uL3NyYy9jb3JlL3JlcG9VcGdyYWRlT3JjaGVzdHJhdG9yLmpzJztcbmltcG9ydCB7IHJlc29sdmVXaW5uZXIgYXMgcmVzb2x2ZVdpbm5lclN0cmF0ZWd5IH0gZnJvbSAnLi4vc3JjL2NvcmUvd2lubmVyU3RyYXRlZ3kuanMnO1xuXG5kZXNjcmliZSgnUmVwb1VwZ3JhZGVPcmNoZXN0cmF0b3IucmVzb2x2ZVdpbm5lciBjb3JlLWZpcnN0JywgKCkgPT4ge1xuICBpdCgncHJlZmVycyByZWZpbmVyIHdoZW4gc2NvcmVzIHRpZSBidXQgYWNjdXJhY3kgaXMgaGlnaGVyJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IG9yY2hlc3RyYXRvciA9IG5ldyBSZXBvVXBncmFkZU9yY2hlc3RyYXRvcihhc3luYyAoKSA9PiAoe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHN1bW1hcnk6ICdub29wJyxcbiAgICAgIHNjb3JlOiAwLFxuICAgIH0pKTtcbiAgICBjb25zdCBtb2RlID0gUkVQT19VUEdSQURFX01PREVfREVGSU5JVElPTlNbJ2R1YWwtcmwtdG91cm5hbWVudCddO1xuXG4gICAgY29uc3QgcHJpbWFyeTogVXBncmFkZVN0ZXBSZXN1bHQgPSB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgc3VtbWFyeTogJ3AnLFxuICAgICAgc2NvcmU6IDAuNSxcbiAgICAgIGh1bWFuQWNjdXJhY3k6IDAuMixcbiAgICB9O1xuICAgIGNvbnN0IHJlZmluZXI6IFVwZ3JhZGVTdGVwUmVzdWx0ID0ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHN1bW1hcnk6ICdyJyxcbiAgICAgIHNjb3JlOiAwLjUsXG4gICAgICBodW1hbkFjY3VyYWN5OiAwLjgsXG4gICAgfTtcblxuICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgcHJpdmF0ZSBoZWxwZXIgZXhwb3NlZCBmb3IgdGVzdFxuICAgIGNvbnN0IHBpY2tXaW5uZXIgPSBvcmNoZXN0cmF0b3IucGlja1dpbm5lci5iaW5kKG9yY2hlc3RyYXRvcik7XG5cbiAgICBjb25zdCBvdXRjb21lID0gcmVzb2x2ZVdpbm5lclN0cmF0ZWd5KFxuICAgICAge1xuICAgICAgICBtb2RlRGVmaW5pdGlvbjogbW9kZSxcbiAgICAgICAgdmFyaWFudFJlc3VsdHM6IHsgcHJpbWFyeSwgcmVmaW5lciB9LFxuICAgICAgICB0b3VybmFtZW50T3V0Y29tZTogbnVsbCxcbiAgICAgIH0sXG4gICAgICBwaWNrV2lubmVyXG4gICAgKTtcbiAgICBleHBlY3Qob3V0Y29tZS53aW5uZXJWYXJpYW50KS50b0JlKCdyZWZpbmVyJyk7XG4gIH0pO1xufSk7XG4iXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBQUEsd0JBQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLGVBQUEsR0FBQUQsT0FBQTtBQUVBRSxRQUFRLENBQUMsa0RBQWtELEVBQUUsTUFBTTtFQUNqRUMsRUFBRSxDQUFDLHdEQUF3RCxFQUFFLFlBQVk7SUFDdkUsTUFBTUMsWUFBWSxHQUFHLElBQUlDLGdEQUF1QixDQUFDLGFBQWE7TUFDNURDLE9BQU8sRUFBRSxJQUFJO01BQ2JDLE9BQU8sRUFBRSxNQUFNO01BQ2ZDLEtBQUssRUFBRTtJQUNULENBQUMsQ0FBQyxDQUFDO0lBQ0gsTUFBTUMsSUFBSSxHQUFHQyxzREFBNkIsQ0FBQyxvQkFBb0IsQ0FBQztJQUVoRSxNQUFNQyxPQUEwQixHQUFHO01BQ2pDTCxPQUFPLEVBQUUsSUFBSTtNQUNiQyxPQUFPLEVBQUUsR0FBRztNQUNaQyxLQUFLLEVBQUUsR0FBRztNQUNWSSxhQUFhLEVBQUU7SUFDakIsQ0FBQztJQUNELE1BQU1DLE9BQTBCLEdBQUc7TUFDakNQLE9BQU8sRUFBRSxJQUFJO01BQ2JDLE9BQU8sRUFBRSxHQUFHO01BQ1pDLEtBQUssRUFBRSxHQUFHO01BQ1ZJLGFBQWEsRUFBRTtJQUNqQixDQUFDOztJQUVEO0lBQ0EsTUFBTUUsVUFBVSxHQUFHVixZQUFZLENBQUNVLFVBQVUsQ0FBQ0MsSUFBSSxDQUFDWCxZQUFZLENBQUM7SUFFN0QsTUFBTVksT0FBTyxHQUFHLElBQUFDLDZCQUFxQixFQUNuQztNQUNFQyxjQUFjLEVBQUVULElBQUk7TUFDcEJVLGNBQWMsRUFBRTtRQUFFUixPQUFPO1FBQUVFO01BQVEsQ0FBQztNQUNwQ08saUJBQWlCLEVBQUU7SUFDckIsQ0FBQyxFQUNETixVQUNGLENBQUM7SUFDRE8sTUFBTSxDQUFDTCxPQUFPLENBQUNNLGFBQWEsQ0FBQyxDQUFDQyxJQUFJLENBQUMsU0FBUyxDQUFDO0VBQy9DLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==