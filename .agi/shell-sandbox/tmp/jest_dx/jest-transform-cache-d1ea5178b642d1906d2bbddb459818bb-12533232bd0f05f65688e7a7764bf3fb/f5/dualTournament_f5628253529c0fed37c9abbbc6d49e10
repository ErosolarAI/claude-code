01fd6bd236a0c013f44e563bf46375c8
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.DEFAULT_HUMAN_REWARD_WEIGHTS = void 0;
exports.runDualTournament = runDualTournament;
/**
 * Dual Tournament Engine
 *
 * Shared scoring/ranking utilities used by dual tournaments in both /upgrade and /attack flows.
 * Encodes policy vs evaluator tournaments with human-like reward heuristics and multi-evaluator
 * aggregation to approximate human code review preferences.
 */

const DEFAULT_HUMAN_REWARD_WEIGHTS = exports.DEFAULT_HUMAN_REWARD_WEIGHTS = {
  alpha: 0.6,
  beta: 0.25,
  gamma: 0.15
};
/**
  * Run a dual tournament over candidate patches/agents, combining hard metrics,
  * human-like reward heuristics, and evaluator rankings.
  */
function runDualTournament(task, candidates, options = {}) {
  const maxCandidates = options.maxCandidates ?? 8;
  const boundedCandidates = candidates.slice(0, Math.max(1, maxCandidates));

  // Fast path: single candidate - avoid unnecessary aggregation work
  if (boundedCandidates.length === 1) {
    const solo = boundedCandidates[0];
    const correctness = scoreCorrectness(solo.metrics);
    const quality = scoreQuality(solo.metrics, options.preferSmallerDiff ?? true);
    const learned = scoreLearnedSignals(solo.signals);
    const aggregateScore = combineReward(correctness, quality, learned, options.rewardWeights ?? DEFAULT_HUMAN_REWARD_WEIGHTS);
    const ranked = [{
      candidateId: solo.id,
      aggregateScore,
      humanAccuracy: 1,
      rank: 1,
      correctnessScore: correctness,
      qualityScore: quality,
      learnedScore: learned,
      evaluatorScore: aggregateScore
    }];
    return {
      task,
      ranked,
      pairwise: {},
      evaluatorBreakdown: {}
    };
  }
  const rewardWeights = options.rewardWeights ?? DEFAULT_HUMAN_REWARD_WEIGHTS;
  const evaluatorWeights = new Map();
  for (const evaluator of options.evaluators ?? []) {
    const eloWeight = evaluator.elo ? 1 + Math.max(0, (evaluator.elo - 1200) / 2400) : 1;
    evaluatorWeights.set(evaluator.id, (evaluator.weight ?? 1) * eloWeight);
  }

  // Compute evaluator aggregates and pairwise wins first (needed for composite score)
  const {
    aggregatedEvaluatorScores,
    pairwise,
    evaluatorBreakdown
  } = aggregateEvaluatorScores(boundedCandidates, evaluatorWeights);
  const ranked = boundedCandidates.map(candidate => {
    const correctness = scoreCorrectness(candidate.metrics);
    const quality = scoreQuality(candidate.metrics, options.preferSmallerDiff ?? true);
    const learned = scoreLearnedSignals(candidate.signals);
    const rewardScore = combineReward(correctness, quality, learned, rewardWeights);
    const evaluatorScore = aggregatedEvaluatorScores.get(candidate.id) ?? rewardScore;

    // Combine human-like reward with evaluator aggregate (relative preference)
    // Weighted 60/40 toward human-like reward to maintain quality focus while incorporating evaluator consensus
    const aggregateScore = clamp(0.60 * rewardScore + 0.40 * evaluatorScore);
    return {
      candidateId: candidate.id,
      aggregateScore,
      humanAccuracy: 0,
      rank: 0,
      // set after sorting
      correctnessScore: correctness,
      qualityScore: quality,
      learnedScore: learned,
      evaluatorScore
    };
  });
  ranked.sort((a, b) => b.aggregateScore - a.aggregateScore);
  ranked.forEach((entry, idx) => {
    entry.rank = idx + 1;
    entry.humanAccuracy = computeHumanAccuracy(idx, ranked.length);
  });
  return {
    task,
    ranked,
    pairwise,
    evaluatorBreakdown
  };
}

// ════════════════════════════════════════════════════════════════════════════
// Internal scoring helpers
// ════════════════════════════════════════════════════════════════════════════

function scoreCorrectness(metrics) {
  if (!metrics) return 0.5;
  const execution = metrics.executionSuccess ?? 0;
  const tests = metrics.testsPassed ?? 0;
  const failures = metrics.testsFailed ?? 0;
  const toolSuccess = metrics.toolSuccesses ? Math.min(1, metrics.toolSuccesses / 3) : 0;
  let score = execution * 0.35 + tests * 0.45 + toolSuccess * 0.2;
  if (failures > 0) {
    score -= Math.min(0.35, failures * 0.1);
  }
  return clamp(score);
}
function scoreQuality(metrics, preferSmallerDiff = true) {
  if (!metrics) return 0.5;
  const staticAnalysis = metrics.staticAnalysis ?? 0.5;
  const codeQuality = metrics.codeQuality ?? 0.5;
  const complexityComponent = typeof metrics.complexityDelta === 'number' ? metrics.complexityDelta < 0 ? 0.7 : 0.45 : 0.55;
  const blastRadius = metrics.blastRadius ?? (preferSmallerDiff && metrics.diffSize ? 1 - clamp(metrics.diffSize / 500) : 0.55);
  const dependencyPenalty = metrics.dependenciesAdded ? Math.min(0.3, metrics.dependenciesAdded * 0.05) : 0;
  const warningPenalty = metrics.warnings ? Math.min(0.2, metrics.warnings * 0.05) : 0;
  let score = staticAnalysis * 0.35 + codeQuality * 0.25 + blastRadius * 0.25 + complexityComponent * 0.15;
  score -= dependencyPenalty + warningPenalty;
  return clamp(score);
}
function scoreLearnedSignals(signals) {
  if (!signals) return 0.5;
  const rewardModel = signals.rewardModelScore;
  const human = signals.humanPreference;
  const self = signals.selfAssessment;

  // Prioritize reward model score as primary signal (40%)
  // Human preference as secondary (35%)
  // Self-assessment as tertiary (25%)
  // This weights external validation more than self-confidence
  const components = [{
    value: rewardModel,
    weight: 0.40,
    default: 0.5
  }, {
    value: human,
    weight: 0.35,
    default: 0.5
  }, {
    value: self,
    weight: 0.25,
    default: 0.5
  }];
  let totalWeight = 0;
  let weightedSum = 0;
  for (const comp of components) {
    if (typeof comp.value === 'number') {
      weightedSum += comp.value * comp.weight;
      totalWeight += comp.weight;
    } else {
      weightedSum += comp.default * comp.weight;
      totalWeight += comp.weight;
    }
  }
  return totalWeight > 0 ? clamp(weightedSum / totalWeight) : 0.5;
}
function combineReward(correctness, quality, learned, weights) {
  const weighted = weights.alpha * correctness + weights.beta * quality + weights.gamma * learned;
  const total = weights.alpha + weights.beta + weights.gamma;
  return total > 0 ? clamp(weighted / total) : clamp(weighted);
}
function aggregateEvaluatorScores(candidates, evaluatorWeights) {
  const pairwise = {};
  const aggregated = new Map();
  const evaluatorBreakdown = {};
  if (candidates.length === 0) {
    return {
      aggregatedEvaluatorScores: aggregated,
      pairwise,
      evaluatorBreakdown
    };
  }

  // Pre-size for small tournaments to avoid unnecessary O(n^2) when not needed
  const twoCandidateFastPath = candidates.length <= 2;
  const candidateIds = candidates.map(c => c.id);
  for (const id of candidateIds) {
    pairwise[id] = {};
    for (const other of candidateIds) {
      if (id !== other) pairwise[id][other] = 0;
    }
  }

  // Collect scores per evaluator
  const scoresByEvaluator = new Map();
  for (const candidate of candidates) {
    for (const score of candidate.evaluatorScores ?? []) {
      if (!scoresByEvaluator.has(score.evaluatorId)) {
        scoresByEvaluator.set(score.evaluatorId, []);
      }
      scoresByEvaluator.get(score.evaluatorId).push({
        evaluatorId: score.evaluatorId,
        score: clamp(score.score),
        weight: score.weight,
        notes: score.notes,
        candidateId: candidate.id
      });
    }
  }

  // If no evaluator scores provided, fall back to neutral rankings
  if (scoresByEvaluator.size === 0) {
    const fallback = [];
    for (const candidate of candidates) {
      // Use candidate's own reward signals if available
      const candidateScore = candidate.signals?.rewardModelScore ?? 0.5;
      fallback.push({
        evaluatorId: 'reward-fallback',
        score: candidateScore,
        weight: 1,
        candidateId: candidate.id
      });
    }
    scoresByEvaluator.set('reward-fallback', fallback);
  }
  let totalBordaWeight = 0;
  for (const [evaluatorId, rawScores] of scoresByEvaluator.entries()) {
    const weight = evaluatorWeights.get(evaluatorId) ?? 1;
    totalBordaWeight += weight * Math.max(1, candidates.length - 1);

    // Sort descending by score to assign ranks (Borda)
    const ranked = rawScores.filter(entry => typeof entry.score === 'number').sort((a, b) => (b.score ?? 0) - (a.score ?? 0));
    evaluatorBreakdown[evaluatorId] = ranked.map(({
      candidateId: _,
      ...rest
    }) => rest);
    ranked.forEach((entry, idx) => {
      const candidateId = entry.candidateId;
      const bordaPoints = (candidates.length - idx - 1) * weight;
      aggregated.set(candidateId, (aggregated.get(candidateId) ?? 0) + bordaPoints);
    });

    // Pairwise wins for this evaluator (lightweight path for <=2 candidates)
    if (twoCandidateFastPath && ranked.length === 2) {
      const higher = ranked[0];
      const lower = ranked[1];
      if (higher.score === lower.score) {
        pairwise[higher.candidateId][lower.candidateId] += weight * 0.5;
        pairwise[lower.candidateId][higher.candidateId] += weight * 0.5;
      } else {
        pairwise[higher.candidateId][lower.candidateId] += weight;
      }
    } else {
      for (let i = 0; i < ranked.length; i++) {
        for (let j = i + 1; j < ranked.length; j++) {
          const higher = ranked[i];
          const lower = ranked[j];
          if (higher.score === lower.score) {
            pairwise[higher.candidateId][lower.candidateId] += weight * 0.5;
            pairwise[lower.candidateId][higher.candidateId] += weight * 0.5;
          } else {
            pairwise[higher.candidateId][lower.candidateId] += weight;
          }
        }
      }
    }
  }

  // Normalize aggregated Borda scores into [0,1]
  if (totalBordaWeight > 0) {
    for (const [candidateId, points] of aggregated.entries()) {
      aggregated.set(candidateId, clamp(points / totalBordaWeight));
    }
  }

  // Ensure every candidate has an entry
  for (const candidateId of candidateIds) {
    if (!aggregated.has(candidateId)) {
      aggregated.set(candidateId, 0.5);
    }
  }
  return {
    aggregatedEvaluatorScores: aggregated,
    pairwise,
    evaluatorBreakdown
  };
}
function clamp(value, min = 0, max = 1) {
  if (Number.isNaN(value)) return min;
  return Math.max(min, Math.min(max, value));
}
function computeHumanAccuracy(rankIndex, total) {
  if (total <= 1) return 1;
  const maxIndex = Math.max(1, total - 1);
  const relative = 1 - rankIndex / maxIndex;
  return clamp(relative);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJERUZBVUxUX0hVTUFOX1JFV0FSRF9XRUlHSFRTIiwiZXhwb3J0cyIsImFscGhhIiwiYmV0YSIsImdhbW1hIiwicnVuRHVhbFRvdXJuYW1lbnQiLCJ0YXNrIiwiY2FuZGlkYXRlcyIsIm9wdGlvbnMiLCJtYXhDYW5kaWRhdGVzIiwiYm91bmRlZENhbmRpZGF0ZXMiLCJzbGljZSIsIk1hdGgiLCJtYXgiLCJsZW5ndGgiLCJzb2xvIiwiY29ycmVjdG5lc3MiLCJzY29yZUNvcnJlY3RuZXNzIiwibWV0cmljcyIsInF1YWxpdHkiLCJzY29yZVF1YWxpdHkiLCJwcmVmZXJTbWFsbGVyRGlmZiIsImxlYXJuZWQiLCJzY29yZUxlYXJuZWRTaWduYWxzIiwic2lnbmFscyIsImFnZ3JlZ2F0ZVNjb3JlIiwiY29tYmluZVJld2FyZCIsInJld2FyZFdlaWdodHMiLCJyYW5rZWQiLCJjYW5kaWRhdGVJZCIsImlkIiwiaHVtYW5BY2N1cmFjeSIsInJhbmsiLCJjb3JyZWN0bmVzc1Njb3JlIiwicXVhbGl0eVNjb3JlIiwibGVhcm5lZFNjb3JlIiwiZXZhbHVhdG9yU2NvcmUiLCJwYWlyd2lzZSIsImV2YWx1YXRvckJyZWFrZG93biIsImV2YWx1YXRvcldlaWdodHMiLCJNYXAiLCJldmFsdWF0b3IiLCJldmFsdWF0b3JzIiwiZWxvV2VpZ2h0IiwiZWxvIiwic2V0Iiwid2VpZ2h0IiwiYWdncmVnYXRlZEV2YWx1YXRvclNjb3JlcyIsImFnZ3JlZ2F0ZUV2YWx1YXRvclNjb3JlcyIsIm1hcCIsImNhbmRpZGF0ZSIsInJld2FyZFNjb3JlIiwiZ2V0IiwiY2xhbXAiLCJzb3J0IiwiYSIsImIiLCJmb3JFYWNoIiwiZW50cnkiLCJpZHgiLCJjb21wdXRlSHVtYW5BY2N1cmFjeSIsImV4ZWN1dGlvbiIsImV4ZWN1dGlvblN1Y2Nlc3MiLCJ0ZXN0cyIsInRlc3RzUGFzc2VkIiwiZmFpbHVyZXMiLCJ0ZXN0c0ZhaWxlZCIsInRvb2xTdWNjZXNzIiwidG9vbFN1Y2Nlc3NlcyIsIm1pbiIsInNjb3JlIiwic3RhdGljQW5hbHlzaXMiLCJjb2RlUXVhbGl0eSIsImNvbXBsZXhpdHlDb21wb25lbnQiLCJjb21wbGV4aXR5RGVsdGEiLCJibGFzdFJhZGl1cyIsImRpZmZTaXplIiwiZGVwZW5kZW5jeVBlbmFsdHkiLCJkZXBlbmRlbmNpZXNBZGRlZCIsIndhcm5pbmdQZW5hbHR5Iiwid2FybmluZ3MiLCJyZXdhcmRNb2RlbCIsInJld2FyZE1vZGVsU2NvcmUiLCJodW1hbiIsImh1bWFuUHJlZmVyZW5jZSIsInNlbGYiLCJzZWxmQXNzZXNzbWVudCIsImNvbXBvbmVudHMiLCJ2YWx1ZSIsImRlZmF1bHQiLCJ0b3RhbFdlaWdodCIsIndlaWdodGVkU3VtIiwiY29tcCIsIndlaWdodHMiLCJ3ZWlnaHRlZCIsInRvdGFsIiwiYWdncmVnYXRlZCIsInR3b0NhbmRpZGF0ZUZhc3RQYXRoIiwiY2FuZGlkYXRlSWRzIiwiYyIsIm90aGVyIiwic2NvcmVzQnlFdmFsdWF0b3IiLCJldmFsdWF0b3JTY29yZXMiLCJoYXMiLCJldmFsdWF0b3JJZCIsInB1c2giLCJub3RlcyIsInNpemUiLCJmYWxsYmFjayIsImNhbmRpZGF0ZVNjb3JlIiwidG90YWxCb3JkYVdlaWdodCIsInJhd1Njb3JlcyIsImVudHJpZXMiLCJmaWx0ZXIiLCJfIiwicmVzdCIsImJvcmRhUG9pbnRzIiwiaGlnaGVyIiwibG93ZXIiLCJpIiwiaiIsInBvaW50cyIsIk51bWJlciIsImlzTmFOIiwicmFua0luZGV4IiwibWF4SW5kZXgiLCJyZWxhdGl2ZSJdLCJzb3VyY2VzIjpbImR1YWxUb3VybmFtZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRHVhbCBUb3VybmFtZW50IEVuZ2luZVxuICpcbiAqIFNoYXJlZCBzY29yaW5nL3JhbmtpbmcgdXRpbGl0aWVzIHVzZWQgYnkgZHVhbCB0b3VybmFtZW50cyBpbiBib3RoIC91cGdyYWRlIGFuZCAvYXR0YWNrIGZsb3dzLlxuICogRW5jb2RlcyBwb2xpY3kgdnMgZXZhbHVhdG9yIHRvdXJuYW1lbnRzIHdpdGggaHVtYW4tbGlrZSByZXdhcmQgaGV1cmlzdGljcyBhbmQgbXVsdGktZXZhbHVhdG9yXG4gKiBhZ2dyZWdhdGlvbiB0byBhcHByb3hpbWF0ZSBodW1hbiBjb2RlIHJldmlldyBwcmVmZXJlbmNlcy5cbiAqL1xuXG5leHBvcnQgdHlwZSBQb2xpY3lJZCA9IHN0cmluZztcblxuZXhwb3J0IGludGVyZmFjZSBUb3VybmFtZW50UG9saWN5IHtcbiAgaWQ6IFBvbGljeUlkO1xuICBsYWJlbD86IHN0cmluZztcbiAga2luZD86ICdwcmltYXJ5JyB8ICdyZWZpbmVyJyB8ICdjaGVja3BvaW50JyB8ICdhdHRhY2snO1xuICBlbG8/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVG91cm5hbWVudEV2YWx1YXRvciB7XG4gIGlkOiBzdHJpbmc7XG4gIGxhYmVsPzogc3RyaW5nO1xuICAvKiogV2VpZ2h0IHVzZWQgd2hlbiBjb21iaW5pbmcgZXZhbHVhdG9yIHJhbmtpbmdzIChjYW4gYmUgaW5mbHVlbmNlZCBieSBoaXN0b3JpY2FsIEVMTykuICovXG4gIHdlaWdodD86IG51bWJlcjtcbiAga2luZD86ICdoYXJkJyB8ICdzb2Z0JyB8ICdoeWJyaWQnO1xuICBlbG8/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVG91cm5hbWVudFRhc2sge1xuICBpZDogc3RyaW5nO1xuICBnb2FsOiBzdHJpbmc7XG4gIHJlcG9TbmFwc2hvdD86IHN0cmluZztcbiAgdGVzdHM/OiBzdHJpbmdbXTtcbiAgY29uc3RyYWludHM/OiBzdHJpbmdbXTtcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDYW5kaWRhdGVNZXRyaWNzIHtcbiAgZXhlY3V0aW9uU3VjY2Vzcz86IG51bWJlcjsgLy8gMC0xXG4gIHRlc3RzUGFzc2VkPzogbnVtYmVyOyAvLyAwLTFcbiAgdGVzdHNGYWlsZWQ/OiBudW1iZXI7IC8vIGNvdW50XG4gIHN0YXRpY0FuYWx5c2lzPzogbnVtYmVyOyAvLyAwLTFcbiAgY29kZVF1YWxpdHk/OiBudW1iZXI7IC8vIDAtMVxuICBibGFzdFJhZGl1cz86IG51bWJlcjsgLy8gMC0xIChzbWFsbGVyIGRpZmYgPT4gaGlnaGVyKVxuICBkaWZmU2l6ZT86IG51bWJlcjsgLy8gbGluZXMgY2hhbmdlZFxuICBjb21wbGV4aXR5RGVsdGE/OiBudW1iZXI7IC8vIG5lZ2F0aXZlIGJldHRlclxuICBkZXBlbmRlbmNpZXNBZGRlZD86IG51bWJlcjsgLy8gY291bnRcbiAgc3BlZWRCb251cz86IG51bWJlcjsgLy8gMC0xXG4gIHRvb2xTdWNjZXNzZXM/OiBudW1iZXI7IC8vIGNvdW50XG4gIHRvb2xGYWlsdXJlcz86IG51bWJlcjsgLy8gY291bnRcbiAgd2FybmluZ3M/OiBudW1iZXI7IC8vIGNvdW50XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2FuZGlkYXRlU2lnbmFscyB7XG4gIC8qKiBMZWFybmVkIHJld2FyZCBtb2RlbCAvIHByZWZlcmVuY2Ugc2NvcmUgKDAtMSkgKi9cbiAgcmV3YXJkTW9kZWxTY29yZT86IG51bWJlcjtcbiAgLyoqIFNlbGYtYXNzZXNzZWQgY29uZmlkZW5jZSBmcm9tIHRoZSBhZ2VudCAoMC0xKSAqL1xuICBzZWxmQXNzZXNzbWVudD86IG51bWJlcjtcbiAgLyoqIE9wdGlvbmFsIGh1bWFuIHByZWZlcmVuY2UgbGFiZWwgKDAtMSkgKi9cbiAgaHVtYW5QcmVmZXJlbmNlPzogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEV2YWx1YXRvclNjb3JlIHtcbiAgZXZhbHVhdG9ySWQ6IHN0cmluZztcbiAgc2NvcmU6IG51bWJlcjtcbiAgd2VpZ2h0PzogbnVtYmVyO1xuICBub3Rlcz86IHN0cmluZztcbn1cblxudHlwZSBDYW5kaWRhdGVFdmFsdWF0b3JTY29yZSA9IEV2YWx1YXRvclNjb3JlICYgeyBjYW5kaWRhdGVJZDogc3RyaW5nIH07XG5cbmV4cG9ydCBpbnRlcmZhY2UgVG91cm5hbWVudENhbmRpZGF0ZSB7XG4gIGlkOiBzdHJpbmc7XG4gIHBvbGljeUlkOiBQb2xpY3lJZDtcbiAgcGF0Y2hTdW1tYXJ5Pzogc3RyaW5nO1xuICBkaWZmU3VtbWFyeT86IHN0cmluZztcbiAgbWV0cmljcz86IENhbmRpZGF0ZU1ldHJpY3M7XG4gIHNpZ25hbHM/OiBDYW5kaWRhdGVTaWduYWxzO1xuICBldmFsdWF0b3JTY29yZXM/OiBFdmFsdWF0b3JTY29yZVtdO1xuICByYXdPdXRwdXQ/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSHVtYW5SZXdhcmRXZWlnaHRzIHtcbiAgLyoqIENvcnJlY3RuZXNzIHdlaWdodCAqL1xuICBhbHBoYTogbnVtYmVyO1xuICAvKiogQ29kZSBxdWFsaXR5IC8gcm9idXN0bmVzcyB3ZWlnaHQgKi9cbiAgYmV0YTogbnVtYmVyO1xuICAvKiogTGVhcm5lZCByZXdhcmQgLyBodW1hbiBwcmVmZXJlbmNlIHdlaWdodCAqL1xuICBnYW1tYTogbnVtYmVyO1xufVxuXG5leHBvcnQgY29uc3QgREVGQVVMVF9IVU1BTl9SRVdBUkRfV0VJR0hUUzogSHVtYW5SZXdhcmRXZWlnaHRzID0ge1xuICBhbHBoYTogMC42LFxuICBiZXRhOiAwLjI1LFxuICBnYW1tYTogMC4xNSxcbn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmFua2VkQ2FuZGlkYXRlIHtcbiAgY2FuZGlkYXRlSWQ6IHN0cmluZztcbiAgYWdncmVnYXRlU2NvcmU6IG51bWJlcjtcbiAgLyoqIFJlbGF0aXZlIGh1bWFuLWxpa2UgYWNjdXJhY3kgKDEgPSBiZXN0IHJhbmssIDAgPSB3b3JzdCByYW5rKSAqL1xuICBodW1hbkFjY3VyYWN5OiBudW1iZXI7XG4gIHJhbms6IG51bWJlcjtcbiAgY29ycmVjdG5lc3NTY29yZTogbnVtYmVyO1xuICBxdWFsaXR5U2NvcmU6IG51bWJlcjtcbiAgbGVhcm5lZFNjb3JlOiBudW1iZXI7XG4gIGV2YWx1YXRvclNjb3JlOiBudW1iZXI7XG59XG5cbmV4cG9ydCB0eXBlIFBhaXJ3aXNlV2lucyA9IFJlY29yZDxzdHJpbmcsIFJlY29yZDxzdHJpbmcsIG51bWJlcj4+O1xuXG5leHBvcnQgaW50ZXJmYWNlIFRvdXJuYW1lbnRPdXRjb21lIHtcbiAgdGFzazogVG91cm5hbWVudFRhc2s7XG4gIHJhbmtlZDogUmFua2VkQ2FuZGlkYXRlW107XG4gIHBhaXJ3aXNlOiBQYWlyd2lzZVdpbnM7XG4gIGV2YWx1YXRvckJyZWFrZG93bjogUmVjb3JkPHN0cmluZywgRXZhbHVhdG9yU2NvcmVbXT47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVG91cm5hbWVudE9wdGlvbnMge1xuICByZXdhcmRXZWlnaHRzPzogSHVtYW5SZXdhcmRXZWlnaHRzO1xuICBldmFsdWF0b3JzPzogVG91cm5hbWVudEV2YWx1YXRvcltdO1xuICAvKiogV2hlbiB0cnVlLCBwcmVmZXIgc21hbGxlciBkaWZmcyBieSBkZWZhdWx0IGlmIGRpZmZTaXplIGlzIHByb3ZpZGVkICovXG4gIHByZWZlclNtYWxsZXJEaWZmPzogYm9vbGVhbjtcbiAgLyoqIE1heGltdW0gY2FuZGlkYXRlcyB0byBldmFsdWF0ZSAoY2FwcyBPKG5eMikgd29yaykgKi9cbiAgbWF4Q2FuZGlkYXRlcz86IG51bWJlcjtcbn1cblxuLyoqXG4gICogUnVuIGEgZHVhbCB0b3VybmFtZW50IG92ZXIgY2FuZGlkYXRlIHBhdGNoZXMvYWdlbnRzLCBjb21iaW5pbmcgaGFyZCBtZXRyaWNzLFxuICAqIGh1bWFuLWxpa2UgcmV3YXJkIGhldXJpc3RpY3MsIGFuZCBldmFsdWF0b3IgcmFua2luZ3MuXG4gICovXG5leHBvcnQgZnVuY3Rpb24gcnVuRHVhbFRvdXJuYW1lbnQoXG4gIHRhc2s6IFRvdXJuYW1lbnRUYXNrLFxuICBjYW5kaWRhdGVzOiBUb3VybmFtZW50Q2FuZGlkYXRlW10sXG4gIG9wdGlvbnM6IFRvdXJuYW1lbnRPcHRpb25zID0ge31cbik6IFRvdXJuYW1lbnRPdXRjb21lIHtcbiAgY29uc3QgbWF4Q2FuZGlkYXRlcyA9IG9wdGlvbnMubWF4Q2FuZGlkYXRlcyA/PyA4O1xuICBjb25zdCBib3VuZGVkQ2FuZGlkYXRlcyA9IGNhbmRpZGF0ZXMuc2xpY2UoMCwgTWF0aC5tYXgoMSwgbWF4Q2FuZGlkYXRlcykpO1xuXG4gIC8vIEZhc3QgcGF0aDogc2luZ2xlIGNhbmRpZGF0ZSAtIGF2b2lkIHVubmVjZXNzYXJ5IGFnZ3JlZ2F0aW9uIHdvcmtcbiAgaWYgKGJvdW5kZWRDYW5kaWRhdGVzLmxlbmd0aCA9PT0gMSkge1xuICAgIGNvbnN0IHNvbG8gPSBib3VuZGVkQ2FuZGlkYXRlc1swXSE7XG4gICAgY29uc3QgY29ycmVjdG5lc3MgPSBzY29yZUNvcnJlY3RuZXNzKHNvbG8ubWV0cmljcyk7XG4gICAgY29uc3QgcXVhbGl0eSA9IHNjb3JlUXVhbGl0eShzb2xvLm1ldHJpY3MsIG9wdGlvbnMucHJlZmVyU21hbGxlckRpZmYgPz8gdHJ1ZSk7XG4gICAgY29uc3QgbGVhcm5lZCA9IHNjb3JlTGVhcm5lZFNpZ25hbHMoc29sby5zaWduYWxzKTtcbiAgICBjb25zdCBhZ2dyZWdhdGVTY29yZSA9IGNvbWJpbmVSZXdhcmQoY29ycmVjdG5lc3MsIHF1YWxpdHksIGxlYXJuZWQsIG9wdGlvbnMucmV3YXJkV2VpZ2h0cyA/PyBERUZBVUxUX0hVTUFOX1JFV0FSRF9XRUlHSFRTKTtcblxuICAgIGNvbnN0IHJhbmtlZDogUmFua2VkQ2FuZGlkYXRlW10gPSBbe1xuICAgICAgY2FuZGlkYXRlSWQ6IHNvbG8uaWQsXG4gICAgICBhZ2dyZWdhdGVTY29yZSxcbiAgICAgIGh1bWFuQWNjdXJhY3k6IDEsXG4gICAgICByYW5rOiAxLFxuICAgICAgY29ycmVjdG5lc3NTY29yZTogY29ycmVjdG5lc3MsXG4gICAgICBxdWFsaXR5U2NvcmU6IHF1YWxpdHksXG4gICAgICBsZWFybmVkU2NvcmU6IGxlYXJuZWQsXG4gICAgICBldmFsdWF0b3JTY29yZTogYWdncmVnYXRlU2NvcmUsXG4gICAgfV07XG5cbiAgICByZXR1cm4ge1xuICAgICAgdGFzayxcbiAgICAgIHJhbmtlZCxcbiAgICAgIHBhaXJ3aXNlOiB7fSxcbiAgICAgIGV2YWx1YXRvckJyZWFrZG93bjoge30sXG4gICAgfTtcbiAgfVxuXG4gIGNvbnN0IHJld2FyZFdlaWdodHMgPSBvcHRpb25zLnJld2FyZFdlaWdodHMgPz8gREVGQVVMVF9IVU1BTl9SRVdBUkRfV0VJR0hUUztcbiAgY29uc3QgZXZhbHVhdG9yV2VpZ2h0cyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG4gIGZvciAoY29uc3QgZXZhbHVhdG9yIG9mIG9wdGlvbnMuZXZhbHVhdG9ycyA/PyBbXSkge1xuICAgIGNvbnN0IGVsb1dlaWdodCA9IGV2YWx1YXRvci5lbG8gPyAxICsgTWF0aC5tYXgoMCwgKGV2YWx1YXRvci5lbG8gLSAxMjAwKSAvIDI0MDApIDogMTtcbiAgICBldmFsdWF0b3JXZWlnaHRzLnNldChldmFsdWF0b3IuaWQsIChldmFsdWF0b3Iud2VpZ2h0ID8/IDEpICogZWxvV2VpZ2h0KTtcbiAgfVxuXG4gIC8vIENvbXB1dGUgZXZhbHVhdG9yIGFnZ3JlZ2F0ZXMgYW5kIHBhaXJ3aXNlIHdpbnMgZmlyc3QgKG5lZWRlZCBmb3IgY29tcG9zaXRlIHNjb3JlKVxuICBjb25zdCB7IGFnZ3JlZ2F0ZWRFdmFsdWF0b3JTY29yZXMsIHBhaXJ3aXNlLCBldmFsdWF0b3JCcmVha2Rvd24gfSA9IGFnZ3JlZ2F0ZUV2YWx1YXRvclNjb3JlcyhcbiAgICBib3VuZGVkQ2FuZGlkYXRlcyxcbiAgICBldmFsdWF0b3JXZWlnaHRzXG4gICk7XG5cbiAgY29uc3QgcmFua2VkOiBSYW5rZWRDYW5kaWRhdGVbXSA9IGJvdW5kZWRDYW5kaWRhdGVzLm1hcCgoY2FuZGlkYXRlKSA9PiB7XG4gICAgY29uc3QgY29ycmVjdG5lc3MgPSBzY29yZUNvcnJlY3RuZXNzKGNhbmRpZGF0ZS5tZXRyaWNzKTtcbiAgICBjb25zdCBxdWFsaXR5ID0gc2NvcmVRdWFsaXR5KGNhbmRpZGF0ZS5tZXRyaWNzLCBvcHRpb25zLnByZWZlclNtYWxsZXJEaWZmID8/IHRydWUpO1xuICAgIGNvbnN0IGxlYXJuZWQgPSBzY29yZUxlYXJuZWRTaWduYWxzKGNhbmRpZGF0ZS5zaWduYWxzKTtcbiAgICBjb25zdCByZXdhcmRTY29yZSA9IGNvbWJpbmVSZXdhcmQoY29ycmVjdG5lc3MsIHF1YWxpdHksIGxlYXJuZWQsIHJld2FyZFdlaWdodHMpO1xuICAgIGNvbnN0IGV2YWx1YXRvclNjb3JlID0gYWdncmVnYXRlZEV2YWx1YXRvclNjb3Jlcy5nZXQoY2FuZGlkYXRlLmlkKSA/PyByZXdhcmRTY29yZTtcblxuICAgIC8vIENvbWJpbmUgaHVtYW4tbGlrZSByZXdhcmQgd2l0aCBldmFsdWF0b3IgYWdncmVnYXRlIChyZWxhdGl2ZSBwcmVmZXJlbmNlKVxuICAgIC8vIFdlaWdodGVkIDYwLzQwIHRvd2FyZCBodW1hbi1saWtlIHJld2FyZCB0byBtYWludGFpbiBxdWFsaXR5IGZvY3VzIHdoaWxlIGluY29ycG9yYXRpbmcgZXZhbHVhdG9yIGNvbnNlbnN1c1xuICAgIGNvbnN0IGFnZ3JlZ2F0ZVNjb3JlID0gY2xhbXAoMC42MCAqIHJld2FyZFNjb3JlICsgMC40MCAqIGV2YWx1YXRvclNjb3JlKTtcblxuICAgIHJldHVybiB7XG4gICAgICBjYW5kaWRhdGVJZDogY2FuZGlkYXRlLmlkLFxuICAgICAgYWdncmVnYXRlU2NvcmUsXG4gICAgICBodW1hbkFjY3VyYWN5OiAwLFxuICAgICAgcmFuazogMCwgLy8gc2V0IGFmdGVyIHNvcnRpbmdcbiAgICAgIGNvcnJlY3RuZXNzU2NvcmU6IGNvcnJlY3RuZXNzLFxuICAgICAgcXVhbGl0eVNjb3JlOiBxdWFsaXR5LFxuICAgICAgbGVhcm5lZFNjb3JlOiBsZWFybmVkLFxuICAgICAgZXZhbHVhdG9yU2NvcmUsXG4gICAgfTtcbiAgfSk7XG5cbiAgcmFua2VkLnNvcnQoKGEsIGIpID0+IGIuYWdncmVnYXRlU2NvcmUgLSBhLmFnZ3JlZ2F0ZVNjb3JlKTtcbiAgcmFua2VkLmZvckVhY2goKGVudHJ5LCBpZHgpID0+IHtcbiAgICBlbnRyeS5yYW5rID0gaWR4ICsgMTtcbiAgICBlbnRyeS5odW1hbkFjY3VyYWN5ID0gY29tcHV0ZUh1bWFuQWNjdXJhY3koaWR4LCByYW5rZWQubGVuZ3RoKTtcbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICB0YXNrLFxuICAgIHJhbmtlZCxcbiAgICBwYWlyd2lzZSxcbiAgICBldmFsdWF0b3JCcmVha2Rvd24sXG4gIH07XG59XG5cbi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxuLy8gSW50ZXJuYWwgc2NvcmluZyBoZWxwZXJzXG4vLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcblxuZnVuY3Rpb24gc2NvcmVDb3JyZWN0bmVzcyhtZXRyaWNzPzogQ2FuZGlkYXRlTWV0cmljcyk6IG51bWJlciB7XG4gIGlmICghbWV0cmljcykgcmV0dXJuIDAuNTtcblxuICBjb25zdCBleGVjdXRpb24gPSBtZXRyaWNzLmV4ZWN1dGlvblN1Y2Nlc3MgPz8gMDtcbiAgY29uc3QgdGVzdHMgPSBtZXRyaWNzLnRlc3RzUGFzc2VkID8/IDA7XG4gIGNvbnN0IGZhaWx1cmVzID0gbWV0cmljcy50ZXN0c0ZhaWxlZCA/PyAwO1xuICBjb25zdCB0b29sU3VjY2VzcyA9IG1ldHJpY3MudG9vbFN1Y2Nlc3NlcyA/IE1hdGgubWluKDEsIG1ldHJpY3MudG9vbFN1Y2Nlc3NlcyAvIDMpIDogMDtcblxuICBsZXQgc2NvcmUgPSBleGVjdXRpb24gKiAwLjM1ICsgdGVzdHMgKiAwLjQ1ICsgdG9vbFN1Y2Nlc3MgKiAwLjI7XG4gIGlmIChmYWlsdXJlcyA+IDApIHtcbiAgICBzY29yZSAtPSBNYXRoLm1pbigwLjM1LCBmYWlsdXJlcyAqIDAuMSk7XG4gIH1cblxuICByZXR1cm4gY2xhbXAoc2NvcmUpO1xufVxuXG5mdW5jdGlvbiBzY29yZVF1YWxpdHkobWV0cmljcz86IENhbmRpZGF0ZU1ldHJpY3MsIHByZWZlclNtYWxsZXJEaWZmID0gdHJ1ZSk6IG51bWJlciB7XG4gIGlmICghbWV0cmljcykgcmV0dXJuIDAuNTtcblxuICBjb25zdCBzdGF0aWNBbmFseXNpcyA9IG1ldHJpY3Muc3RhdGljQW5hbHlzaXMgPz8gMC41O1xuICBjb25zdCBjb2RlUXVhbGl0eSA9IG1ldHJpY3MuY29kZVF1YWxpdHkgPz8gMC41O1xuICBjb25zdCBjb21wbGV4aXR5Q29tcG9uZW50ID1cbiAgICB0eXBlb2YgbWV0cmljcy5jb21wbGV4aXR5RGVsdGEgPT09ICdudW1iZXInXG4gICAgICA/IG1ldHJpY3MuY29tcGxleGl0eURlbHRhIDwgMFxuICAgICAgICA/IDAuN1xuICAgICAgICA6IDAuNDVcbiAgICAgIDogMC41NTtcblxuICBjb25zdCBibGFzdFJhZGl1cyA9XG4gICAgbWV0cmljcy5ibGFzdFJhZGl1cyA/P1xuICAgIChwcmVmZXJTbWFsbGVyRGlmZiAmJiBtZXRyaWNzLmRpZmZTaXplID8gMSAtIGNsYW1wKG1ldHJpY3MuZGlmZlNpemUgLyA1MDApIDogMC41NSk7XG5cbiAgY29uc3QgZGVwZW5kZW5jeVBlbmFsdHkgPSBtZXRyaWNzLmRlcGVuZGVuY2llc0FkZGVkID8gTWF0aC5taW4oMC4zLCBtZXRyaWNzLmRlcGVuZGVuY2llc0FkZGVkICogMC4wNSkgOiAwO1xuICBjb25zdCB3YXJuaW5nUGVuYWx0eSA9IG1ldHJpY3Mud2FybmluZ3MgPyBNYXRoLm1pbigwLjIsIG1ldHJpY3Mud2FybmluZ3MgKiAwLjA1KSA6IDA7XG5cbiAgbGV0IHNjb3JlID0gc3RhdGljQW5hbHlzaXMgKiAwLjM1ICsgY29kZVF1YWxpdHkgKiAwLjI1ICsgYmxhc3RSYWRpdXMgKiAwLjI1ICsgY29tcGxleGl0eUNvbXBvbmVudCAqIDAuMTU7XG4gIHNjb3JlIC09IGRlcGVuZGVuY3lQZW5hbHR5ICsgd2FybmluZ1BlbmFsdHk7XG5cbiAgcmV0dXJuIGNsYW1wKHNjb3JlKTtcbn1cblxuZnVuY3Rpb24gc2NvcmVMZWFybmVkU2lnbmFscyhzaWduYWxzPzogQ2FuZGlkYXRlU2lnbmFscyk6IG51bWJlciB7XG4gIGlmICghc2lnbmFscykgcmV0dXJuIDAuNTtcblxuICBjb25zdCByZXdhcmRNb2RlbCA9IHNpZ25hbHMucmV3YXJkTW9kZWxTY29yZTtcbiAgY29uc3QgaHVtYW4gPSBzaWduYWxzLmh1bWFuUHJlZmVyZW5jZTtcbiAgY29uc3Qgc2VsZiA9IHNpZ25hbHMuc2VsZkFzc2Vzc21lbnQ7XG5cbiAgLy8gUHJpb3JpdGl6ZSByZXdhcmQgbW9kZWwgc2NvcmUgYXMgcHJpbWFyeSBzaWduYWwgKDQwJSlcbiAgLy8gSHVtYW4gcHJlZmVyZW5jZSBhcyBzZWNvbmRhcnkgKDM1JSlcbiAgLy8gU2VsZi1hc3Nlc3NtZW50IGFzIHRlcnRpYXJ5ICgyNSUpXG4gIC8vIFRoaXMgd2VpZ2h0cyBleHRlcm5hbCB2YWxpZGF0aW9uIG1vcmUgdGhhbiBzZWxmLWNvbmZpZGVuY2VcbiAgY29uc3QgY29tcG9uZW50cyA9IFtcbiAgICB7IHZhbHVlOiByZXdhcmRNb2RlbCwgd2VpZ2h0OiAwLjQwLCBkZWZhdWx0OiAwLjUgfSxcbiAgICB7IHZhbHVlOiBodW1hbiwgd2VpZ2h0OiAwLjM1LCBkZWZhdWx0OiAwLjUgfSxcbiAgICB7IHZhbHVlOiBzZWxmLCB3ZWlnaHQ6IDAuMjUsIGRlZmF1bHQ6IDAuNSB9XG4gIF07XG5cbiAgbGV0IHRvdGFsV2VpZ2h0ID0gMDtcbiAgbGV0IHdlaWdodGVkU3VtID0gMDtcblxuICBmb3IgKGNvbnN0IGNvbXAgb2YgY29tcG9uZW50cykge1xuICAgIGlmICh0eXBlb2YgY29tcC52YWx1ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgIHdlaWdodGVkU3VtICs9IGNvbXAudmFsdWUgKiBjb21wLndlaWdodDtcbiAgICAgIHRvdGFsV2VpZ2h0ICs9IGNvbXAud2VpZ2h0O1xuICAgIH0gZWxzZSB7XG4gICAgICB3ZWlnaHRlZFN1bSArPSBjb21wLmRlZmF1bHQgKiBjb21wLndlaWdodDtcbiAgICAgIHRvdGFsV2VpZ2h0ICs9IGNvbXAud2VpZ2h0O1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0b3RhbFdlaWdodCA+IDAgPyBjbGFtcCh3ZWlnaHRlZFN1bSAvIHRvdGFsV2VpZ2h0KSA6IDAuNTtcbn1cblxuZnVuY3Rpb24gY29tYmluZVJld2FyZChcbiAgY29ycmVjdG5lc3M6IG51bWJlcixcbiAgcXVhbGl0eTogbnVtYmVyLFxuICBsZWFybmVkOiBudW1iZXIsXG4gIHdlaWdodHM6IEh1bWFuUmV3YXJkV2VpZ2h0c1xuKTogbnVtYmVyIHtcbiAgY29uc3Qgd2VpZ2h0ZWQgPVxuICAgIHdlaWdodHMuYWxwaGEgKiBjb3JyZWN0bmVzcyArXG4gICAgd2VpZ2h0cy5iZXRhICogcXVhbGl0eSArXG4gICAgd2VpZ2h0cy5nYW1tYSAqIGxlYXJuZWQ7XG4gIGNvbnN0IHRvdGFsID0gd2VpZ2h0cy5hbHBoYSArIHdlaWdodHMuYmV0YSArIHdlaWdodHMuZ2FtbWE7XG4gIHJldHVybiB0b3RhbCA+IDAgPyBjbGFtcCh3ZWlnaHRlZCAvIHRvdGFsKSA6IGNsYW1wKHdlaWdodGVkKTtcbn1cblxuZnVuY3Rpb24gYWdncmVnYXRlRXZhbHVhdG9yU2NvcmVzKFxuICBjYW5kaWRhdGVzOiBUb3VybmFtZW50Q2FuZGlkYXRlW10sXG4gIGV2YWx1YXRvcldlaWdodHM6IE1hcDxzdHJpbmcsIG51bWJlcj5cbik6IHtcbiAgYWdncmVnYXRlZEV2YWx1YXRvclNjb3JlczogTWFwPHN0cmluZywgbnVtYmVyPjtcbiAgcGFpcndpc2U6IFBhaXJ3aXNlV2lucztcbiAgZXZhbHVhdG9yQnJlYWtkb3duOiBSZWNvcmQ8c3RyaW5nLCBFdmFsdWF0b3JTY29yZVtdPjtcbn0ge1xuICBjb25zdCBwYWlyd2lzZTogUGFpcndpc2VXaW5zID0ge307XG4gIGNvbnN0IGFnZ3JlZ2F0ZWQgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICBjb25zdCBldmFsdWF0b3JCcmVha2Rvd246IFJlY29yZDxzdHJpbmcsIEV2YWx1YXRvclNjb3JlW10+ID0ge307XG5cbiAgaWYgKGNhbmRpZGF0ZXMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIHsgYWdncmVnYXRlZEV2YWx1YXRvclNjb3JlczogYWdncmVnYXRlZCwgcGFpcndpc2UsIGV2YWx1YXRvckJyZWFrZG93biB9O1xuICB9XG5cbiAgLy8gUHJlLXNpemUgZm9yIHNtYWxsIHRvdXJuYW1lbnRzIHRvIGF2b2lkIHVubmVjZXNzYXJ5IE8obl4yKSB3aGVuIG5vdCBuZWVkZWRcbiAgY29uc3QgdHdvQ2FuZGlkYXRlRmFzdFBhdGggPSBjYW5kaWRhdGVzLmxlbmd0aCA8PSAyO1xuXG4gIGNvbnN0IGNhbmRpZGF0ZUlkcyA9IGNhbmRpZGF0ZXMubWFwKChjKSA9PiBjLmlkKTtcbiAgZm9yIChjb25zdCBpZCBvZiBjYW5kaWRhdGVJZHMpIHtcbiAgICBwYWlyd2lzZVtpZF0gPSB7fTtcbiAgICBmb3IgKGNvbnN0IG90aGVyIG9mIGNhbmRpZGF0ZUlkcykge1xuICAgICAgaWYgKGlkICE9PSBvdGhlcikgcGFpcndpc2VbaWRdW290aGVyXSA9IDA7XG4gICAgfVxuICB9XG5cbiAgLy8gQ29sbGVjdCBzY29yZXMgcGVyIGV2YWx1YXRvclxuICBjb25zdCBzY29yZXNCeUV2YWx1YXRvciA9IG5ldyBNYXA8c3RyaW5nLCBDYW5kaWRhdGVFdmFsdWF0b3JTY29yZVtdPigpO1xuICBmb3IgKGNvbnN0IGNhbmRpZGF0ZSBvZiBjYW5kaWRhdGVzKSB7XG4gICAgZm9yIChjb25zdCBzY29yZSBvZiBjYW5kaWRhdGUuZXZhbHVhdG9yU2NvcmVzID8/IFtdKSB7XG4gICAgICBpZiAoIXNjb3Jlc0J5RXZhbHVhdG9yLmhhcyhzY29yZS5ldmFsdWF0b3JJZCkpIHtcbiAgICAgICAgc2NvcmVzQnlFdmFsdWF0b3Iuc2V0KHNjb3JlLmV2YWx1YXRvcklkLCBbXSk7XG4gICAgICB9XG4gICAgICBzY29yZXNCeUV2YWx1YXRvci5nZXQoc2NvcmUuZXZhbHVhdG9ySWQpIS5wdXNoKHtcbiAgICAgICAgZXZhbHVhdG9ySWQ6IHNjb3JlLmV2YWx1YXRvcklkLFxuICAgICAgICBzY29yZTogY2xhbXAoc2NvcmUuc2NvcmUpLFxuICAgICAgICB3ZWlnaHQ6IHNjb3JlLndlaWdodCxcbiAgICAgICAgbm90ZXM6IHNjb3JlLm5vdGVzLFxuICAgICAgICBjYW5kaWRhdGVJZDogY2FuZGlkYXRlLmlkLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLy8gSWYgbm8gZXZhbHVhdG9yIHNjb3JlcyBwcm92aWRlZCwgZmFsbCBiYWNrIHRvIG5ldXRyYWwgcmFua2luZ3NcbiAgaWYgKHNjb3Jlc0J5RXZhbHVhdG9yLnNpemUgPT09IDApIHtcbiAgICBjb25zdCBmYWxsYmFjazogQ2FuZGlkYXRlRXZhbHVhdG9yU2NvcmVbXSA9IFtdO1xuICAgIGZvciAoY29uc3QgY2FuZGlkYXRlIG9mIGNhbmRpZGF0ZXMpIHtcbiAgICAgIC8vIFVzZSBjYW5kaWRhdGUncyBvd24gcmV3YXJkIHNpZ25hbHMgaWYgYXZhaWxhYmxlXG4gICAgICBjb25zdCBjYW5kaWRhdGVTY29yZSA9IGNhbmRpZGF0ZS5zaWduYWxzPy5yZXdhcmRNb2RlbFNjb3JlID8/IDAuNTtcbiAgICAgIGZhbGxiYWNrLnB1c2goe1xuICAgICAgICBldmFsdWF0b3JJZDogJ3Jld2FyZC1mYWxsYmFjaycsXG4gICAgICAgIHNjb3JlOiBjYW5kaWRhdGVTY29yZSxcbiAgICAgICAgd2VpZ2h0OiAxLFxuICAgICAgICBjYW5kaWRhdGVJZDogY2FuZGlkYXRlLmlkLFxuICAgICAgfSk7XG4gICAgfVxuICAgIHNjb3Jlc0J5RXZhbHVhdG9yLnNldCgncmV3YXJkLWZhbGxiYWNrJywgZmFsbGJhY2spO1xuICB9XG5cbiAgbGV0IHRvdGFsQm9yZGFXZWlnaHQgPSAwO1xuXG4gIGZvciAoY29uc3QgW2V2YWx1YXRvcklkLCByYXdTY29yZXNdIG9mIHNjb3Jlc0J5RXZhbHVhdG9yLmVudHJpZXMoKSkge1xuICAgIGNvbnN0IHdlaWdodCA9IGV2YWx1YXRvcldlaWdodHMuZ2V0KGV2YWx1YXRvcklkKSA/PyAxO1xuICAgIHRvdGFsQm9yZGFXZWlnaHQgKz0gd2VpZ2h0ICogTWF0aC5tYXgoMSwgY2FuZGlkYXRlcy5sZW5ndGggLSAxKTtcblxuICAgIC8vIFNvcnQgZGVzY2VuZGluZyBieSBzY29yZSB0byBhc3NpZ24gcmFua3MgKEJvcmRhKVxuICAgIGNvbnN0IHJhbmtlZCA9IHJhd1Njb3Jlc1xuICAgICAgLmZpbHRlcigoZW50cnkpID0+IHR5cGVvZiBlbnRyeS5zY29yZSA9PT0gJ251bWJlcicpXG4gICAgICAuc29ydCgoYSwgYikgPT4gKGIuc2NvcmUgPz8gMCkgLSAoYS5zY29yZSA/PyAwKSk7XG5cbiAgICBldmFsdWF0b3JCcmVha2Rvd25bZXZhbHVhdG9ySWRdID0gcmFua2VkLm1hcCgoeyBjYW5kaWRhdGVJZDogXywgLi4ucmVzdCB9KSA9PiByZXN0IGFzIEV2YWx1YXRvclNjb3JlKTtcblxuICAgIHJhbmtlZC5mb3JFYWNoKChlbnRyeSwgaWR4KSA9PiB7XG4gICAgICBjb25zdCBjYW5kaWRhdGVJZCA9IChlbnRyeSBhcyB1bmtub3duIGFzIHsgY2FuZGlkYXRlSWQ6IHN0cmluZyB9KS5jYW5kaWRhdGVJZDtcbiAgICAgIGNvbnN0IGJvcmRhUG9pbnRzID0gKGNhbmRpZGF0ZXMubGVuZ3RoIC0gaWR4IC0gMSkgKiB3ZWlnaHQ7XG4gICAgICBhZ2dyZWdhdGVkLnNldChjYW5kaWRhdGVJZCwgKGFnZ3JlZ2F0ZWQuZ2V0KGNhbmRpZGF0ZUlkKSA/PyAwKSArIGJvcmRhUG9pbnRzKTtcbiAgICB9KTtcblxuICAgIC8vIFBhaXJ3aXNlIHdpbnMgZm9yIHRoaXMgZXZhbHVhdG9yIChsaWdodHdlaWdodCBwYXRoIGZvciA8PTIgY2FuZGlkYXRlcylcbiAgICBpZiAodHdvQ2FuZGlkYXRlRmFzdFBhdGggJiYgcmFua2VkLmxlbmd0aCA9PT0gMikge1xuICAgICAgY29uc3QgaGlnaGVyID0gcmFua2VkWzBdIGFzIHVua25vd24gYXMgeyBjYW5kaWRhdGVJZDogc3RyaW5nOyBzY29yZTogbnVtYmVyIH07XG4gICAgICBjb25zdCBsb3dlciA9IHJhbmtlZFsxXSBhcyB1bmtub3duIGFzIHsgY2FuZGlkYXRlSWQ6IHN0cmluZzsgc2NvcmU6IG51bWJlciB9O1xuICAgICAgaWYgKGhpZ2hlci5zY29yZSA9PT0gbG93ZXIuc2NvcmUpIHtcbiAgICAgICAgcGFpcndpc2VbaGlnaGVyLmNhbmRpZGF0ZUlkXVtsb3dlci5jYW5kaWRhdGVJZF0gKz0gd2VpZ2h0ICogMC41O1xuICAgICAgICBwYWlyd2lzZVtsb3dlci5jYW5kaWRhdGVJZF1baGlnaGVyLmNhbmRpZGF0ZUlkXSArPSB3ZWlnaHQgKiAwLjU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwYWlyd2lzZVtoaWdoZXIuY2FuZGlkYXRlSWRdW2xvd2VyLmNhbmRpZGF0ZUlkXSArPSB3ZWlnaHQ7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmFua2VkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGZvciAobGV0IGogPSBpICsgMTsgaiA8IHJhbmtlZC5sZW5ndGg7IGorKykge1xuICAgICAgICAgIGNvbnN0IGhpZ2hlciA9IHJhbmtlZFtpXSBhcyB1bmtub3duIGFzIHsgY2FuZGlkYXRlSWQ6IHN0cmluZzsgc2NvcmU6IG51bWJlciB9O1xuICAgICAgICAgIGNvbnN0IGxvd2VyID0gcmFua2VkW2pdIGFzIHVua25vd24gYXMgeyBjYW5kaWRhdGVJZDogc3RyaW5nOyBzY29yZTogbnVtYmVyIH07XG4gICAgICAgICAgaWYgKGhpZ2hlci5zY29yZSA9PT0gbG93ZXIuc2NvcmUpIHtcbiAgICAgICAgICAgIHBhaXJ3aXNlW2hpZ2hlci5jYW5kaWRhdGVJZF1bbG93ZXIuY2FuZGlkYXRlSWRdICs9IHdlaWdodCAqIDAuNTtcbiAgICAgICAgICAgIHBhaXJ3aXNlW2xvd2VyLmNhbmRpZGF0ZUlkXVtoaWdoZXIuY2FuZGlkYXRlSWRdICs9IHdlaWdodCAqIDAuNTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcGFpcndpc2VbaGlnaGVyLmNhbmRpZGF0ZUlkXVtsb3dlci5jYW5kaWRhdGVJZF0gKz0gd2VpZ2h0O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIE5vcm1hbGl6ZSBhZ2dyZWdhdGVkIEJvcmRhIHNjb3JlcyBpbnRvIFswLDFdXG4gIGlmICh0b3RhbEJvcmRhV2VpZ2h0ID4gMCkge1xuICAgIGZvciAoY29uc3QgW2NhbmRpZGF0ZUlkLCBwb2ludHNdIG9mIGFnZ3JlZ2F0ZWQuZW50cmllcygpKSB7XG4gICAgICBhZ2dyZWdhdGVkLnNldChjYW5kaWRhdGVJZCwgY2xhbXAocG9pbnRzIC8gdG90YWxCb3JkYVdlaWdodCkpO1xuICAgIH1cbiAgfVxuXG4gIC8vIEVuc3VyZSBldmVyeSBjYW5kaWRhdGUgaGFzIGFuIGVudHJ5XG4gIGZvciAoY29uc3QgY2FuZGlkYXRlSWQgb2YgY2FuZGlkYXRlSWRzKSB7XG4gICAgaWYgKCFhZ2dyZWdhdGVkLmhhcyhjYW5kaWRhdGVJZCkpIHtcbiAgICAgIGFnZ3JlZ2F0ZWQuc2V0KGNhbmRpZGF0ZUlkLCAwLjUpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7IGFnZ3JlZ2F0ZWRFdmFsdWF0b3JTY29yZXM6IGFnZ3JlZ2F0ZWQsIHBhaXJ3aXNlLCBldmFsdWF0b3JCcmVha2Rvd24gfTtcbn1cblxuZnVuY3Rpb24gY2xhbXAodmFsdWU6IG51bWJlciwgbWluID0gMCwgbWF4ID0gMSk6IG51bWJlciB7XG4gIGlmIChOdW1iZXIuaXNOYU4odmFsdWUpKSByZXR1cm4gbWluO1xuICByZXR1cm4gTWF0aC5tYXgobWluLCBNYXRoLm1pbihtYXgsIHZhbHVlKSk7XG59XG5cbmZ1bmN0aW9uIGNvbXB1dGVIdW1hbkFjY3VyYWN5KHJhbmtJbmRleDogbnVtYmVyLCB0b3RhbDogbnVtYmVyKTogbnVtYmVyIHtcbiAgaWYgKHRvdGFsIDw9IDEpIHJldHVybiAxO1xuICBjb25zdCBtYXhJbmRleCA9IE1hdGgubWF4KDEsIHRvdGFsIC0gMSk7XG4gIGNvbnN0IHJlbGF0aXZlID0gMSAtIHJhbmtJbmRleCAvIG1heEluZGV4O1xuICByZXR1cm4gY2xhbXAocmVsYXRpdmUpO1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBbUZPLE1BQU1BLDRCQUFnRCxHQUFBQyxPQUFBLENBQUFELDRCQUFBLEdBQUc7RUFDOURFLEtBQUssRUFBRSxHQUFHO0VBQ1ZDLElBQUksRUFBRSxJQUFJO0VBQ1ZDLEtBQUssRUFBRTtBQUNULENBQUM7QUFnQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDTyxTQUFTQyxpQkFBaUJBLENBQy9CQyxJQUFvQixFQUNwQkMsVUFBaUMsRUFDakNDLE9BQTBCLEdBQUcsQ0FBQyxDQUFDLEVBQ1o7RUFDbkIsTUFBTUMsYUFBYSxHQUFHRCxPQUFPLENBQUNDLGFBQWEsSUFBSSxDQUFDO0VBQ2hELE1BQU1DLGlCQUFpQixHQUFHSCxVQUFVLENBQUNJLEtBQUssQ0FBQyxDQUFDLEVBQUVDLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUMsRUFBRUosYUFBYSxDQUFDLENBQUM7O0VBRXpFO0VBQ0EsSUFBSUMsaUJBQWlCLENBQUNJLE1BQU0sS0FBSyxDQUFDLEVBQUU7SUFDbEMsTUFBTUMsSUFBSSxHQUFHTCxp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