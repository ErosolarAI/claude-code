{"version":3,"names":["cov_2r1z7wfx6v","actualCoverage","LiveStatusTracker","base","s","overrides","Map","subscribers","Set","subscribe","subscriber","f","add","current","currentState","b","delete","setBase","text","options","keepStart","startedAt","Date","now","detail","emit","pushOverride","id","existing","get","set","tone","clearOverride","size","last","Array","from","values","pop","state","sub","exports"],"sources":["liveStatus.ts"],"sourcesContent":["export type LiveStatusTone = 'info' | 'success' | 'warning' | 'error';\n\nexport interface LiveStatusState {\n  text: string;\n  detail?: string;\n  startedAt: number;\n  tone?: LiveStatusTone;\n  progress?: number;\n}\n\ntype Subscriber = (state: LiveStatusState) => void;\n\nexport class LiveStatusTracker {\n  private base: LiveStatusState | null = null;\n  private overrides = new Map<string, LiveStatusState>();\n  private subscribers = new Set<Subscriber>();\n\n  subscribe(subscriber: Subscriber): () => void {\n    this.subscribers.add(subscriber);\n    const current = this.currentState();\n    if (current) {\n      subscriber(current);\n    }\n    return () => {\n      this.subscribers.delete(subscriber);\n    };\n  }\n\n  setBase(text: string, options?: { detail?: string }): void {\n    const keepStart = this.base && this.base.text === text ? this.base.startedAt : Date.now();\n    this.base = { text, detail: options?.detail, startedAt: keepStart };\n    this.emit();\n  }\n\n  pushOverride(id: string, text: string, options?: { detail?: string; tone?: LiveStatusTone }): () => void {\n    const existing = this.overrides.get(id);\n    const startedAt = existing && existing.text === text ? existing.startedAt : Date.now();\n    this.overrides.set(id, { text, detail: options?.detail, tone: options?.tone, startedAt });\n    this.emit();\n    return () => this.clearOverride(id);\n  }\n\n  clearOverride(id: string): void {\n    this.overrides.delete(id);\n    this.emit();\n  }\n\n  private currentState(): LiveStatusState | null {\n    if (this.overrides.size) {\n      const last = Array.from(this.overrides.values()).pop();\n      if (last) return last;\n    }\n    return this.base;\n  }\n\n  private emit(): void {\n    const state = this.currentState();\n    if (!state) return;\n    for (const sub of this.subscribers) {\n      try {\n        sub(state);\n      } catch {\n        // ignore subscriber errors\n      }\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}