{"version":3,"names":["_nodeChild_process","require","runResolveProfile","envOverrides","env","process","key","value","Object","entries","undefined","spawnSync","cwd","encoding","describe","it","result","AGI_CODE_MODEL","AGI_CODE_PROVIDER","expect","status","toBe","payload","JSON","parse","stdout","trim","model","provider","providerLocked"],"sources":["config.modelSelection.test.ts"],"sourcesContent":["import { spawnSync, type SpawnSyncReturns } from 'node:child_process';\n\nfunction runResolveProfile(envOverrides: Record<string, string | undefined>): SpawnSyncReturns<string> {\n  const env = { ...process.env };\n  for (const [key, value] of Object.entries(envOverrides)) {\n    if (value === undefined) {\n      delete env[key];\n    } else {\n      env[key] = value;\n    }\n  }\n\n  return spawnSync(\n    'node',\n    [\n      '--loader',\n      'ts-node/esm',\n      '-e',\n      `\n        import { resolveProfileConfig } from './src/config.js';\n        const cfg = resolveProfileConfig('agi-code', null);\n        console.log(JSON.stringify({ provider: cfg.provider, model: cfg.model, providerLocked: cfg.providerLocked }));\n      `,\n    ],\n    {\n      cwd: process.cwd(),\n      env,\n      encoding: 'utf8',\n    }\n  );\n}\n\ndescribe('resolveProfileConfig model/provider alignment (ts-node)', () => {\n  it('infers provider from model when provider env is absent', () => {\n    const result = runResolveProfile({\n      AGI_CODE_MODEL: 'gpt-4o',\n      AGI_CODE_PROVIDER: undefined,\n    });\n\n    expect(result.status).toBe(0);\n    const payload = JSON.parse(result.stdout.trim()) as { provider: string; model: string; providerLocked: boolean };\n    expect(payload.model).toBe('gpt-4o');\n    expect(payload.provider).toBe('openai');\n    expect(payload.providerLocked).toBe(false);\n  });\n\n  it('overrides mismatched provider env when model belongs to another provider', () => {\n    const result = runResolveProfile({\n      AGI_CODE_MODEL: 'claude-3-5-sonnet-20241022',\n      AGI_CODE_PROVIDER: 'deepseek',\n    });\n\n    expect(result.status).toBe(0);\n    const payload = JSON.parse(result.stdout.trim()) as { provider: string; model: string; providerLocked: boolean };\n    expect(payload.provider).toBe('anthropic');\n    expect(payload.model).toBe('claude-3-5-sonnet-20241022');\n  });\n});\n"],"mappings":";;AAAA,IAAAA,kBAAA,GAAAC,OAAA;AAEA,SAASC,iBAAiBA,CAACC,YAAgD,EAA4B;EACrG,MAAMC,GAAG,GAAG;IAAE,GAAGC,OAAO,CAACD;EAAI,CAAC;EAC9B,KAAK,MAAM,CAACE,GAAG,EAAEC,KAAK,CAAC,IAAIC,MAAM,CAACC,OAAO,CAACN,YAAY,CAAC,EAAE;IACvD,IAAII,KAAK,KAAKG,SAAS,EAAE;MACvB,OAAON,GAAG,CAACE,GAAG,CAAC;IACjB,CAAC,MAAM;MACLF,GAAG,CAACE,GAAG,CAAC,GAAGC,KAAK;IAClB;EACF;EAEA,OAAO,IAAAI,4BAAS,EACd,MAAM,EACN,CACE,UAAU,EACV,aAAa,EACb,IAAI,EACJ;AACN;AACA;AACA;AACA,OAAO,CACF,EACD;IACEC,GAAG,EAAEP,OAAO,CAACO,GAAG,CAAC,CAAC;IAClBR,GAAG;IACHS,QAAQ,EAAE;EACZ,CACF,CAAC;AACH;AAEAC,QAAQ,CAAC,yDAAyD,EAAE,MAAM;EACxEC,EAAE,CAAC,wDAAwD,EAAE,MAAM;IACjE,MAAMC,MAAM,GAAGd,iBAAiB,CAAC;MAC/Be,cAAc,EAAE,QAAQ;MACxBC,iBAAiB,EAAER;IACrB,CAAC,CAAC;IAEFS,MAAM,CAACH,MAAM,CAACI,MAAM,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC;IAC7B,MAAMC,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACR,MAAM,CAACS,MAAM,CAACC,IAAI,CAAC,CAAC,CAAiE;IAChHP,MAAM,CAACG,OAAO,CAACK,KAAK,CAAC,CAACN,IAAI,CAAC,QAAQ,CAAC;IACpCF,MAAM,CAACG,OAAO,CAACM,QAAQ,CAAC,CAACP,IAAI,CAAC,QAAQ,CAAC;IACvCF,MAAM,CAACG,OAAO,CAACO,cAAc,CAAC,CAACR,IAAI,CAAC,KAAK,CAAC;EAC5C,CAAC,CAAC;EAEFN,EAAE,CAAC,0EAA0E,EAAE,MAAM;IACnF,MAAMC,MAAM,GAAGd,iBAAiB,CAAC;MAC/Be,cAAc,EAAE,4BAA4B;MAC5CC,iBAAiB,EAAE;IACrB,CAAC,CAAC;IAEFC,MAAM,CAACH,MAAM,CAACI,MAAM,CAAC,CAACC,IAAI,CAAC,CAAC,CAAC;IAC7B,MAAMC,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACR,MAAM,CAACS,MAAM,CAACC,IAAI,CAAC,CAAC,CAAiE;IAChHP,MAAM,CAACG,OAAO,CAACM,QAAQ,CAAC,CAACP,IAAI,CAAC,WAAW,CAAC;IAC1CF,MAAM,CAACG,OAAO,CAACK,KAAK,CAAC,CAACN,IAAI,CAAC,4BAA4B,CAAC;EAC1D,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}