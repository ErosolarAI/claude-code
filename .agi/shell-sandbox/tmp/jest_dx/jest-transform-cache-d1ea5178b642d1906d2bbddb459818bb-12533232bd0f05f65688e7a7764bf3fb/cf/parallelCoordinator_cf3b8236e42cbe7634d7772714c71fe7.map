{"version":3,"names":["cov_1y8b0kiu4r","actualCoverage","ParallelCoordinator","constructor","createRunner","f","runModules","context","modules","tasks","s","map","module","id","label","parallelizable","execute","processModule","runner","batch","reports","result","results","find","m","taskId","report","b","scope","steps","status","push","continueOnFailure","exports"],"sources":["parallelCoordinator.ts"],"sourcesContent":["import type { ParallelTask, BatchResult } from './parallelExecutor.js';\nimport type { RepoUpgradeModule, UpgradeModuleReport, RepoUpgradeModeDefinition, RepoUpgradeMode } from './repoUpgradeOrchestrator.js';\n\ninterface RunModulesContext {\n  concurrency: number;\n  mode: RepoUpgradeMode;\n  modeDefinition: RepoUpgradeModeDefinition;\n  parallelVariants?: boolean;\n  continueOnFailure: boolean;\n  variantStats: Record<string, unknown>;\n  processModule: (module: RepoUpgradeModule) => Promise<UpgradeModuleReport>;\n  emit: (event: unknown) => void;\n}\n\nexport class ParallelCoordinator {\n  constructor(\n    private readonly createRunner: () => { execute: (tasks: ParallelTask<UpgradeModuleReport>[]) => Promise<BatchResult<UpgradeModuleReport>> }\n  ) {}\n\n  async runModules(context: RunModulesContext, modules: RepoUpgradeModule[]): Promise<UpgradeModuleReport[]> {\n    const tasks: ParallelTask<UpgradeModuleReport>[] = modules.map((module) => ({\n      id: module.id,\n      label: module.label,\n      parallelizable: true,\n      execute: () => context.processModule(module),\n    }));\n\n    const runner = this.createRunner();\n    const batch = await runner.execute(tasks);\n    const reports: UpgradeModuleReport[] = [];\n\n    for (const result of batch.results) {\n      const module = modules.find((m) => m.id === result.taskId);\n      let report: UpgradeModuleReport;\n      if (result.result) {\n        report = result.result;\n      } else {\n        report = {\n          id: module?.id ?? result.taskId,\n          label: module?.label ?? result.taskId,\n          scope: module?.scope ?? [],\n          steps: [],\n          status: result.status === 'completed' ? 'completed' : 'failed',\n        };\n      }\n\n      if (result.status !== 'completed') {\n        report.status = 'failed';\n      }\n\n      reports.push(report);\n\n      if (result.status === 'failed' && !context.continueOnFailure) {\n        break;\n      }\n    }\n\n    return reports;\n  }\n}\n"],"mappings":"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","ignoreList":[]}