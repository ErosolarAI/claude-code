{"version":3,"names":["_nodeChild_process","require","_nodeFs","_nodePath","_nodeOs","_nodeUtil","exec","promisify","execCb","ProductTestHarness","scenarios","addScenario","scenario","push","runAll","results","started","Date","now","outcome","runWithTimeout","execute","timeout","passed","duration","output","error","name","Error","message","String","filter","r","length","failed","summary","total","exports","fn","timeoutMs","timeoutHandle","timeoutPromise","Promise","_resolve","reject","setTimeout","result","race","clearTimeout","createRuntimeEnvironment","root","mkdtempSync","join","tmpdir","code","runtime","cwd","scriptPath","writeFileSync","stdout","stderr","env","process","exitCode","shell","err","writeFile","path","content","target","readFile","readFileSync","fileExists","existsSync","cleanup","rmSync","recursive","force","TestScenarioGenerator","generateSmokeTests","description"],"sources":["productTestHarness.ts"],"sourcesContent":["import { exec as execCb } from 'node:child_process';\nimport { mkdtempSync, rmSync, writeFileSync, readFileSync, existsSync } from 'node:fs';\nimport { join } from 'node:path';\nimport { tmpdir } from 'node:os';\nimport { promisify } from 'node:util';\n\nconst exec = promisify(execCb);\n\nexport interface TestScenario {\n  name: string;\n  description: string;\n  timeout?: number;\n  execute: () => Promise<{\n    scenario: string;\n    passed: boolean;\n    duration: number;\n    output: string;\n  }>;\n}\n\nexport interface ScenarioResult {\n  scenario: string;\n  passed: boolean;\n  duration: number;\n  output: string;\n  error?: string;\n}\n\nexport interface TestRunResult {\n  total: number;\n  passed: number;\n  failed: number;\n  results: ScenarioResult[];\n  summary: string;\n}\n\nexport class ProductTestHarness {\n  private scenarios: TestScenario[] = [];\n\n  addScenario(scenario: TestScenario): void {\n    this.scenarios.push(scenario);\n  }\n\n  async runAll(): Promise<TestRunResult> {\n    const results: ScenarioResult[] = [];\n\n    for (const scenario of this.scenarios) {\n      const started = Date.now();\n      try {\n        const outcome = await runWithTimeout(scenario.execute, scenario.timeout ?? 60_000);\n        results.push({\n          scenario: outcome.scenario,\n          passed: outcome.passed,\n          duration: outcome.duration,\n          output: outcome.output,\n        });\n      } catch (error) {\n        const duration = Date.now() - started;\n        results.push({\n          scenario: scenario.name,\n          passed: false,\n          duration,\n          output: '',\n          error: error instanceof Error ? error.message : String(error),\n        });\n      }\n    }\n\n    const passed = results.filter((r) => r.passed).length;\n    const failed = results.length - passed;\n    const summary = `Results: ${passed}/${results.length} passed${failed ? ` Â· Failed: ${failed}` : ''}`;\n\n    return {\n      total: results.length,\n      passed,\n      failed,\n      results,\n      summary,\n    };\n  }\n}\n\nasync function runWithTimeout<T extends { scenario: string; passed: boolean; duration: number; output: string }>(\n  fn: () => Promise<T>,\n  timeoutMs: number\n): Promise<T> {\n  let timeoutHandle: NodeJS.Timeout;\n  const timeoutPromise = new Promise<T>((_resolve, reject) => {\n    timeoutHandle = setTimeout(() => reject(new Error('Test timeout exceeded')), timeoutMs);\n  });\n\n  try {\n    const result = await Promise.race([fn(), timeoutPromise]);\n    clearTimeout(timeoutHandle!);\n    return result as T;\n  } catch (error) {\n    clearTimeout(timeoutHandle!);\n    throw error;\n  }\n}\n\n// -----------------------------------------------------------------------------\n// Runtime environment utilities\n// -----------------------------------------------------------------------------\n\nexport function createRuntimeEnvironment() {\n  const root = mkdtempSync(join(tmpdir(), 'agi-runtime-'));\n\n  const execute = async (code: string, runtime: 'node' | 'bash' = 'node') => {\n    const cwd = root;\n    try {\n      if (runtime === 'node') {\n        const scriptPath = join(root, 'temp-script.js');\n        writeFileSync(scriptPath, code, 'utf-8');\n        const { stdout, stderr } = await exec(`node \"${scriptPath}\"`, { cwd, env: process.env });\n        return { exitCode: 0, stdout, stderr };\n      }\n\n      const { stdout, stderr } = await exec(code, { cwd, shell: '/bin/bash', env: process.env });\n      return { exitCode: 0, stdout, stderr };\n    } catch (error: unknown) {\n      const err = error as { code?: number; stdout?: string; stderr?: string };\n      return {\n        exitCode: typeof err?.code === 'number' ? err.code : 1,\n        stdout: err?.stdout ?? '',\n        stderr: err?.stderr ?? (error instanceof Error ? error.message : String(error)),\n      };\n    }\n  };\n\n  const writeFile = (path: string, content: string): void => {\n    const target = join(root, path);\n    writeFileSync(target, content, 'utf-8');\n  };\n\n  const readFile = (path: string): string => {\n    return readFileSync(join(root, path), 'utf-8');\n  };\n\n  const fileExists = (path: string): boolean => {\n    return existsSync(join(root, path));\n  };\n\n  const cleanup = (): void => {\n    try {\n      rmSync(root, { recursive: true, force: true });\n    } catch {\n      // ignore cleanup errors\n    }\n  };\n\n  return { execute, writeFile, readFile, fileExists, cleanup, root };\n}\n\n// -----------------------------------------------------------------------------\n// Scenario generator (lightweight helper for future use)\n// -----------------------------------------------------------------------------\n\nexport class TestScenarioGenerator {\n  generateSmokeTests(): TestScenario[] {\n    return [\n      {\n        name: 'smoke_build',\n        description: 'Validate build command output',\n        execute: async () => ({\n          scenario: 'smoke_build',\n          passed: true,\n          duration: 10,\n          output: 'Build succeeded',\n        }),\n      },\n    ];\n  }\n}\n"],"mappings":";;;;;;;AAAA,IAAAA,kBAAA,GAAAC,OAAA;AACA,IAAAC,OAAA,GAAAD,OAAA;AACA,IAAAE,SAAA,GAAAF,OAAA;AACA,IAAAG,OAAA,GAAAH,OAAA;AACA,IAAAI,SAAA,GAAAJ,OAAA;AAEA,MAAMK,IAAI,GAAG,IAAAC,mBAAS,EAACC,uBAAM,CAAC;AA8BvB,MAAMC,kBAAkB,CAAC;EACtBC,SAAS,GAAmB,EAAE;EAEtCC,WAAWA,CAACC,QAAsB,EAAQ;IACxC,IAAI,CAACF,SAAS,CAACG,IAAI,CAACD,QAAQ,CAAC;EAC/B;EAEA,MAAME,MAAMA,CAAA,EAA2B;IACrC,MAAMC,OAAyB,GAAG,EAAE;IAEpC,KAAK,MAAMH,QAAQ,IAAI,IAAI,CAACF,SAAS,EAAE;MACrC,MAAMM,OAAO,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;MAC1B,IAAI;QACF,MAAMC,OAAO,GAAG,MAAMC,cAAc,CAACR,QAAQ,CAACS,OAAO,EAAET,QAAQ,CAACU,OAAO,IAAI,MAAM,CAAC;QAClFP,OAAO,CAACF,IAAI,CAAC;UACXD,QAAQ,EAAEO,OAAO,CAACP,QAAQ;UAC1BW,MAAM,EAAEJ,OAAO,CAACI,MAAM;UACtBC,QAAQ,EAAEL,OAAO,CAACK,QAAQ;UAC1BC,MAAM,EAAEN,OAAO,CAACM;QAClB,CAAC,CAAC;MACJ,CAAC,CAAC,OAAOC,KAAK,EAAE;QACd,MAAMF,QAAQ,GAAGP,IAAI,CAACC,GAAG,CAAC,CAAC,GAAGF,OAAO;QACrCD,OAAO,CAACF,IAAI,CAAC;UACXD,QAAQ,EAAEA,QAAQ,CAACe,IAAI;UACvBJ,MAAM,EAAE,KAAK;UACbC,QAAQ;UACRC,MAAM,EAAE,EAAE;UACVC,KAAK,EAAEA,KAAK,YAAYE,KAAK,GAAGF,KAAK,CAACG,OAAO,GAAGC,MAAM,CAACJ,KAAK;QAC9D,CAAC,CAAC;MACJ;IACF;IAEA,MAAMH,MAAM,GAAGR,OAAO,CAACgB,MAAM,CAAEC,CAAC,IAAKA,CAAC,CAACT,MAAM,CAAC,CAACU,MAAM;IACrD,MAAMC,MAAM,GAAGnB,OAAO,CAACkB,MAAM,GAAGV,MAAM;IACtC,MAAMY,OAAO,GAAG,YAAYZ,MAAM,IAAIR,OAAO,CAACkB,MAAM,UAAUC,MAAM,GAAG,cAAcA,MAAM,EAAE,GAAG,EAAE,EAAE;IAEpG,OAAO;MACLE,KAAK,EAAErB,OAAO,CAACkB,MAAM;MACrBV,MAAM;MACNW,MAAM;MACNnB,OAAO;MACPoB;IACF,CAAC;EACH;AACF;AAACE,OAAA,CAAA5B,kBAAA,GAAAA,kBAAA;AAED,eAAeW,cAAcA,CAC3BkB,EAAoB,EACpBC,SAAiB,EACL;EACZ,IAAIC,aAA6B;EACjC,MAAMC,cAAc,GAAG,IAAIC,OAAO,CAAI,CAACC,QAAQ,EAAEC,MAAM,KAAK;IAC1DJ,aAAa,GAAGK,UAAU,CAAC,MAAMD,MAAM,CAAC,IAAIhB,KAAK,CAAC,uBAAuB,CAAC,CAAC,EAAEW,SAAS,CAAC;EACzF,CAAC,CAAC;EAEF,IAAI;IACF,MAAMO,MAAM,GAAG,MAAMJ,OAAO,CAACK,IAAI,CAAC,CAACT,EAAE,CAAC,CAAC,EAAEG,cAAc,CAAC,CAAC;IACzDO,YAAY,CAACR,aAAc,CAAC;IAC5B,OAAOM,MAAM;EACf,CAAC,CAAC,OAAOpB,KAAK,EAAE;IACdsB,YAAY,CAACR,aAAc,CAAC;IAC5B,MAAMd,KAAK;EACb;AACF;;AAEA;AACA;AACA;;AAEO,SAASuB,wBAAwBA,CAAA,EAAG;EACzC,MAAMC,IAAI,GAAG,IAAAC,mBAAW,EAAC,IAAAC,cAAI,EAAC,IAAAC,cAAM,EAAC,CAAC,EAAE,cAAc,CAAC,CAAC;EAExD,MAAMhC,OAAO,GAAG,MAAAA,CAAOiC,IAAY,EAAEC,OAAwB,GAAG,MAAM,KAAK;IACzE,MAAMC,GAAG,GAAGN,IAAI;IAChB,IAAI;MACF,IAAIK,OAAO,KAAK,MAAM,EAAE;QACtB,MAAME,UAAU,GAAG,IAAAL,cAAI,EAACF,IAAI,EAAE,gBAAgB,CAAC;QAC/C,IAAAQ,qBAAa,EAACD,UAAU,EAAEH,IAAI,EAAE,OAAO,CAAC;QACxC,MAAM;UAAEK,MAAM;UAAEC;QAAO,CAAC,GAAG,MAAMtD,IAAI,CAAC,SAASmD,UAAU,GAAG,EAAE;UAAED,GAAG;UAAEK,GAAG,EAAEC,OAAO,CAACD;QAAI,CAAC,CAAC;QACxF,OAAO;UAAEE,QAAQ,EAAE,CAAC;UAAEJ,MAAM;UAAEC;QAAO,CAAC;MACxC;MAEA,MAAM;QAAED,MAAM;QAAEC;MAAO,CAAC,GAAG,MAAMtD,IAAI,CAACgD,IAAI,EAAE;QAAEE,GAAG;QAAEQ,KAAK,EAAE,WAAW;QAAEH,GAAG,EAAEC,OAAO,CAACD;MAAI,CAAC,CAAC;MAC1F,OAAO;QAAEE,QAAQ,EAAE,CAAC;QAAEJ,MAAM;QAAEC;MAAO,CAAC;IACxC,CAAC,CAAC,OAAOlC,KAAc,EAAE;MACvB,MAAMuC,GAAG,GAAGvC,KAA4D;MACxE,OAAO;QACLqC,QAAQ,EAAE,OAAOE,GAAG,EAAEX,IAAI,KAAK,QAAQ,GAAGW,GAAG,CAACX,IAAI,GAAG,CAAC;QACtDK,MAAM,EAAEM,GAAG,EAAEN,MAAM,IAAI,EAAE;QACzBC,MAAM,EAAEK,GAAG,EAAEL,MAAM,KAAKlC,KAAK,YAAYE,KAAK,GAAGF,KAAK,CAACG,OAAO,GAAGC,MAAM,CAACJ,KAAK,CAAC;MAChF,CAAC;IACH;EACF,CAAC;EAED,MAAMwC,SAAS,GAAGA,CAACC,IAAY,EAAEC,OAAe,KAAW;IACzD,MAAMC,MAAM,GAAG,IAAAjB,cAAI,EAACF,IAAI,EAAEiB,IAAI,CAAC;IAC/B,IAAAT,qBAAa,EAACW,MAAM,EAAED,OAAO,EAAE,OAAO,CAAC;EACzC,CAAC;EAED,MAAME,QAAQ,GAAIH,IAAY,IAAa;IACzC,OAAO,IAAAI,oBAAY,EAAC,IAAAnB,cAAI,EAACF,IAAI,EAAEiB,IAAI,CAAC,EAAE,OAAO,CAAC;EAChD,CAAC;EAED,MAAMK,UAAU,GAAIL,IAAY,IAAc;IAC5C,OAAO,IAAAM,kBAAU,EAAC,IAAArB,cAAI,EAACF,IAAI,EAAEiB,IAAI,CAAC,CAAC;EACrC,CAAC;EAED,MAAMO,OAAO,GAAGA,CAAA,KAAY;IAC1B,IAAI;MACF,IAAAC,cAAM,EAACzB,IAAI,EAAE;QAAE0B,SAAS,EAAE,IAAI;QAAEC,KAAK,EAAE;MAAK,CAAC,CAAC;IAChD,CAAC,CAAC,MAAM;MACN;IAAA;EAEJ,CAAC;EAED,OAAO;IAAExD,OAAO;IAAE6C,SAAS;IAAEI,QAAQ;IAAEE,UAAU;IAAEE,OAAO;IAAExB;EAAK,CAAC;AACpE;;AAEA;AACA;AACA;;AAEO,MAAM4B,qBAAqB,CAAC;EACjCC,kBAAkBA,CAAA,EAAmB;IACnC,OAAO,CACL;MACEpD,IAAI,EAAE,aAAa;MACnBqD,WAAW,EAAE,+BAA+B;MAC5C3D,OAAO,EAAE,MAAAA,CAAA,MAAa;QACpBT,QAAQ,EAAE,aAAa;QACvBW,MAAM,EAAE,IAAI;QACZC,QAAQ,EAAE,EAAE;QACZC,MAAM,EAAE;MACV,CAAC;IACH,CAAC,CACF;EACH;AACF;AAACY,OAAA,CAAAyC,qBAAA,GAAAA,qBAAA","ignoreList":[]}