{"version":3,"names":["LiveStatusTracker","base","overrides","Map","subscribers","Set","subscribe","subscriber","add","current","currentState","delete","setBase","text","options","keepStart","startedAt","Date","now","detail","emit","pushOverride","id","existing","get","set","tone","clearOverride","size","last","Array","from","values","pop","state","sub","exports"],"sources":["liveStatus.ts"],"sourcesContent":["export type LiveStatusTone = 'info' | 'success' | 'warning' | 'error';\n\nexport interface LiveStatusState {\n  text: string;\n  detail?: string;\n  startedAt: number;\n  tone?: LiveStatusTone;\n  progress?: number;\n}\n\ntype Subscriber = (state: LiveStatusState) => void;\n\nexport class LiveStatusTracker {\n  private base: LiveStatusState | null = null;\n  private overrides = new Map<string, LiveStatusState>();\n  private subscribers = new Set<Subscriber>();\n\n  subscribe(subscriber: Subscriber): () => void {\n    this.subscribers.add(subscriber);\n    const current = this.currentState();\n    if (current) {\n      subscriber(current);\n    }\n    return () => {\n      this.subscribers.delete(subscriber);\n    };\n  }\n\n  setBase(text: string, options?: { detail?: string }): void {\n    const keepStart = this.base && this.base.text === text ? this.base.startedAt : Date.now();\n    this.base = { text, detail: options?.detail, startedAt: keepStart };\n    this.emit();\n  }\n\n  pushOverride(id: string, text: string, options?: { detail?: string; tone?: LiveStatusTone }): () => void {\n    const existing = this.overrides.get(id);\n    const startedAt = existing && existing.text === text ? existing.startedAt : Date.now();\n    this.overrides.set(id, { text, detail: options?.detail, tone: options?.tone, startedAt });\n    this.emit();\n    return () => this.clearOverride(id);\n  }\n\n  clearOverride(id: string): void {\n    this.overrides.delete(id);\n    this.emit();\n  }\n\n  private currentState(): LiveStatusState | null {\n    if (this.overrides.size) {\n      const last = Array.from(this.overrides.values()).pop();\n      if (last) return last;\n    }\n    return this.base;\n  }\n\n  private emit(): void {\n    const state = this.currentState();\n    if (!state) return;\n    for (const sub of this.subscribers) {\n      try {\n        sub(state);\n      } catch {\n        // ignore subscriber errors\n      }\n    }\n  }\n}\n"],"mappings":";;;;;;AAYO,MAAMA,iBAAiB,CAAC;EACrBC,IAAI,GAA2B,IAAI;EACnCC,SAAS,GAAG,IAAIC,GAAG,CAA0B,CAAC;EAC9CC,WAAW,GAAG,IAAIC,GAAG,CAAa,CAAC;EAE3CC,SAASA,CAACC,UAAsB,EAAc;IAC5C,IAAI,CAACH,WAAW,CAACI,GAAG,CAACD,UAAU,CAAC;IAChC,MAAME,OAAO,GAAG,IAAI,CAACC,YAAY,CAAC,CAAC;IACnC,IAAID,OAAO,EAAE;MACXF,UAAU,CAACE,OAAO,CAAC;IACrB;IACA,OAAO,MAAM;MACX,IAAI,CAACL,WAAW,CAACO,MAAM,CAACJ,UAAU,CAAC;IACrC,CAAC;EACH;EAEAK,OAAOA,CAACC,IAAY,EAAEC,OAA6B,EAAQ;IACzD,MAAMC,SAAS,GAAG,IAAI,CAACd,IAAI,IAAI,IAAI,CAACA,IAAI,CAACY,IAAI,KAAKA,IAAI,GAAG,IAAI,CAACZ,IAAI,CAACe,SAAS,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;IACzF,IAAI,CAACjB,IAAI,GAAG;MAAEY,IAAI;MAAEM,MAAM,EAAEL,OAAO,EAAEK,MAAM;MAAEH,SAAS,EAAED;IAAU,CAAC;IACnE,IAAI,CAACK,IAAI,CAAC,CAAC;EACb;EAEAC,YAAYA,CAACC,EAAU,EAAET,IAAY,EAAEC,OAAoD,EAAc;IACvG,MAAMS,QAAQ,GAAG,IAAI,CAACrB,SAAS,CAACsB,GAAG,CAACF,EAAE,CAAC;IACvC,MAAMN,SAAS,GAAGO,QAAQ,IAAIA,QAAQ,CAACV,IAAI,KAAKA,IAAI,GAAGU,QAAQ,CAACP,SAAS,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;IACtF,IAAI,CAAChB,SAAS,CAACuB,GAAG,CAACH,EAAE,EAAE;MAAET,IAAI;MAAEM,MAAM,EAAEL,OAAO,EAAEK,MAAM;MAAEO,IAAI,EAAEZ,OAAO,EAAEY,IAAI;MAAEV;IAAU,CAAC,CAAC;IACzF,IAAI,CAACI,IAAI,CAAC,CAAC;IACX,OAAO,MAAM,IAAI,CAACO,aAAa,CAACL,EAAE,CAAC;EACrC;EAEAK,aAAaA,CAACL,EAAU,EAAQ;IAC9B,IAAI,CAACpB,SAAS,CAACS,MAAM,CAACW,EAAE,CAAC;IACzB,IAAI,CAACF,IAAI,CAAC,CAAC;EACb;EAEQV,YAAYA,CAAA,EAA2B;IAC7C,IAAI,IAAI,CAACR,SAAS,CAAC0B,IAAI,EAAE;MACvB,MAAMC,IAAI,GAAGC,KAAK,CAACC,IAAI,CAAC,IAAI,CAAC7B,SAAS,CAAC8B,MAAM,CAAC,CAAC,CAAC,CAACC,GAAG,CAAC,CAAC;MACtD,IAAIJ,IAAI,EAAE,OAAOA,IAAI;IACvB;IACA,OAAO,IAAI,CAAC5B,IAAI;EAClB;EAEQmB,IAAIA,CAAA,EAAS;IACnB,MAAMc,KAAK,GAAG,IAAI,CAACxB,YAAY,CAAC,CAAC;IACjC,IAAI,CAACwB,KAAK,EAAE;IACZ,KAAK,MAAMC,GAAG,IAAI,IAAI,CAAC/B,WAAW,EAAE;MAClC,IAAI;QACF+B,GAAG,CAACD,KAAK,CAAC;MACZ,CAAC,CAAC,MAAM;QACN;MAAA;IAEJ;EACF;AACF;AAACE,OAAA,CAAApC,iBAAA,GAAAA,iBAAA","ignoreList":[]}