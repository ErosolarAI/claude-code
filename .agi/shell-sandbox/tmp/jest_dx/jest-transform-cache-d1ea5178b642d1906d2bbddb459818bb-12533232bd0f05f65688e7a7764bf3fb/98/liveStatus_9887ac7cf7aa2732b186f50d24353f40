ba8cba7a86aa2e4f2e3f7381aa772636
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.LiveStatusTracker = void 0;
class LiveStatusTracker {
  base = null;
  overrides = new Map();
  subscribers = new Set();
  subscribe(subscriber) {
    this.subscribers.add(subscriber);
    const current = this.currentState();
    if (current) {
      subscriber(current);
    }
    return () => {
      this.subscribers.delete(subscriber);
    };
  }
  setBase(text, options) {
    const keepStart = this.base && this.base.text === text ? this.base.startedAt : Date.now();
    this.base = {
      text,
      detail: options?.detail,
      startedAt: keepStart
    };
    this.emit();
  }
  pushOverride(id, text, options) {
    const existing = this.overrides.get(id);
    const startedAt = existing && existing.text === text ? existing.startedAt : Date.now();
    this.overrides.set(id, {
      text,
      detail: options?.detail,
      tone: options?.tone,
      startedAt
    });
    this.emit();
    return () => this.clearOverride(id);
  }
  clearOverride(id) {
    this.overrides.delete(id);
    this.emit();
  }
  currentState() {
    if (this.overrides.size) {
      const last = Array.from(this.overrides.values()).pop();
      if (last) return last;
    }
    return this.base;
  }
  emit() {
    const state = this.currentState();
    if (!state) return;
    for (const sub of this.subscribers) {
      try {
        sub(state);
      } catch {
        // ignore subscriber errors
      }
    }
  }
}
exports.LiveStatusTracker = LiveStatusTracker;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJMaXZlU3RhdHVzVHJhY2tlciIsImJhc2UiLCJvdmVycmlkZXMiLCJNYXAiLCJzdWJzY3JpYmVycyIsIlNldCIsInN1YnNjcmliZSIsInN1YnNjcmliZXIiLCJhZGQiLCJjdXJyZW50IiwiY3VycmVudFN0YXRlIiwiZGVsZXRlIiwic2V0QmFzZSIsInRleHQiLCJvcHRpb25zIiwia2VlcFN0YXJ0Iiwic3RhcnRlZEF0IiwiRGF0ZSIsIm5vdyIsImRldGFpbCIsImVtaXQiLCJwdXNoT3ZlcnJpZGUiLCJpZCIsImV4aXN0aW5nIiwiZ2V0Iiwic2V0IiwidG9uZSIsImNsZWFyT3ZlcnJpZGUiLCJzaXplIiwibGFzdCIsIkFycmF5IiwiZnJvbSIsInZhbHVlcyIsInBvcCIsInN0YXRlIiwic3ViIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbImxpdmVTdGF0dXMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IHR5cGUgTGl2ZVN0YXR1c1RvbmUgPSAnaW5mbycgfCAnc3VjY2VzcycgfCAnd2FybmluZycgfCAnZXJyb3InO1xuXG5leHBvcnQgaW50ZXJmYWNlIExpdmVTdGF0dXNTdGF0ZSB7XG4gIHRleHQ6IHN0cmluZztcbiAgZGV0YWlsPzogc3RyaW5nO1xuICBzdGFydGVkQXQ6IG51bWJlcjtcbiAgdG9uZT86IExpdmVTdGF0dXNUb25lO1xuICBwcm9ncmVzcz86IG51bWJlcjtcbn1cblxudHlwZSBTdWJzY3JpYmVyID0gKHN0YXRlOiBMaXZlU3RhdHVzU3RhdGUpID0+IHZvaWQ7XG5cbmV4cG9ydCBjbGFzcyBMaXZlU3RhdHVzVHJhY2tlciB7XG4gIHByaXZhdGUgYmFzZTogTGl2ZVN0YXR1c1N0YXRlIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgb3ZlcnJpZGVzID0gbmV3IE1hcDxzdHJpbmcsIExpdmVTdGF0dXNTdGF0ZT4oKTtcbiAgcHJpdmF0ZSBzdWJzY3JpYmVycyA9IG5ldyBTZXQ8U3Vic2NyaWJlcj4oKTtcblxuICBzdWJzY3JpYmUoc3Vic2NyaWJlcjogU3Vic2NyaWJlcik6ICgpID0+IHZvaWQge1xuICAgIHRoaXMuc3Vic2NyaWJlcnMuYWRkKHN1YnNjcmliZXIpO1xuICAgIGNvbnN0IGN1cnJlbnQgPSB0aGlzLmN1cnJlbnRTdGF0ZSgpO1xuICAgIGlmIChjdXJyZW50KSB7XG4gICAgICBzdWJzY3JpYmVyKGN1cnJlbnQpO1xuICAgIH1cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgdGhpcy5zdWJzY3JpYmVycy5kZWxldGUoc3Vic2NyaWJlcik7XG4gICAgfTtcbiAgfVxuXG4gIHNldEJhc2UodGV4dDogc3RyaW5nLCBvcHRpb25zPzogeyBkZXRhaWw/OiBzdHJpbmcgfSk6IHZvaWQge1xuICAgIGNvbnN0IGtlZXBTdGFydCA9IHRoaXMuYmFzZSAmJiB0aGlzLmJhc2UudGV4dCA9PT0gdGV4dCA/IHRoaXMuYmFzZS5zdGFydGVkQXQgOiBEYXRlLm5vdygpO1xuICAgIHRoaXMuYmFzZSA9IHsgdGV4dCwgZGV0YWlsOiBvcHRpb25zPy5kZXRhaWwsIHN0YXJ0ZWRBdDoga2VlcFN0YXJ0IH07XG4gICAgdGhpcy5lbWl0KCk7XG4gIH1cblxuICBwdXNoT3ZlcnJpZGUoaWQ6IHN0cmluZywgdGV4dDogc3RyaW5nLCBvcHRpb25zPzogeyBkZXRhaWw/OiBzdHJpbmc7IHRvbmU/OiBMaXZlU3RhdHVzVG9uZSB9KTogKCkgPT4gdm9pZCB7XG4gICAgY29uc3QgZXhpc3RpbmcgPSB0aGlzLm92ZXJyaWRlcy5nZXQoaWQpO1xuICAgIGNvbnN0IHN0YXJ0ZWRBdCA9IGV4aXN0aW5nICYmIGV4aXN0aW5nLnRleHQgPT09IHRleHQgPyBleGlzdGluZy5zdGFydGVkQXQgOiBEYXRlLm5vdygpO1xuICAgIHRoaXMub3ZlcnJpZGVzLnNldChpZCwgeyB0ZXh0LCBkZXRhaWw6IG9wdGlvbnM/LmRldGFpbCwgdG9uZTogb3B0aW9ucz8udG9uZSwgc3RhcnRlZEF0IH0pO1xuICAgIHRoaXMuZW1pdCgpO1xuICAgIHJldHVybiAoKSA9PiB0aGlzLmNsZWFyT3ZlcnJpZGUoaWQpO1xuICB9XG5cbiAgY2xlYXJPdmVycmlkZShpZDogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5vdmVycmlkZXMuZGVsZXRlKGlkKTtcbiAgICB0aGlzLmVtaXQoKTtcbiAgfVxuXG4gIHByaXZhdGUgY3VycmVudFN0YXRlKCk6IExpdmVTdGF0dXNTdGF0ZSB8IG51bGwge1xuICAgIGlmICh0aGlzLm92ZXJyaWRlcy5zaXplKSB7XG4gICAgICBjb25zdCBsYXN0ID0gQXJyYXkuZnJvbSh0aGlzLm92ZXJyaWRlcy52YWx1ZXMoKSkucG9wKCk7XG4gICAgICBpZiAobGFzdCkgcmV0dXJuIGxhc3Q7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmJhc2U7XG4gIH1cblxuICBwcml2YXRlIGVtaXQoKTogdm9pZCB7XG4gICAgY29uc3Qgc3RhdGUgPSB0aGlzLmN1cnJlbnRTdGF0ZSgpO1xuICAgIGlmICghc3RhdGUpIHJldHVybjtcbiAgICBmb3IgKGNvbnN0IHN1YiBvZiB0aGlzLnN1YnNjcmliZXJzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBzdWIoc3RhdGUpO1xuICAgICAgfSBjYXRjaCB7XG4gICAgICAgIC8vIGlnbm9yZSBzdWJzY3JpYmVyIGVycm9yc1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFZTyxNQUFNQSxpQkFBaUIsQ0FBQztFQUNyQkMsSUFBSSxHQUEyQixJQUFJO0VBQ25DQyxTQUFTLEdBQUcsSUFBSUMsR0FBRyxDQUEwQixDQUFDO0VBQzlDQyxXQUFXLEdBQUcsSUFBSUMsR0FBRyxDQUFhLENBQUM7RUFFM0NDLFNBQVNBLENBQUNDLFVBQXNCLEVBQWM7SUFDNUMsSUFBSSxDQUFDSCxXQUFXLENBQUNJLEdBQUcsQ0FBQ0QsVUFBVSxDQUFDO0lBQ2hDLE1BQU1FLE9BQU8sR0FBRyxJQUFJLENBQUNDLFlBQVksQ0FBQyxDQUFDO0lBQ25DLElBQUlELE9BQU8sRUFBRTtNQUNYRixVQUFVLENBQUNFLE9BQU8sQ0FBQztJQUNyQjtJ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