{"version":3,"names":["cov_2j8oa6bqq6","actualCoverage","AgentSession","AgentHost","context","toolObserver","modules","s","Map","contributions","contributionOwners","moduleContributions","session","disposed","constructor","options","f","profile","workspaceContext","workingDir","env","b","process","refreshWorkspaceContext","loadModules","module","registerModule","assertMutable","removeModuleContributions","id","set","result","create","normalized","normalizeContributions","contribution","validateContribution","push","contributionSet","get","Set","add","getSession","toolSuites","collectToolSuites","describeCapabilities","map","moduleId","description","metadata","undefined","dispose","tasks","filter","fn","Promise","all","suites","seen","records","normalizeSuites","suite","has","Error","trim","ids","size","delete","index","findIndex","entry","splice","value","Array","isArray","toolSuite","length"],"sources":["agentHost.ts"],"sourcesContent":["import type { ProfileName } from '../config.js';\nimport { AgentSession, type AgentSessionOptions } from './agentSession.js';\nimport { type ToolRuntimeObserver, type ToolSuite } from '../core/toolRuntime.js';\n\nexport interface CapabilityContext {\n  profile: ProfileName;\n  workspaceContext: string | null;\n  workingDir: string;\n  env: NodeJS.ProcessEnv;\n}\n\nexport interface CapabilityContribution {\n  id: string;\n  description?: string;\n  toolSuite?: ToolSuite;\n  toolSuites?: ToolSuite[];\n  metadata?: Record<string, unknown>;\n  dispose?(): void | Promise<void>;\n}\n\nexport interface CapabilityModule {\n  id: string;\n  description?: string;\n  create(\n    context: CapabilityContext\n  ): CapabilityContribution | CapabilityContribution[] | null | undefined | Promise<CapabilityContribution | CapabilityContribution[] | null | undefined>;\n}\n\nexport interface CapabilityManifestEntry {\n  id: string;\n  moduleId: string;\n  description?: string;\n  metadata?: Record<string, unknown>;\n}\n\nexport interface AgentHostOptions {\n  profile: ProfileName;\n  workspaceContext: string | null;\n  workingDir: string;\n  modules?: CapabilityModule[];\n  toolObserver?: ToolRuntimeObserver;\n  env?: NodeJS.ProcessEnv;\n}\n\nexport class AgentHost {\n  private readonly context: CapabilityContext;\n  private readonly toolObserver?: ToolRuntimeObserver;\n  private readonly modules = new Map<string, CapabilityModule>();\n  private readonly contributions: CapabilityContribution[] = [];\n  private readonly contributionOwners = new Map<string, string>();\n  private readonly moduleContributions = new Map<string, Set<string>>();\n  private session: AgentSession | null = null;\n  private disposed = false;\n\n  constructor(options: AgentHostOptions) {\n    this.context = {\n      profile: options.profile,\n      workspaceContext: options.workspaceContext,\n      workingDir: options.workingDir,\n      env: options.env ? { ...options.env } : { ...process.env },\n    };\n    this.toolObserver = options.toolObserver;\n  }\n\n  get profile(): ProfileName {\n    return this.context.profile;\n  }\n\n  get workspaceContext(): string | null {\n    return this.context.workspaceContext ?? null;\n  }\n\n  get workingDir(): string {\n    return this.context.workingDir;\n  }\n\n  refreshWorkspaceContext(workspaceContext: string | null): void {\n    this.context.workspaceContext = workspaceContext;\n    this.session?.refreshWorkspaceContext(workspaceContext);\n  }\n\n  async loadModules(modules: CapabilityModule[]): Promise<void> {\n    for (const module of modules) {\n      await this.registerModule(module);\n    }\n  }\n\n  async registerModule(module: CapabilityModule): Promise<void> {\n    this.assertMutable();\n    this.removeModuleContributions(module.id);\n    this.modules.set(module.id, module);\n    const result = await module.create(this.context);\n    const normalized = normalizeContributions(result);\n    for (const contribution of normalized) {\n      this.validateContribution(contribution, module.id);\n      this.contributions.push(contribution);\n      this.contributionOwners.set(contribution.id, module.id);\n      const contributionSet = this.moduleContributions.get(module.id) ?? new Set<string>();\n      contributionSet.add(contribution.id);\n      this.moduleContributions.set(module.id, contributionSet);\n    }\n  }\n\n  async getSession(): Promise<AgentSession> {\n    if (this.session) {\n      return this.session;\n    }\n\n    const toolSuites = this.collectToolSuites();\n    this.session = new AgentSession({\n      profile: this.context.profile,\n      workspaceContext: this.context.workspaceContext,\n      toolSuites,\n      toolObserver: this.toolObserver,\n    } satisfies AgentSessionOptions);\n\n    return this.session;\n  }\n\n  describeCapabilities(): CapabilityManifestEntry[] {\n    return this.contributions.map((contribution) => ({\n      id: contribution.id,\n      moduleId: this.contributionOwners.get(contribution.id) ?? 'unknown',\n      description: contribution.description,\n      metadata: contribution.metadata ?? undefined,\n    }));\n  }\n\n  async dispose(): Promise<void> {\n    if (this.disposed) {\n      return;\n    }\n    this.disposed = true;\n    const tasks = this.contributions\n      .map((contribution) => contribution.dispose)\n      .filter((fn): fn is NonNullable<CapabilityContribution['dispose']> => typeof fn === 'function')\n      .map(async (dispose) => {\n        try {\n          await dispose();\n        } catch {\n          // Ignore disposal errors to avoid masking upstream teardown.\n        }\n      });\n    await Promise.all(tasks);\n  }\n\n  private collectToolSuites(): ToolSuite[] {\n    const suites: ToolSuite[] = [];\n    const seen = new Set<string>();\n    for (const contribution of this.contributions) {\n      const records = normalizeSuites(contribution);\n      for (const suite of records) {\n        if (seen.has(suite.id)) {\n          throw new Error(\n            `Duplicate tool suite id \"${suite.id}\" detected while composing capabilities. ` +\n              'Ensure every capability module emits unique suite identifiers.'\n          );\n        }\n        suites.push(suite);\n        seen.add(suite.id);\n      }\n    }\n    return suites;\n  }\n\n  private validateContribution(contribution: CapabilityContribution, moduleId: string): void {\n    if (!contribution?.id?.trim()) {\n      throw new Error(`Capability module \"${moduleId}\" emitted a contribution without an id.`);\n    }\n    const suites = normalizeSuites(contribution);\n    for (const suite of suites) {\n      if (!suite?.id?.trim()) {\n        throw new Error(\n          `Capability contribution \"${contribution.id}\" from module \"${moduleId}\" ` +\n            'emitted a tool suite without an id.'\n        );\n      }\n    }\n  }\n\n  private assertMutable(): void {\n    if (this.session) {\n      throw new Error(\n        'Cannot register an additional capability module after the runtime session has been created. ' +\n          'Instantiate AgentHost earlier in the boot sequence or create a new host instance.'\n      );\n    }\n  }\n\n  private removeModuleContributions(moduleId: string): void {\n    const ids = this.moduleContributions.get(moduleId);\n    if (!ids?.size) {\n      return;\n    }\n    this.moduleContributions.delete(moduleId);\n    for (const id of ids) {\n      const index = this.contributions.findIndex((entry) => entry.id === id);\n      if (index >= 0) {\n        this.contributions.splice(index, 1);\n      }\n      this.contributionOwners.delete(id);\n    }\n  }\n}\n\nfunction normalizeContributions(\n  value: CapabilityContribution | CapabilityContribution[] | null | undefined\n): CapabilityContribution[] {\n  if (!value) {\n    return [];\n  }\n  return Array.isArray(value) ? value : [value];\n}\n\nfunction normalizeSuites(contribution: CapabilityContribution): ToolSuite[] {\n  const suites: ToolSuite[] = [];\n  if (contribution.toolSuite) {\n    suites.push(contribution.toolSuite);\n  }\n  if (contribution.toolSuites?.length) {\n    suites.push(...contribution.toolSuites);\n  }\n  return suites;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}