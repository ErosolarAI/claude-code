0a3243f2659a0f969f830c2b764cb7e8
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.buildEvaluatorConfig = buildEvaluatorConfig;
var _dualTournament = require("./dualTournament.js");
function cloneWeights(weights) {
  return {
    ...weights
  };
}
function isTestHeavy(module) {
  return module.label.toLowerCase().includes('test') || module.scope.some(s => s.includes('test'));
}
function buildEvaluatorConfig(module, telemetry) {
  const rewardWeights = cloneWeights(_dualTournament.DEFAULT_HUMAN_REWARD_WEIGHTS);
  const evaluators = [{
    id: 'hard-metrics',
    weight: 1.2
  }, {
    id: 'quality',
    weight: 1.0
  }, {
    id: 'reward-model',
    weight: 1.0
  }];

  // Emphasize correctness for test-heavy modules
  if (isTestHeavy(module)) {
    rewardWeights.alpha = Math.max(rewardWeights.alpha, 0.7);
    const hard = evaluators.find(e => e.id === 'hard-metrics');
    if (hard) hard.weight = Math.max(hard.weight ?? 1, 1.8);
  }

  // Apply telemetry bias
  const key = module.label.toLowerCase().includes('test') ? 'tests' : 'general';
  const snapshot = telemetry?.get(key);
  if (snapshot) {
    if (snapshot.winsPrimary > snapshot.winsRefiner) {
      rewardWeights.alpha = Math.min(0.85, rewardWeights.alpha + 0.05);
      const hard = evaluators.find(e => e.id === 'hard-metrics');
      if (hard) hard.weight = (hard.weight ?? 1) + 0.4;
    } else if (snapshot.winsRefiner > snapshot.winsPrimary) {
      rewardWeights.beta = Math.max(0.3, rewardWeights.beta + 0.05);
      const quality = evaluators.find(e => e.id === 'quality');
      if (quality) quality.weight = (quality.weight ?? 1) + 0.2;
    }
  }
  return {
    rewardWeights,
    evaluators
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZHVhbFRvdXJuYW1lbnQiLCJyZXF1aXJlIiwiY2xvbmVXZWlnaHRzIiwid2VpZ2h0cyIsImlzVGVzdEhlYXZ5IiwibW9kdWxlIiwibGFiZWwiLCJ0b0xvd2VyQ2FzZSIsImluY2x1ZGVzIiwic2NvcGUiLCJzb21lIiwicyIsImJ1aWxkRXZhbHVhdG9yQ29uZmlnIiwidGVsZW1ldHJ5IiwicmV3YXJkV2VpZ2h0cyIsIkRFRkFVTFRfSFVNQU5fUkVXQVJEX1dFSUdIVFMiLCJldmFsdWF0b3JzIiwiaWQiLCJ3ZWlnaHQiLCJhbHBoYSIsIk1hdGgiLCJtYXgiLCJoYXJkIiwiZmluZCIsImUiLCJrZXkiLCJzbmFwc2hvdCIsImdldCIsIndpbnNQcmltYXJ5Iiwid2luc1JlZmluZXIiLCJtaW4iLCJiZXRhIiwicXVhbGl0eSJdLCJzb3VyY2VzIjpbInRvdXJuYW1lbnRTdHJhdGVneS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBERUZBVUxUX0hVTUFOX1JFV0FSRF9XRUlHSFRTLFxuICB0eXBlIEh1bWFuUmV3YXJkV2VpZ2h0cyxcbiAgdHlwZSBUb3VybmFtZW50RXZhbHVhdG9yLFxufSBmcm9tICcuL2R1YWxUb3VybmFtZW50LmpzJztcbmltcG9ydCB0eXBlIHsgUmVwb1VwZ3JhZGVNb2R1bGUgfSBmcm9tICcuL3JlcG9VcGdyYWRlT3JjaGVzdHJhdG9yLmpzJztcblxuZXhwb3J0IGludGVyZmFjZSBUZWxlbWV0cnlTbmFwc2hvdCB7XG4gIHdpbnNQcmltYXJ5OiBudW1iZXI7XG4gIHdpbnNSZWZpbmVyOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRXZhbHVhdG9yQ29uZmlnIHtcbiAgcmV3YXJkV2VpZ2h0czogSHVtYW5SZXdhcmRXZWlnaHRzO1xuICBldmFsdWF0b3JzOiBUb3VybmFtZW50RXZhbHVhdG9yW107XG59XG5cbmZ1bmN0aW9uIGNsb25lV2VpZ2h0cyh3ZWlnaHRzOiBIdW1hblJld2FyZFdlaWdodHMpOiBIdW1hblJld2FyZFdlaWdodHMge1xuICByZXR1cm4geyAuLi53ZWlnaHRzIH07XG59XG5cbmZ1bmN0aW9uIGlzVGVzdEhlYXZ5KG1vZHVsZTogUmVwb1VwZ3JhZGVNb2R1bGUpOiBib29sZWFuIHtcbiAgcmV0dXJuIG1vZHVsZS5sYWJlbC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCd0ZXN0JykgfHwgbW9kdWxlLnNjb3BlLnNvbWUoKHMpID0+IHMuaW5jbHVkZXMoJ3Rlc3QnKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBidWlsZEV2YWx1YXRvckNvbmZpZyhcbiAgbW9kdWxlOiBSZXBvVXBncmFkZU1vZHVsZSxcbiAgdGVsZW1ldHJ5PzogTWFwPHN0cmluZywgVGVsZW1ldHJ5U25hcHNob3Q+XG4pOiBFdmFsdWF0b3JDb25maWcge1xuICBjb25zdCByZXdhcmRXZWlnaHRzID0gY2xvbmVXZWlnaHRzKERFRkFVTFRfSFVNQU5fUkVXQVJEX1dFSUdIVFMpO1xuICBjb25zdCBldmFsdWF0b3JzOiBUb3VybmFtZW50RXZhbHVhdG9yW10gPSBbXG4gICAgeyBpZDogJ2hhcmQtbWV0cmljcycsIHdlaWdodDogMS4yIH0sXG4gICAgeyBpZDogJ3F1YWxpdHknLCB3ZWlnaHQ6IDEuMCB9LFxuICAgIHsgaWQ6ICdyZXdhcmQtbW9kZWwnLCB3ZWlnaHQ6IDEuMCB9LFxuICBdO1xuXG4gIC8vIEVtcGhhc2l6ZSBjb3JyZWN0bmVzcyBmb3IgdGVzdC1oZWF2eSBtb2R1bGVzXG4gIGlmIChpc1Rlc3RIZWF2eShtb2R1bGUpKSB7XG4gICAgcmV3YXJkV2VpZ2h0cy5hbHBoYSA9IE1hdGgubWF4KHJld2FyZFdlaWdodHMuYWxwaGEsIDAuNyk7XG4gICAgY29uc3QgaGFyZCA9IGV2YWx1YXRvcnMuZmluZCgoZSkgPT4gZS5pZCA9PT0gJ2hhcmQtbWV0cmljcycpO1xuICAgIGlmIChoYXJkKSBoYXJkLndlaWdodCA9IE1hdGgubWF4KGhhcmQud2VpZ2h0ID8/IDEsIDEuOCk7XG4gIH1cblxuICAvLyBBcHBseSB0ZWxlbWV0cnkgYmlhc1xuICBjb25zdCBrZXkgPSBtb2R1bGUubGFiZWwudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygndGVzdCcpID8gJ3Rlc3RzJyA6ICdnZW5lcmFsJztcbiAgY29uc3Qgc25hcHNob3QgPSB0ZWxlbWV0cnk/LmdldChrZXkpO1xuICBpZiAoc25hcHNob3QpIHtcbiAgICBpZiAoc25hcHNob3Qud2luc1ByaW1hcnkgPiBzbmFwc2hvdC53aW5zUmVmaW5lcikge1xuICAgICAgcmV3YXJkV2VpZ2h0cy5hbHBoYSA9IE1hdGgubWluKDAuODUsIHJld2FyZFdlaWdodHMuYWxwaGEgKyAwLjA1KTtcbiAgICAgIGNvbnN0IGhhcmQgPSBldmFsdWF0b3JzLmZpbmQoKGUpID0+IGUuaWQgPT09ICdoYXJkLW1ldHJpY3MnKTtcbiAgICAgIGlmIChoYXJkKSBoYXJkLndlaWdodCA9IChoYXJkLndlaWdodCA/PyAxKSArIDAuNDtcbiAgICB9IGVsc2UgaWYgKHNuYXBzaG90LndpbnNSZWZpbmVyID4gc25hcHNob3Qud2luc1ByaW1hcnkpIHtcbiAgICAgIHJld2FyZFdlaWdodHMuYmV0YSA9IE1hdGgubWF4KDAuMywgcmV3YXJkV2VpZ2h0cy5iZXRhICsgMC4wNSk7XG4gICAgICBjb25zdCBxdWFsaXR5ID0gZXZhbHVhdG9ycy5maW5kKChlKSA9PiBlLmlkID09PSAncXVhbGl0eScpO1xuICAgICAgaWYgKHF1YWxpdHkpIHF1YWxpdHkud2VpZ2h0ID0gKHF1YWxpdHkud2VpZ2h0ID8/IDEpICsgMC4yO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7IHJld2FyZFdlaWdodHMsIGV2YWx1YXRvcnMgfTtcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsSUFBQUEsZUFBQSxHQUFBQyxPQUFBO0FBaUJBLFNBQVNDLFlBQVlBLENBQUNDLE9BQTJCLEVBQXNCO0VBQ3JFLE9BQU87SUFBRSxHQUFHQTtFQUFRLENBQUM7QUFDdkI7QUFFQSxTQUFTQyxXQUFXQSxDQUFDQyxNQUF5QixFQUFXO0VBQ3ZELE9BQU9BLE1BQU0sQ0FBQ0MsS0FBSyxDQUFDQyxXQUFXLENBQUMsQ0FBQyxDQUFDQyxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUlILE1BQU0sQ0FBQ0ksS0FBSyxDQUFDQyxJQUFJLENBQUVDLENBQUMsSUFBS0EsQ0FBQyxDQUFDSCxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDcEc7QUFFTyxTQUFTSSxvQkFBb0JBLENBQ2xDUCxNQUF5QixFQUN6QlEsU0FBMEMsRUFDekI7RUFDakIsTUFBTUMsYUFBYSxHQUFHWixZQUFZLENBQUNhLDRDQUE0QixDQUFDO0VBQ2hFLE1BQU1DLFVBQWlDLEdBQUcsQ0FDeEM7SUFBRUMsRUFBRSxFQUFFLGNBQWM7SUFBRUMsTUFBTSxFQUFFO0VBQUksQ0FBQyxFQUNuQztJQUFFRCxFQUFFLEVBQUUsU0FBUztJQUFFQyxNQUFNLEVBQUU7RUFBSSxDQUFDLEVBQzlCO0lBQUVELEVBQUUsRUFBRSxjQUFjO0lBQUVDLE1BQU0sRUFBRTtFQUFJLENBQUMsQ0FDcEM7O0VBRUQ7RUFDQSxJQUFJZCxXQUFXLENBQUNDLE1BQU0sQ0FBQyxFQUFFO0lBQ3ZCUyxhQUFhLENBQUNLLEtBQUssR0FBR0MsSUFBSSxDQUFDQyxHQUFHLENBQUNQLGFBQWEsQ0FBQ0ssS0FBSyxFQUFFLEdBQUcsQ0FBQztJQUN4RCxNQUFNRyxJQUFJLEdBQUdOLFVBQVUsQ0FBQ08sSUFBSSxDQUFFQyxDQUFDLElBQUtBLENBQUMsQ0FBQ1AsRUFBRSxLQUFLLGNBQWMsQ0FBQztJQUM1RCxJQUFJSyxJQUFJLEVBQUVBLElBQUksQ0FBQ0osTUFBTSxHQUFHRSxJQUFJLENBQUNDLEdBQUcsQ0FBQ0MsSUFBSSxDQUFDSixNQUFNLElBQUksQ0FBQyxFQUFFLEdBQUcsQ0FBQztFQUN6RDs7RUFFQTtFQUNBLE1BQU1PLEdBQUcsR0FBR3BCLE1BQU0sQ0FBQ0MsS0FBSyxDQUFDQyxXQUFXLENBQUMsQ0FBQyxDQUFDQyxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsT0FBTyxHQUFHLFNBQVM7RUFDN0UsTUFBTWtCLFFBQVEsR0FBR2IsU0FBUyxFQUFFYyxHQUFHLENBQUNGLEdBQUcsQ0FBQztFQUNwQyxJQUFJQyxRQUFRLEVBQUU7SUFDWixJQUFJQSxRQUFRLENBQUNFLFdBQVcsR0FBR0YsUUFBUSxDQUFDRyxXQUFXLEVBQUU7TUFDL0NmLGFBQWEsQ0FBQ0ssS0FBSyxHQUFHQyxJQUFJLENBQUNVLEdBQUcsQ0FBQyxJQUFJLEVBQUVoQixhQUFhLENBQUNLLEtBQUssR0FBRyxJQUFJLENBQUM7TUFDaEUsTUFBTUcsSUFBSSxHQUFHTixVQUFVLENBQUNPLElBQUksQ0FBRUMsQ0FBQyxJQUFLQSxDQUFDLENBQUNQLEVBQUUsS0FBSyxjQUFjLENBQUM7TUFDNUQsSUFBSUssSUFBSSxFQUFFQSxJQUFJLENBQUNKLE1BQU0sR0FBRyxDQUFDSSxJQUFJLENBQUNKLE1BQU0sSUFBSSxDQUFDLElBQUksR0FBRztJQUNsRCxDQUFDLE1BQU0sSUFBSVEsUUFBUSxDQUFDRyxXQUFXLEdBQUdILFFBQVEsQ0FBQ0UsV0FBVyxFQUFFO01BQ3REZCxhQUFhLENBQUNpQixJQUFJLEdBQUdYLElBQUksQ0FBQ0MsR0FBRyxDQUFDLEdBQUcsRUFBRVAsYUFBYSxDQUFDaUIsSUFBSSxHQUFHLElBQUksQ0FBQztNQUM3RCxNQUFNQyxPQUFPLEdBQUdoQixVQUFVLENBQUNPLElBQUksQ0FBRUMsQ0FBQyxJQUFLQSxDQUFDLENBQUNQLEVBQUUsS0FBSyxTQUFTLENBQUM7TUFDMUQsSUFBSWUsT0FBTyxFQUFFQSxPQUFPLENBQUNkLE1BQU0sR0FBRyxDQUFDYyxPQUFPLENBQUNkLE1BQU0sSUFBSSxDQUFDLElBQUksR0FBRztJQUMzRDtFQUNGO0VBRUEsT0FBTztJQUFFSixhQUFhO0lBQUVFO0VBQVcsQ0FBQztBQUN0QyIsImlnbm9yZUxpc3QiOltdfQ==