{"version":3,"names":["_UIUpdateCoordinator","require","OrchestrationUIBridge","constructor","options","display","orchestrator","updateCoordinator","UIUpdateCoordinator","showRealtime","Boolean","showRealTimeOutput","onEvent","unsub","event","handleEvent","execute","objective","execConfig","setMode","report","id","startTime","Date","now","endTime","duration","results","findings","recommendations","summary","success","dispose","data","name","String","toolName","writeRaw","type","enqueue","lane","run","exports"],"sources":["OrchestrationUIBridge.ts"],"sourcesContent":["import type { OrchestratorEvent, OperationConfig, OperationReport, UnifiedOrchestrator } from '../../core/unifiedOrchestrator.js';\nimport { UIUpdateCoordinator } from './UIUpdateCoordinator.js';\n\ninterface Display {\n  writeRaw(text: string): void;\n  showError(title: string, error: unknown): void;\n  showSystemMessage(message: string): void;\n}\n\ninterface BridgeOptions {\n  display: Display;\n  updateCoordinator?: UIUpdateCoordinator;\n  orchestrator?: UnifiedOrchestrator;\n  showRealTimeOutput?: boolean;\n  showProgressBar?: boolean;\n  verboseMode?: boolean;\n}\n\nexport class OrchestrationUIBridge {\n  private readonly display: Display;\n  private readonly orchestrator: UnifiedOrchestrator | undefined;\n  private readonly updateCoordinator: UIUpdateCoordinator;\n  private readonly showRealtime: boolean;\n  private unsub?: () => void;\n\n  constructor(options: BridgeOptions) {\n    this.display = options.display;\n    this.orchestrator = options.orchestrator;\n    this.updateCoordinator = options.updateCoordinator ?? new UIUpdateCoordinator();\n    this.showRealtime = Boolean(options.showRealTimeOutput);\n\n    if (this.orchestrator?.onEvent) {\n      this.unsub = this.orchestrator.onEvent((event) => this.handleEvent(event));\n    }\n  }\n\n  async execute(objective: string): Promise<OperationReport> {\n    const execConfig: Partial<OperationConfig> = { objective };\n    this.updateCoordinator.setMode('flushing');\n    const report =\n      (await this.orchestrator?.execute(execConfig)) ??\n      ({\n        id: 'noop',\n        objective,\n        startTime: Date.now(),\n        endTime: Date.now(),\n        duration: 0,\n        results: [],\n        findings: [],\n        recommendations: [],\n        summary: 'noop',\n        success: true,\n      } satisfies OperationReport);\n    this.updateCoordinator.setMode('idle');\n    return report;\n  }\n\n  dispose(): void {\n    this.unsub?.();\n  }\n\n  private handleEvent(event: OrchestratorEvent): void {\n    if (!this.showRealtime) {\n      return;\n    }\n    const data = event.data;\n    let name = '';\n    if (data && typeof data === 'object' && 'toolName' in data) {\n      name = String((data as {toolName: unknown}).toolName);\n    }\n    this.display.writeRaw(`[${event.type}] ${name}\\n`);\n    this.updateCoordinator.enqueue({\n      lane: 'status',\n      run: () => {\n        this.display.writeRaw('');\n      },\n    });\n  }\n}\n"],"mappings":";;;;;;AACA,IAAAA,oBAAA,GAAAC,OAAA;AAiBO,MAAMC,qBAAqB,CAAC;EAOjCC,WAAWA,CAACC,OAAsB,EAAE;IAClC,IAAI,CAACC,OAAO,GAAGD,OAAO,CAACC,OAAO;IAC9B,IAAI,CAACC,YAAY,GAAGF,OAAO,CAACE,YAAY;IACxC,IAAI,CAACC,iBAAiB,GAAGH,OAAO,CAACG,iBAAiB,IAAI,IAAIC,wCAAmB,CAAC,CAAC;IAC/E,IAAI,CAACC,YAAY,GAAGC,OAAO,CAACN,OAAO,CAACO,kBAAkB,CAAC;IAEvD,IAAI,IAAI,CAACL,YAAY,EAAEM,OAAO,EAAE;MAC9B,IAAI,CAACC,KAAK,GAAG,IAAI,CAACP,YAAY,CAACM,OAAO,CAAEE,KAAK,IAAK,IAAI,CAACC,WAAW,CAACD,KAAK,CAAC,CAAC;IAC5E;EACF;EAEA,MAAME,OAAOA,CAACC,SAAiB,EAA4B;IACzD,MAAMC,UAAoC,GAAG;MAAED;IAAU,CAAC;IAC1D,IAAI,CAACV,iBAAiB,CAACY,OAAO,CAAC,UAAU,CAAC;IAC1C,MAAMC,MAAM,GACV,CAAC,MAAM,IAAI,CAACd,YAAY,EAAEU,OAAO,CAACE,UAAU,CAAC,KAC5C;MACCG,EAAE,EAAE,MAAM;MACVJ,SAAS;MACTK,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC,CAAC;MACrBC,OAAO,EAAEF,IAAI,CAACC,GAAG,CAAC,CAAC;MACnBE,QAAQ,EAAE,CAAC;MACXC,OAAO,EAAE,EAAE;MACXC,QAAQ,EAAE,EAAE;MACZC,eAAe,EAAE,EAAE;MACnBC,OAAO,EAAE,MAAM;MACfC,OAAO,EAAE;IACX,CAA4B;IAC9B,IAAI,CAACxB,iBAAiB,CAACY,OAAO,CAAC,MAAM,CAAC;IACtC,OAAOC,MAAM;EACf;EAEAY,OAAOA,CAAA,EAAS;IACd,IAAI,CAACnB,KAAK,GAAG,CAAC;EAChB;EAEQE,WAAWA,CAACD,KAAwB,EAAQ;IAClD,IAAI,CAAC,IAAI,CAACL,YAAY,EAAE;MACtB;IACF;IACA,MAAMwB,IAAI,GAAGnB,KAAK,CAACmB,IAAI;IACvB,IAAIC,IAAI,GAAG,EAAE;IACb,IAAID,IAAI,IAAI,OAAOA,IAAI,KAAK,QAAQ,IAAI,UAAU,IAAIA,IAAI,EAAE;MAC1DC,IAAI,GAAGC,MAAM,CAAEF,IAAI,CAAyBG,QAAQ,CAAC;IACvD;IACA,IAAI,CAAC/B,OAAO,CAACgC,QAAQ,CAAC,IAAIvB,KAAK,CAACwB,IAAI,KAAKJ,IAAI,IAAI,CAAC;IAClD,IAAI,CAAC3B,iBAAiB,CAACgC,OAAO,CAAC;MAC7BC,IAAI,EAAE,QAAQ;MACdC,GAAG,EAAEA,CAAA,KAAM;QACT,IAAI,CAACpC,OAAO,CAACgC,QAAQ,CAAC,EAAE,CAAC;MAC3B;IACF,CAAC,CAAC;EACJ;AACF;AAACK,OAAA,CAAAxC,qBAAA,GAAAA,qBAAA","ignoreList":[]}