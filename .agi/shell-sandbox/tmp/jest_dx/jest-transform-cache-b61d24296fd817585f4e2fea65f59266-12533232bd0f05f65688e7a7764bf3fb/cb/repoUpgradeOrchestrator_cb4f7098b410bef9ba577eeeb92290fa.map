{"version":3,"names":["_nodeFs","require","_nodePath","_nodeOs","_unifiedOrchestrator","_dualTournament","_variantExecution","_winnerStrategy","_tournamentStrategy","_parallelCoordinator","_upgradePlan","DEFAULT_REWARD_WEIGHTS","exports","executionSuccess","testsPassed","staticAnalysis","codeQuality","blastRadius","selfAssessment","speedBonus","calculateRewardScore","signals","weights","score","totalWeight","key","weight","Object","entries","signal","extractRewardSignals","output","durationMs","baselineDurationMs","lower","toLowerCase","clamp","value","Math","max","min","hasErrors","test","testMatch","match","failMatch","passed","parseInt","failed","total","diffMatch","filesChanged","speedRatio","REPO_UPGRADE_MODE_DEFINITIONS","id","label","description","variants","variantGuidance","primary","parallelVariants","refiner","refinerBias","RepoUpgradeOrchestrator","UnifiedOrchestrator","parallelCoordinator","repoTypeTelemetry","Map","disableTelemetryPersistence","process","env","AGI_DISABLE_RL_TELEMETRY","constructor","executor","run","plan","options","mode","continueOnFailure","objective","modeDefinition","getModeDefinition","parallelModules","parallelModuleConcurrency","variantWorkspaceRoots","repoPolicy","undefined","results","findings","variantStats","primaryWins","refinerWins","ties","totalSteps","emit","type","timestamp","Date","now","data","moduleReports","modules","length","runModulesInParallel","runModulesSequentially","baseReport","generateReport","halted","module","push","scope","steps","status","moduleReport","processModule","concurrency","ParallelCoordinator","reports","runModules","event","firstFailure","findIndex","report","slice","moduleStart","moduleId","codemodCommands","validationCommands","step","outcome","runStep","updateVariantStats","winner","success","stepStart","stepId","variant","variantResults","executeVariants","context","executeVariant","input","safeExecuteVariant","tournamentOutcome","evaluateTournamentOutcome","attachTournamentBreakdown","winnerVariant","resolveWinnerStrategy","definition","primaryResult","refinerResult","pickWinner","recordOutcomeArtifacts","primaryScore","tournament","aggregateScore","refinerScore","primaryAccuracy","humanAccuracy","refinerAccuracy","primarySuccess","refinerSuccess","tournamentRankings","ranked","intent","updateRepoTypeTelemetry","getRepoTypeFromModule","candidates","buildTournamentCandidate","task","goal","constraints","metadata","evaluatorConfig","buildEvaluatorConfig","runDualTournament","rewardWeights","evaluators","maxCandidates","result","rewardSignals","rawReward","clampScore","adjustedReward","evaluatorScores","evaluatorId","qualityScore","averageDefined","Number","isNaN","policyId","patchSummary","summary","metrics","rewardModelScore","rawOutput","detail","entry","candidateId","target","top","repoType","getRepoTypeFromOutcomeMetadata","error","message","Error","String","execution","duration","command","notes","includes","updateRepoTypeTelemetryMap","stats","primaryTournamentScore","refinerScoreRaw","scoresClose","abs","bothSucceeded","isFinite","values","nums","filter","v","NaN","reduce","sum","val","join","scopeText","Array","isArray","ensureTelemetryLoaded","current","get","winsPrimary","winsRefiner","updated","set","persistTelemetry","TELEMETRY_DIR","homedir","TELEMETRY_FILE","telemetryLoaded","existsSync","JSON","parse","readFileSync","mkdirSync","recursive","payload","writeFileSync","stringify"],"sources":["repoUpgradeOrchestrator.ts"],"sourcesContent":["import { existsSync, readFileSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { join } from 'node:path';\nimport { homedir } from 'node:os';\nimport { UnifiedOrchestrator, type ExecutionResult, type Finding, type OperationReport } from './unifiedOrchestrator.js';\nimport {\n  runDualTournament,\n  type RankedCandidate,\n  type TournamentCandidate,\n  type TournamentOutcome,\n  type TournamentTask,\n} from './dualTournament.js';\nimport { executeVariants } from './variantExecution.js';\nimport { resolveWinner as resolveWinnerStrategy } from './winnerStrategy.js';\nimport { buildEvaluatorConfig } from './tournamentStrategy.js';\nimport { ParallelCoordinator } from './parallelCoordinator.js';\nexport { buildRepoWidePlan, detectWorkspaceModules, expandWorkspacePattern, parseWorkspaceField } from './upgradePlan.js';\n\nexport type RepoUpgradeMode = 'single-continuous' | 'dual-rl-continuous' | 'dual-rl-tournament';\nexport type UpgradeVariant = 'primary' | 'refiner';\n\n/**\n * Reward signal components for multi-objective RL scoring.\n * Each signal is normalized to [0, 1] range.\n */\nexport interface RewardSignals {\n  /** Did the execution complete without errors? (0 or 1) */\n  executionSuccess: number;\n  /** Did tests pass? (0-1, partial credit for some passing) */\n  testsPassed: number;\n  /** Did lint/type checks pass? (0-1) */\n  staticAnalysis: number;\n  /** Code quality metrics (complexity reduction, no new warnings) */\n  codeQuality: number;\n  /** How minimal/surgical were the changes? (inverse of blast radius) */\n  blastRadius: number;\n  /** Confidence from LLM self-assessment keywords */\n  selfAssessment: number;\n  /** Bonus for faster execution (relative to baseline) */\n  speedBonus: number;\n}\n\n/**\n * Weights for combining reward signals into final score.\n * Tuned for safe, high-quality upgrades.\n */\nexport interface RewardWeights {\n  executionSuccess: number;\n  testsPassed: number;\n  staticAnalysis: number;\n  codeQuality: number;\n  blastRadius: number;\n  selfAssessment: number;\n  speedBonus: number;\n}\n\nexport const DEFAULT_REWARD_WEIGHTS: RewardWeights = {\n  executionSuccess: 0.25,\n  testsPassed: 0.30,\n  staticAnalysis: 0.15,\n  codeQuality: 0.10,\n  blastRadius: 0.10,\n  selfAssessment: 0.05,\n  speedBonus: 0.05,\n};\n\n/**\n * Calculate composite reward score from individual signals.\n */\nexport function calculateRewardScore(\n  signals: Partial<RewardSignals>,\n  weights: RewardWeights = DEFAULT_REWARD_WEIGHTS\n): number {\n  let score = 0;\n  let totalWeight = 0;\n\n  for (const [key, weight] of Object.entries(weights)) {\n    const signal = signals[key as keyof RewardSignals];\n    if (typeof signal === 'number') {\n      score += signal * weight;\n      totalWeight += weight;\n    }\n  }\n\n  return totalWeight > 0 ? score / totalWeight : 0;\n}\n\n/**\n * Extract reward signals from execution output text.\n */\nexport function extractRewardSignals(\n  output: string,\n  durationMs: number,\n  baselineDurationMs = 60000\n): Partial<RewardSignals> {\n  const lower = output.toLowerCase();\n  const signals: Partial<RewardSignals> = {};\n  const clamp = (value: number) => Math.max(0, Math.min(1, value));\n\n  // Execution success - no error keywords\n  const hasErrors = /\\b(error|exception|failed|failure|fatal)\\b/i.test(output);\n  signals.executionSuccess = hasErrors ? 0 : 1;\n\n  // Tests passed - look for test result patterns\n  const testMatch = output.match(/(\\d+)\\s*(?:tests?\\s*)?pass(?:ed|ing)?/i);\n  const failMatch = output.match(/(\\d+)\\s*(?:tests?\\s*)?fail(?:ed|ing)?/i);\n  if (testMatch || failMatch) {\n    const passed = parseInt(testMatch?.[1] ?? '0', 10);\n    const failed = parseInt(failMatch?.[1] ?? '0', 10);\n    const total = passed + failed;\n    signals.testsPassed = total > 0 ? passed / total : (/pass|success|✓/i.test(lower) ? 1 : 0.5);\n  } else if (/all tests pass|tests passing|✓.*test/i.test(lower)) {\n    signals.testsPassed = 1;\n  }\n\n  // Static analysis - lint/type check patterns\n  if (/lint.*pass|no.*lint.*error|eslint.*clean|tsc.*success/i.test(lower)) {\n    signals.staticAnalysis = 1;\n  } else if (/lint.*warn|eslint.*warn/i.test(lower)) {\n    signals.staticAnalysis = 0.7;\n  } else if (/lint.*error|type.*error|eslint.*error/i.test(lower)) {\n    signals.staticAnalysis = 0.3;\n  }\n\n  // Code quality heuristics (TODO/HACK penalties vs cleanup/refactor bonuses)\n  if (/todo|hack|workaround|temporary fix/i.test(lower)) {\n    signals.codeQuality = 0.45;\n  } else if (/refactor|cleanup|simplif|reducing complexity|streamlined/i.test(lower)) {\n    signals.codeQuality = Math.max(signals.codeQuality ?? 0, 0.65);\n  }\n\n  // Blast radius approximation from diff summaries / dependency adds\n  const diffMatch = output.match(/(\\d+)\\s+files?\\s+changed/i);\n  if (diffMatch) {\n    const filesChanged = parseInt(diffMatch[1] ?? '0', 10);\n    signals.blastRadius = clamp(1 - Math.min(1, filesChanged / 8));\n  }\n  if (/npm install|yarn add|pnpm add|pip install|go get|cargo add/i.test(lower)) {\n    signals.blastRadius = clamp((signals.blastRadius ?? 0.6) - 0.15);\n  }\n\n  // Self-assessment from confidence keywords\n  if (/confident|verified|validated|confirmed/i.test(lower)) {\n    signals.selfAssessment = 0.9;\n  } else if (/likely|probably|should work/i.test(lower)) {\n    signals.selfAssessment = 0.6;\n  } else if (/uncertain|unclear|might|may/i.test(lower)) {\n    signals.selfAssessment = 0.3;\n  }\n\n  // Speed bonus - faster than baseline gets bonus\n  if (durationMs > 0 && baselineDurationMs > 0) {\n    const speedRatio = baselineDurationMs / durationMs;\n    signals.speedBonus = Math.min(1, Math.max(0, (speedRatio - 0.5) / 1.5));\n  }\n\n  return signals;\n}\n\nexport interface RepoUpgradeModeDefinition {\n  id: RepoUpgradeMode;\n  label: string;\n  description: string;\n  /** Ordered list of variants to execute for this mode */\n  variants: UpgradeVariant[];\n  /** Guidance to inject into prompts per variant */\n  variantGuidance?: Partial<Record<UpgradeVariant, string>>;\n  /** Bias to apply to the refiner when scores are tied (encourages RL exploration) */\n  refinerBias?: number;\n  /** Enable parallel variant execution (requires isolated workspaces) */\n  parallelVariants?: boolean;\n}\n\nexport const REPO_UPGRADE_MODE_DEFINITIONS: Record<RepoUpgradeMode, RepoUpgradeModeDefinition> = {\n  'single-continuous': {\n    id: 'single-continuous',\n    label: 'Single continuous',\n    description: 'Single-pass deterministic execution focused on minimal blast radius.',\n    variants: ['primary'],\n    variantGuidance: {\n      primary: 'Plan and execute the best possible upgrade in one pass. Keep edits surgical and runnable.',\n    },\n    parallelVariants: false,\n  },\n  'dual-rl-continuous': {\n    id: 'dual-rl-continuous',\n    label: 'Dual-agent RL continuous',\n    description: 'Primary + refiner loop where the refiner competes to improve safety and quality. Refiner sees primary output.',\n    variants: ['primary', 'refiner'],\n    variantGuidance: {\n      primary: 'Primary pass sets the baseline plan and changes with conservative scope and runnable checks.',\n      refiner:\n        'RL refiner critiques the primary, fixes gaps, tightens safety, and only repeats steps if they materially improve the result.',\n    },\n    refinerBias: 0.05,\n    parallelVariants: false, // Sequential so refiner can see primary's work\n  },\n  'dual-rl-tournament': {\n    id: 'dual-rl-tournament',\n    label: 'Dual-agent RL tournament',\n    description: 'Primary and refiner compete in parallel with isolated workspaces. Best result wins per step.',\n    variants: ['primary', 'refiner'],\n    variantGuidance: {\n      primary: 'Execute the upgrade with focus on correctness and test coverage. You are competing against another agent.',\n      refiner:\n        'Execute the upgrade with focus on safety and minimal changes. You are competing against another agent.',\n    },\n    refinerBias: 0.03, // Lower bias since both start fresh\n    parallelVariants: true, // Run in parallel with git worktree isolation\n  },\n};\n\nexport type UpgradeStepIntent = 'analyze' | 'upgrade' | 'verify' | 'cleanup';\n\nexport interface RepoUpgradeStep {\n  id: string;\n  intent: UpgradeStepIntent;\n  description: string;\n  /** Optional instruction or prompt to feed into the executor */\n  prompt?: string;\n}\n\nexport interface RepoUpgradeModule {\n  id: string;\n  label: string;\n  description: string;\n  scope: string[];\n  /** Suggested codemod commands to run for this module (display only, not executed automatically). */\n  codemodCommands?: string[];\n  /** Suggested validation commands to run for this module (display only, not executed automatically). */\n  validationCommands?: string[];\n  steps: RepoUpgradeStep[];\n}\n\nexport interface RepoUpgradePlan {\n  modules: RepoUpgradeModule[];\n}\n\nexport interface UpgradeStepExecutionInput {\n  module: RepoUpgradeModule;\n  step: RepoUpgradeStep;\n  /** Which path we are taking: single-pass primary or the dual RL refiner */\n  variant: UpgradeVariant;\n  mode: RepoUpgradeMode;\n  previousResult?: UpgradeStepResult;\n  workspaceRoot?: string;\n  repoPolicy?: string;\n}\n\nexport interface UpgradeStepResult {\n  success: boolean;\n  summary: string;\n  detail?: string;\n  score?: number;\n  /** Tournament-derived human accuracy (1=best, 0=worst across variants) */\n  humanAccuracy?: number;\n  rewardSignals?: Partial<RewardSignals>;\n  /** Tournament breakdown for dual competitions */\n  tournament?: RankedCandidate;\n  durationMs?: number;\n  execution?: ExecutionResult;\n  findings?: Finding[];\n  notes?: string[];\n}\n\nexport interface UpgradeStepOutcome {\n  stepId: string;\n  intent: UpgradeStepIntent;\n  description: string;\n  primary: UpgradeStepResult;\n  refiner?: UpgradeStepResult;\n  winner: UpgradeStepResult;\n  winnerVariant: UpgradeVariant;\n  status: 'completed' | 'failed';\n}\n\nexport interface UpgradeModuleReport {\n  id: string;\n  label: string;\n  scope: string[];\n  codemodCommands?: string[];\n  validationCommands?: string[];\n  steps: UpgradeStepOutcome[];\n  status: 'completed' | 'failed' | 'skipped';\n  validations?: ValidationRunResult[];\n}\n\nexport interface RepoUpgradeReport extends OperationReport {\n  mode: RepoUpgradeMode;\n  continueOnFailure: boolean;\n  modules: UpgradeModuleReport[];\n  validationArtifacts?: ValidationRunResult[];\n  /** True when validation commands were executed instead of just suggested */\n  validationsExecuted?: boolean;\n  variantStats: VariantWinStats;\n  /** Paths used per variant when running dual workspaces (for git/worktree integrations). */\n  variantWorkspaceRoots?: Partial<Record<UpgradeVariant, string>>;\n  /** Optional policy that guided the run (e.g., upgrade or change-management policy). */\n  repoPolicy?: string;\n}\n\nexport interface RepoUpgradeRunOptions {\n  objective?: string;\n  mode: RepoUpgradeMode;\n  continueOnFailure?: boolean;\n  /** Optional per-variant workspace roots when running dual RL with separate repos. */\n  variantWorkspaceRoots?: Partial<Record<UpgradeVariant, string>>;\n  /** Optional policy/guideline string to surface in prompts and reports. */\n  repoPolicy?: string;\n  /** Enable parallel module processing (default: false for safety). */\n  parallelModules?: boolean;\n  /** Maximum concurrent modules when parallel processing is enabled (default: 3). */\n  parallelModuleConcurrency?: number;\n  /** Enable parallel variant execution in dual-RL mode (default: true). */\n  parallelVariants?: boolean;\n}\n\nexport type UpgradeStepExecutor = (input: UpgradeStepExecutionInput) => Promise<UpgradeStepResult>;\n\nexport interface ValidationRunResult {\n  command: string;\n  success: boolean;\n  output: string;\n  error?: string;\n  durationMs: number;\n  skipped?: boolean;\n  reason?: string;\n}\n\nexport interface VariantWinStats {\n  primaryWins: number;\n  refinerWins: number;\n  /** Number of steps where scores were effectively tied and bias picked the winner */\n  ties: number;\n  totalSteps: number;\n}\n\nexport class RepoUpgradeOrchestrator extends UnifiedOrchestrator {\n  private readonly executor: UpgradeStepExecutor;\n  private variantWorkspaceRoots: Partial<Record<UpgradeVariant, string>> | undefined;\n  private repoPolicy: string | undefined;\n  private parallelCoordinator: ParallelCoordinator | null = null;\n  private objective: string | undefined;\n  static repoTypeTelemetry: Map<string, { winsPrimary: number; winsRefiner: number }> = new Map();\n  /** Disable persisted telemetry via env or flag */\n  static disableTelemetryPersistence = process.env.AGI_DISABLE_RL_TELEMETRY === '1';\n\n  constructor(executor: UpgradeStepExecutor) {\n    super();\n    this.executor = executor;\n  }\n\n  /**\n   * Execute the repo-wide plan using either single continuous or dual RL continuous mode.\n   * Supports parallel module processing and parallel variant execution for improved performance.\n   */\n  async run(plan: RepoUpgradePlan, options: RepoUpgradeRunOptions): Promise<RepoUpgradeReport> {\n    const mode = options.mode;\n    const continueOnFailure = options.continueOnFailure ?? true;\n    const objective = options.objective ?? 'Repository-wide source code upgrade';\n    const modeDefinition = getModeDefinition(mode);\n    this.objective = objective;\n    const parallelModules = options.parallelModules ?? false;\n    const parallelModuleConcurrency = options.parallelModuleConcurrency ?? 3;\n    const parallelVariants = options.parallelVariants ?? true;\n    this.variantWorkspaceRoots = options.variantWorkspaceRoots;\n    this.repoPolicy = options.repoPolicy ?? undefined;\n\n    // Reset state per run to keep reports clean\n    this.results = [];\n    this.findings = [];\n    this.parallelCoordinator = null;\n\n    const variantStats: VariantWinStats = { primaryWins: 0, refinerWins: 0, ties: 0, totalSteps: 0 };\n\n    // Emit parallel mode info\n    this.emit({\n      type: 'upgrade.parallel.config',\n      timestamp: Date.now(),\n      data: {\n        parallelModules,\n        parallelModuleConcurrency,\n        parallelVariants,\n        mode,\n      },\n    });\n\n    let moduleReports: UpgradeModuleReport[];\n\n    if (parallelModules && plan.modules.length > 1) {\n      // PARALLEL MODULE PROCESSING\n      moduleReports = await this.runModulesInParallel(\n        plan.modules,\n        mode,\n        modeDefinition,\n        parallelModuleConcurrency,\n        parallelVariants,\n        continueOnFailure,\n        variantStats\n      );\n    } else {\n      // SEQUENTIAL MODULE PROCESSING (original behavior)\n      moduleReports = await this.runModulesSequentially(\n        plan.modules,\n        mode,\n        modeDefinition,\n        parallelVariants,\n        continueOnFailure,\n        variantStats\n      );\n    }\n\n    const baseReport = this.generateReport(objective);\n    return {\n      ...baseReport,\n      mode,\n      continueOnFailure,\n      modules: moduleReports,\n      variantStats,\n      variantWorkspaceRoots: this.variantWorkspaceRoots,\n      repoPolicy: this.repoPolicy,\n    };\n  }\n\n  /**\n   * Run modules sequentially (original behavior)\n   */\n  private async runModulesSequentially(\n    modules: RepoUpgradeModule[],\n    mode: RepoUpgradeMode,\n    modeDefinition: RepoUpgradeModeDefinition,\n    parallelVariants: boolean,\n    continueOnFailure: boolean,\n    variantStats: VariantWinStats\n  ): Promise<UpgradeModuleReport[]> {\n    const moduleReports: UpgradeModuleReport[] = [];\n    let halted = false;\n\n    for (const module of modules) {\n      if (halted) {\n        moduleReports.push({\n          id: module.id,\n          label: module.label,\n          scope: module.scope,\n          steps: [],\n          status: 'skipped',\n        });\n        continue;\n      }\n\n      const moduleReport = await this.processModule(module, mode, modeDefinition, parallelVariants, variantStats, continueOnFailure);\n      moduleReports.push(moduleReport);\n\n      if (moduleReport.status === 'failed' && !continueOnFailure) {\n        halted = true;\n      }\n    }\n\n    return moduleReports;\n  }\n\n  /**\n   * Run modules in parallel using the ParallelExecutor\n   */\n  private async runModulesInParallel(\n    modules: RepoUpgradeModule[],\n    mode: RepoUpgradeMode,\n    modeDefinition: RepoUpgradeModeDefinition,\n    concurrency: number,\n    parallelVariants: boolean,\n    continueOnFailure: boolean,\n    variantStats: VariantWinStats\n  ): Promise<UpgradeModuleReport[]> {\n    if (!this.parallelCoordinator) {\n      this.parallelCoordinator = new ParallelCoordinator();\n    }\n\n    const reports = await this.parallelCoordinator.runModules(\n      {\n        concurrency,\n        mode,\n        modeDefinition,\n        parallelVariants,\n        continueOnFailure,\n        variantStats,\n        processModule: (module) => this.processModule(module, mode, modeDefinition, parallelVariants, variantStats, continueOnFailure),\n        emit: (event) => this.emit(event),\n      },\n      modules\n    );\n\n    if (!continueOnFailure) {\n      const firstFailure = reports.findIndex((report) => report.status === 'failed');\n      if (firstFailure >= 0) {\n        return reports.slice(0, firstFailure + 1);\n      }\n    }\n\n    return reports;\n  }\n\n  /**\n   * Process a single module (can be called in parallel or sequentially)\n   */\n  private async processModule(\n    module: RepoUpgradeModule,\n    mode: RepoUpgradeMode,\n    modeDefinition: RepoUpgradeModeDefinition,\n    parallelVariants: boolean,\n    variantStats: VariantWinStats,\n    continueOnFailure = true\n  ): Promise<UpgradeModuleReport> {\n    const moduleStart = Date.now();\n    this.emit({\n      type: 'upgrade.module.start',\n      timestamp: Date.now(),\n      data: { moduleId: module.id, label: module.label, scope: module.scope, mode },\n    });\n\n    const moduleReport: UpgradeModuleReport = {\n      id: module.id,\n      label: module.label,\n      scope: module.scope,\n      codemodCommands: module.codemodCommands,\n      validationCommands: module.validationCommands,\n      steps: [],\n      status: 'completed',\n    };\n\n    for (const step of module.steps) {\n      const outcome = await this.runStep(module, step, mode, parallelVariants);\n      moduleReport.steps.push(outcome);\n      this.updateVariantStats(variantStats, outcome, modeDefinition);\n\n      if (!outcome.winner.success) {\n        moduleReport.status = 'failed';\n        // Stop processing this module's steps if continueOnFailure is false\n        if (!continueOnFailure) {\n          break;\n        }\n      }\n    }\n\n    this.emit({\n      type: 'upgrade.module.complete',\n      timestamp: Date.now(),\n      data: {\n        moduleId: module.id,\n        status: moduleReport.status,\n        durationMs: Date.now() - moduleStart,\n      },\n    });\n\n    return moduleReport;\n  }\n\n  private async runStep(\n    module: RepoUpgradeModule,\n    step: RepoUpgradeStep,\n    mode: RepoUpgradeMode,\n    parallelVariants = true\n  ): Promise<UpgradeStepOutcome> {\n    const stepStart = Date.now();\n    const modeDefinition = getModeDefinition(mode);\n    this.emit({\n      type: 'upgrade.step.start',\n      timestamp: Date.now(),\n      data: { moduleId: module.id, stepId: step.id, variant: 'primary', mode, parallelVariants },\n    });\n\n    const variantResults = await executeVariants({\n      module,\n      step,\n      mode,\n      modeDefinition,\n      context: {\n        parallelVariants,\n        variantWorkspaceRoots: this.variantWorkspaceRoots,\n        repoPolicy: this.repoPolicy,\n      },\n      executeVariant: (input) => this.safeExecuteVariant(input),\n      emit: (event) => this.emit(event),\n    });\n    const primary = variantResults.primary as UpgradeStepResult;\n    const refiner = variantResults.refiner;\n\n    const tournamentOutcome = this.evaluateTournamentOutcome(module, step, modeDefinition, primary, refiner);\n    if (tournamentOutcome) {\n      this.attachTournamentBreakdown(variantResults, tournamentOutcome);\n    }\n    const { winner, winnerVariant } = resolveWinnerStrategy(\n      { modeDefinition, variantResults, tournamentOutcome },\n      (definition, primaryResult, refinerResult) => this.pickWinner(definition, primaryResult, refinerResult)\n    );\n\n    this.recordOutcomeArtifacts(module, step, winner, winnerVariant);\n\n    const primaryScore = primary.tournament?.aggregateScore ?? primary.score;\n    const refinerScore = refiner?.tournament?.aggregateScore ?? refiner?.score;\n    const primaryAccuracy = primary.tournament?.humanAccuracy ?? primary.humanAccuracy;\n    const refinerAccuracy = refiner?.tournament?.humanAccuracy ?? refiner?.humanAccuracy;\n\n    this.emit({\n      type: 'upgrade.step.complete',\n      timestamp: Date.now(),\n      data: {\n        moduleId: module.id,\n        stepId: step.id,\n        variant: winnerVariant,\n        success: winner.success,\n        // Include outcome details for UI scoring\n        primaryScore,\n        primarySuccess: primary.success,\n        refinerScore,\n        refinerSuccess: refiner?.success,\n        winnerVariant,\n        primaryAccuracy,\n        refinerAccuracy,\n        tournamentRankings: tournamentOutcome?.ranked,\n        durationMs: Date.now() - stepStart,\n      },\n    });\n\n    return {\n      stepId: step.id,\n      intent: step.intent,\n      description: step.description,\n      primary,\n      refiner,\n      winner,\n      winnerVariant,\n      status: winner.success ? 'completed' : 'failed',\n    };\n  }\n\n  private evaluateTournamentOutcome(\n    module: RepoUpgradeModule,\n    step: RepoUpgradeStep,\n    modeDefinition: RepoUpgradeModeDefinition,\n    primary: UpgradeStepResult,\n    refiner?: UpgradeStepResult\n  ): TournamentOutcome | null {\n    // Only run tournaments when the mode explicitly supports it to avoid overhead and keep\n    // continuous modes deterministic.\n    if (modeDefinition.id !== 'dual-rl-tournament') {\n      return null;\n    }\n\n    // Fast exits: if only one variant succeeded, avoid tournament overhead\n    if (primary.success && (!refiner || !refiner.success)) {\n      primary.humanAccuracy = 1;\n      if (refiner) refiner.humanAccuracy = 0;\n      this.updateRepoTypeTelemetry(getRepoTypeFromModule(module), 'primary');\n      return null;\n    }\n    if (refiner?.success && !primary.success) {\n      refiner.humanAccuracy = 1;\n      primary.humanAccuracy = 0;\n      this.updateRepoTypeTelemetry(getRepoTypeFromModule(module), 'refiner');\n      return null;\n    }\n\n    // If neither variant succeeded, skip tournament aggregation for efficiency\n    if (!primary.success && (!refiner || !refiner.success)) {\n      return null;\n    }\n\n    const candidates: TournamentCandidate[] = [\n      this.buildTournamentCandidate('primary', primary, modeDefinition),\n    ];\n\n    if (refiner) {\n      candidates.push(this.buildTournamentCandidate('refiner', refiner, modeDefinition));\n    }\n\n    const task: TournamentTask = {\n      id: `${module.id}:${step.id}`,\n      goal: step.description,\n      constraints: module.scope,\n      metadata: {\n        module: module.label,\n        objective: this.objective,\n        repoPolicy: this.repoPolicy,\n        intent: step.intent,\n      },\n    };\n\n    const evaluatorConfig = buildEvaluatorConfig(module, RepoUpgradeOrchestrator.repoTypeTelemetry);\n\n    try {\n      return runDualTournament(task, candidates, {\n        rewardWeights: evaluatorConfig.rewardWeights,\n        evaluators: evaluatorConfig.evaluators,\n        maxCandidates: 8,\n      });\n    } catch {\n      return null;\n    }\n  }\n\n  private buildTournamentCandidate(\n    variant: UpgradeVariant,\n    result: UpgradeStepResult,\n    modeDefinition: RepoUpgradeModeDefinition\n  ): TournamentCandidate {\n    const signals = result.rewardSignals ?? {};\n    const rawReward = typeof result.score === 'number' ? clampScore(result.score) : 0;\n    const adjustedReward =\n      variant === 'refiner' ? clampScore(rawReward + (modeDefinition.refinerBias ?? 0)) : rawReward;\n\n    const evaluatorScores: TournamentCandidate['evaluatorScores'] = [\n      { evaluatorId: 'reward-signal', score: adjustedReward, weight: 1 },\n      { evaluatorId: 'hard-metrics', score: signals.executionSuccess ?? (result.success ? 1 : 0), weight: 1.1 },\n    ];\n\n    if (typeof signals.testsPassed === 'number') {\n      evaluatorScores.push({ evaluatorId: 'tests', score: signals.testsPassed, weight: 0.8 });\n    }\n    if (typeof signals.staticAnalysis === 'number') {\n      evaluatorScores.push({ evaluatorId: 'static-analysis', score: signals.staticAnalysis, weight: 0.6 });\n    }\n    if (typeof signals.codeQuality === 'number' || typeof signals.blastRadius === 'number') {\n      const qualityScore = averageDefined([\n        signals.codeQuality,\n        signals.blastRadius,\n        signals.staticAnalysis,\n      ]);\n      if (!Number.isNaN(qualityScore)) {\n        evaluatorScores.push({ evaluatorId: 'quality', score: qualityScore, weight: 0.9 });\n      }\n    }\n\n    return {\n      id: variant,\n      policyId: variant,\n      patchSummary: result.summary,\n      metrics: {\n        executionSuccess: signals.executionSuccess ?? (result.success ? 1 : 0),\n        testsPassed: signals.testsPassed,\n        staticAnalysis: signals.staticAnalysis,\n        codeQuality: signals.codeQuality,\n        blastRadius: signals.blastRadius,\n        speedBonus: signals.speedBonus,\n      },\n      signals: {\n        rewardModelScore: adjustedReward,\n        selfAssessment: signals.selfAssessment,\n      },\n      evaluatorScores: evaluatorScores ?? [],\n      rawOutput: result.detail,\n    };\n  }\n\n  private attachTournamentBreakdown(\n    variantResults: Partial<Record<UpgradeVariant, UpgradeStepResult>>,\n    outcome: TournamentOutcome\n  ): void {\n    for (const entry of outcome.ranked) {\n      const variant = entry.candidateId as UpgradeVariant;\n      const target = variantResults[variant];\n      if (target) {\n        target.tournament = entry;\n        target.humanAccuracy = entry.humanAccuracy;\n      }\n    }\n    // Update telemetry based on winner to auto-tune per repo type\n    const top = outcome.ranked[0];\n    if (top) {\n      const repoType = getRepoTypeFromOutcomeMetadata(outcome.task);\n      this.updateRepoTypeTelemetry(repoType, top.candidateId as UpgradeVariant);\n    }\n  }\n\n  private async safeExecuteVariant(input: UpgradeStepExecutionInput): Promise<UpgradeStepResult> {\n    try {\n      return await this.executor(input);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return {\n        success: false,\n        summary: 'Execution failed',\n        detail: message,\n        score: 0,\n        durationMs: 0,\n        execution: {\n          success: false,\n          output: 'Execution failed',\n          duration: 0,\n          command: `${input.module.id}/${input.step.id}/${input.variant}`,\n          error: message,\n        },\n        notes: ['Executor threw an error'],\n      };\n    }\n  }\n\n  private pickWinner(\n    definition: RepoUpgradeModeDefinition,\n    primary: UpgradeStepResult,\n    refiner?: UpgradeStepResult\n  ): { winner: UpgradeStepResult; winnerVariant: UpgradeVariant } {\n    if (!refiner || !definition.variants.includes('refiner')) {\n      return { winner: primary, winnerVariant: 'primary' };\n    }\n\n    if (refiner.success && !primary.success) {\n      return { winner: refiner, winnerVariant: 'refiner' };\n    }\n    if (primary.success && !refiner.success) {\n      return { winner: primary, winnerVariant: 'primary' };\n    }\n\n    const primaryScore = typeof primary.score === 'number' ? primary.score : 0;\n    const refinerScore = (typeof refiner.score === 'number' ? refiner.score : 0) + (definition.refinerBias ?? 0);\n    const primaryAccuracy = typeof primary.humanAccuracy === 'number' ? primary.humanAccuracy : 0;\n    const refinerAccuracy = typeof refiner.humanAccuracy === 'number' ? refiner.humanAccuracy : 0;\n\n    if (refinerScore > primaryScore) {\n      return { winner: refiner, winnerVariant: 'refiner' };\n    }\n    if (primaryScore > refinerScore) {\n      return { winner: primary, winnerVariant: 'primary' };\n    }\n\n    // Accuracy-aware tie break\n    if (refinerAccuracy > primaryAccuracy + 1e-6) {\n      return { winner: refiner, winnerVariant: 'refiner' };\n    }\n    if (primaryAccuracy > refinerAccuracy + 1e-6) {\n      return { winner: primary, winnerVariant: 'primary' };\n    }\n\n    // Tie breaker: prefer refiner to encourage RL exploration\n    return { winner: refiner, winnerVariant: 'refiner' };\n  }\n\n  private recordOutcomeArtifacts(\n    module: RepoUpgradeModule,\n    step: RepoUpgradeStep,\n    result: UpgradeStepResult,\n    variant: 'primary' | 'refiner'\n  ): void {\n    if (result.findings?.length) {\n      this.findings.push(...result.findings);\n    }\n\n    const execution: ExecutionResult = result.execution ?? {\n      success: result.success,\n      output: result.summary,\n      duration: result.durationMs ?? 0,\n      command: `${module.id}/${step.id}/${variant}`,\n      error: result.success ? undefined : result.detail ?? result.summary,\n    };\n\n    // Ensure we only track a single winner record per step to keep reports clean\n    this.results.push(execution);\n\n    // Update telemetry after each recorded outcome\n    const repoType = getRepoTypeFromModule(module);\n    this.updateRepoTypeTelemetry(repoType, variant);\n  }\n\n  private updateRepoTypeTelemetry(repoType: string, winner: UpgradeVariant): void {\n    updateRepoTypeTelemetryMap(repoType, winner);\n  }\n\n  private updateVariantStats(\n    stats: VariantWinStats,\n    outcome: UpgradeStepOutcome,\n    modeDefinition: RepoUpgradeModeDefinition\n  ): void {\n    stats.totalSteps += 1;\n    if (outcome.winnerVariant === 'refiner') {\n      stats.refinerWins += 1;\n    } else {\n      stats.primaryWins += 1;\n    }\n\n    if (!outcome.refiner) {\n      return;\n    }\n\n    const primaryScore = typeof outcome.primary.score === 'number' ? outcome.primary.score : 0;\n    const primaryTournamentScore =\n      typeof outcome.primary.tournament?.aggregateScore === 'number'\n        ? outcome.primary.tournament.aggregateScore\n        : primaryScore;\n    const refinerScoreRaw = typeof outcome.refiner.tournament?.aggregateScore === 'number'\n      ? outcome.refiner.tournament.aggregateScore\n      : typeof outcome.refiner.score === 'number'\n        ? outcome.refiner.score\n        : 0;\n    const refinerScore = refinerScoreRaw + (modeDefinition.refinerBias ?? 0);\n    const scoresClose = Math.abs(primaryTournamentScore - refinerScore) < 1e-6;\n    const bothSucceeded = outcome.primary.success && outcome.refiner.success;\n    if (bothSucceeded && scoresClose) {\n      stats.ties += 1;\n    }\n  }\n}\n\nexport function clampScore(value: number, min = 0, max = 1): number {\n  if (!Number.isFinite(value)) return min;\n  return Math.max(min, Math.min(max, value));\n}\n\nfunction averageDefined(values: Array<number | undefined>): number {\n  const nums = values.filter((v): v is number => typeof v === 'number');\n  if (!nums.length) return NaN;\n  const total = nums.reduce((sum, val) => sum + val, 0);\n  return total / nums.length;\n}\n\nfunction getRepoTypeFromModule(module: RepoUpgradeModule): string {\n  const scope = (module.scope || []).join(' ').toLowerCase();\n  const label = (module.label || '').toLowerCase();\n  if (/\\btest|__tests__|spec\\b/i.test(scope) || /\\btest\\b/i.test(label)) return 'tests';\n  if (/\\bdocs?\\b/i.test(scope) || /\\bdoc\\b/i.test(label)) return 'docs';\n  if (/\\brefactor|cleanup|source\\b/i.test(scope + ' ' + label)) return 'refactor';\n  return 'general';\n}\n\nfunction getRepoTypeFromOutcomeMetadata(task: TournamentTask): string {\n  const scopeText = Array.isArray(task.constraints) ? task.constraints.join(' ').toLowerCase() : '';\n  const intent = typeof task.metadata?.intent === 'string' ? task.metadata.intent.toLowerCase() : '';\n  if (/\\btest|__tests__|spec\\b/i.test(scopeText) || /\\btest\\b/i.test(intent)) return 'tests';\n  if (/\\bdoc\\b/i.test(scopeText) || /\\bdoc\\b/i.test(intent)) return 'docs';\n  if (/\\brefactor|cleanup\\b/i.test(scopeText + ' ' + intent)) return 'refactor';\n  return 'general';\n}\n\nfunction updateRepoTypeTelemetryMap(repoType: string, winner: UpgradeVariant): void {\n  if (RepoUpgradeOrchestrator.disableTelemetryPersistence) {\n    return;\n  }\n  ensureTelemetryLoaded();\n  const current = RepoUpgradeOrchestrator.repoTypeTelemetry.get(repoType) ?? { winsPrimary: 0, winsRefiner: 0 };\n  const updated =\n    winner === 'primary'\n      ? { ...current, winsPrimary: current.winsPrimary + 1 }\n      : { ...current, winsRefiner: current.winsRefiner + 1 };\n  RepoUpgradeOrchestrator.repoTypeTelemetry.set(repoType, updated);\n  persistTelemetry();\n}\n\n// Simple persistence of repo-type telemetry to inform future runs\nconst TELEMETRY_DIR = join(homedir(), '.agi');\nconst TELEMETRY_FILE = join(TELEMETRY_DIR, 'rl-telemetry.json');\nlet telemetryLoaded = false;\n\nfunction ensureTelemetryLoaded(): void {\n  if (RepoUpgradeOrchestrator.disableTelemetryPersistence) return;\n  if (telemetryLoaded) return;\n  telemetryLoaded = true;\n  try {\n    if (!existsSync(TELEMETRY_FILE)) return;\n    const data = JSON.parse(readFileSync(TELEMETRY_FILE, 'utf-8'));\n    if (data && typeof data === 'object') {\n      for (const [key, value] of Object.entries(data)) {\n        if (value && typeof value === 'object' && 'winsPrimary' in value && 'winsRefiner' in value) {\n          RepoUpgradeOrchestrator.repoTypeTelemetry.set(key, {\n            winsPrimary: Number((value as any).winsPrimary) || 0,\n            winsRefiner: Number((value as any).winsRefiner) || 0,\n          });\n        }\n      }\n    }\n  } catch {\n    // ignore load errors\n  }\n}\n\nfunction persistTelemetry(): void {\n  if (RepoUpgradeOrchestrator.disableTelemetryPersistence) return;\n  try {\n    mkdirSync(TELEMETRY_DIR, { recursive: true });\n    const payload: Record<string, { winsPrimary: number; winsRefiner: number }> = {};\n    for (const [key, value] of RepoUpgradeOrchestrator.repoTypeTelemetry.entries()) {\n      payload[key] = value;\n    }\n    writeFileSync(TELEMETRY_FILE, JSON.stringify(payload, null, 2), 'utf-8');\n  } catch {\n    // ignore persistence errors\n  }\n}\n\n\n\nfunction getModeDefinition(mode: RepoUpgradeMode): RepoUpgradeModeDefinition {\n  return REPO_UPGRADE_MODE_DEFINITIONS[mode] ?? REPO_UPGRADE_MODE_DEFINITIONS['single-continuous'];\n}\n"],"mappings":"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","ignoreList":[]}