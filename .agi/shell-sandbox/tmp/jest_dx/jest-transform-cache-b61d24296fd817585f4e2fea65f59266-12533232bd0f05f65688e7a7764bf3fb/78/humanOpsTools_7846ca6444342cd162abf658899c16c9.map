{"version":3,"names":["_nodeFs","require","_nodePath","_nodeOs","getTaskDir","root","process","env","join","homedir","mkdirSync","recursive","safeTitle","title","trim","replace","toLowerCase","writeTask","record","path","writeFileSync","JSON","stringify","createNewTask","args","dir","context","urgency","needsBrowser","needsCaptcha","emailDomain","catchAll","domainRegistrar","paymentMethod","phoneVerification","ssoProviders","proxyPolicy","steps","length","map","s","String","artifacts","updates","note","at","Date","toISOString","now","lines","message","appendUpdate","taskPath","content","readFileSync","parse","push","createHumanOpsTools","name","description","handler","existsSync","updateNote","update"],"sources":["humanOpsTools.ts"],"sourcesContent":["import { existsSync, mkdirSync, readFileSync, writeFileSync } from 'node:fs';\nimport { join } from 'node:path';\nimport { homedir } from 'node:os';\nimport type { ToolDefinition } from '../core/toolRuntime.js';\n\ninterface HumanTaskInput {\n  title?: string;\n  context?: string;\n  urgency?: string;\n  needsBrowser?: boolean;\n  needsCaptcha?: boolean;\n  emailDomain?: string;\n  catchAll?: boolean;\n  domainRegistrar?: string;\n  paymentMethod?: string;\n  phoneVerification?: boolean;\n  ssoProviders?: string[];\n  proxyPolicy?: string;\n  steps?: string[];\n  artifacts?: string[];\n  taskPath?: string;\n  update?: string;\n}\n\ninterface HumanTaskRecord extends Required<Pick<HumanTaskInput, 'title'>> {\n  context?: string;\n  urgency?: string;\n  needsBrowser?: boolean;\n  needsCaptcha?: boolean;\n  emailDomain?: string;\n  catchAll?: boolean;\n  domainRegistrar?: string;\n  paymentMethod?: string;\n  phoneVerification?: boolean;\n  ssoProviders?: string[];\n  proxyPolicy?: string;\n  steps: string[];\n  artifacts?: string[];\n  updates: Array<{ note: string; at: string }>;\n}\n\nfunction getTaskDir(): string {\n  const root = process.env['AGI_HUMAN_TASK_DIR'] || join(homedir(), '.agi', 'human-tasks');\n  mkdirSync(root, { recursive: true });\n  return root;\n}\n\nfunction safeTitle(title: string): string {\n  return title.trim().replace(/[^\\w\\d-]+/g, '-').replace(/^-+|-+$/g, '').toLowerCase() || 'task';\n}\n\nfunction writeTask(record: HumanTaskRecord, path: string): void {\n  mkdirSync(getTaskDir(), { recursive: true });\n  writeFileSync(path, JSON.stringify(record, null, 2), 'utf8');\n}\n\nfunction createNewTask(args: HumanTaskInput): { path: string; record: HumanTaskRecord; message: string } {\n  const dir = getTaskDir();\n  const title = args.title?.trim() || 'Untitled task';\n  const record: HumanTaskRecord = {\n    title,\n    context: args.context,\n    urgency: args.urgency ?? 'normal',\n    needsBrowser: args.needsBrowser ?? false,\n    needsCaptcha: args.needsCaptcha ?? false,\n    emailDomain: args.emailDomain,\n    catchAll: args.catchAll,\n    domainRegistrar: args.domainRegistrar,\n    paymentMethod: args.paymentMethod,\n    phoneVerification: args.phoneVerification,\n    ssoProviders: args.ssoProviders ?? [],\n    proxyPolicy: args.proxyPolicy,\n    steps: (args.steps && args.steps.length ? args.steps : ['Provide update and next actions']).map((s) => String(s)),\n    artifacts: args.artifacts,\n    updates: [\n      {\n        note: args.context ? `Initial context: ${args.context}` : 'Task created',\n        at: new Date().toISOString(),\n      },\n    ],\n  };\n\n  const path = join(dir, `${safeTitle(title)}-${Date.now()}.json`);\n  writeTask(record, path);\n\n  const lines = [\n    'Human task recorded',\n    `Title: ${title}`,\n    `Urgency: ${record.urgency}`,\n    record.needsBrowser ? 'Requires browser use' : 'No browser required',\n    record.needsCaptcha ? 'Requires captcha' : 'No captcha required',\n    record.emailDomain ? `Email domain: ${record.emailDomain}` : 'Email domain: n/a',\n    `Steps: ${record.steps.length}`,\n    `Saved at: ${path}`,\n  ];\n\n  return { path, record, message: lines.join('\\n') };\n}\n\nfunction appendUpdate(taskPath: string, note: string): { path: string; record: HumanTaskRecord; message: string } {\n  const content = readFileSync(taskPath, 'utf8');\n  const record = JSON.parse(content) as HumanTaskRecord;\n  record.updates = record.updates ?? [];\n  record.updates.push({ note, at: new Date().toISOString() });\n  writeTask(record, taskPath);\n\n  const lines = [\n    'Update appended to human task',\n    `Title: ${record.title}`,\n    `Updates: ${record.updates.length}`,\n    `Saved at: ${taskPath}`,\n  ];\n  return { path: taskPath, record, message: lines.join('\\n') };\n}\n\nexport function createHumanOpsTools(): ToolDefinition[] {\n  return [\n    {\n      name: 'HumanIntegration',\n      description: 'Create or update human-in-the-loop tasks with rich metadata (browser, captcha, domain/email needs).',\n      handler: async (args: HumanTaskInput) => {\n        if (args.taskPath && existsSync(args.taskPath)) {\n          const updateNote = args.update?.trim() || 'Update added';\n          const { message } = appendUpdate(args.taskPath, updateNote);\n          return message;\n        }\n        const { message } = createNewTask(args);\n        return message;\n      },\n    },\n  ];\n}\n"],"mappings":"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","ignoreList":[]}