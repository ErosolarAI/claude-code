{"version":3,"names":["readline","_interopRequireWildcard","require","_nodeEvents","_nodeOs","_chalk","_interopRequireDefault","_theme","_outputMode","_animatedStatus","_debugLogger","_uiConstants","e","__esModule","default","t","WeakMap","r","n","o","i","f","__proto__","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","ESC","HIDE_CURSOR","SHOW_CURSOR","CLEAR_SCREEN","CLEAR_LINE","HOME","ENABLE_BRACKETED_PASTE","DISABLE_BRACKETED_PASTE","TO","row","col","TO_COL","ERASE_DOWN","REVERSE","RESET","SET_SCROLL_REGION","top","bottom","RESET_SCROLL_REGION","SAVE_CURSOR","RESTORE_CURSOR","NEWLINE_PLACEHOLDER","UnifiedUIRenderer","EventEmitter","rows","cols","lastRenderWidth","eventQueue","isProcessingQueue","buffer","cursor","history","historyIndex","suggestions","suggestionIndex","availableCommands","hotkeysInToggleLine","Set","collapsedPaste","mode","lastToolResult","collapsedToolResults","maxCollapsedResults","lastToolName","streamingStartTime","statusMessage","UI_STRINGS","LOADING","statusOverride","statusStreaming","pinnedStatus","streamingSpinner","thinkingIndicator","spinnerFrame","spinnerInterval","maxInlinePanelLines","compactingStatusMessage","compactingStatusFrame","compactingStatusInterval","compactingSpinnerFrames","activityMessage","activityPhraseIndex","activityStarFrame","activityStarFrames","streamingTokens","elapsedColorFrame","elapsedColorFrames","funActivityPhrases","maxCuratedReasoningLines","maxCuratedReasoningChars","thoughtDedupWindowMs","lastCuratedThought","statusMeta","toggleState","verificationEnabled","autoContinueEnabled","criticalApprovalMode","dualRlEnabled","debugEnabled","rlStatus","clampCursor","Math","max","min","length","appendToPasteBuffer","text","pasteBufferOverflow","current","pasteBuffer","plainPasteBuffer","remaining","maxPasteBufferSize","toAdd","slice","sanitizePasteContent","sanitized","replace","formatHotkey","combo","trim","toUpperCase","lastPromptEvent","promptHeight","lastOverlayHeight","inlinePanel","hasConversationContent","isPromptActive","inputRenderOffset","plainPasteIdleMs","plainPasteWindowMs","plainPasteTriggerChars","plainPasteEarlyNewlineChars","cursorVisibleColumn","inBracketedPaste","inPlainPaste","plainPasteTimer","pasteBurstWindowStart","pasteBurstCharCount","plainRecentChunks","pendingInsertBuffer","pendingInsertTimer","pendingInsertDelayMs","lastRenderedEventKey","lastOutputEndedWithNewline","hasRenderedPrompt","hasEverRenderedOverlay","lastOverlay","lastOverlayRendered","allowPromptRender","promptRenderingSuspended","secretMode","pendingRender","lastRenderTime","renderThrottleMs","renderThrottleTimer","disposed","boundResizeHandler","boundKeypressHandler","inputCapture","constructor","output","process","stdout","input","stdin","_options","interactive","Boolean","isTTY","env","plainMode","isPlainOutputMode","contextMeter","ContextMeter","rl","createInterface","terminal","prompt","tabSize","setPrompt","updateTerminalSize","renderPrompt","on","setupInputHandlers","initialize","cancelPlainPasteCapture","clearPromptArea","write","cleanup","cancelInputCapture","Error","clearTimeout","clearInterval","stop","dispose","disposeAnimations","removeListener","removeAllListeners","close","setRawMode","suspendPromptRendering","resumePromptRendering","render","emitKeypressEvents","str","key","handleKeypress","emitInputChange","payload","emit","normalizedKey","parseEscapeSequence","keyForPaste","sequence","handleBracketedPaste","handlePlainPaste","macOptionChars","letter","ctrl","name","clearBuffer","isCtrlShift","lowerLetter","toLowerCase","upperLetter","shift","meta","seq","test","handleCtrlShiftToggle","hadBuffer","expandCollapsedPasteToBuffer","clearCollapsedResults","ensureCursorVisible","pos","updateSuggestions","expandCollapsedPaste","applySuggestion","startsWith","safeIndex","command","submitText","navigateSuggestions","queuePendingInsert","maxWidth","safeWidth","map","setTimeout","commitPendingInsert","insertText","consumePendingInsertForPaste","consumed","pasteStartMarker","pasteEndMarker","includes","pending","startIdx","indexOf","content","endIdx","commitPasteBuffer","contentBefore","captureCollapsedPaste","lineCount","wasTruncated","charDisplay","prePasteBuffer","prePasteCursor","lines","truncated","existingTextNote","hint","updateStatusBundle","main","split","resetPlainPasteBurst","pruneRecentPlainChunks","chunk","now","Date","trackPlainPasteBurst","schedulePlainPasteCommit","recordRecentPlainChunk","chunkMultiple","hasNewline","burstActive","burstTrigger","hasRecentNonNewline","some","entry","earlyNewlineTrigger","newlineTrigger","looksLikePaste","chunkAlreadyCaptured","reclaimed","reclaimRecentPlainChunks","combined","removeCount","suffix","endsWith","at","windowStart","push","filter","join","finalizePlainPaste","shouldTrim","options","normalizedCapture","allowEmpty","resolver","resetSuggestions","resolve","normalized","displayUserPrompt","firstSpace","hasArgText","cursorSlice","commandSlice","fallbackSlice","partial","trimEnd","previous","cmd","idx","findIndex","s","setAvailableCommands","commands","submit","selected","direction","currentIndex","next","clamped","addEvent","type","logDebug","normalizeEventType","clearPinnedStatus","formatted","formatContent","rawType","timestamp","event","insertIndex","splice","queueMicrotask","processQueue","renderPromptOverlay","immediate","renderPromptImmediate","coalesced","coalesceAdjacentTextEvents","renderEvent","error","message","delay","isMergeable","target","isCompacted","needsSeparator","flushEvents","timeoutMs","start","formattedPlain","signature","line","theme","primary","thinkingLabel","thinkingModeLabel","thinkingIsDeep","isGarbageOutput","curated","curateReasoningContent","shouldRenderThought","formatThinkingBlock","formatCompactToolCall","formatCompactToolResult","wrapBulletText","label","labelColor","warning","info","isError","undefined","trimmed","punctOnlyLines","lineTrimmed","nonEmptyLines","l","meaningfulLines","alphaNum","match","alphaCount","totalCount","sanitizeToolResultContent","cleanLines","alphaInLine","pop","limited","maxSegments","segments","flatMap","seen","deduped","segment","normalizedSegment","add","prioritized","prioritizeReasoningSegments","limitedSelection","bulleted","ensureReasoningBullet","looksStructuredThought","scored","index","score","reasoningSignalScore","hasSignal","item","sort","a","b","lower","actionKeywords","keyword","formatClaudeCodeBlock","bullet","result","lineIdx","words","currentLine","word","prefix","trimStart","formatToolCall","nameMatch","tool","toolName","argsStr","prefixLen","indent","repeat","args","parseToolArgs","arg","argText","ui","muted","formatArgValue","value","separator","testLine","stripAnsi","regex","exec","isQuoted","inner","lowerKey","shouldPreserve","maxLen","formatToolResult","summaryMatch","preview","toolColor","getToolColor","coloredToolName","params","parseToolParams","formatToolParamsColored","formatToolParams","firstParam","param","coloredValue","colorParamValue","paramText","paramStr","plainLength","visibleLength","extractToolSummary","pathMatch","path","file","cmdMatch","lineMatch","fileMatch","readMatch","hasPath","hasCommand","isPathOrDir","summary","preserveFull","firstLine","summaryText","sentenceEnd","search","lastSpace","lastIndexOf","coloredSummary","colorResultSummary","hasMoreContent","expandHint","success","formatCompactResponse","cleaned","availableWidth","labelText","bulletPrefix","firstNonEmpty","rawLine","candidate","prefixLength","secondary","wrapTextToWidth","width","formatStreamingElapsed","elapsed","floor","mins","secs","formatCompactBlock","padding","leftPad","rightPad","ceil","addCompactBlock","formattedContent","expandLastToolResult","collapsed","isStructured","isStructuredToolOutput","rendered","formatStructuredToolOutput","header","formattedLines","getCollapsedResultCount","setMode","wasStreaming","shouldSpin","startSpinnerAnimation","stopSpinnerAnimation","pinLoadingUI","tone","setInterval","spinnerFrames","braille","setActivity","updateStreamingTokens","tokens","formatTokenCount","String","toFixed","round","getMode","updateStatus","override","streaming","status","prevStreaming","changed","mainChanged","overrideChanged","streamingChanged","streamingIntroduce","streamingCleared","onlyStreamingChanged","skipStreamingRender","shouldRender","updateStatusMeta","JSON","stringify","updateModeToggles","state","verificationHotkey","thinkingHotkey","criticalApprovalHotkey","autoContinueHotkey","dualRlHotkey","debugHotkey","clear","updateRLStatus","clearRLStatus","getRLStatus","setInlinePanel","hasContent","limitInlinePanel","supportsInlinePanel","clearInlinePanel","resetOverlayState","writeRaw","showError","details","formatErrorDetails","parts","showSystemMessage","showSuccess","showWarning","showInfo","stack","maxLines","overflow","indicator","tailCount","tail","overlay","buildOverlayLines","renderedLines","truncateLine","promptIndex","height","promptCol","overlayUnchanged","arraysEqual","prevHeight","prevPromptIdx","upFromPrompt","upToPrompt","buildPinnedLoadingOverlay","divider","fallbackActivity","raw","spinnerChars","spinnerChar","starChar","spinnerDecorated","accent","genericActivities","displayActivity","needsEllipsis","elapsedColor","chalk","hex","activityText","activityLine","wrapped","wrapOverlayLine","inputLine","buildInputLine","inputLines","arr","panelLine","suggestion","isActive","marker","cmdText","descText","description","modelContextLine","buildModelContextLine","chromeLines","buildChromeLines","chromeLine","toggleLines","buildInlineToggleLine","toggleLine","legendLines","buildToggleLegend","legend","statusText","headerParts","version","author","profileParts","profile","model","provider","modelLine","contextPercent","used","clampPercentage","barWidth","filled","empty","barColor","getContextColor","bar","autoContinueActive","verificationActive","approvalMode","toggles","rlOn","rlIcon","rlExplain","contIcon","contStatus","contExplain","verifyIcon","verifyStatus","verifyExplain","apprIcon","apprStatus","apprExplain","thinkIcon","thinkStatus","thinkExplain","debugActive","debugIcon","debugStatus","debugExplain","wrapSegments","statusLines","buildStatusBlock","metaLines","buildMetaBlock","abbreviatePath","pathValue","home","homedir","statusLabel","composeStatusLabel","applyTone","showSpinner","sessionTime","update","formatMetaSegment","workspace","directory","writes","toolSummary","sessionLabel","rlSegments","buildRLStatusSegments","activeVariant","wins","currentModule","refiner","ties","totalGames","leader","pColor","rColor","pScore","rScore","trophy","streakText","streak","pBars","rBars","tBars","isParallel","parallelExecution","variantIcon","variantLabel","variantColor","lastWinner","winnerIcon","currentStep","stepText","truncateMiddle","stepsCompleted","totalSteps","pct","scores","pVal","rVal","pDisplay","rDisplay","accuracy","pAcc","rAcc","keepLen","statuses","colorizer","buildControlLines","buildToggleLine","shortcutLine","buildShortcutLine","buildCompactToggleLine","editIcon","editState","cycleHint","addToggle","hotkey","autoVerifyActive","verifyValue","approvalActive","thinkingLabelRaw","thinkingActive","dualRlActive","modeValue","buildLine","includeHotkeys","toggle","stateText","hotkeyText","addHotkey","promptWidth","continuationIndent","continuationWidth","rawBuffer","bufferLines","totalChars","cursorLine","cursorCol","foundCursor","lineIndex","isFirstLogicalLine","lineStartChar","firstLineWidth","contLineWidth","isFirstDisplayLine","displayLine","chunkStart","chunkEnd","offsetInChunk","lastLine","targetLine","visiblePart","cursorPos","before","charAt","after","textPart","buildInputWindow","available","cursorIndex","offset","maxOffset","window","display","char","cursorInWindow","pasteText","combinedText","captureInput","Promise","reject","resetBuffer","reason","capture","limit","visible","token","sliceLength","getBuffer","getCursor","setBuffer","requestedCursor","setSecretMode","enabled","setModeStatus","showCompactingStatus","hideCompactingStatus","emitPrompt","pushPromptEvent","ms","data","promptIdx","columns","exports"],"sources":["UnifiedUIRenderer.ts"],"sourcesContent":["/**\n * UnifiedUIRenderer - Claude Code style minimalist terminal UI.\n *\n * Goals:\n * - Single event pipeline for everything (prompt → thought → tool/build/test → response).\n * - Pinned status/meta only (never in scrollback).\n * - Scrollback only shows events; no duplicate status like \"Working on your request\" or \"Ready for prompts\".\n * - Streaming: first chunk sets a one-line banner; remainder streams naturally (optional).\n * - Collapsible-like summaries: we format a compact heading with an ellipsis indicator, but avoid ctrl+o hints.\n */\n\nimport * as readline from 'node:readline';\nimport { EventEmitter } from 'node:events';\nimport { homedir } from 'node:os';\nimport chalk from 'chalk';\nimport { theme, spinnerFrames, getToolColor } from './theme.js';\nimport { isPlainOutputMode } from './outputMode.js';\nimport { AnimatedSpinner, ThinkingIndicator, ContextMeter, disposeAnimations } from './animatedStatus.js';\nimport { logDebug } from '../utils/debugLogger.js';\nimport {\n  clampPercentage,\n  getContextColor,\n  UI_STRINGS,\n} from './uiConstants.js';\n\nexport interface CommandSuggestion {\n  command: string;\n  description: string;\n  category?: string;\n}\n\ntype CanonicalEventType = 'prompt' | 'thought' | 'stream' | 'tool' | 'tool-result' | 'build' | 'test' | 'response';\n\nexport type RendererEventType =\n  | CanonicalEventType\n  | 'raw'\n  | 'banner'\n  | 'error'\n  | 'streaming'\n  | 'tool-call'\n  | 'tool-result';\n\ntype UIEvent = {\n  type: CanonicalEventType;\n  rawType: RendererEventType;\n  content: string;\n  timestamp: number;\n  isCompacted?: boolean; // Claude Code style compact conversation block\n};\n\nexport interface UnifiedUIRendererOptions {\n  debug?: boolean;\n}\n\ntype InputChangeEvent = {\n  text: string;\n  cursor: number;\n};\n\ninterface ModeToggleState {\n  verificationEnabled: boolean;\n  verificationHotkey?: string;\n  autoContinueEnabled?: boolean;\n  autoContinueHotkey?: string;\n  thinkingModeLabel?: string | null;\n  thinkingHotkey?: string;\n  criticalApprovalMode?: 'auto' | 'approval';\n  criticalApprovalHotkey?: string;\n  dualRlEnabled?: boolean;\n  dualRlHotkey?: string;\n  debugEnabled?: boolean;\n  debugHotkey?: string;\n}\n\n/**\n * RL agent execution status for real-time display during dual-RL mode.\n */\nexport interface RLAgentStatus {\n  /** Current active variant being executed */\n  activeVariant?: 'primary' | 'refiner' | null;\n  /** Current module being processed */\n  currentModule?: string;\n  /** Current step within the module */\n  currentStep?: string;\n  /** Win statistics for primary vs refiner */\n  wins?: { primary: number; refiner: number; ties: number };\n  /** Current reward scores if available */\n  scores?: { primary?: number; refiner?: number };\n  /** Human-accuracy style scores (0-1) */\n  accuracy?: { primary?: number; refiner?: number };\n  /** Whether variants are running in parallel */\n  parallelExecution?: boolean;\n  /** Total steps completed */\n  stepsCompleted?: number;\n  /** Total steps to process */\n  totalSteps?: number;\n  /** Last step winner for celebration */\n  lastWinner?: 'primary' | 'refiner' | 'tie' | null;\n  /** Streak count for current leader */\n  streak?: number;\n}\n\nconst ESC = {\n  HIDE_CURSOR: '\\x1b[?25l',\n  SHOW_CURSOR: '\\x1b[?25h',\n  CLEAR_SCREEN: '\\x1b[2J',\n  CLEAR_LINE: '\\x1b[2K',\n  HOME: '\\x1b[H',\n  ENABLE_BRACKETED_PASTE: '\\x1b[?2004h',\n  DISABLE_BRACKETED_PASTE: '\\x1b[?2004l',\n  TO: (row: number, col: number) => `\\x1b[${row};${col}H`,\n  TO_COL: (col: number) => `\\x1b[${col}G`,\n  ERASE_DOWN: '\\x1b[J',\n  REVERSE: '\\x1b[7m',\n  RESET: '\\x1b[0m',\n  // Scroll region control - CRITICAL for fixed bottom overlay\n  SET_SCROLL_REGION: (top: number, bottom: number) => `\\x1b[${top};${bottom}r`,\n  RESET_SCROLL_REGION: '\\x1b[r',\n  SAVE_CURSOR: '\\x1b[s',\n  RESTORE_CURSOR: '\\x1b[u',\n} as const;\n\nconst NEWLINE_PLACEHOLDER = '↵';\n\nexport class UnifiedUIRenderer extends EventEmitter {\n  private readonly output: NodeJS.WriteStream;\n  private readonly input: NodeJS.ReadStream;\n  private readonly rl: readline.Interface;\n  private readonly plainMode: boolean;\n  private readonly interactive: boolean;\n\n  private rows = 24;\n  private cols = 80;\n  private lastRenderWidth: number | null = null;\n\n  private eventQueue: UIEvent[] = [];\n  private isProcessingQueue = false;\n\n  private buffer = '';\n  private cursor = 0;\n  private history: string[] = [];\n  private historyIndex = -1;\n  private suggestions: { command: string; description: string; category?: string }[] = [];\n  private suggestionIndex = -1;\n  private availableCommands: typeof this.suggestions = [];\n  private hotkeysInToggleLine: Set<string> = new Set();\n  private collapsedPaste: { text: string; lines: number; charDisplay: string; truncated: boolean; prePasteBuffer: string; prePasteCursor: number } | null = null;\n\n  private mode: 'idle' | 'streaming' = 'idle';\n  private lastToolResult: string | null = null;\n  /** Stack of collapsed tool results for Ctrl+O expansion */\n  private collapsedToolResults: Array<{\n    toolName: string;\n    content: string;\n    summary: string;\n    timestamp: number;\n  }> = [];\n  private readonly maxCollapsedResults = 50;\n  /** Track the last tool name for pairing with results */\n  private lastToolName: string = '';\n  private streamingStartTime: number | null = null;\n  private statusMessage: string | null = UI_STRINGS.LOADING;\n  private statusOverride: string | null = null;\n  private statusStreaming: string | null = null;\n  // Pinned status keeps the initial loading UI consistent across streaming/typing states\n  private pinnedStatus: { text: string; tone: 'success' | 'info' | 'warn' | 'error' } | null = null;\n\n  // Animated UI components\n  private streamingSpinner: AnimatedSpinner | null = null;\n  private thinkingIndicator: ThinkingIndicator | null = null;\n  private contextMeter: ContextMeter;\n  private spinnerFrame = 0;\n  private spinnerInterval: NodeJS.Timeout | null = null;\n  private readonly maxInlinePanelLines = 12;\n\n  // Compacting status animation\n  private compactingStatusMessage = '';\n  private compactingStatusFrame = 0;\n  private compactingStatusInterval: NodeJS.Timeout | null = null;\n  private readonly compactingSpinnerFrames = ['✻', '✼', '✻', '✺'];\n\n  // Animated activity line (e.g., \"✳ Ruminating… (esc to interrupt · 34s · ↑1.2k)\")\n  private activityMessage: string | null = null;\n  private activityPhraseIndex = 0;\n  private activityStarFrame = 0;\n  private readonly activityStarFrames = ['✳', '✴', '✵', '✶', '✷', '✸'];\n  // Token count during streaming\n  private streamingTokens = 0;\n  // Elapsed time color animation\n  private elapsedColorFrame = 0;\n  private readonly elapsedColorFrames = ['#F59E0B', '#FBBF24', '#FCD34D', '#FDE68A', '#FCD34D', '#FBBF24'];\n  // User-friendly activity phrases (clean, professional)\n  private readonly funActivityPhrases = [\n    'Thinking', 'Processing', 'Analyzing', 'Working', 'Preparing',\n  ];\n  private readonly maxCuratedReasoningLines = 8;\n  private readonly maxCuratedReasoningChars = 1800;\n  private readonly thoughtDedupWindowMs = 15000;\n  private lastCuratedThought: { text: string; at: number } | null = null;\n\n  private statusMeta: {\n    model?: string;\n    provider?: string;\n    sessionTime?: string;\n    contextPercent?: number;\n    profile?: string;\n    workspace?: string;\n    directory?: string;\n    writes?: string;\n    sessionLabel?: string;\n    thinkingLabel?: string;\n    autosave?: boolean;\n    version?: string;\n    author?: string;\n    toolSummary?: string;\n  } = {};\n  private toggleState: ModeToggleState = {\n    verificationEnabled: false,\n    autoContinueEnabled: false,\n    criticalApprovalMode: 'auto',\n    dualRlEnabled: false,\n    debugEnabled: false,\n  };\n\n  /** RL agent execution status for dual-RL mode display */\n  private rlStatus: RLAgentStatus = {};\n\n  // ------------ Helpers ------------\n\n  /** Ensure cursor is always within valid bounds for the current buffer */\n  private clampCursor(): void {\n    this.cursor = Math.max(0, Math.min(this.cursor, this.buffer.length));\n  }\n\n  /** Safely append to paste buffer with size limit enforcement */\n  private appendToPasteBuffer(buffer: 'paste' | 'plainPaste', text: string): void {\n    if (this.pasteBufferOverflow) return; // Already at limit\n    const current = buffer === 'paste' ? this.pasteBuffer : this.plainPasteBuffer;\n    const remaining = this.maxPasteBufferSize - current.length;\n    if (remaining <= 0) {\n      this.pasteBufferOverflow = true;\n      return;\n    }\n    const toAdd = text.length <= remaining ? text : text.slice(0, remaining);\n    if (buffer === 'paste') {\n      this.pasteBuffer += toAdd;\n    } else {\n      this.plainPasteBuffer += toAdd;\n    }\n    if (toAdd.length < text.length) {\n      this.pasteBufferOverflow = true;\n    }\n  }\n\n  /** Strip ANSI escape sequences and special formatting from text to get clean plaintext */\n  private sanitizePasteContent(text: string): string {\n    // Remove all ANSI escape sequences (CSI, OSC, etc.)\n    // Including bracketed paste markers (\\x1b[200~ and \\x1b[201~) which end with ~\n    // eslint-disable-next-line no-control-regex\n    let sanitized = text.replace(/\\x1b\\[[0-9;]*[A-Za-z~]|\\x1b\\][^\\x07]*\\x07|\\x1b[PX^_][^\\x1b]*\\x1b\\\\|\\x1b./g, '');\n    // Also remove partial bracketed paste markers that may have leaked (e.g., \"[200~\" without ESC)\n    sanitized = sanitized.replace(/\\[20[01]~/g, '');\n    // Remove any stray escape character at start/end\n    // eslint-disable-next-line no-control-regex\n    sanitized = sanitized.replace(/^\\x1b+|\\x1b+$/g, '');\n\n    // Strip special formatting characters for clean plaintext:\n    // - Zero-width characters (ZWSP, ZWNJ, ZWJ, BOM/ZWNBSP)\n    // - Word joiner, invisible separator, invisible times/plus\n    // - Directional formatting (LRM, RLM, LRE, RLE, LRO, RLO, PDF, LRI, RLI, FSI, PDI)\n    // - Object replacement character\n    // - Soft hyphen\n    // - Non-breaking space variants (NBSP, narrow NBSP, figure space, etc.)\n    sanitized = sanitized.replace(/[\\u200B-\\u200F\\u2028-\\u202F\\u2060-\\u206F\\uFEFF\\u00AD\\uFFFC]/g, '');\n\n    // Normalize various space characters to regular space\n    // Includes: NBSP, en/em space, thin space, hair space, figure space, etc.\n    sanitized = sanitized.replace(/[\\u00A0\\u2000-\\u200A\\u202F\\u205F\\u3000]/g, ' ');\n\n    // Remove control characters except tab, newline, carriage return\n    // eslint-disable-next-line no-control-regex\n    sanitized = sanitized.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F]/g, '');\n\n    return sanitized;\n  }\n\n  private formatHotkey(combo?: string): string | null {\n    if (!combo?.trim()) return null;\n    return combo.trim().toUpperCase();\n  }\n\n  private lastPromptEvent: { text: string; at: number } | null = null;\n\n  private promptHeight = 0;\n  private lastOverlayHeight = 0;\n  private inlinePanel: string[] = [];\n  private hasConversationContent = false;\n  private isPromptActive = false;\n  private inputRenderOffset = 0;\n  private readonly plainPasteIdleMs = 24;\n  private readonly plainPasteWindowMs = 60;\n  private readonly plainPasteTriggerChars = 24;\n  private readonly plainPasteEarlyNewlineChars = 2; // Guard for short first lines in plain paste mode\n  // Paste buffer limits to prevent memory exhaustion\n  private readonly maxPasteBufferSize = 10 * 1024 * 1024; // 10MB max paste size\n  private pasteBufferOverflow = false; // Track if paste was truncated\n  private cursorVisibleColumn = 1;\n  private inBracketedPaste = false;\n  private pasteBuffer = '';\n  private inPlainPaste = false;\n  private plainPasteBuffer = '';\n  private plainPasteTimer: NodeJS.Timeout | null = null;\n  private pasteBurstWindowStart = 0;\n  private pasteBurstCharCount = 0;\n  private plainRecentChunks: Array<{ text: string; at: number }> = [];\n  // Pending insert buffer: holds characters during paste detection window to prevent visual leak\n  private pendingInsertBuffer = '';\n  private pendingInsertTimer: NodeJS.Timeout | null = null;\n  private readonly pendingInsertDelayMs = 80; // Wait before committing chars as normal input\n  private lastRenderedEventKey: string | null = null;\n  private lastOutputEndedWithNewline = true;\n  private hasRenderedPrompt = false;\n  private hasEverRenderedOverlay = false;  // Track if we've ever rendered for inline clearing\n  private lastOverlay: { lines: string[]; promptIndex: number } | null = null;\n  private lastOverlayRendered: { lines: string[]; promptIndex: number; promptCol: number } | null = null;\n  private allowPromptRender = true;\n  private promptRenderingSuspended = false;\n  private secretMode = false;\n  // Render throttling to prevent excessive redraws during rapid input\n  private pendingRender = false;\n  private lastRenderTime = 0;\n  private readonly renderThrottleMs = 16; // ~60fps max\n  private renderThrottleTimer: NodeJS.Timeout | null = null;\n  // Disposal state to prevent operations after cleanup\n  private disposed = false;\n  // Bound event handlers for proper cleanup\n  private boundResizeHandler: (() => void) | null = null;\n  private boundKeypressHandler: ((str: string, key: readline.Key) => void) | null = null;\n  private inputCapture:\n    | {\n        resolve: (value: string) => void;\n        reject?: (reason?: unknown) => void;\n        options: { trim: boolean; allowEmpty: boolean };\n      }\n    | null = null;\n\n  constructor(\n    output: NodeJS.WriteStream = process.stdout,\n    input: NodeJS.ReadStream = process.stdin,\n    _options?: UnifiedUIRendererOptions\n  ) {\n    super();\n    this.output = output;\n    this.input = input;\n    this.interactive = Boolean(this.output.isTTY && this.input.isTTY && !process.env['CI']);\n    this.plainMode = isPlainOutputMode() || !this.interactive;\n\n    // Initialize animated components\n    this.contextMeter = new ContextMeter();\n\n    this.rl = readline.createInterface({\n      input: this.input,\n      output: this.output,\n      terminal: true,\n      prompt: '',\n      tabSize: 2,\n    });\n    this.rl.setPrompt('');\n    this.updateTerminalSize();\n\n    // Use bound handlers so we can remove them on cleanup\n    this.boundResizeHandler = () => {\n      if (!this.plainMode && !this.disposed) {\n        this.updateTerminalSize();\n        this.renderPrompt();\n      }\n    };\n    this.output.on('resize', this.boundResizeHandler);\n\n    this.setupInputHandlers();\n  }\n\n  initialize(): void {\n    if (!this.interactive) {\n      return;\n    }\n\n    // Reset input and paste state to prevent stale state from previous session\n    this.buffer = '';\n    this.cursor = 0;\n    this.inputRenderOffset = 0;\n    this.inBracketedPaste = false;\n    this.pasteBuffer = '';\n    this.pasteBufferOverflow = false;\n    this.inPlainPaste = false;\n    this.plainPasteBuffer = '';\n    this.collapsedPaste = null;\n    this.pendingInsertBuffer = '';\n    this.cancelPlainPasteCapture();\n\n    if (!this.plainMode) {\n      // If an overlay was already rendered before initialization (e.g., banner emitted early),\n      // clear it so initialize() doesn't stack a second control bar in scrollback.\n      if (this.hasRenderedPrompt || this.lastOverlay) {\n        this.clearPromptArea();\n      }\n      this.write(ESC.ENABLE_BRACKETED_PASTE);\n      this.updateTerminalSize();\n      this.hasRenderedPrompt = false;\n      this.lastOutputEndedWithNewline = true;\n      this.write(ESC.SHOW_CURSOR);\n      return;\n    }\n\n    // Plain mode: minimal setup, still render a simple prompt line\n    this.updateTerminalSize();\n    this.hasRenderedPrompt = false;\n    this.lastOutputEndedWithNewline = true;\n    this.renderPrompt();\n  }\n\n  cleanup(): void {\n    // Mark as disposed first to prevent any pending operations\n    this.disposed = true;\n\n    this.cancelInputCapture(new Error('Renderer disposed'));\n    this.cancelPlainPasteCapture();\n\n    // Clear render throttle timer\n    if (this.renderThrottleTimer) {\n      clearTimeout(this.renderThrottleTimer);\n      this.renderThrottleTimer = null;\n    }\n\n    // Stop any running animations\n    if (this.spinnerInterval) {\n      clearInterval(this.spinnerInterval);\n      this.spinnerInterval = null;\n    }\n    if (this.streamingSpinner) {\n      this.streamingSpinner.stop();\n      this.streamingSpinner = null;\n    }\n    if (this.thinkingIndicator) {\n      this.thinkingIndicator.stop();\n      this.thinkingIndicator = null;\n    }\n    this.contextMeter.dispose();\n    disposeAnimations();\n\n    // Remove event listeners to prevent memory leaks\n    if (this.boundResizeHandler) {\n      this.output.removeListener('resize', this.boundResizeHandler);\n      this.boundResizeHandler = null;\n    }\n    if (this.boundKeypressHandler) {\n      this.input.removeListener('keypress', this.boundKeypressHandler);\n      this.boundKeypressHandler = null;\n    }\n\n    // Remove all EventEmitter listeners from this instance\n    this.removeAllListeners();\n\n    if (!this.interactive) {\n      this.rl.close();\n      return;\n    }\n\n    if (!this.plainMode) {\n      // Clear the prompt area so it doesn't remain in scrollback history\n      this.clearPromptArea();\n      this.write(ESC.DISABLE_BRACKETED_PASTE);\n      this.write(ESC.SHOW_CURSOR);\n      this.write('\\n');\n    }\n    if (this.input.isTTY) {\n      this.input.setRawMode(false);\n    }\n    this.rl.close();\n    this.lastOverlay = null;\n\n    // Clear event queue\n    this.eventQueue = [];\n  }\n\n  suspendPromptRendering(): void {\n    this.promptRenderingSuspended = true;\n  }\n\n  resumePromptRendering(render: boolean = false): void {\n    this.promptRenderingSuspended = false;\n    if (render) {\n      this.renderPrompt();\n    }\n  }\n\n  // ------------ Input handling ------------\n\n  private setupInputHandlers(): void {\n    if (!this.interactive) {\n      return;\n    }\n    this.rl.removeAllListeners('line');\n    readline.emitKeypressEvents(this.input, this.rl);\n    if (this.input.isTTY) {\n      this.input.setRawMode(true);\n    }\n    // Use bound handler so we can remove it on cleanup\n    this.boundKeypressHandler = (str: string, key: readline.Key) => {\n      if (!this.disposed) {\n        this.handleKeypress(str, key);\n      }\n    };\n    this.input.on('keypress', this.boundKeypressHandler);\n  }\n\n  private emitInputChange(): void {\n    const payload: InputChangeEvent = {\n      text: this.buffer,\n      cursor: this.cursor,\n    };\n    this.emit('change', payload);\n  }\n\n  private handleKeypress(str: string, key: readline.Key): void {\n    // Normalize missing key metadata (common for some terminals emitting raw escape codes)\n    const normalizedKey = key ?? this.parseEscapeSequence(str);\n    const keyForPaste = normalizedKey ?? (str ? { sequence: str } as readline.Key : key);\n\n    if (this.handleBracketedPaste(str, keyForPaste)) {\n      return;\n    }\n\n    if (this.handlePlainPaste(str, keyForPaste)) {\n      return;\n    }\n\n    // macOS Option+key produces Unicode characters; handle them before key metadata checks.\n    const macOptionChars: Record<string, string> = {\n      '©': 'g',  // Option+G\n      '™': 'g',  // Option+Shift+G\n      'å': 'a',  // Option+A\n      'Å': 'a',  // Option+Shift+A\n      '√': 'v',  // Option+V / Option+Shift+V\n      '∂': 'd',  // Option+D\n      'Î': 'd',  // Option+Shift+D (common macOS emission)\n      '∆': 'd',  // Common alternate delta symbol\n    };\n\n    if (str && macOptionChars[str]) {\n      const letter = macOptionChars[str];\n      // Clear any pending insert buffer so the symbol never lands in the prompt\n      this.pendingInsertBuffer = '';\n      switch (letter) {\n        case 'a':\n          this.emit('toggle-critical-approval');\n          this.renderPrompt();\n          return;\n        case 'g':\n          this.emit('toggle-auto-continue');\n          this.renderPrompt();\n          return;\n        case 'd':\n          this.emit('toggle-dual-rl');\n          this.renderPrompt();\n          return;\n        case 'v':\n          this.emit('toggle-verify');\n          this.renderPrompt();\n          return;\n        default:\n          break;\n      }\n    }\n\n    if (!normalizedKey) {\n      return;\n    }\n\n    if (this.inputCapture && normalizedKey.ctrl && (normalizedKey.name === 'c' || normalizedKey.name === 'd')) {\n      this.cancelInputCapture(new Error('Input capture cancelled'));\n      this.clearBuffer();\n      return;\n    }\n\n    // Detect Ctrl+Shift combinations (fallback for non-macOS or configured terminals)\n    const isCtrlShift = (letter: string): boolean => {\n      const lowerLetter = letter.toLowerCase();\n      const upperLetter = letter.toUpperCase();\n\n      // Pattern 1: Standard readline shift flag + ctrl\n      if (normalizedKey.ctrl && normalizedKey.shift && normalizedKey.name?.toLowerCase() === lowerLetter) {\n        return true;\n      }\n\n      // Pattern 2: Some terminals send uppercase name with ctrl\n      if (normalizedKey.ctrl && normalizedKey.name === upperLetter) {\n        return true;\n      }\n\n      // Pattern 3: Meta/Alt + letter (iTerm2 with \"Option sends Meta\")\n      if (normalizedKey.meta && normalizedKey.name?.toLowerCase() === lowerLetter) {\n        return true;\n      }\n\n      // Pattern 4: Raw escape sequence check for xterm-style modifiers\n      const seq = str || normalizedKey.sequence;\n      // eslint-disable-next-line no-control-regex\n      if (seq && /^\\x1b\\[[0-9]+;6[~A-Z]?$/.test(seq)) {\n        return true;\n      }\n\n      // Pattern 5: ESC + letter (Option sends ESC prefix in some configs)\n      if (seq && seq === `\\x1b${lowerLetter}`) {\n        return true;\n      }\n\n      return false;\n    };\n\n    const handleCtrlShiftToggle = (letter: 'a' | 'g' | 'd' | 'v'): void => {\n      // Ensure no buffered chars leak into the prompt\n      this.pendingInsertBuffer = '';\n      if (letter === 'a') {\n        this.emit('toggle-critical-approval');\n      } else if (letter === 'g') {\n        this.emit('toggle-auto-continue');\n      } else if (letter === 'd') {\n        this.emit('toggle-dual-rl');\n      } else if (letter === 'v') {\n        this.emit('toggle-verify');\n      }\n      this.renderPrompt();\n    };\n\n    if (isCtrlShift('a')) {\n      handleCtrlShiftToggle('a');\n      return;\n    }\n\n    if (isCtrlShift('g')) {\n      handleCtrlShiftToggle('g');\n      return;\n    }\n\n    if (isCtrlShift('d')) {\n      handleCtrlShiftToggle('d');\n      return;\n    }\n\n    if (isCtrlShift('v')) {\n      handleCtrlShiftToggle('v');\n      return;\n    }\n\n    if (normalizedKey.ctrl && normalizedKey.name?.toLowerCase() === 'r') {\n      this.emit('resume');\n      return;\n    }\n\n    if (normalizedKey.ctrl && normalizedKey.name === 'c') {\n      // Ctrl+C behavior:\n      // 1. If buffer has text: clear it first, then notify shell\n      // 2. If buffer is empty: let shell decide to pause AI or quit\n      //\n      // The InteractiveShell maintains a counter to track Ctrl+C presses and decides\n      // whether to pause AI or exit based on processing state.\n\n      const hadBuffer = this.buffer.length > 0;\n      if (hadBuffer) {\n        // Clear the input buffer first\n        this.buffer = '';\n        this.cursor = 0;\n        this.renderPrompt();\n        this.emitInputChange();\n      }\n      // Emit ctrlc event with buffer state so shell can handle appropriately\n      this.emit('ctrlc', { hadBuffer });\n      return;\n    }\n\n    if (key.ctrl && key.name === 'd') {\n      if (this.buffer.length === 0) {\n        this.emit('interrupt');\n      }\n      return;\n    }\n\n    if (key.ctrl && key.name === 'u') {\n      this.clearBuffer();\n      return;\n    }\n\n    // Ctrl+L: Clear screen while preserving input\n    if (key.ctrl && key.name === 'l') {\n      if (this.collapsedPaste) {\n        this.expandCollapsedPasteToBuffer();\n        return;\n      }\n      // Clear screen and redraw\n      this.output.write('\\x1b[2J\\x1b[H'); // Clear screen, move to top\n      this.hasConversationContent = false;\n      this.clearCollapsedResults();\n      this.renderPrompt();\n      return;\n    }\n\n    // Ctrl+O: Expand last tool result\n    if (key.ctrl && key.name === 'o') {\n      this.emit('expand-tool-result');\n      return;\n    }\n\n    // Ctrl+A: Move cursor to start of line\n    if (key.ctrl && key.name === 'a') {\n      if (this.cursor !== 0) {\n        this.cursor = 0;\n        this.inputRenderOffset = 0;\n        this.renderPrompt();\n        this.emitInputChange();\n      }\n      return;\n    }\n\n    // Ctrl+E: Move cursor to end of line\n    if (key.ctrl && key.name === 'e') {\n      if (this.cursor !== this.buffer.length) {\n        this.cursor = this.buffer.length;\n        this.ensureCursorVisible();\n        this.renderPrompt();\n        this.emitInputChange();\n      }\n      return;\n    }\n\n    // Ctrl+W: Delete word backward\n    if (key.ctrl && key.name === 'w') {\n      if (this.cursor > 0) {\n        // Find start of previous word\n        let pos = this.cursor;\n        // Skip trailing spaces\n        while (pos > 0 && this.buffer[pos - 1] === ' ') pos--;\n        // Skip word characters\n        while (pos > 0 && this.buffer[pos - 1] !== ' ') pos--;\n        this.buffer = this.buffer.slice(0, pos) + this.buffer.slice(this.cursor);\n        this.cursor = pos;\n        this.updateSuggestions();\n        this.renderPrompt();\n        this.emitInputChange();\n      }\n      return;\n    }\n\n    // Ctrl+K: Delete from cursor to end of line\n    if (key.ctrl && key.name === 'k') {\n      if (this.cursor < this.buffer.length) {\n        this.buffer = this.buffer.slice(0, this.cursor);\n        this.updateSuggestions();\n        this.renderPrompt();\n        this.emitInputChange();\n      }\n      return;\n    }\n\n    // Home: Move cursor to start\n    if (key.name === 'home') {\n      if (this.cursor !== 0) {\n        this.cursor = 0;\n        this.inputRenderOffset = 0;\n        this.renderPrompt();\n        this.emitInputChange();\n      }\n      return;\n    }\n\n    // End: Move cursor to end\n    if (key.name === 'end') {\n      if (this.cursor !== this.buffer.length) {\n        this.cursor = this.buffer.length;\n        this.ensureCursorVisible();\n        this.renderPrompt();\n        this.emitInputChange();\n      }\n      return;\n    }\n\n    // Alt+Left: Move cursor back one word\n    if (key.meta && key.name === 'left') {\n      if (this.cursor > 0) {\n        let pos = this.cursor;\n        // Skip spaces\n        while (pos > 0 && this.buffer[pos - 1] === ' ') pos--;\n        // Skip word characters\n        while (pos > 0 && this.buffer[pos - 1] !== ' ') pos--;\n        this.cursor = pos;\n        this.ensureCursorVisible();\n        this.renderPrompt();\n        this.emitInputChange();\n      }\n      return;\n    }\n\n    // Alt+Right: Move cursor forward one word\n    if (key.meta && key.name === 'right') {\n      if (this.cursor < this.buffer.length) {\n        let pos = this.cursor;\n        // Skip current word\n        while (pos < this.buffer.length && this.buffer[pos] !== ' ') pos++;\n        // Skip spaces\n        while (pos < this.buffer.length && this.buffer[pos] === ' ') pos++;\n        this.cursor = pos;\n        this.ensureCursorVisible();\n        this.renderPrompt();\n        this.emitInputChange();\n      }\n      return;\n    }\n\n    // Alt+Backspace: Delete word backward (alternative to Ctrl+W)\n    if (key.meta && key.name === 'backspace') {\n      if (this.cursor > 0) {\n        let pos = this.cursor;\n        while (pos > 0 && this.buffer[pos - 1] === ' ') pos--;\n        while (pos > 0 && this.buffer[pos - 1] !== ' ') pos--;\n        this.buffer = this.buffer.slice(0, pos) + this.buffer.slice(this.cursor);\n        this.cursor = pos;\n        this.updateSuggestions();\n        this.renderPrompt();\n        this.emitInputChange();\n      }\n      return;\n    }\n\n    if (key.name === 'return' || key.name === 'enter') {\n      // If there's a collapsed paste, expand and submit in one action\n      if (this.collapsedPaste) {\n        this.expandCollapsedPaste();\n        return;\n      }\n      // If a slash command suggestion is highlighted, pressing Enter submits it immediately\n      if (this.applySuggestion(true)) return;\n      // Fallback: if buffer starts with '/' and suggestions exist, use the selected/first one\n      if (this.buffer.startsWith('/') && this.suggestions.length > 0) {\n        const safeIndex = this.suggestionIndex >= 0 && this.suggestionIndex < this.suggestions.length\n          ? this.suggestionIndex\n          : 0;\n        this.buffer = this.suggestions[safeIndex]?.command ?? this.buffer;\n      }\n      this.submitText(this.buffer);\n      return;\n    }\n\n    if (normalizedKey.name === 'backspace') {\n      if (this.collapsedPaste) {\n        this.collapsedPaste = null;\n        this.renderPrompt();\n        this.emitInputChange();\n        return;\n      }\n      if (this.cursor > 0) {\n        this.buffer = this.buffer.slice(0, this.cursor - 1) + this.buffer.slice(this.cursor);\n        this.cursor--;\n        this.updateSuggestions();\n        this.renderPrompt();\n        this.emitInputChange();\n      }\n      return;\n    }\n\n    if (normalizedKey.name === 'delete') {\n      if (this.cursor < this.buffer.length) {\n        this.buffer = this.buffer.slice(0, this.cursor) + this.buffer.slice(this.cursor + 1);\n        this.updateSuggestions();\n        this.renderPrompt();\n        this.emitInputChange();\n      }\n      return;\n    }\n\n    if (normalizedKey.name === 'left') {\n      if (this.cursor > 0) {\n        this.cursor--;\n        this.ensureCursorVisible();\n        this.renderPrompt();\n        this.emitInputChange();\n      }\n      return;\n    }\n\n    if (normalizedKey.name === 'right') {\n      if (this.cursor < this.buffer.length) {\n        this.cursor++;\n        this.ensureCursorVisible();\n        this.renderPrompt();\n        this.emitInputChange();\n      }\n      return;\n    }\n\n    if (normalizedKey.name === 'up') {\n      if (this.navigateSuggestions(-1)) {\n        return;\n      }\n      if (this.history.length > 0) {\n        if (this.historyIndex === -1) {\n          this.historyIndex = this.history.length - 1;\n        } else if (this.historyIndex > 0) {\n          this.historyIndex--;\n        }\n        // Validate index is within bounds before accessing\n        if (this.historyIndex >= 0 && this.historyIndex < this.history.length) {\n          this.buffer = this.history[this.historyIndex] ?? '';\n        } else {\n          this.historyIndex = -1;\n          this.buffer = '';\n        }\n        this.cursor = this.buffer.length;\n        this.inputRenderOffset = 0; // Reset render offset for new buffer\n        this.updateSuggestions();\n        this.renderPrompt();\n        this.emitInputChange();\n      }\n      return;\n    }\n\n    if (normalizedKey.name === 'down') {\n      if (this.navigateSuggestions(1)) {\n        return;\n      }\n      if (this.historyIndex !== -1) {\n        this.historyIndex++;\n        if (this.historyIndex >= this.history.length) {\n          this.historyIndex = -1;\n          this.buffer = '';\n        } else if (this.historyIndex >= 0) {\n          this.buffer = this.history[this.historyIndex] ?? '';\n        } else {\n          // Safety: invalid state, reset\n          this.historyIndex = -1;\n          this.buffer = '';\n        }\n        this.cursor = this.buffer.length;\n        this.inputRenderOffset = 0; // Reset render offset for new buffer\n        this.updateSuggestions();\n        this.renderPrompt();\n        this.emitInputChange();\n      }\n      return;\n    }\n\n    if (normalizedKey.name === 'tab') {\n      if (this.applySuggestion(false)) return;\n      return;\n    }\n\n    if (str && !normalizedKey.ctrl && !normalizedKey.meta) {\n      // Defer insertion to allow paste detection window to catch rapid input\n      this.queuePendingInsert(str);\n    }\n  }\n\n  /**\n   * Ensure horizontal cursor position stays within the visible input window.\n   * Prevents jumps when using left/right arrows on long lines.\n   */\n  private ensureCursorVisible(): void {\n    const maxWidth = Math.max(10, this.safeWidth() - 12); // margin for prompt/toggles and padding\n    // If cursor is left of current window, shift window left\n    if (this.cursor < this.inputRenderOffset) {\n      this.inputRenderOffset = this.cursor;\n      return;\n    }\n    // If cursor is beyond visible window, shift window right\n    if (this.cursor - this.inputRenderOffset >= maxWidth) {\n      this.inputRenderOffset = this.cursor - maxWidth + 1;\n    }\n  }\n\n  /**\n   * Parse raw escape sequences when readline doesn't populate key metadata.\n   * Prevents control codes (e.g., ^[[200~) from leaking into the buffer.\n   */\n  private parseEscapeSequence(sequence: string | null | undefined): readline.Key | null {\n    if (!sequence) return null;\n    const map: Record<string, readline.Key> = {\n      '\\x1b[A': { name: 'up', sequence } as readline.Key,\n      '\\x1b[B': { name: 'down', sequence } as readline.Key,\n      '\\x1b[C': { name: 'right', sequence } as readline.Key,\n      '\\x1b[D': { name: 'left', sequence } as readline.Key,\n      '\\x1b[H': { name: 'home', sequence } as readline.Key,\n      '\\x1b[F': { name: 'end', sequence } as readline.Key,\n      '\\x1b[200~': { name: 'paste-start', sequence } as readline.Key,\n      '\\x1b[201~': { name: 'paste-end', sequence } as readline.Key,\n    };\n    return map[sequence] ?? null;\n  }\n\n  /**\n   * Queue characters for deferred insertion. This prevents visual \"leak\" of\n   * pasted content by holding characters until we're confident it's not a paste.\n   */\n  private queuePendingInsert(text: string): void {\n    this.pendingInsertBuffer += text;\n\n    // Clear any existing timer\n    if (this.pendingInsertTimer) {\n      clearTimeout(this.pendingInsertTimer);\n      this.pendingInsertTimer = null;\n    }\n\n    // Schedule commit after delay - if paste detection triggers first, it will consume the buffer\n    this.pendingInsertTimer = setTimeout(() => {\n      this.commitPendingInsert();\n    }, this.pendingInsertDelayMs);\n  }\n\n  /**\n   * Commit pending characters as normal input (not a paste).\n   */\n  private commitPendingInsert(): void {\n    if (this.pendingInsertTimer) {\n      clearTimeout(this.pendingInsertTimer);\n      this.pendingInsertTimer = null;\n    }\n\n    if (this.pendingInsertBuffer && !this.inPlainPaste && !this.inBracketedPaste) {\n      this.insertText(this.pendingInsertBuffer);\n    }\n    this.pendingInsertBuffer = '';\n  }\n\n  /**\n   * Consume pending insert buffer into paste detection (prevents visual leak).\n   */\n  private consumePendingInsertForPaste(): string {\n    if (this.pendingInsertTimer) {\n      clearTimeout(this.pendingInsertTimer);\n      this.pendingInsertTimer = null;\n    }\n    const consumed = this.pendingInsertBuffer;\n    this.pendingInsertBuffer = '';\n    return consumed;\n  }\n\n  private handleBracketedPaste(str: string, key: readline.Key): boolean {\n    const sequence = key?.sequence || str;\n    if (sequence === ESC.ENABLE_BRACKETED_PASTE || sequence === ESC.DISABLE_BRACKETED_PASTE) {\n      return true;\n    }\n\n    // Handle case where paste markers might be embedded in the string\n    const pasteStartMarker = '\\x1b[200~';\n    const pasteEndMarker = '\\x1b[201~';\n\n    // Check if str contains paste start marker (handles chunked arrival)\n    if (typeof str === 'string' && str.includes(pasteStartMarker)) {\n      this.inBracketedPaste = true;\n      this.pasteBufferOverflow = false;\n      // Consume and sanitize pending buffer to prevent partial escape sequences leaking\n      const pending = this.sanitizePasteContent(this.consumePendingInsertForPaste());\n      // Extract content after the start marker (discard any content before it - likely partial escapes)\n      const startIdx = str.indexOf(pasteStartMarker);\n      let content = str.slice(startIdx + pasteStartMarker.length);\n      // Check if end marker is also in this chunk\n      if (content.includes(pasteEndMarker)) {\n        const endIdx = content.indexOf(pasteEndMarker);\n        content = content.slice(0, endIdx);\n        this.pasteBuffer = pending + content;\n        this.commitPasteBuffer();\n        return true;\n      }\n      this.pasteBuffer = pending + content;\n      this.cancelPlainPasteCapture();\n      return true;\n    }\n\n    if (sequence === pasteStartMarker) {\n      this.inBracketedPaste = true;\n      this.pasteBufferOverflow = false; // Reset overflow flag for new paste\n      // Consume and sanitize any pending insert buffer to prevent partial escapes leaking\n      const pending = this.sanitizePasteContent(this.consumePendingInsertForPaste());\n      this.pasteBuffer = pending;\n      this.cancelPlainPasteCapture();\n      return true;\n    }\n    if (!this.inBracketedPaste) {\n      return false;\n    }\n\n    // Check if str contains paste end marker\n    if (typeof str === 'string' && str.includes(pasteEndMarker)) {\n      const endIdx = str.indexOf(pasteEndMarker);\n      const contentBefore = str.slice(0, endIdx);\n      if (contentBefore) {\n        this.appendToPasteBuffer('paste', contentBefore);\n      }\n      this.commitPasteBuffer();\n      return true;\n    }\n\n    if (sequence === pasteEndMarker) {\n      this.commitPasteBuffer();\n      return true;\n    }\n    if (key?.name === 'return' || key?.name === 'enter') {\n      // During paste, Enter should just add a newline to the paste buffer, not submit\n      this.appendToPasteBuffer('paste', '\\n');\n      return true; // Consume the key to prevent it from reaching normal key handling\n    }\n    if (key?.name === 'backspace') {\n      this.pasteBuffer = this.pasteBuffer.slice(0, -1);\n      return true;\n    }\n    if (typeof str === 'string' && str.length > 0) {\n      this.appendToPasteBuffer('paste', str);\n      return true;\n    }\n    if (typeof sequence === 'string' && sequence.length > 0) {\n      this.appendToPasteBuffer('paste', sequence);\n      return true;\n    }\n    return true;\n  }\n\n  private captureCollapsedPaste(content: string, lineCount: number, wasTruncated: boolean): void {\n    const charDisplay = wasTruncated ? `${content.length}+` : `${content.length}`;\n    // Preserve any existing buffer content before the paste\n    const prePasteBuffer = this.buffer;\n    const prePasteCursor = this.cursor;\n    this.collapsedPaste = {\n      text: content,\n      lines: lineCount,\n      charDisplay,\n      truncated: wasTruncated,\n      prePasteBuffer,\n      prePasteCursor,\n    };\n    this.buffer = '';\n    this.cursor = 0;\n    this.updateSuggestions();\n    this.emitInputChange();\n    const existingTextNote = prePasteBuffer ? ' (existing text preserved)' : '';\n    const hint = `Paste captured: ${lineCount} line${lineCount === 1 ? '' : 's'}${wasTruncated ? ' (truncated)' : ''}${existingTextNote}. Enter to send, Ctrl+L to edit, Backspace to discard.`;\n    this.updateStatusBundle({ main: hint });\n    this.renderPrompt();\n  }\n\n  private commitPasteBuffer(): void {\n    if (!this.inBracketedPaste) return;\n    // Sanitize to remove any injected escape sequences, then normalize line endings\n    const sanitized = this.sanitizePasteContent(this.pasteBuffer);\n    const content = sanitized.replace(/\\r\\n?/g, '\\n');\n    if (content) {\n      const lineCount = content.split('\\n').length;\n      const wasTruncated = this.pasteBufferOverflow;\n      if (lineCount > 1 || content.length > 200) {\n        this.captureCollapsedPaste(content, lineCount, wasTruncated);\n      } else {\n        this.insertText(content);\n      }\n    }\n    this.inBracketedPaste = false;\n    this.pasteBuffer = '';\n    this.pasteBufferOverflow = false;\n    this.cancelPlainPasteCapture();\n  }\n\n  private handlePlainPaste(str: string, key: readline.Key): boolean {\n    // Fallback paste capture when bracketed paste isn't supported\n    if (this.inBracketedPaste || key?.ctrl || key?.meta) {\n      this.resetPlainPasteBurst();\n      this.pruneRecentPlainChunks();\n      return false;\n    }\n\n    // Don't treat escape sequences (arrow keys, etc.) as paste\n    // Escape sequences start with \\x1b (ESC) and are used for cursor movement, etc.\n    if (typeof str === 'string' && str.startsWith('\\x1b')) {\n      this.resetPlainPasteBurst();\n      this.pruneRecentPlainChunks();\n      return false;\n    }\n\n    const sequence = key?.sequence ?? '';\n    const chunk = typeof str === 'string' && str.length > 0 ? str : sequence;\n    if (!chunk) {\n      this.resetPlainPasteBurst();\n      this.pruneRecentPlainChunks();\n      return false;\n    }\n\n    const now = Date.now();\n    this.trackPlainPasteBurst(chunk.length, now);\n\n    // Handle Enter/Return key specifically during paste\n    if (this.inPlainPaste && (key?.name === 'return' || key?.name === 'enter')) {\n      // During paste, Enter should just add a newline to the paste buffer, not submit\n      this.appendToPasteBuffer('plainPaste', '\\n');\n      this.schedulePlainPasteCommit();\n      return true; // Consume the key to prevent it from reaching normal key handling\n    }\n\n    if (!this.inPlainPaste) {\n      this.recordRecentPlainChunk(chunk, now);\n    }\n\n    const chunkMultiple = chunk.length > 1;\n    const hasNewline = /[\\r\\n]/.test(chunk);\n    const burstActive = this.pasteBurstWindowStart > 0 && now - this.pasteBurstWindowStart <= this.plainPasteWindowMs;\n    const burstTrigger = burstActive && this.pasteBurstCharCount >= this.plainPasteTriggerChars;\n    const hasRecentNonNewline = this.plainRecentChunks.some(entry => !/^[\\r\\n]+$/.test(entry.text));\n    const earlyNewlineTrigger =\n      hasNewline &&\n      burstActive &&\n      hasRecentNonNewline &&\n      this.pasteBurstCharCount >= this.plainPasteEarlyNewlineChars;\n    const newlineTrigger = hasNewline && (this.inPlainPaste || chunkMultiple || burstTrigger || earlyNewlineTrigger);\n    const looksLikePaste = this.inPlainPaste || chunkMultiple || burstTrigger || newlineTrigger;\n\n    if (!looksLikePaste) {\n      this.pruneRecentPlainChunks();\n      return false;\n    }\n\n    let chunkAlreadyCaptured = false;\n    if (!this.inPlainPaste) {\n      this.inPlainPaste = true;\n      this.pasteBufferOverflow = false; // Reset overflow flag for new paste\n      // Consume pending insert buffer first - this is the primary source now\n      const pending = this.consumePendingInsertForPaste();\n      const reclaimed = this.reclaimRecentPlainChunks();\n      // Combine pending buffer with any reclaimed chunks\n      const combined = pending + reclaimed;\n      if (combined.length > 0) {\n        // Remove any chars that leaked into buffer (legacy reclaim path)\n        if (reclaimed.length > 0) {\n          const removeCount = Math.min(this.buffer.length, reclaimed.length);\n          const suffix = this.buffer.slice(-removeCount);\n          if (removeCount > 0 && suffix === reclaimed.slice(-removeCount)) {\n            this.buffer = this.buffer.slice(0, this.buffer.length - removeCount);\n            this.cursor = Math.max(0, this.buffer.length);\n            this.clampCursor(); // Ensure cursor is valid\n          }\n        }\n        this.plainPasteBuffer = combined.slice(0, this.maxPasteBufferSize);\n        if (combined.length > this.maxPasteBufferSize) {\n          this.pasteBufferOverflow = true;\n        }\n        chunkAlreadyCaptured = combined.endsWith(chunk);\n      } else {\n        this.plainPasteBuffer = '';\n      }\n    }\n\n    if (!chunkAlreadyCaptured) {\n      this.appendToPasteBuffer('plainPaste', chunk);\n    }\n    this.schedulePlainPasteCommit();\n    return true;\n  }\n\n  private trackPlainPasteBurst(length: number, now: number): void {\n    if (!this.pasteBurstWindowStart || now - this.pasteBurstWindowStart > this.plainPasteWindowMs) {\n      this.pasteBurstWindowStart = now;\n      this.pasteBurstCharCount = 0;\n    }\n    this.pasteBurstCharCount += length;\n  }\n\n  private resetPlainPasteBurst(): void {\n    this.pasteBurstWindowStart = 0;\n    this.pasteBurstCharCount = 0;\n  }\n\n  private cancelPlainPasteCapture(): void {\n    if (this.plainPasteTimer) {\n      clearTimeout(this.plainPasteTimer);\n      this.plainPasteTimer = null;\n    }\n    // Also cancel pending insert buffer\n    if (this.pendingInsertTimer) {\n      clearTimeout(this.pendingInsertTimer);\n      this.pendingInsertTimer = null;\n    }\n    this.pendingInsertBuffer = '';\n    this.inPlainPaste = false;\n    this.plainPasteBuffer = '';\n    this.plainRecentChunks = [];\n    this.resetPlainPasteBurst();\n  }\n\n  private recordRecentPlainChunk(text: string, at: number): void {\n    const windowStart = at - this.plainPasteWindowMs;\n    this.plainRecentChunks.push({ text, at });\n    this.plainRecentChunks = this.plainRecentChunks.filter(entry => entry.at >= windowStart);\n  }\n\n  private pruneRecentPlainChunks(): void {\n    if (!this.plainRecentChunks.length) return;\n    const now = Date.now();\n    const windowStart = now - this.plainPasteWindowMs;\n    this.plainRecentChunks = this.plainRecentChunks.filter(entry => entry.at >= windowStart);\n  }\n\n  private reclaimRecentPlainChunks(): string {\n    if (!this.plainRecentChunks.length) return '';\n    const combined = this.plainRecentChunks.map(entry => entry.text).join('');\n    this.plainRecentChunks = [];\n    return combined;\n  }\n\n  private schedulePlainPasteCommit(): void {\n    if (this.plainPasteTimer) {\n      clearTimeout(this.plainPasteTimer);\n    }\n    this.plainPasteTimer = setTimeout(() => {\n      this.finalizePlainPaste();\n    }, this.plainPasteIdleMs);\n  }\n\n  private finalizePlainPaste(): void {\n    if (!this.inPlainPaste) return;\n\n    // Sanitize to remove any injected escape sequences, then normalize line endings\n    const sanitized = this.sanitizePasteContent(this.plainPasteBuffer);\n    const content = sanitized.replace(/\\r\\n?/g, '\\n');\n    const wasTruncated = this.pasteBufferOverflow;\n    this.inPlainPaste = false;\n    this.plainPasteBuffer = '';\n    this.plainRecentChunks = [];\n    this.resetPlainPasteBurst();\n    this.pasteBufferOverflow = false;\n    if (this.plainPasteTimer) {\n      clearTimeout(this.plainPasteTimer);\n      this.plainPasteTimer = null;\n    }\n\n    if (!content) return;\n    const lineCount = content.split('\\n').length;\n    if (lineCount > 1 || content.length > 200) {\n      this.captureCollapsedPaste(content, lineCount, wasTruncated);\n      return;\n    }\n\n    this.insertText(content);\n  }\n\n  private insertText(text: string): void {\n    if (!text) return;\n    // Don't insert during paste operations - content goes to paste buffer\n    if (this.inBracketedPaste || this.inPlainPaste) {\n      return;\n    }\n    // If there's a collapsed paste and user types, expand to buffer first then insert at cursor\n    if (this.collapsedPaste) {\n      this.expandCollapsedPasteToBuffer();\n    }\n    // Sanitize input to remove special formatting characters\n    const sanitized = this.sanitizePasteContent(text);\n    if (!sanitized) return;\n    // Ensure cursor is valid before slicing\n    this.clampCursor();\n    this.buffer = this.buffer.slice(0, this.cursor) + sanitized + this.buffer.slice(this.cursor);\n    this.cursor += sanitized.length;\n    this.clampCursor(); // Ensure cursor remains valid after modification\n    this.updateSuggestions();\n    this.renderPrompt();\n    this.emitInputChange();\n  }\n\n  private submitText(text: string): void {\n    // If there's a collapsed paste, submit that instead of the buffer text\n    // This handles edge cases where submitText is called programmatically\n    if (this.collapsedPaste) {\n      this.expandCollapsedPaste();\n      return;\n    }\n\n    if (this.inputCapture) {\n      const shouldTrim = this.inputCapture.options.trim;\n      const normalizedCapture = shouldTrim ? text.trim() : text;\n      if (!this.inputCapture.options.allowEmpty && !normalizedCapture) {\n        this.renderPrompt();\n        return;\n      }\n      const resolver = this.inputCapture;\n      this.inputCapture = null;\n      this.buffer = '';\n      this.cursor = 0;\n      this.inputRenderOffset = 0;\n      this.resetSuggestions();\n      this.renderPrompt();\n      this.emitInputChange();\n      resolver.resolve(normalizedCapture);\n      return;\n    }\n\n    const normalized = text.trim();\n    if (!normalized) {\n      this.renderPrompt();\n      return;\n    }\n\n    // Don't add secrets or slash commands to history/scrollback\n    if (!this.secretMode && !normalized.startsWith('/')) {\n      this.history.push(normalized);\n      this.historyIndex = -1;\n      this.displayUserPrompt(normalized);\n    } else if (!this.secretMode) {\n      // Still track slash commands in history for convenience\n      this.history.push(normalized);\n      this.historyIndex = -1;\n    }\n    if (this.mode === 'streaming') {\n      this.emit('queue', normalized);\n    } else {\n      this.emit('submit', normalized);\n    }\n    this.buffer = '';\n    this.cursor = 0;\n    this.resetSuggestions();\n    this.renderPrompt();\n    this.emitInputChange();\n  }\n\n  private updateSuggestions(): void {\n    if (!this.buffer.startsWith('/')) {\n      this.resetSuggestions();\n      return;\n    }\n\n    const firstSpace = this.buffer.indexOf(' ');\n    const hasArgText = firstSpace >= 0 && /\\S/.test(this.buffer.slice(firstSpace + 1));\n    // Hide slash suggestions when the user is editing arguments\n    if (firstSpace >= 0 && this.cursor > firstSpace && hasArgText) {\n      this.resetSuggestions();\n      return;\n    }\n\n    const cursorSlice = this.buffer.slice(0, this.cursor);\n    const commandSlice = firstSpace >= 0 ? cursorSlice.slice(0, firstSpace) : cursorSlice;\n    const fallbackSlice = firstSpace >= 0 ? this.buffer.slice(0, firstSpace) : this.buffer;\n    const partial = (commandSlice.trimEnd() || fallbackSlice.trimEnd() || '/').toLowerCase();\n    const previous = this.suggestions[this.suggestionIndex]?.command;\n    this.suggestions = this.availableCommands\n      .filter(cmd => cmd.command.toLowerCase().startsWith(partial))\n      .slice(0, 5);\n    if (this.suggestions.length === 0) {\n      this.resetSuggestions();\n      return;\n    }\n    if (previous) {\n      const idx = this.suggestions.findIndex(s => s.command === previous);\n      this.suggestionIndex = idx >= 0 ? idx : 0;\n    } else {\n      this.suggestionIndex = 0;\n    }\n  }\n\n  setAvailableCommands(commands: typeof this.suggestions): void {\n    this.availableCommands = commands;\n    this.updateSuggestions();\n  }\n\n  private applySuggestion(submit: boolean): boolean {\n    if (!this.buffer.startsWith('/') || this.suggestions.length === 0) {\n      return false;\n    }\n    // Ensure suggestionIndex is valid, default to first item\n    const safeIndex = this.suggestionIndex >= 0 && this.suggestionIndex < this.suggestions.length\n      ? this.suggestionIndex\n      : 0;\n    const selected = this.suggestions[safeIndex];\n    if (!selected) {\n      return false;\n    }\n    if (submit) {\n      this.submitText(selected.command);\n    } else {\n      this.buffer = `${selected.command} `;\n      this.cursor = this.buffer.length;\n      this.resetSuggestions();\n      this.renderPrompt();\n      this.emitInputChange();\n    }\n    return true;\n  }\n\n  private resetSuggestions(): void {\n    this.suggestions = [];\n    this.suggestionIndex = -1;\n  }\n\n  private navigateSuggestions(direction: number): boolean {\n    if (!this.buffer.startsWith('/') || this.suggestions.length === 0) {\n      // Reset index if suggestions were cleared but index wasn't\n      if (this.suggestionIndex !== -1 && this.suggestions.length === 0) {\n        this.suggestionIndex = -1;\n      }\n      return false;\n    }\n    // Ensure current index is valid before computing next\n    const currentIndex = this.suggestionIndex >= 0 && this.suggestionIndex < this.suggestions.length\n      ? this.suggestionIndex\n      : -1;\n    const next = currentIndex + direction;\n    const clamped = Math.max(0, Math.min(this.suggestions.length - 1, next));\n    if (clamped === this.suggestionIndex && this.suggestionIndex >= 0) {\n      return true;\n    }\n    this.suggestionIndex = clamped;\n    this.renderPrompt();\n    return true;\n  }\n\n  // ------------ Event queue ------------\n\n  addEvent(type: RendererEventType, content: string): void {\n    logDebug(`[DEBUG renderer] addEvent called: type=${type}, content length=${content?.length || 0}`);\n    if (!content) return;\n    const normalized = this.normalizeEventType(type);\n    if (!normalized) return;\n    // Drop thinking/reasoning blocks entirely from scrollback\n    if (normalized === 'thought') {\n      return;\n    }\n\n    // When pinned loading UI is active, suppress all non-prompt events to keep the\n    // initial layout intact across streaming/typing/post-stream.\n    // Allow banner events even when pinned - they're part of the initial UI\n    if (this.pinnedStatus && normalized !== 'prompt' && type !== 'banner') {\n      // Transition out of the pinned welcome state on first real event\n      this.clearPinnedStatus();\n    }\n\n    logDebug(`[DEBUG renderer] normalized type=${normalized}`);\n    if (\n      normalized === 'prompt' ||\n      normalized === 'response' ||\n      normalized === 'stream' ||\n      normalized === 'tool' ||\n      normalized === 'tool-result' ||\n      normalized === 'build' ||\n      normalized === 'test'\n    ) {\n      this.hasConversationContent = true;\n    }\n    if (normalized === 'tool-result') {\n      this.lastToolResult = content;\n    }\n\n    if (this.plainMode) {\n      const formatted = this.formatContent({\n        type: normalized,\n        rawType: type,\n        content,\n        timestamp: Date.now(),\n      });\n      if (formatted) {\n        const text = formatted.endsWith('\\n') ? formatted : `${formatted}\\n`;\n        this.output.write(text);\n        this.lastOutputEndedWithNewline = text.endsWith('\\n');\n      }\n      return;\n    }\n\n    const event = {\n      type: normalized,\n      rawType: type,\n      content,\n      timestamp: Date.now(),\n    };\n\n    // Priority queue: prompt events are inserted at the front to ensure immediate display\n    // This guarantees user input is echoed before any async processing responses\n    if (normalized === 'prompt') {\n      // Find the first non-prompt event and insert before it\n      // This maintains prompt order while giving them priority over other events\n      const insertIndex = this.eventQueue.findIndex(e => e.type !== 'prompt');\n      if (insertIndex === -1) {\n        this.eventQueue.push(event);\n      } else {\n        this.eventQueue.splice(insertIndex, 0, event);\n      }\n    } else {\n      this.eventQueue.push(event);\n    }\n\n    if (!this.isProcessingQueue) {\n      queueMicrotask(() => {\n        if (!this.isProcessingQueue) {\n          void this.processQueue();\n        }\n      });\n    }\n  }\n\n  /**\n   * Re-render the prompt/control bar immediately.\n   * This keeps the chat box pinned during long streaming runs instead of waiting\n   * for the event queue to drain before the prompt reappears.\n   */\n  private renderPromptOverlay(immediate: boolean = false): void {\n    if (this.plainMode || this.disposed || !this.output.isTTY || this.promptRenderingSuspended) {\n      return;\n    }\n    this.allowPromptRender = true;\n    if (immediate) {\n      this.renderPromptImmediate();\n      return;\n    }\n    this.renderPrompt();\n  }\n\n  private async processQueue(): Promise<void> {\n    if (this.isProcessingQueue || this.disposed) return;\n    this.isProcessingQueue = true;\n    try {\n      while (this.eventQueue.length > 0 && !this.disposed) {\n        const event = this.eventQueue.shift();\n        if (!event) continue;\n        const coalesced = this.coalesceAdjacentTextEvents(event);\n        try {\n          await this.renderEvent(coalesced);\n        } catch (error) {\n          // Never allow a rendering failure to stall the event queue\n          if (this.disposed) break; // Don't try to write after disposal\n          const message =\n            error instanceof Error ? error.message : typeof error === 'string' ? error : 'Unknown renderer error';\n          this.output.write(`\\n[renderer] ${message}\\n`);\n        }\n\n        // Check disposed before continuing\n        if (this.disposed) break;\n\n        // Note: For prompt events, the overlay is already rendered in renderEvent()\n        // via renderPromptOverlay(true). No need to render again here.\n        if (event.type === 'prompt') {\n          // Ensure prompt rendering is allowed for subsequent events\n          if (this.output.isTTY) {\n            this.allowPromptRender = true;\n          }\n          // No delay for prompt events - render immediately\n        } else {\n          await this.delay(1);\n        }\n      }\n      // ALWAYS render prompt after queue completes to keep bottom UI persistent\n      // This ensures status/toggles stay pinned and responses are fully rendered\n      if (this.output.isTTY && !this.disposed) {\n        this.allowPromptRender = true;\n        this.renderPrompt();\n      }\n    } finally {\n      this.isProcessingQueue = false;\n    }\n  }\n\n  /**\n   * Merge adjacent response/thought events into a single block so continuous\n   * chat text renders with one bullet instead of one per chunk.\n   */\n  private coalesceAdjacentTextEvents(event: UIEvent): UIEvent {\n    const isMergeable = (target: UIEvent | undefined): target is UIEvent =>\n      Boolean(\n        target &&\n          !target.isCompacted &&\n          ((target.type === 'response' && target.rawType === 'response') ||\n            (target.type === 'thought' && target.rawType === 'thought'))\n      );\n\n    if (!isMergeable(event)) {\n      return event;\n    }\n\n    while (this.eventQueue.length > 0 && isMergeable(this.eventQueue[0])) {\n      const next = this.eventQueue.shift()!;\n      const needsSeparator =\n        event.content.length > 0 && !event.content.endsWith('\\n') && !next.content.startsWith('\\n');\n      event.content = needsSeparator ? `${event.content}\\n${next.content}` : `${event.content}${next.content}`;\n    }\n\n    return event;\n  }\n\n  /**\n   * Flush pending renderer events.\n   * Useful for startup flows (e.g., welcome banner) to guarantee the scrollback is hydrated\n   * before continuing with additional UI updates.\n   */\n  async flushEvents(timeoutMs: number = 250): Promise<void> {\n    // Kick off processing if idle\n    if (!this.plainMode && !this.isProcessingQueue && this.eventQueue.length > 0) {\n      void this.processQueue();\n    }\n\n    const start = Date.now();\n    while ((this.isProcessingQueue || this.eventQueue.length > 0) && Date.now() - start < timeoutMs) {\n      await this.delay(5);\n    }\n\n    if (!this.plainMode && this.output.isTTY) {\n      this.allowPromptRender = true;\n      this.renderPrompt();\n    }\n  }\n\n  private async renderEvent(event: UIEvent): Promise<void> {\n    logDebug(`[DEBUG renderer] renderEvent: type=${event.type}, content length=${event.content?.length || 0}`);\n    if (this.plainMode) {\n      logDebug('[DEBUG renderer] plainMode - writing directly');\n      const formattedPlain = this.formatContent(event);\n      if (formattedPlain) {\n        const text = formattedPlain.endsWith('\\n') ? formattedPlain : `${formattedPlain}\\n`;\n        this.output.write(text);\n        this.lastOutputEndedWithNewline = text.endsWith('\\n');\n      }\n      return;\n    }\n\n    const formatted = this.formatContent(event);\n    logDebug(`[DEBUG renderer] formatted length=${formatted?.length || 0}`);\n    if (!formatted) return;\n\n    // Allow prompts and responses to always render (don't deduplicate)\n    // Only deduplicate streaming content\n    const signature = `${event.rawType}:${event.content}`;\n    if (event.type === 'stream' && signature === this.lastRenderedEventKey) {\n      return;\n    }\n    if (event.type !== 'prompt') {\n      this.lastRenderedEventKey = signature;\n    }\n\n    // Clear the prompt area before writing new content\n    if (this.pinnedStatus) {\n      // Keep the loading overlay intact for non-tool events\n      // BUT allow tool calls and results through so users see execution feedback\n      if (event.type !== 'tool' && event.type !== 'tool-result') {\n        if (event.type === 'prompt' && this.output.isTTY && this.interactive && !this.disposed) {\n          this.renderPromptOverlay(true);\n        }\n        return;\n      }\n      // For tool events, clear pinned status temporarily to render them\n    }\n\n    if (this.promptHeight > 0 || this.lastOverlay) {\n      this.clearPromptArea();\n    }\n    this.isPromptActive = false;\n\n    if (event.type !== 'stream' && !this.lastOutputEndedWithNewline && formatted.trim()) {\n      // Keep scrollback ordering predictable when previous output ended mid-line\n      this.output.write('\\n');\n      this.lastOutputEndedWithNewline = true;\n    }\n\n    this.output.write(formatted);\n    this.lastOutputEndedWithNewline = formatted.endsWith('\\n');\n\n    // Immediately restore the prompt overlay so the chat box stays pinned during streaming\n    if (this.output.isTTY && this.interactive && !this.disposed) {\n      this.renderPromptOverlay(true);\n    }\n  }\n\n  private normalizeEventType(type: RendererEventType): CanonicalEventType | null {\n    switch (type) {\n      case 'prompt':\n        return 'prompt';\n      case 'thought':\n        return 'thought';\n      case 'stream':\n      case 'streaming':\n        return 'stream';\n      case 'tool':\n      case 'tool-call':\n        return 'tool';\n      case 'tool-result':\n        return 'tool-result';\n      case 'build':\n        return 'build';\n      case 'test':\n        return 'test';\n      case 'response':\n      case 'banner':\n      case 'raw':\n        return 'response';\n      case 'error':\n        return 'response';\n      default:\n        return null;\n    }\n  }\n\n  private formatContent(event: UIEvent): string {\n    // Compacted blocks already have separator and formatting\n    if (event.isCompacted) {\n      return event.content;\n    }\n\n    if (event.rawType === 'banner') {\n      // Banners display without bullet prefix\n      const lines = event.content.split('\\n').map(line => line.trimEnd());\n      return `${lines.join('\\n')}\\n`;\n    }\n\n    // Compact, user-friendly formatting\n    switch (event.type) {\n      case 'prompt':\n        // User prompt - just the text (prompt box handles styling)\n        return `${theme.primary('>')} ${event.content}\\n`;\n\n      case 'thought': {\n        // Show thinking/reasoning output in extended thinking mode or debug mode\n        const thinkingLabel = (this.toggleState.thinkingModeLabel || 'balanced').trim().toLowerCase();\n        const thinkingIsDeep = thinkingLabel === 'extended' || thinkingLabel === 'deep';\n        if (!this.toggleState.debugEnabled && !thinkingIsDeep) {\n          return '';\n        }\n        // Programmatic filter: reject content that looks like internal/garbage output\n        if (this.isGarbageOutput(event.content)) {\n          return '';\n        }\n        const curated = this.curateReasoningContent(event.content);\n        if (!curated || this.isGarbageOutput(curated)) {\n          return '';\n        }\n        if (!this.shouldRenderThought(curated)) {\n          return '';\n        }\n        this.lastCuratedThought = {\n          text: curated.replace(/\\s+/g, ' ').trim().toLowerCase(),\n          at: Date.now(),\n        };\n        return this.formatThinkingBlock(curated);\n      }\n\n      case 'tool': {\n        // Compact tool display: ⚡ToolName → result\n        const content = event.content.replace(/^[⏺⚙○]\\s*/, '');\n        return this.formatCompactToolCall(content);\n      }\n\n      case 'tool-result': {\n        // Inline result: └─ summary\n        return this.formatCompactToolResult(event.content);\n      }\n\n      case 'build':\n        return this.wrapBulletText(event.content, { label: 'build', labelColor: theme.warning });\n\n      case 'test':\n        return this.wrapBulletText(event.content, { label: 'test', labelColor: theme.info });\n\n      case 'stream': {\n        // Streaming content is the model's response - pass through directly\n        // IMPORTANT: Don't filter streaming chunks with isGarbageOutput because:\n        // 1. Chunks arrive character-by-character or in small pieces\n        // 2. Small chunks like \".\" or \":\" are valid parts of sentences\n        // 3. Filtering would break the streaming display\n        // Only filter completely empty content\n        if (!event.content) {\n          return '';\n        }\n        return event.content;\n      }\n\n      case 'response':\n      default: {\n        // Programmatic filter: reject content that looks like internal/garbage output\n        if (this.isGarbageOutput(event.content)) {\n          return '';\n        }\n        // Clean response without excessive bullets, wrapped for readability\n        const isError = event.rawType === 'error';\n        return this.wrapBulletText(event.content, isError ? { label: 'error', labelColor: theme.error } : undefined);\n      }\n    }\n  }\n\n  /**\n   * Programmatic garbage detection - checks if content looks like internal/system output\n   * that shouldn't be shown to users. Uses structural checks, not pattern matching.\n   */\n  private isGarbageOutput(content: string): boolean {\n    if (!content || content.trim().length === 0) return true;\n\n    const trimmed = content.trim();\n\n    // Very short content checks - catch leaked punctuation fragments like \".\" or \":\"\n    if (trimmed.length <= 3) {\n      // Single punctuation marks or very short punctuation sequences are garbage\n      if (/^[.,:;!?*#\\-_=+|\\\\/<>(){}[\\]`'\"~^@&%$]+$/.test(trimmed)) {\n        return true;\n      }\n    }\n\n    // Check if content is just punctuation on multiple lines (leaked reasoning)\n    const lines = content.split('\\n');\n    const punctOnlyLines = lines.filter(line => {\n      const lineTrimmed = line.trim();\n      return lineTrimmed.length > 0 && /^[.,:;!?*#\\-_=+|\\\\/<>(){}[\\]`'\"~^@&%$\\s]+$/.test(lineTrimmed);\n    });\n    // If ALL non-empty lines are just punctuation, it's garbage\n    const nonEmptyLines = lines.filter(l => l.trim().length > 0);\n    if (nonEmptyLines.length > 0 && punctOnlyLines.length === nonEmptyLines.length) {\n      return true;\n    }\n\n    // Structural check: content starting with < that isn't valid markdown/code\n    if (content.startsWith('<') && !content.startsWith('<http') && !content.startsWith('<!')) {\n      return true;\n    }\n\n    // Structural check: contains \"to=functions.\" or \"to=tools.\" (internal routing)\n    if (content.includes('to=functions.') || content.includes('to=tools.')) {\n      return true;\n    }\n\n    // Structural check: looks like internal instruction (quoted system text)\n    if (content.startsWith('\"') && content.includes('block') && content.includes('tool')) {\n      return true;\n    }\n\n    // Structural check: very short content that's just timing info\n    if (content.length < 30 && /elapsed|seconds?|ms\\b/i.test(content)) {\n      return true;\n    }\n\n    // Structural check: mostly punctuation/symbols - leaked reasoning fragments\n    const meaningfulLines = lines.filter(line => {\n      const lineTrimmed = line.trim();\n      if (!lineTrimmed) return false;\n      // Line must have at least 30% alphanumeric content\n      const alphaNum = (lineTrimmed.match(/[a-zA-Z0-9]/g) || []).length;\n      return lineTrimmed.length > 0 && alphaNum / lineTrimmed.length >= 0.3;\n    });\n    // If less than 30% of lines are meaningful, it's garbage\n    if (lines.length > 3 && meaningfulLines.length / lines.length < 0.3) {\n      return true;\n    }\n\n    // Structural check: gibberish - high ratio of non-word characters\n    const alphaCount = (content.match(/[a-zA-Z]/g) || []).length;\n    const totalCount = content.replace(/\\s/g, '').length;\n    if (totalCount > 20 && alphaCount / totalCount < 0.4) {\n      return true; // Less than 40% letters = likely garbage\n    }\n\n    return false;\n  }\n\n  /**\n   * Sanitize tool result content to remove leaked reasoning/thinking output.\n   * This filters out fragments that look like internal model output.\n   */\n  private sanitizeToolResultContent(content: string): string {\n    if (!content) return '';\n\n    // Split into lines and filter out garbage lines\n    const lines = content.split('\\n');\n    const cleanLines: string[] = [];\n\n    for (const line of lines) {\n      const trimmed = line.trim();\n\n      // Skip empty lines at start\n      if (cleanLines.length === 0 && !trimmed) continue;\n\n      // Skip lines that look like leaked reasoning fragments\n      // Common patterns: single punctuation, markdown artifacts, emoji fragments\n      if (/^[)\\]}>*`'\"]+$/.test(trimmed)) continue;\n      if (/^[*_]{2,}$/.test(trimmed)) continue; // Just ** or __\n      if (/^[|│┃]+$/.test(trimmed)) continue; // Just vertical bars\n      if (/^[─━═]+$/.test(trimmed)) continue; // Just horizontal lines\n      if (/^\\.{2,}$/.test(trimmed)) continue; // Just dots\n      if (/^[\\s️]+$/.test(trimmed)) continue; // Just whitespace/emoji modifiers\n      if (/^[:\\s]+$/.test(trimmed)) continue; // Just colons/whitespace\n      if (/^[,\\s]+$/.test(trimmed)) continue; // Just commas/whitespace\n\n      // Skip markdown bold/italic fragments that leaked\n      if (/^\\*{1,2}[^*]*\\*{0,2}$/.test(trimmed) && trimmed.length < 10 && !/\\w{3,}/.test(trimmed)) continue;\n\n      // Skip lines that are just short fragments with high punctuation ratio\n      const alphaInLine = (trimmed.match(/[a-zA-Z0-9]/g) || []).length;\n      if (trimmed.length > 0 && trimmed.length < 20 && alphaInLine / trimmed.length < 0.3) continue;\n\n      // Skip very short lines that are just punctuation or single chars (except numbers)\n      if (trimmed.length <= 2 && !/^\\d+$/.test(trimmed) && !/^[a-zA-Z]{2}$/.test(trimmed)) {\n        // Allow specific short patterns like \"OK\", \"0\", \"1\" etc.\n        if (!/^(?:ok|no|yes|\\d+)$/i.test(trimmed)) continue;\n      }\n\n      // Skip lines that look like stray parentheses or brackets from reasoning\n      if (/^[()[\\]{}]+$/.test(trimmed)) continue;\n\n      // Skip lines that look like markdown code fence artifacts\n      if (/^```\\s*$/.test(trimmed)) continue;\n\n      cleanLines.push(line);\n    }\n\n    // Trim trailing empty lines\n    while (cleanLines.length > 0 && !cleanLines[cleanLines.length - 1]?.trim()) {\n      cleanLines.pop();\n    }\n\n    return cleanLines.join('\\n').trim();\n  }\n\n  private curateReasoningContent(content: string): string | null {\n    const normalized = content.replace(/\\r\\n/g, '\\n').replace(/\\r/g, '\\n').trim();\n    if (!normalized) return null;\n\n    const limited =\n      normalized.length > this.maxCuratedReasoningChars\n        ? normalized.slice(0, this.maxCuratedReasoningChars)\n        : normalized;\n\n    const maxSegments = this.maxCuratedReasoningLines * 3;\n    const segments = limited\n      .split('\\n')\n      .flatMap(line => line.split(/(?<=[.?!])\\s+/))\n      .map(line => line.replace(/^[•*⏺○\\-\\u2022]+\\s*/, '').trim())\n      .filter(Boolean);\n\n    if (segments.length === 0) {\n      return null;\n    }\n\n    const seen = new Set<string>();\n    const deduped: string[] = [];\n    for (const segment of segments) {\n      const normalizedSegment = segment.replace(/\\s+/g, ' ');\n      const key = normalizedSegment.toLowerCase();\n      if (seen.has(key)) {\n        continue;\n      }\n      seen.add(key);\n      deduped.push(normalizedSegment);\n      if (deduped.length >= maxSegments) {\n        break;\n      }\n    }\n\n    if (deduped.length === 0) {\n      return null;\n    }\n\n    const prioritized = this.prioritizeReasoningSegments(deduped);\n    if (prioritized.length === 0) {\n      return null;\n    }\n\n    const limitedSelection = prioritized.slice(0, this.maxCuratedReasoningLines);\n    const bulleted = limitedSelection.map(line => this.ensureReasoningBullet(line));\n\n    return bulleted.join('\\n');\n  }\n\n  private ensureReasoningBullet(line: string): string {\n    if (/^([•*⏺○-]|\\d+[.)])\\s/.test(line)) {\n      return line;\n    }\n    return `• ${line}`;\n  }\n\n  private looksStructuredThought(line: string): boolean {\n    return (\n      /^(\\d+[.)]\\s|step\\s*\\d+|plan\\b|next\\b|then\\b|goal\\b)/i.test(line) ||\n      /^[-*•]\\s/.test(line) ||\n      line.includes('->') ||\n      line.includes('→') ||\n      line.includes(': ') ||\n      /\\b(test|verify|validate|check|build|run|deploy|diff|lint|type ?check|fix|bug|issue|risk|mitigate|investigate)\\b/i.test(line)\n    );\n  }\n\n  private prioritizeReasoningSegments(segments: string[]): string[] {\n    if (!segments.length) {\n      return [];\n    }\n\n    const scored = segments.map((text, index) => ({\n      text,\n      index,\n      score: this.reasoningSignalScore(text),\n    }));\n\n    const hasSignal = scored.some(item => item.score > 0);\n    if (!hasSignal) {\n      return segments;\n    }\n\n    scored.sort((a, b) => {\n      if (b.score !== a.score) return b.score - a.score;\n      return a.index - b.index;\n    });\n\n    return scored.map(item => item.text);\n  }\n\n  private reasoningSignalScore(line: string): number {\n    let score = 0;\n    const lower = line.toLowerCase();\n\n    if (this.looksStructuredThought(line)) {\n      score += 3;\n    }\n\n    const actionKeywords = [\n      'tool', 'command', 'script', 'context', 'summar', 'risk', 'issue',\n      'investigate', 'root cause', 'remediat', 'mitigat', 'fix', 'patch',\n      'test', 'verify', 'validate', 'check', 'build', 'deploy', 'run',\n      'diff', 'lint', 'typecheck', 'benchmark',\n    ];\n    if (actionKeywords.some(keyword => lower.includes(keyword))) {\n      score += 2;\n    }\n\n    if (/[#:→]|->/.test(line)) {\n      score += 1;\n    }\n\n    if (/^(i('| a)m|i will|let me|starting|now|ok|sure)\\b/i.test(line)) {\n      score -= 1;\n    }\n\n    if (line.length > 120) {\n      score -= 1;\n    }\n\n    return score;\n  }\n\n  private shouldRenderThought(content: string): boolean {\n    const normalized = content.replace(/\\s+/g, ' ').trim().toLowerCase();\n    if (!normalized) {\n      return false;\n    }\n\n    const now = Date.now();\n    if (this.lastCuratedThought && this.lastCuratedThought.text === normalized) {\n      if (now - this.lastCuratedThought.at < this.thoughtDedupWindowMs) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Format text in Claude Code style: ⏺ prefix with wrapped continuation lines\n   * Example:\n   *   ⏺ The AI ran tools but gave no response. Need to fix\n   *     the response handling. Let me check where the AI's\n   *     text response should be displayed:\n   */\n  private formatClaudeCodeBlock(content: string): string {\n    const bullet = '⏺';\n    const maxWidth = Math.max(24, Math.min(this.safeWidth() - 4, 110)); // Responsive to terminal width\n    const lines = content.split('\\n');\n    const result: string[] = [];\n\n    for (let lineIdx = 0; lineIdx < lines.length; lineIdx++) {\n      const line = lines[lineIdx]!;\n      if (!line.trim()) {\n        result.push('');\n        continue;\n      }\n\n      // Word-wrap each line\n      const words = line.split(/(\\s+)/);\n      let currentLine = '';\n\n      for (const word of words) {\n        if ((currentLine + word).length > maxWidth && currentLine.trim()) {\n          // First line of this paragraph gets ⏺, rest get indent\n          const prefix = result.length === 0 && lineIdx === 0 ? `${bullet} ` : '  ';\n          result.push(`${prefix}${currentLine.trimEnd()}`);\n          currentLine = word.trimStart();\n        } else {\n          currentLine += word;\n        }\n      }\n\n      if (currentLine.trim()) {\n        const prefix = result.length === 0 && lineIdx === 0 ? `${bullet} ` : '  ';\n        result.push(`${prefix}${currentLine.trimEnd()}`);\n      }\n    }\n\n    return result.join('\\n') + '\\n';\n  }\n\n  /**\n   * Format a tool call in Claude Code style:\n   *   ⏺ [Search] pattern: \"foo\", path: \"src\",\n   *              output_mode: \"content\", head_limit: 30\n   */\n  private formatToolCall(content: string): string {\n    const bullet = '⏺';\n    // Parse tool name and arguments\n    const match = content.match(/^(\\w+)\\((.*)\\)$/s);\n    if (!match) {\n      // Simple format without args\n      const nameMatch = content.match(/^(\\w+)/);\n      if (nameMatch) {\n        return `${bullet} ${theme.tool(`[${nameMatch[1]}]`)}\\n`;\n      }\n      return `${bullet} ${content}\\n`;\n    }\n\n    const toolName = match[1];\n    const argsStr = match[2]!;\n    const maxWidth = Math.min(this.cols - 4, 56);\n\n    // Format: ⏺ [ToolName] args...\n    const prefix = `${bullet} ${theme.tool(`[${toolName}]`)} `;\n    const prefixLen = toolName!.length + 5; // \"⏺ [ToolName] \" visible length\n    const indent = ' '.repeat(prefixLen + 4); // Extra indent for wrapped args\n\n    // Parse and format arguments\n    const args = this.parseToolArgs(argsStr);\n    if (args.length === 0) {\n      return `${prefix.trimEnd()}\\n`;\n    }\n\n    const lines: string[] = [];\n    let currentLine = prefix;\n\n    for (let i = 0; i < args.length; i++) {\n      const arg = args[i]!;\n      const argText = `${theme.ui.muted(arg.key + ':')} ${this.formatArgValue(arg.key, arg.value)}`;\n      const separator = i < args.length - 1 ? ', ' : '';\n\n      // Check if this arg fits on current line\n      const testLine = currentLine + argText + separator;\n      if (this.stripAnsi(testLine).length > maxWidth && currentLine !== prefix) {\n        lines.push(currentLine.trimEnd());\n        currentLine = indent + argText + separator;\n      } else {\n        currentLine += argText + separator;\n      }\n    }\n\n    if (currentLine.trim()) {\n      lines.push(currentLine.trimEnd());\n    }\n\n    return lines.join('\\n') + '\\n';\n  }\n\n  /**\n   * Parse tool arguments from string like: key: \"value\", key2: value2\n   */\n  private parseToolArgs(argsStr: string): Array<{ key: string; value: string }> {\n    const args: Array<{ key: string; value: string }> = [];\n    // Simple regex to extract key: value pairs\n    const regex = /(\\w+):\\s*(\"(?:[^\"\\\\]|\\\\.)*\"|[^,)]+)/g;\n    let match;\n    while ((match = regex.exec(argsStr)) !== null) {\n      args.push({ key: match[1]!, value: match[2]!.trim() });\n    }\n    return args;\n  }\n\n  /**\n   * Format an argument value (truncate long strings)\n   */\n  private formatArgValue(key: string, value: string): string {\n    // Remove surrounding quotes if present\n    const isQuoted = value.startsWith('\"') && value.endsWith('\"');\n    const inner = isQuoted ? value.slice(1, -1) : value;\n\n    const lowerKey = key.toLowerCase();\n    const shouldPreserve =\n      lowerKey.includes('path') ||\n      lowerKey === 'file' ||\n      lowerKey === 'pattern' ||\n      lowerKey === 'query' ||\n      lowerKey === 'command' ||\n      lowerKey === 'cmd';\n\n    // Truncate long values when not explicitly preserving\n    const maxLen = 40;\n    const truncated = shouldPreserve || inner.length <= maxLen ? inner : inner.slice(0, maxLen - 3) + '...';\n\n    return isQuoted ? `\"${truncated}\"` : truncated;\n  }\n\n  /**\n   * Format a tool result in Claude Code style:\n   *   ⎿  Found 12 lines (ctrl+o to expand)\n   */\n  private formatToolResult(content: string): string {\n    // Check if this is a summary line (e.g., \"Found X lines\")\n    const summaryMatch = content.match(/^(Found \\d+ (?:lines?|files?|matches?)|Read \\d+ lines?|Wrote \\d+ lines?|Edited|Created|Deleted)/i);\n    if (summaryMatch) {\n      return `  ${theme.ui.muted('⎿')}  ${content} ${theme.ui.muted('(ctrl+o to expand)')}\\n`;\n    }\n\n    // For other results, show truncated preview\n    const lines = content.split('\\n');\n    if (lines.length > 3) {\n      const preview = lines.slice(0, 2).join('\\n');\n      return `  ${theme.ui.muted('⎿')}  ${preview}\\n  ${theme.ui.muted(`... ${lines.length - 2} more lines (ctrl+o to expand)`)}\\n`;\n    }\n\n    return `  ${theme.ui.muted('⎿')}  ${content}\\n`;\n  }\n\n  /**\n   * Format a compact tool call: ⏺ [Read] file.ts\n   */\n  private formatCompactToolCall(content: string): string {\n    const bullet = '⏺';\n    // Parse tool name and args\n    const match = content.match(/^(\\w+)\\s*(?:\\((.*)\\))?$/s);\n    if (!match) {\n      return `${bullet} ${content}\\n`;\n    }\n\n    const toolName = match[1]!;\n    const argsStr = match[2]?.trim() || '';\n\n    // Track tool name for pairing with result\n    this.lastToolName = toolName;\n\n    // Get tool-specific color (bash=orange, read=cyan, write=green, etc.)\n    const toolColor = getToolColor(toolName);\n    const coloredToolName = toolColor(`[${toolName}]`);\n\n    // If no args, just show tool name\n    if (!argsStr) {\n      return `${bullet} ${coloredToolName}\\n`;\n    }\n\n    const maxWidth = this.cols - 8; // Leave room for margins\n\n    // Parse individual params\n    const params = this.parseToolParams(argsStr);\n    if (params.length === 0) {\n      return `${bullet} ${coloredToolName} ${argsStr}\\n`;\n    }\n\n    // Format params with proper wrapping\n    return this.formatToolParamsColored(toolName, params, maxWidth, toolColor);\n  }\n\n  /**\n   * Parse tool params from args string\n   */\n  private parseToolParams(argsStr: string): Array<{ key: string; value: string }> {\n    const params: Array<{ key: string; value: string }> = [];\n    // Match key: \"value\" or key: value patterns\n    const regex = /(\\w+):\\s*(\"(?:[^\"\\\\]|\\\\.)*\"|[^,\\n]+)/g;\n    let match;\n    while ((match = regex.exec(argsStr)) !== null) {\n      params.push({ key: match[1]!, value: match[2]!.trim() });\n    }\n    return params;\n  }\n\n  /**\n   * Format tool params in Claude Code style with wrapping (default green color)\n   */\n  private formatToolParams(\n    toolName: string,\n    params: Array<{ key: string; value: string }>,\n    maxWidth: number\n  ): string {\n    return this.formatToolParamsColored(toolName, params, maxWidth, theme.tool);\n  }\n\n  /**\n   * Format tool params with custom tool color\n   */\n  private formatToolParamsColored(\n    toolName: string,\n    params: Array<{ key: string; value: string }>,\n    maxWidth: number,\n    toolColor: (text: string) => string\n  ): string {\n    const bullet = '⏺';\n    const lines: string[] = [];\n    const indent = '        '; // 8 spaces for continuation\n\n    let currentLine = `${bullet} ${toolColor(`[${toolName}]`)} `;\n    let firstParam = true;\n\n    for (const param of params) {\n      const coloredValue = this.colorParamValue(param.key, param.value);\n      const paramText = `${param.key}: ${coloredValue}`;\n      const paramStr = firstParam ? paramText : `, ${paramText}`;\n\n      // Check if adding this param would exceed width\n      const testLine = currentLine + paramStr;\n      const plainLength = this.visibleLength(testLine);\n\n      if (plainLength > maxWidth && !firstParam) {\n        // Start new line\n        lines.push(currentLine);\n        currentLine = indent + paramText;\n      } else {\n        currentLine += paramStr;\n      }\n      firstParam = false;\n    }\n\n    lines.push(currentLine);\n\n    return lines.join('\\n') + '\\n';\n  }\n\n  /**\n   * Color critical parameter values (paths, commands) for readability.\n  */\n  private colorParamValue(key: string, value: string): string {\n    const lowerKey = key.toLowerCase();\n    if (lowerKey.includes('path') || lowerKey === 'file' || lowerKey === 'pattern' || lowerKey === 'query') {\n      return theme.warning(value);\n    }\n    if (lowerKey === 'command' || lowerKey === 'cmd') {\n      return theme.tool(value);\n    }\n    return value;\n  }\n\n  /**\n   * Extract a short summary from tool args\n   */\n  private extractToolSummary(toolName: string, argsStr: string): string | null {\n    const tool = toolName.toLowerCase();\n\n    // Extract path/file for file operations\n    if (['read', 'write', 'edit', 'glob', 'grep', 'search'].includes(tool)) {\n      const pathMatch = argsStr.match(/(?:path|file_path|pattern):\\s*\"([^\"]+)\"/);\n      if (pathMatch) {\n        const path = pathMatch[1]!;\n        return theme.file?.path ? theme.file.path(path) : theme.ui.muted(path);\n      }\n    }\n\n    // Extract command for bash\n    if (tool === 'bash') {\n      const cmdMatch = argsStr.match(/command:\\s*\"([^\"]+)\"/);\n      if (cmdMatch) {\n        const cmd = cmdMatch[1]!;\n        return theme.ui.muted(cmd);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Format a compact tool result: ⎿  Found X lines (ctrl+o to expand)\n   */\n  private formatCompactToolResult(content: string): string {\n    // Sanitize content first - filter out garbage/reasoning output that leaked through\n    const sanitized = this.sanitizeToolResultContent(content);\n    if (!sanitized || this.isGarbageOutput(sanitized)) {\n      return ''; // Don't render garbage tool results\n    }\n\n    // Parse common result patterns for summary\n    const lineMatch = sanitized.match(/(\\d+)\\s*lines?/i);\n    const fileMatch = sanitized.match(/(\\d+)\\s*(?:files?|matches?)/i);\n    const readMatch = sanitized.match(/read.*?(\\d+)\\s*lines?/i);\n\n    // Check if content contains a file path or command that should be preserved\n    const hasPath = /(?:^|\\s)(?:\\/[\\w./-]+|[\\w./-]+\\/[\\w./-]+)/.test(sanitized);\n    const hasCommand = /^\\s*\\$\\s+.+|command:/i.test(sanitized);\n    const isPathOrDir = /^(?:File|Directory|Path):\\s*/i.test(sanitized);\n\n    let summary: string;\n    let preserveFull = false;\n\n    if (readMatch) {\n      summary = `Read ${readMatch[1]} lines`;\n    } else if (lineMatch) {\n      summary = `Found ${lineMatch[1]} line${lineMatch[1] === '1' ? '' : 's'}`;\n    } else if (fileMatch) {\n      summary = `Found ${fileMatch[1]} file${fileMatch[1] === '1' ? '' : 's'}`;\n    } else if (sanitized.match(/^(success|ok|done|completed|written|edited|created)/i)) {\n      summary = '✓';\n    } else if (isPathOrDir || hasPath || hasCommand) {\n      // Preserve full content for paths, directories, and commands\n      // Only show first line if multi-line\n      const firstLine = sanitized.split('\\n')[0] || sanitized;\n      summary = firstLine;\n      preserveFull = true;\n    } else {\n      // Extract meaningful summary from content\n      let summaryText = sanitized;\n\n      // Handle \"Summary:\" prefix from web search/extract results\n      const summaryMatch = sanitized.match(/^Summary:\\s*(.+)/i);\n      if (summaryMatch) {\n        summaryText = summaryMatch[1]!;\n      }\n\n      // For multi-line content, use first meaningful line\n      const firstLine = summaryText.split('\\n')[0]?.trim() || summaryText;\n\n      // Try to end at a sentence boundary for readability (up to 120 chars)\n      const maxLen = 120;\n      if (firstLine.length > maxLen) {\n        // Look for sentence end within limit\n        const sentenceEnd = firstLine.slice(0, maxLen).search(/[.!?;]\\s|[.!?;]$/);\n        if (sentenceEnd > 30) {\n          summary = firstLine.slice(0, sentenceEnd + 1);\n        } else {\n          // No good sentence break, truncate at word boundary\n          const truncated = firstLine.slice(0, maxLen);\n          const lastSpace = truncated.lastIndexOf(' ');\n          summary = lastSpace > 60 ? truncated.slice(0, lastSpace) + '…' : truncated + '…';\n        }\n      } else {\n        summary = firstLine;\n      }\n    }\n\n    // Store collapsed result for Ctrl+O expansion (use sanitized content)\n    this.collapsedToolResults.push({\n      toolName: this.lastToolName || 'tool',\n      content: sanitized,\n      summary,\n      timestamp: Date.now(),\n    });\n\n    // Trim to max size\n    if (this.collapsedToolResults.length > this.maxCollapsedResults) {\n      this.collapsedToolResults.shift();\n    }\n\n    const coloredSummary = this.colorResultSummary(summary);\n    // Only show expand hint if content is actually collapsed (multi-line or was truncated)\n    const hasMoreContent = sanitized.includes('\\n') || summary.endsWith('…') || (!preserveFull && sanitized.length > summary.length);\n    const expandHint = hasMoreContent ? ` ${theme.ui.muted('(ctrl+o to expand)')}` : '';\n    return `  ${theme.ui.muted('⎿')}  ${coloredSummary}${expandHint}\\n`;\n  }\n\n  private colorResultSummary(summary: string): string {\n    if (!summary) return summary;\n    const lower = summary.toLowerCase();\n    if (lower.includes('fail') || lower.includes('error')) {\n      return theme.error(summary);\n    }\n    if (summary.startsWith('✓') || lower.includes('updated') || lower.includes('created') || lower.includes('written')) {\n      return theme.success(summary);\n    }\n    return theme.info(summary);\n  }\n\n  /**\n   * Format a compact response with bullet on first line\n   */\n  private formatCompactResponse(content: string): string {\n    return this.wrapBulletText(content);\n  }\n\n  /**\n   * Wrap text with a single bullet on the first line and tidy indentation for readability.\n   * Prevents awkward mid-word terminal wrapping by handling the layout ourselves.\n   */\n  private wrapBulletText(\n    content: string,\n    options: { maxWidth?: number; label?: string; labelColor?: (value: string) => string } = {}\n  ): string {\n    const bullet = '⏺';\n    const cleaned = content.replace(/^[⏺•○]\\s*/, '').trimEnd();\n    if (!cleaned.trim()) {\n      return '';\n    }\n\n    // Reserve a little margin to reduce terminal wrap jitter\n    const availableWidth = this.safeWidth();\n    const maxWidth = Math.max(20, Math.min(options.maxWidth ?? availableWidth - 2, availableWidth));\n    const labelText = options.label\n      ? `${options.labelColor ? options.labelColor(options.label) : options.label}${theme.ui.muted(' · ')}`\n      : '';\n    const bulletPrefix = `${bullet} ${labelText}`;\n    const indent = ' '.repeat(this.visibleLength(`${bullet} `));\n\n    const lines = cleaned.split('\\n');\n    const result: string[] = [];\n    let firstNonEmpty = true;\n\n    for (const rawLine of lines) {\n      const line = rawLine.trim();\n      if (!line) {\n        result.push(''); // Preserve intentional spacing between paragraphs\n        continue;\n      }\n\n      const words = line.split(/\\s+/);\n      let current = '';\n      for (const word of words) {\n        const candidate = current ? `${current} ${word}` : word;\n        const prefixLength = this.visibleLength(firstNonEmpty ? bulletPrefix : indent);\n        if (prefixLength + this.visibleLength(candidate) > maxWidth && current) {\n          result.push(`${firstNonEmpty ? bulletPrefix : indent}${current}`);\n          current = word;\n          firstNonEmpty = false;\n        } else {\n          current = candidate;\n        }\n      }\n\n      if (current) {\n        result.push(`${firstNonEmpty ? bulletPrefix : indent}${current}`);\n        firstNonEmpty = false;\n      }\n    }\n\n    return result.join('\\n') + '\\n';\n  }\n\n  /**\n   * Format thinking block with enhanced visual design.\n   * Uses a distinct visual style to clearly separate thinking from responses.\n   *\n   * In plain output mode we keep it simple and inline with the rest of the\n   * stream so transcripts remain easy to scan.\n   */\n  private formatThinkingBlock(content: string): string {\n    if (!content.trim()) return '';\n\n    const normalized = content.replace(/\\s+/g, ' ').trim();\n    return this.wrapBulletText(normalized, {\n      label: 'thinking',\n      labelColor: theme.secondary ?? theme.ui.muted, // Purple for thinking (distinct from blue tools)\n    });\n  }\n\n  private wrapTextToWidth(text: string, width: number): string[] {\n    if (!text.trim()) return [''];\n    const lines: string[] = [];\n    const words = text.trim().split(/\\s+/);\n    let current = '';\n\n    for (const word of words) {\n      const candidate = current ? `${current} ${word}` : word;\n      if (this.visibleLength(candidate) > width && current) {\n        lines.push(current);\n        current = word;\n      } else {\n        current = candidate;\n      }\n    }\n\n    if (current) {\n      lines.push(current);\n    }\n\n    return lines;\n  }\n\n  /**\n   * Format streaming elapsed time in Claude Code style: 3m 30s\n   */\n  private formatStreamingElapsed(): string | null {\n    if (!this.streamingStartTime) return null;\n    const elapsed = Math.floor((Date.now() - this.streamingStartTime) / 1000);\n    if (elapsed < 5) return null; // Don't show for very short durations\n    const mins = Math.floor(elapsed / 60);\n    const secs = elapsed % 60;\n    if (mins > 0) {\n      return `${mins}m ${secs}s`;\n    }\n    return `${secs}s`;\n  }\n\n  /**\n   * Format a compact conversation block (Claude Code style)\n   * Shows a visual separator with \"history\" label and ctrl+o hint\n   */\n  private formatCompactBlock(content: string, label: string = 'history'): string {\n    const maxWidth = Math.min(this.cols, 80);\n    const labelText = ` ${label} `;\n    const padding = Math.max(0, maxWidth - labelText.length);\n    const leftPad = Math.floor(padding / 2);\n    const rightPad = Math.ceil(padding / 2);\n\n    // Claude Code style: ══ history ═════════════\n    const separator = theme.ui.muted('═'.repeat(leftPad) + labelText + '═'.repeat(rightPad));\n\n    return `\\n${separator}\\n${content}\\n`;\n  }\n\n  /**\n   * Add a compact conversation block to the event queue\n   * This displays a collapsed view with expansion hint (Claude Code style)\n   */\n  addCompactBlock(content: string, label: string = 'history'): void {\n    const formattedContent = this.formatCompactBlock(content, label);\n    this.eventQueue.push({\n      type: 'response',\n      rawType: 'response',\n      content: formattedContent,\n      timestamp: Date.now(),\n      isCompacted: true,\n    });\n    if (!this.isProcessingQueue) {\n      void this.processQueue();\n    }\n  }\n\n  /**\n   * Expand the most recent tool result inline (Ctrl+O support).\n   * Pops from the collapsed results stack and displays full content.\n   */\n  expandLastToolResult(): boolean {\n    // First try the new stack, fallback to old lastToolResult\n    const collapsed = this.collapsedToolResults.pop();\n    if (!collapsed && !this.lastToolResult) {\n      return false;\n    }\n\n    const content = collapsed?.content || this.lastToolResult || '';\n    const toolName = collapsed?.toolName || 'result';\n\n    // Determine if this is structured output that shouldn't be word-wrapped\n    const isStructured = this.isStructuredToolOutput(toolName, content);\n\n    let rendered: string;\n    if (isStructured) {\n      // Preserve structured output (grep, bash, code output) - just indent, don't wrap\n      rendered = this.formatStructuredToolOutput(toolName, content);\n    } else {\n      // Format prose/text with tool name label and word wrapping\n      const label = `${toolName}`;\n      rendered = this.wrapBulletText(content, { label, labelColor: theme.info });\n    }\n\n    this.eventQueue.push({\n      type: 'response',\n      rawType: 'response',\n      content: rendered,\n      timestamp: Date.now(),\n      isCompacted: false,\n    });\n\n    // Clear lastToolResult if we used the stack\n    if (collapsed) {\n      this.lastToolResult = null;\n    }\n\n    if (!this.isProcessingQueue) {\n      void this.processQueue();\n    }\n    return true;\n  }\n\n  /**\n   * Check if tool output is structured (code, grep, file listings) that shouldn't be word-wrapped.\n   */\n  private isStructuredToolOutput(toolName: string, content: string): boolean {\n    const tool = toolName.toLowerCase();\n    // Tools that produce structured output\n    if (['bash', 'grep', 'read', 'glob', 'execute_bash', 'search', 'find'].includes(tool)) {\n      return true;\n    }\n    // Content patterns that indicate structured output\n    // - File paths with colons (grep output): src/file.ts:123:\n    // - Line numbers: \"   1→\" or \"  42:\"\n    // - Code-like patterns\n    if (/^\\s*[\\w./]+:\\d+[:\\s]/.test(content)) return true; // grep-style output\n    if (/^\\s*\\d+[→:│|]\\s/.test(content)) return true; // line-numbered output\n    if (/^[│├└─┌┐┘┬┴┼╭╮╯╰]+/.test(content)) return true; // box drawing\n    if (/^\\s*[$>]\\s+\\w+/.test(content)) return true; // command prompt output\n    return false;\n  }\n\n  /**\n   * Format structured tool output preserving line structure.\n   */\n  private formatStructuredToolOutput(toolName: string, content: string): string {\n    const lines = content.split('\\n');\n    const header = `⏺ ${theme.info(toolName)}${theme.ui.muted(' · expanded')}\\n`;\n    const indent = '  ';\n    const maxWidth = this.safeWidth() - 4;\n\n    const formattedLines = lines.map(line => {\n      // Truncate overly long lines instead of wrapping (preserves structure)\n      if (line.length > maxWidth) {\n        return indent + line.slice(0, maxWidth - 1) + '…';\n      }\n      return indent + line;\n    });\n\n    return header + formattedLines.join('\\n') + '\\n';\n  }\n\n  /**\n   * Get count of expandable collapsed results\n   */\n  getCollapsedResultCount(): number {\n    return this.collapsedToolResults.length;\n  }\n\n  /**\n   * Clear all collapsed results (e.g., on new conversation)\n   */\n  clearCollapsedResults(): void {\n    this.collapsedToolResults = [];\n    this.lastToolResult = null;\n  }\n\n  // ------------ Status / mode ------------\n\n  setMode(mode: 'idle' | 'streaming'): void {\n    const wasStreaming = this.mode === 'streaming';\n    this.mode = mode;\n\n    // Track streaming start time for elapsed display\n    if (mode === 'streaming' && !wasStreaming) {\n      this.streamingStartTime = Date.now();\n      this.streamingTokens = 0; // Reset token count\n      // Clear inline panel when entering streaming mode to prevent stale menus\n      if (this.inlinePanel.length > 0) {\n        this.inlinePanel = [];\n      }\n    } else if (mode === 'idle' && wasStreaming) {\n      this.streamingStartTime = null;\n    }\n\n    // Keep spinner running while streaming or when pinned loading UI is active\n    const shouldSpin = this.mode === 'streaming' && !this.pinnedStatus;\n    if (shouldSpin) {\n      this.startSpinnerAnimation();\n    } else {\n      this.stopSpinnerAnimation();\n    }\n\n    if (wasStreaming && mode === 'idle' && !this.lastOutputEndedWithNewline) {\n      // Finish streaming on a fresh line so the next prompt/event doesn't collide\n      this.write('\\n');\n      this.lastOutputEndedWithNewline = true;\n    }\n    if (!this.plainMode) {\n      // Always render prompt to keep bottom UI persistent (rich mode only)\n      this.renderPrompt();\n    }\n  }\n\n  /**\n   * Keep the initial loading UI pinned regardless of streaming/user input state.\n   */\n  pinLoadingUI(text: string = UI_STRINGS.LOADING): void {\n    this.pinnedStatus = { text: text || UI_STRINGS.LOADING, tone: 'info' };\n    // Keep the loading UI static; don't start spinner in pinned mode\n    if (this.spinnerInterval) {\n      this.stopSpinnerAnimation();\n    }\n    if (!this.plainMode) {\n      this.renderPrompt();\n    }\n  }\n\n  /**\n   * Clear pinned loading UI and return to dynamic status rendering.\n   */\n  clearPinnedStatus(): void {\n    this.pinnedStatus = null;\n    if (this.mode === 'streaming') {\n      this.startSpinnerAnimation();\n    }\n    if (!this.plainMode) {\n      this.renderPrompt();\n    }\n  }\n\n  /**\n   * Start the animated spinner for streaming status\n   */\n  private startSpinnerAnimation(): void {\n    if (this.pinnedStatus) {\n      return; // Keep loading UI static to avoid flicker\n    }\n    if (this.spinnerInterval) return; // Already running\n    this.spinnerFrame = 0;\n    this.activityStarFrame = 0;\n    this.elapsedColorFrame = 0;\n    this.spinnerInterval = setInterval(() => {\n      this.spinnerFrame = (this.spinnerFrame + 1) % spinnerFrames.braille.length;\n      this.activityStarFrame = (this.activityStarFrame + 1) % this.activityStarFrames.length;\n      // Update elapsed time color animation (slower cycle)\n      if (this.spinnerFrame % 3 === 0) {\n        this.elapsedColorFrame = (this.elapsedColorFrame + 1) % this.elapsedColorFrames.length;\n      }\n      // Re-render to show updated spinner/star frame\n      if (!this.plainMode && this.mode === 'streaming') {\n        this.renderPrompt();\n      }\n    }, 120); // ~8 FPS - reduced from 80ms to minimize flickering while keeping animation smooth\n  }\n\n  /**\n   * Stop the animated spinner\n   */\n  private stopSpinnerAnimation(): void {\n    if (this.spinnerInterval) {\n      clearInterval(this.spinnerInterval);\n      this.spinnerInterval = null;\n    }\n    this.spinnerFrame = 0;\n    this.activityStarFrame = 0;\n    this.activityMessage = null;\n    this.elapsedColorFrame = 0;\n  }\n\n  /**\n   * Set the activity message displayed with animated star\n   * Example: \"Ruminating…\" shows as \"✳ Ruminating… (esc to interrupt · 34s · ↑1.2k)\"\n   */\n  setActivity(message: string | null): void {\n    this.activityMessage = message;\n    if (!this.plainMode) {\n      this.renderPrompt();\n    }\n  }\n\n  /**\n   * Update the token count displayed in the activity line\n   */\n  updateStreamingTokens(tokens: number): void {\n    this.streamingTokens = tokens;\n  }\n\n  /**\n   * Format token count as compact string (e.g., 1.2k, 24k, 128k)\n   */\n  private formatTokenCount(tokens: number): string {\n    if (tokens < 1000) return String(tokens);\n    if (tokens < 10000) return `${(tokens / 1000).toFixed(1)}k`;\n    return `${Math.round(tokens / 1000)}k`;\n  }\n\n  getMode(): 'idle' | 'streaming' {\n    return this.mode;\n  }\n\n  updateStatus(message: string | null): void {\n    this.updateStatusBundle({ main: message, override: null, streaming: null });\n  }\n\n  updateStatusBundle(\n    status: { main?: string | null; override?: string | null; streaming?: string | null },\n    options: { render?: boolean } = {}\n  ): void {\n    const prevStreaming = this.statusStreaming;\n    let changed = false;\n    let mainChanged = false;\n    let overrideChanged = false;\n\n    if (status.main !== undefined && status.main !== this.statusMessage) {\n      this.statusMessage = status.main;\n      changed = true;\n      mainChanged = true;\n    }\n    if (status.override !== undefined && status.override !== this.statusOverride) {\n      this.statusOverride = status.override;\n      changed = true;\n      overrideChanged = true;\n    }\n\n    const streamingChanged = status.streaming !== undefined && status.streaming !== prevStreaming;\n    if (status.streaming !== undefined) {\n      if (streamingChanged) {\n        changed = true;\n      }\n      this.statusStreaming = status.streaming;\n    }\n\n    const streamingIntroduce =\n      streamingChanged && prevStreaming === null && status.streaming !== null && this.mode === 'streaming';\n    const streamingCleared =\n      streamingChanged && status.streaming === null && this.mode === 'streaming';\n    const onlyStreamingChanged = streamingChanged && !mainChanged && !overrideChanged;\n    const skipStreamingRender =\n      onlyStreamingChanged && this.mode === 'streaming' && !streamingIntroduce && !streamingCleared;\n\n    const shouldRender = options.render !== false && changed && !skipStreamingRender;\n    if (shouldRender) {\n      this.renderPrompt();\n    }\n  }\n\n  updateStatusMeta(\n    meta: {\n      model?: string;\n      provider?: string;\n      sessionTime?: string;\n      contextPercent?: number;\n      profile?: string;\n      workspace?: string;\n      directory?: string;\n      writes?: string;\n      sessionLabel?: string;\n      thinkingLabel?: string;\n      autosave?: boolean;\n      version?: string;\n      author?: string;\n      toolSummary?: string;\n    },\n    options: { render?: boolean } = {}\n  ): void {\n    const next = { ...this.statusMeta, ...meta };\n    const changed = JSON.stringify(next) !== JSON.stringify(this.statusMeta);\n    this.statusMeta = next;\n    const shouldRender = options.render !== false && changed;\n    if (shouldRender) {\n      this.renderPrompt();\n    }\n  }\n\n  updateModeToggles(state: Partial<ModeToggleState>): void {\n    this.toggleState = { ...this.toggleState, ...state };\n    if (\n      !state.verificationHotkey &&\n      !state.thinkingHotkey &&\n      !state.criticalApprovalHotkey &&\n      !state.autoContinueHotkey &&\n      !state.dualRlHotkey &&\n      !state.debugHotkey\n    ) {\n      this.hotkeysInToggleLine.clear();\n    }\n    this.renderPrompt();\n  }\n\n  /**\n   * Update RL agent execution status for display in the UI.\n   * Called during dual-RL mode to show active agent, module/step progress, and win statistics.\n   */\n  updateRLStatus(status: Partial<RLAgentStatus>): void {\n    const next = { ...this.rlStatus, ...status };\n    const changed = JSON.stringify(next) !== JSON.stringify(this.rlStatus);\n    this.rlStatus = next;\n    if (changed) {\n      this.renderPrompt();\n    }\n  }\n\n  /**\n   * Clear RL agent status (e.g., when RL run completes).\n   */\n  clearRLStatus(): void {\n    this.rlStatus = {};\n    this.renderPrompt();\n  }\n\n  /**\n   * Get current RL status for external access.\n   */\n  getRLStatus(): Readonly<RLAgentStatus> {\n    return this.rlStatus;\n  }\n\n  setInlinePanel(lines: string[]): void {\n    const normalized = (lines ?? []).map(line => line.replace(/\\s+$/g, ''));\n    const hasContent = normalized.some((line) => line.trim().length > 0);\n    if (!hasContent) {\n      if (this.inlinePanel.length) {\n        this.inlinePanel = [];\n        this.renderPrompt();\n      }\n      return;\n    }\n    const limited = this.limitInlinePanel(normalized);\n    if (JSON.stringify(limited) === JSON.stringify(this.inlinePanel)) {\n      return;\n    }\n    this.inlinePanel = limited;\n    this.renderPrompt();\n  }\n\n  supportsInlinePanel(): boolean {\n    return this.interactive && !this.plainMode;\n  }\n\n  clearInlinePanel(): void {\n    if (!this.inlinePanel.length) return;\n    this.inlinePanel = [];\n    this.renderPrompt();\n  }\n\n  /**\n   * Reset overlay state (prompt height/cached overlay) when terminal is externally cleared.\n   * Prevents duplicate stacked overlays after manual clear/cls.\n   */\n  resetOverlayState(): void {\n    this.lastOverlay = null;\n    this.lastOverlayRendered = null;\n    this.lastOverlayHeight = 0;\n    this.promptHeight = 0;\n    this.hasRenderedPrompt = false;\n    this.hasEverRenderedOverlay = false;\n    this.pendingRender = false;\n    this.lastRenderTime = 0;\n  }\n\n  // ------------ Convenience methods (Display compatibility) ------------\n\n  /**\n   * Write raw content directly to output.\n   * Convenience method for simple output without event processing.\n   */\n  writeRaw(content: string): void {\n    if (!content) return;\n    this.addEvent('raw', content);\n  }\n\n  /**\n   * Show an error message with optional error details.\n   */\n  showError(message: string, error?: unknown): void {\n    const normalized = message?.trim() ?? '';\n    const details = this.formatErrorDetails(error);\n    const parts = [`${theme.error('✗')} ${normalized || 'Error'}`];\n    if (details) {\n      parts.push(`  ${details}`);\n    }\n    this.addEvent('response', `${parts.join('\\n')}\\n`);\n  }\n\n  /**\n   * Show a system message.\n   */\n  showSystemMessage(content: string): void {\n    const normalized = content?.trim();\n    if (!normalized) return;\n    this.addEvent('response', `${normalized}\\n\\n`);\n  }\n\n  /**\n   * Show a success message.\n   */\n  showSuccess(message: string): void {\n    const normalized = message?.trim();\n    if (!normalized) return;\n    this.addEvent('response', `${theme.success('✓')} ${normalized}\\n`);\n  }\n\n  /**\n   * Show a warning message.\n   */\n  showWarning(message: string): void {\n    const normalized = message?.trim();\n    if (!normalized) return;\n    this.addEvent('response', `${theme.warning('!')} ${normalized}\\n`);\n  }\n\n  /**\n   * Show an info message.\n   */\n  showInfo(message: string): void {\n    const normalized = message?.trim();\n    if (!normalized) return;\n    this.addEvent('response', `${theme.info('ℹ')} ${normalized}\\n`);\n  }\n\n  /**\n   * Format error details for display.\n   */\n  private formatErrorDetails(error?: unknown): string | null {\n    if (!error) return null;\n    if (error instanceof Error) {\n      return error.stack || error.message;\n    }\n    if (typeof error === 'string') {\n      return error;\n    }\n    try {\n      return JSON.stringify(error, null, 2);\n    } catch {\n      return '[Unable to serialize error details]';\n    }\n  }\n\n  private limitInlinePanel(lines: string[]): string[] {\n    const maxLines = Math.max(4, Math.min(this.maxInlinePanelLines, Math.max(2, this.rows - 8)));\n    if (lines.length <= maxLines) {\n      return lines;\n    }\n    const overflow = lines.length - maxLines;\n    const indicator = theme.ui.muted(`… ${overflow} more lines`);\n    const tailCount = Math.max(1, maxLines - 1);\n    const tail = lines.slice(-tailCount);\n    return [indicator, ...tail];\n  }\n\n  // ------------ Prompt rendering ------------\n\n  private renderPrompt(): void {\n    // Don't render if disposed\n    if (this.disposed) return;\n\n    // Throttle renders to prevent excessive redraws during rapid input\n    const now = Date.now();\n    if (now - this.lastRenderTime < this.renderThrottleMs) {\n      if (!this.pendingRender) {\n        this.pendingRender = true;\n        // Track the timer for cleanup\n        this.renderThrottleTimer = setTimeout(() => {\n          this.renderThrottleTimer = null;\n          this.pendingRender = false;\n          if (!this.disposed) {\n            this.renderPromptImmediate();\n          }\n        }, this.renderThrottleMs);\n      }\n      return;\n    }\n    this.renderPromptImmediate();\n  }\n\n  private renderPromptImmediate(): void {\n    // Don't render if disposed\n    if (this.disposed) return;\n\n    this.lastRenderTime = Date.now();\n\n    if (!this.interactive) {\n      this.isPromptActive = false;\n      return;\n    }\n\n    if (this.promptRenderingSuspended) {\n      this.isPromptActive = false;\n      return;\n    }\n\n    if (this.plainMode) {\n      const line = `> ${this.buffer}`;\n      if (!this.isPromptActive && !this.lastOutputEndedWithNewline) {\n        this.write('\\n');\n        this.lastOutputEndedWithNewline = true;\n      }\n      this.write(`\\r${ESC.CLEAR_LINE}${line}`);\n      this.cursorVisibleColumn = line.length + 1;\n      this.hasRenderedPrompt = true;\n      this.isPromptActive = true;\n      this.lastOutputEndedWithNewline = false; // prompt ends mid-line by design\n      this.promptHeight = 1;\n      return;\n    }\n\n    if (!this.allowPromptRender) {\n      return;\n    }\n\n    // Rich inline mode: prompt flows naturally with content\n    this.updateTerminalSize();\n    const maxWidth = this.safeWidth();\n    this.lastRenderWidth = maxWidth;\n\n    const overlay = this.buildOverlayLines();\n    if (!overlay.lines.length) {\n      return;\n    }\n\n    const renderedLines = overlay.lines.map(line => this.truncateLine(line, maxWidth));\n    if (!renderedLines.length) {\n      return;\n    }\n\n    const promptIndex = Math.max(0, Math.min(overlay.promptIndex, renderedLines.length - 1));\n    const height = renderedLines.length;\n    const promptCol = Math.min(Math.max(1, 3 + this.cursor), this.cols || 80);\n\n    const overlayUnchanged =\n      this.lastOverlayRendered &&\n      this.arraysEqual(this.lastOverlayRendered.lines, renderedLines) &&\n      this.lastOverlayRendered.promptIndex === promptIndex &&\n      this.lastOverlayRendered.promptCol === promptCol;\n\n    // Fast path: overlay unchanged, just position cursor\n    if (overlayUnchanged) {\n      // Just ensure cursor is at prompt position - don't move around\n      this.write(`\\x1b[?25l\\x1b[${promptCol}G\\x1b[?25h`);\n      this.isPromptActive = true;\n      this.promptHeight = height;\n      this.lastOverlayHeight = height;\n      this.cursorVisibleColumn = promptCol;\n      return;\n    }\n\n    // Batch all ANSI operations into a single write to prevent flickering\n    const buffer: string[] = [];\n\n    // Hide cursor during render\n    buffer.push('\\x1b[?25l');\n\n    // STRATEGY: Use save/restore cursor position for reliability\n    // First, clear any existing overlay by moving up and clearing\n    const prevHeight = this.lastOverlayHeight || 0;\n    const prevPromptIdx = this.lastOverlay?.promptIndex ?? 0;\n\n    if (prevHeight > 0) {\n      // Move cursor up from current position (assumed to be at or below prompt row)\n      // to the TOP of the previous overlay\n      const upFromPrompt = prevPromptIdx;\n      if (upFromPrompt > 0) {\n        buffer.push(`\\x1b[${upFromPrompt}A`);\n      }\n\n      // Clear all previous overlay lines going down\n      for (let i = 0; i < prevHeight; i++) {\n        buffer.push(`\\r${ESC.CLEAR_LINE}`);\n        if (i < prevHeight - 1) {\n          buffer.push('\\x1b[B'); // move down\n        }\n      }\n\n      // Clear anything below (in case overlay shrunk)\n      buffer.push('\\x1b[J');\n\n      // Move back up to top of overlay area\n      if (prevHeight > 1) {\n        buffer.push(`\\x1b[${prevHeight - 1}A`);\n      }\n    }\n\n    // Now write the new overlay lines\n    for (let i = 0; i < renderedLines.length; i++) {\n      buffer.push(`\\r${ESC.CLEAR_LINE}`);\n      buffer.push(renderedLines[i] || '');\n      if (i < renderedLines.length - 1) {\n        buffer.push('\\n');\n      }\n    }\n\n    // Position cursor at prompt input position\n    // Cursor is now at the last line of the overlay\n    // Move up to the prompt row\n    const upToPrompt = height - 1 - promptIndex;\n    if (upToPrompt > 0) {\n      buffer.push(`\\x1b[${upToPrompt}A`);\n    }\n    buffer.push(`\\x1b[${promptCol}G`);\n\n    // Show cursor\n    buffer.push('\\x1b[?25h');\n\n    // Single atomic write\n    this.write(buffer.join(''));\n\n    // Update state\n    this.cursorVisibleColumn = promptCol;\n    this.hasRenderedPrompt = true;\n    this.hasEverRenderedOverlay = true;\n    this.isPromptActive = true;\n    this.lastOverlayHeight = height;\n    this.lastOverlay = { lines: renderedLines, promptIndex };\n    this.lastOverlayRendered = { lines: renderedLines, promptIndex, promptCol };\n    this.lastOutputEndedWithNewline = false;\n    this.promptHeight = height;\n  }\n\n  private buildOverlayLines(): { lines: string[]; promptIndex: number } {\n    // When pinned status is active, keep the initial loading UI layout regardless of state.\n    if (this.pinnedStatus) {\n      return this.buildPinnedLoadingOverlay();\n    }\n\n    const lines: string[] = [];\n    const maxWidth = this.safeWidth();\n    // Simple horizontal divider - clean and reliable\n    const divider = theme.ui.muted('─'.repeat(maxWidth));\n\n    const fallbackActivity = (() => {\n      const raw = this.statusStreaming || this.statusOverride || this.statusMessage;\n      if (!raw) return null;\n      const cleaned = this.stripAnsi(raw).replace(/^[⏺•]\\s*/, '').trim();\n      return cleaned || null;\n    })();\n\n    // Activity line (only when streaming) - shows: ◐ Working… (esc to interrupt · 34s)\n    if (this.mode === 'streaming' && (this.activityMessage || fallbackActivity)) {\n      // Clean spinner animation using braille dots + shimmer accent for a richer feel\n      const spinnerChars = spinnerFrames.braille;\n      const spinnerChar = spinnerChars[this.spinnerFrame % spinnerChars.length] ?? '⠋';\n      const starChar = this.activityStarFrames[this.activityStarFrame % this.activityStarFrames.length] ?? '✶';\n      const spinnerDecorated = `${theme.info(spinnerChar)}${theme.accent ? theme.accent(starChar) : starChar}`;\n      const elapsed = this.formatStreamingElapsed();\n      const genericActivities = ['Streaming', 'Thinking', 'Processing'];\n      let displayActivity = this.activityMessage || fallbackActivity || '';\n      if (genericActivities.includes(displayActivity) && fallbackActivity) {\n        displayActivity = fallbackActivity;\n      }\n      if (!displayActivity.trim()) {\n        displayActivity = fallbackActivity || 'Working';\n      }\n      const needsEllipsis = !displayActivity.trimEnd().endsWith('…') && !displayActivity.trimEnd().endsWith('...');\n      // Format: ⠋ Working… (esc to interrupt · 1m 19s · ↑1.2k tokens)\n      // Build parts with animated elapsed time color\n      const elapsedColor = chalk.hex(this.elapsedColorFrames[this.elapsedColorFrame % this.elapsedColorFrames.length] ?? '#F59E0B');\n      const parts: string[] = ['esc to interrupt'];\n      if (elapsed) parts.push(elapsedColor(elapsed));\n      if (this.streamingTokens > 0) {\n        parts.push(`↑${this.formatTokenCount(this.streamingTokens)} tokens`);\n      }\n      const prefix = `${spinnerDecorated} `;\n      const activityText = `${displayActivity.trim()}${needsEllipsis ? '…' : ''}`;\n      const suffix = ` ${theme.ui.muted('(')}${parts.join(theme.ui.muted(' · '))}${theme.ui.muted(')')}`;\n\n      // Build the full activity line with animated color for elapsed time\n      const activityLine = `${prefix}${activityText}${suffix}`;\n\n      // Always show full text - wrap to multiple lines if needed\n      const indent = ' '.repeat(this.visibleLength(prefix));\n      const wrapped = this.wrapOverlayLine(activityLine, maxWidth, indent);\n      lines.push(...wrapped);\n    }\n\n    // Top divider\n    lines.push(divider);\n\n    // Input prompt line\n    const promptIndex = lines.length;\n    const inputLine = this.buildInputLine();\n    // Handle multi-line input by splitting on newlines\n    // Filter out empty lines to prevent duplicate divider appearance from leading/trailing newlines\n    const inputLines = inputLine.split('\\n').filter((line, idx, arr) => {\n      // Keep non-empty lines, but preserve single empty line if it's intentional (e.g., between content)\n      // Only filter leading/trailing empty lines\n      if (line.trim() === '') {\n        // Filter if it's the first line (leading empty) or last line (trailing empty)\n        if (idx === 0 || idx === arr.length - 1) return false;\n      }\n      return true;\n    });\n    // Ensure at least one line for the prompt\n    if (inputLines.length === 0) {\n      inputLines.push(theme.primary('> '));\n    }\n    for (const line of inputLines) {\n      lines.push(this.truncateLine(line, maxWidth));\n    }\n\n    // Bottom divider\n    lines.push(divider);\n\n    // Inline panel (pinned scroll box for live output/menus)\n    if (this.inlinePanel.length > 0) {\n      for (const panelLine of this.inlinePanel) {\n        lines.push(this.truncateLine(`  ${panelLine}`, maxWidth));\n      }\n      // Separate inline content from suggestions/toggles\n      lines.push(divider);\n    }\n\n    // Slash command suggestions\n    if (this.suggestions.length > 0) {\n      for (let index = 0; index < this.suggestions.length; index++) {\n        const suggestion = this.suggestions[index]!;\n        const isActive = index === this.suggestionIndex;\n        const marker = isActive ? theme.primary('▸') : theme.ui.muted(' ');\n        const cmdText = isActive ? theme.primary(suggestion.command) : theme.ui.muted(suggestion.command);\n        const descText = isActive ? suggestion.description : theme.ui.muted(suggestion.description);\n        lines.push(this.truncateLine(`  ${marker} ${cmdText} — ${descText}`, maxWidth));\n      }\n    }\n\n    // Model and context info\n    const modelContextLine = this.buildModelContextLine();\n    if (modelContextLine) {\n      lines.push(this.truncateLine(`  ${modelContextLine}`, maxWidth));\n    }\n\n    // Status + meta block (includes dir/version/tool summary)\n    const chromeLines = this.buildChromeLines();\n    if (chromeLines.length) {\n      for (const chromeLine of chromeLines) {\n        lines.push(this.truncateLine(`  ${chromeLine}`, maxWidth));\n      }\n    }\n\n    // Mode toggles\n    const toggleLines = this.buildInlineToggleLine();\n    if (toggleLines.length > 0) {\n      for (const toggleLine of toggleLines) {\n        lines.push(this.truncateLine(`  ${toggleLine}`, maxWidth));\n      }\n      const legendLines = this.buildToggleLegend();\n      for (const legend of legendLines) {\n        lines.push(this.truncateLine(`  ${legend}`, maxWidth));\n      }\n    }\n\n    // Help hint\n    lines.push(this.truncateLine(`  ${theme.ui.muted('? for shortcuts')}`, maxWidth));\n\n    return { lines, promptIndex };\n  }\n\n  /**\n   * Render a minimal, stable overlay matching the initial loading UI.\n   * This suppresses dynamic overlays (activity, inline panels, suggestions, toggles)\n   * to avoid flicker during streaming/typing and keeps the banner-like chrome visible.\n   */\n  private buildPinnedLoadingOverlay(): { lines: string[]; promptIndex: number } {\n    const lines: string[] = [];\n    const maxWidth = this.safeWidth();\n    const divider = theme.ui.muted('─'.repeat(maxWidth));\n\n    // Status line with spinner when pinned\n    // Static status line: show loading text\n    const statusText = this.pinnedStatus?.text || UI_STRINGS.LOADING;\n    lines.push(this.truncateLine(`  ${theme.info('⠋')} ${theme.info(statusText)}`, maxWidth));\n\n    // Header line for version/author\n    const headerParts: string[] = [];\n    if (this.statusMeta.version) {\n      headerParts.push(theme.info(`v${this.statusMeta.version}`));\n    }\n    if (this.statusMeta.author) {\n      if (headerParts.length) headerParts.push(theme.ui.muted('•'));\n      headerParts.push(theme.ui.muted(this.statusMeta.author));\n    }\n    if (headerParts.length) {\n      lines.push(this.truncateLine(`  ${headerParts.join(' ')}`, maxWidth));\n    }\n\n    // Profile line\n    const profileParts: string[] = [];\n    if (this.statusMeta.profile) {\n      profileParts.push(theme.warning(this.statusMeta.profile));\n    }\n    if (profileParts.length) {\n      lines.push(this.truncateLine(`  ${profileParts.join(' ')}`, maxWidth));\n    }\n\n    // Model/provider line (static)\n    const model = this.statusMeta.model ? theme.info(this.statusMeta.model) : null;\n    const provider = this.statusMeta.provider ? theme.ui.muted(this.statusMeta.provider) : null;\n    const modelLine = [model, provider].filter(Boolean).join(theme.ui.muted('  ·  '));\n    if (modelLine) {\n      lines.push(this.truncateLine(`  ${modelLine}`, maxWidth));\n    }\n\n    // Quick commands and hint (static to mirror first-load UI)\n    lines.push(this.truncateLine(`  ${theme.ui.muted('💡 /model    🔑 /secrets    ❓ /help    🐛 /debug')}`, maxWidth));\n    lines.push(this.truncateLine(`  ${theme.ui.muted('hint: type a prompt to start, /help for commands, or -q for headless runs')}`, maxWidth));\n\n    // Divider and prompt line\n    lines.push(divider);\n\n    const inputLine = this.buildInputLine();\n    const inputLines = inputLine.split('\\n').filter((line, idx, arr) => {\n      if (line.trim() === '' && (idx === 0 || idx === arr.length - 1)) return false;\n      return true;\n    });\n    const promptIndex = lines.length;\n    for (const line of inputLines) {\n      lines.push(this.truncateLine(line, maxWidth));\n    }\n\n    // Bottom divider to preserve spacing\n    lines.push(divider);\n\n    return { lines, promptIndex };\n  }\n\n  /**\n   * Build model name and context usage line with mini progress bar\n   * Format: gpt-4 · ████░░ 85% context\n   */\n  private buildModelContextLine(): string | null {\n    const parts: string[] = [];\n\n    // Model name (provider / model or just model)\n    const model = this.statusMeta.provider && this.statusMeta.model\n      ? `${this.statusMeta.provider} · ${this.statusMeta.model}`\n      : this.statusMeta.model || this.statusMeta.provider;\n    if (model) {\n      parts.push(theme.info(model));\n    }\n\n    // Context meter with mini progress bar (shows used percentage, not remaining)\n    if (this.statusMeta.contextPercent !== undefined) {\n      const used = clampPercentage(this.statusMeta.contextPercent);\n      const barWidth = 6;\n      const filled = Math.round((used / 100) * barWidth);\n      const empty = Math.max(0, barWidth - filled);\n      // Color based on how full the context is (green=low usage, yellow=medium, red=high)\n      const barColor = getContextColor(used, {\n        error: theme.error,\n        warning: theme.warning,\n        info: theme.info,\n        success: theme.success,\n      });\n      const bar = barColor('█'.repeat(filled)) + theme.ui.muted('░'.repeat(empty));\n      parts.push(`${bar} ${barColor(`${used}%`)} ${theme.ui.muted('ctx')}`);\n    }\n\n    return parts.length > 0 ? parts.join(theme.ui.muted('  ·  ')) : null;\n  }\n\n  /**\n   * Build inline toggle controls - Claude Code style\n   * Format: ⏵⏵ accept edits on (shift+tab to cycle)\n   * Returns wrapped lines to ensure all toggles (including RL) are visible below the chat box.\n   */\n  /**\n   * Build unified toggle status line with color-coded states and integrated explanations.\n   * Each toggle has a distinct color for easy identification.\n   */\n  private buildInlineToggleLine(): string[] {\n    const autoContinueActive = this.toggleState.autoContinueEnabled ?? false;\n    const verificationActive = this.toggleState.verificationEnabled ?? false;\n    const approvalMode = this.toggleState.criticalApprovalMode || 'auto';\n    const thinkingLabel = (this.toggleState.thinkingModeLabel || 'balanced').trim().toLowerCase();\n\n    // Build unified toggle segments with DISTINCT colors for each toggle\n    const toggles: string[] = [];\n\n    // 1. RL mode (CYAN) - multi-agent vs single-pass\n    const rlOn = this.toggleState.dualRlEnabled;\n    const rlIcon = rlOn ? '🤖' : '⚡';\n    const rlStatus = rlOn ? theme.info('dual') : theme.ui.muted('single');\n    const rlExplain = rlOn ? 'multi-agent' : 'one-pass';\n    toggles.push(`${rlIcon} ${rlStatus} ${theme.ui.muted('[⌥D]')} ${theme.ui.muted(rlExplain)}`);\n\n    // 2. Auto-continue (MAGENTA/PURPLE) - keep going until done\n    const contIcon = autoContinueActive ? '🔄' : '⏸';\n    const contStatus = autoContinueActive ? theme.primary('loop') : theme.ui.muted('stop');\n    const contExplain = autoContinueActive ? 'until done' : 'each response';\n    toggles.push(`${contIcon} ${contStatus} ${theme.ui.muted('[⌥G]')} ${theme.ui.muted(contExplain)}`);\n\n    // 3. Verify (YELLOW) - auto-tests after edits\n    const verifyIcon = verificationActive ? '✓' : '○';\n    const verifyStatus = verificationActive ? theme.warning('test') : theme.ui.muted('skip');\n    const verifyExplain = verificationActive ? 'auto-test' : 'no tests';\n    toggles.push(`${verifyIcon} ${verifyStatus} ${theme.ui.muted('[⌥V]')} ${theme.ui.muted(verifyExplain)}`);\n\n    // 4. Approvals (GREEN/ORANGE) - auto or ask for permission\n    const apprIcon = approvalMode === 'approval' ? '🛡' : '✔';\n    const apprStatus = approvalMode === 'approval' ? theme.warning('ask') : theme.success('auto');\n    const apprExplain = approvalMode === 'approval' ? 'confirm all' : 'auto-approve';\n    toggles.push(`${apprIcon} ${apprStatus} ${theme.ui.muted('[⌥A]')} ${theme.ui.muted(apprExplain)}`);\n\n    // 5. Thinking (BLUE) - balanced or deep reasoning\n    const thinkingIsDeep = thinkingLabel === 'extended' || thinkingLabel === 'deep';\n    const thinkIcon = thinkingIsDeep ? '🧠' : '💭';\n    const thinkStatus = thinkingIsDeep ? theme.info('deep') : theme.ui.muted('quick');\n    const thinkExplain = thinkingIsDeep ? 'thorough' : 'concise';\n    toggles.push(`${thinkIcon} ${thinkStatus} ${theme.ui.muted('[TAB]')} ${theme.ui.muted(thinkExplain)}`);\n\n    // 6. Debug logging indicator (RED) - toggle shows whether console logging is enabled\n    const debugActive = this.toggleState.debugEnabled ?? false;\n    const debugIcon = debugActive ? '🐞' : '🔍';\n    const debugStatus = debugActive ? theme.warning('debug on') : theme.ui.muted('debug off');\n    const debugExplain = debugActive ? 'verbose logs' : 'silent';\n    toggles.push(`${debugIcon} ${debugStatus} ${theme.ui.muted('[/debug]')} ${theme.ui.muted(debugExplain)}`);\n\n    // 7. Shortcut hint\n    toggles.push(`${theme.ui.muted('? help')}`);\n\n    const maxWidth = Math.max(10, this.safeWidth() - 2);\n    return this.wrapSegments(toggles, maxWidth);\n  }\n\n  /**\n   * @deprecated Legend is now integrated into buildInlineToggleLine for unified display\n   */\n  private buildToggleLegend(): string[] {\n    // Legend explanations now integrated directly into toggle line\n    return [];\n  }\n\n  private buildChromeLines(): string[] {\n    const maxWidth = this.safeWidth();\n    const statusLines = this.buildStatusBlock(maxWidth);\n    const metaLines = this.buildMetaBlock(maxWidth);\n    return [...statusLines, ...metaLines];\n  }\n\n  private abbreviatePath(pathValue: string): string {\n    const home = homedir();\n    if (home && pathValue.startsWith(home)) {\n      return pathValue.replace(home, '~');\n    }\n    return pathValue;\n  }\n\n  private buildStatusBlock(maxWidth: number): string[] {\n    const statusLabel = this.composeStatusLabel();\n    if (!statusLabel) {\n      return [];\n    }\n\n    // Pinned mode uses a minimal, static status line to avoid flicker.\n    if (this.pinnedStatus) {\n      return [this.truncateLine(`${theme.info('⠋')} ${this.applyTone(statusLabel.text, statusLabel.tone)}`, maxWidth)];\n    }\n\n    const segments: string[] = [];\n\n    // Add animated spinner when streaming\n    const showSpinner = this.mode === 'streaming';\n    if (showSpinner) {\n      const spinnerChars = spinnerFrames.braille;\n      const spinnerChar = spinnerChars[this.spinnerFrame % spinnerChars.length] ?? '⠋';\n      segments.push(`${theme.info(spinnerChar)} ${this.applyTone(statusLabel.text, statusLabel.tone)}`);\n    } else {\n      segments.push(`${theme.ui.muted('status')} ${this.applyTone(statusLabel.text, statusLabel.tone)}`);\n    }\n\n    if (this.statusMeta.sessionTime) {\n      segments.push(`${theme.ui.muted('runtime')} ${theme.ui.muted(this.statusMeta.sessionTime)}`);\n    }\n\n    if (this.statusMeta.contextPercent !== undefined) {\n      // Use animated context meter for smooth color transitions\n      this.contextMeter.update(this.statusMeta.contextPercent);\n      segments.push(this.contextMeter.render());\n    }\n\n    return this.wrapSegments(segments, maxWidth);\n  }\n\n  private buildMetaBlock(maxWidth: number): string[] {\n    const segments: string[] = [];\n\n    if (this.statusMeta.profile) {\n      segments.push(this.formatMetaSegment('profile', this.statusMeta.profile, 'info'));\n    }\n\n    const model = this.statusMeta.provider && this.statusMeta.model\n      ? `${this.statusMeta.provider} / ${this.statusMeta.model}`\n      : this.statusMeta.model || this.statusMeta.provider;\n    if (model) {\n      segments.push(this.formatMetaSegment('model', model, 'info'));\n    }\n\n    const workspace = this.statusMeta.workspace || this.statusMeta.directory;\n    if (workspace) {\n      segments.push(this.formatMetaSegment('dir', this.abbreviatePath(workspace), 'muted'));\n    }\n\n    if (this.statusMeta.writes) {\n      segments.push(this.formatMetaSegment('writes', this.statusMeta.writes, 'muted'));\n    }\n\n    if (this.statusMeta.toolSummary) {\n      segments.push(this.formatMetaSegment('tools', this.statusMeta.toolSummary, 'muted'));\n    }\n\n    if (this.statusMeta.sessionLabel) {\n      segments.push(this.formatMetaSegment('session', this.statusMeta.sessionLabel, 'muted'));\n    }\n\n    if (this.statusMeta.version) {\n      segments.push(this.formatMetaSegment('build', `v${this.statusMeta.version}`, 'muted'));\n    }\n\n    // Add RL agent status when dual-RL mode is active\n    const rlSegments = this.buildRLStatusSegments();\n    if (rlSegments.length > 0) {\n      segments.push(...rlSegments);\n    }\n\n    if (segments.length === 0) {\n      return [];\n    }\n\n    return this.wrapSegments(segments, maxWidth);\n  }\n\n  /**\n   * Build RL agent status segments for display during dual-RL execution.\n   * Shows: tournament scoreboard, active agent, module/step progress, and scores.\n   */\n  private buildRLStatusSegments(): string[] {\n    const segments: string[] = [];\n    const rl = this.rlStatus;\n\n    // Only show RL status when there's meaningful data\n    if (!rl.activeVariant && !rl.wins && !rl.currentModule) {\n      return segments;\n    }\n\n    // Tournament scoreboard (always show when wins exist)\n    if (rl.wins && (rl.wins.primary > 0 || rl.wins.refiner > 0 || rl.wins.ties > 0)) {\n      const totalGames = rl.wins.primary + rl.wins.refiner + rl.wins.ties;\n      const leader = rl.wins.primary > rl.wins.refiner ? 'primary' :\n                     rl.wins.refiner > rl.wins.primary ? 'refiner' : 'tie';\n\n      // Scoreboard with colors based on leader\n      const pColor = leader === 'primary' ? theme.success : theme.info;\n      const rColor = leader === 'refiner' ? theme.success : theme.warning;\n      const pScore = pColor(`${rl.wins.primary}`);\n      const rScore = rColor(`${rl.wins.refiner}`);\n\n      // Trophy for leader\n      const trophy = leader === 'primary' ? theme.info('🏆') :\n                     leader === 'refiner' ? theme.warning('🏆') : '⚖️';\n\n      // Win streak indicator\n      const streakText = rl.streak && rl.streak > 1 ? theme.ui.muted(` 🔥${rl.streak}`) : '';\n\n      segments.push(`${trophy}${pScore}${theme.ui.muted(':')}${rScore}${streakText}`);\n\n      // Progress bar showing relative wins\n      if (totalGames > 0) {\n        const barWidth = 8;\n        const pBars = Math.round((rl.wins.primary / totalGames) * barWidth);\n        const rBars = Math.round((rl.wins.refiner / totalGames) * barWidth);\n        const tBars = Math.max(0, barWidth - pBars - rBars);\n        const bar = theme.info('█'.repeat(pBars)) +\n                    theme.ui.muted('░'.repeat(tBars)) +\n                    theme.warning('█'.repeat(rBars));\n        segments.push(`[${bar}]`);\n      }\n    }\n\n    // Active variant indicator\n    if (rl.activeVariant) {\n      const isParallel = rl.parallelExecution;\n      if (isParallel) {\n        // Both running in parallel\n        segments.push(`${theme.info('⚡P')} ${theme.ui.muted('∥')} ${theme.warning('⚡R')}`);\n      } else {\n        const variantIcon = rl.activeVariant === 'primary' ? '▶' : '▷';\n        const variantLabel = rl.activeVariant === 'primary' ? 'P' : 'R';\n        const variantColor = rl.activeVariant === 'primary' ? theme.info : theme.warning;\n        segments.push(`${variantIcon}${variantColor(variantLabel)}`);\n      }\n    }\n\n    // Last winner indicator\n    if (rl.lastWinner && rl.lastWinner !== 'tie') {\n      const winnerIcon = rl.lastWinner === 'primary' ? theme.info('✓P') : theme.warning('✓R');\n      segments.push(winnerIcon);\n    } else if (rl.lastWinner === 'tie') {\n      segments.push(theme.ui.muted('≈'));\n    }\n\n    // Current module/step (compact)\n    if (rl.currentModule || rl.currentStep) {\n      const stepText = rl.currentStep || rl.currentModule || '';\n      if (stepText) {\n        segments.push(theme.ui.muted(this.truncateMiddle(stepText, 15)));\n      }\n    }\n\n    // Progress indicator (steps completed / total)\n    if (typeof rl.stepsCompleted === 'number' && typeof rl.totalSteps === 'number' && rl.totalSteps > 0) {\n      const pct = Math.round((rl.stepsCompleted / rl.totalSteps) * 100);\n      segments.push(theme.ui.muted(`${pct}%`));\n    }\n\n    // Current reward scores (compact, only during active comparison)\n    if (rl.scores && (typeof rl.scores.primary === 'number' || typeof rl.scores.refiner === 'number')) {\n      const pScore = typeof rl.scores.primary === 'number' ? rl.scores.primary.toFixed(2) : '-';\n      const rScore = typeof rl.scores.refiner === 'number' ? rl.scores.refiner.toFixed(2) : '-';\n      const pVal = rl.scores.primary ?? 0;\n      const rVal = rl.scores.refiner ?? 0;\n      const pDisplay = pVal > rVal ? theme.success(pScore) : theme.info(pScore);\n      const rDisplay = rVal > pVal ? theme.success(rScore) : theme.warning(rScore);\n      segments.push(`${pDisplay}${theme.ui.muted('/')}${rDisplay}`);\n    }\n\n    // Human accuracy indicator (relative ranking quality)\n    if (rl.accuracy && (typeof rl.accuracy.primary === 'number' || typeof rl.accuracy.refiner === 'number')) {\n      const pAcc = rl.accuracy.primary !== undefined ? Math.round(rl.accuracy.primary * 100) : null;\n      const rAcc = rl.accuracy.refiner !== undefined ? Math.round(rl.accuracy.refiner * 100) : null;\n      const pDisplay = pAcc !== null ? theme.info(`P${pAcc}%`) : null;\n      const rDisplay = rAcc !== null ? theme.warning(`R${rAcc}%`) : null;\n      const parts = [pDisplay, rDisplay].filter(Boolean).join(theme.ui.muted('|'));\n      if (parts) {\n        segments.push(parts);\n      }\n    }\n\n    return segments;\n  }\n\n  /**\n   * Truncate a string in the middle, showing start and end with ellipsis.\n   */\n  private truncateMiddle(text: string, maxLen: number): string {\n    if (text.length <= maxLen) return text;\n    const keepLen = Math.floor((maxLen - 3) / 2);\n    return `${text.slice(0, keepLen)}...${text.slice(-keepLen)}`;\n  }\n\n  private composeStatusLabel(): { text: string; tone: 'success' | 'info' | 'warn' | 'error' } | null {\n    if (this.pinnedStatus) {\n      return { text: this.pinnedStatus.text, tone: this.pinnedStatus.tone };\n    }\n\n    const statuses = [this.statusStreaming, this.statusOverride, this.statusMessage].filter(\n      (value, index, arr): value is string => Boolean(value) && arr.indexOf(value) === index\n    );\n    const text = statuses.length > 0 ? statuses.join(' / ') : 'Ready for prompts';\n    if (!text.trim()) {\n      return null;\n    }\n    const normalized = text.toLowerCase();\n    const tone: 'success' | 'info' | 'warn' | 'error' = normalized.includes('ready') ? 'success' : 'info';\n    return { text, tone };\n  }\n\n  private formatMetaSegment(\n    label: string,\n    value: string,\n    tone: 'info' | 'success' | 'warn' | 'error' | 'muted'\n  ): string {\n    const colorizer =\n      tone === 'success'\n        ? theme.success\n        : tone === 'warn'\n          ? theme.warning\n          : tone === 'error'\n            ? theme.error\n            : tone === 'muted'\n              ? theme.ui.muted\n              : theme.info;\n    return `${theme.ui.muted(label)} ${colorizer(value)}`;\n  }\n\n  private applyTone(text: string, tone: 'success' | 'info' | 'warn' | 'error'): string {\n    switch (tone) {\n      case 'success':\n        return theme.success(text);\n      case 'warn':\n        return theme.warning(text);\n      case 'error':\n        return theme.error(text);\n      case 'info':\n      default:\n        return theme.info(text);\n    }\n  }\n\n  private wrapSegments(segments: string[], maxWidth: number): string[] {\n    const lines: string[] = [];\n    const separator = theme.ui.muted('  |  ');\n\n    let current = '';\n    for (const segment of segments) {\n      const normalized = segment.trim();\n      if (!normalized) continue;\n      if (!current) {\n        current = this.truncateLine(normalized, maxWidth);\n        continue;\n      }\n      const candidate = `${current}${separator}${normalized}`;\n      if (this.visibleLength(candidate) <= maxWidth) {\n        current = candidate;\n      } else {\n        lines.push(this.truncateLine(current, maxWidth));\n        current = this.truncateLine(normalized, maxWidth);\n      }\n    }\n\n    if (current) {\n      lines.push(this.truncateLine(current, maxWidth));\n    }\n\n    return lines;\n  }\n\n  private arraysEqual(a: string[], b: string[]): boolean {\n    if (a.length !== b.length) return false;\n    for (let i = 0; i < a.length; i++) {\n      if (a[i] !== b[i]) return false;\n    }\n    return true;\n  }\n\n  private buildControlLines(): string[] {\n    const lines: string[] = [];\n    const toggleLine = this.buildToggleLine();\n    if (toggleLine) {\n      lines.push(`${theme.ui.muted('modes')} ${theme.ui.muted('›')} ${toggleLine}`);\n    }\n\n    const shortcutLine = this.buildShortcutLine();\n    if (shortcutLine) {\n      lines.push(`${theme.ui.muted('keys')}  ${shortcutLine}`);\n    }\n\n    return lines;\n  }\n\n  /**\n   * Build a compact toggle line like Claude Code:\n   * \"⏵⏵ accept edits on (shift+tab to cycle)\"\n   */\n  private buildCompactToggleLine(): string | null {\n    // Show the most relevant mode based on current state\n    const parts: string[] = [];\n    const verificationActive = this.toggleState.verificationEnabled || this.toggleState.autoContinueEnabled;\n\n    // Edit mode indicator\n    const editIcon = '⏵⏵';\n    const editState = verificationActive ? 'approval required' : 'accept edits';\n    parts.push(`${theme.ui.muted(editIcon)} ${editState} ${theme.success('on')}`);\n\n    // Thinking mode (if active)\n    const thinkingLabel = (this.toggleState.thinkingModeLabel || '').trim().toLowerCase();\n    if (thinkingLabel && thinkingLabel !== 'off') {\n      parts.push(`${theme.ui.muted('thinking')} ${theme.info(thinkingLabel)}`);\n    }\n\n    // Cycle hint\n    const cycleHint = theme.ui.muted('(shift+tab to cycle)');\n\n    if (parts.length === 0) {\n      return null;\n    }\n\n    return `  ${parts.join(theme.ui.muted(' · '))} ${cycleHint}`;\n  }\n\n  private buildToggleLine(): string | null {\n    const toggles: Array<{\n      label: string;\n      on: boolean;\n      value?: string;\n      hotkey?: string | null;\n    }> = [];\n\n    const addToggle = (label: string, on: boolean, hotkey?: string, value?: string) => {\n      toggles.push({ label, on, hotkey: this.formatHotkey(hotkey), value });\n    };\n\n    const autoVerifyActive = this.toggleState.autoContinueEnabled ?? false;\n    const verificationActive = this.toggleState.verificationEnabled || autoVerifyActive;\n    const verifyValue = autoVerifyActive\n      ? 'auto'\n      : verificationActive\n        ? 'on'\n        : 'off';\n\n    addToggle('Verify', verificationActive, this.toggleState.verificationHotkey, verifyValue);\n    const approvalMode = this.toggleState.criticalApprovalMode || 'auto';\n    const approvalActive = approvalMode !== 'auto';\n    addToggle(\n      'Approvals',\n      approvalActive,\n      this.toggleState.criticalApprovalHotkey,\n      approvalMode === 'auto' ? 'auto' : 'ask'\n    );\n\n    const autoContinueActive = autoVerifyActive;\n    addToggle(\n      'Auto-continue',\n      autoContinueActive,\n      this.toggleState.autoContinueHotkey,\n      autoContinueActive ? 'auto-verify' : 'off'\n    );\n\n    const thinkingLabelRaw = (this.toggleState.thinkingModeLabel || 'balanced').trim();\n    const thinkingLabel =\n      thinkingLabelRaw.toLowerCase() === 'extended' ? 'deep' : thinkingLabelRaw || 'balanced';\n    const thinkingActive = thinkingLabel.length > 0;\n    addToggle('Thinking', thinkingActive, this.toggleState.thinkingHotkey, thinkingLabel);\n\n    const dualRlActive = this.toggleState.dualRlEnabled ?? false;\n    const modeValue = dualRlActive ? 'dual-rl-cont' : 'single-cont';\n    addToggle('Mode', dualRlActive, this.toggleState.dualRlHotkey, modeValue);\n\n    const buildLine = (includeHotkeys: boolean): string => {\n      return toggles\n        .map(toggle => {\n          const stateText = toggle.on ? theme.success(toggle.value || 'on') : theme.ui.muted(toggle.value || 'off');\n          const hotkeyText =\n            includeHotkeys && toggle.hotkey ? theme.ui.muted(` [${toggle.hotkey}]`) : '';\n          return `${theme.ui.muted(`${toggle.label}:`)} ${stateText}${hotkeyText}`;\n        })\n        .join(theme.ui.muted('  '));\n    };\n\n    const maxWidth = this.safeWidth();\n    let line = buildLine(true);\n\n    // Record which hotkeys are actually shown so the shortcut line can avoid duplicates\n    this.hotkeysInToggleLine = new Set(\n      toggles\n        .map(toggle => (toggle.hotkey ? toggle.hotkey : null))\n        .filter((key): key is string => Boolean(key))\n    );\n\n    // If the line is too wide, drop hotkey hints to preserve all toggle labels\n    if (this.visibleLength(line) > maxWidth) {\n      this.hotkeysInToggleLine.clear();\n      line = buildLine(false);\n    }\n\n    return line.trim() ? line : null;\n  }\n\n  private buildShortcutLine(): string | null {\n    const parts: string[] = [];\n\n    const addHotkey = (label: string, combo?: string) => {\n      const normalized = this.formatHotkey(combo);\n      if (!normalized) return;\n      if (this.hotkeysInToggleLine.has(normalized)) {\n        return;\n      }\n      parts.push(`${theme.info(normalized)} ${theme.ui.muted(label)}`);\n    };\n\n    // Core controls\n    addHotkey('interrupt', 'Ctrl+C');\n    addHotkey('clear input', 'Ctrl+U');\n\n    // Feature toggles (only if hotkeys are defined)\n    addHotkey('verify', this.toggleState.verificationHotkey);\n    addHotkey('auto-continue', this.toggleState.autoContinueHotkey);\n    addHotkey('thinking', this.toggleState.thinkingHotkey);\n    addHotkey('mode', this.toggleState.dualRlHotkey);\n\n    if (parts.length === 0) {\n      return null;\n    }\n    return parts.join(theme.ui.muted('   '));\n  }\n\n\n  private buildInputLine(): string {\n    if (this.collapsedPaste) {\n      const summary = `[pasted ${this.collapsedPaste.lines} lines, ${this.collapsedPaste.charDisplay} chars] (Enter/Ctrl+L insert, Backspace discard)`;\n      return this.truncateLine(`${theme.primary('> ')}${theme.ui.muted(summary)}`, this.safeWidth());\n    }\n\n    // Claude Code uses simple '>' prompt\n    const prompt = theme.primary('> ');\n    const promptWidth = this.visibleLength(prompt);\n    const maxWidth = this.safeWidth();\n    const continuationIndent = '  '; // 2 spaces for continuation lines\n    const continuationWidth = continuationIndent.length;\n\n    // Handle multi-line input - split buffer on newlines first\n    // In secret mode, mask all characters with bullets\n    const rawBuffer = this.buffer.replace(/\\r/g, '\\n');\n    const normalized = this.secretMode ? '•'.repeat(rawBuffer.length) : rawBuffer;\n    const bufferLines = normalized.split('\\n');\n\n    // Wrap each logical line to fit terminal width, expanding vertically\n    const result: string[] = [];\n    let totalChars = 0;\n    let cursorLine = 0;\n    let cursorCol = 0;\n    let foundCursor = false;\n\n    for (let lineIndex = 0; lineIndex < bufferLines.length; lineIndex++) {\n      const line = bufferLines[lineIndex] ?? '';\n      const isFirstLogicalLine = lineIndex === 0;\n      const lineStartChar = totalChars;\n\n      // Determine available width for this line\n      const firstLineWidth = maxWidth - promptWidth;\n      const contLineWidth = maxWidth - continuationWidth;\n\n      // Wrap this logical line into display lines\n      let remaining = line;\n      let isFirstDisplayLine = true;\n\n      while (remaining.length > 0 || isFirstDisplayLine) {\n        const availableWidth = (isFirstLogicalLine && isFirstDisplayLine) ? firstLineWidth : contLineWidth;\n        const chunk = remaining.slice(0, availableWidth);\n        remaining = remaining.slice(availableWidth);\n\n        // Build the display line\n        let displayLine: string;\n        if (isFirstLogicalLine && isFirstDisplayLine) {\n          displayLine = `${prompt}${chunk}`;\n        } else {\n          displayLine = `${continuationIndent}${chunk}`;\n        }\n\n        // Track cursor position\n        if (!foundCursor) {\n          const chunkStart = lineStartChar + (line.length - remaining.length - chunk.length);\n          const chunkEnd = chunkStart + chunk.length;\n          if (this.cursor >= chunkStart && this.cursor <= chunkEnd) {\n            cursorLine = result.length;\n            const offsetInChunk = this.cursor - chunkStart;\n            cursorCol = ((isFirstLogicalLine && isFirstDisplayLine) ? promptWidth : continuationWidth) + offsetInChunk;\n            foundCursor = true;\n          }\n        }\n\n        result.push(displayLine);\n        isFirstDisplayLine = false;\n\n        // If nothing left and this was an empty line, we already added it\n        if (remaining.length === 0 && chunk.length === 0) break;\n      }\n\n      totalChars += line.length + 1; // +1 for the newline separator\n    }\n\n    // Handle cursor at very end\n    if (!foundCursor) {\n      cursorLine = Math.max(0, result.length - 1);\n      const lastLine = result[cursorLine] ?? '';\n      cursorCol = this.visibleLength(lastLine);\n    }\n\n    // Add cursor highlight to the appropriate position\n    if (result.length > 0) {\n      const targetLine = result[cursorLine] ?? '';\n      const visiblePart = this.stripAnsi(targetLine);\n      const cursorPos = Math.min(cursorCol, visiblePart.length);\n\n      // Rebuild the line with cursor highlight\n      const before = visiblePart.slice(0, cursorPos);\n      const at = visiblePart.charAt(cursorPos) || ' ';\n      const after = visiblePart.slice(cursorPos + 1);\n\n      // Preserve the prompt/indent styling\n      const prefix = cursorLine === 0 ? prompt : continuationIndent;\n      const textPart = cursorLine === 0 ? before.slice(promptWidth) : before.slice(continuationWidth);\n      result[cursorLine] = `${prefix}${textPart}${ESC.REVERSE}${at}${ESC.RESET}${after}`;\n    }\n\n    // Store cursor column for terminal positioning\n    this.cursorVisibleColumn = cursorCol + 1;\n\n    return result.join('\\n');\n  }\n\n  private buildInputWindow(available: number): { text: string; cursor: number } {\n    if (available <= 0) {\n      return { text: '', cursor: 0 };\n    }\n\n    if (this.collapsedPaste) {\n      return { text: '', cursor: 0 };\n    }\n\n    const normalized = this.buffer.replace(/\\r/g, '\\n');\n    const cursorIndex = Math.min(this.cursor, normalized.length);\n\n    let offset = this.inputRenderOffset;\n    if (cursorIndex < offset) {\n      offset = cursorIndex;\n    }\n    const overflow = cursorIndex - offset - available + 1;\n    if (overflow > 0) {\n      offset += overflow;\n    }\n    const maxOffset = Math.max(0, normalized.length - available);\n    if (offset > maxOffset) {\n      offset = maxOffset;\n    }\n    this.inputRenderOffset = offset;\n\n    const window = normalized.slice(offset, offset + available);\n    const display = window.split('').map(char => (char === '\\n' ? NEWLINE_PLACEHOLDER : char)).join('');\n    const cursorInWindow = Math.min(display.length, Math.max(0, cursorIndex - offset));\n\n    const before = display.slice(0, cursorInWindow);\n    const at = display.charAt(cursorInWindow) || ' ';\n    const after = display.slice(cursorInWindow + 1);\n\n    return {\n      text: `${before}${ESC.REVERSE}${at}${ESC.RESET}${after}`,\n      cursor: cursorInWindow,\n    };\n  }\n\n  /**\n   * Expand collapsed paste into the buffer without submitting (Ctrl+L).\n   * Allows user to edit the pasted content before submission.\n   * Preserves any existing text that was in the buffer before the paste.\n   */\n  private expandCollapsedPasteToBuffer(): void {\n    if (!this.collapsedPaste) return;\n    const pasteText = this.collapsedPaste.text;\n    const prePasteBuffer = this.collapsedPaste.prePasteBuffer;\n    const prePasteCursor = this.collapsedPaste.prePasteCursor;\n    this.collapsedPaste = null;\n    // Insert pasted content at the original cursor position, preserving existing text\n    const before = prePasteBuffer.slice(0, prePasteCursor);\n    const after = prePasteBuffer.slice(prePasteCursor);\n    this.buffer = before + pasteText + after;\n    this.cursor = before.length + pasteText.length;\n    this.updateSuggestions();\n    this.renderPrompt();\n    this.emitInputChange();\n  }\n\n  /**\n   * Expand collapsed paste and submit immediately (Enter).\n   * Used when user wants to send the pasted content as-is.\n   * Combines any existing text that was in the buffer before the paste.\n   */\n  private expandCollapsedPaste(): void {\n    if (!this.collapsedPaste) return;\n    const pasteText = this.collapsedPaste.text;\n    const prePasteBuffer = this.collapsedPaste.prePasteBuffer;\n    const prePasteCursor = this.collapsedPaste.prePasteCursor;\n    this.collapsedPaste = null;\n    // Combine existing text with pasted content at the original cursor position\n    const before = prePasteBuffer.slice(0, prePasteCursor);\n    const after = prePasteBuffer.slice(prePasteCursor);\n    const combinedText = before + pasteText + after;\n    // Clear the buffer first to avoid any visual duplication\n    this.buffer = '';\n    this.cursor = 0;\n    this.updateSuggestions();\n    this.renderPrompt();\n    this.emitInputChange();\n    // Submit the combined content (displayUserPrompt is called within submitText for non-slash commands)\n    this.submitText(combinedText);\n  }\n\n  captureInput(options: { allowEmpty?: boolean; trim?: boolean; resetBuffer?: boolean } = {}): Promise<string> {\n    if (this.inputCapture) {\n      return Promise.reject(new Error('Input capture already in progress'));\n    }\n\n    if (options.resetBuffer) {\n      this.buffer = '';\n      this.cursor = 0;\n      this.inputRenderOffset = 0;\n      this.resetSuggestions();\n      this.renderPrompt();\n      this.emitInputChange();\n    }\n\n    return new Promise<string>((resolve, reject) => {\n      this.inputCapture = {\n        resolve,\n        reject,\n        options: {\n          trim: options.trim !== false,\n          allowEmpty: options.allowEmpty ?? false,\n        },\n      };\n    });\n  }\n\n  private cancelInputCapture(reason?: unknown): void {\n    if (!this.inputCapture) {\n      return;\n    }\n    const capture = this.inputCapture;\n    this.inputCapture = null;\n    capture.reject?.(reason ?? new Error('Input capture cancelled'));\n  }\n\n\n  // ------------ Helpers ------------\n\n  private wrapOverlayLine(text: string, width: number, indent: string): string[] {\n    const words = text.split(/(\\s+)/);\n    const lines: string[] = [];\n    let current = '';\n\n    for (const word of words) {\n      const next = current + word;\n      if (this.visibleLength(next) > width && current.trim()) {\n        // Don't truncate - just push the line as-is (it fits within width)\n        lines.push(current.trimEnd());\n        current = indent + word.trimStart();\n      } else {\n        current = next;\n      }\n    }\n\n    if (current.trim()) {\n      lines.push(current.trimEnd());\n    }\n\n    // If no lines were produced, return the original text without truncation\n    return lines.length ? lines : [text];\n  }\n\n  private safeWidth(): number {\n    const cols = this.output.isTTY ? this.cols || 80 : 80;\n    return Math.max(1, cols - 1);\n  }\n\n  private visibleLength(value: string): number {\n    if (!value) return 0;\n    return this.stripAnsi(value).length;\n  }\n\n  private stripAnsi(value: string): string {\n    if (!value) return '';\n    // eslint-disable-next-line no-control-regex\n    return value.replace(/\\u001B\\[[0-?]*[ -/]*[@-~]/g, '');\n  }\n\n  private truncateLine(value: string, width: number): string {\n    if (!value) return '';\n    const limit = Math.max(1, width);\n    // eslint-disable-next-line no-control-regex\n    const tokens = value.split(/(\\x1b\\[[0-9;]*m)/u);\n    let visible = 0;\n    let truncated = false;\n    let result = '';\n\n    for (const token of tokens) {\n      if (!token) continue;\n      // eslint-disable-next-line no-control-regex\n      if (/^\\x1b\\[[0-9;]*m$/u.test(token)) {\n        result += token;\n        continue;\n      }\n      if (visible >= limit) {\n        truncated = true;\n        continue;\n      }\n      const remaining = limit - visible;\n      if (token.length <= remaining) {\n        result += token;\n        visible += token.length;\n      } else {\n        const sliceLength = Math.max(0, remaining - 1);\n        if (sliceLength > 0) {\n          result += token.slice(0, sliceLength);\n          visible += sliceLength;\n        }\n        result += '…';\n        truncated = true;\n        break;\n      }\n    }\n\n    if (truncated && !result.endsWith(ESC.RESET)) {\n      result += ESC.RESET;\n    }\n\n    return result;\n  }\n\n  getBuffer(): string {\n    return this.buffer;\n  }\n\n  getCursor(): number {\n    return this.cursor;\n  }\n\n  setBuffer(text: string, cursorPos?: number): void {\n    this.buffer = text;\n    // Validate cursor position to prevent out-of-bounds issues\n    const requestedCursor = cursorPos ?? text.length;\n    this.cursor = Math.max(0, Math.min(requestedCursor, text.length));\n    this.inputRenderOffset = 0;\n    this.updateSuggestions();\n    this.renderPrompt();\n    this.emitInputChange();\n  }\n\n  setSecretMode(enabled: boolean): void {\n    this.secretMode = enabled;\n    this.renderPrompt();\n  }\n\n  clearBuffer(): void {\n    this.cancelPlainPasteCapture();\n    this.buffer = '';\n    this.cursor = 0;\n    this.inputRenderOffset = 0;\n    this.suggestions = [];\n    this.suggestionIndex = -1;\n    this.renderPrompt();\n    this.emitInputChange();\n  }\n\n  setModeStatus(status: string | null): void {\n    this.updateStatus(status);\n  }\n\n  /**\n   * Show a compacting status with animated spinner (Claude Code style)\n   * Uses ✻ character with animation to indicate context compaction in progress\n   */\n  showCompactingStatus(message: string): void {\n    this.statusMessage = message;\n    if (!this.spinnerInterval) {\n      this.spinnerInterval = setInterval(() => {\n        this.spinnerFrame++;\n        // Cycle activity phrase every ~4 seconds (50 frames at 80ms)\n        if (this.spinnerFrame % 50 === 0) {\n          this.activityPhraseIndex++;\n        }\n        this.renderPrompt();\n      }, 80);\n    }\n    this.renderPrompt();\n  }\n\n  /**\n   * Hide the compacting status and stop spinner animation\n   */\n  hideCompactingStatus(): void {\n    if (this.spinnerInterval) {\n      clearInterval(this.spinnerInterval);\n      this.spinnerInterval = null;\n    }\n    this.statusMessage = null;\n    this.renderPrompt();\n  }\n\n  emitPrompt(content: string): void {\n    this.pushPromptEvent(content);\n  }\n\n  /**\n   * Display user prompt immediately in scrollback (Claude Code style)\n   * Writes synchronously to ensure it appears ONCE in scrollback before status updates.\n   * The prompt input area will then float below this and all subsequent events.\n   */\n  private displayUserPrompt(text: string): void {\n    const normalized = text?.trim();\n    if (!normalized) return;\n\n    // Prevent duplicate prompt display within 1.5 seconds\n    const now = Date.now();\n    if (this.lastPromptEvent && this.lastPromptEvent.text === normalized && now - this.lastPromptEvent.at < 1500) {\n      return;\n    }\n    this.lastPromptEvent = { text: normalized, at: now };\n\n    // Add to event queue instead of writing directly to ensure proper rendering\n    this.addEvent('prompt', normalized);\n  }\n\n  render(): void {\n    this.renderPrompt();\n  }\n\n  private delay(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  // ------------ Low-level helpers ------------\n\n  private write(data: string): void {\n    this.output.write(data);\n  }\n\n  private pushPromptEvent(text: string): void {\n    const normalized = text?.trim();\n    if (!normalized) {\n      return;\n    }\n    const now = Date.now();\n    if (this.lastPromptEvent && this.lastPromptEvent.text === normalized && now - this.lastPromptEvent.at < 1500) {\n      return;\n    }\n    this.lastPromptEvent = { text: normalized, at: now };\n    this.addEvent('prompt', normalized);\n  }\n\n  private clearPromptArea(): void {\n    if (this.pinnedStatus) {\n      return; // Never clear overlay while loading UI is pinned\n    }\n    const height = this.lastOverlayHeight || this.promptHeight || 0;\n    if (height === 0) return;\n\n    // Cursor should be at prompt row within the overlay.\n    // Move up to top of overlay first.\n    const promptIdx = this.lastOverlay?.promptIndex ?? 0;\n    if (promptIdx > 0) {\n      this.write(`\\x1b[${promptIdx}A`);\n    }\n\n    // Now at top, clear each line downward\n    for (let i = 0; i < height; i++) {\n      this.write(`\\r${ESC.CLEAR_LINE}`);\n      if (i < height - 1) {\n        this.write('\\x1b[B'); // Move down\n      }\n    }\n\n    // Clear anything that might be below\n    this.write('\\x1b[J');\n\n    // After clearing, cursor is at the last cleared line.\n    // Move back up to the top (where new content should start).\n    if (height > 1) {\n      this.write(`\\x1b[${height - 1}A`);\n    }\n    this.write('\\r');\n\n    // Reset overlay state completely\n    this.lastOverlay = null;\n    this.lastOverlayRendered = null;\n    this.promptHeight = 0;\n    this.lastOverlayHeight = 0;\n    this.isPromptActive = false;\n    this.hasEverRenderedOverlay = false;\n  }\n\n  private updateTerminalSize(): void {\n    if (this.output.isTTY) {\n      this.rows = this.output.rows || 24;\n      this.cols = this.output.columns || 80;\n    }\n  }\n}\n"],"mappings":";;;;;;AAWA,IAAAA,QAAA,GAAAC,uBAAA,CAAAC,OAAA;AACA,IAAAC,WAAA,GAAAD,OAAA;AACA,IAAAE,OAAA,GAAAF,OAAA;AACA,IAAAG,MAAA,GAAAC,sBAAA,CAAAJ,OAAA;AACA,IAAAK,MAAA,GAAAL,OAAA;AACA,IAAAM,WAAA,GAAAN,OAAA;AACA,IAAAO,eAAA,GAAAP,OAAA;AACA,IAAAQ,YAAA,GAAAR,OAAA;AACA,IAAAS,YAAA,GAAAT,OAAA;AAI0B,SAAAI,uBAAAM,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAAA,SAAAX,wBAAAW,CAAA,EAAAG,CAAA,6BAAAC,OAAA,MAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAf,uBAAA,YAAAA,CAAAW,CAAA,EAAAG,CAAA,SAAAA,CAAA,IAAAH,CAAA,IAAAA,CAAA,CAAAC,UAAA,SAAAD,CAAA,MAAAO,CAAA,EAAAC,CAAA,EAAAC,CAAA,KAAAC,SAAA,QAAAR,OAAA,EAAAF,CAAA,iBAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,SAAAS,CAAA,MAAAF,CAAA,GAAAJ,CAAA,GAAAG,CAAA,GAAAD,CAAA,QAAAE,CAAA,CAAAI,GAAA,CAAAX,CAAA,UAAAO,CAAA,CAAAK,GAAA,CAAAZ,CAAA,GAAAO,CAAA,CAAAM,GAAA,CAAAb,CAAA,EAAAS,CAAA,gBAAAN,CAAA,IAAAH,CAAA,gBAAAG,CAAA,OAAAW,cAAA,CAAAC,IAAA,CAAAf,CAAA,EAAAG,CAAA,OAAAK,CAAA,IAAAD,CAAA,GAAAS,MAAA,CAAAC,cAAA,KAAAD,MAAA,CAAAE,wBAAA,CAAAlB,CAAA,EAAAG,CAAA,OAAAK,CAAA,CAAAI,GAAA,IAAAJ,CAAA,CAAAK,GAAA,IAAAN,CAAA,CAAAE,CAAA,EAAAN,CAAA,EAAAK,CAAA,IAAAC,CAAA,CAAAN,CAAA,IAAAH,CAAA,CAAAG,CAAA,WAAAM,CAAA,KAAAT,CAAA,EAAAG,CAAA;AAvB1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAiEA;AACA;AACA;;AA0BA,MAAMgB,GAAG,GAAG;EACVC,WAAW,EAAE,WAAW;EACxBC,WAAW,EAAE,WAAW;EACxBC,YAAY,EAAE,SAAS;EACvBC,UAAU,EAAE,SAAS;EACrBC,IAAI,EAAE,QAAQ;EACdC,sBAAsB,EAAE,aAAa;EACrCC,uBAAuB,EAAE,aAAa;EACtCC,EAAE,EAAEA,CAACC,GAAW,EAAEC,GAAW,KAAK,QAAQD,GAAG,IAAIC,GAAG,GAAG;EACvDC,MAAM,EAAGD,GAAW,IAAK,QAAQA,GAAG,GAAG;EACvCE,UAAU,EAAE,QAAQ;EACpBC,OAAO,EAAE,SAAS;EAClBC,KAAK,EAAE,SAAS;EAChB;EACAC,iBAAiB,EAAEA,CAACC,GAAW,EAAEC,MAAc,KAAK,QAAQD,GAAG,IAAIC,MAAM,GAAG;EAC5EC,mBAAmB,EAAE,QAAQ;EAC7BC,WAAW,EAAE,QAAQ;EACrBC,cAAc,EAAE;AAClB,CAAU;AAEV,MAAMC,mBAAmB,GAAG,GAAG;AAExB,MAAMC,iBAAiB,SAASC,wBAAY,CAAC;EAO1CC,IAAI,GAAG,EAAE;EACTC,IAAI,GAAG,EAAE;EACTC,eAAe,GAAkB,IAAI;EAErCC,UAAU,GAAc,EAAE;EAC1BC,iBAAiB,GAAG,KAAK;EAEzBC,MAAM,GAAG,EAAE;EACXC,MAAM,GAAG,CAAC;EACVC,OAAO,GAAa,EAAE;EACtBC,YAAY,GAAG,CAAC,CAAC;EACjBC,WAAW,GAAkE,EAAE;EAC/EC,eAAe,GAAG,CAAC,CAAC;EACpBC,iBAAiB,GAA4B,EAAE;EAC/CC,mBAAmB,GAAgB,IAAIC,GAAG,CAAC,CAAC;EAC5CC,cAAc,GAAoI,IAAI;EAEtJC,IAAI,GAAyB,MAAM;EACnCC,cAAc,GAAkB,IAAI;EAC5C;EACQC,oBAAoB,GAKvB,EAAE;EACUC,mBAAmB,GAAG,EAAE;EACzC;EACQC,YAAY,GAAW,EAAE;EACzBC,kBAAkB,GAAkB,IAAI;EACxCC,aAAa,GAAkBC,uBAAU,CAACC,OAAO;EACjDC,cAAc,GAAkB,IAAI;EACpCC,eAAe,GAAkB,IAAI;EAC7C;EACQC,YAAY,GAAyE,IAAI;;EAEjG;EACQC,gBAAgB,GAA2B,IAAI;EAC/CC,iBAAiB,GAA6B,IAAI;EAElDC,YAAY,GAAG,CAAC;EAChBC,eAAe,GAA0B,IAAI;EACpCC,mBAAmB,GAAG,EAAE;;EAEzC;EACQC,uBAAuB,GAAG,EAAE;EAC5BC,qBAAqB,GAAG,CAAC;EACzBC,wBAAwB,GAA0B,IAAI;EAC7CC,uBAAuB,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;;EAE/D;EACQC,eAAe,GAAkB,IAAI;EACrCC,mBAAmB,GAAG,CAAC;EACvBC,iBAAiB,GAAG,CAAC;EACZC,kBAAkB,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;EACpE;EACQC,eAAe,GAAG,CAAC;EAC3B;EACQC,iBAAiB,GAAG,CAAC;EACZC,kBAAkB,GAAG,CAAC,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,CAAC;EACxG;EACiBC,kBAAkB,GAAG,CACpC,UAAU,EAAE,YAAY,EAAE,WAAW,EAAE,SAAS,EAAE,WAAW,CAC9D;EACgBC,wBAAwB,GAAG,CAAC;EAC5BC,wBAAwB,GAAG,IAAI;EAC/BC,oBAAoB,GAAG,KAAK;EACrCC,kBAAkB,GAAwC,IAAI;EAE9DC,UAAU,GAed,CAAC,CAAC;EACEC,WAAW,GAAoB;IACrCC,mBAAmB,EAAE,KAAK;IAC1BC,mBAAmB,EAAE,KAAK;IAC1BC,oBAAoB,EAAE,MAAM;IAC5BC,aAAa,EAAE,KAAK;IACpBC,YAAY,EAAE;EAChB,CAAC;;EAED;EACQC,QAAQ,GAAkB,CAAC,CAAC;;EAEpC;;EAEA;EACQC,WAAWA,CAAA,EAAS;IAC1B,IAAI,CAAClD,MAAM,GAAGmD,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACE,GAAG,CAAC,IAAI,CAACrD,MAAM,EAAE,IAAI,CAACD,MAAM,CAACuD,MAAM,CAAC,CAAC;EACtE;;EAEA;EACQC,mBAAmBA,CAACxD,MAA8B,EAAEyD,IAAY,EAAQ;IAC9E,IAAI,IAAI,CAACC,mBAAmB,EAAE,OAAO,CAAC;IACtC,MAAMC,OAAO,GAAG3D,MAAM,KAAK,OAAO,GAAG,IAAI,CAAC4D,WAAW,GAAG,IAAI,CAACC,gBAAgB;IAC7E,MAAMC,SAAS,GAAG,IAAI,CAACC,kBAAkB,GAAGJ,OAAO,CAACJ,MAAM;IAC1D,IAAIO,SAAS,IAAI,CAAC,EAAE;MAClB,IAAI,CAACJ,mBAAmB,GAAG,IAAI;MAC/B;IACF;IACA,MAAMM,KAAK,GAAGP,IAAI,CAACF,MAAM,IAAIO,SAAS,GAAGL,IAAI,GAAGA,IAAI,CAACQ,KAAK,CAAC,CAAC,EAAEH,SAAS,CAAC;IACxE,IAAI9D,MAAM,KAAK,OAAO,EAAE;MACtB,IAAI,CAAC4D,WAAW,IAAII,KAAK;IAC3B,CAAC,MAAM;MACL,IAAI,CAACH,gBAAgB,IAAIG,KAAK;IAChC;IACA,IAAIA,KAAK,CAACT,MAAM,GAAGE,IAAI,CAACF,MAAM,EAAE;MAC9B,IAAI,CAACG,mBAAmB,GAAG,IAAI;IACjC;EACF;;EAEA;EACQQ,oBAAoBA,CAACT,IAAY,EAAU;IACjD;IACA;IACA;IACA,IAAIU,SAAS,GAAGV,IAAI,CAACW,OAAO,CAAC,2EAA2E,EAAE,EAAE,CAAC;IAC7G;IACAD,SAAS,GAAGA,SAAS,CAACC,OAAO,CAAC,YAAY,EAAE,EAAE,CAAC;IAC/C;IACA;IACAD,SAAS,GAAGA,SAAS,CAACC,OAAO,CAAC,gBAAgB,EAAE,EAAE,CAAC;;IAEnD;IACA;IACA;IACA;IACA;IACA;IACA;IACAD,SAAS,GAAGA,SAAS,CAACC,OAAO,CAAC,8DAA8D,EAAE,EAAE,CAAC;;IAEjG;IACA;IACAD,SAAS,GAAGA,SAAS,CAACC,OAAO,CAAC,0CAA0C,EAAE,GAAG,CAAC;;IAE9E;IACA;IACAD,SAAS,GAAGA,SAAS,CAACC,OAAO,CAAC,mCAAmC,EAAE,EAAE,CAAC;IAEtE,OAAOD,SAAS;EAClB;EAEQE,YAAYA,CAACC,KAAc,EAAiB;IAClD,IAAI,CAACA,KAAK,EAAEC,IAAI,CAAC,CAAC,EAAE,OAAO,IAAI;IAC/B,OAAOD,KAAK,CAACC,IAAI,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;EACnC;EAEQC,eAAe,GAAwC,IAAI;EAE3DC,YAAY,GAAG,CAAC;EAChBC,iBAAiB,GAAG,CAAC;EACrBC,WAAW,GAAa,EAAE;EAC1BC,sBAAsB,GAAG,KAAK;EAC9BC,cAAc,GAAG,KAAK;EACtBC,iBAAiB,GAAG,CAAC;EACZC,gBAAgB,GAAG,EAAE;EACrBC,kBAAkB,GAAG,EAAE;EACvBC,sBAAsB,GAAG,EAAE;EAC3BC,2BAA2B,GAAG,CAAC,CAAC,CAAC;EAClD;EACiBpB,kBAAkB,GAAG,EAAE,GAAG,IAAI,GAAG,IAAI,CAAC,CAAC;EAChDL,mBAAmB,GAAG,KAAK,CAAC,CAAC;EAC7B0B,mBAAmB,GAAG,CAAC;EACvBC,gBAAgB,GAAG,KAAK;EACxBzB,WAAW,GAAG,EAAE;EAChB0B,YAAY,GAAG,KAAK;EACpBzB,gBAAgB,GAAG,EAAE;EACrB0B,eAAe,GAA0B,IAAI;EAC7CC,qBAAqB,GAAG,CAAC;EACzBC,mBAAmB,GAAG,CAAC;EACvBC,iBAAiB,GAAwC,EAAE;EACnE;EACQC,mBAAmB,GAAG,EAAE;EACxBC,kBAAkB,GAA0B,IAAI;EACvCC,oBAAoB,GAAG,EAAE,CAAC,CAAC;EACpCC,oBAAoB,GAAkB,IAAI;EAC1CC,0BAA0B,GAAG,IAAI;EACjCC,iBAAiB,GAAG,KAAK;EACzBC,sBAAsB,GAAG,KAAK,CAAC,CAAE;EACjCC,WAAW,GAAoD,IAAI;EACnEC,mBAAmB,GAAuE,IAAI;EAC9FC,iBAAiB,GAAG,IAAI;EACxBC,wBAAwB,GAAG,KAAK;EAChCC,UAAU,GAAG,KAAK;EAC1B;EACQC,aAAa,GAAG,KAAK;EACrBC,cAAc,GAAG,CAAC;EACTC,gBAAgB,GAAG,EAAE,CAAC,CAAC;EAChCC,mBAAmB,GAA0B,IAAI;EACzD;EACQC,QAAQ,GAAG,KAAK;EACxB;EACQC,kBAAkB,GAAwB,IAAI;EAC9CC,oBAAoB,GAAsD,IAAI;EAC9EC,YAAY,GAMT,IAAI;EAEfC,WAAWA,CACTC,MAA0B,GAAGC,OAAO,CAACC,MAAM,EAC3CC,KAAwB,GAAGF,OAAO,CAACG,KAAK,EACxCC,QAAmC,EACnC;IACA,KAAK,CAAC,CAAC;IACP,IAAI,CAACL,MAAM,GAAGA,MAAM;IACpB,IAAI,CAACG,KAAK,GAAGA,KAAK;IAClB,IAAI,CAACG,WAAW,GAAGC,OAAO,CAAC,IAAI,CAACP,MAAM,CAACQ,KAAK,IAAI,IAAI,CAACL,KAAK,CAACK,KAAK,IAAI,CAACP,OAAO,CAACQ,GAAG,CAAC,IAAI,CAAC,CAAC;IACvF,IAAI,CAACC,SAAS,GAAG,IAAAC,6BAAiB,EAAC,CAAC,IAAI,CAAC,IAAI,CAACL,WAAW;;IAEzD;IACA,IAAI,CAACM,YAAY,GAAG,IAAIC,4BAAY,CAAC,CAAC;IAEtC,IAAI,CAACC,EAAE,GAAG1L,QAAQ,CAAC2L,eAAe,CAAC;MACjCZ,KAAK,EAAE,IAAI,CAACA,KAAK;MACjBH,MAAM,EAAE,IAAI,CAACA,MAAM;MACnBgB,QAAQ,EAAE,IAAI;MACdC,MAAM,EAAE,EAAE;MACVC,OAAO,EAAE;IACX,CAAC,CAAC;IACF,IAAI,CAACJ,EAAE,CAACK,SAAS,CAAC,EAAE,CAAC;IACrB,IAAI,CAACC,kBAAkB,CAAC,CAAC;;IAEzB;IACA,IAAI,CAACxB,kBAAkB,GAAG,MAAM;MAC9B,IAAI,CAAC,IAAI,CAACc,SAAS,IAAI,CAAC,IAAI,CAACf,QAAQ,EAAE;QACrC,IAAI,CAACyB,kBAAkB,CAAC,CAAC;QACzB,IAAI,CAACC,YAAY,CAAC,CAAC;MACrB;IACF,CAAC;IACD,IAAI,CAACrB,MAAM,CAACsB,EAAE,CAAC,QAAQ,EAAE,IAAI,CAAC1B,kBAAkB,CAAC;IAEjD,IAAI,CAAC2B,kBAAkB,CAAC,CAAC;EAC3B;EAEAC,UAAUA,CAAA,EAAS;IACjB,IAAI,CAAC,IAAI,CAAClB,WAAW,EAAE;MACrB;IACF;;IAEA;IACA,IAAI,CAACtH,MAAM,GAAG,EAAE;IAChB,IAAI,CAACC,MAAM,GAAG,CAAC;IACf,IAAI,CAAC8E,iBAAiB,GAAG,CAAC;IAC1B,IAAI,CAACM,gBAAgB,GAAG,KAAK;IAC7B,IAAI,CAACzB,WAAW,GAAG,EAAE;IACrB,IAAI,CAACF,mBAAmB,GAAG,KAAK;IAChC,IAAI,CAAC4B,YAAY,GAAG,KAAK;IACzB,IAAI,CAACzB,gBAAgB,GAAG,EAAE;IAC1B,IAAI,CAACpD,cAAc,GAAG,IAAI;IAC1B,IAAI,CAACkF,mBAAmB,GAAG,EAAE;IAC7B,IAAI,CAAC8C,uBAAuB,CAAC,CAAC;IAE9B,IAAI,CAAC,IAAI,CAACf,SAAS,EAAE;MACnB;MACA;MACA,IAAI,IAAI,CAAC1B,iBAAiB,IAAI,IAAI,CAACE,WAAW,EAAE;QAC9C,IAAI,CAACwC,eAAe,CAAC,CAAC;MACxB;MACA,IAAI,CAACC,KAAK,CAACxK,GAAG,CAACM,sBAAsB,CAAC;MACtC,IAAI,CAAC2J,kBAAkB,CAAC,CAAC;MACzB,IAAI,CAACpC,iBAAiB,GAAG,KAAK;MAC9B,IAAI,CAACD,0BAA0B,GAAG,IAAI;MACtC,IAAI,CAAC4C,KAAK,CAACxK,GAAG,CAACE,WAAW,CAAC;MAC3B;IACF;;IAEA;IACA,IAAI,CAAC+J,kBAAkB,CAAC,CAAC;IACzB,IAAI,CAACpC,iBAAiB,GAAG,KAAK;IAC9B,IAAI,CAACD,0BAA0B,GAAG,IAAI;IACtC,IAAI,CAACsC,YAAY,CAAC,CAAC;EACrB;EAEAO,OAAOA,CAAA,EAAS;IACd;IACA,IAAI,CAACjC,QAAQ,GAAG,IAAI;IAEpB,IAAI,CAACkC,kBAAkB,CAAC,IAAIC,KAAK,CAAC,mBAAmB,CAAC,CAAC;IACvD,IAAI,CAACL,uBAAuB,CAAC,CAAC;;IAE9B;IACA,IAAI,IAAI,CAAC/B,mBAAmB,EAAE;MAC5BqC,YAAY,CAAC,IAAI,CAACrC,mBAAmB,CAAC;MACtC,IAAI,CAACA,mBAAmB,GAAG,IAAI;IACjC;;IAEA;IACA,IAAI,IAAI,CAACjF,eAAe,EAAE;MACxBuH,aAAa,CAAC,IAAI,CAACvH,eAAe,CAAC;MACnC,IAAI,CAACA,eAAe,GAAG,IAAI;IAC7B;IACA,IAAI,IAAI,CAACH,gBAAgB,EAAE;MACzB,IAAI,CAACA,gBAAgB,CAAC2H,IAAI,CAAC,CAAC;MAC5B,IAAI,CAAC3H,gBAAgB,GAAG,IAAI;IAC9B;IACA,IAAI,IAAI,CAACC,iBAAiB,EAAE;MAC1B,IAAI,CAACA,iBAAiB,CAAC0H,IAAI,CAAC,CAAC;MAC7B,IAAI,CAAC1H,iBAAiB,GAAG,IAAI;IAC/B;IACA,IAAI,CAACqG,YAAY,CAACsB,OAAO,CAAC,CAAC;IAC3B,IAAAC,iCAAiB,EAAC,CAAC;;IAEnB;IACA,IAAI,IAAI,CAACvC,kBAAkB,EAAE;MAC3B,IAAI,CAACI,MAAM,CAACoC,cAAc,CAAC,QAAQ,EAAE,IAAI,CAACxC,kBAAkB,CAAC;MAC7D,IAAI,CAACA,kBAAkB,GAAG,IAAI;IAChC;IACA,IAAI,IAAI,CAACC,oBAAoB,EAAE;MAC7B,IAAI,CAACM,KAAK,CAACiC,cAAc,CAAC,UAAU,EAAE,IAAI,CAACvC,oBAAoB,CAAC;MAChE,IAAI,CAACA,oBAAoB,GAAG,IAAI;IAClC;;IAEA;IACA,IAAI,CAACwC,kBAAkB,CAAC,CAAC;IAEzB,IAAI,CAAC,IAAI,CAAC/B,WAAW,EAAE;MACrB,IAAI,CAACQ,EAAE,CAACwB,KAAK,CAAC,CAAC;MACf;IACF;IAEA,IAAI,CAAC,IAAI,CAAC5B,SAAS,EAAE;MACnB;MACA,IAAI,CAACgB,eAAe,CAAC,CAAC;MACtB,IAAI,CAACC,KAAK,CAACxK,GAAG,CAACO,uBAAuB,CAAC;MACvC,IAAI,CAACiK,KAAK,CAACxK,GAAG,CAACE,WAAW,CAAC;MAC3B,IAAI,CAACsK,KAAK,CAAC,IAAI,CAAC;IAClB;IACA,IAAI,IAAI,CAACxB,KAAK,CAACK,KAAK,EAAE;MACpB,IAAI,CAACL,KAAK,CAACoC,UAAU,CAAC,KAAK,CAAC;IAC9B;IACA,IAAI,CAACzB,EAAE,CAACwB,KAAK,CAAC,CAAC;IACf,IAAI,CAACpD,WAAW,GAAG,IAAI;;IAEvB;IACA,IAAI,CAACpG,UAAU,GAAG,EAAE;EACtB;EAEA0J,sBAAsBA,CAAA,EAAS;IAC7B,IAAI,CAACnD,wBAAwB,GAAG,IAAI;EACtC;EAEAoD,qBAAqBA,CAACC,MAAe,GAAG,KAAK,EAAQ;IACnD,IAAI,CAACrD,wBAAwB,GAAG,KAAK;IACrC,IAAIqD,MAAM,EAAE;MACV,IAAI,CAACrB,YAAY,CAAC,CAAC;IACrB;EACF;;EAEA;;EAEQE,kBAAkBA,CAAA,EAAS;IACjC,IAAI,CAAC,IAAI,CAACjB,WAAW,EAAE;MACrB;IACF;IACA,IAAI,CAACQ,EAAE,CAACuB,kBAAkB,CAAC,MAAM,CAAC;IAClCjN,QAAQ,CAACuN,kBAAkB,CAAC,IAAI,CAACxC,KAAK,EAAE,IAAI,CAACW,EAAE,CAAC;IAChD,IAAI,IAAI,CAACX,KAAK,CAACK,KAAK,EAAE;MACpB,IAAI,CAACL,KAAK,CAACoC,UAAU,CAAC,IAAI,CAAC;IAC7B;IACA;IACA,IAAI,CAAC1C,oBAAoB,GAAG,CAAC+C,GAAW,EAAEC,GAAiB,KAAK;MAC9D,IAAI,CAAC,IAAI,CAAClD,QAAQ,EAAE;QAClB,IAAI,CAACmD,cAAc,CAACF,GAAG,EAAEC,GAAG,CAAC;MAC/B;IACF,CAAC;IACD,IAAI,CAAC1C,KAAK,CAACmB,EAAE,CAAC,UAAU,EAAE,IAAI,CAACzB,oBAAoB,CAAC;EACtD;EAEQkD,eAAeA,CAAA,EAAS;IAC9B,MAAMC,OAAyB,GAAG;MAChCvG,IAAI,EAAE,IAAI,CAACzD,MAAM;MACjBC,MAAM,EAAE,IAAI,CAACA;IACf,CAAC;IACD,IAAI,CAACgK,IAAI,CAAC,QAAQ,EAAED,OAAO,CAAC;EAC9B;EAEQF,cAAcA,CAACF,GAAW,EAAEC,GAAiB,EAAQ;IAC3D;IACA,MAAMK,aAAa,GAAGL,GAAG,IAAI,IAAI,CAACM,mBAAmB,CAACP,GAAG,CAAC;IAC1D,MAAMQ,WAAW,GAAGF,aAAa,KAAKN,GAAG,GAAG;MAAES,QAAQ,EAAET;IAAI,CAAC,GAAmBC,GAAG,CAAC;IAEpF,IAAI,IAAI,CAACS,oBAAoB,CAACV,GAAG,EAAEQ,WAAW,CAAC,EAAE;MAC/C;IACF;IAEA,IAAI,IAAI,CAACG,gBAAgB,CAACX,GAAG,EAAEQ,WAAW,CAAC,EAAE;MAC3C;IACF;;IAEA;IACA,MAAMI,cAAsC,GAAG;MAC7C,GAAG,EAAE,GAAG;MAAG;MACX,GAAG,EAAE,GAAG;MAAG;MACX,GAAG,EAAE,GAAG;MAAG;MACX,GAAG,EAAE,GAAG;MAAG;MACX,GAAG,EAAE,GAAG;MAAG;MACX,GAAG,EAAE,GAAG;MAAG;MACX,GAAG,EAAE,GAAG;MAAG;MACX,GAAG,EAAE,GAAG,CAAG;IACb,CAAC;IAED,IAAIZ,GAAG,IAAIY,cAAc,CAACZ,GAAG,CAAC,EAAE;MAC9B,MAAMa,MAAM,GAAGD,cAAc,CAACZ,GAAG,CAAC;MAClC;MACA,IAAI,CAACjE,mBAAmB,GAAG,EAAE;MAC7B,QAAQ8E,MAAM;QACZ,KAAK,GAAG;UACN,IAAI,CAACR,IAAI,CAAC,0BAA0B,CAAC;UACrC,IAAI,CAAC5B,YAAY,CAAC,CAAC;UACnB;QACF,KAAK,GAAG;UACN,IAAI,CAAC4B,IAAI,CAAC,sBAAsB,CAAC;UACjC,IAAI,CAAC5B,YAAY,CAAC,CAAC;UACnB;QACF,KAAK,GAAG;UACN,IAAI,CAAC4B,IAAI,CAAC,gBAAgB,CAAC;UAC3B,IAAI,CAAC5B,YAAY,CAAC,CAAC;UACnB;QACF,KAAK,GAAG;UACN,IAAI,CAAC4B,IAAI,CAAC,eAAe,CAAC;UAC1B,IAAI,CAAC5B,YAAY,CAAC,CAAC;UACnB;QACF;UACE;MACJ;IACF;IAEA,IAAI,CAAC6B,aAAa,EAAE;MAClB;IACF;IAEA,IAAI,IAAI,CAACpD,YAAY,IAAIoD,aAAa,CAACQ,IAAI,KAAKR,aAAa,CAACS,IAAI,KAAK,GAAG,IAAIT,aAAa,CAACS,IAAI,KAAK,GAAG,CAAC,EAAE;MACzG,IAAI,CAAC9B,kBAAkB,CAAC,IAAIC,KAAK,CAAC,yBAAyB,CAAC,CAAC;MAC7D,IAAI,CAAC8B,WAAW,CAAC,CAAC;MAClB;IACF;;IAEA;IACA,MAAMC,WAAW,GAAIJ,MAAc,IAAc;MAC/C,MAAMK,WAAW,GAAGL,MAAM,CAACM,WAAW,CAAC,CAAC;MACxC,MAAMC,WAAW,GAAGP,MAAM,CAACjG,WAAW,CAAC,CAAC;;MAExC;MACA,IAAI0F,aAAa,CAACQ,IAAI,IAAIR,aAAa,CAACe,KAAK,IAAIf,aAAa,CAACS,IAAI,EAAEI,WAAW,CAAC,CAAC,KAAKD,WAAW,EAAE;QAClG,OAAO,IAAI;MACb;;MAEA;MACA,IAAIZ,aAAa,CAACQ,IAAI,IAAIR,aAAa,CAACS,IAAI,KAAKK,WAAW,EAAE;QAC5D,OAAO,IAAI;MACb;;MAEA;MACA,IAAId,aAAa,CAACgB,IAAI,IAAIhB,aAAa,CAACS,IAAI,EAAEI,WAAW,CAAC,CAAC,KAAKD,WAAW,EAAE;QAC3E,OAAO,IAAI;MACb;;MAEA;MACA,MAAMK,GAAG,GAAGvB,GAAG,IAAIM,aAAa,CAACG,QAAQ;MACzC;MACA,IAAIc,GAAG,IAAI,yBAAyB,CAACC,IAAI,CAACD,GAAG,CAAC,EAAE;QAC9C,OAAO,IAAI;MACb;;MAEA;MACA,IAAIA,GAAG,IAAIA,GAAG,KAAK,OAAOL,WAAW,EAAE,EAAE;QACvC,OAAO,IAAI;MACb;MAEA,OAAO,KAAK;IACd,CAAC;IAED,MAAMO,qBAAqB,GAAIZ,MAA6B,IAAW;MACrE;MACA,IAAI,CAAC9E,mBAAmB,GAAG,EAAE;MAC7B,IAAI8E,MAAM,KAAK,GAAG,EAAE;QAClB,IAAI,CAACR,IAAI,CAAC,0BAA0B,CAAC;MACvC,CAAC,MAAM,IAAIQ,MAAM,KAAK,GAAG,EAAE;QACzB,IAAI,CAACR,IAAI,CAAC,sBAAsB,CAAC;MACnC,CAAC,MAAM,IAAIQ,MAAM,KAAK,GAAG,EAAE;QACzB,IAAI,CAACR,IAAI,CAAC,gBAAgB,CAAC;MAC7B,CAAC,MAAM,IAAIQ,MAAM,KAAK,GAAG,EAAE;QACzB,IAAI,CAACR,IAAI,CAAC,eAAe,CAAC;MAC5B;MACA,IAAI,CAAC5B,YAAY,CAAC,CAAC;IACrB,CAAC;IAED,IAAIwC,WAAW,CAAC,GAAG,CAAC,EAAE;MACpBQ,qBAAqB,CAAC,GAAG,CAAC;MAC1B;IACF;IAEA,IAAIR,WAAW,CAAC,GAAG,CAAC,EAAE;MACpBQ,qBAAqB,CAAC,GAAG,CAAC;MAC1B;IACF;IAEA,IAAIR,WAAW,CAAC,GAAG,CAAC,EAAE;MACpBQ,qBAAqB,CAAC,GAAG,CAAC;MAC1B;IACF;IAEA,IAAIR,WAAW,CAAC,GAAG,CAAC,EAAE;MACpBQ,qBAAqB,CAAC,GAAG,CAAC;MAC1B;IACF;IAEA,IAAInB,aAAa,CAACQ,IAAI,IAAIR,aAAa,CAACS,IAAI,EAAEI,WAAW,CAAC,CAAC,KAAK,GAAG,EAAE;MACnE,IAAI,CAACd,IAAI,CAAC,QAAQ,CAAC;MACnB;IACF;IAEA,IAAIC,aAAa,CAACQ,IAAI,IAAIR,aAAa,CAACS,IAAI,KAAK,GAAG,EAAE;MACpD;MACA;MACA;MACA;MACA;MACA;;MAEA,MAAMW,SAAS,GAAG,IAAI,CAACtL,MAAM,CAACuD,MAAM,GAAG,CAAC;MACxC,IAAI+H,SAAS,EAAE;QACb;QACA,IAAI,CAACtL,MAAM,GAAG,EAAE;QAChB,IAAI,CAACC,MAAM,GAAG,CAAC;QACf,IAAI,CAACoI,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;MACxB;MACA;MACA,IAAI,CAACE,IAAI,CAAC,OAAO,EAAE;QAAEqB;MAAU,CAAC,CAAC;MACjC;IACF;IAEA,IAAIzB,GAAG,CAACa,IAAI,IAAIb,GAAG,CAACc,IAAI,KAAK,GAAG,EAAE;MAChC,IAAI,IAAI,CAAC3K,MAAM,CAACuD,MAAM,KAAK,CAAC,EAAE;QAC5B,IAAI,CAAC0G,IAAI,CAAC,WAAW,CAAC;MACxB;MACA;IACF;IAEA,IAAIJ,GAAG,CAACa,IAAI,IAAIb,GAAG,CAACc,IAAI,KAAK,GAAG,EAAE;MAChC,IAAI,CAACC,WAAW,CAAC,CAAC;MAClB;IACF;;IAEA;IACA,IAAIf,GAAG,CAACa,IAAI,IAAIb,GAAG,CAACc,IAAI,KAAK,GAAG,EAAE;MAChC,IAAI,IAAI,CAAClK,cAAc,EAAE;QACvB,IAAI,CAAC8K,4BAA4B,CAAC,CAAC;QACnC;MACF;MACA;MACA,IAAI,CAACvE,MAAM,CAAC2B,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC;MACpC,IAAI,CAAC9D,sBAAsB,GAAG,KAAK;MACnC,IAAI,CAAC2G,qBAAqB,CAAC,CAAC;MAC5B,IAAI,CAACnD,YAAY,CAAC,CAAC;MACnB;IACF;;IAEA;IACA,IAAIwB,GAAG,CAACa,IAAI,IAAIb,GAAG,CAACc,IAAI,KAAK,GAAG,EAAE;MAChC,IAAI,CAACV,IAAI,CAAC,oBAAoB,CAAC;MAC/B;IACF;;IAEA;IACA,IAAIJ,GAAG,CAACa,IAAI,IAAIb,GAAG,CAACc,IAAI,KAAK,GAAG,EAAE;MAChC,IAAI,IAAI,CAAC1K,MAAM,KAAK,CAAC,EAAE;QACrB,IAAI,CAACA,MAAM,GAAG,CAAC;QACf,IAAI,CAAC8E,iBAAiB,GAAG,CAAC;QAC1B,IAAI,CAACsD,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;MACxB;MACA;IACF;;IAEA;IACA,IAAIF,GAAG,CAACa,IAAI,IAAIb,GAAG,CAACc,IAAI,KAAK,GAAG,EAAE;MAChC,IAAI,IAAI,CAAC1K,MAAM,KAAK,IAAI,CAACD,MAAM,CAACuD,MAAM,EAAE;QACtC,IAAI,CAACtD,MAAM,GAAG,IAAI,CAACD,MAAM,CAACuD,MAAM;QAChC,IAAI,CAACkI,mBAAmB,CAAC,CAAC;QAC1B,IAAI,CAACpD,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;MACxB;MACA;IACF;;IAEA;IACA,IAAIF,GAAG,CAACa,IAAI,IAAIb,GAAG,CAACc,IAAI,KAAK,GAAG,EAAE;MAChC,IAAI,IAAI,CAAC1K,MAAM,GAAG,CAAC,EAAE;QACnB;QACA,IAAIyL,GAAG,GAAG,IAAI,CAACzL,MAAM;QACrB;QACA,OAAOyL,GAAG,GAAG,CAAC,IAAI,IAAI,CAAC1L,MAAM,CAAC0L,GAAG,GAAG,CAAC,CAAC,KAAK,GAAG,EAAEA,GAAG,EAAE;QACrD;QACA,OAAOA,GAAG,GAAG,CAAC,IAAI,IAAI,CAAC1L,MAAM,CAAC0L,GAAG,GAAG,CAAC,CAAC,KAAK,GAAG,EAAEA,GAAG,EAAE;QACrD,IAAI,CAAC1L,MAAM,GAAG,IAAI,CAACA,MAAM,CAACiE,KAAK,CAAC,CAAC,EAAEyH,GAAG,CAAC,GAAG,IAAI,CAAC1L,MAAM,CAACiE,KAAK,CAAC,IAAI,CAAChE,MAAM,CAAC;QACxE,IAAI,CAACA,MAAM,GAAGyL,GAAG;QACjB,IAAI,CAACC,iBAAiB,CAAC,CAAC;QACxB,IAAI,CAACtD,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;MACxB;MACA;IACF;;IAEA;IACA,IAAIF,GAAG,CAACa,IAAI,IAAIb,GAAG,CAACc,IAAI,KAAK,GAAG,EAAE;MAChC,IAAI,IAAI,CAAC1K,MAAM,GAAG,IAAI,CAACD,MAAM,CAACuD,MAAM,EAAE;QACpC,IAAI,CAACvD,MAAM,GAAG,IAAI,CAACA,MAAM,CAACiE,KAAK,CAAC,CAAC,EAAE,IAAI,CAAChE,MAAM,CAAC;QAC/C,IAAI,CAAC0L,iBAAiB,CAAC,CAAC;QACxB,IAAI,CAACtD,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;MACxB;MACA;IACF;;IAEA;IACA,IAAIF,GAAG,CAACc,IAAI,KAAK,MAAM,EAAE;MACvB,IAAI,IAAI,CAAC1K,MAAM,KAAK,CAAC,EAAE;QACrB,IAAI,CAACA,MAAM,GAAG,CAAC;QACf,IAAI,CAAC8E,iBAAiB,GAAG,CAAC;QAC1B,IAAI,CAACsD,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;MACxB;MACA;IACF;;IAEA;IACA,IAAIF,GAAG,CAACc,IAAI,KAAK,KAAK,EAAE;MACtB,IAAI,IAAI,CAAC1K,MAAM,KAAK,IAAI,CAACD,MAAM,CAACuD,MAAM,EAAE;QACtC,IAAI,CAACtD,MAAM,GAAG,IAAI,CAACD,MAAM,CAACuD,MAAM;QAChC,IAAI,CAACkI,mBAAmB,CAAC,CAAC;QAC1B,IAAI,CAACpD,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;MACxB;MACA;IACF;;IAEA;IACA,IAAIF,GAAG,CAACqB,IAAI,IAAIrB,GAAG,CAACc,IAAI,KAAK,MAAM,EAAE;MACnC,IAAI,IAAI,CAAC1K,MAAM,GAAG,CAAC,EAAE;QACnB,IAAIyL,GAAG,GAAG,IAAI,CAACzL,MAAM;QACrB;QACA,OAAOyL,GAAG,GAAG,CAAC,IAAI,IAAI,CAAC1L,MAAM,CAAC0L,GAAG,GAAG,CAAC,CAAC,KAAK,GAAG,EAAEA,GAAG,EAAE;QACrD;QACA,OAAOA,GAAG,GAAG,CAAC,IAAI,IAAI,CAAC1L,MAAM,CAAC0L,GAAG,GAAG,CAAC,CAAC,KAAK,GAAG,EAAEA,GAAG,EAAE;QACrD,IAAI,CAACzL,MAAM,GAAGyL,GAAG;QACjB,IAAI,CAACD,mBAAmB,CAAC,CAAC;QAC1B,IAAI,CAACpD,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;MACxB;MACA;IACF;;IAEA;IACA,IAAIF,GAAG,CAACqB,IAAI,IAAIrB,GAAG,CAACc,IAAI,KAAK,OAAO,EAAE;MACpC,IAAI,IAAI,CAAC1K,MAAM,GAAG,IAAI,CAACD,MAAM,CAACuD,MAAM,EAAE;QACpC,IAAImI,GAAG,GAAG,IAAI,CAACzL,MAAM;QACrB;QACA,OAAOyL,GAAG,GAAG,IAAI,CAAC1L,MAAM,CAACuD,MAAM,IAAI,IAAI,CAACvD,MAAM,CAAC0L,GAAG,CAAC,KAAK,GAAG,EAAEA,GAAG,EAAE;QAClE;QACA,OAAOA,GAAG,GAAG,IAAI,CAAC1L,MAAM,CAACuD,MAAM,IAAI,IAAI,CAACvD,MAAM,CAAC0L,GAAG,CAAC,KAAK,GAAG,EAAEA,GAAG,EAAE;QAClE,IAAI,CAACzL,MAAM,GAAGyL,GAAG;QACjB,IAAI,CAACD,mBAAmB,CAAC,CAAC;QAC1B,IAAI,CAACpD,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;MACxB;MACA;IACF;;IAEA;IACA,IAAIF,GAAG,CAACqB,IAAI,IAAIrB,GAAG,CAACc,IAAI,KAAK,WAAW,EAAE;MACxC,IAAI,IAAI,CAAC1K,MAAM,GAAG,CAAC,EAAE;QACnB,IAAIyL,GAAG,GAAG,IAAI,CAACzL,MAAM;QACrB,OAAOyL,GAAG,GAAG,CAAC,IAAI,IAAI,CAAC1L,MAAM,CAAC0L,GAAG,GAAG,CAAC,CAAC,KAAK,GAAG,EAAEA,GAAG,EAAE;QACrD,OAAOA,GAAG,GAAG,CAAC,IAAI,IAAI,CAAC1L,MAAM,CAAC0L,GAAG,GAAG,CAAC,CAAC,KAAK,GAAG,EAAEA,GAAG,EAAE;QACrD,IAAI,CAAC1L,MAAM,GAAG,IAAI,CAACA,MAAM,CAACiE,KAAK,CAAC,CAAC,EAAEyH,GAAG,CAAC,GAAG,IAAI,CAAC1L,MAAM,CAACiE,KAAK,CAAC,IAAI,CAAChE,MAAM,CAAC;QACxE,IAAI,CAACA,MAAM,GAAGyL,GAAG;QACjB,IAAI,CAACC,iBAAiB,CAAC,CAAC;QACxB,IAAI,CAACtD,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;MACxB;MACA;IACF;IAEA,IAAIF,GAAG,CAACc,IAAI,KAAK,QAAQ,IAAId,GAAG,CAACc,IAAI,KAAK,OAAO,EAAE;MACjD;MACA,IAAI,IAAI,CAAClK,cAAc,EAAE;QACvB,IAAI,CAACmL,oBAAoB,CAAC,CAAC;QAC3B;MACF;MACA;MACA,IAAI,IAAI,CAACC,eAAe,CAAC,IAAI,CAAC,EAAE;MAChC;MACA,IAAI,IAAI,CAAC7L,MAAM,CAAC8L,UAAU,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC1L,WAAW,CAACmD,MAAM,GAAG,CAAC,EAAE;QAC9D,MAAMwI,SAAS,GAAG,IAAI,CAAC1L,eAAe,IAAI,CAAC,IAAI,IAAI,CAACA,eAAe,GAAG,IAAI,CAACD,WAAW,CAACmD,MAAM,GACzF,IAAI,CAAClD,eAAe,GACpB,CAAC;QACL,IAAI,CAACL,MAAM,GAAG,IAAI,CAACI,WAAW,CAAC2L,SAAS,CAAC,EAAEC,OAAO,IAAI,IAAI,CAAChM,MAAM;MACnE;MACA,IAAI,CAACiM,UAAU,CAAC,IAAI,CAACjM,MAAM,CAAC;MAC5B;IACF;IAEA,IAAIkK,aAAa,CAACS,IAAI,KAAK,WAAW,EAAE;MACtC,IAAI,IAAI,CAAClK,cAAc,EAAE;QACvB,IAAI,CAACA,cAAc,GAAG,IAAI;QAC1B,IAAI,CAAC4H,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;QACtB;MACF;MACA,IAAI,IAAI,CAAC9J,MAAM,GAAG,CAAC,EAAE;QACnB,IAAI,CAACD,MAAM,GAAG,IAAI,CAACA,MAAM,CAACiE,KAAK,CAAC,CAAC,EAAE,IAAI,CAAChE,MAAM,GAAG,CAAC,CAAC,GAAG,IAAI,CAACD,MAAM,CAACiE,KAAK,CAAC,IAAI,CAAChE,MAAM,CAAC;QACpF,IAAI,CAACA,MAAM,EAAE;QACb,IAAI,CAAC0L,iBAAiB,CAAC,CAAC;QACxB,IAAI,CAACtD,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;MACxB;MACA;IACF;IAEA,IAAIG,aAAa,CAACS,IAAI,KAAK,QAAQ,EAAE;MACnC,IAAI,IAAI,CAAC1K,MAAM,GAAG,IAAI,CAACD,MAAM,CAACuD,MAAM,EAAE;QACpC,IAAI,CAACvD,MAAM,GAAG,IAAI,CAACA,MAAM,CAACiE,KAAK,CAAC,CAAC,EAAE,IAAI,CAAChE,MAAM,CAAC,GAAG,IAAI,CAACD,MAAM,CAACiE,KAAK,CAAC,IAAI,CAAChE,MAAM,GAAG,CAAC,CAAC;QACpF,IAAI,CAAC0L,iBAAiB,CAAC,CAAC;QACxB,IAAI,CAACtD,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;MACxB;MACA;IACF;IAEA,IAAIG,aAAa,CAACS,IAAI,KAAK,MAAM,EAAE;MACjC,IAAI,IAAI,CAAC1K,MAAM,GAAG,CAAC,EAAE;QACnB,IAAI,CAACA,MAAM,EAAE;QACb,IAAI,CAACwL,mBAAmB,CAAC,CAAC;QAC1B,IAAI,CAACpD,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;MACxB;MACA;IACF;IAEA,IAAIG,aAAa,CAACS,IAAI,KAAK,OAAO,EAAE;MAClC,IAAI,IAAI,CAAC1K,MAAM,GAAG,IAAI,CAACD,MAAM,CAACuD,MAAM,EAAE;QACpC,IAAI,CAACtD,MAAM,EAAE;QACb,IAAI,CAACwL,mBAAmB,CAAC,CAAC;QAC1B,IAAI,CAACpD,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;MACxB;MACA;IACF;IAEA,IAAIG,aAAa,CAACS,IAAI,KAAK,IAAI,EAAE;MAC/B,IAAI,IAAI,CAACuB,mBAAmB,CAAC,CAAC,CAAC,CAAC,EAAE;QAChC;MACF;MACA,IAAI,IAAI,CAAChM,OAAO,CAACqD,MAAM,GAAG,CAAC,EAAE;QAC3B,IAAI,IAAI,CAACpD,YAAY,KAAK,CAAC,CAAC,EAAE;UAC5B,IAAI,CAACA,YAAY,GAAG,IAAI,CAACD,OAAO,CAACqD,MAAM,GAAG,CAAC;QAC7C,CAAC,MAAM,IAAI,IAAI,CAACpD,YAAY,GAAG,CAAC,EAAE;UAChC,IAAI,CAACA,YAAY,EAAE;QACrB;QACA;QACA,IAAI,IAAI,CAACA,YAAY,IAAI,CAAC,IAAI,IAAI,CAACA,YAAY,GAAG,IAAI,CAACD,OAAO,CAACqD,MAAM,EAAE;UACrE,IAAI,CAACvD,MAAM,GAAG,IAAI,CAACE,OAAO,CAAC,IAAI,CAACC,YAAY,CAAC,IAAI,EAAE;QACrD,CAAC,MAAM;UACL,IAAI,CAACA,YAAY,GAAG,CAAC,CAAC;UACtB,IAAI,CAACH,MAAM,GAAG,EAAE;QAClB;QACA,IAAI,CAACC,MAAM,GAAG,IAAI,CAACD,MAAM,CAACuD,MAAM;QAChC,IAAI,CAACwB,iBAAiB,GAAG,CAAC,CAAC,CAAC;QAC5B,IAAI,CAAC4G,iBAAiB,CAAC,CAAC;QACxB,IAAI,CAACtD,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;MACxB;MACA;IACF;IAEA,IAAIG,aAAa,CAACS,IAAI,KAAK,MAAM,EAAE;MACjC,IAAI,IAAI,CAACuB,mBAAmB,CAAC,CAAC,CAAC,EAAE;QAC/B;MACF;MACA,IAAI,IAAI,CAAC/L,YAAY,KAAK,CAAC,CAAC,EAAE;QAC5B,IAAI,CAACA,YAAY,EAAE;QACnB,IAAI,IAAI,CAACA,YAAY,IAAI,IAAI,CAACD,OAAO,CAACqD,MAAM,EAAE;UAC5C,IAAI,CAACpD,YAAY,GAAG,CAAC,CAAC;UACtB,IAAI,CAACH,MAAM,GAAG,EAAE;QAClB,CAAC,MAAM,IAAI,IAAI,CAACG,YAAY,IAAI,CAAC,EAAE;UACjC,IAAI,CAACH,MAAM,GAAG,IAAI,CAACE,OAAO,CAAC,IAAI,CAACC,YAAY,CAAC,IAAI,EAAE;QACrD,CAAC,MAAM;UACL;UACA,IAAI,CAACA,YAAY,GAAG,CAAC,CAAC;UACtB,IAAI,CAACH,MAAM,GAAG,EAAE;QAClB;QACA,IAAI,CAACC,MAAM,GAAG,IAAI,CAACD,MAAM,CAACuD,MAAM;QAChC,IAAI,CAACwB,iBAAiB,GAAG,CAAC,CAAC,CAAC;QAC5B,IAAI,CAAC4G,iBAAiB,CAAC,CAAC;QACxB,IAAI,CAACtD,YAAY,CAAC,CAAC;QACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;MACxB;MACA;IACF;IAEA,IAAIG,aAAa,CAACS,IAAI,KAAK,KAAK,EAAE;MAChC,IAAI,IAAI,CAACkB,eAAe,CAAC,KAAK,CAAC,EAAE;MACjC;IACF;IAEA,IAAIjC,GAAG,IAAI,CAACM,aAAa,CAACQ,IAAI,IAAI,CAACR,aAAa,CAACgB,IAAI,EAAE;MACrD;MACA,IAAI,CAACiB,kBAAkB,CAACvC,GAAG,CAAC;IAC9B;EACF;;EAEA;AACF;AACA;AACA;EACU6B,mBAAmBA,CAAA,EAAS;IAClC,MAAMW,QAAQ,GAAGhJ,IAAI,CAACC,GAAG,CAAC,EAAE,EAAE,IAAI,CAACgJ,SAAS,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;IACtD;IACA,IAAI,IAAI,CAACpM,MAAM,GAAG,IAAI,CAAC8E,iBAAiB,EAAE;MACxC,IAAI,CAACA,iBAAiB,GAAG,IAAI,CAAC9E,MAAM;MACpC;IACF;IACA;IACA,IAAI,IAAI,CAACA,MAAM,GAAG,IAAI,CAAC8E,iBAAiB,IAAIqH,QAAQ,EAAE;MACpD,IAAI,CAACrH,iBAAiB,GAAG,IAAI,CAAC9E,MAAM,GAAGmM,QAAQ,GAAG,CAAC;IACrD;EACF;;EAEA;AACF;AACA;AACA;EACUjC,mBAAmBA,CAACE,QAAmC,EAAuB;IACpF,IAAI,CAACA,QAAQ,EAAE,OAAO,IAAI;IAC1B,MAAMiC,GAAiC,GAAG;MACxC,QAAQ,EAAE;QAAE3B,IAAI,EAAE,IAAI;QAAEN;MAAS,CAAiB;MAClD,QAAQ,EAAE;QAAEM,IAAI,EAAE,MAAM;QAAEN;MAAS,CAAiB;MACpD,QAAQ,EAAE;QAAEM,IAAI,EAAE,OAAO;QAAEN;MAAS,CAAiB;MACrD,QAAQ,EAAE;QAAEM,IAAI,EAAE,MAAM;QAAEN;MAAS,CAAiB;MACpD,QAAQ,EAAE;QAAEM,IAAI,EAAE,MAAM;QAAEN;MAAS,CAAiB;MACpD,QAAQ,EAAE;QAAEM,IAAI,EAAE,KAAK;QAAEN;MAAS,CAAiB;MACnD,WAAW,EAAE;QAAEM,IAAI,EAAE,aAAa;QAAEN;MAAS,CAAiB;MAC9D,WAAW,EAAE;QAAEM,IAAI,EAAE,WAAW;QAAEN;MAAS;IAC7C,CAAC;IACD,OAAOiC,GAAG,CAACjC,QAAQ,CAAC,IAAI,IAAI;EAC9B;;EAEA;AACF;AACA;AACA;EACU8B,kBAAkBA,CAAC1I,IAAY,EAAQ;IAC7C,IAAI,CAACkC,mBAAmB,IAAIlC,IAAI;;IAEhC;IACA,IAAI,IAAI,CAACmC,kBAAkB,EAAE;MAC3BmD,YAAY,CAAC,IAAI,CAACnD,kBAAkB,CAAC;MACrC,IAAI,CAACA,kBAAkB,GAAG,IAAI;IAChC;;IAEA;IACA,IAAI,CAACA,kBAAkB,GAAG2G,UAAU,CAAC,MAAM;MACzC,IAAI,CAACC,mBAAmB,CAAC,CAAC;IAC5B,CAAC,EAAE,IAAI,CAAC3G,oBAAoB,CAAC;EAC/B;;EAEA;AACF;AACA;EACU2G,mBAAmBA,CAAA,EAAS;IAClC,IAAI,IAAI,CAAC5G,kBAAkB,EAAE;MAC3BmD,YAAY,CAAC,IAAI,CAACnD,kBAAkB,CAAC;MACrC,IAAI,CAACA,kBAAkB,GAAG,IAAI;IAChC;IAEA,IAAI,IAAI,CAACD,mBAAmB,IAAI,CAAC,IAAI,CAACL,YAAY,IAAI,CAAC,IAAI,CAACD,gBAAgB,EAAE;MAC5E,IAAI,CAACoH,UAAU,CAAC,IAAI,CAAC9G,mBAAmB,CAAC;IAC3C;IACA,IAAI,CAACA,mBAAmB,GAAG,EAAE;EAC/B;;EAEA;AACF;AACA;EACU+G,4BAA4BA,CAAA,EAAW;IAC7C,IAAI,IAAI,CAAC9G,kBAAkB,EAAE;MAC3BmD,YAAY,CAAC,IAAI,CAACnD,kBAAkB,CAAC;MACrC,IAAI,CAACA,kBAAkB,GAAG,IAAI;IAChC;IACA,MAAM+G,QAAQ,GAAG,IAAI,CAAChH,mBAAmB;IACzC,IAAI,CAACA,mBAAmB,GAAG,EAAE;IAC7B,OAAOgH,QAAQ;EACjB;EAEQrC,oBAAoBA,CAACV,GAAW,EAAEC,GAAiB,EAAW;IACpE,MAAMQ,QAAQ,GAAGR,GAAG,EAAEQ,QAAQ,IAAIT,GAAG;IACrC,IAAIS,QAAQ,KAAKlM,GAAG,CAACM,sBAAsB,IAAI4L,QAAQ,KAAKlM,GAAG,CAACO,uBAAuB,EAAE;MACvF,OAAO,IAAI;IACb;;IAEA;IACA,MAAMkO,gBAAgB,GAAG,WAAW;IACpC,MAAMC,cAAc,GAAG,WAAW;;IAElC;IACA,IAAI,OAAOjD,GAAG,KAAK,QAAQ,IAAIA,GAAG,CAACkD,QAAQ,CAACF,gBAAgB,CAAC,EAAE;MAC7D,IAAI,CAACvH,gBAAgB,GAAG,IAAI;MAC5B,IAAI,CAAC3B,mBAAmB,GAAG,KAAK;MAChC;MACA,MAAMqJ,OAAO,GAAG,IAAI,CAAC7I,oBAAoB,CAAC,IAAI,CAACwI,4BAA4B,CAAC,CAAC,CAAC;MAC9E;MACA,MAAMM,QAAQ,GAAGpD,GAAG,CAACqD,OAAO,CAACL,gBAAgB,CAAC;MAC9C,IAAIM,OAAO,GAAGtD,GAAG,CAAC3F,KAAK,CAAC+I,QAAQ,GAAGJ,gBAAgB,CAACrJ,MAAM,CAAC;MAC3D;MACA,IAAI2J,OAAO,CAACJ,QAAQ,CAACD,cAAc,CAAC,EAAE;QACpC,MAAMM,MAAM,GAAGD,OAAO,CAACD,OAAO,CAACJ,cAAc,CAAC;QAC9CK,OAAO,GAAGA,OAAO,CAACjJ,KAAK,CAAC,CAAC,EAAEkJ,MAAM,CAAC;QAClC,IAAI,CAACvJ,WAAW,GAAGmJ,OAAO,GAAGG,OAAO;QACpC,IAAI,CAACE,iBAAiB,CAAC,CAAC;QACxB,OAAO,IAAI;MACb;MACA,IAAI,CAACxJ,WAAW,GAAGmJ,OAAO,GAAGG,OAAO;MACpC,IAAI,CAACzE,uBAAuB,CAAC,CAAC;MAC9B,OAAO,IAAI;IACb;IAEA,IAAI4B,QAAQ,KAAKuC,gBAAgB,EAAE;MACjC,IAAI,CAACvH,gBAAgB,GAAG,IAAI;MAC5B,IAAI,CAAC3B,mBAAmB,GAAG,KAAK,CAAC,CAAC;MAClC;MACA,MAAMqJ,OAAO,GAAG,IAAI,CAAC7I,oBAAoB,CAAC,IAAI,CAACwI,4BAA4B,CAAC,CAAC,CAAC;MAC9E,IAAI,CAAC9I,WAAW,GAAGmJ,OAAO;MAC1B,IAAI,CAACtE,uBAAuB,CAAC,CAAC;MAC9B,OAAO,IAAI;IACb;IACA,IAAI,CAAC,IAAI,CAACpD,gBAAgB,EAAE;MAC1B,OAAO,KAAK;IACd;;IAEA;IACA,IAAI,OAAOuE,GAAG,KAAK,QAAQ,IAAIA,GAAG,CAACkD,QAAQ,CAACD,cAAc,CAAC,EAAE;MAC3D,MAAMM,MAAM,GAAGvD,GAAG,CAACqD,OAAO,CAACJ,cAAc,CAAC;MAC1C,MAAMQ,aAAa,GAAGzD,GAAG,CAAC3F,KAAK,CAAC,CAAC,EAAEkJ,MAAM,CAAC;MAC1C,IAAIE,aAAa,EAAE;QACjB,IAAI,CAAC7J,mBAAmB,CAAC,OAAO,EAAE6J,aAAa,CAAC;MAClD;MACA,IAAI,CAACD,iBAAiB,CAAC,CAAC;MACxB,OAAO,IAAI;IACb;IAEA,IAAI/C,QAAQ,KAAKwC,cAAc,EAAE;MAC/B,IAAI,CAACO,iBAAiB,CAAC,CAAC;MACxB,OAAO,IAAI;IACb;IACA,IAAIvD,GAAG,EAAEc,IAAI,KAAK,QAAQ,IAAId,GAAG,EAAEc,IAAI,KAAK,OAAO,EAAE;MACnD;MACA,IAAI,CAACnH,mBAAmB,CAAC,OAAO,EAAE,IAAI,CAAC;MACvC,OAAO,IAAI,CAAC,CAAC;IACf;IACA,IAAIqG,GAAG,EAAEc,IAAI,KAAK,WAAW,EAAE;MAC7B,IAAI,CAAC/G,WAAW,GAAG,IAAI,CAACA,WAAW,CAACK,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;MAChD,OAAO,IAAI;IACb;IACA,IAAI,OAAO2F,GAAG,KAAK,QAAQ,IAAIA,GAAG,CAACrG,MAAM,GAAG,CAAC,EAAE;MAC7C,IAAI,CAACC,mBAAmB,CAAC,OAAO,EAAEoG,GAAG,CAAC;MACtC,OAAO,IAAI;IACb;IACA,IAAI,OAAOS,QAAQ,KAAK,QAAQ,IAAIA,QAAQ,CAAC9G,MAAM,GAAG,CAAC,EAAE;MACvD,IAAI,CAACC,mBAAmB,CAAC,OAAO,EAAE6G,QAAQ,CAAC;MAC3C,OAAO,IAAI;IACb;IACA,OAAO,IAAI;EACb;EAEQiD,qBAAqBA,CAACJ,OAAe,EAAEK,SAAiB,EAAEC,YAAqB,EAAQ;IAC7F,MAAMC,WAAW,GAAGD,YAAY,GAAG,GAAGN,OAAO,CAAC3J,MAAM,GAAG,GAAG,GAAG2J,OAAO,CAAC3J,MAAM,EAAE;IAC7E;IACA,MAAMmK,cAAc,GAAG,IAAI,CAAC1N,MAAM;IAClC,MAAM2N,cAAc,GAAG,IAAI,CAAC1N,MAAM;IAClC,IAAI,CAACQ,cAAc,GAAG;MACpBgD,IAAI,EAAEyJ,OAAO;MACbU,KAAK,EAAEL,SAAS;MAChBE,WAAW;MACXI,SAAS,EAAEL,YAAY;MACvBE,cAAc;MACdC;IACF,CAAC;IACD,IAAI,CAAC3N,MAAM,GAAG,EAAE;IAChB,IAAI,CAACC,MAAM,GAAG,CAAC;IACf,IAAI,CAAC0L,iBAAiB,CAAC,CAAC;IACxB,IAAI,CAAC5B,eAAe,CAAC,CAAC;IACtB,MAAM+D,gBAAgB,GAAGJ,cAAc,GAAG,4BAA4B,GAAG,EAAE;IAC3E,MAAMK,IAAI,GAAG,mBAAmBR,SAAS,QAAQA,SAAS,KAAK,CAAC,GAAG,EAAE,GAAG,GAAG,GAAGC,YAAY,GAAG,cAAc,GAAG,EAAE,GAAGM,gBAAgB,wDAAwD;IAC3L,IAAI,CAACE,kBAAkB,CAAC;MAAEC,IAAI,EAAEF;IAAK,CAAC,CAAC;IACvC,IAAI,CAAC1F,YAAY,CAAC,CAAC;EACrB;EAEQ+E,iBAAiBA,CAAA,EAAS;IAChC,IAAI,CAAC,IAAI,CAAC/H,gBAAgB,EAAE;IAC5B;IACA,MAAMlB,SAAS,GAAG,IAAI,CAACD,oBAAoB,CAAC,IAAI,CAACN,WAAW,CAAC;IAC7D,MAAMsJ,OAAO,GAAG/I,SAAS,CAACC,OAAO,CAAC,QAAQ,EAAE,IAAI,CAAC;IACjD,IAAI8I,OAAO,EAAE;MACX,MAAMK,SAAS,GAAGL,OAAO,CAACgB,KAAK,CAAC,IAAI,CAAC,CAAC3K,MAAM;MAC5C,MAAMiK,YAAY,GAAG,IAAI,CAAC9J,mBAAmB;MAC7C,IAAI6J,SAAS,GAAG,CAAC,IAAIL,OAAO,CAAC3J,MAAM,GAAG,GAAG,EAAE;QACzC,IAAI,CAAC+J,qBAAqB,CAACJ,OAAO,EAAEK,SAAS,EAAEC,YAAY,CAAC;MAC9D,CAAC,MAAM;QACL,IAAI,CAACf,UAAU,CAACS,OAAO,CAAC;MAC1B;IACF;IACA,IAAI,CAAC7H,gBAAgB,GAAG,KAAK;IAC7B,IAAI,CAACzB,WAAW,GAAG,EAAE;IACrB,IAAI,CAACF,mBAAmB,GAAG,KAAK;IAChC,IAAI,CAAC+E,uBAAuB,CAAC,CAAC;EAChC;EAEQ8B,gBAAgBA,CAACX,GAAW,EAAEC,GAAiB,EAAW;IAChE;IACA,IAAI,IAAI,CAACxE,gBAAgB,IAAIwE,GAAG,EAAEa,IAAI,IAAIb,GAAG,EAAEqB,IAAI,EAAE;MACnD,IAAI,CAACiD,oBAAoB,CAAC,CAAC;MAC3B,IAAI,CAACC,sBAAsB,CAAC,CAAC;MAC7B,OAAO,KAAK;IACd;;IAEA;IACA;IACA,IAAI,OAAOxE,GAAG,KAAK,QAAQ,IAAIA,GAAG,CAACkC,UAAU,CAAC,MAAM,CAAC,EAAE;MACrD,IAAI,CAACqC,oBAAoB,CAAC,CAAC;MAC3B,IAAI,CAACC,sBAAsB,CAAC,CAAC;MAC7B,OAAO,KAAK;IACd;IAEA,MAAM/D,QAAQ,GAAGR,GAAG,EAAEQ,QAAQ,IAAI,EAAE;IACpC,MAAMgE,KAAK,GAAG,OAAOzE,GAAG,KAAK,QAAQ,IAAIA,GAAG,CAACrG,MAAM,GAAG,CAAC,GAAGqG,GAAG,GAAGS,QAAQ;IACxE,IAAI,CAACgE,KAAK,EAAE;MACV,IAAI,CAACF,oBAAoB,CAAC,CAAC;MAC3B,IAAI,CAACC,sBAAsB,CAAC,CAAC;MAC7B,OAAO,KAAK;IACd;IAEA,MAAME,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;IACtB,IAAI,CAACE,oBAAoB,CAACH,KAAK,CAAC9K,MAAM,EAAE+K,GAAG,CAAC;;IAE5C;IACA,IAAI,IAAI,CAAChJ,YAAY,KAAKuE,GAAG,EAAEc,IAAI,KAAK,QAAQ,IAAId,GAAG,EAAEc,IAAI,KAAK,OAAO,CAAC,EAAE;MAC1E;MACA,IAAI,CAACnH,mBAAmB,CAAC,YAAY,EAAE,IAAI,CAAC;MAC5C,IAAI,CAACiL,wBAAwB,CAAC,CAAC;MAC/B,OAAO,IAAI,CAAC,CAAC;IACf;IAEA,IAAI,CAAC,IAAI,CAACnJ,YAAY,EAAE;MACtB,IAAI,CAACoJ,sBAAsB,CAACL,KAAK,EAAEC,GAAG,CAAC;IACzC;IAEA,MAAMK,aAAa,GAAGN,KAAK,CAAC9K,MAAM,GAAG,CAAC;IACtC,MAAMqL,UAAU,GAAG,QAAQ,CAACxD,IAAI,CAACiD,KAAK,CAAC;IACvC,MAAMQ,WAAW,GAAG,IAAI,CAACrJ,qBAAqB,GAAG,CAAC,IAAI8I,GAAG,GAAG,IAAI,CAAC9I,qBAAqB,IAAI,IAAI,CAACP,kBAAkB;IACjH,MAAM6J,YAAY,GAAGD,WAAW,IAAI,IAAI,CAACpJ,mBAAmB,IAAI,IAAI,CAACP,sBAAsB;IAC3F,MAAM6J,mBAAmB,GAAG,IAAI,CAACrJ,iBAAiB,CAACsJ,IAAI,CAACC,KAAK,IAAI,CAAC,WAAW,CAAC7D,IAAI,CAAC6D,KAAK,CAACxL,IAAI,CAAC,CAAC;IAC/F,MAAMyL,mBAAmB,GACvBN,UAAU,IACVC,WAAW,IACXE,mBAAmB,IACnB,IAAI,CAACtJ,mBAAmB,IAAI,IAAI,CAACN,2BAA2B;IAC9D,MAAMgK,cAAc,GAAGP,UAAU,KAAK,IAAI,CAACtJ,YAAY,IAAIqJ,aAAa,IAAIG,YAAY,IAAII,mBAAmB,CAAC;IAChH,MAAME,cAAc,GAAG,IAAI,CAAC9J,YAAY,IAAIqJ,aAAa,IAAIG,YAAY,IAAIK,cAAc;IAE3F,IAAI,CAACC,cAAc,EAAE;MACnB,IAAI,CAAChB,sBAAsB,CAAC,CAAC;MAC7B,OAAO,KAAK;IACd;IAEA,IAAIiB,oBAAoB,GAAG,KAAK;IAChC,IAAI,CAAC,IAAI,CAAC/J,YAAY,EAAE;MACtB,IAAI,CAACA,YAAY,GAAG,IAAI;MACxB,IAAI,CAAC5B,mBAAmB,GAAG,KAAK,CAAC,CAAC;MAClC;MACA,MAAMqJ,OAAO,GAAG,IAAI,CAACL,4BAA4B,CAAC,CAAC;MACnD,MAAM4C,SAAS,GAAG,IAAI,CAACC,wBAAwB,CAAC,CAAC;MACjD;MACA,MAAMC,QAAQ,GAAGzC,OAAO,GAAGuC,SAAS;MACpC,IAAIE,QAAQ,CAACjM,MAAM,GAAG,CAAC,EAAE;QACvB;QACA,IAAI+L,SAAS,CAAC/L,MAAM,GAAG,CAAC,EAAE;UACxB,MAAMkM,WAAW,GAAGrM,IAAI,CAACE,GAAG,CAAC,IAAI,CAACtD,MAAM,CAACuD,MAAM,EAAE+L,SAAS,CAAC/L,MAAM,CAAC;UAClE,MAAMmM,MAAM,GAAG,IAAI,CAAC1P,MAAM,CAACiE,KAAK,CAAC,CAACwL,WAAW,CAAC;UAC9C,IAAIA,WAAW,GAAG,CAAC,IAAIC,MAAM,KAAKJ,SAAS,CAACrL,KAAK,CAAC,CAACwL,WAAW,CAAC,EAAE;YAC/D,IAAI,CAACzP,MAAM,GAAG,IAAI,CAACA,MAAM,CAACiE,KAAK,CAAC,CAAC,EAAE,IAAI,CAACjE,MAAM,CAACuD,MAAM,GAAGkM,WAAW,CAAC;YACpE,IAAI,CAACxP,MAAM,GAAGmD,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE,IAAI,CAACrD,MAAM,CAACuD,MAAM,CAAC;YAC7C,IAAI,CAACJ,WAAW,CAAC,CAAC,CAAC,CAAC;UACtB;QACF;QACA,IAAI,CAACU,gBAAgB,GAAG2L,QAAQ,CAACvL,KAAK,CAAC,CAAC,EAAE,IAAI,CAACF,kBAAkB,CAAC;QAClE,IAAIyL,QAAQ,CAACjM,MAAM,GAAG,IAAI,CAACQ,kBAAkB,EAAE;UAC7C,IAAI,CAACL,mBAAmB,GAAG,IAAI;QACjC;QACA2L,oBAAoB,GAAGG,QAAQ,CAACG,QAAQ,CAACtB,KAAK,CAAC;MACjD,CAAC,MAAM;QACL,IAAI,CAACxK,gBAAgB,GAAG,EAAE;MAC5B;IACF;IAEA,IAAI,CAACwL,oBAAoB,EAAE;MACzB,IAAI,CAAC7L,mBAAmB,CAAC,YAAY,EAAE6K,KAAK,CAAC;IAC/C;IACA,IAAI,CAACI,wBAAwB,CAAC,CAAC;IAC/B,OAAO,IAAI;EACb;EAEQD,oBAAoBA,CAACjL,MAAc,EAAE+K,GAAW,EAAQ;IAC9D,IAAI,CAAC,IAAI,CAAC9I,qBAAqB,IAAI8I,GAAG,GAAG,IAAI,CAAC9I,qBAAqB,GAAG,IAAI,CAACP,kBAAkB,EAAE;MAC7F,IAAI,CAACO,qBAAqB,GAAG8I,GAAG;MAChC,IAAI,CAAC7I,mBAAmB,GAAG,CAAC;IAC9B;IACA,IAAI,CAACA,mBAAmB,IAAIlC,MAAM;EACpC;EAEQ4K,oBAAoBA,CAAA,EAAS;IACnC,IAAI,CAAC3I,qBAAqB,GAAG,CAAC;IAC9B,IAAI,CAACC,mBAAmB,GAAG,CAAC;EAC9B;EAEQgD,uBAAuBA,CAAA,EAAS;IACtC,IAAI,IAAI,CAAClD,eAAe,EAAE;MACxBwD,YAAY,CAAC,IAAI,CAACxD,eAAe,CAAC;MAClC,IAAI,CAACA,eAAe,GAAG,IAAI;IAC7B;IACA;IACA,IAAI,IAAI,CAACK,kBAAkB,EAAE;MAC3BmD,YAAY,CAAC,IAAI,CAACnD,kBAAkB,CAAC;MACrC,IAAI,CAACA,kBAAkB,GAAG,IAAI;IAChC;IACA,IAAI,CAACD,mBAAmB,GAAG,EAAE;IAC7B,IAAI,CAACL,YAAY,GAAG,KAAK;IACzB,IAAI,CAACzB,gBAAgB,GAAG,EAAE;IAC1B,IAAI,CAAC6B,iBAAiB,GAAG,EAAE;IAC3B,IAAI,CAACyI,oBAAoB,CAAC,CAAC;EAC7B;EAEQO,sBAAsBA,CAACjL,IAAY,EAAEmM,EAAU,EAAQ;IAC7D,MAAMC,WAAW,GAAGD,EAAE,GAAG,IAAI,CAAC3K,kBAAkB;IAChD,IAAI,CAACS,iBAAiB,CAACoK,IAAI,CAAC;MAAErM,IAAI;MAAEmM;IAAG,CAAC,CAAC;IACzC,IAAI,CAAClK,iBAAiB,GAAG,IAAI,CAACA,iBAAiB,CAACqK,MAAM,CAACd,KAAK,IAAIA,KAAK,CAACW,EAAE,IAAIC,WAAW,CAAC;EAC1F;EAEQzB,sBAAsBA,CAAA,EAAS;IACrC,IAAI,CAAC,IAAI,CAAC1I,iBAAiB,CAACnC,MAAM,EAAE;IACpC,MAAM+K,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;IACtB,MAAMuB,WAAW,GAAGvB,GAAG,GAAG,IAAI,CAACrJ,kBAAkB;IACjD,IAAI,CAACS,iBAAiB,GAAG,IAAI,CAACA,iBAAiB,CAACqK,MAAM,CAACd,KAAK,IAAIA,KAAK,CAACW,EAAE,IAAIC,WAAW,CAAC;EAC1F;EAEQN,wBAAwBA,CAAA,EAAW;IACzC,IAAI,CAAC,IAAI,CAAC7J,iBAAiB,CAACnC,MAAM,EAAE,OAAO,EAAE;IAC7C,MAAMiM,QAAQ,GAAG,IAAI,CAAC9J,iBAAiB,CAAC4G,GAAG,CAAC2C,KAAK,IAAIA,KAAK,CAACxL,IAAI,CAAC,CAACuM,IAAI,CAAC,EAAE,CAAC;IACzE,IAAI,CAACtK,iBAAiB,GAAG,EAAE;IAC3B,OAAO8J,QAAQ;EACjB;EAEQf,wBAAwBA,CAAA,EAAS;IACvC,IAAI,IAAI,CAAClJ,eAAe,EAAE;MACxBwD,YAAY,CAAC,IAAI,CAACxD,eAAe,CAAC;IACpC;IACA,IAAI,CAACA,eAAe,GAAGgH,UAAU,CAAC,MAAM;MACtC,IAAI,CAAC0D,kBAAkB,CAAC,CAAC;IAC3B,CAAC,EAAE,IAAI,CAACjL,gBAAgB,CAAC;EAC3B;EAEQiL,kBAAkBA,CAAA,EAAS;IACjC,IAAI,CAAC,IAAI,CAAC3K,YAAY,EAAE;;IAExB;IACA,MAAMnB,SAAS,GAAG,IAAI,CAACD,oBAAoB,CAAC,IAAI,CAACL,gBAAgB,CAAC;IAClE,MAAMqJ,OAAO,GAAG/I,SAAS,CAACC,OAAO,CAAC,QAAQ,EAAE,IAAI,CAAC;IACjD,MAAMoJ,YAAY,GAAG,IAAI,CAAC9J,mBAAmB;IAC7C,IAAI,CAAC4B,YAAY,GAAG,KAAK;IACzB,IAAI,CAACzB,gBAAgB,GAAG,EAAE;IAC1B,IAAI,CAAC6B,iBAAiB,GAAG,EAAE;IAC3B,IAAI,CAACyI,oBAAoB,CAAC,CAAC;IAC3B,IAAI,CAACzK,mBAAmB,GAAG,KAAK;IAChC,IAAI,IAAI,CAAC6B,eAAe,EAAE;MACxBwD,YAAY,CAAC,IAAI,CAACxD,eAAe,CAAC;MAClC,IAAI,CAACA,eAAe,GAAG,IAAI;IAC7B;IAEA,IAAI,CAAC2H,OAAO,EAAE;IACd,MAAMK,SAAS,GAAGL,OAAO,CAACgB,KAAK,CAAC,IAAI,CAAC,CAAC3K,MAAM;IAC5C,IAAIgK,SAAS,GAAG,CAAC,IAAIL,OAAO,CAAC3J,MAAM,GAAG,GAAG,EAAE;MACzC,IAAI,CAAC+J,qBAAqB,CAACJ,OAAO,EAAEK,SAAS,EAAEC,YAAY,CAAC;MAC5D;IACF;IAEA,IAAI,CAACf,UAAU,CAACS,OAAO,CAAC;EAC1B;EAEQT,UAAUA,CAAChJ,IAAY,EAAQ;IACrC,IAAI,CAACA,IAAI,EAAE;IACX;IACA,IAAI,IAAI,CAAC4B,gBAAgB,IAAI,IAAI,CAACC,YAAY,EAAE;MAC9C;IACF;IACA;IACA,IAAI,IAAI,CAAC7E,cAAc,EAAE;MACvB,IAAI,CAAC8K,4BAA4B,CAAC,CAAC;IACrC;IACA;IACA,MAAMpH,SAAS,GAAG,IAAI,CAACD,oBAAoB,CAACT,IAAI,CAAC;IACjD,IAAI,CAACU,SAAS,EAAE;IAChB;IACA,IAAI,CAAChB,WAAW,CAAC,CAAC;IAClB,IAAI,CAACnD,MAAM,GAAG,IAAI,CAACA,MAAM,CAACiE,KAAK,CAAC,CAAC,EAAE,IAAI,CAAChE,MAAM,CAAC,GAAGkE,SAAS,GAAG,IAAI,CAACnE,MAAM,CAACiE,KAAK,CAAC,IAAI,CAAChE,MAAM,CAAC;IAC5F,IAAI,CAACA,MAAM,IAAIkE,SAAS,CAACZ,MAAM;IAC/B,IAAI,CAACJ,WAAW,CAAC,CAAC,CAAC,CAAC;IACpB,IAAI,CAACwI,iBAAiB,CAAC,CAAC;IACxB,IAAI,CAACtD,YAAY,CAAC,CAAC;IACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;EACxB;EAEQkC,UAAUA,CAACxI,IAAY,EAAQ;IACrC;IACA;IACA,IAAI,IAAI,CAAChD,cAAc,EAAE;MACvB,IAAI,CAACmL,oBAAoB,CAAC,CAAC;MAC3B;IACF;IAEA,IAAI,IAAI,CAAC9E,YAAY,EAAE;MACrB,MAAMoJ,UAAU,GAAG,IAAI,CAACpJ,YAAY,CAACqJ,OAAO,CAAC5L,IAAI;MACjD,MAAM6L,iBAAiB,GAAGF,UAAU,GAAGzM,IAAI,CAACc,IAAI,CAAC,CAAC,GAAGd,IAAI;MACzD,IAAI,CAAC,IAAI,CAACqD,YAAY,CAACqJ,OAAO,CAACE,UAAU,IAAI,CAACD,iBAAiB,EAAE;QAC/D,IAAI,CAAC/H,YAAY,CAAC,CAAC;QACnB;MACF;MACA,MAAMiI,QAAQ,GAAG,IAAI,CAACxJ,YAAY;MAClC,IAAI,CAACA,YAAY,GAAG,IAAI;MACxB,IAAI,CAAC9G,MAAM,GAAG,EAAE;MAChB,IAAI,CAACC,MAAM,GAAG,CAAC;MACf,IAAI,CAAC8E,iBAAiB,GAAG,CAAC;MAC1B,IAAI,CAACwL,gBAAgB,CAAC,CAAC;MACvB,IAAI,CAAClI,YAAY,CAAC,CAAC;MACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;MACtBuG,QAAQ,CAACE,OAAO,CAACJ,iBAAiB,CAAC;MACnC;IACF;IAEA,MAAMK,UAAU,GAAGhN,IAAI,CAACc,IAAI,CAAC,CAAC;IAC9B,IAAI,CAACkM,UAAU,EAAE;MACf,IAAI,CAACpI,YAAY,CAAC,CAAC;MACnB;IACF;;IAEA;IACA,IAAI,CAAC,IAAI,CAAC/B,UAAU,IAAI,CAACmK,UAAU,CAAC3E,UAAU,CAAC,GAAG,CAAC,EAAE;MACnD,IAAI,CAAC5L,OAAO,CAAC4P,IAAI,CAACW,UAAU,CAAC;MAC7B,IAAI,CAACtQ,YAAY,GAAG,CAAC,CAAC;MACtB,IAAI,CAACuQ,iBAAiB,CAACD,UAAU,CAAC;IACpC,CAAC,MAAM,IAAI,CAAC,IAAI,CAACnK,UAAU,EAAE;MAC3B;MACA,IAAI,CAACpG,OAAO,CAAC4P,IAAI,CAACW,UAAU,CAAC;MAC7B,IAAI,CAACtQ,YAAY,GAAG,CAAC,CAAC;IACxB;IACA,IAAI,IAAI,CAACO,IAAI,KAAK,WAAW,EAAE;MAC7B,IAAI,CAACuJ,IAAI,CAAC,OAAO,EAAEwG,UAAU,CAAC;IAChC,CAAC,MAAM;MACL,IAAI,CAACxG,IAAI,CAAC,QAAQ,EAAEwG,UAAU,CAAC;IACjC;IACA,IAAI,CAACzQ,MAAM,GAAG,EAAE;IAChB,IAAI,CAACC,MAAM,GAAG,CAAC;IACf,IAAI,CAACsQ,gBAAgB,CAAC,CAAC;IACvB,IAAI,CAAClI,YAAY,CAAC,CAAC;IACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;EACxB;EAEQ4B,iBAAiBA,CAAA,EAAS;IAChC,IAAI,CAAC,IAAI,CAAC3L,MAAM,CAAC8L,UAAU,CAAC,GAAG,CAAC,EAAE;MAChC,IAAI,CAACyE,gBAAgB,CAAC,CAAC;MACvB;IACF;IAEA,MAAMI,UAAU,GAAG,IAAI,CAAC3Q,MAAM,CAACiN,OAAO,CAAC,GAAG,CAAC;IAC3C,MAAM2D,UAAU,GAAGD,UAAU,IAAI,CAAC,IAAI,IAAI,CAACvF,IAAI,CAAC,IAAI,CAACpL,MAAM,CAACiE,KAAK,CAAC0M,UAAU,GAAG,CAAC,CAAC,CAAC;IAClF;IACA,IAAIA,UAAU,IAAI,CAAC,IAAI,IAAI,CAAC1Q,MAAM,GAAG0Q,UAAU,IAAIC,UAAU,EAAE;MAC7D,IAAI,CAACL,gBAAgB,CAAC,CAAC;MACvB;IACF;IAEA,MAAMM,WAAW,GAAG,IAAI,CAAC7Q,MAAM,CAACiE,KAAK,CAAC,CAAC,EAAE,IAAI,CAAChE,MAAM,CAAC;IACrD,MAAM6Q,YAAY,GAAGH,UAAU,IAAI,CAAC,GAAGE,WAAW,CAAC5M,KAAK,CAAC,CAAC,EAAE0M,UAAU,CAAC,GAAGE,WAAW;IACrF,MAAME,aAAa,GAAGJ,UAAU,IAAI,CAAC,GAAG,IAAI,CAAC3Q,MAAM,CAACiE,KAAK,CAAC,CAAC,EAAE0M,UAAU,CAAC,GAAG,IAAI,CAAC3Q,MAAM;IACtF,MAAMgR,OAAO,GAAG,CAACF,YAAY,CAACG,OAAO,CAAC,CAAC,IAAIF,aAAa,CAACE,OAAO,CAAC,CAAC,IAAI,GAAG,EAAElG,WAAW,CAAC,CAAC;IACxF,MAAMmG,QAAQ,GAAG,IAAI,CAAC9Q,WAAW,CAAC,IAAI,CAACC,eAAe,CAAC,EAAE2L,OAAO;IAChE,IAAI,CAAC5L,WAAW,GAAG,IAAI,CAACE,iBAAiB,CACtCyP,MAAM,CAACoB,GAAG,IAAIA,GAAG,CAACnF,OAAO,CAACjB,WAAW,CAAC,CAAC,CAACe,UAAU,CAACkF,OAAO,CAAC,CAAC,CAC5D/M,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC;IACd,IAAI,IAAI,CAAC7D,WAAW,CAACmD,MAAM,KAAK,CAAC,EAAE;MACjC,IAAI,CAACgN,gBAAgB,CAAC,CAAC;MACvB;IACF;IACA,IAAIW,QAAQ,EAAE;MACZ,MAAME,GAAG,GAAG,IAAI,CAAChR,WAAW,CAACiR,SAAS,CAACC,CAAC,IAAIA,CAAC,CAACtF,OAAO,KAAKkF,QAAQ,CAAC;MACnE,IAAI,CAAC7Q,eAAe,GAAG+Q,GAAG,IAAI,CAAC,GAAGA,GAAG,GAAG,CAAC;IAC3C,CAAC,MAAM;MACL,IAAI,CAAC/Q,eAAe,GAAG,CAAC;IAC1B;EACF;EAEAkR,oBAAoBA,CAACC,QAAiC,EAAQ;IAC5D,IAAI,CAAClR,iBAAiB,GAAGkR,QAAQ;IACjC,IAAI,CAAC7F,iBAAiB,CAAC,CAAC;EAC1B;EAEQE,eAAeA,CAAC4F,MAAe,EAAW;IAChD,IAAI,CAAC,IAAI,CAACzR,MAAM,CAAC8L,UAAU,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC1L,WAAW,CAACmD,MAAM,KAAK,CAAC,EAAE;MACjE,OAAO,KAAK;IACd;IACA;IACA,MAAMwI,SAAS,GAAG,IAAI,CAAC1L,eAAe,IAAI,CAAC,IAAI,IAAI,CAACA,eAAe,GAAG,IAAI,CAACD,WAAW,CAACmD,MAAM,GACzF,IAAI,CAAClD,eAAe,GACpB,CAAC;IACL,MAAMqR,QAAQ,GAAG,IAAI,CAACtR,WAAW,CAAC2L,SAAS,CAAC;IAC5C,IAAI,CAAC2F,QAAQ,EAAE;MACb,OAAO,KAAK;IACd;IACA,IAAID,MAAM,EAAE;MACV,IAAI,CAACxF,UAAU,CAACyF,QAAQ,CAAC1F,OAAO,CAAC;IACnC,CAAC,MAAM;MACL,IAAI,CAAChM,MAAM,GAAG,GAAG0R,QAAQ,CAAC1F,OAAO,GAAG;MACpC,IAAI,CAAC/L,MAAM,GAAG,IAAI,CAACD,MAAM,CAACuD,MAAM;MAChC,IAAI,CAACgN,gBAAgB,CAAC,CAAC;MACvB,IAAI,CAAClI,YAAY,CAAC,CAAC;MACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;IACxB;IACA,OAAO,IAAI;EACb;EAEQwG,gBAAgBA,CAAA,EAAS;IAC/B,IAAI,CAACnQ,WAAW,GAAG,EAAE;IACrB,IAAI,CAACC,eAAe,GAAG,CAAC,CAAC;EAC3B;EAEQ6L,mBAAmBA,CAACyF,SAAiB,EAAW;IACtD,IAAI,CAAC,IAAI,CAAC3R,MAAM,CAAC8L,UAAU,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC1L,WAAW,CAACmD,MAAM,KAAK,CAAC,EAAE;MACjE;MACA,IAAI,IAAI,CAAClD,eAAe,KAAK,CAAC,CAAC,IAAI,IAAI,CAACD,WAAW,CAACmD,MAAM,KAAK,CAAC,EAAE;QAChE,IAAI,CAAClD,eAAe,GAAG,CAAC,CAAC;MAC3B;MACA,OAAO,KAAK;IACd;IACA;IACA,MAAMuR,YAAY,GAAG,IAAI,CAACvR,eAAe,IAAI,CAAC,IAAI,IAAI,CAACA,eAAe,GAAG,IAAI,CAACD,WAAW,CAACmD,MAAM,GAC5F,IAAI,CAAClD,eAAe,GACpB,CAAC,CAAC;IACN,MAAMwR,IAAI,GAAGD,YAAY,GAAGD,SAAS;IACrC,MAAMG,OAAO,GAAG1O,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACE,GAAG,CAAC,IAAI,CAAClD,WAAW,CAACmD,MAAM,GAAG,CAAC,EAAEsO,IAAI,CAAC,CAAC;IACxE,IAAIC,OAAO,KAAK,IAAI,CAACzR,eAAe,IAAI,IAAI,CAACA,eAAe,IAAI,CAAC,EAAE;MACjE,OAAO,IAAI;IACb;IACA,IAAI,CAACA,eAAe,GAAGyR,OAAO;IAC9B,IAAI,CAACzJ,YAAY,CAAC,CAAC;IACnB,OAAO,IAAI;EACb;;EAEA;;EAEA0J,QAAQA,CAACC,IAAuB,EAAE9E,OAAe,EAAQ;IACvD,IAAA+E,qBAAQ,EAAC,0CAA0CD,IAAI,oBAAoB9E,OAAO,EAAE3J,MAAM,IAAI,CAAC,EAAE,CAAC;IAClG,IAAI,CAAC2J,OAAO,EAAE;IACd,MAAMuD,UAAU,GAAG,IAAI,CAACyB,kBAAkB,CAACF,IAAI,CAAC;IAChD,IAAI,CAACvB,UAAU,EAAE;IACjB;IACA,IAAIA,UAAU,KAAK,SAAS,EAAE;MAC5B;IACF;;IAEA;IACA;IACA;IACA,IAAI,IAAI,CAACpP,YAAY,IAAIoP,UAAU,KAAK,QAAQ,IAAIuB,IAAI,KAAK,QAAQ,EAAE;MACrE;MACA,IAAI,CAACG,iBAAiB,CAAC,CAAC;IAC1B;IAEA,IAAAF,qBAAQ,EAAC,oCAAoCxB,UAAU,EAAE,CAAC;IAC1D,IACEA,UAAU,KAAK,QAAQ,IACvBA,UAAU,KAAK,UAAU,IACzBA,UAAU,KAAK,QAAQ,IACvBA,UAAU,KAAK,MAAM,IACrBA,UAAU,KAAK,aAAa,IAC5BA,UAAU,KAAK,OAAO,IACtBA,UAAU,KAAK,MAAM,EACrB;MACA,IAAI,CAAC5L,sBAAsB,GAAG,IAAI;IACpC;IACA,IAAI4L,UAAU,KAAK,aAAa,EAAE;MAChC,IAAI,CAAC9P,cAAc,GAAGuM,OAAO;IAC/B;IAEA,IAAI,IAAI,CAACxF,SAAS,EAAE;MAClB,MAAM0K,SAAS,GAAG,IAAI,CAACC,aAAa,CAAC;QACnCL,IAAI,EAAEvB,UAAU;QAChB6B,OAAO,EAAEN,IAAI;QACb9E,OAAO;QACPqF,SAAS,EAAEhE,IAAI,CAACD,GAAG,CAAC;MACtB,CAAC,CAAC;MACF,IAAI8D,SAAS,EAAE;QACb,MAAM3O,IAAI,GAAG2O,SAAS,CAACzC,QAAQ,CAAC,IAAI,CAAC,GAAGyC,SAAS,GAAG,GAAGA,SAAS,IAAI;QACpE,IAAI,CAACpL,MAAM,CAAC2B,KAAK,CAAClF,IAAI,CAAC;QACvB,IAAI,CAACsC,0BAA0B,GAAGtC,IAAI,CAACkM,QAAQ,CAAC,IAAI,CAAC;MACvD;MACA;IACF;IAEA,MAAM6C,KAAK,GAAG;MACZR,IAAI,EAAEvB,UAAU;MAChB6B,OAAO,EAAEN,IAAI;MACb9E,OAAO;MACPqF,SAAS,EAAEhE,IAAI,CAACD,GAAG,CAAC;IACtB,CAAC;;IAED;IACA;IACA,IAAImC,UAAU,KAAK,QAAQ,EAAE;MAC3B;MACA;MACA,MAAMgC,WAAW,GAAG,IAAI,CAAC3S,UAAU,CAACuR,SAAS,CAACrU,CAAC,IAAIA,CAAC,CAACgV,IAAI,KAAK,QAAQ,CAAC;MACvE,IAAIS,WAAW,KAAK,CAAC,CAAC,EAAE;QACtB,IAAI,CAAC3S,UAAU,CAACgQ,IAAI,CAAC0C,KAAK,CAAC;MAC7B,CAAC,MAAM;QACL,IAAI,CAAC1S,UAAU,CAAC4S,MAAM,CAACD,WAAW,EAAE,CAAC,EAAED,KAAK,CAAC;MAC/C;IACF,CAAC,MAAM;MACL,IAAI,CAAC1S,UAAU,CAACgQ,IAAI,CAAC0C,KAAK,CAAC;IAC7B;IAEA,IAAI,CAAC,IAAI,CAACzS,iBAAiB,EAAE;MAC3B4S,cAAc,CAAC,MAAM;QACnB,IAAI,CAAC,IAAI,CAAC5S,iBAAiB,EAAE;UAC3B,KAAK,IAAI,CAAC6S,YAAY,CAAC,CAAC;QAC1B;MACF,CAAC,CAAC;IACJ;EACF;;EAEA;AACF;AACA;AACA;AACA;EACUC,mBAAmBA,CAACC,SAAkB,GAAG,KAAK,EAAQ;IAC5D,IAAI,IAAI,CAACpL,SAAS,IAAI,IAAI,CAACf,QAAQ,IAAI,CAAC,IAAI,CAACK,MAAM,CAACQ,KAAK,IAAI,IAAI,CAACnB,wBAAwB,EAAE;MAC1F;IACF;IACA,IAAI,CAACD,iBAAiB,GAAG,IAAI;IAC7B,IAAI0M,SAAS,EAAE;MACb,IAAI,CAACC,qBAAqB,CAAC,CAAC;MAC5B;IACF;IACA,IAAI,CAAC1K,YAAY,CAAC,CAAC;EACrB;EAEA,MAAcuK,YAAYA,CAAA,EAAkB;IAC1C,IAAI,IAAI,CAAC7S,iBAAiB,IAAI,IAAI,CAAC4G,QAAQ,EAAE;IAC7C,IAAI,CAAC5G,iBAAiB,GAAG,IAAI;IAC7B,IAAI;MACF,OAAO,IAAI,CAACD,UAAU,CAACyD,MAAM,GAAG,CAAC,IAAI,CAAC,IAAI,CAACoD,QAAQ,EAAE;QACnD,MAAM6L,KAAK,GAAG,IAAI,CAAC1S,UAAU,CAACmL,KAAK,CAAC,CAAC;QACrC,IAAI,CAACuH,KAAK,EAAE;QACZ,MAAMQ,SAAS,GAAG,IAAI,CAACC,0BAA0B,CAACT,KAAK,CAAC;QACxD,IAAI;UACF,MAAM,IAAI,CAACU,WAAW,CAACF,SAAS,CAAC;QACnC,CAAC,CAAC,OAAOG,KAAK,EAAE;UACd;UACA,IAAI,IAAI,CAACxM,QAAQ,EAAE,MAAM,CAAC;UAC1B,MAAMyM,OAAO,GACXD,KAAK,YAAYrK,KAAK,GAAGqK,KAAK,CAACC,OAAO,GAAG,OAAOD,KAAK,KAAK,QAAQ,GAAGA,KAAK,GAAG,wBAAwB;UACvG,IAAI,CAACnM,MAAM,CAAC2B,KAAK,CAAC,gBAAgByK,OAAO,IAAI,CAAC;QAChD;;QAEA;QACA,IAAI,IAAI,CAACzM,QAAQ,EAAE;;QAEnB;QACA;QACA,IAAI6L,KAAK,CAACR,IAAI,KAAK,QAAQ,EAAE;UAC3B;UACA,IAAI,IAAI,CAAChL,MAAM,CAACQ,KAAK,EAAE;YACrB,IAAI,CAACpB,iBAAiB,GAAG,IAAI;UAC/B;UACA;QACF,CAAC,MAAM;UACL,MAAM,IAAI,CAACiN,KAAK,CAAC,CAAC,CAAC;QACrB;MACF;MACA;MACA;MACA,IAAI,IAAI,CAACrM,MAAM,CAACQ,KAAK,IAAI,CAAC,IAAI,CAACb,QAAQ,EAAE;QACvC,IAAI,CAACP,iBAAiB,GAAG,IAAI;QAC7B,IAAI,CAACiC,YAAY,CAAC,CAAC;MACrB;IACF,CAAC,SAAS;MACR,IAAI,CAACtI,iBAAiB,GAAG,KAAK;IAChC;EACF;;EAEA;AACF;AACA;AACA;EACUkT,0BAA0BA,CAACT,KAAc,EAAW;IAC1D,MAAMc,WAAW,GAAIC,MAA2B,IAC9ChM,OAAO,CACLgM,MAAM,IACJ,CAACA,MAAM,CAACC,WAAW,KACjBD,MAAM,CAACvB,IAAI,KAAK,UAAU,IAAIuB,MAAM,CAACjB,OAAO,KAAK,UAAU,IAC1DiB,MAAM,CAACvB,IAAI,KAAK,SAAS,IAAIuB,MAAM,CAACjB,OAAO,KAAK,SAAU,CACjE,CAAC;IAEH,IAAI,CAACgB,WAAW,CAACd,KAAK,CAAC,EAAE;MACvB,OAAOA,KAAK;IACd;IAEA,OAAO,IAAI,CAAC1S,UAAU,CAACyD,MAAM,GAAG,CAAC,IAAI+P,WAAW,CAAC,IAAI,CAACxT,UAAU,CAAC,CAAC,CAAC,CAAC,EAAE;MACpE,MAAM+R,IAAI,GAAG,IAAI,CAAC/R,UAAU,CAACmL,KAAK,CAAC,CAAE;MACrC,MAAMwI,cAAc,GAClBjB,KAAK,CAACtF,OAAO,CAAC3J,MAAM,GAAG,CAAC,IAAI,CAACiP,KAAK,CAACtF,OAAO,CAACyC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAACkC,IAAI,CAAC3E,OAAO,CAACpB,UAAU,CAAC,IAAI,CAAC;MAC7F0G,KAAK,CAACtF,OAAO,GAAGuG,cAAc,GAAG,GAAGjB,KAAK,CAACtF,OAAO,KAAK2E,IAAI,CAAC3E,OAAO,EAAE,GAAG,GAAGsF,KAAK,CAACtF,OAAO,GAAG2E,IAAI,CAAC3E,OAAO,EAAE;IAC1G;IAEA,OAAOsF,KAAK;EACd;;EAEA;AACF;AACA;AACA;AACA;EACE,MAAMkB,WAAWA,CAACC,SAAiB,GAAG,GAAG,EAAiB;IACxD;IACA,IAAI,CAAC,IAAI,CAACjM,SAAS,IAAI,CAAC,IAAI,CAAC3H,iBAAiB,IAAI,IAAI,CAACD,UAAU,CAACyD,MAAM,GAAG,CAAC,EAAE;MAC5E,KAAK,IAAI,CAACqP,YAAY,CAAC,CAAC;IAC1B;IAEA,MAAMgB,KAAK,GAAGrF,IAAI,CAACD,GAAG,CAAC,CAAC;IACxB,OAAO,CAAC,IAAI,CAACvO,iBAAiB,IAAI,IAAI,CAACD,UAAU,CAACyD,MAAM,GAAG,CAAC,KAAKgL,IAAI,CAACD,GAAG,CAAC,CAAC,GAAGsF,KAAK,GAAGD,SAAS,EAAE;MAC/F,MAAM,IAAI,CAACN,KAAK,CAAC,CAAC,CAAC;IACrB;IAEA,IAAI,CAAC,IAAI,CAAC3L,SAAS,IAAI,IAAI,CAACV,MAAM,CAACQ,KAAK,EAAE;MACxC,IAAI,CAACpB,iBAAiB,GAAG,IAAI;MAC7B,IAAI,CAACiC,YAAY,CAAC,CAAC;IACrB;EACF;EAEA,MAAc6K,WAAWA,CAACV,KAAc,EAAiB;IACvD,IAAAP,qBAAQ,EAAC,sCAAsCO,KAAK,CAACR,IAAI,oBAAoBQ,KAAK,CAACtF,OAAO,EAAE3J,MAAM,IAAI,CAAC,EAAE,CAAC;IAC1G,IAAI,IAAI,CAACmE,SAAS,EAAE;MAClB,IAAAuK,qBAAQ,EAAC,+CAA+C,CAAC;MACzD,MAAM4B,cAAc,GAAG,IAAI,CAACxB,aAAa,CAACG,KAAK,CAAC;MAChD,IAAIqB,cAAc,EAAE;QAClB,MAAMpQ,IAAI,GAAGoQ,cAAc,CAAClE,QAAQ,CAAC,IAAI,CAAC,GAAGkE,cAAc,GAAG,GAAGA,cAAc,IAAI;QACnF,IAAI,CAAC7M,MAAM,CAAC2B,KAAK,CAAClF,IAAI,CAAC;QACvB,IAAI,CAACsC,0BAA0B,GAAGtC,IAAI,CAACkM,QAAQ,CAAC,IAAI,CAAC;MACvD;MACA;IACF;IAEA,MAAMyC,SAAS,GAAG,IAAI,CAACC,aAAa,CAACG,KAAK,CAAC;IAC3C,IAAAP,qBAAQ,EAAC,qCAAqCG,SAAS,EAAE7O,MAAM,IAAI,CAAC,EAAE,CAAC;IACvE,IAAI,CAAC6O,SAAS,EAAE;;IAEhB;IACA;IACA,MAAM0B,SAAS,GAAG,GAAGtB,KAAK,CAACF,OAAO,IAAIE,KAAK,CAACtF,OAAO,EAAE;IACrD,IAAIsF,KAAK,CAACR,IAAI,KAAK,QAAQ,IAAI8B,SAAS,KAAK,IAAI,CAAChO,oBAAoB,EAAE;MACtE;IACF;IACA,IAAI0M,KAAK,CAACR,IAAI,KAAK,QAAQ,EAAE;MAC3B,IAAI,CAAClM,oBAAoB,GAAGgO,SAAS;IACvC;;IAEA;IACA,IAAI,IAAI,CAACzS,YAAY,EAAE;MACrB;MACA;MACA,IAAImR,KAAK,CAACR,IAAI,KAAK,MAAM,IAAIQ,KAAK,CAACR,IAAI,KAAK,aAAa,EAAE;QACzD,IAAIQ,KAAK,CAACR,IAAI,KAAK,QAAQ,IAAI,IAAI,CAAChL,MAAM,CAACQ,KAAK,IAAI,IAAI,CAACF,WAAW,IAAI,CAAC,IAAI,CAACX,QAAQ,EAAE;UACtF,IAAI,CAACkM,mBAAmB,CAAC,IAAI,CAAC;QAChC;QACA;MACF;MACA;IACF;IAEA,IAAI,IAAI,CAACnO,YAAY,GAAG,CAAC,IAAI,IAAI,CAACwB,WAAW,EAAE;MAC7C,IAAI,CAACwC,eAAe,CAAC,CAAC;IACxB;IACA,IAAI,CAAC5D,cAAc,GAAG,KAAK;IAE3B,IAAI0N,KAAK,CAACR,IAAI,KAAK,QAAQ,IAAI,CAAC,IAAI,CAACjM,0BAA0B,IAAIqM,SAAS,CAAC7N,IAAI,CAAC,CAAC,EAAE;MACnF;MACA,IAAI,CAACyC,MAAM,CAAC2B,KAAK,CAAC,IAAI,CAAC;MACvB,IAAI,CAAC5C,0BAA0B,GAAG,IAAI;IACxC;IAEA,IAAI,CAACiB,MAAM,CAAC2B,KAAK,CAACyJ,SAAS,CAAC;IAC5B,IAAI,CAACrM,0BAA0B,GAAGqM,SAAS,CAACzC,QAAQ,CAAC,IAAI,CAAC;;IAE1D;IACA,IAAI,IAAI,CAAC3I,MAAM,CAACQ,KAAK,IAAI,IAAI,CAACF,WAAW,IAAI,CAAC,IAAI,CAACX,QAAQ,EAAE;MAC3D,IAAI,CAACkM,mBAAmB,CAAC,IAAI,CAAC;IAChC;EACF;EAEQX,kBAAkBA,CAACF,IAAuB,EAA6B;IAC7E,QAAQA,IAAI;MACV,KAAK,QAAQ;QACX,OAAO,QAAQ;MACjB,KAAK,SAAS;QACZ,OAAO,SAAS;MAClB,KAAK,QAAQ;MACb,KAAK,WAAW;QACd,OAAO,QAAQ;MACjB,KAAK,MAAM;MACX,KAAK,WAAW;QACd,OAAO,MAAM;MACf,KAAK,aAAa;QAChB,OAAO,aAAa;MACtB,KAAK,OAAO;QACV,OAAO,OAAO;MAChB,KAAK,MAAM;QACT,OAAO,MAAM;MACf,KAAK,UAAU;MACf,KAAK,QAAQ;MACb,KAAK,KAAK;QACR,OAAO,UAAU;MACnB,KAAK,OAAO;QACV,OAAO,UAAU;MACnB;QACE,OAAO,IAAI;IACf;EACF;EAEQK,aAAaA,CAACG,KAAc,EAAU;IAC5C;IACA,IAAIA,KAAK,CAACgB,WAAW,EAAE;MACrB,OAAOhB,KAAK,CAACtF,OAAO;IACtB;IAEA,IAAIsF,KAAK,CAACF,OAAO,KAAK,QAAQ,EAAE;MAC9B;MACA,MAAM1E,KAAK,GAAG4E,KAAK,CAACtF,OAAO,CAACgB,KAAK,CAAC,IAAI,CAAC,CAAC5B,GAAG,CAACyH,IAAI,IAAIA,IAAI,CAAC9C,OAAO,CAAC,CAAC,CAAC;MACnE,OAAO,GAAGrD,KAAK,CAACoC,IAAI,CAAC,IAAI,CAAC,IAAI;IAChC;;IAEA;IACA,QAAQwC,KAAK,CAACR,IAAI;MAChB,KAAK,QAAQ;QACX;QACA,OAAO,GAAGgC,YAAK,CAACC,OAAO,CAAC,GAAG,CAAC,IAAIzB,KAAK,CAACtF,OAAO,IAAI;MAEnD,KAAK,SAAS;QAAE;UACd;UACA,MAAMgH,aAAa,GAAG,CAAC,IAAI,CAACtR,WAAW,CAACuR,iBAAiB,IAAI,UAAU,EAAE5P,IAAI,CAAC,CAAC,CAACwG,WAAW,CAAC,CAAC;UAC7F,MAAMqJ,cAAc,GAAGF,aAAa,KAAK,UAAU,IAAIA,aAAa,KAAK,MAAM;UAC/E,IAAI,CAAC,IAAI,CAACtR,WAAW,CAACK,YAAY,IAAI,CAACmR,cAAc,EAAE;YACrD,OAAO,EAAE;UACX;UACA;UACA,IAAI,IAAI,CAACC,eAAe,CAAC7B,KAAK,CAACtF,OAAO,CAAC,EAAE;YACvC,OAAO,EAAE;UACX;UACA,MAAMoH,OAAO,GAAG,IAAI,CAACC,sBAAsB,CAAC/B,KAAK,CAACtF,OAAO,CAAC;UAC1D,IAAI,CAACoH,OAAO,IAAI,IAAI,CAACD,eAAe,CAACC,OAAO,CAAC,EAAE;YAC7C,OAAO,EAAE;UACX;UACA,IAAI,CAAC,IAAI,CAACE,mBAAmB,CAACF,OAAO,CAAC,EAAE;YACtC,OAAO,EAAE;UACX;UACA,IAAI,CAAC5R,kBAAkB,GAAG;YACxBe,IAAI,EAAE6Q,OAAO,CAAClQ,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC,CAACG,IAAI,CAAC,CAAC,CAACwG,WAAW,CAAC,CAAC;YACvD6E,EAAE,EAAErB,IAAI,CAACD,GAAG,CAAC;UACf,CAAC;UACD,OAAO,IAAI,CAACmG,mBAAmB,CAACH,OAAO,CAAC;QAC1C;MAEA,KAAK,MAAM;QAAE;UACX;UACA,MAAMpH,OAAO,GAAGsF,KAAK,CAACtF,OAAO,CAAC9I,OAAO,CAAC,WAAW,EAAE,EAAE,CAAC;UACtD,OAAO,IAAI,CAACsQ,qBAAqB,CAACxH,OAAO,CAAC;QAC5C;MAEA,KAAK,aAAa;QAAE;UAClB;UACA,OAAO,IAAI,CAACyH,uBAAuB,CAACnC,KAAK,CAACtF,OAAO,CAAC;QACpD;MAEA,KAAK,OAAO;QACV,OAAO,IAAI,CAAC0H,cAAc,CAACpC,KAAK,CAACtF,OAAO,EAAE;UAAE2H,KAAK,EAAE,OAAO;UAAEC,UAAU,EAAEd,YAAK,CAACe;QAAQ,CAAC,CAAC;MAE1F,KAAK,MAAM;QACT,OAAO,IAAI,CAACH,cAAc,CAACpC,KAAK,CAACtF,OAAO,EAAE;UAAE2H,KAAK,EAAE,MAAM;UAAEC,UAAU,EAAEd,YAAK,CAACgB;QAAK,CAAC,CAAC;MAEtF,KAAK,QAAQ;QAAE;UACb;UACA;UACA;UACA;UACA;UACA;UACA,IAAI,CAACxC,KAAK,CAACtF,OAAO,EAAE;YAClB,OAAO,EAAE;UACX;UACA,OAAOsF,KAAK,CAACtF,OAAO;QACtB;MAEA,KAAK,UAAU;MACf;QAAS;UACP;UACA,IAAI,IAAI,CAACmH,eAAe,CAAC7B,KAAK,CAACtF,OAAO,CAAC,EAAE;YACvC,OAAO,EAAE;UACX;UACA;UACA,MAAM+H,OAAO,GAAGzC,KAAK,CAACF,OAAO,KAAK,OAAO;UACzC,OAAO,IAAI,CAACsC,cAAc,CAACpC,KAAK,CAACtF,OAAO,EAAE+H,OAAO,GAAG;YAAEJ,KAAK,EAAE,OAAO;YAAEC,UAAU,EAAEd,YAAK,CAACb;UAAM,CAAC,GAAG+B,SAAS,CAAC;QAC9G;IACF;EACF;;EAEA;AACF;AACA;AACA;EACUb,eAAeA,CAACnH,OAAe,EAAW;IAChD,IAAI,CAACA,OAAO,IAAIA,OAAO,CAAC3I,IAAI,CAAC,CAAC,CAAChB,MAAM,KAAK,CAAC,EAAE,OAAO,IAAI;IAExD,MAAM4R,OAAO,GAAGjI,OAAO,CAAC3I,IAAI,CAAC,CAAC;;IAE9B;IACA,IAAI4Q,OAAO,CAAC5R,MAAM,IAAI,CAAC,EAAE;MACvB;MACA,IAAI,0CAA0C,CAAC6H,IAAI,CAAC+J,OAAO,CAAC,EAAE;QAC5D,OAAO,IAAI;MACb;IACF;;IAEA;IACA,MAAMvH,KAAK,GAAGV,OAAO,CAACgB,KAAK,CAAC,IAAI,CAAC;IACjC,MAAMkH,cAAc,GAAGxH,KAAK,CAACmC,MAAM,CAACgE,IAAI,IAAI;MAC1C,MAAMsB,WAAW,GAAGtB,IAAI,CAACxP,IAAI,CAAC,CAAC;MAC/B,OAAO8Q,WAAW,CAAC9R,MAAM,GAAG,CAAC,IAAI,4CAA4C,CAAC6H,IAAI,CAACiK,WAAW,CAAC;IACjG,CAAC,CAAC;IACF;IACA,MAAMC,aAAa,GAAG1H,KAAK,CAACmC,MAAM,CAACwF,CAAC,IAAIA,CAAC,CAAChR,IAAI,CAAC,CAAC,CAAChB,MAAM,GAAG,CAAC,CAAC;IAC5D,IAAI+R,aAAa,CAAC/R,MAAM,GAAG,CAAC,IAAI6R,cAAc,CAAC7R,MAAM,KAAK+R,aAAa,CAAC/R,MAAM,EAAE;MAC9E,OAAO,IAAI;IACb;;IAEA;IACA,IAAI2J,OAAO,CAACpB,UAAU,CAAC,GAAG,CAAC,IAAI,CAACoB,OAAO,CAACpB,UAAU,CAAC,OAAO,CAAC,IAAI,CAACoB,OAAO,CAACpB,UAAU,CAAC,IAAI,CAAC,EAAE;MACxF,OAAO,IAAI;IACb;;IAEA;IACA,IAAIoB,OAAO,CAACJ,QAAQ,CAAC,eAAe,CAAC,IAAII,OAAO,CAACJ,QAAQ,CAAC,WAAW,CAAC,EAAE;MACtE,OAAO,IAAI;IACb;;IAEA;IACA,IAAII,OAAO,CAACpB,UAAU,CAAC,GAAG,CAAC,IAAIoB,OAAO,CAACJ,QAAQ,CAAC,OAAO,CAAC,IAAII,OAAO,CAACJ,QAAQ,CAAC,MAAM,CAAC,EAAE;MACpF,OAAO,IAAI;IACb;;IAEA;IACA,IAAII,OAAO,CAAC3J,MAAM,GAAG,EAAE,IAAI,wBAAwB,CAAC6H,IAAI,CAAC8B,OAAO,CAAC,EAAE;MACjE,OAAO,IAAI;IACb;;IAEA;IACA,MAAMsI,eAAe,GAAG5H,KAAK,CAACmC,MAAM,CAACgE,IAAI,IAAI;MAC3C,MAAMsB,WAAW,GAAGtB,IAAI,CAACxP,IAAI,CAAC,CAAC;MAC/B,IAAI,CAAC8Q,WAAW,EAAE,OAAO,KAAK;MAC9B;MACA,MAAMI,QAAQ,GAAG,CAACJ,WAAW,CAACK,KAAK,CAAC,cAAc,CAAC,IAAI,EAAE,EAAEnS,MAAM;MACjE,OAAO8R,WAAW,CAAC9R,MAAM,GAAG,CAAC,IAAIkS,QAAQ,GAAGJ,WAAW,CAAC9R,MAAM,IAAI,GAAG;IACvE,CAAC,CAAC;IACF;IACA,IAAIqK,KAAK,CAACrK,MAAM,GAAG,CAAC,IAAIiS,eAAe,CAACjS,MAAM,GAAGqK,KAAK,CAACrK,MAAM,GAAG,GAAG,EAAE;MACnE,OAAO,IAAI;IACb;;IAEA;IACA,MAAMoS,UAAU,GAAG,CAACzI,OAAO,CAACwI,KAAK,CAAC,WAAW,CAAC,IAAI,EAAE,EAAEnS,MAAM;IAC5D,MAAMqS,UAAU,GAAG1I,OAAO,CAAC9I,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,CAACb,MAAM;IACpD,IAAIqS,UAAU,GAAG,EAAE,IAAID,UAAU,GAAGC,UAAU,GAAG,GAAG,EAAE;MACpD,OAAO,IAAI,CAAC,CAAC;IACf;IAEA,OAAO,KAAK;EACd;;EAEA;AACF;AACA;AACA;EACUC,yBAAyBA,CAAC3I,OAAe,EAAU;IACzD,IAAI,CAACA,OAAO,EAAE,OAAO,EAAE;;IAEvB;IACA,MAAMU,KAAK,GAAGV,OAAO,CAACgB,KAAK,CAAC,IAAI,CAAC;IACjC,MAAM4H,UAAoB,GAAG,EAAE;IAE/B,KAAK,MAAM/B,IAAI,IAAInG,KAAK,EAAE;MACxB,MAAMuH,OAAO,GAAGpB,IAAI,CAACxP,IAAI,CAAC,CAAC;;MAE3B;MACA,IAAIuR,UAAU,CAACvS,MAAM,KAAK,CAAC,IAAI,CAAC4R,OAAO,EAAE;;MAEzC;MACA;MACA,IAAI,gBAAgB,CAAC/J,IAAI,CAAC+J,OAAO,CAAC,EAAE;MACpC,IAAI,YAAY,CAAC/J,IAAI,CAAC+J,OAAO,CAAC,EAAE,SAAS,CAAC;MAC1C,IAAI,UAAU,CAAC/J,IAAI,CAAC+J,OAAO,CAAC,EAAE,SAAS,CAAC;MACxC,IAAI,UAAU,CAAC/J,IAAI,CAAC+J,OAAO,CAAC,EAAE,SAAS,CAAC;MACxC,IAAI,UAAU,CAAC/J,IAAI,CAAC+J,OAAO,CAAC,EAAE,SAAS,CAAC;MACxC,IAAI,UAAU,CAAC/J,IAAI,CAAC+J,OAAO,CAAC,EAAE,SAAS,CAAC;MACxC,IAAI,UAAU,CAAC/J,IAAI,CAAC+J,OAAO,CAAC,EAAE,SAAS,CAAC;MACxC,IAAI,UAAU,CAAC/J,IAAI,CAAC+J,OAAO,CAAC,EAAE,SAAS,CAAC;;MAExC;MACA,IAAI,uBAAuB,CAAC/J,IAAI,CAAC+J,OAAO,CAAC,IAAIA,OAAO,CAAC5R,MAAM,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC6H,IAAI,CAAC+J,OAAO,CAAC,EAAE;;MAE7F;MACA,MAAMY,WAAW,GAAG,CAACZ,OAAO,CAACO,KAAK,CAAC,cAAc,CAAC,IAAI,EAAE,EAAEnS,MAAM;MAChE,IAAI4R,OAAO,CAAC5R,MAAM,GAAG,CAAC,IAAI4R,OAAO,CAAC5R,MAAM,GAAG,EAAE,IAAIwS,WAAW,GAAGZ,OAAO,CAAC5R,MAAM,GAAG,GAAG,EAAE;;MAErF;MACA,IAAI4R,OAAO,CAAC5R,MAAM,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC6H,IAAI,CAAC+J,OAAO,CAAC,IAAI,CAAC,eAAe,CAAC/J,IAAI,CAAC+J,OAAO,CAAC,EAAE;QACnF;QACA,IAAI,CAAC,sBAAsB,CAAC/J,IAAI,CAAC+J,OAAO,CAAC,EAAE;MAC7C;;MAEA;MACA,IAAI,cAAc,CAAC/J,IAAI,CAAC+J,OAAO,CAAC,EAAE;;MAElC;MACA,IAAI,UAAU,CAAC/J,IAAI,CAAC+J,OAAO,CAAC,EAAE;MAE9BW,UAAU,CAAChG,IAAI,CAACiE,IAAI,CAAC;IACvB;;IAEA;IACA,OAAO+B,UAAU,CAACvS,MAAM,GAAG,CAAC,IAAI,CAACuS,UAAU,CAACA,UAAU,CAACvS,MAAM,GAAG,CAAC,CAAC,EAAEgB,IAAI,CAAC,CAAC,EAAE;MAC1EuR,UAAU,CAACE,GAAG,CAAC,CAAC;IAClB;IAEA,OAAOF,UAAU,CAAC9F,IAAI,CAAC,IAAI,CAAC,CAACzL,IAAI,CAAC,CAAC;EACrC;EAEQgQ,sBAAsBA,CAACrH,OAAe,EAAiB;IAC7D,MAAMuD,UAAU,GAAGvD,OAAO,CAAC9I,OAAO,CAAC,OAAO,EAAE,IAAI,CAAC,CAACA,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,CAACG,IAAI,CAAC,CAAC;IAC7E,IAAI,CAACkM,UAAU,EAAE,OAAO,IAAI;IAE5B,MAAMwF,OAAO,GACXxF,UAAU,CAAClN,MAAM,GAAG,IAAI,CAACf,wBAAwB,GAC7CiO,UAAU,CAACxM,KAAK,CAAC,CAAC,EAAE,IAAI,CAACzB,wBAAwB,CAAC,GAClDiO,UAAU;IAEhB,MAAMyF,WAAW,GAAG,IAAI,CAAC3T,wBAAwB,GAAG,CAAC;IACrD,MAAM4T,QAAQ,GAAGF,OAAO,CACrB/H,KAAK,CAAC,IAAI,CAAC,CACXkI,OAAO,CAACrC,IAAI,IAAIA,IAAI,CAAC7F,KAAK,CAAC,eAAe,CAAC,CAAC,CAC5C5B,GAAG,CAACyH,IAAI,IAAIA,IAAI,CAAC3P,OAAO,CAAC,qBAAqB,EAAE,EAAE,CAAC,CAACG,IAAI,CAAC,CAAC,CAAC,CAC3DwL,MAAM,CAACxI,OAAO,CAAC;IAElB,IAAI4O,QAAQ,CAAC5S,MAAM,KAAK,CAAC,EAAE;MACzB,OAAO,IAAI;IACb;IAEA,MAAM8S,IAAI,GAAG,IAAI7V,GAAG,CAAS,CAAC;IAC9B,MAAM8V,OAAiB,GAAG,EAAE;IAC5B,KAAK,MAAMC,OAAO,IAAIJ,QAAQ,EAAE;MAC9B,MAAMK,iBAAiB,GAAGD,OAAO,CAACnS,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC;MACtD,MAAMyF,GAAG,GAAG2M,iBAAiB,CAACzL,WAAW,CAAC,CAAC;MAC3C,IAAIsL,IAAI,CAAC1Y,GAAG,CAACkM,GAAG,CAAC,EAAE;QACjB;MACF;MACAwM,IAAI,CAACI,GAAG,CAAC5M,GAAG,CAAC;MACbyM,OAAO,CAACxG,IAAI,CAAC0G,iBAAiB,CAAC;MAC/B,IAAIF,OAAO,CAAC/S,MAAM,IAAI2S,WAAW,EAAE;QACjC;MACF;IACF;IAEA,IAAII,OAAO,CAAC/S,MAAM,KAAK,CAAC,EAAE;MACxB,OAAO,IAAI;IACb;IAEA,MAAMmT,WAAW,GAAG,IAAI,CAACC,2BAA2B,CAACL,OAAO,CAAC;IAC7D,IAAII,WAAW,CAACnT,MAAM,KAAK,CAAC,EAAE;MAC5B,OAAO,IAAI;IACb;IAEA,MAAMqT,gBAAgB,GAAGF,WAAW,CAACzS,KAAK,CAAC,CAAC,EAAE,IAAI,CAAC1B,wBAAwB,CAAC;IAC5E,MAAMsU,QAAQ,GAAGD,gBAAgB,CAACtK,GAAG,CAACyH,IAAI,IAAI,IAAI,CAAC+C,qBAAqB,CAAC/C,IAAI,CAAC,CAAC;IAE/E,OAAO8C,QAAQ,CAAC7G,IAAI,CAAC,IAAI,CAAC;EAC5B;EAEQ8G,qBAAqBA,CAAC/C,IAAY,EAAU;IAClD,IAAI,sBAAsB,CAAC3I,IAAI,CAAC2I,IAAI,CAAC,EAAE;MACrC,OAAOA,IAAI;IACb;IACA,OAAO,KAAKA,IAAI,EAAE;EACpB;EAEQgD,sBAAsBA,CAAChD,IAAY,EAAW;IACpD,OACE,sDAAsD,CAAC3I,IAAI,CAAC2I,IAAI,CAAC,IACjE,UAAU,CAAC3I,IAAI,CAAC2I,IAAI,CAAC,IACrBA,IAAI,CAACjH,QAAQ,CAAC,IAAI,CAAC,IACnBiH,IAAI,CAACjH,QAAQ,CAAC,GAAG,CAAC,IAClBiH,IAAI,CAACjH,QAAQ,CAAC,IAAI,CAAC,IACnB,kHAAkH,CAAC1B,IAAI,CAAC2I,IAAI,CAAC;EAEjI;EAEQ4C,2BAA2BA,CAACR,QAAkB,EAAY;IAChE,IAAI,CAACA,QAAQ,CAAC5S,MAAM,EAAE;MACpB,OAAO,EAAE;IACX;IAEA,MAAMyT,MAAM,GAAGb,QAAQ,CAAC7J,GAAG,CAAC,CAAC7I,IAAI,EAAEwT,KAAK,MAAM;MAC5CxT,IAAI;MACJwT,KAAK;MACLC,KAAK,EAAE,IAAI,CAACC,oBAAoB,CAAC1T,IAAI;IACvC,CAAC,CAAC,CAAC;IAEH,MAAM2T,SAAS,GAAGJ,MAAM,CAAChI,IAAI,CAACqI,IAAI,IAAIA,IAAI,CAACH,KAAK,GAAG,CAAC,CAAC;IACrD,IAAI,CAACE,SAAS,EAAE;MACd,OAAOjB,QAAQ;IACjB;IAEAa,MAAM,CAACM,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAK;MACpB,IAAIA,CAAC,CAACN,KAAK,KAAKK,CAAC,CAACL,KAAK,EAAE,OAAOM,CAAC,CAACN,KAAK,GAAGK,CAAC,CAACL,KAAK;MACjD,OAAOK,CAAC,CAACN,KAAK,GAAGO,CAAC,CAACP,KAAK;IAC1B,CAAC,CAAC;IAEF,OAAOD,MAAM,CAAC1K,GAAG,CAAC+K,IAAI,IAAIA,IAAI,CAAC5T,IAAI,CAAC;EACtC;EAEQ0T,oBAAoBA,CAACpD,IAAY,EAAU;IACjD,IAAImD,KAAK,GAAG,CAAC;IACb,MAAMO,KAAK,GAAG1D,IAAI,CAAChJ,WAAW,CAAC,CAAC;IAEhC,IAAI,IAAI,CAACgM,sBAAsB,CAAChD,IAAI,CAAC,EAAE;MACrCmD,KAAK,IAAI,CAAC;IACZ;IAEA,MAAMQ,cAAc,GAAG,CACrB,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE,SAAS,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EACjE,aAAa,EAAE,YAAY,EAAE,UAAU,EAAE,SAAS,EAAE,KAAK,EAAE,OAAO,EAClE,MAAM,EAAE,QAAQ,EAAE,UAAU,EAAE,OAAO,EAAE,OAAO,EAAE,QAAQ,EAAE,KAAK,EAC/D,MAAM,EAAE,MAAM,EAAE,WAAW,EAAE,WAAW,CACzC;IACD,IAAIA,cAAc,CAAC1I,IAAI,CAAC2I,OAAO,IAAIF,KAAK,CAAC3K,QAAQ,CAAC6K,OAAO,CAAC,CAAC,EAAE;MAC3DT,KAAK,IAAI,CAAC;IACZ;IAEA,IAAI,UAAU,CAAC9L,IAAI,CAAC2I,IAAI,CAAC,EAAE;MACzBmD,KAAK,IAAI,CAAC;IACZ;IAEA,IAAI,mDAAmD,CAAC9L,IAAI,CAAC2I,IAAI,CAAC,EAAE;MAClEmD,KAAK,IAAI,CAAC;IACZ;IAEA,IAAInD,IAAI,CAACxQ,MAAM,GAAG,GAAG,EAAE;MACrB2T,KAAK,IAAI,CAAC;IACZ;IAEA,OAAOA,KAAK;EACd;EAEQ1C,mBAAmBA,CAACtH,OAAe,EAAW;IACpD,MAAMuD,UAAU,GAAGvD,OAAO,CAAC9I,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC,CAACG,IAAI,CAAC,CAAC,CAACwG,WAAW,CAAC,CAAC;IACpE,IAAI,CAAC0F,UAAU,EAAE;MACf,OAAO,KAAK;IACd;IAEA,MAAMnC,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;IACtB,IAAI,IAAI,CAAC5L,kBAAkB,IAAI,IAAI,CAACA,kBAAkB,CAACe,IAAI,KAAKgN,UAAU,EAAE;MAC1E,IAAInC,GAAG,GAAG,IAAI,CAAC5L,kBAAkB,CAACkN,EAAE,GAAG,IAAI,CAACnN,oBAAoB,EAAE;QAChE,OAAO,KAAK;MACd;IACF;IAEA,OAAO,IAAI;EACb;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;EACUmV,qBAAqBA,CAAC1K,OAAe,EAAU;IACrD,MAAM2K,MAAM,GAAG,GAAG;IAClB,MAAMzL,QAAQ,GAAGhJ,IAAI,CAACC,GAAG,CAAC,EAAE,EAAED,IAAI,CAACE,GAAG,CAAC,IAAI,CAAC+I,SAAS,CAAC,CAAC,GAAG,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;IACpE,MAAMuB,KAAK,GAAGV,OAAO,CAACgB,KAAK,CAAC,IAAI,CAAC;IACjC,MAAM4J,MAAgB,GAAG,EAAE;IAE3B,KAAK,IAAIC,OAAO,GAAG,CAAC,EAAEA,OAAO,GAAGnK,KAAK,CAACrK,MAAM,EAAEwU,OAAO,EAAE,EAAE;MACvD,MAAMhE,IAAI,GAAGnG,KAAK,CAACmK,OAAO,CAAE;MAC5B,IAAI,CAAChE,IAAI,CAACxP,IAAI,CAAC,CAAC,EAAE;QAChBuT,MAAM,CAAChI,IAAI,CAAC,EAAE,CAAC;QACf;MACF;;MAEA;MACA,MAAMkI,KAAK,GAAGjE,IAAI,CAAC7F,KAAK,CAAC,OAAO,CAAC;MACjC,IAAI+J,WAAW,GAAG,EAAE;MAEpB,KAAK,MAAMC,IAAI,IAAIF,KAAK,EAAE;QACxB,IAAI,CAACC,WAAW,GAAGC,IAAI,EAAE3U,MAAM,GAAG6I,QAAQ,IAAI6L,WAAW,CAAC1T,IAAI,CAAC,CAAC,EAAE;UAChE;UACA,MAAM4T,MAAM,GAAGL,MAAM,CAACvU,MAAM,KAAK,CAAC,IAAIwU,OAAO,KAAK,CAAC,GAAG,GAAGF,MAAM,GAAG,GAAG,IAAI;UACzEC,MAAM,CAAChI,IAAI,CAAC,GAAGqI,MAAM,GAAGF,WAAW,CAAChH,OAAO,CAAC,CAAC,EAAE,CAAC;UAChDgH,WAAW,GAAGC,IAAI,CAACE,SAAS,CAAC,CAAC;QAChC,CAAC,MAAM;UACLH,WAAW,IAAIC,IAAI;QACrB;MACF;MAEA,IAAID,WAAW,CAAC1T,IAAI,CAAC,CAAC,EAAE;QACtB,MAAM4T,MAAM,GAAGL,MAAM,CAACvU,MAAM,KAAK,CAAC,IAAIwU,OAAO,KAAK,CAAC,GAAG,GAAGF,MAAM,GAAG,GAAG,IAAI;QACzEC,MAAM,CAAChI,IAAI,CAAC,GAAGqI,MAAM,GAAGF,WAAW,CAAChH,OAAO,CAAC,CAAC,EAAE,CAAC;MAClD;IACF;IAEA,OAAO6G,MAAM,CAAC9H,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI;EACjC;;EAEA;AACF;AACA;AACA;AACA;EACUqI,cAAcA,CAACnL,OAAe,EAAU;IAC9C,MAAM2K,MAAM,GAAG,GAAG;IAClB;IACA,MAAMnC,KAAK,GAAGxI,OAAO,CAACwI,KAAK,CAAC,kBAAkB,CAAC;IAC/C,IAAI,CAACA,KAAK,EAAE;MACV;MACA,MAAM4C,SAAS,GAAGpL,OAAO,CAACwI,KAAK,CAAC,QAAQ,CAAC;MACzC,IAAI4C,SAAS,EAAE;QACb,OAAO,GAAGT,MAAM,IAAI7D,YAAK,CAACuE,IAAI,CAAC,IAAID,SAAS,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI;MACzD;MACA,OAAO,GAAGT,MAAM,IAAI3K,OAAO,IAAI;IACjC;IAEA,MAAMsL,QAAQ,GAAG9C,KAAK,CAAC,CAAC,CAAC;IACzB,MAAM+C,OAAO,GAAG/C,KAAK,CAAC,CAAC,CAAE;IACzB,MAAMtJ,QAAQ,GAAGhJ,IAAI,CAACE,GAAG,CAAC,IAAI,CAAC1D,IAAI,GAAG,CAAC,EAAE,EAAE,CAAC;;IAE5C;IACA,MAAMuY,MAAM,GAAG,GAAGN,MAAM,IAAI7D,YAAK,CAACuE,IAAI,CAAC,IAAIC,QAAQ,GAAG,CAAC,GAAG;IAC1D,MAAME,SAAS,GAAGF,QAAQ,CAAEjV,MAAM,GAAG,CAAC,CAAC,CAAC;IACxC,MAAMoV,MAAM,GAAG,GAAG,CAACC,MAAM,CAACF,SAAS,GAAG,CAAC,CAAC,CAAC,CAAC;;IAE1C;IACA,MAAMG,IAAI,GAAG,IAAI,CAACC,aAAa,CAACL,OAAO,CAAC;IACxC,IAAII,IAAI,CAACtV,MAAM,KAAK,CAAC,EAAE;MACrB,OAAO,GAAG4U,MAAM,CAAClH,OAAO,CAAC,CAAC,IAAI;IAChC;IAEA,MAAMrD,KAAe,GAAG,EAAE;IAC1B,IAAIqK,WAAW,GAAGE,MAAM;IAExB,KAAK,IAAI3a,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGqb,IAAI,CAACtV,MAAM,EAAE/F,CAAC,EAAE,EAAE;MACpC,MAAMub,GAAG,GAAGF,IAAI,CAACrb,CAAC,CAAE;MACpB,MAAMwb,OAAO,GAAG,GAAGhF,YAAK,CAACiF,EAAE,CAACC,KAAK,CAACH,GAAG,CAAClP,GAAG,GAAG,GAAG,CAAC,IAAI,IAAI,CAACsP,cAAc,CAACJ,GAAG,CAAClP,GAAG,EAAEkP,GAAG,CAACK,KAAK,CAAC,EAAE;MAC7F,MAAMC,SAAS,GAAG7b,CAAC,GAAGqb,IAAI,CAACtV,MAAM,GAAG,CAAC,GAAG,IAAI,GAAG,EAAE;;MAEjD;MACA,MAAM+V,QAAQ,GAAGrB,WAAW,GAAGe,OAAO,GAAGK,SAAS;MAClD,IAAI,IAAI,CAACE,SAAS,CAACD,QAAQ,CAAC,CAAC/V,MAAM,GAAG6I,QAAQ,IAAI6L,WAAW,KAAKE,MAAM,EAAE;QACxEvK,KAAK,CAACkC,IAAI,CAACmI,WAAW,CAAChH,OAAO,CAAC,CAAC,CAAC;QACjCgH,WAAW,GAAGU,MAAM,GAAGK,OAAO,GAAGK,SAAS;MAC5C,CAAC,MAAM;QACLpB,WAAW,IAAIe,OAAO,GAAGK,SAAS;MACpC;IACF;IAEA,IAAIpB,WAAW,CAAC1T,IAAI,CAAC,CAAC,EAAE;MACtBqJ,KAAK,CAACkC,IAAI,CAACmI,WAAW,CAAChH,OAAO,CAAC,CAAC,CAAC;IACnC;IAEA,OAAOrD,KAAK,CAACoC,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI;EAChC;;EAEA;AACF;AACA;EACU8I,aAAaA,CAACL,OAAe,EAAyC;IAC5E,MAAMI,IAA2C,GAAG,EAAE;IACtD;IACA,MAAMW,KAAK,GAAG,sCAAsC;IACpD,IAAI9D,KAAK;IACT,OAAO,CAACA,KAAK,GAAG8D,KAAK,CAACC,IAAI,CAAChB,OAAO,CAAC,MAAM,IAAI,EAAE;MAC7CI,IAAI,CAAC/I,IAAI,CAAC;QAAEjG,GAAG,EAAE6L,KAAK,CAAC,CAAC,CAAE;QAAE0D,KAAK,EAAE1D,KAAK,CAAC,CAAC,CAAC,CAAEnR,IAAI,CAAC;MAAE,CAAC,CAAC;IACxD;IACA,OAAOsU,IAAI;EACb;;EAEA;AACF;AACA;EACUM,cAAcA,CAACtP,GAAW,EAAEuP,KAAa,EAAU;IACzD;IACA,MAAMM,QAAQ,GAAGN,KAAK,CAACtN,UAAU,CAAC,GAAG,CAAC,IAAIsN,KAAK,CAACzJ,QAAQ,CAAC,GAAG,CAAC;IAC7D,MAAMgK,KAAK,GAAGD,QAAQ,GAAGN,KAAK,CAACnV,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,GAAGmV,KAAK;IAEnD,MAAMQ,QAAQ,GAAG/P,GAAG,CAACkB,WAAW,CAAC,CAAC;IAClC,MAAM8O,cAAc,GAClBD,QAAQ,CAAC9M,QAAQ,CAAC,MAAM,CAAC,IACzB8M,QAAQ,KAAK,MAAM,IACnBA,QAAQ,KAAK,SAAS,IACtBA,QAAQ,KAAK,OAAO,IACpBA,QAAQ,KAAK,SAAS,IACtBA,QAAQ,KAAK,KAAK;;IAEpB;IACA,MAAME,MAAM,GAAG,EAAE;IACjB,MAAMjM,SAAS,GAAGgM,cAAc,IAAIF,KAAK,CAACpW,MAAM,IAAIuW,MAAM,GAAGH,KAAK,GAAGA,KAAK,CAAC1V,KAAK,CAAC,CAAC,EAAE6V,MAAM,GAAG,CAAC,CAAC,GAAG,KAAK;IAEvG,OAAOJ,QAAQ,GAAG,IAAI7L,SAAS,GAAG,GAAGA,SAAS;EAChD;;EAEA;AACF;AACA;AACA;EACUkM,gBAAgBA,CAAC7M,OAAe,EAAU;IAChD;IACA,MAAM8M,YAAY,GAAG9M,OAAO,CAACwI,KAAK,CAAC,kGAAkG,CAAC;IACtI,IAAIsE,YAAY,EAAE;MAChB,OAAO,KAAKhG,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG,CAAC,KAAKhM,OAAO,IAAI8G,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,oBAAoB,CAAC,IAAI;IACzF;;IAEA;IACA,MAAMtL,KAAK,GAAGV,OAAO,CAACgB,KAAK,CAAC,IAAI,CAAC;IACjC,IAAIN,KAAK,CAACrK,MAAM,GAAG,CAAC,EAAE;MACpB,MAAM0W,OAAO,GAAGrM,KAAK,CAAC3J,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC+L,IAAI,CAAC,IAAI,CAAC;MAC5C,OAAO,KAAKgE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG,CAAC,KAAKe,OAAO,OAAOjG,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,OAAOtL,KAAK,CAACrK,MAAM,GAAG,CAAC,gCAAgC,CAAC,IAAI;IAC/H;IAEA,OAAO,KAAKyQ,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG,CAAC,KAAKhM,OAAO,IAAI;EACjD;;EAEA;AACF;AACA;EACUwH,qBAAqBA,CAACxH,OAAe,EAAU;IACrD,MAAM2K,MAAM,GAAG,GAAG;IAClB;IACA,MAAMnC,KAAK,GAAGxI,OAAO,CAACwI,KAAK,CAAC,0BAA0B,CAAC;IACvD,IAAI,CAACA,KAAK,EAAE;MACV,OAAO,GAAGmC,MAAM,IAAI3K,OAAO,IAAI;IACjC;IAEA,MAAMsL,QAAQ,GAAG9C,KAAK,CAAC,CAAC,CAAE;IAC1B,MAAM+C,OAAO,GAAG/C,KAAK,CAAC,CAAC,CAAC,EAAEnR,IAAI,CAAC,CAAC,IAAI,EAAE;;IAEtC;IACA,IAAI,CAACzD,YAAY,GAAG0X,QAAQ;;IAE5B;IACA,MAAM0B,SAAS,GAAG,IAAAC,mBAAY,EAAC3B,QAAQ,CAAC;IACxC,MAAM4B,eAAe,GAAGF,SAAS,CAAC,IAAI1B,QAAQ,GAAG,CAAC;;IAElD;IACA,IAAI,CAACC,OAAO,EAAE;MACZ,OAAO,GAAGZ,MAAM,IAAIuC,eAAe,IAAI;IACzC;IAEA,MAAMhO,QAAQ,GAAG,IAAI,CAACxM,IAAI,GAAG,CAAC,CAAC,CAAC;;IAEhC;IACA,MAAMya,MAAM,GAAG,IAAI,CAACC,eAAe,CAAC7B,OAAO,CAAC;IAC5C,IAAI4B,MAAM,CAAC9W,MAAM,KAAK,CAAC,EAAE;MACvB,OAAO,GAAGsU,MAAM,IAAIuC,eAAe,IAAI3B,OAAO,IAAI;IACpD;;IAEA;IACA,OAAO,IAAI,CAAC8B,uBAAuB,CAAC/B,QAAQ,EAAE6B,MAAM,EAAEjO,QAAQ,EAAE8N,SAAS,CAAC;EAC5E;;EAEA;AACF;AACA;EACUI,eAAeA,CAAC7B,OAAe,EAAyC;IAC9E,MAAM4B,MAA6C,GAAG,EAAE;IACxD;IACA,MAAMb,KAAK,GAAG,uCAAuC;IACrD,IAAI9D,KAAK;IACT,OAAO,CAACA,KAAK,GAAG8D,KAAK,CAACC,IAAI,CAAChB,OAAO,CAAC,MAAM,IAAI,EAAE;MAC7C4B,MAAM,CAACvK,IAAI,CAAC;QAAEjG,GAAG,EAAE6L,KAAK,CAAC,CAAC,CAAE;QAAE0D,KAAK,EAAE1D,KAAK,CAAC,CAAC,CAAC,CAAEnR,IAAI,CAAC;MAAE,CAAC,CAAC;IAC1D;IACA,OAAO8V,MAAM;EACf;;EAEA;AACF;AACA;EACUG,gBAAgBA,CACtBhC,QAAgB,EAChB6B,MAA6C,EAC7CjO,QAAgB,EACR;IACR,OAAO,IAAI,CAACmO,uBAAuB,CAAC/B,QAAQ,EAAE6B,MAAM,EAAEjO,QAAQ,EAAE4H,YAAK,CAACuE,IAAI,CAAC;EAC7E;;EAEA;AACF;AACA;EACUgC,uBAAuBA,CAC7B/B,QAAgB,EAChB6B,MAA6C,EAC7CjO,QAAgB,EAChB8N,SAAmC,EAC3B;IACR,MAAMrC,MAAM,GAAG,GAAG;IAClB,MAAMjK,KAAe,GAAG,EAAE;IAC1B,MAAM+K,MAAM,GAAG,UAAU,CAAC,CAAC;;IAE3B,IAAIV,WAAW,GAAG,GAAGJ,MAAM,IAAIqC,SAAS,CAAC,IAAI1B,QAAQ,GAAG,CAAC,GAAG;IAC5D,IAAIiC,UAAU,GAAG,IAAI;IAErB,KAAK,MAAMC,KAAK,IAAIL,MAAM,EAAE;MAC1B,MAAMM,YAAY,GAAG,IAAI,CAACC,eAAe,CAACF,KAAK,CAAC7Q,GAAG,EAAE6Q,KAAK,CAACtB,KAAK,CAAC;MACjE,MAAMyB,SAAS,GAAG,GAAGH,KAAK,CAAC7Q,GAAG,KAAK8Q,YAAY,EAAE;MACjD,MAAMG,QAAQ,GAAGL,UAAU,GAAGI,SAAS,GAAG,KAAKA,SAAS,EAAE;;MAE1D;MACA,MAAMvB,QAAQ,GAAGrB,WAAW,GAAG6C,QAAQ;MACvC,MAAMC,WAAW,GAAG,IAAI,CAACC,aAAa,CAAC1B,QAAQ,CAAC;MAEhD,IAAIyB,WAAW,GAAG3O,QAAQ,IAAI,CAACqO,UAAU,EAAE;QACzC;QACA7M,KAAK,CAACkC,IAAI,CAACmI,WAAW,CAAC;QACvBA,WAAW,GAAGU,MAAM,GAAGkC,SAAS;MAClC,CAAC,MAAM;QACL5C,WAAW,IAAI6C,QAAQ;MACzB;MACAL,UAAU,GAAG,KAAK;IACpB;IAEA7M,KAAK,CAACkC,IAAI,CAACmI,WAAW,CAAC;IAEvB,OAAOrK,KAAK,CAACoC,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI;EAChC;;EAEA;AACF;AACA;EACU4K,eAAeA,CAAC/Q,GAAW,EAAEuP,KAAa,EAAU;IAC1D,MAAMQ,QAAQ,GAAG/P,GAAG,CAACkB,WAAW,CAAC,CAAC;IAClC,IAAI6O,QAAQ,CAAC9M,QAAQ,CAAC,MAAM,CAAC,IAAI8M,QAAQ,KAAK,MAAM,IAAIA,QAAQ,KAAK,SAAS,IAAIA,QAAQ,KAAK,OAAO,EAAE;MACtG,OAAO5F,YAAK,CAACe,OAAO,CAACqE,KAAK,CAAC;IAC7B;IACA,IAAIQ,QAAQ,KAAK,SAAS,IAAIA,QAAQ,KAAK,KAAK,EAAE;MAChD,OAAO5F,YAAK,CAACuE,IAAI,CAACa,KAAK,CAAC;IAC1B;IACA,OAAOA,KAAK;EACd;;EAEA;AACF;AACA;EACU6B,kBAAkBA,CAACzC,QAAgB,EAAEC,OAAe,EAAiB;IAC3E,MAAMF,IAAI,GAAGC,QAAQ,CAACzN,WAAW,CAAC,CAAC;;IAEnC;IACA,IAAI,CAAC,MAAM,EAAE,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC+B,QAAQ,CAACyL,IAAI,CAAC,EAAE;MACtE,MAAM2C,SAAS,GAAGzC,OAAO,CAAC/C,KAAK,CAAC,yCAAyC,CAAC;MAC1E,IAAIwF,SAAS,EAAE;QACb,MAAMC,IAAI,GAAGD,SAAS,CAAC,CAAC,CAAE;QAC1B,OAAOlH,YAAK,CAACoH,IAAI,EAAED,IAAI,GAAGnH,YAAK,CAACoH,IAAI,CAACD,IAAI,CAACA,IAAI,CAAC,GAAGnH,YAAK,CAACiF,EAAE,CAACC,KAAK,CAACiC,IAAI,CAAC;MACxE;IACF;;IAEA;IACA,IAAI5C,IAAI,KAAK,MAAM,EAAE;MACnB,MAAM8C,QAAQ,GAAG5C,OAAO,CAAC/C,KAAK,CAAC,sBAAsB,CAAC;MACtD,IAAI2F,QAAQ,EAAE;QACZ,MAAMlK,GAAG,GAAGkK,QAAQ,CAAC,CAAC,CAAE;QACxB,OAAOrH,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC/H,GAAG,CAAC;MAC5B;IACF;IAEA,OAAO,IAAI;EACb;;EAEA;AACF;AACA;EACUwD,uBAAuBA,CAACzH,OAAe,EAAU;IACvD;IACA,MAAM/I,SAAS,GAAG,IAAI,CAAC0R,yBAAyB,CAAC3I,OAAO,CAAC;IACzD,IAAI,CAAC/I,SAAS,IAAI,IAAI,CAACkQ,eAAe,CAAClQ,SAAS,CAAC,EAAE;MACjD,OAAO,EAAE,CAAC,CAAC;IACb;;IAEA;IACA,MAAMmX,SAAS,GAAGnX,SAAS,CAACuR,KAAK,CAAC,iBAAiB,CAAC;IACpD,MAAM6F,SAAS,GAAGpX,SAAS,CAACuR,KAAK,CAAC,8BAA8B,CAAC;IACjE,MAAM8F,SAAS,GAAGrX,SAAS,CAACuR,KAAK,CAAC,wBAAwB,CAAC;;IAE3D;IACA,MAAM+F,OAAO,GAAG,2CAA2C,CAACrQ,IAAI,CAACjH,SAAS,CAAC;IAC3E,MAAMuX,UAAU,GAAG,uBAAuB,CAACtQ,IAAI,CAACjH,SAAS,CAAC;IAC1D,MAAMwX,WAAW,GAAG,+BAA+B,CAACvQ,IAAI,CAACjH,SAAS,CAAC;IAEnE,IAAIyX,OAAe;IACnB,IAAIC,YAAY,GAAG,KAAK;IAExB,IAAIL,SAAS,EAAE;MACbI,OAAO,GAAG,QAAQJ,SAAS,CAAC,CAAC,CAAC,QAAQ;IACxC,CAAC,MAAM,IAAIF,SAAS,EAAE;MACpBM,OAAO,GAAG,SAASN,SAAS,CAAC,CAAC,CAAC,QAAQA,SAAS,CAAC,CAAC,CAAC,KAAK,GAAG,GAAG,EAAE,GAAG,GAAG,EAAE;IAC1E,CAAC,MAAM,IAAIC,SAAS,EAAE;MACpBK,OAAO,GAAG,SAASL,SAAS,CAAC,CAAC,CAAC,QAAQA,SAAS,CAAC,CAAC,CAAC,KAAK,GAAG,GAAG,EAAE,GAAG,GAAG,EAAE;IAC1E,CAAC,MAAM,IAAIpX,SAAS,CAACuR,KAAK,CAAC,sDAAsD,CAAC,EAAE;MAClFkG,OAAO,GAAG,GAAG;IACf,CAAC,MAAM,IAAID,WAAW,IAAIF,OAAO,IAAIC,UAAU,EAAE;MAC/C;MACA;MACA,MAAMI,SAAS,GAAG3X,SAAS,CAAC+J,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI/J,SAAS;MACvDyX,OAAO,GAAGE,SAAS;MACnBD,YAAY,GAAG,IAAI;IACrB,CAAC,MAAM;MACL;MACA,IAAIE,WAAW,GAAG5X,SAAS;;MAE3B;MACA,MAAM6V,YAAY,GAAG7V,SAAS,CAACuR,KAAK,CAAC,mBAAmB,CAAC;MACzD,IAAIsE,YAAY,EAAE;QAChB+B,WAAW,GAAG/B,YAAY,CAAC,CAAC,CAAE;MAChC;;MAEA;MACA,MAAM8B,SAAS,GAAGC,WAAW,CAAC7N,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE3J,IAAI,CAAC,CAAC,IAAIwX,WAAW;;MAEnE;MACA,MAAMjC,MAAM,GAAG,GAAG;MAClB,IAAIgC,SAAS,CAACvY,MAAM,GAAGuW,MAAM,EAAE;QAC7B;QACA,MAAMkC,WAAW,GAAGF,SAAS,CAAC7X,KAAK,CAAC,CAAC,EAAE6V,MAAM,CAAC,CAACmC,MAAM,CAAC,kBAAkB,CAAC;QACzE,IAAID,WAAW,GAAG,EAAE,EAAE;UACpBJ,OAAO,GAAGE,SAAS,CAAC7X,KAAK,CAAC,CAAC,EAAE+X,WAAW,GAAG,CAAC,CAAC;QAC/C,CAAC,MAAM;UACL;UACA,MAAMnO,SAAS,GAAGiO,SAAS,CAAC7X,KAAK,CAAC,CAAC,EAAE6V,MAAM,CAAC;UAC5C,MAAMoC,SAAS,GAAGrO,SAAS,CAACsO,WAAW,CAAC,GAAG,CAAC;UAC5CP,OAAO,GAAGM,SAAS,GAAG,EAAE,GAAGrO,SAAS,CAAC5J,KAAK,CAAC,CAAC,EAAEiY,SAAS,CAAC,GAAG,GAAG,GAAGrO,SAAS,GAAG,GAAG;QAClF;MACF,CAAC,MAAM;QACL+N,OAAO,GAAGE,SAAS;MACrB;IACF;;IAEA;IACA,IAAI,CAAClb,oBAAoB,CAACkP,IAAI,CAAC;MAC7B0I,QAAQ,EAAE,IAAI,CAAC1X,YAAY,IAAI,MAAM;MACrCoM,OAAO,EAAE/I,SAAS;MAClByX,OAAO;MACPrJ,SAAS,EAAEhE,IAAI,CAACD,GAAG,CAAC;IACtB,CAAC,CAAC;;IAEF;IACA,IAAI,IAAI,CAAC1N,oBAAoB,CAAC2C,MAAM,GAAG,IAAI,CAAC1C,mBAAmB,EAAE;MAC/D,IAAI,CAACD,oBAAoB,CAACqK,KAAK,CAAC,CAAC;IACnC;IAEA,MAAMmR,cAAc,GAAG,IAAI,CAACC,kBAAkB,CAACT,OAAO,CAAC;IACvD;IACA,MAAMU,cAAc,GAAGnY,SAAS,CAAC2I,QAAQ,CAAC,IAAI,CAAC,IAAI8O,OAAO,CAACjM,QAAQ,CAAC,GAAG,CAAC,IAAK,CAACkM,YAAY,IAAI1X,SAAS,CAACZ,MAAM,GAAGqY,OAAO,CAACrY,MAAO;IAChI,MAAMgZ,UAAU,GAAGD,cAAc,GAAG,IAAItI,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,oBAAoB,CAAC,EAAE,GAAG,EAAE;IACnF,OAAO,KAAKlF,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG,CAAC,KAAKkD,cAAc,GAAGG,UAAU,IAAI;EACrE;EAEQF,kBAAkBA,CAACT,OAAe,EAAU;IAClD,IAAI,CAACA,OAAO,EAAE,OAAOA,OAAO;IAC5B,MAAMnE,KAAK,GAAGmE,OAAO,CAAC7Q,WAAW,CAAC,CAAC;IACnC,IAAI0M,KAAK,CAAC3K,QAAQ,CAAC,MAAM,CAAC,IAAI2K,KAAK,CAAC3K,QAAQ,CAAC,OAAO,CAAC,EAAE;MACrD,OAAOkH,YAAK,CAACb,KAAK,CAACyI,OAAO,CAAC;IAC7B;IACA,IAAIA,OAAO,CAAC9P,UAAU,CAAC,GAAG,CAAC,IAAI2L,KAAK,CAAC3K,QAAQ,CAAC,SAAS,CAAC,IAAI2K,KAAK,CAAC3K,QAAQ,CAAC,SAAS,CAAC,IAAI2K,KAAK,CAAC3K,QAAQ,CAAC,SAAS,CAAC,EAAE;MAClH,OAAOkH,YAAK,CAACwI,OAAO,CAACZ,OAAO,CAAC;IAC/B;IACA,OAAO5H,YAAK,CAACgB,IAAI,CAAC4G,OAAO,CAAC;EAC5B;;EAEA;AACF;AACA;EACUa,qBAAqBA,CAACvP,OAAe,EAAU;IACrD,OAAO,IAAI,CAAC0H,cAAc,CAAC1H,OAAO,CAAC;EACrC;;EAEA;AACF;AACA;AACA;EACU0H,cAAcA,CACpB1H,OAAe,EACfiD,OAAsF,GAAG,CAAC,CAAC,EACnF;IACR,MAAM0H,MAAM,GAAG,GAAG;IAClB,MAAM6E,OAAO,GAAGxP,OAAO,CAAC9I,OAAO,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC6M,OAAO,CAAC,CAAC;IAC1D,IAAI,CAACyL,OAAO,CAACnY,IAAI,CAAC,CAAC,EAAE;MACnB,OAAO,EAAE;IACX;;IAEA;IACA,MAAMoY,cAAc,GAAG,IAAI,CAACtQ,SAAS,CAAC,CAAC;IACvC,MAAMD,QAAQ,GAAGhJ,IAAI,CAACC,GAAG,CAAC,EAAE,EAAED,IAAI,CAACE,GAAG,CAAC6M,OAAO,CAAC/D,QAAQ,IAAIuQ,cAAc,GAAG,CAAC,EAAEA,cAAc,CAAC,CAAC;IAC/F,MAAMC,SAAS,GAAGzM,OAAO,CAAC0E,KAAK,GAC3B,GAAG1E,OAAO,CAAC2E,UAAU,GAAG3E,OAAO,CAAC2E,UAAU,CAAC3E,OAAO,CAAC0E,KAAK,CAAC,GAAG1E,OAAO,CAAC0E,KAAK,GAAGb,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,KAAK,CAAC,EAAE,GACnG,EAAE;IACN,MAAM2D,YAAY,GAAG,GAAGhF,MAAM,IAAI+E,SAAS,EAAE;IAC7C,MAAMjE,MAAM,GAAG,GAAG,CAACC,MAAM,CAAC,IAAI,CAACoC,aAAa,CAAC,GAAGnD,MAAM,GAAG,CAAC,CAAC;IAE3D,MAAMjK,KAAK,GAAG8O,OAAO,CAACxO,KAAK,CAAC,IAAI,CAAC;IACjC,MAAM4J,MAAgB,GAAG,EAAE;IAC3B,IAAIgF,aAAa,GAAG,IAAI;IAExB,KAAK,MAAMC,OAAO,IAAInP,KAAK,EAAE;MAC3B,MAAMmG,IAAI,GAAGgJ,OAAO,CAACxY,IAAI,CAAC,CAAC;MAC3B,IAAI,CAACwP,IAAI,EAAE;QACT+D,MAAM,CAAChI,IAAI,CAAC,EAAE,CAAC,CAAC,CAAC;QACjB;MACF;MAEA,MAAMkI,KAAK,GAAGjE,IAAI,CAAC7F,KAAK,CAAC,KAAK,CAAC;MAC/B,IAAIvK,OAAO,GAAG,EAAE;MAChB,KAAK,MAAMuU,IAAI,IAAIF,KAAK,EAAE;QACxB,MAAMgF,SAAS,GAAGrZ,OAAO,GAAG,GAAGA,OAAO,IAAIuU,IAAI,EAAE,GAAGA,IAAI;QACvD,MAAM+E,YAAY,GAAG,IAAI,CAACjC,aAAa,CAAC8B,aAAa,GAAGD,YAAY,GAAGlE,MAAM,CAAC;QAC9E,IAAIsE,YAAY,GAAG,IAAI,CAACjC,aAAa,CAACgC,SAAS,CAAC,GAAG5Q,QAAQ,IAAIzI,OAAO,EAAE;UACtEmU,MAAM,CAAChI,IAAI,CAAC,GAAGgN,aAAa,GAAGD,YAAY,GAAGlE,MAAM,GAAGhV,OAAO,EAAE,CAAC;UACjEA,OAAO,GAAGuU,IAAI;UACd4E,aAAa,GAAG,KAAK;QACvB,CAAC,MAAM;UACLnZ,OAAO,GAAGqZ,SAAS;QACrB;MACF;MAEA,IAAIrZ,OAAO,EAAE;QACXmU,MAAM,CAAChI,IAAI,CAAC,GAAGgN,aAAa,GAAGD,YAAY,GAAGlE,MAAM,GAAGhV,OAAO,EAAE,CAAC;QACjEmZ,aAAa,GAAG,KAAK;MACvB;IACF;IAEA,OAAOhF,MAAM,CAAC9H,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI;EACjC;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;EACUyE,mBAAmBA,CAACvH,OAAe,EAAU;IACnD,IAAI,CAACA,OAAO,CAAC3I,IAAI,CAAC,CAAC,EAAE,OAAO,EAAE;IAE9B,MAAMkM,UAAU,GAAGvD,OAAO,CAAC9I,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC,CAACG,IAAI,CAAC,CAAC;IACtD,OAAO,IAAI,CAACqQ,cAAc,CAACnE,UAAU,EAAE;MACrCoE,KAAK,EAAE,UAAU;MACjBC,UAAU,EAAEd,YAAK,CAACkJ,SAAS,IAAIlJ,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAE;IACjD,CAAC,CAAC;EACJ;EAEQiE,eAAeA,CAAC1Z,IAAY,EAAE2Z,KAAa,EAAY;IAC7D,IAAI,CAAC3Z,IAAI,CAACc,IAAI,CAAC,CAAC,EAAE,OAAO,CAAC,EAAE,CAAC;IAC7B,MAAMqJ,KAAe,GAAG,EAAE;IAC1B,MAAMoK,KAAK,GAAGvU,IAAI,CAACc,IAAI,CAAC,CAAC,CAAC2J,KAAK,CAAC,KAAK,CAAC;IACtC,IAAIvK,OAAO,GAAG,EAAE;IAEhB,KAAK,MAAMuU,IAAI,IAAIF,KAAK,EAAE;MACxB,MAAMgF,SAAS,GAAGrZ,OAAO,GAAG,GAAGA,OAAO,IAAIuU,IAAI,EAAE,GAAGA,IAAI;MACvD,IAAI,IAAI,CAAC8C,aAAa,CAACgC,SAAS,CAAC,GAAGI,KAAK,IAAIzZ,OAAO,EAAE;QACpDiK,KAAK,CAACkC,IAAI,CAACnM,OAAO,CAAC;QACnBA,OAAO,GAAGuU,IAAI;MAChB,CAAC,MAAM;QACLvU,OAAO,GAAGqZ,SAAS;MACrB;IACF;IAEA,IAAIrZ,OAAO,EAAE;MACXiK,KAAK,CAACkC,IAAI,CAACnM,OAAO,CAAC;IACrB;IAEA,OAAOiK,KAAK;EACd;;EAEA;AACF;AACA;EACUyP,sBAAsBA,CAAA,EAAkB;IAC9C,IAAI,CAAC,IAAI,CAACtc,kBAAkB,EAAE,OAAO,IAAI;IACzC,MAAMuc,OAAO,GAAGla,IAAI,CAACma,KAAK,CAAC,CAAChP,IAAI,CAACD,GAAG,CAAC,CAAC,GAAG,IAAI,CAACvN,kBAAkB,IAAI,IAAI,CAAC;IACzE,IAAIuc,OAAO,GAAG,CAAC,EAAE,OAAO,IAAI,CAAC,CAAC;IAC9B,MAAME,IAAI,GAAGpa,IAAI,CAACma,KAAK,CAACD,OAAO,GAAG,EAAE,CAAC;IACrC,MAAMG,IAAI,GAAGH,OAAO,GAAG,EAAE;IACzB,IAAIE,IAAI,GAAG,CAAC,EAAE;MACZ,OAAO,GAAGA,IAAI,KAAKC,IAAI,GAAG;IAC5B;IACA,OAAO,GAAGA,IAAI,GAAG;EACnB;;EAEA;AACF;AACA;AACA;EACUC,kBAAkBA,CAACxQ,OAAe,EAAE2H,KAAa,GAAG,SAAS,EAAU;IAC7E,MAAMzI,QAAQ,GAAGhJ,IAAI,CAACE,GAAG,CAAC,IAAI,CAAC1D,IAAI,EAAE,EAAE,CAAC;IACxC,MAAMgd,SAAS,GAAG,IAAI/H,KAAK,GAAG;IAC9B,MAAM8I,OAAO,GAAGva,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE+I,QAAQ,GAAGwQ,SAAS,CAACrZ,MAAM,CAAC;IACxD,MAAMqa,OAAO,GAAGxa,IAAI,CAACma,KAAK,CAACI,OAAO,GAAG,CAAC,CAAC;IACvC,MAAME,QAAQ,GAAGza,IAAI,CAAC0a,IAAI,CAACH,OAAO,GAAG,CAAC,CAAC;;IAEvC;IACA,MAAMtE,SAAS,GAAGrF,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG,CAACN,MAAM,CAACgF,OAAO,CAAC,GAAGhB,SAAS,GAAG,GAAG,CAAChE,MAAM,CAACiF,QAAQ,CAAC,CAAC;IAExF,OAAO,KAAKxE,SAAS,KAAKnM,OAAO,IAAI;EACvC;;EAEA;AACF;AACA;AACA;EACE6Q,eAAeA,CAAC7Q,OAAe,EAAE2H,KAAa,GAAG,SAAS,EAAQ;IAChE,MAAMmJ,gBAAgB,GAAG,IAAI,CAACN,kBAAkB,CAACxQ,OAAO,EAAE2H,KAAK,CAAC;IAChE,IAAI,CAAC/U,UAAU,CAACgQ,IAAI,CAAC;MACnBkC,IAAI,EAAE,UAAU;MAChBM,OAAO,EAAE,UAAU;MACnBpF,OAAO,EAAE8Q,gBAAgB;MACzBzL,SAAS,EAAEhE,IAAI,CAACD,GAAG,CAAC,CAAC;MACrBkF,WAAW,EAAE;IACf,CAAC,CAAC;IACF,IAAI,CAAC,IAAI,CAACzT,iBAAiB,EAAE;MAC3B,KAAK,IAAI,CAAC6S,YAAY,CAAC,CAAC;IAC1B;EACF;;EAEA;AACF;AACA;AACA;EACEqL,oBAAoBA,CAAA,EAAY;IAC9B;IACA,MAAMC,SAAS,GAAG,IAAI,CAACtd,oBAAoB,CAACoV,GAAG,CAAC,CAAC;IACjD,IAAI,CAACkI,SAAS,IAAI,CAAC,IAAI,CAACvd,cAAc,EAAE;MACtC,OAAO,KAAK;IACd;IAEA,MAAMuM,OAAO,GAAGgR,SAAS,EAAEhR,OAAO,IAAI,IAAI,CAACvM,cAAc,IAAI,EAAE;IAC/D,MAAM6X,QAAQ,GAAG0F,SAAS,EAAE1F,QAAQ,IAAI,QAAQ;;IAEhD;IACA,MAAM2F,YAAY,GAAG,IAAI,CAACC,sBAAsB,CAAC5F,QAAQ,EAAEtL,OAAO,CAAC;IAEnE,IAAImR,QAAgB;IACpB,IAAIF,YAAY,EAAE;MAChB;MACAE,QAAQ,GAAG,IAAI,CAACC,0BAA0B,CAAC9F,QAAQ,EAAEtL,OAAO,CAAC;IAC/D,CAAC,MAAM;MACL;MACA,MAAM2H,KAAK,GAAG,GAAG2D,QAAQ,EAAE;MAC3B6F,QAAQ,GAAG,IAAI,CAACzJ,cAAc,CAAC1H,OAAO,EAAE;QAAE2H,KAAK;QAAEC,UAAU,EAAEd,YAAK,CAACgB;MAAK,CAAC,CAAC;IAC5E;IAEA,IAAI,CAAClV,UAAU,CAACgQ,IAAI,CAAC;MACnBkC,IAAI,EAAE,UAAU;MAChBM,OAAO,EAAE,UAAU;MACnBpF,OAAO,EAAEmR,QAAQ;MACjB9L,SAAS,EAAEhE,IAAI,CAACD,GAAG,CAAC,CAAC;MACrBkF,WAAW,EAAE;IACf,CAAC,CAAC;;IAEF;IACA,IAAI0K,SAAS,EAAE;MACb,IAAI,CAACvd,cAAc,GAAG,IAAI;IAC5B;IAEA,IAAI,CAAC,IAAI,CAACZ,iBAAiB,EAAE;MAC3B,KAAK,IAAI,CAAC6S,YAAY,CAAC,CAAC;IAC1B;IACA,OAAO,IAAI;EACb;;EAEA;AACF;AACA;EACUwL,sBAAsBA,CAAC5F,QAAgB,EAAEtL,OAAe,EAAW;IACzE,MAAMqL,IAAI,GAAGC,QAAQ,CAACzN,WAAW,CAAC,CAAC;IACnC;IACA,IAAI,CAAC,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,cAAc,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAC+B,QAAQ,CAACyL,IAAI,CAAC,EAAE;MACrF,OAAO,IAAI;IACb;IACA;IACA;IACA;IACA;IACA,IAAI,sBAAsB,CAACnN,IAAI,CAAC8B,OAAO,CAAC,EAAE,OAAO,IAAI,CAAC,CAAC;IACvD,IAAI,iBAAiB,CAAC9B,IAAI,CAAC8B,OAAO,CAAC,EAAE,OAAO,IAAI,CAAC,CAAC;IAClD,IAAI,oBAAoB,CAAC9B,IAAI,CAAC8B,OAAO,CAAC,EAAE,OAAO,IAAI,CAAC,CAAC;IACrD,IAAI,gBAAgB,CAAC9B,IAAI,CAAC8B,OAAO,CAAC,EAAE,OAAO,IAAI,CAAC,CAAC;IACjD,OAAO,KAAK;EACd;;EAEA;AACF;AACA;EACUoR,0BAA0BA,CAAC9F,QAAgB,EAAEtL,OAAe,EAAU;IAC5E,MAAMU,KAAK,GAAGV,OAAO,CAACgB,KAAK,CAAC,IAAI,CAAC;IACjC,MAAMqQ,MAAM,GAAG,KAAKvK,YAAK,CAACgB,IAAI,CAACwD,QAAQ,CAAC,GAAGxE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,aAAa,CAAC,IAAI;IAC5E,MAAMP,MAAM,GAAG,IAAI;IACnB,MAAMvM,QAAQ,GAAG,IAAI,CAACC,SAAS,CAAC,CAAC,GAAG,CAAC;IAErC,MAAMmS,cAAc,GAAG5Q,KAAK,CAACtB,GAAG,CAACyH,IAAI,IAAI;MACvC;MACA,IAAIA,IAAI,CAACxQ,MAAM,GAAG6I,QAAQ,EAAE;QAC1B,OAAOuM,MAAM,GAAG5E,IAAI,CAAC9P,KAAK,CAAC,CAAC,EAAEmI,QAAQ,GAAG,CAAC,CAAC,GAAG,GAAG;MACnD;MACA,OAAOuM,MAAM,GAAG5E,IAAI;IACtB,CAAC,CAAC;IAEF,OAAOwK,MAAM,GAAGC,cAAc,CAACxO,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI;EAClD;;EAEA;AACF;AACA;EACEyO,uBAAuBA,CAAA,EAAW;IAChC,OAAO,IAAI,CAAC7d,oBAAoB,CAAC2C,MAAM;EACzC;;EAEA;AACF;AACA;EACEiI,qBAAqBA,CAAA,EAAS;IAC5B,IAAI,CAAC5K,oBAAoB,GAAG,EAAE;IAC9B,IAAI,CAACD,cAAc,GAAG,IAAI;EAC5B;;EAEA;;EAEA+d,OAAOA,CAAChe,IAA0B,EAAQ;IACxC,MAAMie,YAAY,GAAG,IAAI,CAACje,IAAI,KAAK,WAAW;IAC9C,IAAI,CAACA,IAAI,GAAGA,IAAI;;IAEhB;IACA,IAAIA,IAAI,KAAK,WAAW,IAAI,CAACie,YAAY,EAAE;MACzC,IAAI,CAAC5d,kBAAkB,GAAGwN,IAAI,CAACD,GAAG,CAAC,CAAC;MACpC,IAAI,CAACnM,eAAe,GAAG,CAAC,CAAC,CAAC;MAC1B;MACA,IAAI,IAAI,CAACyC,WAAW,CAACrB,MAAM,GAAG,CAAC,EAAE;QAC/B,IAAI,CAACqB,WAAW,GAAG,EAAE;MACvB;IACF,CAAC,MAAM,IAAIlE,IAAI,KAAK,MAAM,IAAIie,YAAY,EAAE;MAC1C,IAAI,CAAC5d,kBAAkB,GAAG,IAAI;IAChC;;IAEA;IACA,MAAM6d,UAAU,GAAG,IAAI,CAACle,IAAI,KAAK,WAAW,IAAI,CAAC,IAAI,CAACW,YAAY;IAClE,IAAIud,UAAU,EAAE;MACd,IAAI,CAACC,qBAAqB,CAAC,CAAC;IAC9B,CAAC,MAAM;MACL,IAAI,CAACC,oBAAoB,CAAC,CAAC;IAC7B;IAEA,IAAIH,YAAY,IAAIje,IAAI,KAAK,MAAM,IAAI,CAAC,IAAI,CAACqF,0BAA0B,EAAE;MACvE;MACA,IAAI,CAAC4C,KAAK,CAAC,IAAI,CAAC;MAChB,IAAI,CAAC5C,0BAA0B,GAAG,IAAI;IACxC;IACA,IAAI,CAAC,IAAI,CAAC2B,SAAS,EAAE;MACnB;MACA,IAAI,CAACW,YAAY,CAAC,CAAC;IACrB;EACF;;EAEA;AACF;AACA;EACE0W,YAAYA,CAACtb,IAAY,GAAGxC,uBAAU,CAACC,OAAO,EAAQ;IACpD,IAAI,CAACG,YAAY,GAAG;MAAEoC,IAAI,EAAEA,IAAI,IAAIxC,uBAAU,CAACC,OAAO;MAAE8d,IAAI,EAAE;IAAO,CAAC;IACtE;IACA,IAAI,IAAI,CAACvd,eAAe,EAAE;MACxB,IAAI,CAACqd,oBAAoB,CAAC,CAAC;IAC7B;IACA,IAAI,CAAC,IAAI,CAACpX,SAAS,EAAE;MACnB,IAAI,CAACW,YAAY,CAAC,CAAC;IACrB;EACF;;EAEA;AACF;AACA;EACE8J,iBAAiBA,CAAA,EAAS;IACxB,IAAI,CAAC9Q,YAAY,GAAG,IAAI;IACxB,IAAI,IAAI,CAACX,IAAI,KAAK,WAAW,EAAE;MAC7B,IAAI,CAACme,qBAAqB,CAAC,CAAC;IAC9B;IACA,IAAI,CAAC,IAAI,CAACnX,SAAS,EAAE;MACnB,IAAI,CAACW,YAAY,CAAC,CAAC;IACrB;EACF;;EAEA;AACF;AACA;EACUwW,qBAAqBA,CAAA,EAAS;IACpC,IAAI,IAAI,CAACxd,YAAY,EAAE;MACrB,OAAO,CAAC;IACV;IACA,IAAI,IAAI,CAACI,eAAe,EAAE,OAAO,CAAC;IAClC,IAAI,CAACD,YAAY,GAAG,CAAC;IACrB,IAAI,CAACS,iBAAiB,GAAG,CAAC;IAC1B,IAAI,CAACG,iBAAiB,GAAG,CAAC;IAC1B,IAAI,CAACX,eAAe,GAAGwd,WAAW,CAAC,MAAM;MACvC,IAAI,CAACzd,YAAY,GAAG,CAAC,IAAI,CAACA,YAAY,GAAG,CAAC,IAAI0d,oBAAa,CAACC,OAAO,CAAC5b,MAAM;MAC1E,IAAI,CAACtB,iBAAiB,GAAG,CAAC,IAAI,CAACA,iBAAiB,GAAG,CAAC,IAAI,IAAI,CAACC,kBAAkB,CAACqB,MAAM;MACtF;MACA,IAAI,IAAI,CAAC/B,YAAY,GAAG,CAAC,KAAK,CAAC,EAAE;QAC/B,IAAI,CAACY,iBAAiB,GAAG,CAAC,IAAI,CAACA,iBAAiB,GAAG,CAAC,IAAI,IAAI,CAACC,kBAAkB,CAACkB,MAAM;MACxF;MACA;MACA,IAAI,CAAC,IAAI,CAACmE,SAAS,IAAI,IAAI,CAAChH,IAAI,KAAK,WAAW,EAAE;QAChD,IAAI,CAAC2H,YAAY,CAAC,CAAC;MACrB;IACF,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;EACX;;EAEA;AACF;AACA;EACUyW,oBAAoBA,CAAA,EAAS;IACnC,IAAI,IAAI,CAACrd,eAAe,EAAE;MACxBuH,aAAa,CAAC,IAAI,CAACvH,eAAe,CAAC;MACnC,IAAI,CAACA,eAAe,GAAG,IAAI;IAC7B;IACA,IAAI,CAACD,YAAY,GAAG,CAAC;IACrB,IAAI,CAACS,iBAAiB,GAAG,CAAC;IAC1B,IAAI,CAACF,eAAe,GAAG,IAAI;IAC3B,IAAI,CAACK,iBAAiB,GAAG,CAAC;EAC5B;;EAEA;AACF;AACA;AACA;EACEgd,WAAWA,CAAChM,OAAsB,EAAQ;IACxC,IAAI,CAACrR,eAAe,GAAGqR,OAAO;IAC9B,IAAI,CAAC,IAAI,CAAC1L,SAAS,EAAE;MACnB,IAAI,CAACW,YAAY,CAAC,CAAC;IACrB;EACF;;EAEA;AACF;AACA;EACEgX,qBAAqBA,CAACC,MAAc,EAAQ;IAC1C,IAAI,CAACnd,eAAe,GAAGmd,MAAM;EAC/B;;EAEA;AACF;AACA;EACUC,gBAAgBA,CAACD,MAAc,EAAU;IAC/C,IAAIA,MAAM,GAAG,IAAI,EAAE,OAAOE,MAAM,CAACF,MAAM,CAAC;IACxC,IAAIA,MAAM,GAAG,KAAK,EAAE,OAAO,GAAG,CAACA,MAAM,GAAG,IAAI,EAAEG,OAAO,CAAC,CAAC,CAAC,GAAG;IAC3D,OAAO,GAAGrc,IAAI,CAACsc,KAAK,CAACJ,MAAM,GAAG,IAAI,CAAC,GAAG;EACxC;EAEAK,OAAOA,CAAA,EAAyB;IAC9B,OAAO,IAAI,CAACjf,IAAI;EAClB;EAEAkf,YAAYA,CAACxM,OAAsB,EAAQ;IACzC,IAAI,CAACpF,kBAAkB,CAAC;MAAEC,IAAI,EAAEmF,OAAO;MAAEyM,QAAQ,EAAE,IAAI;MAAEC,SAAS,EAAE;IAAK,CAAC,CAAC;EAC7E;EAEA9R,kBAAkBA,CAChB+R,MAAqF,EACrF5P,OAA6B,GAAG,CAAC,CAAC,EAC5B;IACN,MAAM6P,aAAa,GAAG,IAAI,CAAC5e,eAAe;IAC1C,IAAI6e,OAAO,GAAG,KAAK;IACnB,IAAIC,WAAW,GAAG,KAAK;IACvB,IAAIC,eAAe,GAAG,KAAK;IAE3B,IAAIJ,MAAM,CAAC9R,IAAI,KAAKiH,SAAS,IAAI6K,MAAM,CAAC9R,IAAI,KAAK,IAAI,CAACjN,aAAa,EAAE;MACnE,IAAI,CAACA,aAAa,GAAG+e,MAAM,CAAC9R,IAAI;MAChCgS,OAAO,GAAG,IAAI;MACdC,WAAW,GAAG,IAAI;IACpB;IACA,IAAIH,MAAM,CAACF,QAAQ,KAAK3K,SAAS,IAAI6K,MAAM,CAACF,QAAQ,KAAK,IAAI,CAAC1e,cAAc,EAAE;MAC5E,IAAI,CAACA,cAAc,GAAG4e,MAAM,CAACF,QAAQ;MACrCI,OAAO,GAAG,IAAI;MACdE,eAAe,GAAG,IAAI;IACxB;IAEA,MAAMC,gBAAgB,GAAGL,MAAM,CAACD,SAAS,KAAK5K,SAAS,IAAI6K,MAAM,CAACD,SAAS,KAAKE,aAAa;IAC7F,IAAID,MAAM,CAACD,SAAS,KAAK5K,SAAS,EAAE;MAClC,IAAIkL,gBAAgB,EAAE;QACpBH,OAAO,GAAG,IAAI;MAChB;MACA,IAAI,CAAC7e,eAAe,GAAG2e,MAAM,CAACD,SAAS;IACzC;IAEA,MAAMO,kBAAkB,GACtBD,gBAAgB,IAAIJ,aAAa,KAAK,IAAI,IAAID,MAAM,CAACD,SAAS,KAAK,IAAI,IAAI,IAAI,CAACpf,IAAI,KAAK,WAAW;IACtG,MAAM4f,gBAAgB,GACpBF,gBAAgB,IAAIL,MAAM,CAACD,SAAS,KAAK,IAAI,IAAI,IAAI,CAACpf,IAAI,KAAK,WAAW;IAC5E,MAAM6f,oBAAoB,GAAGH,gBAAgB,IAAI,CAACF,WAAW,IAAI,CAACC,eAAe;IACjF,MAAMK,mBAAmB,GACvBD,oBAAoB,IAAI,IAAI,CAAC7f,IAAI,KAAK,WAAW,IAAI,CAAC2f,kBAAkB,IAAI,CAACC,gBAAgB;IAE/F,MAAMG,YAAY,GAAGtQ,OAAO,CAACzG,MAAM,KAAK,KAAK,IAAIuW,OAAO,IAAI,CAACO,mBAAmB;IAChF,IAAIC,YAAY,EAAE;MAChB,IAAI,CAACpY,YAAY,CAAC,CAAC;IACrB;EACF;EAEAqY,gBAAgBA,CACdxV,IAeC,EACDiF,OAA6B,GAAG,CAAC,CAAC,EAC5B;IACN,MAAM0B,IAAI,GAAG;MAAE,GAAG,IAAI,CAAClP,UAAU;MAAE,GAAGuI;IAAK,CAAC;IAC5C,MAAM+U,OAAO,GAAGU,IAAI,CAACC,SAAS,CAAC/O,IAAI,CAAC,KAAK8O,IAAI,CAACC,SAAS,CAAC,IAAI,CAACje,UAAU,CAAC;IACxE,IAAI,CAACA,UAAU,GAAGkP,IAAI;IACtB,MAAM4O,YAAY,GAAGtQ,OAAO,CAACzG,MAAM,KAAK,KAAK,IAAIuW,OAAO;IACxD,IAAIQ,YAAY,EAAE;MAChB,IAAI,CAACpY,YAAY,CAAC,CAAC;IACrB;EACF;EAEAwY,iBAAiBA,CAACC,KAA+B,EAAQ;IACvD,IAAI,CAACle,WAAW,GAAG;MAAE,GAAG,IAAI,CAACA,WAAW;MAAE,GAAGke;IAAM,CAAC;IACpD,IACE,CAACA,KAAK,CAACC,kBAAkB,IACzB,CAACD,KAAK,CAACE,cAAc,IACrB,CAACF,KAAK,CAACG,sBAAsB,IAC7B,CAACH,KAAK,CAACI,kBAAkB,IACzB,CAACJ,KAAK,CAACK,YAAY,IACnB,CAACL,KAAK,CAACM,WAAW,EAClB;MACA,IAAI,CAAC7gB,mBAAmB,CAAC8gB,KAAK,CAAC,CAAC;IAClC;IACA,IAAI,CAAChZ,YAAY,CAAC,CAAC;EACrB;;EAEA;AACF;AACA;AACA;EACEiZ,cAAcA,CAACvB,MAA8B,EAAQ;IACnD,MAAMlO,IAAI,GAAG;MAAE,GAAG,IAAI,CAAC3O,QAAQ;MAAE,GAAG6c;IAAO,CAAC;IAC5C,MAAME,OAAO,GAAGU,IAAI,CAACC,SAAS,CAAC/O,IAAI,CAAC,KAAK8O,IAAI,CAACC,SAAS,CAAC,IAAI,CAAC1d,QAAQ,CAAC;IACtE,IAAI,CAACA,QAAQ,GAAG2O,IAAI;IACpB,IAAIoO,OAAO,EAAE;MACX,IAAI,CAAC5X,YAAY,CAAC,CAAC;IACrB;EACF;;EAEA;AACF;AACA;EACEkZ,aAAaA,CAAA,EAAS;IACpB,IAAI,CAACre,QAAQ,GAAG,CAAC,CAAC;IAClB,IAAI,CAACmF,YAAY,CAAC,CAAC;EACrB;;EAEA;AACF;AACA;EACEmZ,WAAWA,CAAA,EAA4B;IACrC,OAAO,IAAI,CAACte,QAAQ;EACtB;EAEAue,cAAcA,CAAC7T,KAAe,EAAQ;IACpC,MAAM6C,UAAU,GAAG,CAAC7C,KAAK,IAAI,EAAE,EAAEtB,GAAG,CAACyH,IAAI,IAAIA,IAAI,CAAC3P,OAAO,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC;IACvE,MAAMsd,UAAU,GAAGjR,UAAU,CAACzB,IAAI,CAAE+E,IAAI,IAAKA,IAAI,CAACxP,IAAI,CAAC,CAAC,CAAChB,MAAM,GAAG,CAAC,CAAC;IACpE,IAAI,CAACme,UAAU,EAAE;MACf,IAAI,IAAI,CAAC9c,WAAW,CAACrB,MAAM,EAAE;QAC3B,IAAI,CAACqB,WAAW,GAAG,EAAE;QACrB,IAAI,CAACyD,YAAY,CAAC,CAAC;MACrB;MACA;IACF;IACA,MAAM4N,OAAO,GAAG,IAAI,CAAC0L,gBAAgB,CAAClR,UAAU,CAAC;IACjD,IAAIkQ,IAAI,CAACC,SAAS,CAAC3K,OAAO,CAAC,KAAK0K,IAAI,CAACC,SAAS,CAAC,IAAI,CAAChc,WAAW,CAAC,EAAE;MAChE;IACF;IACA,IAAI,CAACA,WAAW,GAAGqR,OAAO;IAC1B,IAAI,CAAC5N,YAAY,CAAC,CAAC;EACrB;EAEAuZ,mBAAmBA,CAAA,EAAY;IAC7B,OAAO,IAAI,CAACta,WAAW,IAAI,CAAC,IAAI,CAACI,SAAS;EAC5C;EAEAma,gBAAgBA,CAAA,EAAS;IACvB,IAAI,CAAC,IAAI,CAACjd,WAAW,CAACrB,MAAM,EAAE;IAC9B,IAAI,CAACqB,WAAW,GAAG,EAAE;IACrB,IAAI,CAACyD,YAAY,CAAC,CAAC;EACrB;;EAEA;AACF;AACA;AACA;EACEyZ,iBAAiBA,CAAA,EAAS;IACxB,IAAI,CAAC5b,WAAW,GAAG,IAAI;IACvB,IAAI,CAACC,mBAAmB,GAAG,IAAI;IAC/B,IAAI,CAACxB,iBAAiB,GAAG,CAAC;IAC1B,IAAI,CAACD,YAAY,GAAG,CAAC;IACrB,IAAI,CAACsB,iBAAiB,GAAG,KAAK;IAC9B,IAAI,CAACC,sBAAsB,GAAG,KAAK;IACnC,IAAI,CAACM,aAAa,GAAG,KAAK;IAC1B,IAAI,CAACC,cAAc,GAAG,CAAC;EACzB;;EAEA;;EAEA;AACF;AACA;AACA;EACEub,QAAQA,CAAC7U,OAAe,EAAQ;IAC9B,IAAI,CAACA,OAAO,EAAE;IACd,IAAI,CAAC6E,QAAQ,CAAC,KAAK,EAAE7E,OAAO,CAAC;EAC/B;;EAEA;AACF;AACA;EACE8U,SAASA,CAAC5O,OAAe,EAAED,KAAe,EAAQ;IAChD,MAAM1C,UAAU,GAAG2C,OAAO,EAAE7O,IAAI,CAAC,CAAC,IAAI,EAAE;IACxC,MAAM0d,OAAO,GAAG,IAAI,CAACC,kBAAkB,CAAC/O,KAAK,CAAC;IAC9C,MAAMgP,KAAK,GAAG,CAAC,GAAGnO,YAAK,CAACb,KAAK,CAAC,GAAG,CAAC,IAAI1C,UAAU,IAAI,OAAO,EAAE,CAAC;IAC9D,IAAIwR,OAAO,EAAE;MACXE,KAAK,CAACrS,IAAI,CAAC,KAAKmS,OAAO,EAAE,CAAC;IAC5B;IACA,IAAI,CAAClQ,QAAQ,CAAC,UAAU,EAAE,GAAGoQ,KAAK,CAACnS,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC;EACpD;;EAEA;AACF;AACA;EACEoS,iBAAiBA,CAAClV,OAAe,EAAQ;IACvC,MAAMuD,UAAU,GAAGvD,OAAO,EAAE3I,IAAI,CAAC,CAAC;IAClC,IAAI,CAACkM,UAAU,EAAE;IACjB,IAAI,CAACsB,QAAQ,CAAC,UAAU,EAAE,GAAGtB,UAAU,MAAM,CAAC;EAChD;;EAEA;AACF;AACA;EACE4R,WAAWA,CAACjP,OAAe,EAAQ;IACjC,MAAM3C,UAAU,GAAG2C,OAAO,EAAE7O,IAAI,CAAC,CAAC;IAClC,IAAI,CAACkM,UAAU,EAAE;IACjB,IAAI,CAACsB,QAAQ,CAAC,UAAU,EAAE,GAAGiC,YAAK,CAACwI,OAAO,CAAC,GAAG,CAAC,IAAI/L,UAAU,IAAI,CAAC;EACpE;;EAEA;AACF;AACA;EACE6R,WAAWA,CAAClP,OAAe,EAAQ;IACjC,MAAM3C,UAAU,GAAG2C,OAAO,EAAE7O,IAAI,CAAC,CAAC;IAClC,IAAI,CAACkM,UAAU,EAAE;IACjB,IAAI,CAACsB,QAAQ,CAAC,UAAU,EAAE,GAAGiC,YAAK,CAACe,OAAO,CAAC,GAAG,CAAC,IAAItE,UAAU,IAAI,CAAC;EACpE;;EAEA;AACF;AACA;EACE8R,QAAQA,CAACnP,OAAe,EAAQ;IAC9B,MAAM3C,UAAU,GAAG2C,OAAO,EAAE7O,IAAI,CAAC,CAAC;IAClC,IAAI,CAACkM,UAAU,EAAE;IACjB,IAAI,CAACsB,QAAQ,CAAC,UAAU,EAAE,GAAGiC,YAAK,CAACgB,IAAI,CAAC,GAAG,CAAC,IAAIvE,UAAU,IAAI,CAAC;EACjE;;EAEA;AACF;AACA;EACUyR,kBAAkBA,CAAC/O,KAAe,EAAiB;IACzD,IAAI,CAACA,KAAK,EAAE,OAAO,IAAI;IACvB,IAAIA,KAAK,YAAYrK,KAAK,EAAE;MAC1B,OAAOqK,KAAK,CAACqP,KAAK,IAAIrP,KAAK,CAACC,OAAO;IACrC;IACA,IAAI,OAAOD,KAAK,KAAK,QAAQ,EAAE;MAC7B,OAAOA,KAAK;IACd;IACA,IAAI;MACF,OAAOwN,IAAI,CAACC,SAAS,CAACzN,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC;IACvC,CAAC,CAAC,MAAM;MACN,OAAO,qCAAqC;IAC9C;EACF;EAEQwO,gBAAgBA,CAAC/T,KAAe,EAAY;IAClD,MAAM6U,QAAQ,GAAGrf,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACE,GAAG,CAAC,IAAI,CAAC5B,mBAAmB,EAAE0B,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC1D,IAAI,GAAG,CAAC,CAAC,CAAC,CAAC;IAC5F,IAAIiO,KAAK,CAACrK,MAAM,IAAIkf,QAAQ,EAAE;MAC5B,OAAO7U,KAAK;IACd;IACA,MAAM8U,QAAQ,GAAG9U,KAAK,CAACrK,MAAM,GAAGkf,QAAQ;IACxC,MAAME,SAAS,GAAG3O,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,KAAKwJ,QAAQ,aAAa,CAAC;IAC5D,MAAME,SAAS,GAAGxf,IAAI,CAACC,GAAG,CAAC,CAAC,EAAEof,QAAQ,GAAG,CAAC,CAAC;IAC3C,MAAMI,IAAI,GAAGjV,KAAK,CAAC3J,KAAK,CAAC,CAAC2e,SAAS,CAAC;IACpC,OAAO,CAACD,SAAS,EAAE,GAAGE,IAAI,CAAC;EAC7B;;EAEA;;EAEQxa,YAAYA,CAAA,EAAS;IAC3B;IACA,IAAI,IAAI,CAAC1B,QAAQ,EAAE;;IAEnB;IACA,MAAM2H,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;IACtB,IAAIA,GAAG,GAAG,IAAI,CAAC9H,cAAc,GAAG,IAAI,CAACC,gBAAgB,EAAE;MACrD,IAAI,CAAC,IAAI,CAACF,aAAa,EAAE;QACvB,IAAI,CAACA,aAAa,GAAG,IAAI;QACzB;QACA,IAAI,CAACG,mBAAmB,GAAG6F,UAAU,CAAC,MAAM;UAC1C,IAAI,CAAC7F,mBAAmB,GAAG,IAAI;UAC/B,IAAI,CAACH,aAAa,GAAG,KAAK;UAC1B,IAAI,CAAC,IAAI,CAACI,QAAQ,EAAE;YAClB,IAAI,CAACoM,qBAAqB,CAAC,CAAC;UAC9B;QACF,CAAC,EAAE,IAAI,CAACtM,gBAAgB,CAAC;MAC3B;MACA;IACF;IACA,IAAI,CAACsM,qBAAqB,CAAC,CAAC;EAC9B;EAEQA,qBAAqBA,CAAA,EAAS;IACpC;IACA,IAAI,IAAI,CAACpM,QAAQ,EAAE;IAEnB,IAAI,CAACH,cAAc,GAAG+H,IAAI,CAACD,GAAG,CAAC,CAAC;IAEhC,IAAI,CAAC,IAAI,CAAChH,WAAW,EAAE;MACrB,IAAI,CAACxC,cAAc,GAAG,KAAK;MAC3B;IACF;IAEA,IAAI,IAAI,CAACuB,wBAAwB,EAAE;MACjC,IAAI,CAACvB,cAAc,GAAG,KAAK;MAC3B;IACF;IAEA,IAAI,IAAI,CAAC4C,SAAS,EAAE;MAClB,MAAMqM,IAAI,GAAG,KAAK,IAAI,CAAC/T,MAAM,EAAE;MAC/B,IAAI,CAAC,IAAI,CAAC8E,cAAc,IAAI,CAAC,IAAI,CAACiB,0BAA0B,EAAE;QAC5D,IAAI,CAAC4C,KAAK,CAAC,IAAI,CAAC;QAChB,IAAI,CAAC5C,0BAA0B,GAAG,IAAI;MACxC;MACA,IAAI,CAAC4C,KAAK,CAAC,KAAKxK,GAAG,CAACI,UAAU,GAAGwV,IAAI,EAAE,CAAC;MACxC,IAAI,CAAC3O,mBAAmB,GAAG2O,IAAI,CAACxQ,MAAM,GAAG,CAAC;MAC1C,IAAI,CAACyC,iBAAiB,GAAG,IAAI;MAC7B,IAAI,CAAClB,cAAc,GAAG,IAAI;MAC1B,IAAI,CAACiB,0BAA0B,GAAG,KAAK,CAAC,CAAC;MACzC,IAAI,CAACrB,YAAY,GAAG,CAAC;MACrB;IACF;IAEA,IAAI,CAAC,IAAI,CAAC0B,iBAAiB,EAAE;MAC3B;IACF;;IAEA;IACA,IAAI,CAACgC,kBAAkB,CAAC,CAAC;IACzB,MAAMgE,QAAQ,GAAG,IAAI,CAACC,SAAS,CAAC,CAAC;IACjC,IAAI,CAACxM,eAAe,GAAGuM,QAAQ;IAE/B,MAAM0W,OAAO,GAAG,IAAI,CAACC,iBAAiB,CAAC,CAAC;IACxC,IAAI,CAACD,OAAO,CAAClV,KAAK,CAACrK,MAAM,EAAE;MACzB;IACF;IAEA,MAAMyf,aAAa,GAAGF,OAAO,CAAClV,KAAK,CAACtB,GAAG,CAACyH,IAAI,IAAI,IAAI,CAACkP,YAAY,CAAClP,IAAI,EAAE3H,QAAQ,CAAC,CAAC;IAClF,IAAI,CAAC4W,aAAa,CAACzf,MAAM,EAAE;MACzB;IACF;IAEA,MAAM2f,WAAW,GAAG9f,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACE,GAAG,CAACwf,OAAO,CAACI,WAAW,EAAEF,aAAa,CAACzf,MAAM,GAAG,CAAC,CAAC,CAAC;IACxF,MAAM4f,MAAM,GAAGH,aAAa,CAACzf,MAAM;IACnC,MAAM6f,SAAS,GAAGhgB,IAAI,CAACE,GAAG,CAACF,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE,CAAC,GAAG,IAAI,CAACpD,MAAM,CAAC,EAAE,IAAI,CAACL,IAAI,IAAI,EAAE,CAAC;IAEzE,MAAMyjB,gBAAgB,GACpB,IAAI,CAACld,mBAAmB,IACxB,IAAI,CAACmd,WAAW,CAAC,IAAI,CAACnd,mBAAmB,CAACyH,KAAK,EAAEoV,aAAa,CAAC,IAC/D,IAAI,CAAC7c,mBAAmB,CAAC+c,WAAW,KAAKA,WAAW,IACpD,IAAI,CAAC/c,mBAAmB,CAACid,SAAS,KAAKA,SAAS;;IAElD;IACA,IAAIC,gBAAgB,EAAE;MACpB;MACA,IAAI,CAAC1a,KAAK,CAAC,iBAAiBya,SAAS,YAAY,CAAC;MAClD,IAAI,CAACte,cAAc,GAAG,IAAI;MAC1B,IAAI,CAACJ,YAAY,GAAGye,MAAM;MAC1B,IAAI,CAACxe,iBAAiB,GAAGwe,MAAM;MAC/B,IAAI,CAAC/d,mBAAmB,GAAGge,SAAS;MACpC;IACF;;IAEA;IACA,MAAMpjB,MAAgB,GAAG,EAAE;;IAE3B;IACAA,MAAM,CAAC8P,IAAI,CAAC,WAAW,CAAC;;IAExB;IACA;IACA,MAAMyT,UAAU,GAAG,IAAI,CAAC5e,iBAAiB,IAAI,CAAC;IAC9C,MAAM6e,aAAa,GAAG,IAAI,CAACtd,WAAW,EAAEgd,WAAW,IAAI,CAAC;IAExD,IAAIK,UAAU,GAAG,CAAC,EAAE;MAClB;MACA;MACA,MAAME,YAAY,GAAGD,aAAa;MAClC,IAAIC,YAAY,GAAG,CAAC,EAAE;QACpBzjB,MAAM,CAAC8P,IAAI,CAAC,QAAQ2T,YAAY,GAAG,CAAC;MACtC;;MAEA;MACA,KAAK,IAAIjmB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG+lB,UAAU,EAAE/lB,CAAC,EAAE,EAAE;QACnCwC,MAAM,CAAC8P,IAAI,CAAC,KAAK3R,GAAG,CAACI,UAAU,EAAE,CAAC;QAClC,IAAIf,CAAC,GAAG+lB,UAAU,GAAG,CAAC,EAAE;UACtBvjB,MAAM,CAAC8P,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;QACzB;MACF;;MAEA;MACA9P,MAAM,CAAC8P,IAAI,CAAC,QAAQ,CAAC;;MAErB;MACA,IAAIyT,UAAU,GAAG,CAAC,EAAE;QAClBvjB,MAAM,CAAC8P,IAAI,CAAC,QAAQyT,UAAU,GAAG,CAAC,GAAG,CAAC;MACxC;IACF;;IAEA;IACA,KAAK,IAAI/lB,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGwlB,aAAa,CAACzf,MAAM,EAAE/F,CAAC,EAAE,EAAE;MAC7CwC,MAAM,CAAC8P,IAAI,CAAC,KAAK3R,GAAG,CAACI,UAAU,EAAE,CAAC;MAClCyB,MAAM,CAAC8P,IAAI,CAACkT,aAAa,CAACxlB,CAAC,CAAC,IAAI,EAAE,CAAC;MACnC,IAAIA,CAAC,GAAGwlB,aAAa,CAACzf,MAAM,GAAG,CAAC,EAAE;QAChCvD,MAAM,CAAC8P,IAAI,CAAC,IAAI,CAAC;MACnB;IACF;;IAEA;IACA;IACA;IACA,MAAM4T,UAAU,GAAGP,MAAM,GAAG,CAAC,GAAGD,WAAW;IAC3C,IAAIQ,UAAU,GAAG,CAAC,EAAE;MAClB1jB,MAAM,CAAC8P,IAAI,CAAC,QAAQ4T,UAAU,GAAG,CAAC;IACpC;IACA1jB,MAAM,CAAC8P,IAAI,CAAC,QAAQsT,SAAS,GAAG,CAAC;;IAEjC;IACApjB,MAAM,CAAC8P,IAAI,CAAC,WAAW,CAAC;;IAExB;IACA,IAAI,CAACnH,KAAK,CAAC3I,MAAM,CAACgQ,IAAI,CAAC,EAAE,CAAC,CAAC;;IAE3B;IACA,IAAI,CAAC5K,mBAAmB,GAAGge,SAAS;IACpC,IAAI,CAACpd,iBAAiB,GAAG,IAAI;IAC7B,IAAI,CAACC,sBAAsB,GAAG,IAAI;IAClC,IAAI,CAACnB,cAAc,GAAG,IAAI;IAC1B,IAAI,CAACH,iBAAiB,GAAGwe,MAAM;IAC/B,IAAI,CAACjd,WAAW,GAAG;MAAE0H,KAAK,EAAEoV,aAAa;MAAEE;IAAY,CAAC;IACxD,IAAI,CAAC/c,mBAAmB,GAAG;MAAEyH,KAAK,EAAEoV,aAAa;MAAEE,WAAW;MAAEE;IAAU,CAAC;IAC3E,IAAI,CAACrd,0BAA0B,GAAG,KAAK;IACvC,IAAI,CAACrB,YAAY,GAAGye,MAAM;EAC5B;EAEQJ,iBAAiBA,CAAA,EAA6C;IACpE;IACA,IAAI,IAAI,CAAC1hB,YAAY,EAAE;MACrB,OAAO,IAAI,CAACsiB,yBAAyB,CAAC,CAAC;IACzC;IAEA,MAAM/V,KAAe,GAAG,EAAE;IAC1B,MAAMxB,QAAQ,GAAG,IAAI,CAACC,SAAS,CAAC,CAAC;IACjC;IACA,MAAMuX,OAAO,GAAG5P,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG,CAACN,MAAM,CAACxM,QAAQ,CAAC,CAAC;IAEpD,MAAMyX,gBAAgB,GAAG,CAAC,MAAM;MAC9B,MAAMC,GAAG,GAAG,IAAI,CAAC1iB,eAAe,IAAI,IAAI,CAACD,cAAc,IAAI,IAAI,CAACH,aAAa;MAC7E,IAAI,CAAC8iB,GAAG,EAAE,OAAO,IAAI;MACrB,MAAMpH,OAAO,GAAG,IAAI,CAACnD,SAAS,CAACuK,GAAG,CAAC,CAAC1f,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAACG,IAAI,CAAC,CAAC;MAClE,OAAOmY,OAAO,IAAI,IAAI;IACxB,CAAC,EAAE,CAAC;;IAEJ;IACA,IAAI,IAAI,CAAChc,IAAI,KAAK,WAAW,KAAK,IAAI,CAACqB,eAAe,IAAI8hB,gBAAgB,CAAC,EAAE;MAC3E;MACA,MAAME,YAAY,GAAG7E,oBAAa,CAACC,OAAO;MAC1C,MAAM6E,WAAW,GAAGD,YAAY,CAAC,IAAI,CAACviB,YAAY,GAAGuiB,YAAY,CAACxgB,MAAM,CAAC,IAAI,GAAG;MAChF,MAAM0gB,QAAQ,GAAG,IAAI,CAAC/hB,kBAAkB,CAAC,IAAI,CAACD,iBAAiB,GAAG,IAAI,CAACC,kBAAkB,CAACqB,MAAM,CAAC,IAAI,GAAG;MACxG,MAAM2gB,gBAAgB,GAAG,GAAGlQ,YAAK,CAACgB,IAAI,CAACgP,WAAW,CAAC,GAAGhQ,YAAK,CAACmQ,MAAM,GAAGnQ,YAAK,CAACmQ,MAAM,CAACF,QAAQ,CAAC,GAAGA,QAAQ,EAAE;MACxG,MAAM3G,OAAO,GAAG,IAAI,CAACD,sBAAsB,CAAC,CAAC;MAC7C,MAAM+G,iBAAiB,GAAG,CAAC,WAAW,EAAE,UAAU,EAAE,YAAY,CAAC;MACjE,IAAIC,eAAe,GAAG,IAAI,CAACtiB,eAAe,IAAI8hB,gBAAgB,IAAI,EAAE;MACpE,IAAIO,iBAAiB,CAACtX,QAAQ,CAACuX,eAAe,CAAC,IAAIR,gBAAgB,EAAE;QACnEQ,eAAe,GAAGR,gBAAgB;MACpC;MACA,IAAI,CAACQ,eAAe,CAAC9f,IAAI,CAAC,CAAC,EAAE;QAC3B8f,eAAe,GAAGR,gBAAgB,IAAI,SAAS;MACjD;MACA,MAAMS,aAAa,GAAG,CAACD,eAAe,CAACpT,OAAO,CAAC,CAAC,CAACtB,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC0U,eAAe,CAACpT,OAAO,CAAC,CAAC,CAACtB,QAAQ,CAAC,KAAK,CAAC;MAC5G;MACA;MACA,MAAM4U,YAAY,GAAGC,cAAK,CAACC,GAAG,CAAC,IAAI,CAACpiB,kBAAkB,CAAC,IAAI,CAACD,iBAAiB,GAAG,IAAI,CAACC,kBAAkB,CAACkB,MAAM,CAAC,IAAI,SAAS,CAAC;MAC7H,MAAM4e,KAAe,GAAG,CAAC,kBAAkB,CAAC;MAC5C,IAAI7E,OAAO,EAAE6E,KAAK,CAACrS,IAAI,CAACyU,YAAY,CAACjH,OAAO,CAAC,CAAC;MAC9C,IAAI,IAAI,CAACnb,eAAe,GAAG,CAAC,EAAE;QAC5BggB,KAAK,CAACrS,IAAI,CAAC,IAAI,IAAI,CAACyP,gBAAgB,CAAC,IAAI,CAACpd,eAAe,CAAC,SAAS,CAAC;MACtE;MACA,MAAMgW,MAAM,GAAG,GAAG+L,gBAAgB,GAAG;MACrC,MAAMQ,YAAY,GAAG,GAAGL,eAAe,CAAC9f,IAAI,CAAC,CAAC,GAAG+f,aAAa,GAAG,GAAG,GAAG,EAAE,EAAE;MAC3E,MAAM5U,MAAM,GAAG,IAAIsE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG,CAAC,GAAGiJ,KAAK,CAACnS,IAAI,CAACgE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,KAAK,CAAC,CAAC,GAAGlF,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG,CAAC,EAAE;;MAElG;MACA,MAAMyL,YAAY,GAAG,GAAGxM,MAAM,GAAGuM,YAAY,GAAGhV,MAAM,EAAE;;MAExD;MACA,MAAMiJ,MAAM,GAAG,GAAG,CAACC,MAAM,CAAC,IAAI,CAACoC,aAAa,CAAC7C,MAAM,CAAC,CAAC;MACrD,MAAMyM,OAAO,GAAG,IAAI,CAACC,eAAe,CAACF,YAAY,EAAEvY,QAAQ,EAAEuM,MAAM,CAAC;MACpE/K,KAAK,CAACkC,IAAI,CAAC,GAAG8U,OAAO,CAAC;IACxB;;IAEA;IACAhX,KAAK,CAACkC,IAAI,CAAC8T,OAAO,CAAC;;IAEnB;IACA,MAAMV,WAAW,GAAGtV,KAAK,CAACrK,MAAM;IAChC,MAAMuhB,SAAS,GAAG,IAAI,CAACC,cAAc,CAAC,CAAC;IACvC;IACA;IACA,MAAMC,UAAU,GAAGF,SAAS,CAAC5W,KAAK,CAAC,IAAI,CAAC,CAAC6B,MAAM,CAAC,CAACgE,IAAI,EAAE3C,GAAG,EAAE6T,GAAG,KAAK;MAClE;MACA;MACA,IAAIlR,IAAI,CAACxP,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE;QACtB;QACA,IAAI6M,GAAG,KAAK,CAAC,IAAIA,GAAG,KAAK6T,GAAG,CAAC1hB,MAAM,GAAG,CAAC,EAAE,OAAO,KAAK;MACvD;MACA,OAAO,IAAI;IACb,CAAC,CAAC;IACF;IACA,IAAIyhB,UAAU,CAACzhB,MAAM,KAAK,CAAC,EAAE;MAC3ByhB,UAAU,CAAClV,IAAI,CAACkE,YAAK,CAACC,OAAO,CAAC,IAAI,CAAC,CAAC;IACtC;IACA,KAAK,MAAMF,IAAI,IAAIiR,UAAU,EAAE;MAC7BpX,KAAK,CAACkC,IAAI,CAAC,IAAI,CAACmT,YAAY,CAAClP,IAAI,EAAE3H,QAAQ,CAAC,CAAC;IAC/C;;IAEA;IACAwB,KAAK,CAACkC,IAAI,CAAC8T,OAAO,CAAC;;IAEnB;IACA,IAAI,IAAI,CAAChf,WAAW,CAACrB,MAAM,GAAG,CAAC,EAAE;MAC/B,KAAK,MAAM2hB,SAAS,IAAI,IAAI,CAACtgB,WAAW,EAAE;QACxCgJ,KAAK,CAACkC,IAAI,CAAC,IAAI,CAACmT,YAAY,CAAC,KAAKiC,SAAS,EAAE,EAAE9Y,QAAQ,CAAC,CAAC;MAC3D;MACA;MACAwB,KAAK,CAACkC,IAAI,CAAC8T,OAAO,CAAC;IACrB;;IAEA;IACA,IAAI,IAAI,CAACxjB,WAAW,CAACmD,MAAM,GAAG,CAAC,EAAE;MAC/B,KAAK,IAAI0T,KAAK,GAAG,CAAC,EAAEA,KAAK,GAAG,IAAI,CAAC7W,WAAW,CAACmD,MAAM,EAAE0T,KAAK,EAAE,EAAE;QAC5D,MAAMkO,UAAU,GAAG,IAAI,CAAC/kB,WAAW,CAAC6W,KAAK,CAAE;QAC3C,MAAMmO,QAAQ,GAAGnO,KAAK,KAAK,IAAI,CAAC5W,eAAe;QAC/C,MAAMglB,MAAM,GAAGD,QAAQ,GAAGpR,YAAK,CAACC,OAAO,CAAC,GAAG,CAAC,GAAGD,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG,CAAC;QAClE,MAAMoM,OAAO,GAAGF,QAAQ,GAAGpR,YAAK,CAACC,OAAO,CAACkR,UAAU,CAACnZ,OAAO,CAAC,GAAGgI,YAAK,CAACiF,EAAE,CAACC,KAAK,CAACiM,UAAU,CAACnZ,OAAO,CAAC;QACjG,MAAMuZ,QAAQ,GAAGH,QAAQ,GAAGD,UAAU,CAACK,WAAW,GAAGxR,YAAK,CAACiF,EAAE,CAACC,KAAK,CAACiM,UAAU,CAACK,WAAW,CAAC;QAC3F5X,KAAK,CAACkC,IAAI,CAAC,IAAI,CAACmT,YAAY,CAAC,KAAKoC,MAAM,IAAIC,OAAO,MAAMC,QAAQ,EAAE,EAAEnZ,QAAQ,CAAC,CAAC;MACjF;IACF;;IAEA;IACA,MAAMqZ,gBAAgB,GAAG,IAAI,CAACC,qBAAqB,CAAC,CAAC;IACrD,IAAID,gBAAgB,EAAE;MACpB7X,KAAK,CAACkC,IAAI,CAAC,IAAI,CAACmT,YAAY,CAAC,KAAKwC,gBAAgB,EAAE,EAAErZ,QAAQ,CAAC,CAAC;IAClE;;IAEA;IACA,MAAMuZ,WAAW,GAAG,IAAI,CAACC,gBAAgB,CAAC,CAAC;IAC3C,IAAID,WAAW,CAACpiB,MAAM,EAAE;MACtB,KAAK,MAAMsiB,UAAU,IAAIF,WAAW,EAAE;QACpC/X,KAAK,CAACkC,IAAI,CAAC,IAAI,CAACmT,YAAY,CAAC,KAAK4C,UAAU,EAAE,EAAEzZ,QAAQ,CAAC,CAAC;MAC5D;IACF;;IAEA;IACA,MAAM0Z,WAAW,GAAG,IAAI,CAACC,qBAAqB,CAAC,CAAC;IAChD,IAAID,WAAW,CAACviB,MAAM,GAAG,CAAC,EAAE;MAC1B,KAAK,MAAMyiB,UAAU,IAAIF,WAAW,EAAE;QACpClY,KAAK,CAACkC,IAAI,CAAC,IAAI,CAACmT,YAAY,CAAC,KAAK+C,UAAU,EAAE,EAAE5Z,QAAQ,CAAC,CAAC;MAC5D;MACA,MAAM6Z,WAAW,GAAG,IAAI,CAACC,iBAAiB,CAAC,CAAC;MAC5C,KAAK,MAAMC,MAAM,IAAIF,WAAW,EAAE;QAChCrY,KAAK,CAACkC,IAAI,CAAC,IAAI,CAACmT,YAAY,CAAC,KAAKkD,MAAM,EAAE,EAAE/Z,QAAQ,CAAC,CAAC;MACxD;IACF;;IAEA;IACAwB,KAAK,CAACkC,IAAI,CAAC,IAAI,CAACmT,YAAY,CAAC,KAAKjP,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,iBAAiB,CAAC,EAAE,EAAE9M,QAAQ,CAAC,CAAC;IAEjF,OAAO;MAAEwB,KAAK;MAAEsV;IAAY,CAAC;EAC/B;;EAEA;AACF;AACA;AACA;AACA;EACUS,yBAAyBA,CAAA,EAA6C;IAC5E,MAAM/V,KAAe,GAAG,EAAE;IAC1B,MAAMxB,QAAQ,GAAG,IAAI,CAACC,SAAS,CAAC,CAAC;IACjC,MAAMuX,OAAO,GAAG5P,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG,CAACN,MAAM,CAACxM,QAAQ,CAAC,CAAC;;IAEpD;IACA;IACA,MAAMga,UAAU,GAAG,IAAI,CAAC/kB,YAAY,EAAEoC,IAAI,IAAIxC,uBAAU,CAACC,OAAO;IAChE0M,KAAK,CAACkC,IAAI,CAAC,IAAI,CAACmT,YAAY,CAAC,KAAKjP,YAAK,CAACgB,IAAI,CAAC,GAAG,CAAC,IAAIhB,YAAK,CAACgB,IAAI,CAACoR,UAAU,CAAC,EAAE,EAAEha,QAAQ,CAAC,CAAC;;IAEzF;IACA,MAAMia,WAAqB,GAAG,EAAE;IAChC,IAAI,IAAI,CAAC1jB,UAAU,CAAC2jB,OAAO,EAAE;MAC3BD,WAAW,CAACvW,IAAI,CAACkE,YAAK,CAACgB,IAAI,CAAC,IAAI,IAAI,CAACrS,UAAU,CAAC2jB,OAAO,EAAE,CAAC,CAAC;IAC7D;IACA,IAAI,IAAI,CAAC3jB,UAAU,CAAC4jB,MAAM,EAAE;MAC1B,IAAIF,WAAW,CAAC9iB,MAAM,EAAE8iB,WAAW,CAACvW,IAAI,CAACkE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC;MAC7DmN,WAAW,CAACvW,IAAI,CAACkE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,IAAI,CAACvW,UAAU,CAAC4jB,MAAM,CAAC,CAAC;IAC1D;IACA,IAAIF,WAAW,CAAC9iB,MAAM,EAAE;MACtBqK,KAAK,CAACkC,IAAI,CAAC,IAAI,CAACmT,YAAY,CAAC,KAAKoD,WAAW,CAACrW,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE5D,QAAQ,CAAC,CAAC;IACvE;;IAEA;IACA,MAAMoa,YAAsB,GAAG,EAAE;IACjC,IAAI,IAAI,CAAC7jB,UAAU,CAAC8jB,OAAO,EAAE;MAC3BD,YAAY,CAAC1W,IAAI,CAACkE,YAAK,CAACe,OAAO,CAAC,IAAI,CAACpS,UAAU,CAAC8jB,OAAO,CAAC,CAAC;IAC3D;IACA,IAAID,YAAY,CAACjjB,MAAM,EAAE;MACvBqK,KAAK,CAACkC,IAAI,CAAC,IAAI,CAACmT,YAAY,CAAC,KAAKuD,YAAY,CAACxW,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE5D,QAAQ,CAAC,CAAC;IACxE;;IAEA;IACA,MAAMsa,KAAK,GAAG,IAAI,CAAC/jB,UAAU,CAAC+jB,KAAK,GAAG1S,YAAK,CAACgB,IAAI,CAAC,IAAI,CAACrS,UAAU,CAAC+jB,KAAK,CAAC,GAAG,IAAI;IAC9E,MAAMC,QAAQ,GAAG,IAAI,CAAChkB,UAAU,CAACgkB,QAAQ,GAAG3S,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,IAAI,CAACvW,UAAU,CAACgkB,QAAQ,CAAC,GAAG,IAAI;IAC3F,MAAMC,SAAS,GAAG,CAACF,KAAK,EAAEC,QAAQ,CAAC,CAAC5W,MAAM,CAACxI,OAAO,CAAC,CAACyI,IAAI,CAACgE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,OAAO,CAAC,CAAC;IACjF,IAAI0N,SAAS,EAAE;MACbhZ,KAAK,CAACkC,IAAI,CAAC,IAAI,CAACmT,YAAY,CAAC,KAAK2D,SAAS,EAAE,EAAExa,QAAQ,CAAC,CAAC;IAC3D;;IAEA;IACAwB,KAAK,CAACkC,IAAI,CAAC,IAAI,CAACmT,YAAY,CAAC,KAAKjP,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,kDAAkD,CAAC,EAAE,EAAE9M,QAAQ,CAAC,CAAC;IAClHwB,KAAK,CAACkC,IAAI,CAAC,IAAI,CAACmT,YAAY,CAAC,KAAKjP,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,2EAA2E,CAAC,EAAE,EAAE9M,QAAQ,CAAC,CAAC;;IAE3I;IACAwB,KAAK,CAACkC,IAAI,CAAC8T,OAAO,CAAC;IAEnB,MAAMkB,SAAS,GAAG,IAAI,CAACC,cAAc,CAAC,CAAC;IACvC,MAAMC,UAAU,GAAGF,SAAS,CAAC5W,KAAK,CAAC,IAAI,CAAC,CAAC6B,MAAM,CAAC,CAACgE,IAAI,EAAE3C,GAAG,EAAE6T,GAAG,KAAK;MAClE,IAAIlR,IAAI,CAACxP,IAAI,CAAC,CAAC,KAAK,EAAE,KAAK6M,GAAG,KAAK,CAAC,IAAIA,GAAG,KAAK6T,GAAG,CAAC1hB,MAAM,GAAG,CAAC,CAAC,EAAE,OAAO,KAAK;MAC7E,OAAO,IAAI;IACb,CAAC,CAAC;IACF,MAAM2f,WAAW,GAAGtV,KAAK,CAACrK,MAAM;IAChC,KAAK,MAAMwQ,IAAI,IAAIiR,UAAU,EAAE;MAC7BpX,KAAK,CAACkC,IAAI,CAAC,IAAI,CAACmT,YAAY,CAAClP,IAAI,EAAE3H,QAAQ,CAAC,CAAC;IAC/C;;IAEA;IACAwB,KAAK,CAACkC,IAAI,CAAC8T,OAAO,CAAC;IAEnB,OAAO;MAAEhW,KAAK;MAAEsV;IAAY,CAAC;EAC/B;;EAEA;AACF;AACA;AACA;EACUwC,qBAAqBA,CAAA,EAAkB;IAC7C,MAAMvD,KAAe,GAAG,EAAE;;IAE1B;IACA,MAAMuE,KAAK,GAAG,IAAI,CAAC/jB,UAAU,CAACgkB,QAAQ,IAAI,IAAI,CAAChkB,UAAU,CAAC+jB,KAAK,GAC3D,GAAG,IAAI,CAAC/jB,UAAU,CAACgkB,QAAQ,MAAM,IAAI,CAAChkB,UAAU,CAAC+jB,KAAK,EAAE,GACxD,IAAI,CAAC/jB,UAAU,CAAC+jB,KAAK,IAAI,IAAI,CAAC/jB,UAAU,CAACgkB,QAAQ;IACrD,IAAID,KAAK,EAAE;MACTvE,KAAK,CAACrS,IAAI,CAACkE,YAAK,CAACgB,IAAI,CAAC0R,KAAK,CAAC,CAAC;IAC/B;;IAEA;IACA,IAAI,IAAI,CAAC/jB,UAAU,CAACkkB,cAAc,KAAK3R,SAAS,EAAE;MAChD,MAAM4R,IAAI,GAAG,IAAAC,4BAAe,EAAC,IAAI,CAACpkB,UAAU,CAACkkB,cAAc,CAAC;MAC5D,MAAMG,QAAQ,GAAG,CAAC;MAClB,MAAMC,MAAM,GAAG7jB,IAAI,CAACsc,KAAK,CAAEoH,IAAI,GAAG,GAAG,GAAIE,QAAQ,CAAC;MAClD,MAAME,KAAK,GAAG9jB,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE2jB,QAAQ,GAAGC,MAAM,CAAC;MAC5C;MACA,MAAME,QAAQ,GAAG,IAAAC,4BAAe,EAACN,IAAI,EAAE;QACrC3T,KAAK,EAAEa,YAAK,CAACb,KAAK;QAClB4B,OAAO,EAAEf,YAAK,CAACe,OAAO;QACtBC,IAAI,EAAEhB,YAAK,CAACgB,IAAI;QAChBwH,OAAO,EAAExI,YAAK,CAACwI;MACjB,CAAC,CAAC;MACF,MAAM6K,GAAG,GAAGF,QAAQ,CAAC,GAAG,CAACvO,MAAM,CAACqO,MAAM,CAAC,CAAC,GAAGjT,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG,CAACN,MAAM,CAACsO,KAAK,CAAC,CAAC;MAC5E/E,KAAK,CAACrS,IAAI,CAAC,GAAGuX,GAAG,IAAIF,QAAQ,CAAC,GAAGL,IAAI,GAAG,CAAC,IAAI9S,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,KAAK,CAAC,EAAE,CAAC;IACvE;IAEA,OAAOiJ,KAAK,CAAC5e,MAAM,GAAG,CAAC,GAAG4e,KAAK,CAACnS,IAAI,CAACgE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,OAAO,CAAC,CAAC,GAAG,IAAI;EACtE;;EAEA;AACF;AACA;AACA;AACA;EACE;AACF;AACA;AACA;EACU6M,qBAAqBA,CAAA,EAAa;IACxC,MAAMuB,kBAAkB,GAAG,IAAI,CAAC1kB,WAAW,CAACE,mBAAmB,IAAI,KAAK;IACxE,MAAMykB,kBAAkB,GAAG,IAAI,CAAC3kB,WAAW,CAACC,mBAAmB,IAAI,KAAK;IACxE,MAAM2kB,YAAY,GAAG,IAAI,CAAC5kB,WAAW,CAACG,oBAAoB,IAAI,MAAM;IACpE,MAAMmR,aAAa,GAAG,CAAC,IAAI,CAACtR,WAAW,CAACuR,iBAAiB,IAAI,UAAU,EAAE5P,IAAI,CAAC,CAAC,CAACwG,WAAW,CAAC,CAAC;;IAE7F;IACA,MAAM0c,OAAiB,GAAG,EAAE;;IAE5B;IACA,MAAMC,IAAI,GAAG,IAAI,CAAC9kB,WAAW,CAACI,aAAa;IAC3C,MAAM2kB,MAAM,GAAGD,IAAI,GAAG,IAAI,GAAG,GAAG;IAChC,MAAMxkB,QAAQ,GAAGwkB,IAAI,GAAG1T,YAAK,CAACgB,IAAI,CAAC,MAAM,CAAC,GAAGhB,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,QAAQ,CAAC;IACrE,MAAM0O,SAAS,GAAGF,IAAI,GAAG,aAAa,GAAG,UAAU;IACnDD,OAAO,CAAC3X,IAAI,CAAC,GAAG6X,MAAM,IAAIzkB,QAAQ,IAAI8Q,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,MAAM,CAAC,IAAIlF,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC0O,SAAS,CAAC,EAAE,CAAC;;IAE5F;IACA,MAAMC,QAAQ,GAAGP,kBAAkB,GAAG,IAAI,GAAG,GAAG;IAChD,MAAMQ,UAAU,GAAGR,kBAAkB,GAAGtT,YAAK,CAACC,OAAO,CAAC,MAAM,CAAC,GAAGD,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,MAAM,CAAC;IACtF,MAAM6O,WAAW,GAAGT,kBAAkB,GAAG,YAAY,GAAG,eAAe;IACvEG,OAAO,CAAC3X,IAAI,CAAC,GAAG+X,QAAQ,IAAIC,UAAU,IAAI9T,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,MAAM,CAAC,IAAIlF,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC6O,WAAW,CAAC,EAAE,CAAC;;IAElG;IACA,MAAMC,UAAU,GAAGT,kBAAkB,GAAG,GAAG,GAAG,GAAG;IACjD,MAAMU,YAAY,GAAGV,kBAAkB,GAAGvT,YAAK,CAACe,OAAO,CAAC,MAAM,CAAC,GAAGf,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,MAAM,CAAC;IACxF,MAAMgP,aAAa,GAAGX,kBAAkB,GAAG,WAAW,GAAG,UAAU;IACnEE,OAAO,CAAC3X,IAAI,CAAC,GAAGkY,UAAU,IAAIC,YAAY,IAAIjU,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,MAAM,CAAC,IAAIlF,YAAK,CAACiF,EAAE,CAACC,KAAK,CAACgP,aAAa,CAAC,EAAE,CAAC;;IAExG;IACA,MAAMC,QAAQ,GAAGX,YAAY,KAAK,UAAU,GAAG,IAAI,GAAG,GAAG;IACzD,MAAMY,UAAU,GAAGZ,YAAY,KAAK,UAAU,GAAGxT,YAAK,CAACe,OAAO,CAAC,KAAK,CAAC,GAAGf,YAAK,CAACwI,OAAO,CAAC,MAAM,CAAC;IAC7F,MAAM6L,WAAW,GAAGb,YAAY,KAAK,UAAU,GAAG,aAAa,GAAG,cAAc;IAChFC,OAAO,CAAC3X,IAAI,CAAC,GAAGqY,QAAQ,IAAIC,UAAU,IAAIpU,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,MAAM,CAAC,IAAIlF,YAAK,CAACiF,EAAE,CAACC,KAAK,CAACmP,WAAW,CAAC,EAAE,CAAC;;IAElG;IACA,MAAMjU,cAAc,GAAGF,aAAa,KAAK,UAAU,IAAIA,aAAa,KAAK,MAAM;IAC/E,MAAMoU,SAAS,GAAGlU,cAAc,GAAG,IAAI,GAAG,IAAI;IAC9C,MAAMmU,WAAW,GAAGnU,cAAc,GAAGJ,YAAK,CAACgB,IAAI,CAAC,MAAM,CAAC,GAAGhB,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,OAAO,CAAC;IACjF,MAAMsP,YAAY,GAAGpU,cAAc,GAAG,UAAU,GAAG,SAAS;IAC5DqT,OAAO,CAAC3X,IAAI,CAAC,GAAGwY,SAAS,IAAIC,WAAW,IAAIvU,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,OAAO,CAAC,IAAIlF,YAAK,CAACiF,EAAE,CAACC,KAAK,CAACsP,YAAY,CAAC,EAAE,CAAC;;IAEtG;IACA,MAAMC,WAAW,GAAG,IAAI,CAAC7lB,WAAW,CAACK,YAAY,IAAI,KAAK;IAC1D,MAAMylB,SAAS,GAAGD,WAAW,GAAG,IAAI,GAAG,IAAI;IAC3C,MAAME,WAAW,GAAGF,WAAW,GAAGzU,YAAK,CAACe,OAAO,CAAC,UAAU,CAAC,GAAGf,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,WAAW,CAAC;IACzF,MAAM0P,YAAY,GAAGH,WAAW,GAAG,cAAc,GAAG,QAAQ;IAC5DhB,OAAO,CAAC3X,IAAI,CAAC,GAAG4Y,SAAS,IAAIC,WAAW,IAAI3U,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,UAAU,CAAC,IAAIlF,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC0P,YAAY,CAAC,EAAE,CAAC;;IAEzG;IACAnB,OAAO,CAAC3X,IAAI,CAAC,GAAGkE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAC;IAE3C,MAAM9M,QAAQ,GAAGhJ,IAAI,CAACC,GAAG,CAAC,EAAE,EAAE,IAAI,CAACgJ,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC;IACnD,OAAO,IAAI,CAACwc,YAAY,CAACpB,OAAO,EAAErb,QAAQ,CAAC;EAC7C;;EAEA;AACF;AACA;EACU8Z,iBAAiBA,CAAA,EAAa;IACpC;IACA,OAAO,EAAE;EACX;EAEQN,gBAAgBA,CAAA,EAAa;IACnC,MAAMxZ,QAAQ,GAAG,IAAI,CAACC,SAAS,CAAC,CAAC;IACjC,MAAMyc,WAAW,GAAG,IAAI,CAACC,gBAAgB,CAAC3c,QAAQ,CAAC;IACnD,MAAM4c,SAAS,GAAG,IAAI,CAACC,cAAc,CAAC7c,QAAQ,CAAC;IAC/C,OAAO,CAAC,GAAG0c,WAAW,EAAE,GAAGE,SAAS,CAAC;EACvC;EAEQE,cAAcA,CAACC,SAAiB,EAAU;IAChD,MAAMC,IAAI,GAAG,IAAAC,eAAO,EAAC,CAAC;IACtB,IAAID,IAAI,IAAID,SAAS,CAACrd,UAAU,CAACsd,IAAI,CAAC,EAAE;MACtC,OAAOD,SAAS,CAAC/kB,OAAO,CAACglB,IAAI,EAAE,GAAG,CAAC;IACrC;IACA,OAAOD,SAAS;EAClB;EAEQJ,gBAAgBA,CAAC3c,QAAgB,EAAY;IACnD,MAAMkd,WAAW,GAAG,IAAI,CAACC,kBAAkB,CAAC,CAAC;IAC7C,IAAI,CAACD,WAAW,EAAE;MAChB,OAAO,EAAE;IACX;;IAEA;IACA,IAAI,IAAI,CAACjoB,YAAY,EAAE;MACrB,OAAO,CAAC,IAAI,CAAC4hB,YAAY,CAAC,GAAGjP,YAAK,CAACgB,IAAI,CAAC,GAAG,CAAC,IAAI,IAAI,CAACwU,SAAS,CAACF,WAAW,CAAC7lB,IAAI,EAAE6lB,WAAW,CAACtK,IAAI,CAAC,EAAE,EAAE5S,QAAQ,CAAC,CAAC;IAClH;IAEA,MAAM+J,QAAkB,GAAG,EAAE;;IAE7B;IACA,MAAMsT,WAAW,GAAG,IAAI,CAAC/oB,IAAI,KAAK,WAAW;IAC7C,IAAI+oB,WAAW,EAAE;MACf,MAAM1F,YAAY,GAAG7E,oBAAa,CAACC,OAAO;MAC1C,MAAM6E,WAAW,GAAGD,YAAY,CAAC,IAAI,CAACviB,YAAY,GAAGuiB,YAAY,CAACxgB,MAAM,CAAC,IAAI,GAAG;MAChF4S,QAAQ,CAACrG,IAAI,CAAC,GAAGkE,YAAK,CAACgB,IAAI,CAACgP,WAAW,CAAC,IAAI,IAAI,CAACwF,SAAS,CAACF,WAAW,CAAC7lB,IAAI,EAAE6lB,WAAW,CAACtK,IAAI,CAAC,EAAE,CAAC;IACnG,CAAC,MAAM;MACL7I,QAAQ,CAACrG,IAAI,CAAC,GAAGkE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,QAAQ,CAAC,IAAI,IAAI,CAACsQ,SAAS,CAACF,WAAW,CAAC7lB,IAAI,EAAE6lB,WAAW,CAACtK,IAAI,CAAC,EAAE,CAAC;IACpG;IAEA,IAAI,IAAI,CAACrc,UAAU,CAAC+mB,WAAW,EAAE;MAC/BvT,QAAQ,CAACrG,IAAI,CAAC,GAAGkE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,SAAS,CAAC,IAAIlF,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,IAAI,CAACvW,UAAU,CAAC+mB,WAAW,CAAC,EAAE,CAAC;IAC9F;IAEA,IAAI,IAAI,CAAC/mB,UAAU,CAACkkB,cAAc,KAAK3R,SAAS,EAAE;MAChD;MACA,IAAI,CAACtN,YAAY,CAAC+hB,MAAM,CAAC,IAAI,CAAChnB,UAAU,CAACkkB,cAAc,CAAC;MACxD1Q,QAAQ,CAACrG,IAAI,CAAC,IAAI,CAAClI,YAAY,CAAC8B,MAAM,CAAC,CAAC,CAAC;IAC3C;IAEA,OAAO,IAAI,CAACmf,YAAY,CAAC1S,QAAQ,EAAE/J,QAAQ,CAAC;EAC9C;EAEQ6c,cAAcA,CAAC7c,QAAgB,EAAY;IACjD,MAAM+J,QAAkB,GAAG,EAAE;IAE7B,IAAI,IAAI,CAACxT,UAAU,CAAC8jB,OAAO,EAAE;MAC3BtQ,QAAQ,CAACrG,IAAI,CAAC,IAAI,CAAC8Z,iBAAiB,CAAC,SAAS,EAAE,IAAI,CAACjnB,UAAU,CAAC8jB,OAAO,EAAE,MAAM,CAAC,CAAC;IACnF;IAEA,MAAMC,KAAK,GAAG,IAAI,CAAC/jB,UAAU,CAACgkB,QAAQ,IAAI,IAAI,CAAChkB,UAAU,CAAC+jB,KAAK,GAC3D,GAAG,IAAI,CAAC/jB,UAAU,CAACgkB,QAAQ,MAAM,IAAI,CAAChkB,UAAU,CAAC+jB,KAAK,EAAE,GACxD,IAAI,CAAC/jB,UAAU,CAAC+jB,KAAK,IAAI,IAAI,CAAC/jB,UAAU,CAACgkB,QAAQ;IACrD,IAAID,KAAK,EAAE;MACTvQ,QAAQ,CAACrG,IAAI,CAAC,IAAI,CAAC8Z,iBAAiB,CAAC,OAAO,EAAElD,KAAK,EAAE,MAAM,CAAC,CAAC;IAC/D;IAEA,MAAMmD,SAAS,GAAG,IAAI,CAAClnB,UAAU,CAACknB,SAAS,IAAI,IAAI,CAAClnB,UAAU,CAACmnB,SAAS;IACxE,IAAID,SAAS,EAAE;MACb1T,QAAQ,CAACrG,IAAI,CAAC,IAAI,CAAC8Z,iBAAiB,CAAC,KAAK,EAAE,IAAI,CAACV,cAAc,CAACW,SAAS,CAAC,EAAE,OAAO,CAAC,CAAC;IACvF;IAEA,IAAI,IAAI,CAAClnB,UAAU,CAAConB,MAAM,EAAE;MAC1B5T,QAAQ,CAACrG,IAAI,CAAC,IAAI,CAAC8Z,iBAAiB,CAAC,QAAQ,EAAE,IAAI,CAACjnB,UAAU,CAAConB,MAAM,EAAE,OAAO,CAAC,CAAC;IAClF;IAEA,IAAI,IAAI,CAACpnB,UAAU,CAACqnB,WAAW,EAAE;MAC/B7T,QAAQ,CAACrG,IAAI,CAAC,IAAI,CAAC8Z,iBAAiB,CAAC,OAAO,EAAE,IAAI,CAACjnB,UAAU,CAACqnB,WAAW,EAAE,OAAO,CAAC,CAAC;IACtF;IAEA,IAAI,IAAI,CAACrnB,UAAU,CAACsnB,YAAY,EAAE;MAChC9T,QAAQ,CAACrG,IAAI,CAAC,IAAI,CAAC8Z,iBAAiB,CAAC,SAAS,EAAE,IAAI,CAACjnB,UAAU,CAACsnB,YAAY,EAAE,OAAO,CAAC,CAAC;IACzF;IAEA,IAAI,IAAI,CAACtnB,UAAU,CAAC2jB,OAAO,EAAE;MAC3BnQ,QAAQ,CAACrG,IAAI,CAAC,IAAI,CAAC8Z,iBAAiB,CAAC,OAAO,EAAE,IAAI,IAAI,CAACjnB,UAAU,CAAC2jB,OAAO,EAAE,EAAE,OAAO,CAAC,CAAC;IACxF;;IAEA;IACA,MAAM4D,UAAU,GAAG,IAAI,CAACC,qBAAqB,CAAC,CAAC;IAC/C,IAAID,UAAU,CAAC3mB,MAAM,GAAG,CAAC,EAAE;MACzB4S,QAAQ,CAACrG,IAAI,CAAC,GAAGoa,UAAU,CAAC;IAC9B;IAEA,IAAI/T,QAAQ,CAAC5S,MAAM,KAAK,CAAC,EAAE;MACzB,OAAO,EAAE;IACX;IAEA,OAAO,IAAI,CAACslB,YAAY,CAAC1S,QAAQ,EAAE/J,QAAQ,CAAC;EAC9C;;EAEA;AACF;AACA;AACA;EACU+d,qBAAqBA,CAAA,EAAa;IACxC,MAAMhU,QAAkB,GAAG,EAAE;IAC7B,MAAMrO,EAAE,GAAG,IAAI,CAAC5E,QAAQ;;IAExB;IACA,IAAI,CAAC4E,EAAE,CAACsiB,aAAa,IAAI,CAACtiB,EAAE,CAACuiB,IAAI,IAAI,CAACviB,EAAE,CAACwiB,aAAa,EAAE;MACtD,OAAOnU,QAAQ;IACjB;;IAEA;IACA,IAAIrO,EAAE,CAACuiB,IAAI,KAAKviB,EAAE,CAACuiB,IAAI,CAACpW,OAAO,GAAG,CAAC,IAAInM,EAAE,CAACuiB,IAAI,CAACE,OAAO,GAAG,CAAC,IAAIziB,EAAE,CAACuiB,IAAI,CAACG,IAAI,GAAG,CAAC,CAAC,EAAE;MAC/E,MAAMC,UAAU,GAAG3iB,EAAE,CAACuiB,IAAI,CAACpW,OAAO,GAAGnM,EAAE,CAACuiB,IAAI,CAACE,OAAO,GAAGziB,EAAE,CAACuiB,IAAI,CAACG,IAAI;MACnE,MAAME,MAAM,GAAG5iB,EAAE,CAACuiB,IAAI,CAACpW,OAAO,GAAGnM,EAAE,CAACuiB,IAAI,CAACE,OAAO,GAAG,SAAS,GAC7CziB,EAAE,CAACuiB,IAAI,CAACE,OAAO,GAAGziB,EAAE,CAACuiB,IAAI,CAACpW,OAAO,GAAG,SAAS,GAAG,KAAK;;MAEpE;MACA,MAAM0W,MAAM,GAAGD,MAAM,KAAK,SAAS,GAAG1W,YAAK,CAACwI,OAAO,GAAGxI,YAAK,CAACgB,IAAI;MAChE,MAAM4V,MAAM,GAAGF,MAAM,KAAK,SAAS,GAAG1W,YAAK,CAACwI,OAAO,GAAGxI,YAAK,CAACe,OAAO;MACnE,MAAM8V,MAAM,GAAGF,MAAM,CAAC,GAAG7iB,EAAE,CAACuiB,IAAI,CAACpW,OAAO,EAAE,CAAC;MAC3C,MAAM6W,MAAM,GAAGF,MAAM,CAAC,GAAG9iB,EAAE,CAACuiB,IAAI,CAACE,OAAO,EAAE,CAAC;;MAE3C;MACA,MAAMQ,MAAM,GAAGL,MAAM,KAAK,SAAS,GAAG1W,YAAK,CAACgB,IAAI,CAAC,IAAI,CAAC,GACvC0V,MAAM,KAAK,SAAS,GAAG1W,YAAK,CAACe,OAAO,CAAC,IAAI,CAAC,GAAG,IAAI;;MAEhE;MACA,MAAMiW,UAAU,GAAGljB,EAAE,CAACmjB,MAAM,IAAInjB,EAAE,CAACmjB,MAAM,GAAG,CAAC,GAAGjX,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,MAAMpR,EAAE,CAACmjB,MAAM,EAAE,CAAC,GAAG,EAAE;MAEtF9U,QAAQ,CAACrG,IAAI,CAAC,GAAGib,MAAM,GAAGF,MAAM,GAAG7W,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG,CAAC,GAAG4R,MAAM,GAAGE,UAAU,EAAE,CAAC;;MAE/E;MACA,IAAIP,UAAU,GAAG,CAAC,EAAE;QAClB,MAAMzD,QAAQ,GAAG,CAAC;QAClB,MAAMkE,KAAK,GAAG9nB,IAAI,CAACsc,KAAK,CAAE5X,EAAE,CAACuiB,IAAI,CAACpW,OAAO,GAAGwW,UAAU,GAAIzD,QAAQ,CAAC;QACnE,MAAMmE,KAAK,GAAG/nB,IAAI,CAACsc,KAAK,CAAE5X,EAAE,CAACuiB,IAAI,CAACE,OAAO,GAAGE,UAAU,GAAIzD,QAAQ,CAAC;QACnE,MAAMoE,KAAK,GAAGhoB,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE2jB,QAAQ,GAAGkE,KAAK,GAAGC,KAAK,CAAC;QACnD,MAAM9D,GAAG,GAAGrT,YAAK,CAACgB,IAAI,CAAC,GAAG,CAAC4D,MAAM,CAACsS,KAAK,CAAC,CAAC,GAC7BlX,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG,CAACN,MAAM,CAACwS,KAAK,CAAC,CAAC,GACjCpX,YAAK,CAACe,OAAO,CAAC,GAAG,CAAC6D,MAAM,CAACuS,KAAK,CAAC,CAAC;QAC5ChV,QAAQ,CAACrG,IAAI,CAAC,IAAIuX,GAAG,GAAG,CAAC;MAC3B;IACF;;IAEA;IACA,IAAIvf,EAAE,CAACsiB,aAAa,EAAE;MACpB,MAAMiB,UAAU,GAAGvjB,EAAE,CAACwjB,iBAAiB;MACvC,IAAID,UAAU,EAAE;QACd;QACAlV,QAAQ,CAACrG,IAAI,CAAC,GAAGkE,YAAK,CAACgB,IAAI,CAAC,IAAI,CAAC,IAAIhB,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG,CAAC,IAAIlF,YAAK,CAACe,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC;MACpF,CAAC,MAAM;QACL,MAAMwW,WAAW,GAAGzjB,EAAE,CAACsiB,aAAa,KAAK,SAAS,GAAG,GAAG,GAAG,GAAG;QAC9D,MAAMoB,YAAY,GAAG1jB,EAAE,CAACsiB,aAAa,KAAK,SAAS,GAAG,GAAG,GAAG,GAAG;QAC/D,MAAMqB,YAAY,GAAG3jB,EAAE,CAACsiB,aAAa,KAAK,SAAS,GAAGpW,YAAK,CAACgB,IAAI,GAAGhB,YAAK,CAACe,OAAO;QAChFoB,QAAQ,CAACrG,IAAI,CAAC,GAAGyb,WAAW,GAAGE,YAAY,CAACD,YAAY,CAAC,EAAE,CAAC;MAC9D;IACF;;IAEA;IACA,IAAI1jB,EAAE,CAAC4jB,UAAU,IAAI5jB,EAAE,CAAC4jB,UAAU,KAAK,KAAK,EAAE;MAC5C,MAAMC,UAAU,GAAG7jB,EAAE,CAAC4jB,UAAU,KAAK,SAAS,GAAG1X,YAAK,CAACgB,IAAI,CAAC,IAAI,CAAC,GAAGhB,YAAK,CAACe,OAAO,CAAC,IAAI,CAAC;MACvFoB,QAAQ,CAACrG,IAAI,CAAC6b,UAAU,CAAC;IAC3B,CAAC,MAAM,IAAI7jB,EAAE,CAAC4jB,UAAU,KAAK,KAAK,EAAE;MAClCvV,QAAQ,CAACrG,IAAI,CAACkE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC;IACpC;;IAEA;IACA,IAAIpR,EAAE,CAACwiB,aAAa,IAAIxiB,EAAE,CAAC8jB,WAAW,EAAE;MACtC,MAAMC,QAAQ,GAAG/jB,EAAE,CAAC8jB,WAAW,IAAI9jB,EAAE,CAACwiB,aAAa,IAAI,EAAE;MACzD,IAAIuB,QAAQ,EAAE;QACZ1V,QAAQ,CAACrG,IAAI,CAACkE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,IAAI,CAAC4S,cAAc,CAACD,QAAQ,EAAE,EAAE,CAAC,CAAC,CAAC;MAClE;IACF;;IAEA;IACA,IAAI,OAAO/jB,EAAE,CAACikB,cAAc,KAAK,QAAQ,IAAI,OAAOjkB,EAAE,CAACkkB,UAAU,KAAK,QAAQ,IAAIlkB,EAAE,CAACkkB,UAAU,GAAG,CAAC,EAAE;MACnG,MAAMC,GAAG,GAAG7oB,IAAI,CAACsc,KAAK,CAAE5X,EAAE,CAACikB,cAAc,GAAGjkB,EAAE,CAACkkB,UAAU,GAAI,GAAG,CAAC;MACjE7V,QAAQ,CAACrG,IAAI,CAACkE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG+S,GAAG,GAAG,CAAC,CAAC;IAC1C;;IAEA;IACA,IAAInkB,EAAE,CAACokB,MAAM,KAAK,OAAOpkB,EAAE,CAACokB,MAAM,CAACjY,OAAO,KAAK,QAAQ,IAAI,OAAOnM,EAAE,CAACokB,MAAM,CAAC3B,OAAO,KAAK,QAAQ,CAAC,EAAE;MACjG,MAAMM,MAAM,GAAG,OAAO/iB,EAAE,CAACokB,MAAM,CAACjY,OAAO,KAAK,QAAQ,GAAGnM,EAAE,CAACokB,MAAM,CAACjY,OAAO,CAACwL,OAAO,CAAC,CAAC,CAAC,GAAG,GAAG;MACzF,MAAMqL,MAAM,GAAG,OAAOhjB,EAAE,CAACokB,MAAM,CAAC3B,OAAO,KAAK,QAAQ,GAAGziB,EAAE,CAACokB,MAAM,CAAC3B,OAAO,CAAC9K,OAAO,CAAC,CAAC,CAAC,GAAG,GAAG;MACzF,MAAM0M,IAAI,GAAGrkB,EAAE,CAACokB,MAAM,CAACjY,OAAO,IAAI,CAAC;MACnC,MAAMmY,IAAI,GAAGtkB,EAAE,CAACokB,MAAM,CAAC3B,OAAO,IAAI,CAAC;MACnC,MAAM8B,QAAQ,GAAGF,IAAI,GAAGC,IAAI,GAAGpY,YAAK,CAACwI,OAAO,CAACqO,MAAM,CAAC,GAAG7W,YAAK,CAACgB,IAAI,CAAC6V,MAAM,CAAC;MACzE,MAAMyB,QAAQ,GAAGF,IAAI,GAAGD,IAAI,GAAGnY,YAAK,CAACwI,OAAO,CAACsO,MAAM,CAAC,GAAG9W,YAAK,CAACe,OAAO,CAAC+V,MAAM,CAAC;MAC5E3U,QAAQ,CAACrG,IAAI,CAAC,GAAGuc,QAAQ,GAAGrY,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG,CAAC,GAAGoT,QAAQ,EAAE,CAAC;IAC/D;;IAEA;IACA,IAAIxkB,EAAE,CAACykB,QAAQ,KAAK,OAAOzkB,EAAE,CAACykB,QAAQ,CAACtY,OAAO,KAAK,QAAQ,IAAI,OAAOnM,EAAE,CAACykB,QAAQ,CAAChC,OAAO,KAAK,QAAQ,CAAC,EAAE;MACvG,MAAMiC,IAAI,GAAG1kB,EAAE,CAACykB,QAAQ,CAACtY,OAAO,KAAKiB,SAAS,GAAG9R,IAAI,CAACsc,KAAK,CAAC5X,EAAE,CAACykB,QAAQ,CAACtY,OAAO,GAAG,GAAG,CAAC,GAAG,IAAI;MAC7F,MAAMwY,IAAI,GAAG3kB,EAAE,CAACykB,QAAQ,CAAChC,OAAO,KAAKrV,SAAS,GAAG9R,IAAI,CAACsc,KAAK,CAAC5X,EAAE,CAACykB,QAAQ,CAAChC,OAAO,GAAG,GAAG,CAAC,GAAG,IAAI;MAC7F,MAAM8B,QAAQ,GAAGG,IAAI,KAAK,IAAI,GAAGxY,YAAK,CAACgB,IAAI,CAAC,IAAIwX,IAAI,GAAG,CAAC,GAAG,IAAI;MAC/D,MAAMF,QAAQ,GAAGG,IAAI,KAAK,IAAI,GAAGzY,YAAK,CAACe,OAAO,CAAC,IAAI0X,IAAI,GAAG,CAAC,GAAG,IAAI;MAClE,MAAMtK,KAAK,GAAG,CAACkK,QAAQ,EAAEC,QAAQ,CAAC,CAACvc,MAAM,CAACxI,OAAO,CAAC,CAACyI,IAAI,CAACgE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG,CAAC,CAAC;MAC5E,IAAIiJ,KAAK,EAAE;QACThM,QAAQ,CAACrG,IAAI,CAACqS,KAAK,CAAC;MACtB;IACF;IAEA,OAAOhM,QAAQ;EACjB;;EAEA;AACF;AACA;EACU2V,cAAcA,CAACroB,IAAY,EAAEqW,MAAc,EAAU;IAC3D,IAAIrW,IAAI,CAACF,MAAM,IAAIuW,MAAM,EAAE,OAAOrW,IAAI;IACtC,MAAMipB,OAAO,GAAGtpB,IAAI,CAACma,KAAK,CAAC,CAACzD,MAAM,GAAG,CAAC,IAAI,CAAC,CAAC;IAC5C,OAAO,GAAGrW,IAAI,CAACQ,KAAK,CAAC,CAAC,EAAEyoB,OAAO,CAAC,MAAMjpB,IAAI,CAACQ,KAAK,CAAC,CAACyoB,OAAO,CAAC,EAAE;EAC9D;EAEQnD,kBAAkBA,CAAA,EAAyE;IACjG,IAAI,IAAI,CAACloB,YAAY,EAAE;MACrB,OAAO;QAAEoC,IAAI,EAAE,IAAI,CAACpC,YAAY,CAACoC,IAAI;QAAEub,IAAI,EAAE,IAAI,CAAC3d,YAAY,CAAC2d;MAAK,CAAC;IACvE;IAEA,MAAM2N,QAAQ,GAAG,CAAC,IAAI,CAACvrB,eAAe,EAAE,IAAI,CAACD,cAAc,EAAE,IAAI,CAACH,aAAa,CAAC,CAAC+O,MAAM,CACrF,CAACqJ,KAAK,EAAEnC,KAAK,EAAEgO,GAAG,KAAsB1d,OAAO,CAAC6R,KAAK,CAAC,IAAI6L,GAAG,CAAChY,OAAO,CAACmM,KAAK,CAAC,KAAKnC,KACnF,CAAC;IACD,MAAMxT,IAAI,GAAGkpB,QAAQ,CAACppB,MAAM,GAAG,CAAC,GAAGopB,QAAQ,CAAC3c,IAAI,CAAC,KAAK,CAAC,GAAG,mBAAmB;IAC7E,IAAI,CAACvM,IAAI,CAACc,IAAI,CAAC,CAAC,EAAE;MAChB,OAAO,IAAI;IACb;IACA,MAAMkM,UAAU,GAAGhN,IAAI,CAACsH,WAAW,CAAC,CAAC;IACrC,MAAMiU,IAA2C,GAAGvO,UAAU,CAAC3D,QAAQ,CAAC,OAAO,CAAC,GAAG,SAAS,GAAG,MAAM;IACrG,OAAO;MAAErJ,IAAI;MAAEub;IAAK,CAAC;EACvB;EAEQ4K,iBAAiBA,CACvB/U,KAAa,EACbuE,KAAa,EACb4F,IAAqD,EAC7C;IACR,MAAM4N,SAAS,GACb5N,IAAI,KAAK,SAAS,GACdhL,YAAK,CAACwI,OAAO,GACbwC,IAAI,KAAK,MAAM,GACbhL,YAAK,CAACe,OAAO,GACbiK,IAAI,KAAK,OAAO,GACdhL,YAAK,CAACb,KAAK,GACX6L,IAAI,KAAK,OAAO,GACdhL,YAAK,CAACiF,EAAE,CAACC,KAAK,GACdlF,YAAK,CAACgB,IAAI;IACtB,OAAO,GAAGhB,YAAK,CAACiF,EAAE,CAACC,KAAK,CAACrE,KAAK,CAAC,IAAI+X,SAAS,CAACxT,KAAK,CAAC,EAAE;EACvD;EAEQoQ,SAASA,CAAC/lB,IAAY,EAAEub,IAA2C,EAAU;IACnF,QAAQA,IAAI;MACV,KAAK,SAAS;QACZ,OAAOhL,YAAK,CAACwI,OAAO,CAAC/Y,IAAI,CAAC;MAC5B,KAAK,MAAM;QACT,OAAOuQ,YAAK,CAACe,OAAO,CAACtR,IAAI,CAAC;MAC5B,KAAK,OAAO;QACV,OAAOuQ,YAAK,CAACb,KAAK,CAAC1P,IAAI,CAAC;MAC1B,KAAK,MAAM;MACX;QACE,OAAOuQ,YAAK,CAACgB,IAAI,CAACvR,IAAI,CAAC;IAC3B;EACF;EAEQolB,YAAYA,CAAC1S,QAAkB,EAAE/J,QAAgB,EAAY;IACnE,MAAMwB,KAAe,GAAG,EAAE;IAC1B,MAAMyL,SAAS,GAAGrF,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,OAAO,CAAC;IAEzC,IAAIvV,OAAO,GAAG,EAAE;IAChB,KAAK,MAAM4S,OAAO,IAAIJ,QAAQ,EAAE;MAC9B,MAAM1F,UAAU,GAAG8F,OAAO,CAAChS,IAAI,CAAC,CAAC;MACjC,IAAI,CAACkM,UAAU,EAAE;MACjB,IAAI,CAAC9M,OAAO,EAAE;QACZA,OAAO,GAAG,IAAI,CAACsf,YAAY,CAACxS,UAAU,EAAErE,QAAQ,CAAC;QACjD;MACF;MACA,MAAM4Q,SAAS,GAAG,GAAGrZ,OAAO,GAAG0V,SAAS,GAAG5I,UAAU,EAAE;MACvD,IAAI,IAAI,CAACuK,aAAa,CAACgC,SAAS,CAAC,IAAI5Q,QAAQ,EAAE;QAC7CzI,OAAO,GAAGqZ,SAAS;MACrB,CAAC,MAAM;QACLpP,KAAK,CAACkC,IAAI,CAAC,IAAI,CAACmT,YAAY,CAACtf,OAAO,EAAEyI,QAAQ,CAAC,CAAC;QAChDzI,OAAO,GAAG,IAAI,CAACsf,YAAY,CAACxS,UAAU,EAAErE,QAAQ,CAAC;MACnD;IACF;IAEA,IAAIzI,OAAO,EAAE;MACXiK,KAAK,CAACkC,IAAI,CAAC,IAAI,CAACmT,YAAY,CAACtf,OAAO,EAAEyI,QAAQ,CAAC,CAAC;IAClD;IAEA,OAAOwB,KAAK;EACd;EAEQ0V,WAAWA,CAAC/L,CAAW,EAAEC,CAAW,EAAW;IACrD,IAAID,CAAC,CAAChU,MAAM,KAAKiU,CAAC,CAACjU,MAAM,EAAE,OAAO,KAAK;IACvC,KAAK,IAAI/F,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG+Z,CAAC,CAAChU,MAAM,EAAE/F,CAAC,EAAE,EAAE;MACjC,IAAI+Z,CAAC,CAAC/Z,CAAC,CAAC,KAAKga,CAAC,CAACha,CAAC,CAAC,EAAE,OAAO,KAAK;IACjC;IACA,OAAO,IAAI;EACb;EAEQqvB,iBAAiBA,CAAA,EAAa;IACpC,MAAMjf,KAAe,GAAG,EAAE;IAC1B,MAAMoY,UAAU,GAAG,IAAI,CAAC8G,eAAe,CAAC,CAAC;IACzC,IAAI9G,UAAU,EAAE;MACdpY,KAAK,CAACkC,IAAI,CAAC,GAAGkE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,OAAO,CAAC,IAAIlF,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG,CAAC,IAAI8M,UAAU,EAAE,CAAC;IAC/E;IAEA,MAAM+G,YAAY,GAAG,IAAI,CAACC,iBAAiB,CAAC,CAAC;IAC7C,IAAID,YAAY,EAAE;MAChBnf,KAAK,CAACkC,IAAI,CAAC,GAAGkE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,MAAM,CAAC,KAAK6T,YAAY,EAAE,CAAC;IAC1D;IAEA,OAAOnf,KAAK;EACd;;EAEA;AACF;AACA;AACA;EACUqf,sBAAsBA,CAAA,EAAkB;IAC9C;IACA,MAAM9K,KAAe,GAAG,EAAE;IAC1B,MAAMoF,kBAAkB,GAAG,IAAI,CAAC3kB,WAAW,CAACC,mBAAmB,IAAI,IAAI,CAACD,WAAW,CAACE,mBAAmB;;IAEvG;IACA,MAAMoqB,QAAQ,GAAG,IAAI;IACrB,MAAMC,SAAS,GAAG5F,kBAAkB,GAAG,mBAAmB,GAAG,cAAc;IAC3EpF,KAAK,CAACrS,IAAI,CAAC,GAAGkE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAACgU,QAAQ,CAAC,IAAIC,SAAS,IAAInZ,YAAK,CAACwI,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC;;IAE7E;IACA,MAAMtI,aAAa,GAAG,CAAC,IAAI,CAACtR,WAAW,CAACuR,iBAAiB,IAAI,EAAE,EAAE5P,IAAI,CAAC,CAAC,CAACwG,WAAW,CAAC,CAAC;IACrF,IAAImJ,aAAa,IAAIA,aAAa,KAAK,KAAK,EAAE;MAC5CiO,KAAK,CAACrS,IAAI,CAAC,GAAGkE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,UAAU,CAAC,IAAIlF,YAAK,CAACgB,IAAI,CAACd,aAAa,CAAC,EAAE,CAAC;IAC1E;;IAEA;IACA,MAAMkZ,SAAS,GAAGpZ,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,sBAAsB,CAAC;IAExD,IAAIiJ,KAAK,CAAC5e,MAAM,KAAK,CAAC,EAAE;MACtB,OAAO,IAAI;IACb;IAEA,OAAO,KAAK4e,KAAK,CAACnS,IAAI,CAACgE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,KAAK,CAAC,CAAC,IAAIkU,SAAS,EAAE;EAC9D;EAEQN,eAAeA,CAAA,EAAkB;IACvC,MAAMrF,OAKJ,GAAG,EAAE;IAEP,MAAM4F,SAAS,GAAGA,CAACxY,KAAa,EAAEvM,EAAW,EAAEglB,MAAe,EAAElU,KAAc,KAAK;MACjFqO,OAAO,CAAC3X,IAAI,CAAC;QAAE+E,KAAK;QAAEvM,EAAE;QAAEglB,MAAM,EAAE,IAAI,CAACjpB,YAAY,CAACipB,MAAM,CAAC;QAAElU;MAAM,CAAC,CAAC;IACvE,CAAC;IAED,MAAMmU,gBAAgB,GAAG,IAAI,CAAC3qB,WAAW,CAACE,mBAAmB,IAAI,KAAK;IACtE,MAAMykB,kBAAkB,GAAG,IAAI,CAAC3kB,WAAW,CAACC,mBAAmB,IAAI0qB,gBAAgB;IACnF,MAAMC,WAAW,GAAGD,gBAAgB,GAChC,MAAM,GACNhG,kBAAkB,GAChB,IAAI,GACJ,KAAK;IAEX8F,SAAS,CAAC,QAAQ,EAAE9F,kBAAkB,EAAE,IAAI,CAAC3kB,WAAW,CAACme,kBAAkB,EAAEyM,WAAW,CAAC;IACzF,MAAMhG,YAAY,GAAG,IAAI,CAAC5kB,WAAW,CAACG,oBAAoB,IAAI,MAAM;IACpE,MAAM0qB,cAAc,GAAGjG,YAAY,KAAK,MAAM;IAC9C6F,SAAS,CACP,WAAW,EACXI,cAAc,EACd,IAAI,CAAC7qB,WAAW,CAACqe,sBAAsB,EACvCuG,YAAY,KAAK,MAAM,GAAG,MAAM,GAAG,KACrC,CAAC;IAED,MAAMF,kBAAkB,GAAGiG,gBAAgB;IAC3CF,SAAS,CACP,eAAe,EACf/F,kBAAkB,EAClB,IAAI,CAAC1kB,WAAW,CAACse,kBAAkB,EACnCoG,kBAAkB,GAAG,aAAa,GAAG,KACvC,CAAC;IAED,MAAMoG,gBAAgB,GAAG,CAAC,IAAI,CAAC9qB,WAAW,CAACuR,iBAAiB,IAAI,UAAU,EAAE5P,IAAI,CAAC,CAAC;IAClF,MAAM2P,aAAa,GACjBwZ,gBAAgB,CAAC3iB,WAAW,CAAC,CAAC,KAAK,UAAU,GAAG,MAAM,GAAG2iB,gBAAgB,IAAI,UAAU;IACzF,MAAMC,cAAc,GAAGzZ,aAAa,CAAC3Q,MAAM,GAAG,CAAC;IAC/C8pB,SAAS,CAAC,UAAU,EAAEM,cAAc,EAAE,IAAI,CAAC/qB,WAAW,CAACoe,cAAc,EAAE9M,aAAa,CAAC;IAErF,MAAM0Z,YAAY,GAAG,IAAI,CAAChrB,WAAW,CAACI,aAAa,IAAI,KAAK;IAC5D,MAAM6qB,SAAS,GAAGD,YAAY,GAAG,cAAc,GAAG,aAAa;IAC/DP,SAAS,CAAC,MAAM,EAAEO,YAAY,EAAE,IAAI,CAAChrB,WAAW,CAACue,YAAY,EAAE0M,SAAS,CAAC;IAEzE,MAAMC,SAAS,GAAIC,cAAuB,IAAa;MACrD,OAAOtG,OAAO,CACXnb,GAAG,CAAC0hB,MAAM,IAAI;QACb,MAAMC,SAAS,GAAGD,MAAM,CAAC1lB,EAAE,GAAG0L,YAAK,CAACwI,OAAO,CAACwR,MAAM,CAAC5U,KAAK,IAAI,IAAI,CAAC,GAAGpF,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC8U,MAAM,CAAC5U,KAAK,IAAI,KAAK,CAAC;QACzG,MAAM8U,UAAU,GACdH,cAAc,IAAIC,MAAM,CAACV,MAAM,GAAGtZ,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,KAAK8U,MAAM,CAACV,MAAM,GAAG,CAAC,GAAG,EAAE;QAC9E,OAAO,GAAGtZ,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,GAAG8U,MAAM,CAACnZ,KAAK,GAAG,CAAC,IAAIoZ,SAAS,GAAGC,UAAU,EAAE;MAC1E,CAAC,CAAC,CACDle,IAAI,CAACgE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,IAAI,CAAC,CAAC;IAC/B,CAAC;IAED,MAAM9M,QAAQ,GAAG,IAAI,CAACC,SAAS,CAAC,CAAC;IACjC,IAAI0H,IAAI,GAAG+Z,SAAS,CAAC,IAAI,CAAC;;IAE1B;IACA,IAAI,CAACvtB,mBAAmB,GAAG,IAAIC,GAAG,CAChCinB,OAAO,CACJnb,GAAG,CAAC0hB,MAAM,IAAKA,MAAM,CAACV,MAAM,GAAGU,MAAM,CAACV,MAAM,GAAG,IAAK,CAAC,CACrDvd,MAAM,CAAElG,GAAG,IAAoBtC,OAAO,CAACsC,GAAG,CAAC,CAChD,CAAC;;IAED;IACA,IAAI,IAAI,CAACmR,aAAa,CAACjH,IAAI,CAAC,GAAG3H,QAAQ,EAAE;MACvC,IAAI,CAAC7L,mBAAmB,CAAC8gB,KAAK,CAAC,CAAC;MAChCtN,IAAI,GAAG+Z,SAAS,CAAC,KAAK,CAAC;IACzB;IAEA,OAAO/Z,IAAI,CAACxP,IAAI,CAAC,CAAC,GAAGwP,IAAI,GAAG,IAAI;EAClC;EAEQiZ,iBAAiBA,CAAA,EAAkB;IACzC,MAAM7K,KAAe,GAAG,EAAE;IAE1B,MAAMgM,SAAS,GAAGA,CAACtZ,KAAa,EAAEvQ,KAAc,KAAK;MACnD,MAAMmM,UAAU,GAAG,IAAI,CAACpM,YAAY,CAACC,KAAK,CAAC;MAC3C,IAAI,CAACmM,UAAU,EAAE;MACjB,IAAI,IAAI,CAAClQ,mBAAmB,CAAC5C,GAAG,CAAC8S,UAAU,CAAC,EAAE;QAC5C;MACF;MACA0R,KAAK,CAACrS,IAAI,CAAC,GAAGkE,YAAK,CAACgB,IAAI,CAACvE,UAAU,CAAC,IAAIuD,YAAK,CAACiF,EAAE,CAACC,KAAK,CAACrE,KAAK,CAAC,EAAE,CAAC;IAClE,CAAC;;IAED;IACAsZ,SAAS,CAAC,WAAW,EAAE,QAAQ,CAAC;IAChCA,SAAS,CAAC,aAAa,EAAE,QAAQ,CAAC;;IAElC;IACAA,SAAS,CAAC,QAAQ,EAAE,IAAI,CAACvrB,WAAW,CAACme,kBAAkB,CAAC;IACxDoN,SAAS,CAAC,eAAe,EAAE,IAAI,CAACvrB,WAAW,CAACse,kBAAkB,CAAC;IAC/DiN,SAAS,CAAC,UAAU,EAAE,IAAI,CAACvrB,WAAW,CAACoe,cAAc,CAAC;IACtDmN,SAAS,CAAC,MAAM,EAAE,IAAI,CAACvrB,WAAW,CAACue,YAAY,CAAC;IAEhD,IAAIgB,KAAK,CAAC5e,MAAM,KAAK,CAAC,EAAE;MACtB,OAAO,IAAI;IACb;IACA,OAAO4e,KAAK,CAACnS,IAAI,CAACgE,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC,KAAK,CAAC,CAAC;EAC1C;EAGQ6L,cAAcA,CAAA,EAAW;IAC/B,IAAI,IAAI,CAACtkB,cAAc,EAAE;MACvB,MAAMmb,OAAO,GAAG,WAAW,IAAI,CAACnb,cAAc,CAACmN,KAAK,WAAW,IAAI,CAACnN,cAAc,CAACgN,WAAW,kDAAkD;MAChJ,OAAO,IAAI,CAACwV,YAAY,CAAC,GAAGjP,YAAK,CAACC,OAAO,CAAC,IAAI,CAAC,GAAGD,YAAK,CAACiF,EAAE,CAACC,KAAK,CAAC0C,OAAO,CAAC,EAAE,EAAE,IAAI,CAACvP,SAAS,CAAC,CAAC,CAAC;IAChG;;IAEA;IACA,MAAMpE,MAAM,GAAG+L,YAAK,CAACC,OAAO,CAAC,IAAI,CAAC;IAClC,MAAMma,WAAW,GAAG,IAAI,CAACpT,aAAa,CAAC/S,MAAM,CAAC;IAC9C,MAAMmE,QAAQ,GAAG,IAAI,CAACC,SAAS,CAAC,CAAC;IACjC,MAAMgiB,kBAAkB,GAAG,IAAI,CAAC,CAAC;IACjC,MAAMC,iBAAiB,GAAGD,kBAAkB,CAAC9qB,MAAM;;IAEnD;IACA;IACA,MAAMgrB,SAAS,GAAG,IAAI,CAACvuB,MAAM,CAACoE,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC;IAClD,MAAMqM,UAAU,GAAG,IAAI,CAACnK,UAAU,GAAG,GAAG,CAACsS,MAAM,CAAC2V,SAAS,CAAChrB,MAAM,CAAC,GAAGgrB,SAAS;IAC7E,MAAMC,WAAW,GAAG/d,UAAU,CAACvC,KAAK,CAAC,IAAI,CAAC;;IAE1C;IACA,MAAM4J,MAAgB,GAAG,EAAE;IAC3B,IAAI2W,UAAU,GAAG,CAAC;IAClB,IAAIC,UAAU,GAAG,CAAC;IAClB,IAAIC,SAAS,GAAG,CAAC;IACjB,IAAIC,WAAW,GAAG,KAAK;IAEvB,KAAK,IAAIC,SAAS,GAAG,CAAC,EAAEA,SAAS,GAAGL,WAAW,CAACjrB,MAAM,EAAEsrB,SAAS,EAAE,EAAE;MACnE,MAAM9a,IAAI,GAAGya,WAAW,CAACK,SAAS,CAAC,IAAI,EAAE;MACzC,MAAMC,kBAAkB,GAAGD,SAAS,KAAK,CAAC;MAC1C,MAAME,aAAa,GAAGN,UAAU;;MAEhC;MACA,MAAMO,cAAc,GAAG5iB,QAAQ,GAAGgiB,WAAW;MAC7C,MAAMa,aAAa,GAAG7iB,QAAQ,GAAGkiB,iBAAiB;;MAElD;MACA,IAAIxqB,SAAS,GAAGiQ,IAAI;MACpB,IAAImb,kBAAkB,GAAG,IAAI;MAE7B,OAAOprB,SAAS,CAACP,MAAM,GAAG,CAAC,IAAI2rB,kBAAkB,EAAE;QACjD,MAAMvS,cAAc,GAAImS,kBAAkB,IAAII,kBAAkB,GAAIF,cAAc,GAAGC,aAAa;QAClG,MAAM5gB,KAAK,GAAGvK,SAAS,CAACG,KAAK,CAAC,CAAC,EAAE0Y,cAAc,CAAC;QAChD7Y,SAAS,GAAGA,SAAS,CAACG,KAAK,CAAC0Y,cAAc,CAAC;;QAE3C;QACA,IAAIwS,WAAmB;QACvB,IAAIL,kBAAkB,IAAII,kBAAkB,EAAE;UAC5CC,WAAW,GAAG,GAAGlnB,MAAM,GAAGoG,KAAK,EAAE;QACnC,CAAC,MAAM;UACL8gB,WAAW,GAAG,GAAGd,kBAAkB,GAAGhgB,KAAK,EAAE;QAC/C;;QAEA;QACA,IAAI,CAACugB,WAAW,EAAE;UAChB,MAAMQ,UAAU,GAAGL,aAAa,IAAIhb,IAAI,CAACxQ,MAAM,GAAGO,SAAS,CAACP,MAAM,GAAG8K,KAAK,CAAC9K,MAAM,CAAC;UAClF,MAAM8rB,QAAQ,GAAGD,UAAU,GAAG/gB,KAAK,CAAC9K,MAAM;UAC1C,IAAI,IAAI,CAACtD,MAAM,IAAImvB,UAAU,IAAI,IAAI,CAACnvB,MAAM,IAAIovB,QAAQ,EAAE;YACxDX,UAAU,GAAG5W,MAAM,CAACvU,MAAM;YAC1B,MAAM+rB,aAAa,GAAG,IAAI,CAACrvB,MAAM,GAAGmvB,UAAU;YAC9CT,SAAS,GAAG,CAAEG,kBAAkB,IAAII,kBAAkB,GAAId,WAAW,GAAGE,iBAAiB,IAAIgB,aAAa;YAC1GV,WAAW,GAAG,IAAI;UACpB;QACF;QAEA9W,MAAM,CAAChI,IAAI,CAACqf,WAAW,CAAC;QACxBD,kBAAkB,GAAG,KAAK;;QAE1B;QACA,IAAIprB,SAAS,CAACP,MAAM,KAAK,CAAC,IAAI8K,KAAK,CAAC9K,MAAM,KAAK,CAAC,EAAE;MACpD;MAEAkrB,UAAU,IAAI1a,IAAI,CAACxQ,MAAM,GAAG,CAAC,CAAC,CAAC;IACjC;;IAEA;IACA,IAAI,CAACqrB,WAAW,EAAE;MAChBF,UAAU,GAAGtrB,IAAI,CAACC,GAAG,CAAC,CAAC,EAAEyU,MAAM,CAACvU,MAAM,GAAG,CAAC,CAAC;MAC3C,MAAMgsB,QAAQ,GAAGzX,MAAM,CAAC4W,UAAU,CAAC,IAAI,EAAE;MACzCC,SAAS,GAAG,IAAI,CAAC3T,aAAa,CAACuU,QAAQ,CAAC;IAC1C;;IAEA;IACA,IAAIzX,MAAM,CAACvU,MAAM,GAAG,CAAC,EAAE;MACrB,MAAMisB,UAAU,GAAG1X,MAAM,CAAC4W,UAAU,CAAC,IAAI,EAAE;MAC3C,MAAMe,WAAW,GAAG,IAAI,CAAClW,SAAS,CAACiW,UAAU,CAAC;MAC9C,MAAME,SAAS,GAAGtsB,IAAI,CAACE,GAAG,CAACqrB,SAAS,EAAEc,WAAW,CAAClsB,MAAM,CAAC;;MAEzD;MACA,MAAMosB,MAAM,GAAGF,WAAW,CAACxrB,KAAK,CAAC,CAAC,EAAEyrB,SAAS,CAAC;MAC9C,MAAM9f,EAAE,GAAG6f,WAAW,CAACG,MAAM,CAACF,SAAS,CAAC,IAAI,GAAG;MAC/C,MAAMG,KAAK,GAAGJ,WAAW,CAACxrB,KAAK,CAACyrB,SAAS,GAAG,CAAC,CAAC;;MAE9C;MACA,MAAMvX,MAAM,GAAGuW,UAAU,KAAK,CAAC,GAAGzmB,MAAM,GAAGomB,kBAAkB;MAC7D,MAAMyB,QAAQ,GAAGpB,UAAU,KAAK,CAAC,GAAGiB,MAAM,CAAC1rB,KAAK,CAACmqB,WAAW,CAAC,GAAGuB,MAAM,CAAC1rB,KAAK,CAACqqB,iBAAiB,CAAC;MAC/FxW,MAAM,CAAC4W,UAAU,CAAC,GAAG,GAAGvW,MAAM,GAAG2X,QAAQ,GAAG3xB,GAAG,CAACa,OAAO,GAAG4Q,EAAE,GAAGzR,GAAG,CAACc,KAAK,GAAG4wB,KAAK,EAAE;IACpF;;IAEA;IACA,IAAI,CAACzqB,mBAAmB,GAAGupB,SAAS,GAAG,CAAC;IAExC,OAAO7W,MAAM,CAAC9H,IAAI,CAAC,IAAI,CAAC;EAC1B;EAEQ+f,gBAAgBA,CAACC,SAAiB,EAAoC;IAC5E,IAAIA,SAAS,IAAI,CAAC,EAAE;MAClB,OAAO;QAAEvsB,IAAI,EAAE,EAAE;QAAExD,MAAM,EAAE;MAAE,CAAC;IAChC;IAEA,IAAI,IAAI,CAACQ,cAAc,EAAE;MACvB,OAAO;QAAEgD,IAAI,EAAE,EAAE;QAAExD,MAAM,EAAE;MAAE,CAAC;IAChC;IAEA,MAAMwQ,UAAU,GAAG,IAAI,CAACzQ,MAAM,CAACoE,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC;IACnD,MAAM6rB,WAAW,GAAG7sB,IAAI,CAACE,GAAG,CAAC,IAAI,CAACrD,MAAM,EAAEwQ,UAAU,CAAClN,MAAM,CAAC;IAE5D,IAAI2sB,MAAM,GAAG,IAAI,CAACnrB,iBAAiB;IACnC,IAAIkrB,WAAW,GAAGC,MAAM,EAAE;MACxBA,MAAM,GAAGD,WAAW;IACtB;IACA,MAAMvN,QAAQ,GAAGuN,WAAW,GAAGC,MAAM,GAAGF,SAAS,GAAG,CAAC;IACrD,IAAItN,QAAQ,GAAG,CAAC,EAAE;MAChBwN,MAAM,IAAIxN,QAAQ;IACpB;IACA,MAAMyN,SAAS,GAAG/sB,IAAI,CAACC,GAAG,CAAC,CAAC,EAAEoN,UAAU,CAAClN,MAAM,GAAGysB,SAAS,CAAC;IAC5D,IAAIE,MAAM,GAAGC,SAAS,EAAE;MACtBD,MAAM,GAAGC,SAAS;IACpB;IACA,IAAI,CAACprB,iBAAiB,GAAGmrB,MAAM;IAE/B,MAAME,MAAM,GAAG3f,UAAU,CAACxM,KAAK,CAACisB,MAAM,EAAEA,MAAM,GAAGF,SAAS,CAAC;IAC3D,MAAMK,OAAO,GAAGD,MAAM,CAACliB,KAAK,CAAC,EAAE,CAAC,CAAC5B,GAAG,CAACgkB,IAAI,IAAKA,IAAI,KAAK,IAAI,GAAG9wB,mBAAmB,GAAG8wB,IAAK,CAAC,CAACtgB,IAAI,CAAC,EAAE,CAAC;IACnG,MAAMugB,cAAc,GAAGntB,IAAI,CAACE,GAAG,CAAC+sB,OAAO,CAAC9sB,MAAM,EAAEH,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE4sB,WAAW,GAAGC,MAAM,CAAC,CAAC;IAElF,MAAMP,MAAM,GAAGU,OAAO,CAACpsB,KAAK,CAAC,CAAC,EAAEssB,cAAc,CAAC;IAC/C,MAAM3gB,EAAE,GAAGygB,OAAO,CAACT,MAAM,CAACW,cAAc,CAAC,IAAI,GAAG;IAChD,MAAMV,KAAK,GAAGQ,OAAO,CAACpsB,KAAK,CAACssB,cAAc,GAAG,CAAC,CAAC;IAE/C,OAAO;MACL9sB,IAAI,EAAE,GAAGksB,MAAM,GAAGxxB,GAAG,CAACa,OAAO,GAAG4Q,EAAE,GAAGzR,GAAG,CAACc,KAAK,GAAG4wB,KAAK,EAAE;MACxD5vB,MAAM,EAAEswB;IACV,CAAC;EACH;;EAEA;AACF;AACA;AACA;AACA;EACUhlB,4BAA4BA,CAAA,EAAS;IAC3C,IAAI,CAAC,IAAI,CAAC9K,cAAc,EAAE;IAC1B,MAAM+vB,SAAS,GAAG,IAAI,CAAC/vB,cAAc,CAACgD,IAAI;IAC1C,MAAMiK,cAAc,GAAG,IAAI,CAACjN,cAAc,CAACiN,cAAc;IACzD,MAAMC,cAAc,GAAG,IAAI,CAAClN,cAAc,CAACkN,cAAc;IACzD,IAAI,CAAClN,cAAc,GAAG,IAAI;IAC1B;IACA,MAAMkvB,MAAM,GAAGjiB,cAAc,CAACzJ,KAAK,CAAC,CAAC,EAAE0J,cAAc,CAAC;IACtD,MAAMkiB,KAAK,GAAGniB,cAAc,CAACzJ,KAAK,CAAC0J,cAAc,CAAC;IAClD,IAAI,CAAC3N,MAAM,GAAG2vB,MAAM,GAAGa,SAAS,GAAGX,KAAK;IACxC,IAAI,CAAC5vB,MAAM,GAAG0vB,MAAM,CAACpsB,MAAM,GAAGitB,SAAS,CAACjtB,MAAM;IAC9C,IAAI,CAACoI,iBAAiB,CAAC,CAAC;IACxB,IAAI,CAACtD,YAAY,CAAC,CAAC;IACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;EACxB;;EAEA;AACF;AACA;AACA;AACA;EACU6B,oBAAoBA,CAAA,EAAS;IACnC,IAAI,CAAC,IAAI,CAACnL,cAAc,EAAE;IAC1B,MAAM+vB,SAAS,GAAG,IAAI,CAAC/vB,cAAc,CAACgD,IAAI;IAC1C,MAAMiK,cAAc,GAAG,IAAI,CAACjN,cAAc,CAACiN,cAAc;IACzD,MAAMC,cAAc,GAAG,IAAI,CAAClN,cAAc,CAACkN,cAAc;IACzD,IAAI,CAAClN,cAAc,GAAG,IAAI;IAC1B;IACA,MAAMkvB,MAAM,GAAGjiB,cAAc,CAACzJ,KAAK,CAAC,CAAC,EAAE0J,cAAc,CAAC;IACtD,MAAMkiB,KAAK,GAAGniB,cAAc,CAACzJ,KAAK,CAAC0J,cAAc,CAAC;IAClD,MAAM8iB,YAAY,GAAGd,MAAM,GAAGa,SAAS,GAAGX,KAAK;IAC/C;IACA,IAAI,CAAC7vB,MAAM,GAAG,EAAE;IAChB,IAAI,CAACC,MAAM,GAAG,CAAC;IACf,IAAI,CAAC0L,iBAAiB,CAAC,CAAC;IACxB,IAAI,CAACtD,YAAY,CAAC,CAAC;IACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;IACtB;IACA,IAAI,CAACkC,UAAU,CAACwkB,YAAY,CAAC;EAC/B;EAEAC,YAAYA,CAACvgB,OAAwE,GAAG,CAAC,CAAC,EAAmB;IAC3G,IAAI,IAAI,CAACrJ,YAAY,EAAE;MACrB,OAAO6pB,OAAO,CAACC,MAAM,CAAC,IAAI9nB,KAAK,CAAC,mCAAmC,CAAC,CAAC;IACvE;IAEA,IAAIqH,OAAO,CAAC0gB,WAAW,EAAE;MACvB,IAAI,CAAC7wB,MAAM,GAAG,EAAE;MAChB,IAAI,CAACC,MAAM,GAAG,CAAC;MACf,IAAI,CAAC8E,iBAAiB,GAAG,CAAC;MAC1B,IAAI,CAACwL,gBAAgB,CAAC,CAAC;MACvB,IAAI,CAAClI,YAAY,CAAC,CAAC;MACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;IACxB;IAEA,OAAO,IAAI4mB,OAAO,CAAS,CAACngB,OAAO,EAAEogB,MAAM,KAAK;MAC9C,IAAI,CAAC9pB,YAAY,GAAG;QAClB0J,OAAO;QACPogB,MAAM;QACNzgB,OAAO,EAAE;UACP5L,IAAI,EAAE4L,OAAO,CAAC5L,IAAI,KAAK,KAAK;UAC5B8L,UAAU,EAAEF,OAAO,CAACE,UAAU,IAAI;QACpC;MACF,CAAC;IACH,CAAC,CAAC;EACJ;EAEQxH,kBAAkBA,CAACioB,MAAgB,EAAQ;IACjD,IAAI,CAAC,IAAI,CAAChqB,YAAY,EAAE;MACtB;IACF;IACA,MAAMiqB,OAAO,GAAG,IAAI,CAACjqB,YAAY;IACjC,IAAI,CAACA,YAAY,GAAG,IAAI;IACxBiqB,OAAO,CAACH,MAAM,GAAGE,MAAM,IAAI,IAAIhoB,KAAK,CAAC,yBAAyB,CAAC,CAAC;EAClE;;EAGA;;EAEQ+b,eAAeA,CAACphB,IAAY,EAAE2Z,KAAa,EAAEzE,MAAc,EAAY;IAC7E,MAAMX,KAAK,GAAGvU,IAAI,CAACyK,KAAK,CAAC,OAAO,CAAC;IACjC,MAAMN,KAAe,GAAG,EAAE;IAC1B,IAAIjK,OAAO,GAAG,EAAE;IAEhB,KAAK,MAAMuU,IAAI,IAAIF,KAAK,EAAE;MACxB,MAAMnG,IAAI,GAAGlO,OAAO,GAAGuU,IAAI;MAC3B,IAAI,IAAI,CAAC8C,aAAa,CAACnJ,IAAI,CAAC,GAAGuL,KAAK,IAAIzZ,OAAO,CAACY,IAAI,CAAC,CAAC,EAAE;QACtD;QACAqJ,KAAK,CAACkC,IAAI,CAACnM,OAAO,CAACsN,OAAO,CAAC,CAAC,CAAC;QAC7BtN,OAAO,GAAGgV,MAAM,GAAGT,IAAI,CAACE,SAAS,CAAC,CAAC;MACrC,CAAC,MAAM;QACLzU,OAAO,GAAGkO,IAAI;MAChB;IACF;IAEA,IAAIlO,OAAO,CAACY,IAAI,CAAC,CAAC,EAAE;MAClBqJ,KAAK,CAACkC,IAAI,CAACnM,OAAO,CAACsN,OAAO,CAAC,CAAC,CAAC;IAC/B;;IAEA;IACA,OAAOrD,KAAK,CAACrK,MAAM,GAAGqK,KAAK,GAAG,CAACnK,IAAI,CAAC;EACtC;EAEQ4I,SAASA,CAAA,EAAW;IAC1B,MAAMzM,IAAI,GAAG,IAAI,CAACoH,MAAM,CAACQ,KAAK,GAAG,IAAI,CAAC5H,IAAI,IAAI,EAAE,GAAG,EAAE;IACrD,OAAOwD,IAAI,CAACC,GAAG,CAAC,CAAC,EAAEzD,IAAI,GAAG,CAAC,CAAC;EAC9B;EAEQob,aAAaA,CAAC5B,KAAa,EAAU;IAC3C,IAAI,CAACA,KAAK,EAAE,OAAO,CAAC;IACpB,OAAO,IAAI,CAACG,SAAS,CAACH,KAAK,CAAC,CAAC7V,MAAM;EACrC;EAEQgW,SAASA,CAACH,KAAa,EAAU;IACvC,IAAI,CAACA,KAAK,EAAE,OAAO,EAAE;IACrB;IACA,OAAOA,KAAK,CAAChV,OAAO,CAAC,4BAA4B,EAAE,EAAE,CAAC;EACxD;EAEQ6e,YAAYA,CAAC7J,KAAa,EAAEgE,KAAa,EAAU;IACzD,IAAI,CAAChE,KAAK,EAAE,OAAO,EAAE;IACrB,MAAM4X,KAAK,GAAG5tB,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE+Z,KAAK,CAAC;IAChC;IACA,MAAMkC,MAAM,GAAGlG,KAAK,CAAClL,KAAK,CAAC,mBAAmB,CAAC;IAC/C,IAAI+iB,OAAO,GAAG,CAAC;IACf,IAAIpjB,SAAS,GAAG,KAAK;IACrB,IAAIiK,MAAM,GAAG,EAAE;IAEf,KAAK,MAAMoZ,KAAK,IAAI5R,MAAM,EAAE;MAC1B,IAAI,CAAC4R,KAAK,EAAE;MACZ;MACA,IAAI,mBAAmB,CAAC9lB,IAAI,CAAC8lB,KAAK,CAAC,EAAE;QACnCpZ,MAAM,IAAIoZ,KAAK;QACf;MACF;MACA,IAAID,OAAO,IAAID,KAAK,EAAE;QACpBnjB,SAAS,GAAG,IAAI;QAChB;MACF;MACA,MAAM/J,SAAS,GAAGktB,KAAK,GAAGC,OAAO;MACjC,IAAIC,KAAK,CAAC3tB,MAAM,IAAIO,SAAS,EAAE;QAC7BgU,MAAM,IAAIoZ,KAAK;QACfD,OAAO,IAAIC,KAAK,CAAC3tB,MAAM;MACzB,CAAC,MAAM;QACL,MAAM4tB,WAAW,GAAG/tB,IAAI,CAACC,GAAG,CAAC,CAAC,EAAES,SAAS,GAAG,CAAC,CAAC;QAC9C,IAAIqtB,WAAW,GAAG,CAAC,EAAE;UACnBrZ,MAAM,IAAIoZ,KAAK,CAACjtB,KAAK,CAAC,CAAC,EAAEktB,WAAW,CAAC;UACrCF,OAAO,IAAIE,WAAW;QACxB;QACArZ,MAAM,IAAI,GAAG;QACbjK,SAAS,GAAG,IAAI;QAChB;MACF;IACF;IAEA,IAAIA,SAAS,IAAI,CAACiK,MAAM,CAACnI,QAAQ,CAACxR,GAAG,CAACc,KAAK,CAAC,EAAE;MAC5C6Y,MAAM,IAAI3Z,GAAG,CAACc,KAAK;IACrB;IAEA,OAAO6Y,MAAM;EACf;EAEAsZ,SAASA,CAAA,EAAW;IAClB,OAAO,IAAI,CAACpxB,MAAM;EACpB;EAEAqxB,SAASA,CAAA,EAAW;IAClB,OAAO,IAAI,CAACpxB,MAAM;EACpB;EAEAqxB,SAASA,CAAC7tB,IAAY,EAAEisB,SAAkB,EAAQ;IAChD,IAAI,CAAC1vB,MAAM,GAAGyD,IAAI;IAClB;IACA,MAAM8tB,eAAe,GAAG7B,SAAS,IAAIjsB,IAAI,CAACF,MAAM;IAChD,IAAI,CAACtD,MAAM,GAAGmD,IAAI,CAACC,GAAG,CAAC,CAAC,EAAED,IAAI,CAACE,GAAG,CAACiuB,eAAe,EAAE9tB,IAAI,CAACF,MAAM,CAAC,CAAC;IACjE,IAAI,CAACwB,iBAAiB,GAAG,CAAC;IAC1B,IAAI,CAAC4G,iBAAiB,CAAC,CAAC;IACxB,IAAI,CAACtD,YAAY,CAAC,CAAC;IACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;EACxB;EAEAynB,aAAaA,CAACC,OAAgB,EAAQ;IACpC,IAAI,CAACnrB,UAAU,GAAGmrB,OAAO;IACzB,IAAI,CAACppB,YAAY,CAAC,CAAC;EACrB;EAEAuC,WAAWA,CAAA,EAAS;IAClB,IAAI,CAACnC,uBAAuB,CAAC,CAAC;IAC9B,IAAI,CAACzI,MAAM,GAAG,EAAE;IAChB,IAAI,CAACC,MAAM,GAAG,CAAC;IACf,IAAI,CAAC8E,iBAAiB,GAAG,CAAC;IAC1B,IAAI,CAAC3E,WAAW,GAAG,EAAE;IACrB,IAAI,CAACC,eAAe,GAAG,CAAC,CAAC;IACzB,IAAI,CAACgI,YAAY,CAAC,CAAC;IACnB,IAAI,CAAC0B,eAAe,CAAC,CAAC;EACxB;EAEA2nB,aAAaA,CAAC3R,MAAqB,EAAQ;IACzC,IAAI,CAACH,YAAY,CAACG,MAAM,CAAC;EAC3B;;EAEA;AACF;AACA;AACA;EACE4R,oBAAoBA,CAACve,OAAe,EAAQ;IAC1C,IAAI,CAACpS,aAAa,GAAGoS,OAAO;IAC5B,IAAI,CAAC,IAAI,CAAC3R,eAAe,EAAE;MACzB,IAAI,CAACA,eAAe,GAAGwd,WAAW,CAAC,MAAM;QACvC,IAAI,CAACzd,YAAY,EAAE;QACnB;QACA,IAAI,IAAI,CAACA,YAAY,GAAG,EAAE,KAAK,CAAC,EAAE;UAChC,IAAI,CAACQ,mBAAmB,EAAE;QAC5B;QACA,IAAI,CAACqG,YAAY,CAAC,CAAC;MACrB,CAAC,EAAE,EAAE,CAAC;IACR;IACA,IAAI,CAACA,YAAY,CAAC,CAAC;EACrB;;EAEA;AACF;AACA;EACEupB,oBAAoBA,CAAA,EAAS;IAC3B,IAAI,IAAI,CAACnwB,eAAe,EAAE;MACxBuH,aAAa,CAAC,IAAI,CAACvH,eAAe,CAAC;MACnC,IAAI,CAACA,eAAe,GAAG,IAAI;IAC7B;IACA,IAAI,CAACT,aAAa,GAAG,IAAI;IACzB,IAAI,CAACqH,YAAY,CAAC,CAAC;EACrB;EAEAwpB,UAAUA,CAAC3kB,OAAe,EAAQ;IAChC,IAAI,CAAC4kB,eAAe,CAAC5kB,OAAO,CAAC;EAC/B;;EAEA;AACF;AACA;AACA;AACA;EACUwD,iBAAiBA,CAACjN,IAAY,EAAQ;IAC5C,MAAMgN,UAAU,GAAGhN,IAAI,EAAEc,IAAI,CAAC,CAAC;IAC/B,IAAI,CAACkM,UAAU,EAAE;;IAEjB;IACA,MAAMnC,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;IACtB,IAAI,IAAI,CAAC7J,eAAe,IAAI,IAAI,CAACA,eAAe,CAAChB,IAAI,KAAKgN,UAAU,IAAInC,GAAG,GAAG,IAAI,CAAC7J,eAAe,CAACmL,EAAE,GAAG,IAAI,EAAE;MAC5G;IACF;IACA,IAAI,CAACnL,eAAe,GAAG;MAAEhB,IAAI,EAAEgN,UAAU;MAAEb,EAAE,EAAEtB;IAAI,CAAC;;IAEpD;IACA,IAAI,CAACyD,QAAQ,CAAC,QAAQ,EAAEtB,UAAU,CAAC;EACrC;EAEA/G,MAAMA,CAAA,EAAS;IACb,IAAI,CAACrB,YAAY,CAAC,CAAC;EACrB;EAEQgL,KAAKA,CAAC0e,EAAU,EAAiB;IACvC,OAAO,IAAIpB,OAAO,CAACngB,OAAO,IAAIjE,UAAU,CAACiE,OAAO,EAAEuhB,EAAE,CAAC,CAAC;EACxD;;EAEA;;EAEQppB,KAAKA,CAACqpB,IAAY,EAAQ;IAChC,IAAI,CAAChrB,MAAM,CAAC2B,KAAK,CAACqpB,IAAI,CAAC;EACzB;EAEQF,eAAeA,CAACruB,IAAY,EAAQ;IAC1C,MAAMgN,UAAU,GAAGhN,IAAI,EAAEc,IAAI,CAAC,CAAC;IAC/B,IAAI,CAACkM,UAAU,EAAE;MACf;IACF;IACA,MAAMnC,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;IACtB,IAAI,IAAI,CAAC7J,eAAe,IAAI,IAAI,CAACA,eAAe,CAAChB,IAAI,KAAKgN,UAAU,IAAInC,GAAG,GAAG,IAAI,CAAC7J,eAAe,CAACmL,EAAE,GAAG,IAAI,EAAE;MAC5G;IACF;IACA,IAAI,CAACnL,eAAe,GAAG;MAAEhB,IAAI,EAAEgN,UAAU;MAAEb,EAAE,EAAEtB;IAAI,CAAC;IACpD,IAAI,CAACyD,QAAQ,CAAC,QAAQ,EAAEtB,UAAU,CAAC;EACrC;EAEQ/H,eAAeA,CAAA,EAAS;IAC9B,IAAI,IAAI,CAACrH,YAAY,EAAE;MACrB,OAAO,CAAC;IACV;IACA,MAAM8hB,MAAM,GAAG,IAAI,CAACxe,iBAAiB,IAAI,IAAI,CAACD,YAAY,IAAI,CAAC;IAC/D,IAAIye,MAAM,KAAK,CAAC,EAAE;;IAElB;IACA;IACA,MAAM8O,SAAS,GAAG,IAAI,CAAC/rB,WAAW,EAAEgd,WAAW,IAAI,CAAC;IACpD,IAAI+O,SAAS,GAAG,CAAC,EAAE;MACjB,IAAI,CAACtpB,KAAK,CAAC,QAAQspB,SAAS,GAAG,CAAC;IAClC;;IAEA;IACA,KAAK,IAAIz0B,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG2lB,MAAM,EAAE3lB,CAAC,EAAE,EAAE;MAC/B,IAAI,CAACmL,KAAK,CAAC,KAAKxK,GAAG,CAACI,UAAU,EAAE,CAAC;MACjC,IAAIf,CAAC,GAAG2lB,MAAM,GAAG,CAAC,EAAE;QAClB,IAAI,CAACxa,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC;MACxB;IACF;;IAEA;IACA,IAAI,CAACA,KAAK,CAAC,QAAQ,CAAC;;IAEpB;IACA;IACA,IAAIwa,MAAM,GAAG,CAAC,EAAE;MACd,IAAI,CAACxa,KAAK,CAAC,QAAQwa,MAAM,GAAG,CAAC,GAAG,CAAC;IACnC;IACA,IAAI,CAACxa,KAAK,CAAC,IAAI,CAAC;;IAEhB;IACA,IAAI,CAACzC,WAAW,GAAG,IAAI;IACvB,IAAI,CAACC,mBAAmB,GAAG,IAAI;IAC/B,IAAI,CAACzB,YAAY,GAAG,CAAC;IACrB,IAAI,CAACC,iBAAiB,GAAG,CAAC;IAC1B,IAAI,CAACG,cAAc,GAAG,KAAK;IAC3B,IAAI,CAACmB,sBAAsB,GAAG,KAAK;EACrC;EAEQmC,kBAAkBA,CAAA,EAAS;IACjC,IAAI,IAAI,CAACpB,MAAM,CAACQ,KAAK,EAAE;MACrB,IAAI,CAAC7H,IAAI,GAAG,IAAI,CAACqH,MAAM,CAACrH,IAAI,IAAI,EAAE;MAClC,IAAI,CAACC,IAAI,GAAG,IAAI,CAACoH,MAAM,CAACkrB,OAAO,IAAI,EAAE;IACvC;EACF;AACF;AAACC,OAAA,CAAA1yB,iBAAA,GAAAA,iBAAA","ignoreList":[]}