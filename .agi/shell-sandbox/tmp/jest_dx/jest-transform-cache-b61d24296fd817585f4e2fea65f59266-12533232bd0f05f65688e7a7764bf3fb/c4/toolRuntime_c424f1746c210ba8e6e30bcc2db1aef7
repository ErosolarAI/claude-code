b96764af9c38dfbb4694368c49494e89
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ToolRuntimeUtils = exports.ToolRuntime = void 0;
exports.createDefaultToolRuntime = createDefaultToolRuntime;
exports.reportToolProgress = reportToolProgress;
var _nodeAsync_hooks = require("node:async_hooks");
var _nodePath = require("node:path");
var _schemaValidator = require("./schemaValidator.js");
var _toolPreconditions = require("./toolPreconditions.js");
var _resultVerification = require("./resultVerification.js");
var _debugLogger = require("../utils/debugLogger.js");
var _toolExecutionIO = require("./toolExecutionIO.js");
/* eslint-disable @typescript-eslint/no-namespace */

const toolExecutionContext = new _nodeAsync_hooks.AsyncLocalStorage();

/**
 * Report incremental progress for the currently executing tool.
 * Tools can call this to surface live status updates (e.g., indexing files).
 */
function reportToolProgress(progress) {
  const context = toolExecutionContext.getStore();
  if (!context?.observer?.onToolProgress) {
    return;
  }
  const current = Number.isFinite(progress.current) ? Math.max(0, progress.current) : 0;
  const total = progress.total !== undefined ? Math.max(current, progress.total) : current;
  try {
    context.observer.onToolProgress(context.call, {
      current,
      total,
      message: progress.message
    });
  } catch {
    // Swallow observer errors so they don't break tool execution
  }
}

// Idempotent tools that can be safely cached
const CACHEABLE_TOOLS = new Set(['Read', 'read_file', 'Glob', 'glob_search', 'Grep', 'grep_search', 'find_definition', 'analyze_code_quality', 'extract_exports']);
function buildOptimizationHint(warning) {
  const code = warning.code;
  const suggestion = warning.suggestion || warning.message;
  switch (code) {
    case 'SEARCH_BROAD_PATTERN':
    case 'SEARCH_CONTEXT_OVERFLOW_RISK':
      return `\n\n<optimization-hint>\n` + `⚡ SEARCH: ${suggestion}\n` + `</optimization-hint>`;
    case _toolPreconditions.EDIT_WITHOUT_READ:
    case 'EDIT_PLACEHOLDER':
      return `\n\n<optimization-hint>\n` + `⚡ EDIT: Read the file first to copy exact whitespace. ${suggestion}\n` + `</optimization-hint>`;
    case 'NPM_INCOMPLETE_WORKFLOW':
      return `\n\n<optimization-hint>\n` + `⚡ PUBLISH: ${suggestion}\n` + `</optimization-hint>`;
    default:
      return null;
  }
}

/**
 * Type-safe utility functions for tool runtime operations
 */
let ToolRuntimeUtils = exports.ToolRuntimeUtils = void 0;
(function (_ToolRuntimeUtils) {
  function createToolDefinition(definition) {
    return definition;
  }
  _ToolRuntimeUtils.createToolDefinition = createToolDefinition;
  function createToolSuite(suite) {
    return suite;
  }
  _ToolRuntimeUtils.createToolSuite = createToolSuite;
  function isToolDefinition(__tool, expectedSchema) {
    if (!expectedSchema) return true;
    // In a real implementation, this would validate against the schema
    return true;
  }
  _ToolRuntimeUtils.isToolDefinition = isToolDefinition;
})(ToolRuntimeUtils || (exports.ToolRuntimeUtils = ToolRuntimeUtils = {}));
/**
 * Interface describing the public API of ToolRuntime.
 * Used by wrapper implementations like RestrictedToolRuntime.
 */
class ToolRuntime {
  registry = new Map();
  registrationOrder = [];
  cache = new Map();
  toolHistory = [];
  maxHistorySize = 50; // Keep last 50 tool calls for AI flow pattern detection
  diffSnapshots = [];
  maxDiffSnapshots = 5; // Keep only the most recent git diff outputs
  maxDiffSnapshotLength = 4000;
  constructor(baseTools = [], options = {}, io = _toolExecutionIO.defaultToolIO) {
    this.observer = options.observer ?? null;
    this.contextManager = options.contextManager ?? null;
    this.io = options.io ?? io;
    this.snapshotDir = options.snapshotDir ?? (0, _nodePath.join)(process.cwd(), '.agi', 'tool-snapshots');
    this.enableCache = options.enableCache ?? true;
    this.cacheTTLMs = options.cacheTTLMs ?? 5 * 60 * 1000; // 5 minutes default
    if (baseTools.length) {
      this.registerSuite({
        id: 'runtime.core',
        description: 'Core runtime metadata tools',
        tools: baseTools
      });
    }
  }
  registerSuite(suite) {
    if (!suite?.id?.trim()) {
      throw new Error('Tool suite id cannot be blank.');
    }
    this.unregisterSuite(suite.id);
    for (const definition of suite.tools ?? []) {
      this.addTool(definition, suite.id);
    }
  }
  unregisterSuite(id) {
    if (!id?.trim()) {
      return;
    }
    for (const [name, record] of this.registry.entries()) {
      if (record.suiteId === id) {
        this.registry.delete(name);
        this.removeFromOrder(name);
      }
    }
  }
  listProviderTools() {
    return this.registrationOrder.map(name => this.registry.get(name)).filter(record => Boolean(record)).map(({
      definition
    }) => ({
      name: definition.name,
      description: definition.description,
      ...(definition.parameters && {
        parameters: definition.parameters
      })
    }));
  }
  async execute(call, _context) {
    const record = this.registry.get(call.name);
    const rawArgs = normalizeToolArguments(call.arguments);
    const args = (0, _schemaValidator.coerceToolArguments)(record?.definition.parameters, rawArgs);
    const augmentedCall = {
      ...call,
      args
    };
    if (!record) {
      const message = `Tool "${call.name}" is not available.`;
      this.observer?.onToolError?.(augmentedCall, message);
      return message;
    }

    // Check if tool is cacheable
    const isCacheable = record.definition.cacheable ?? CACHEABLE_TOOLS.has(call.name);
    const cacheTtl = typeof record.definition.cacheTtlMs === 'number' && Number.isFinite(record.definition.cacheTtlMs) ? Math.max(0, Math.floor(record.definition.cacheTtlMs)) : this.cacheTTLMs;
    const canUseCache = this.enableCache && isCacheable && cacheTtl > 0;

    // Try to get from cache
    if (canUseCache) {
      const cacheKey = this.getCacheKey({
        ...call,
        arguments: args
      });
      const cached = this.cache.get(cacheKey);
      if (cached && Date.now() - cached.timestamp < cacheTtl) {
        this.observer?.onCacheHit?.(augmentedCall);
        this.observer?.onToolResult?.(augmentedCall, cached.result);

        // Record cache hit as successful execution with 0ms time
        this.recordToolHistory({
          toolName: call.name,
          args,
          timestamp: Date.now(),
          success: true,
          hasOutput: hasNonEmptyOutput(cached.result)
        });
        return cached.result;
      }
    }
    this.observer?.onToolStart?.(augmentedCall);

    // Start performance monitoring
    const startTime = Date.now();
    const finishToolCall = () => {
      const duration = Date.now() - startTime;
      if (duration > 1000) {
        // Log long-running tools for debugging
        if (process.env['DEBUG_TOOL_PERF']) {
          (0, _debugLogger.logDebug)(`[Tool Runtime] ${call.name} took ${duration}ms`);
        }
      }
    };
    try {
      (0, _schemaValidator.validateToolArguments)(record.definition.name, record.definition.parameters, args);

      // Pre-flight AI flow validation - catch common tool usage failures
      const preflightWarnings = (0, _toolPreconditions.validateToolPreconditions)(call.name, args);
      for (const warning of preflightWarnings) {
        this.observer?.onToolWarning?.(augmentedCall, warning);
      }

      // Advanced AI flow pattern validation using tool history
      const aiFlowWarnings = (0, _toolPreconditions.validateAIFlowPatterns)(call.name, args, this.toolHistory);
      for (const warning of aiFlowWarnings) {
        this.observer?.onToolWarning?.(augmentedCall, warning);
      }

      // Collect optimization hints to inject into result
      const optimizationHints = [];
      const seenOptimizationCodes = new Set();
      for (const warning of [...preflightWarnings, ...aiFlowWarnings]) {
        if (warning.code && seenOptimizationCodes.has(warning.code)) {
          continue;
        }
        const hint = buildOptimizationHint(warning);
        if (hint) {
          if (warning.code) {
            seenOptimizationCodes.add(warning.code);
          }
          optimizationHints.push(hint);
        }
      }
      const result = await toolExecutionContext.run({
        call: augmentedCall,
        observer: this.observer ?? undefined
      }, async () => record.definition.handler(args));
      let output = typeof result === 'string' ? result : JSON.stringify(result, null, 2);
      let snapshotCandidate = output;

      // Truncate output if context manager is available
      if (this.contextManager) {
        const truncated = this.contextManager.truncateToolOutput(output, call.name);
        if (truncated.wasTruncated) {
          output = truncated.content;
          // Log truncation for debugging
          if (process.env['DEBUG_CONTEXT']) {
            (0, _debugLogger.logDebug)(`[Context Manager] Truncated ${call.name} output: ${truncated.originalLength} -> ${truncated.truncatedLength} chars`);
          }
        }
        snapshotCandidate = output;
      }
      this.recordDiffSnapshot(args, snapshotCandidate);

      // Cache the result if cacheable
      if (canUseCache) {
        const cacheKey = this.getCacheKey({
          ...call,
          arguments: args
        });
        this.cache.set(cacheKey, {
          result: output,
          timestamp: Date.now()
        });
      }

      // Append optimization hints to guide future LLM behavior
      if (optimizationHints.length > 0) {
        output = output + optimizationHints.join('');
      }
      this.observer?.onToolResult?.(augmentedCall, output);
      this.recordToolHistory({
        toolName: call.name,
        args,
        timestamp: Date.now(),
        success: true,
        hasOutput: hasNonEmptyOutput(output)
      });

      // Record successful execution
      finishToolCall();
      return output;
    } catch (error) {
      let formatted;
      if (error instanceof _schemaValidator.ToolArgumentValidationError) {
        formatted = error.message;
      } else {
        const message = error instanceof Error ? error.message : String(error);
        formatted = `Failed to run "${call.name}": ${message}`;
      }
      this.observer?.onToolError?.(augmentedCall, formatted);
      this.recordToolHistory({
        toolName: call.name,
        args,
        timestamp: Date.now(),
        success: false,
        hasOutput: hasNonEmptyOutput(formatted),
        error: formatted
      });

      // Record failed execution
      return formatted;
    }
  }
  getCacheKey(call) {
    return `${call.name}:${JSON.stringify(call.arguments)}`;
  }
  clearCache() {
    this.cache.clear();
  }
  getCacheStats() {
    let totalSize = 0;
    for (const entry of this.cache.values()) {
      totalSize += entry.result.length;
    }
    return {
      size: totalSize,
      entries: this.cache.size
    };
  }
  clearToolHistory() {
    this.toolHistory.length = 0;
  }
  getToolHistory() {
    return this.toolHistory;
  }
  recordToolHistory(entry) {
    this.toolHistory.push(entry);
    if (this.toolHistory.length > this.maxHistorySize) {
      this.toolHistory.shift();
    }
  }
  clearDiffSnapshots() {
    this.diffSnapshots.length = 0;
  }
  getDiffSnapshots() {
    return this.diffSnapshots;
  }
  addTool(definition, suiteId) {
    if (!definition?.name?.trim()) {
      throw new Error(`Tool names cannot be blank (suite "${suiteId}").`);
    }
    if (this.registry.has(definition.name)) {
      const owner = this.registry.get(definition.name)?.suiteId ?? 'unknown';
      throw new Error(`Tool "${definition.name}" already registered by suite "${owner}".`);
    }
    this.registry.set(definition.name, {
      suiteId,
      definition
    });
    this.registrationOrder.push(definition.name);
  }
  removeFromOrder(name) {
    const index = this.registrationOrder.indexOf(name);
    if (index >= 0) {
      this.registrationOrder.splice(index, 1);
    }
  }
  recordDiffSnapshot(args, output) {
    const command = this.findGitDiffCommand(args);
    if (!command || !output) {
      return;
    }
    this.diffSnapshots.push({
      command,
      output: (0, _resultVerification.safeTruncate)(output, this.maxDiffSnapshotLength, 'git-diff'),
      timestamp: Date.now()
    });
    if (this.snapshotDir && this.io.writeFile) {
      const dir = this.snapshotDir;
      const filename = `diff-${Date.now()}-${Math.abs(hashString(command))}.txt`;
      const fullPath = (0, _nodePath.join)(dir, filename);
      try {
        if (this.io.ensureDir) {
          this.io.ensureDir(dir);
        }
        this.io.writeFile(fullPath, output);
      } catch {
        // best-effort persistence; ignore errors
      }
    }
    if (this.diffSnapshots.length > this.maxDiffSnapshots) {
      this.diffSnapshots.shift();
    }
  }
  findGitDiffCommand(args) {
    for (const command of this.extractCommands(args)) {
      if (this.isGitDiffCommand(command)) {
        return command;
      }
    }
    return null;
  }
  extractCommands(args) {
    const commands = [];
    const command = args['command'];
    if (typeof command === 'string' && command.trim()) {
      commands.push(command.trim());
    }
    const commandList = args['commands'];
    if (Array.isArray(commandList)) {
      for (const value of commandList) {
        if (typeof value === 'string' && value.trim()) {
          commands.push(value.trim());
        }
      }
    }
    return commands;
  }
  isGitDiffCommand(command) {
    return /\bgit\s+(?:--no-pager\s+)?(?:diff|show)\b/i.test(command);
  }
}
exports.ToolRuntime = ToolRuntime;
function createDefaultToolRuntime(context, toolSuites = [], options = {}) {
  // Start with no default introspection tools - they waste tokens
  // Model knows its capabilities from tool definitions
  const runtime = new ToolRuntime([], options);
  for (const suite of toolSuites) {
    runtime.registerSuite(suite);
  }
  return runtime;
}

// Removed unused introspection tools (context_snapshot, capabilities_overview, profile_details)
// Model already knows capabilities from tool definitions; these just wasted tokens

function hasNonEmptyOutput(output) {
  return typeof output === 'string' && output.trim().length > 0;
}
function normalizeToolArguments(value) {
  if (value instanceof Map) {
    return Object.fromEntries(value.entries());
  }
  if (isRecord(value)) {
    return value;
  }
  if (typeof value === 'string') {
    const trimmed = value.trim();
    if (!trimmed) {
      return {};
    }
    try {
      const parsed = JSON.parse(trimmed);
      return isRecord(parsed) ? parsed : {};
    } catch {
      return {};
    }
  }
  return {};
}
function isRecord(value) {
  return typeof value === 'object' && value !== null && !Array.isArray(value);
}
function hashString(value) {
  let hash = 0;
  for (let i = 0; i < value.length; i++) {
    hash = (hash << 5) - hash + value.charCodeAt(i);
    hash |= 0;
  }
  return hash;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbm9kZUFzeW5jX2hvb2tzIiwicmVxdWlyZSIsIl9ub2RlUGF0aCIsIl9zY2hlbWFWYWxpZGF0b3IiLCJfdG9vbFByZWNvbmRpdGlvbnMiLCJfcmVzdWx0VmVyaWZpY2F0aW9uIiwiX2RlYnVnTG9nZ2VyIiwiX3Rvb2xFeGVjdXRpb25JTyIsInRvb2xFeGVjdXRpb25Db250ZXh0IiwiQXN5bmNMb2NhbFN0b3JhZ2UiLCJyZXBvcnRUb29sUHJvZ3Jlc3MiLCJwcm9ncmVzcyIsImNvbnRleHQiLCJnZXRTdG9yZSIsIm9ic2VydmVyIiwib25Ub29sUHJvZ3Jlc3MiLCJjdXJyZW50IiwiTnVtYmVyIiwiaXNGaW5pdGUiLCJNYXRoIiwibWF4IiwidG90YWwiLCJ1bmRlZmluZWQiLCJjYWxsIiwibWVzc2FnZSIsIkNBQ0hFQUJMRV9UT09MUyIsIlNldCIsImJ1aWxkT3B0aW1pemF0aW9uSGludCIsIndhcm5pbmciLCJjb2RlIiwic3VnZ2VzdGlvbiIsIkVESVRfV0lUSE9VVF9SRUFEIiwiVG9vbFJ1bnRpbWVVdGlscyIsImV4cG9ydHMiLCJfVG9vbFJ1bnRpbWVVdGlscyIsImNyZWF0ZVRvb2xEZWZpbml0aW9uIiwiZGVmaW5pdGlvbiIsImNyZWF0ZVRvb2xTdWl0ZSIsInN1aXRlIiwiaXNUb29sRGVmaW5pdGlvbiIsIl9fdG9vbCIsImV4cGVjdGVkU2NoZW1hIiwiVG9vbFJ1bnRpbWUiLCJyZWdpc3RyeSIsIk1hcCIsInJlZ2lzdHJhdGlvbk9yZGVyIiwiY2FjaGUiLCJ0b29sSGlzdG9yeSIsIm1heEhpc3RvcnlTaXplIiwiZGlmZlNuYXBzaG90cyIsIm1heERpZmZTbmFwc2hvdHMiLCJtYXhEaWZmU25hcHNob3RMZW5ndGgiLCJjb25zdHJ1Y3RvciIsImJhc2VUb29scyIsIm9wdGlvbnMiLCJpbyIsImRlZmF1bHRUb29sSU8iLCJjb250ZXh0TWFuYWdlciIsInNuYXBzaG90RGlyIiwiam9pbiIsInByb2Nlc3MiLCJjd2QiLCJlbmFibGVDYWNoZSIsImNhY2hlVFRMTXMiLCJsZW5ndGgiLCJyZWdpc3RlclN1aXRlIiwiaWQiLCJkZXNjcmlwdGlvbiIsInRvb2xzIiwidHJpbSIsIkVycm9yIiwidW5yZWdpc3RlclN1aXRlIiwiYWRkVG9vbCIsIm5hbWUiLCJyZWNvcmQiLCJlbnRyaWVzIiwic3VpdGVJZCIsImRlbGV0ZSIsInJlbW92ZUZyb21PcmRlciIsImxpc3RQcm92aWRlclRvb2xzIiwibWFwIiwiZ2V0IiwiZmlsdGVyIiwiQm9vbGVhbiIsInBhcmFtZXRlcnMiLCJleGVjdXRlIiwiX2NvbnRleHQiLCJyYXdBcmdzIiwibm9ybWFsaXplVG9vbEFyZ3VtZW50cyIsImFyZ3VtZW50cyIsImFyZ3MiLCJjb2VyY2VUb29sQXJndW1lbnRzIiwiYXVnbWVudGVkQ2FsbCIsIm9uVG9vbEVycm9yIiwiaXNDYWNoZWFibGUiLCJjYWNoZWFibGUiLCJoYXMiLCJjYWNoZVR0bCIsImNhY2hlVHRsTXMiLCJmbG9vciIsImNhblVzZUNhY2hlIiwiY2FjaGVLZXkiLCJnZXRDYWNoZUtleSIsImNhY2hlZCIsIkRhdGUiLCJub3ciLCJ0aW1lc3RhbXAiLCJvbkNhY2hlSGl0Iiwib25Ub29sUmVzdWx0IiwicmVzdWx0IiwicmVjb3JkVG9vbEhpc3RvcnkiLCJ0b29sTmFtZSIsInN1Y2Nlc3MiLCJoYXNPdXRwdXQiLCJoYXNOb25FbXB0eU91dHB1dCIsIm9uVG9vbFN0YXJ0Iiwic3RhcnRUaW1lIiwiZmluaXNoVG9vbENhbGwiLCJkdXJhdGlvbiIsImVudiIsImxvZ0RlYnVnIiwidmFsaWRhdGVUb29sQXJndW1lbnRzIiwicHJlZmxpZ2h0V2FybmluZ3MiLCJ2YWxpZGF0ZVRvb2xQcmVjb25kaXRpb25zIiwib25Ub29sV2FybmluZyIsImFpRmxvd1dhcm5pbmdzIiwidmFsaWRhdGVBSUZsb3dQYXR0ZXJucyIsIm9wdGltaXphdGlvbkhpbnRzIiwic2Vlbk9wdGltaXphdGlvbkNvZGVzIiwiaGludCIsImFkZCIsInB1c2giLCJydW4iLCJoYW5kbGVyIiwib3V0cHV0IiwiSlNPTiIsInN0cmluZ2lmeSIsInNuYXBzaG90Q2FuZGlkYXRlIiwidHJ1bmNhdGVkIiwidHJ1bmNhdGVUb29sT3V0cHV0Iiwid2FzVHJ1bmNhdGVkIiwiY29udGVudCIsIm9yaWdpbmFsTGVuZ3RoIiwidHJ1bmNhdGVkTGVuZ3RoIiwicmVjb3JkRGlmZlNuYXBzaG90Iiwic2V0IiwiZXJyb3IiLCJmb3JtYXR0ZWQiLCJUb29sQXJndW1lbnRWYWxpZGF0aW9uRXJyb3IiLCJTdHJpbmciLCJjbGVhckNhY2hlIiwiY2xlYXIiLCJnZXRDYWNoZVN0YXRzIiwidG90YWxTaXplIiwiZW50cnkiLCJ2YWx1ZXMiLCJzaXplIiwiY2xlYXJUb29sSGlzdG9yeSIsImdldFRvb2xIaXN0b3J5Iiwic2hpZnQiLCJjbGVhckRpZmZTbmFwc2hvdHMiLCJnZXREaWZmU25hcHNob3RzIiwib3duZXIiLCJpbmRleCIsImluZGV4T2YiLCJzcGxpY2UiLCJjb21tYW5kIiwiZmluZEdpdERpZmZDb21tYW5kIiwic2FmZVRydW5jYXRlIiwid3JpdGVGaWxlIiwiZGlyIiwiZmlsZW5hbWUiLCJhYnMiLCJoYXNoU3RyaW5nIiwiZnVsbFBhdGgiLCJlbnN1cmVEaXIiLCJleHRyYWN0Q29tbWFuZHMiLCJpc0dpdERpZmZDb21tYW5kIiwiY29tbWFuZHMiLCJjb21tYW5kTGlzdCIsIkFycmF5IiwiaXNBcnJheSIsInZhbHVlIiwidGVzdCIsImNyZWF0ZURlZmF1bHRUb29sUnVudGltZSIsInRvb2xTdWl0ZXMiLCJydW50aW1lIiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJpc1JlY29yZCIsInRyaW1tZWQiLCJwYXJzZWQiLCJwYXJzZSIsImhhc2giLCJpIiwiY2hhckNvZGVBdCJdLCJzb3VyY2VzIjpbInRvb2xSdW50aW1lLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby1uYW1lc3BhY2UgKi9cbmltcG9ydCB7IEFzeW5jTG9jYWxTdG9yYWdlIH0gZnJvbSAnbm9kZTphc3luY19ob29rcyc7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAnbm9kZTpwYXRoJztcbmltcG9ydCB7IHR5cGUgUHJvdmlkZXJUb29sRGVmaW5pdGlvbiwgdHlwZSBUb29sQ2FsbFJlcXVlc3QsIHR5cGUgSlNPTlNjaGVtYU9iamVjdCB9IGZyb20gJy4vdHlwZXMuanMnO1xuaW1wb3J0IHsgVG9vbEFyZ3VtZW50VmFsaWRhdGlvbkVycm9yLCBjb2VyY2VUb29sQXJndW1lbnRzLCB2YWxpZGF0ZVRvb2xBcmd1bWVudHMgfSBmcm9tICcuL3NjaGVtYVZhbGlkYXRvci5qcyc7XG5pbXBvcnQgeyBDb250ZXh0TWFuYWdlciB9IGZyb20gJy4vY29udGV4dE1hbmFnZXIuanMnO1xuaW1wb3J0IHsgdmFsaWRhdGVUb29sUHJlY29uZGl0aW9ucywgdmFsaWRhdGVBSUZsb3dQYXR0ZXJucywgRURJVF9XSVRIT1VUX1JFQUQsIHR5cGUgUHJlZmxpZ2h0V2FybmluZyB9IGZyb20gJy4vdG9vbFByZWNvbmRpdGlvbnMuanMnO1xuaW1wb3J0IHsgc2FmZVRydW5jYXRlIH0gZnJvbSAnLi9yZXN1bHRWZXJpZmljYXRpb24uanMnO1xuaW1wb3J0IHsgbG9nRGVidWcgfSBmcm9tICcuLi91dGlscy9kZWJ1Z0xvZ2dlci5qcyc7XG5pbXBvcnQge1xuICB0eXBlIFRvb2xEZWZpbml0aW9uLFxuICB0eXBlIFRvb2xTdWl0ZSxcbiAgdHlwZSBUb29sSGFuZGxlcixcbiAgdHlwZSBUb29sRXhlY3V0aW9uQ29udGV4dCxcbiAgdHlwZSBUb29sUnVudGltZU9ic2VydmVyLFxuICB0eXBlIFRvb2xSdW50aW1lT3B0aW9ucyxcbiAgdHlwZSBUb29sRXhlY3V0aW9uU3RvcmUsXG4gIHR5cGUgQ2FjaGVFbnRyeSxcbiAgdHlwZSBUb29sSGlzdG9yeUVudHJ5LFxuICB0eXBlIERpZmZTbmFwc2hvdFJlY29yZCxcbiAgdHlwZSBUb29sUHJvZ3Jlc3NVcGRhdGUsXG4gIHR5cGUgVG9vbEV4ZWN1dGlvbklPLFxufSBmcm9tICcuL3Rvb2xSdW50aW1lVHlwZXMuanMnO1xuaW1wb3J0IHsgZGVmYXVsdFRvb2xJTyB9IGZyb20gJy4vdG9vbEV4ZWN1dGlvbklPLmpzJztcbmV4cG9ydCB0eXBlIHtcbiAgVG9vbERlZmluaXRpb24sXG4gIFRvb2xTdWl0ZSxcbiAgVG9vbEhhbmRsZXIsXG4gIFRvb2xFeGVjdXRpb25Db250ZXh0LFxuICBUb29sUnVudGltZU9ic2VydmVyLFxuICBUb29sUnVudGltZU9wdGlvbnMsXG4gIFRvb2xFeGVjdXRpb25TdG9yZSxcbiAgQ2FjaGVFbnRyeSxcbiAgVG9vbEhpc3RvcnlFbnRyeSxcbiAgRGlmZlNuYXBzaG90UmVjb3JkLFxuICBUb29sUHJvZ3Jlc3NVcGRhdGUsXG4gIFRvb2xFeGVjdXRpb25JTyxcbn0gZnJvbSAnLi90b29sUnVudGltZVR5cGVzLmpzJztcblxuaW50ZXJmYWNlIFRvb2xSZWNvcmQge1xuICBzdWl0ZUlkOiBzdHJpbmc7XG4gIGRlZmluaXRpb246IFRvb2xEZWZpbml0aW9uO1xufVxuXG5jb25zdCB0b29sRXhlY3V0aW9uQ29udGV4dCA9IG5ldyBBc3luY0xvY2FsU3RvcmFnZTxUb29sRXhlY3V0aW9uU3RvcmU+KCk7XG5cbi8qKlxuICogUmVwb3J0IGluY3JlbWVudGFsIHByb2dyZXNzIGZvciB0aGUgY3VycmVudGx5IGV4ZWN1dGluZyB0b29sLlxuICogVG9vbHMgY2FuIGNhbGwgdGhpcyB0byBzdXJmYWNlIGxpdmUgc3RhdHVzIHVwZGF0ZXMgKGUuZy4sIGluZGV4aW5nIGZpbGVzKS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlcG9ydFRvb2xQcm9ncmVzcyhwcm9ncmVzczogVG9vbFByb2dyZXNzVXBkYXRlKTogdm9pZCB7XG4gIGNvbnN0IGNvbnRleHQgPSB0b29sRXhlY3V0aW9uQ29udGV4dC5nZXRTdG9yZSgpO1xuICBpZiAoIWNvbnRleHQ/Lm9ic2VydmVyPy5vblRvb2xQcm9ncmVzcykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGN1cnJlbnQgPSBOdW1iZXIuaXNGaW5pdGUocHJvZ3Jlc3MuY3VycmVudCkgPyBNYXRoLm1heCgwLCBwcm9ncmVzcy5jdXJyZW50KSA6IDA7XG4gIGNvbnN0IHRvdGFsID0gcHJvZ3Jlc3MudG90YWwgIT09IHVuZGVmaW5lZCA/IE1hdGgubWF4KGN1cnJlbnQsIHByb2dyZXNzLnRvdGFsKSA6IGN1cnJlbnQ7XG5cbiAgdHJ5IHtcbiAgICBjb250ZXh0Lm9ic2VydmVyLm9uVG9vbFByb2dyZXNzKGNvbnRleHQuY2FsbCwge1xuICAgICAgY3VycmVudCxcbiAgICAgIHRvdGFsLFxuICAgICAgbWVzc2FnZTogcHJvZ3Jlc3MubWVzc2FnZSxcbiAgICB9KTtcbiAgfSBjYXRjaCB7XG4gICAgLy8gU3dhbGxvdyBvYnNlcnZlciBlcnJvcnMgc28gdGhleSBkb24ndCBicmVhayB0b29sIGV4ZWN1dGlvblxuICB9XG59XG5cbi8vIElkZW1wb3RlbnQgdG9vbHMgdGhhdCBjYW4gYmUgc2FmZWx5IGNhY2hlZFxuY29uc3QgQ0FDSEVBQkxFX1RPT0xTID0gbmV3IFNldChbXG4gICdSZWFkJyxcbiAgJ3JlYWRfZmlsZScsXG4gICdHbG9iJyxcbiAgJ2dsb2Jfc2VhcmNoJyxcbiAgJ0dyZXAnLFxuICAnZ3JlcF9zZWFyY2gnLFxuICAnZmluZF9kZWZpbml0aW9uJyxcbiAgJ2FuYWx5emVfY29kZV9xdWFsaXR5JyxcbiAgJ2V4dHJhY3RfZXhwb3J0cycsXG5dKTtcblxuZnVuY3Rpb24gYnVpbGRPcHRpbWl6YXRpb25IaW50KFxuICB3YXJuaW5nOiBQcmVmbGlnaHRXYXJuaW5nIHwgeyBjb2RlPzogc3RyaW5nOyBzdWdnZXN0aW9uPzogc3RyaW5nOyBtZXNzYWdlOiBzdHJpbmcgfVxuKTogc3RyaW5nIHwgbnVsbCB7XG4gIGNvbnN0IGNvZGUgPSB3YXJuaW5nLmNvZGU7XG4gIGNvbnN0IHN1Z2dlc3Rpb24gPSB3YXJuaW5nLnN1Z2dlc3Rpb24gfHwgd2FybmluZy5tZXNzYWdlO1xuXG4gIHN3aXRjaCAoY29kZSkge1xuICAgIGNhc2UgJ1NFQVJDSF9CUk9BRF9QQVRURVJOJzpcbiAgICBjYXNlICdTRUFSQ0hfQ09OVEVYVF9PVkVSRkxPV19SSVNLJzpcbiAgICAgIHJldHVybiAoXG4gICAgICAgIGBcXG5cXG48b3B0aW1pemF0aW9uLWhpbnQ+XFxuYCArXG4gICAgICAgIGDimqEgU0VBUkNIOiAke3N1Z2dlc3Rpb259XFxuYCArXG4gICAgICAgIGA8L29wdGltaXphdGlvbi1oaW50PmBcbiAgICAgICk7XG4gICAgY2FzZSBFRElUX1dJVEhPVVRfUkVBRDpcbiAgICBjYXNlICdFRElUX1BMQUNFSE9MREVSJzpcbiAgICAgIHJldHVybiAoXG4gICAgICAgIGBcXG5cXG48b3B0aW1pemF0aW9uLWhpbnQ+XFxuYCArXG4gICAgICAgIGDimqEgRURJVDogUmVhZCB0aGUgZmlsZSBmaXJzdCB0byBjb3B5IGV4YWN0IHdoaXRlc3BhY2UuICR7c3VnZ2VzdGlvbn1cXG5gICtcbiAgICAgICAgYDwvb3B0aW1pemF0aW9uLWhpbnQ+YFxuICAgICAgKTtcbiAgICBjYXNlICdOUE1fSU5DT01QTEVURV9XT1JLRkxPVyc6XG4gICAgICByZXR1cm4gKFxuICAgICAgICBgXFxuXFxuPG9wdGltaXphdGlvbi1oaW50PlxcbmAgK1xuICAgICAgICBg4pqhIFBVQkxJU0g6ICR7c3VnZ2VzdGlvbn1cXG5gICtcbiAgICAgICAgYDwvb3B0aW1pemF0aW9uLWhpbnQ+YFxuICAgICAgKTtcbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuLyoqXG4gKiBUeXBlLXNhZmUgdXRpbGl0eSBmdW5jdGlvbnMgZm9yIHRvb2wgcnVudGltZSBvcGVyYXRpb25zXG4gKi9cbmV4cG9ydCBuYW1lc3BhY2UgVG9vbFJ1bnRpbWVVdGlscyB7XG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgdHlwZS1zYWZlIHRvb2wgZGVmaW5pdGlvbiB3aXRoIGluZmVycmVkIHBhcmFtZXRlciB0eXBlc1xuICAgKi9cbiAgZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVRvb2xEZWZpbml0aW9uPFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4oXG4gICAgZGVmaW5pdGlvbjogVG9vbERlZmluaXRpb248VD5cbiAgKTogVG9vbERlZmluaXRpb248VD4ge1xuICAgIHJldHVybiBkZWZpbml0aW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSB0eXBlLXNhZmUgdG9vbCBzdWl0ZSB3aXRoIGluZmVycmVkIHRvb2wgdHlwZXNcbiAgICovXG4gIGV4cG9ydCBmdW5jdGlvbiBjcmVhdGVUb29sU3VpdGUoXG4gICAgc3VpdGU6IFRvb2xTdWl0ZVxuICApOiBUb29sU3VpdGUge1xuICAgIHJldHVybiBzdWl0ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUeXBlIGd1YXJkIHRvIGNoZWNrIGlmIGEgdG9vbCBkZWZpbml0aW9uIG1hdGNoZXMgZXhwZWN0ZWQgcGFyYW1ldGVyIHNjaGVtYVxuICAgKi9cbiAgZXhwb3J0IGZ1bmN0aW9uIGlzVG9vbERlZmluaXRpb24oXG4gICAgX190b29sOiBUb29sRGVmaW5pdGlvbixcbiAgICBleHBlY3RlZFNjaGVtYT86IEpTT05TY2hlbWFPYmplY3RcbiAgKTogYm9vbGVhbiB7XG4gICAgaWYgKCFleHBlY3RlZFNjaGVtYSkgcmV0dXJuIHRydWU7XG4gICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIHZhbGlkYXRlIGFnYWluc3QgdGhlIHNjaGVtYVxuICAgIHJldHVybiB0cnVlO1xuICB9XG59XG5cbi8qKlxuICogSW50ZXJmYWNlIGRlc2NyaWJpbmcgdGhlIHB1YmxpYyBBUEkgb2YgVG9vbFJ1bnRpbWUuXG4gKiBVc2VkIGJ5IHdyYXBwZXIgaW1wbGVtZW50YXRpb25zIGxpa2UgUmVzdHJpY3RlZFRvb2xSdW50aW1lLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIElUb29sUnVudGltZSB7XG4gIGxpc3RQcm92aWRlclRvb2xzKCk6IFByb3ZpZGVyVG9vbERlZmluaXRpb25bXTtcbiAgZXhlY3V0ZShjYWxsOiBUb29sQ2FsbFJlcXVlc3QsIGNvbnRleHQ/OiB7IHByb2ZpbGVOYW1lPzogc3RyaW5nOyBwcm92aWRlcj86IHN0cmluZzsgbW9kZWw/OiBzdHJpbmcgfSk6IFByb21pc2U8c3RyaW5nPjtcbiAgcmVnaXN0ZXJTdWl0ZShzdWl0ZTogVG9vbFN1aXRlKTogdm9pZDtcbiAgdW5yZWdpc3RlclN1aXRlKGlkOiBzdHJpbmcpOiB2b2lkO1xuICBjbGVhckNhY2hlKCk6IHZvaWQ7XG4gIGdldENhY2hlU3RhdHMoKTogeyBzaXplOiBudW1iZXI7IGVudHJpZXM6IG51bWJlciB9O1xuICBjbGVhclRvb2xIaXN0b3J5KCk6IHZvaWQ7XG4gIGdldFRvb2xIaXN0b3J5KCk6IHJlYWRvbmx5IFRvb2xIaXN0b3J5RW50cnlbXTtcbiAgY2xlYXJEaWZmU25hcHNob3RzKCk6IHZvaWQ7XG4gIGdldERpZmZTbmFwc2hvdHMoKTogcmVhZG9ubHkgRGlmZlNuYXBzaG90UmVjb3JkW107XG59XG5cbmV4cG9ydCBjbGFzcyBUb29sUnVudGltZSBpbXBsZW1lbnRzIElUb29sUnVudGltZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgcmVnaXN0cnkgPSBuZXcgTWFwPHN0cmluZywgVG9vbFJlY29yZD4oKTtcbiAgcHJpdmF0ZSByZWFkb25seSByZWdpc3RyYXRpb25PcmRlcjogc3RyaW5nW10gPSBbXTtcbiAgcHJpdmF0ZSByZWFkb25seSBvYnNlcnZlcjogVG9vbFJ1bnRpbWVPYnNlcnZlciB8IG51bGw7XG4gIHByaXZhdGUgcmVhZG9ubHkgY29udGV4dE1hbmFnZXI6IENvbnRleHRNYW5hZ2VyIHwgbnVsbDtcbiAgcHJpdmF0ZSByZWFkb25seSBpbzogVG9vbEV4ZWN1dGlvbklPO1xuICBwcml2YXRlIHJlYWRvbmx5IHNuYXBzaG90RGlyOiBzdHJpbmcgfCBudWxsO1xuICBwcml2YXRlIHJlYWRvbmx5IGNhY2hlID0gbmV3IE1hcDxzdHJpbmcsIENhY2hlRW50cnk+KCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgZW5hYmxlQ2FjaGU6IGJvb2xlYW47XG4gIHByaXZhdGUgcmVhZG9ubHkgY2FjaGVUVExNczogbnVtYmVyO1xuICBwcml2YXRlIHJlYWRvbmx5IHRvb2xIaXN0b3J5OiBUb29sSGlzdG9yeUVudHJ5W10gPSBbXTtcbiAgcHJpdmF0ZSByZWFkb25seSBtYXhIaXN0b3J5U2l6ZSA9IDUwOyAvLyBLZWVwIGxhc3QgNTAgdG9vbCBjYWxscyBmb3IgQUkgZmxvdyBwYXR0ZXJuIGRldGVjdGlvblxuICBwcml2YXRlIHJlYWRvbmx5IGRpZmZTbmFwc2hvdHM6IERpZmZTbmFwc2hvdFJlY29yZFtdID0gW107XG4gIHByaXZhdGUgcmVhZG9ubHkgbWF4RGlmZlNuYXBzaG90cyA9IDU7IC8vIEtlZXAgb25seSB0aGUgbW9zdCByZWNlbnQgZ2l0IGRpZmYgb3V0cHV0c1xuICBwcml2YXRlIHJlYWRvbmx5IG1heERpZmZTbmFwc2hvdExlbmd0aCA9IDQwMDA7XG5cbiAgY29uc3RydWN0b3IoYmFzZVRvb2xzOiBUb29sRGVmaW5pdGlvbltdID0gW10sIG9wdGlvbnM6IFRvb2xSdW50aW1lT3B0aW9ucyA9IHt9LCBpbzogVG9vbEV4ZWN1dGlvbklPID0gZGVmYXVsdFRvb2xJTykge1xuICAgIHRoaXMub2JzZXJ2ZXIgPSBvcHRpb25zLm9ic2VydmVyID8/IG51bGw7XG4gICAgdGhpcy5jb250ZXh0TWFuYWdlciA9IG9wdGlvbnMuY29udGV4dE1hbmFnZXIgPz8gbnVsbDtcbiAgICB0aGlzLmlvID0gb3B0aW9ucy5pbyA/PyBpbztcbiAgICB0aGlzLnNuYXBzaG90RGlyID0gb3B0aW9ucy5zbmFwc2hvdERpciA/PyBqb2luKHByb2Nlc3MuY3dkKCksICcuYWdpJywgJ3Rvb2wtc25hcHNob3RzJyk7XG4gICAgdGhpcy5lbmFibGVDYWNoZSA9IG9wdGlvbnMuZW5hYmxlQ2FjaGUgPz8gdHJ1ZTtcbiAgICB0aGlzLmNhY2hlVFRMTXMgPSBvcHRpb25zLmNhY2hlVFRMTXMgPz8gNSAqIDYwICogMTAwMDsgLy8gNSBtaW51dGVzIGRlZmF1bHRcbiAgICBpZiAoYmFzZVRvb2xzLmxlbmd0aCkge1xuICAgICAgdGhpcy5yZWdpc3RlclN1aXRlKHtcbiAgICAgICAgaWQ6ICdydW50aW1lLmNvcmUnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0NvcmUgcnVudGltZSBtZXRhZGF0YSB0b29scycsXG4gICAgICAgIHRvb2xzOiBiYXNlVG9vbHMsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICByZWdpc3RlclN1aXRlKHN1aXRlOiBUb29sU3VpdGUpOiB2b2lkIHtcbiAgICBpZiAoIXN1aXRlPy5pZD8udHJpbSgpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Rvb2wgc3VpdGUgaWQgY2Fubm90IGJlIGJsYW5rLicpO1xuICAgIH1cbiAgICB0aGlzLnVucmVnaXN0ZXJTdWl0ZShzdWl0ZS5pZCk7XG4gICAgZm9yIChjb25zdCBkZWZpbml0aW9uIG9mIHN1aXRlLnRvb2xzID8/IFtdKSB7XG4gICAgICB0aGlzLmFkZFRvb2woZGVmaW5pdGlvbiwgc3VpdGUuaWQpO1xuICAgIH1cbiAgfVxuXG4gIHVucmVnaXN0ZXJTdWl0ZShpZDogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKCFpZD8udHJpbSgpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGZvciAoY29uc3QgW25hbWUsIHJlY29yZF0gb2YgdGhpcy5yZWdpc3RyeS5lbnRyaWVzKCkpIHtcbiAgICAgIGlmIChyZWNvcmQuc3VpdGVJZCA9PT0gaWQpIHtcbiAgICAgICAgdGhpcy5yZWdpc3RyeS5kZWxldGUobmFtZSk7XG4gICAgICAgIHRoaXMucmVtb3ZlRnJvbU9yZGVyKG5hbWUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGxpc3RQcm92aWRlclRvb2xzKCk6IFByb3ZpZGVyVG9vbERlZmluaXRpb25bXSB7XG4gICAgcmV0dXJuIHRoaXMucmVnaXN0cmF0aW9uT3JkZXJcbiAgICAgIC5tYXAoKG5hbWUpID0+IHRoaXMucmVnaXN0cnkuZ2V0KG5hbWUpKVxuICAgICAgLmZpbHRlcigocmVjb3JkKTogcmVjb3JkIGlzIFRvb2xSZWNvcmQgPT4gQm9vbGVhbihyZWNvcmQpKVxuICAgICAgLm1hcCgoeyBkZWZpbml0aW9uIH0pID0+ICh7XG4gICAgICAgIG5hbWU6IGRlZmluaXRpb24ubmFtZSxcbiAgICAgICAgZGVzY3JpcHRpb246IGRlZmluaXRpb24uZGVzY3JpcHRpb24sXG4gICAgICAgIC4uLihkZWZpbml0aW9uLnBhcmFtZXRlcnMgJiYgeyBwYXJhbWV0ZXJzOiBkZWZpbml0aW9uLnBhcmFtZXRlcnMgfSksXG4gICAgICB9KSk7XG4gIH1cblxuICBhc3luYyBleGVjdXRlKGNhbGw6IFRvb2xDYWxsUmVxdWVzdCwgX2NvbnRleHQ/OiB7IHByb2ZpbGVOYW1lPzogc3RyaW5nOyBwcm92aWRlcj86IHN0cmluZzsgbW9kZWw/OiBzdHJpbmcgfSk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3QgcmVjb3JkID0gdGhpcy5yZWdpc3RyeS5nZXQoY2FsbC5uYW1lKTtcbiAgICBjb25zdCByYXdBcmdzID0gbm9ybWFsaXplVG9vbEFyZ3VtZW50cyhjYWxsLmFyZ3VtZW50cyk7XG4gICAgY29uc3QgYXJncyA9IGNvZXJjZVRvb2xBcmd1bWVudHMocmVjb3JkPy5kZWZpbml0aW9uLnBhcmFtZXRlcnMsIHJhd0FyZ3MpO1xuICAgIGNvbnN0IGF1Z21lbnRlZENhbGwgPSB7IC4uLmNhbGwsIGFyZ3MgfTtcblxuICAgIGlmICghcmVjb3JkKSB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gYFRvb2wgXCIke2NhbGwubmFtZX1cIiBpcyBub3QgYXZhaWxhYmxlLmA7XG4gICAgICB0aGlzLm9ic2VydmVyPy5vblRvb2xFcnJvcj8uKGF1Z21lbnRlZENhbGwsIG1lc3NhZ2UpO1xuICAgICAgcmV0dXJuIG1lc3NhZ2U7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgdG9vbCBpcyBjYWNoZWFibGVcbiAgICBjb25zdCBpc0NhY2hlYWJsZSA9IHJlY29yZC5kZWZpbml0aW9uLmNhY2hlYWJsZSA/PyBDQUNIRUFCTEVfVE9PTFMuaGFzKGNhbGwubmFtZSk7XG4gICAgY29uc3QgY2FjaGVUdGwgPVxuICAgICAgdHlwZW9mIHJlY29yZC5kZWZpbml0aW9uLmNhY2hlVHRsTXMgPT09ICdudW1iZXInICYmIE51bWJlci5pc0Zpbml0ZShyZWNvcmQuZGVmaW5pdGlvbi5jYWNoZVR0bE1zKVxuICAgICAgICA/IE1hdGgubWF4KDAsIE1hdGguZmxvb3IocmVjb3JkLmRlZmluaXRpb24uY2FjaGVUdGxNcykpXG4gICAgICAgIDogdGhpcy5jYWNoZVRUTE1zO1xuICAgIGNvbnN0IGNhblVzZUNhY2hlID0gdGhpcy5lbmFibGVDYWNoZSAmJiBpc0NhY2hlYWJsZSAmJiBjYWNoZVR0bCA+IDA7XG5cbiAgICAvLyBUcnkgdG8gZ2V0IGZyb20gY2FjaGVcbiAgICBpZiAoY2FuVXNlQ2FjaGUpIHtcbiAgICAgIGNvbnN0IGNhY2hlS2V5ID0gdGhpcy5nZXRDYWNoZUtleSh7IC4uLmNhbGwsIGFyZ3VtZW50czogYXJncyB9KTtcbiAgICAgIGNvbnN0IGNhY2hlZCA9IHRoaXMuY2FjaGUuZ2V0KGNhY2hlS2V5KTtcblxuICAgICAgaWYgKGNhY2hlZCAmJiBEYXRlLm5vdygpIC0gY2FjaGVkLnRpbWVzdGFtcCA8IGNhY2hlVHRsKSB7XG4gICAgICAgIHRoaXMub2JzZXJ2ZXI/Lm9uQ2FjaGVIaXQ/LihhdWdtZW50ZWRDYWxsKTtcbiAgICAgICAgdGhpcy5vYnNlcnZlcj8ub25Ub29sUmVzdWx0Py4oYXVnbWVudGVkQ2FsbCwgY2FjaGVkLnJlc3VsdCk7XG5cbiAgICAgICAgLy8gUmVjb3JkIGNhY2hlIGhpdCBhcyBzdWNjZXNzZnVsIGV4ZWN1dGlvbiB3aXRoIDBtcyB0aW1lXG4gICAgICAgIHRoaXMucmVjb3JkVG9vbEhpc3Rvcnkoe1xuICAgICAgICAgIHRvb2xOYW1lOiBjYWxsLm5hbWUsXG4gICAgICAgICAgYXJncyxcbiAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgICBoYXNPdXRwdXQ6IGhhc05vbkVtcHR5T3V0cHV0KGNhY2hlZC5yZXN1bHQpLFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGNhY2hlZC5yZXN1bHQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5vYnNlcnZlcj8ub25Ub29sU3RhcnQ/LihhdWdtZW50ZWRDYWxsKTtcblxuICAgIC8vIFN0YXJ0IHBlcmZvcm1hbmNlIG1vbml0b3JpbmdcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IGZpbmlzaFRvb2xDYWxsID0gKCkgPT4ge1xuICAgICAgY29uc3QgZHVyYXRpb24gPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgaWYgKGR1cmF0aW9uID4gMTAwMCkge1xuICAgICAgICAvLyBMb2cgbG9uZy1ydW5uaW5nIHRvb2xzIGZvciBkZWJ1Z2dpbmdcbiAgICAgICAgaWYgKHByb2Nlc3MuZW52WydERUJVR19UT09MX1BFUkYnXSkge1xuICAgICAgICAgIGxvZ0RlYnVnKGBbVG9vbCBSdW50aW1lXSAke2NhbGwubmFtZX0gdG9vayAke2R1cmF0aW9ufW1zYCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdHJ5IHtcbiAgICAgIHZhbGlkYXRlVG9vbEFyZ3VtZW50cyhyZWNvcmQuZGVmaW5pdGlvbi5uYW1lLCByZWNvcmQuZGVmaW5pdGlvbi5wYXJhbWV0ZXJzLCBhcmdzKTtcblxuICAgICAgLy8gUHJlLWZsaWdodCBBSSBmbG93IHZhbGlkYXRpb24gLSBjYXRjaCBjb21tb24gdG9vbCB1c2FnZSBmYWlsdXJlc1xuICAgICAgY29uc3QgcHJlZmxpZ2h0V2FybmluZ3MgPSB2YWxpZGF0ZVRvb2xQcmVjb25kaXRpb25zKGNhbGwubmFtZSwgYXJncyk7XG4gICAgICBmb3IgKGNvbnN0IHdhcm5pbmcgb2YgcHJlZmxpZ2h0V2FybmluZ3MpIHtcbiAgICAgICAgdGhpcy5vYnNlcnZlcj8ub25Ub29sV2FybmluZz8uKGF1Z21lbnRlZENhbGwsIHdhcm5pbmcpO1xuICAgICAgfVxuXG4gICAgICAvLyBBZHZhbmNlZCBBSSBmbG93IHBhdHRlcm4gdmFsaWRhdGlvbiB1c2luZyB0b29sIGhpc3RvcnlcbiAgICAgIGNvbnN0IGFpRmxvd1dhcm5pbmdzID0gdmFsaWRhdGVBSUZsb3dQYXR0ZXJucyhjYWxsLm5hbWUsIGFyZ3MsIHRoaXMudG9vbEhpc3RvcnkpO1xuICAgICAgZm9yIChjb25zdCB3YXJuaW5nIG9mIGFpRmxvd1dhcm5pbmdzKSB7XG4gICAgICAgIHRoaXMub2JzZXJ2ZXI/Lm9uVG9vbFdhcm5pbmc/LihhdWdtZW50ZWRDYWxsLCB3YXJuaW5nKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ29sbGVjdCBvcHRpbWl6YXRpb24gaGludHMgdG8gaW5qZWN0IGludG8gcmVzdWx0XG4gICAgICBjb25zdCBvcHRpbWl6YXRpb25IaW50czogc3RyaW5nW10gPSBbXTtcbiAgICAgIGNvbnN0IHNlZW5PcHRpbWl6YXRpb25Db2RlcyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuICAgICAgZm9yIChjb25zdCB3YXJuaW5nIG9mIFsuLi5wcmVmbGlnaHRXYXJuaW5ncywgLi4uYWlGbG93V2FybmluZ3NdKSB7XG4gICAgICAgIGlmICh3YXJuaW5nLmNvZGUgJiYgc2Vlbk9wdGltaXphdGlvbkNvZGVzLmhhcyh3YXJuaW5nLmNvZGUpKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaGludCA9IGJ1aWxkT3B0aW1pemF0aW9uSGludCh3YXJuaW5nKTtcbiAgICAgICAgaWYgKGhpbnQpIHtcbiAgICAgICAgICBpZiAod2FybmluZy5jb2RlKSB7XG4gICAgICAgICAgICBzZWVuT3B0aW1pemF0aW9uQ29kZXMuYWRkKHdhcm5pbmcuY29kZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG9wdGltaXphdGlvbkhpbnRzLnB1c2goaGludCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdG9vbEV4ZWN1dGlvbkNvbnRleHQucnVuKFxuICAgICAgICB7IGNhbGw6IGF1Z21lbnRlZENhbGwsIG9ic2VydmVyOiB0aGlzLm9ic2VydmVyID8/IHVuZGVmaW5lZCB9LFxuICAgICAgICBhc3luYyAoKSA9PiByZWNvcmQuZGVmaW5pdGlvbi5oYW5kbGVyKGFyZ3MpXG4gICAgICApO1xuICAgICAgbGV0IG91dHB1dCA9IHR5cGVvZiByZXN1bHQgPT09ICdzdHJpbmcnID8gcmVzdWx0IDogSlNPTi5zdHJpbmdpZnkocmVzdWx0LCBudWxsLCAyKTtcbiAgICAgIGxldCBzbmFwc2hvdENhbmRpZGF0ZSA9IG91dHB1dDtcblxuICAgICAgLy8gVHJ1bmNhdGUgb3V0cHV0IGlmIGNvbnRleHQgbWFuYWdlciBpcyBhdmFpbGFibGVcbiAgICAgIGlmICh0aGlzLmNvbnRleHRNYW5hZ2VyKSB7XG4gICAgICAgIGNvbnN0IHRydW5jYXRlZCA9IHRoaXMuY29udGV4dE1hbmFnZXIudHJ1bmNhdGVUb29sT3V0cHV0KG91dHB1dCwgY2FsbC5uYW1lKTtcbiAgICAgICAgaWYgKHRydW5jYXRlZC53YXNUcnVuY2F0ZWQpIHtcbiAgICAgICAgICBvdXRwdXQgPSB0cnVuY2F0ZWQuY29udGVudDtcbiAgICAgICAgICAvLyBMb2cgdHJ1bmNhdGlvbiBmb3IgZGVidWdnaW5nXG4gICAgICAgICAgaWYgKHByb2Nlc3MuZW52WydERUJVR19DT05URVhUJ10pIHtcbiAgICAgICAgICAgIGxvZ0RlYnVnKFxuICAgICAgICAgICAgICBgW0NvbnRleHQgTWFuYWdlcl0gVHJ1bmNhdGVkICR7Y2FsbC5uYW1lfSBvdXRwdXQ6ICR7dHJ1bmNhdGVkLm9yaWdpbmFsTGVuZ3RofSAtPiAke3RydW5jYXRlZC50cnVuY2F0ZWRMZW5ndGh9IGNoYXJzYFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc25hcHNob3RDYW5kaWRhdGUgPSBvdXRwdXQ7XG4gICAgICB9XG5cbiAgICAgIHRoaXMucmVjb3JkRGlmZlNuYXBzaG90KGFyZ3MsIHNuYXBzaG90Q2FuZGlkYXRlKTtcblxuICAgICAgLy8gQ2FjaGUgdGhlIHJlc3VsdCBpZiBjYWNoZWFibGVcbiAgICAgIGlmIChjYW5Vc2VDYWNoZSkge1xuICAgICAgICBjb25zdCBjYWNoZUtleSA9IHRoaXMuZ2V0Q2FjaGVLZXkoeyAuLi5jYWxsLCBhcmd1bWVudHM6IGFyZ3MgfSk7XG4gICAgICAgIHRoaXMuY2FjaGUuc2V0KGNhY2hlS2V5LCB7XG4gICAgICAgICAgcmVzdWx0OiBvdXRwdXQsXG4gICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQXBwZW5kIG9wdGltaXphdGlvbiBoaW50cyB0byBndWlkZSBmdXR1cmUgTExNIGJlaGF2aW9yXG4gICAgICBpZiAob3B0aW1pemF0aW9uSGludHMubGVuZ3RoID4gMCkge1xuICAgICAgICBvdXRwdXQgPSBvdXRwdXQgKyBvcHRpbWl6YXRpb25IaW50cy5qb2luKCcnKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5vYnNlcnZlcj8ub25Ub29sUmVzdWx0Py4oYXVnbWVudGVkQ2FsbCwgb3V0cHV0KTtcblxuICAgICAgdGhpcy5yZWNvcmRUb29sSGlzdG9yeSh7XG4gICAgICAgIHRvb2xOYW1lOiBjYWxsLm5hbWUsXG4gICAgICAgIGFyZ3MsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgaGFzT3V0cHV0OiBoYXNOb25FbXB0eU91dHB1dChvdXRwdXQpLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFJlY29yZCBzdWNjZXNzZnVsIGV4ZWN1dGlvblxuICAgICAgZmluaXNoVG9vbENhbGwoKTtcbiAgICAgIHJldHVybiBvdXRwdXQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxldCBmb3JtYXR0ZWQ6IHN0cmluZztcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIFRvb2xBcmd1bWVudFZhbGlkYXRpb25FcnJvcikge1xuICAgICAgICBmb3JtYXR0ZWQgPSBlcnJvci5tZXNzYWdlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKTtcbiAgICAgICAgZm9ybWF0dGVkID0gYEZhaWxlZCB0byBydW4gXCIke2NhbGwubmFtZX1cIjogJHttZXNzYWdlfWA7XG4gICAgICB9XG4gICAgICB0aGlzLm9ic2VydmVyPy5vblRvb2xFcnJvcj8uKGF1Z21lbnRlZENhbGwsIGZvcm1hdHRlZCk7XG4gICAgICB0aGlzLnJlY29yZFRvb2xIaXN0b3J5KHtcbiAgICAgICAgdG9vbE5hbWU6IGNhbGwubmFtZSxcbiAgICAgICAgYXJncyxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgaGFzT3V0cHV0OiBoYXNOb25FbXB0eU91dHB1dChmb3JtYXR0ZWQpLFxuICAgICAgICBlcnJvcjogZm9ybWF0dGVkLFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIFJlY29yZCBmYWlsZWQgZXhlY3V0aW9uXG4gICAgICByZXR1cm4gZm9ybWF0dGVkO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q2FjaGVLZXkoY2FsbDogVG9vbENhbGxSZXF1ZXN0KTogc3RyaW5nIHtcbiAgICByZXR1cm4gYCR7Y2FsbC5uYW1lfToke0pTT04uc3RyaW5naWZ5KGNhbGwuYXJndW1lbnRzKX1gO1xuICB9XG5cbiAgY2xlYXJDYWNoZSgpOiB2b2lkIHtcbiAgICB0aGlzLmNhY2hlLmNsZWFyKCk7XG4gIH1cblxuICBnZXRDYWNoZVN0YXRzKCk6IHsgc2l6ZTogbnVtYmVyOyBlbnRyaWVzOiBudW1iZXIgfSB7XG4gICAgbGV0IHRvdGFsU2l6ZSA9IDA7XG4gICAgZm9yIChjb25zdCBlbnRyeSBvZiB0aGlzLmNhY2hlLnZhbHVlcygpKSB7XG4gICAgICB0b3RhbFNpemUgKz0gZW50cnkucmVzdWx0Lmxlbmd0aDtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHNpemU6IHRvdGFsU2l6ZSxcbiAgICAgIGVudHJpZXM6IHRoaXMuY2FjaGUuc2l6ZSxcbiAgICB9O1xuICB9XG5cbiAgY2xlYXJUb29sSGlzdG9yeSgpOiB2b2lkIHtcbiAgICB0aGlzLnRvb2xIaXN0b3J5Lmxlbmd0aCA9IDA7XG4gIH1cblxuICBnZXRUb29sSGlzdG9yeSgpOiByZWFkb25seSBUb29sSGlzdG9yeUVudHJ5W10ge1xuICAgIHJldHVybiB0aGlzLnRvb2xIaXN0b3J5O1xuICB9XG5cbiAgcHJpdmF0ZSByZWNvcmRUb29sSGlzdG9yeShlbnRyeTogVG9vbEhpc3RvcnlFbnRyeSk6IHZvaWQge1xuICAgIHRoaXMudG9vbEhpc3RvcnkucHVzaChlbnRyeSk7XG4gICAgaWYgKHRoaXMudG9vbEhpc3RvcnkubGVuZ3RoID4gdGhpcy5tYXhIaXN0b3J5U2l6ZSkge1xuICAgICAgdGhpcy50b29sSGlzdG9yeS5zaGlmdCgpO1xuICAgIH1cbiAgfVxuXG4gIGNsZWFyRGlmZlNuYXBzaG90cygpOiB2b2lkIHtcbiAgICB0aGlzLmRpZmZTbmFwc2hvdHMubGVuZ3RoID0gMDtcbiAgfVxuXG4gIGdldERpZmZTbmFwc2hvdHMoKTogcmVhZG9ubHkgRGlmZlNuYXBzaG90UmVjb3JkW10ge1xuICAgIHJldHVybiB0aGlzLmRpZmZTbmFwc2hvdHM7XG4gIH1cblxuICBwcml2YXRlIGFkZFRvb2woZGVmaW5pdGlvbjogVG9vbERlZmluaXRpb24sIHN1aXRlSWQ6IHN0cmluZyk6IHZvaWQge1xuICAgIGlmICghZGVmaW5pdGlvbj8ubmFtZT8udHJpbSgpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRvb2wgbmFtZXMgY2Fubm90IGJlIGJsYW5rIChzdWl0ZSBcIiR7c3VpdGVJZH1cIikuYCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnJlZ2lzdHJ5LmhhcyhkZWZpbml0aW9uLm5hbWUpKSB7XG4gICAgICBjb25zdCBvd25lciA9IHRoaXMucmVnaXN0cnkuZ2V0KGRlZmluaXRpb24ubmFtZSk/LnN1aXRlSWQgPz8gJ3Vua25vd24nO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUb29sIFwiJHtkZWZpbml0aW9uLm5hbWV9XCIgYWxyZWFkeSByZWdpc3RlcmVkIGJ5IHN1aXRlIFwiJHtvd25lcn1cIi5gKTtcbiAgICB9XG4gICAgdGhpcy5yZWdpc3RyeS5zZXQoZGVmaW5pdGlvbi5uYW1lLCB7XG4gICAgICBzdWl0ZUlkLFxuICAgICAgZGVmaW5pdGlvbixcbiAgICB9KTtcbiAgICB0aGlzLnJlZ2lzdHJhdGlvbk9yZGVyLnB1c2goZGVmaW5pdGlvbi5uYW1lKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlRnJvbU9yZGVyKG5hbWU6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5yZWdpc3RyYXRpb25PcmRlci5pbmRleE9mKG5hbWUpO1xuICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICB0aGlzLnJlZ2lzdHJhdGlvbk9yZGVyLnNwbGljZShpbmRleCwgMSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZWNvcmREaWZmU25hcHNob3QoYXJnczogUmVjb3JkPHN0cmluZywgdW5rbm93bj4sIG91dHB1dDogc3RyaW5nKTogdm9pZCB7XG4gICAgY29uc3QgY29tbWFuZCA9IHRoaXMuZmluZEdpdERpZmZDb21tYW5kKGFyZ3MpO1xuICAgIGlmICghY29tbWFuZCB8fCAhb3V0cHV0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5kaWZmU25hcHNob3RzLnB1c2goe1xuICAgICAgY29tbWFuZCxcbiAgICAgIG91dHB1dDogc2FmZVRydW5jYXRlKG91dHB1dCwgdGhpcy5tYXhEaWZmU25hcHNob3RMZW5ndGgsICdnaXQtZGlmZicpLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgIH0pO1xuXG4gICAgaWYgKHRoaXMuc25hcHNob3REaXIgJiYgdGhpcy5pby53cml0ZUZpbGUpIHtcbiAgICAgIGNvbnN0IGRpciA9IHRoaXMuc25hcHNob3REaXI7XG4gICAgICBjb25zdCBmaWxlbmFtZSA9IGBkaWZmLSR7RGF0ZS5ub3coKX0tJHtNYXRoLmFicyhoYXNoU3RyaW5nKGNvbW1hbmQpKX0udHh0YDtcbiAgICAgIGNvbnN0IGZ1bGxQYXRoID0gam9pbihkaXIsIGZpbGVuYW1lKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmICh0aGlzLmlvLmVuc3VyZURpcikge1xuICAgICAgICAgIHRoaXMuaW8uZW5zdXJlRGlyKGRpcik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pby53cml0ZUZpbGUoZnVsbFBhdGgsIG91dHB1dCk7XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgLy8gYmVzdC1lZmZvcnQgcGVyc2lzdGVuY2U7IGlnbm9yZSBlcnJvcnNcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5kaWZmU25hcHNob3RzLmxlbmd0aCA+IHRoaXMubWF4RGlmZlNuYXBzaG90cykge1xuICAgICAgdGhpcy5kaWZmU25hcHNob3RzLnNoaWZ0KCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBmaW5kR2l0RGlmZkNvbW1hbmQoYXJnczogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pOiBzdHJpbmcgfCBudWxsIHtcbiAgICBmb3IgKGNvbnN0IGNvbW1hbmQgb2YgdGhpcy5leHRyYWN0Q29tbWFuZHMoYXJncykpIHtcbiAgICAgIGlmICh0aGlzLmlzR2l0RGlmZkNvbW1hbmQoY29tbWFuZCkpIHtcbiAgICAgICAgcmV0dXJuIGNvbW1hbmQ7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcHJpdmF0ZSBleHRyYWN0Q29tbWFuZHMoYXJnczogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgY29tbWFuZHM6IHN0cmluZ1tdID0gW107XG5cbiAgICBjb25zdCBjb21tYW5kID0gYXJnc1snY29tbWFuZCddO1xuICAgIGlmICh0eXBlb2YgY29tbWFuZCA9PT0gJ3N0cmluZycgJiYgY29tbWFuZC50cmltKCkpIHtcbiAgICAgIGNvbW1hbmRzLnB1c2goY29tbWFuZC50cmltKCkpO1xuICAgIH1cblxuICAgIGNvbnN0IGNvbW1hbmRMaXN0ID0gYXJnc1snY29tbWFuZHMnXTtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShjb21tYW5kTGlzdCkpIHtcbiAgICAgIGZvciAoY29uc3QgdmFsdWUgb2YgY29tbWFuZExpc3QpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgJiYgdmFsdWUudHJpbSgpKSB7XG4gICAgICAgICAgY29tbWFuZHMucHVzaCh2YWx1ZS50cmltKCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGNvbW1hbmRzO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0dpdERpZmZDb21tYW5kKGNvbW1hbmQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAvXFxiZ2l0XFxzKyg/Oi0tbm8tcGFnZXJcXHMrKT8oPzpkaWZmfHNob3cpXFxiL2kudGVzdChjb21tYW5kKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlRGVmYXVsdFRvb2xSdW50aW1lKFxuICBjb250ZXh0OiBUb29sRXhlY3V0aW9uQ29udGV4dCxcbiAgdG9vbFN1aXRlczogVG9vbFN1aXRlW10gPSBbXSxcbiAgb3B0aW9uczogVG9vbFJ1bnRpbWVPcHRpb25zID0ge31cbik6IFRvb2xSdW50aW1lIHtcbiAgLy8gU3RhcnQgd2l0aCBubyBkZWZhdWx0IGludHJvc3BlY3Rpb24gdG9vbHMgLSB0aGV5IHdhc3RlIHRva2Vuc1xuICAvLyBNb2RlbCBrbm93cyBpdHMgY2FwYWJpbGl0aWVzIGZyb20gdG9vbCBkZWZpbml0aW9uc1xuICBjb25zdCBydW50aW1lID0gbmV3IFRvb2xSdW50aW1lKFtdLCBvcHRpb25zKTtcblxuICBmb3IgKGNvbnN0IHN1aXRlIG9mIHRvb2xTdWl0ZXMpIHtcbiAgICBydW50aW1lLnJlZ2lzdGVyU3VpdGUoc3VpdGUpO1xuICB9XG5cbiAgcmV0dXJuIHJ1bnRpbWU7XG59XG5cbi8vIFJlbW92ZWQgdW51c2VkIGludHJvc3BlY3Rpb24gdG9vbHMgKGNvbnRleHRfc25hcHNob3QsIGNhcGFiaWxpdGllc19vdmVydmlldywgcHJvZmlsZV9kZXRhaWxzKVxuLy8gTW9kZWwgYWxyZWFkeSBrbm93cyBjYXBhYmlsaXRpZXMgZnJvbSB0b29sIGRlZmluaXRpb25zOyB0aGVzZSBqdXN0IHdhc3RlZCB0b2tlbnNcblxuZnVuY3Rpb24gaGFzTm9uRW1wdHlPdXRwdXQob3V0cHV0OiBzdHJpbmcpOiBib29sZWFuIHtcbiAgcmV0dXJuIHR5cGVvZiBvdXRwdXQgPT09ICdzdHJpbmcnICYmIG91dHB1dC50cmltKCkubGVuZ3RoID4gMDtcbn1cblxuZnVuY3Rpb24gbm9ybWFsaXplVG9vbEFyZ3VtZW50cyh2YWx1ZTogdW5rbm93bik6IFJlY29yZDxzdHJpbmcsIHVua25vd24+IHtcbiAgaWYgKHZhbHVlIGluc3RhbmNlb2YgTWFwKSB7XG4gICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyh2YWx1ZS5lbnRyaWVzKCkpO1xuICB9XG4gIGlmIChpc1JlY29yZCh2YWx1ZSkpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICBjb25zdCB0cmltbWVkID0gdmFsdWUudHJpbSgpO1xuICAgIGlmICghdHJpbW1lZCkge1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgY29uc3QgcGFyc2VkID0gSlNPTi5wYXJzZSh0cmltbWVkKTtcbiAgICAgIHJldHVybiBpc1JlY29yZChwYXJzZWQpID8gcGFyc2VkIDoge307XG4gICAgfSBjYXRjaCB7XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuICB9XG4gIHJldHVybiB7fTtcbn1cblxuZnVuY3Rpb24gaXNSZWNvcmQodmFsdWU6IHVua25vd24pOiB2YWx1ZSBpcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiB7XG4gIHJldHVybiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICE9PSBudWxsICYmICFBcnJheS5pc0FycmF5KHZhbHVlKTtcbn1cblxuZnVuY3Rpb24gaGFzaFN0cmluZyh2YWx1ZTogc3RyaW5nKTogbnVtYmVyIHtcbiAgbGV0IGhhc2ggPSAwO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHZhbHVlLmxlbmd0aDsgaSsrKSB7XG4gICAgaGFzaCA9IChoYXNoIDw8IDUpIC0gaGFzaCArIHZhbHVlLmNoYXJDb2RlQXQoaSk7XG4gICAgaGFzaCB8PSAwO1xuICB9XG4gIHJldHVybiBoYXNoO1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUNBLElBQUFBLGdCQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxTQUFBLEdBQUFELE9BQUE7QUFFQSxJQUFBRSxnQkFBQSxHQUFBRixPQUFBO0FBRUEsSUFBQUcsa0JBQUEsR0FBQUgsT0FBQTtBQUNBLElBQUFJLG1CQUFBLEdBQUFKLE9BQUE7QUFDQSxJQUFBSyxZQUFBLEdBQUFMLE9BQUE7QUFlQSxJQUFBTSxnQkFBQSxHQUFBTixPQUFBO0FBdkJBOztBQTRDQSxNQUFNTyxvQkFBb0IsR0FBRyxJQUFJQyxrQ0FBaUIsQ0FBcUIsQ0FBQzs7QUFFeEU7QUFDQTtBQUNBO0FBQ0E7QUFDTyxTQUFTQyxrQkFBa0JBLENBQUNDLFFBQTRCLEVBQVE7RUFDckUsTUFBTUMsT0FBTyxHQUFHSixvQkFBb0IsQ0FBQ0ssUUFBUSxDQUFDLENBQUM7RUFDL0MsSUFBSSxDQUFDRCxPQUFPLEVBQUVFLFFBQVEsRUFBRUMsY0FBYyxFQUFFO0lBQ3RDO0VBQ0Y7RUFFQSxNQUFNQyxPQUFPLEdBQUdDLE1BQU0sQ0FBQ0MsUUFBUSxDQUFDUCxRQUFRLENBQUNLLE9BQU8sQ0FBQyxHQUFHRyxJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFD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