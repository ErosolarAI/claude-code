{"version":3,"names":["UnifiedOrchestrator","results","findings","listeners","Set","onEvent","callback","add","delete","emit","event","cb","execute","config","start","Date","now","report","generateReport","objective","end","id","startTime","endTime","duration","dedupedFindings","recSet","seen","Map","finding","key","title","recommendation","existing","get","evidence","Array","isArray","from","clone","set","push","size","lower","toLowerCase","includes","failedCommands","filter","r","success","hasCritical","some","f","severity","exitReason","length","statusSummary","join","slice","recommendations","summary","exports"],"sources":["unifiedOrchestrator.ts"],"sourcesContent":["export interface ExecutionResult {\n  success: boolean;\n  output: string;\n  duration: number;\n  command?: string;\n  error?: string;\n}\n\nexport interface Finding {\n  severity: 'critical' | 'high' | 'medium' | 'low';\n  category?: string;\n  title: string;\n  description?: string;\n  evidence?: string | string[];\n  recommendation?: string;\n}\n\nexport interface OperationConfig {\n  objective: string;\n}\n\nexport interface OrchestratorEvent {\n  type: string;\n  timestamp: number;\n  data?: Record<string, unknown>;\n}\n\nexport interface OperationReport {\n  id: string;\n  objective: string;\n  startTime: number;\n  endTime: number;\n  duration: number;\n  results: ExecutionResult[];\n  findings: Finding[];\n  recommendations: string[];\n  summary: string;\n  success: boolean;\n  exitReason?: string;\n  statusSummary?: string;\n}\n\nexport class UnifiedOrchestrator {\n  results: ExecutionResult[] = [];\n  findings: Finding[] = [];\n\n  private listeners = new Set<(event: OrchestratorEvent) => void>();\n\n  onEvent(callback: (event: OrchestratorEvent) => void): () => void {\n    this.listeners.add(callback);\n    return () => this.listeners.delete(callback);\n  }\n\n  protected emit(event: OrchestratorEvent): void {\n    for (const cb of this.listeners) {\n      try {\n        cb(event);\n      } catch {\n        // Ignore listener failures to avoid breaking orchestration\n      }\n    }\n  }\n\n  async execute(config: Partial<OperationConfig>): Promise<OperationReport> {\n    const start = Date.now();\n    const report = this.generateReport(config.objective ?? '');\n    const end = Date.now();\n    return {\n      ...report,\n      id: report.id ?? `report-${start}`,\n      objective: config.objective ?? '',\n      startTime: start,\n      endTime: end,\n      duration: end - start,\n    };\n  }\n\n  generateReport(objective: string): OperationReport {\n    const dedupedFindings: Finding[] = [];\n    const recSet = new Set<string>();\n    const seen = new Map<string, Finding>();\n\n    for (const finding of this.findings) {\n      const key = `${finding.title}|${finding.recommendation ?? ''}`;\n      const existing = seen.get(key);\n      if (existing) {\n        const evidence = [\n          ...(Array.isArray(existing.evidence) ? existing.evidence : existing.evidence ? [existing.evidence] : []),\n          ...(Array.isArray(finding.evidence) ? finding.evidence : finding.evidence ? [finding.evidence] : []),\n        ];\n        existing.evidence = Array.from(new Set(evidence));\n        continue;\n      }\n      const clone: Finding = { ...finding };\n      seen.set(key, clone);\n      dedupedFindings.push(clone);\n      if (clone.recommendation) {\n        recSet.add(clone.recommendation);\n      }\n    }\n\n    // Derive recommendations if none are present\n    if (recSet.size === 0) {\n      const lower = objective.toLowerCase();\n      if (lower.includes('ml') || lower.includes('model') || lower.includes('train')) {\n        recSet.add('Validate model outputs against a held-out set');\n        recSet.add('Document evaluation metrics and risks');\n      } else if (lower.includes('research') || lower.includes('cure')) {\n        recSet.add('Peer review findings with a subject-matter expert');\n        recSet.add('Validate data provenance and ethics approvals');\n      } else {\n        recSet.add('Review results with a teammate');\n        recSet.add('Verify outputs and rerun if needed');\n      }\n    }\n\n    const failedCommands = this.results.filter((r) => r && !r.success);\n    const hasCritical = dedupedFindings.some((f) => f.severity === 'critical');\n\n    let exitReason: OperationReport['exitReason'] = 'success';\n    let success = true;\n    if (failedCommands.length) {\n      exitReason = 'failed-commands';\n      success = false;\n    } else if (hasCritical) {\n      exitReason = 'critical-findings';\n      success = false;\n    }\n\n    const statusSummary = [\n      `${this.results.length} command(s)`,\n      failedCommands.length ? `${failedCommands.length} failed` : 'all passed',\n      dedupedFindings.length ? `${dedupedFindings.length} finding(s)` : 'no findings',\n    ].join(' | ');\n\n    return {\n      id: `report-${Date.now()}`,\n      objective,\n      startTime: Date.now(),\n      endTime: Date.now(),\n      duration: 0,\n      results: this.results.slice(),\n      findings: dedupedFindings,\n      recommendations: Array.from(recSet),\n      summary: statusSummary,\n      success,\n      exitReason,\n      statusSummary,\n    };\n  }\n}\n"],"mappings":";;;;;;AA0CO,MAAMA,mBAAmB,CAAC;EAC/BC,OAAO,GAAsB,EAAE;EAC/BC,QAAQ,GAAc,EAAE;EAEhBC,SAAS,GAAG,IAAIC,GAAG,CAAqC,CAAC;EAEjEC,OAAOA,CAACC,QAA4C,EAAc;IAChE,IAAI,CAACH,SAAS,CAACI,GAAG,CAACD,QAAQ,CAAC;IAC5B,OAAO,MAAM,IAAI,CAACH,SAAS,CAACK,MAAM,CAACF,QAAQ,CAAC;EAC9C;EAEUG,IAAIA,CAACC,KAAwB,EAAQ;IAC7C,KAAK,MAAMC,EAAE,IAAI,IAAI,CAACR,SAAS,EAAE;MAC/B,IAAI;QACFQ,EAAE,CAACD,KAAK,CAAC;MACX,CAAC,CAAC,MAAM;QACN;MAAA;IAEJ;EACF;EAEA,MAAME,OAAOA,CAACC,MAAgC,EAA4B;IACxE,MAAMC,KAAK,GAAGC,IAAI,CAACC,GAAG,CAAC,CAAC;IACxB,MAAMC,MAAM,GAAG,IAAI,CAACC,cAAc,CAACL,MAAM,CAACM,SAAS,IAAI,EAAE,CAAC;IAC1D,MAAMC,GAAG,GAAGL,IAAI,CAACC,GAAG,CAAC,CAAC;IACtB,OAAO;MACL,GAAGC,MAAM;MACTI,EAAE,EAAEJ,MAAM,CAACI,EAAE,IAAI,UAAUP,KAAK,EAAE;MAClCK,SAAS,EAAEN,MAAM,CAACM,SAAS,IAAI,EAAE;MACjCG,SAAS,EAAER,KAAK;MAChBS,OAAO,EAAEH,GAAG;MACZI,QAAQ,EAAEJ,GAAG,GAAGN;IAClB,CAAC;EACH;EAEAI,cAAcA,CAACC,SAAiB,EAAmB;IACjD,MAAMM,eAA0B,GAAG,EAAE;IACrC,MAAMC,MAAM,GAAG,IAAItB,GAAG,CAAS,CAAC;IAChC,MAAMuB,IAAI,GAAG,IAAIC,GAAG,CAAkB,CAAC;IAEvC,KAAK,MAAMC,OAAO,IAAI,IAAI,CAAC3B,QAAQ,EAAE;MACnC,MAAM4B,GAAG,GAAG,GAAGD,OAAO,CAACE,KAAK,IAAIF,OAAO,CAACG,cAAc,IAAI,EAAE,EAAE;MAC9D,MAAMC,QAAQ,GAAGN,IAAI,CAACO,GAAG,CAACJ,GAAG,CAAC;MAC9B,IAAIG,QAAQ,EAAE;QACZ,MAAME,QAAQ,GAAG,CACf,IAAIC,KAAK,CAACC,OAAO,CAACJ,QAAQ,CAACE,QAAQ,CAAC,GAAGF,QAAQ,CAACE,QAAQ,GAAGF,QAAQ,CAACE,QAAQ,GAAG,CAACF,QAAQ,CAACE,QAAQ,CAAC,GAAG,EAAE,CAAC,EACxG,IAAIC,KAAK,CAACC,OAAO,CAACR,OAAO,CAACM,QAAQ,CAAC,GAAGN,OAAO,CAACM,QAAQ,GAAGN,OAAO,CAACM,QAAQ,GAAG,CAACN,OAAO,CAACM,QAAQ,CAAC,GAAG,EAAE,CAAC,CACrG;QACDF,QAAQ,CAACE,QAAQ,GAAGC,KAAK,CAACE,IAAI,CAAC,IAAIlC,GAAG,CAAC+B,QAAQ,CAAC,CAAC;QACjD;MACF;MACA,MAAMI,KAAc,GAAG;QAAE,GAAGV;MAAQ,CAAC;MACrCF,IAAI,CAACa,GAAG,CAACV,GAAG,EAAES,KAAK,CAAC;MACpBd,eAAe,CAACgB,IAAI,CAACF,KAAK,CAAC;MAC3B,IAAIA,KAAK,CAACP,cAAc,EAAE;QACxBN,MAAM,CAACnB,GAAG,CAACgC,KAAK,CAACP,cAAc,CAAC;MAClC;IACF;;IAEA;IACA,IAAIN,MAAM,CAACgB,IAAI,KAAK,CAAC,EAAE;MACrB,MAAMC,KAAK,GAAGxB,SAAS,CAACyB,WAAW,CAAC,CAAC;MACrC,IAAID,KAAK,CAACE,QAAQ,CAAC,IAAI,CAAC,IAAIF,KAAK,CAACE,QAAQ,CAAC,OAAO,CAAC,IAAIF,KAAK,CAACE,QAAQ,CAAC,OAAO,CAAC,EAAE;QAC9EnB,MAAM,CAACnB,GAAG,CAAC,+CAA+C,CAAC;QAC3DmB,MAAM,CAACnB,GAAG,CAAC,uCAAuC,CAAC;MACrD,CAAC,MAAM,IAAIoC,KAAK,CAACE,QAAQ,CAAC,UAAU,CAAC,IAAIF,KAAK,CAACE,QAAQ,CAAC,MAAM,CAAC,EAAE;QAC/DnB,MAAM,CAACnB,GAAG,CAAC,mDAAmD,CAAC;QAC/DmB,MAAM,CAACnB,GAAG,CAAC,+CAA+C,CAAC;MAC7D,CAAC,MAAM;QACLmB,MAAM,CAACnB,GAAG,CAAC,gCAAgC,CAAC;QAC5CmB,MAAM,CAACnB,GAAG,CAAC,oCAAoC,CAAC;MAClD;IACF;IAEA,MAAMuC,cAAc,GAAG,IAAI,CAAC7C,OAAO,CAAC8C,MAAM,CAAEC,CAAC,IAAKA,CAAC,IAAI,CAACA,CAAC,CAACC,OAAO,CAAC;IAClE,MAAMC,WAAW,GAAGzB,eAAe,CAAC0B,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,QAAQ,KAAK,UAAU,CAAC;IAE1E,IAAIC,UAAyC,GAAG,SAAS;IACzD,IAAIL,OAAO,GAAG,IAAI;IAClB,IAAIH,cAAc,CAACS,MAAM,EAAE;MACzBD,UAAU,GAAG,iBAAiB;MAC9BL,OAAO,GAAG,KAAK;IACjB,CAAC,MAAM,IAAIC,WAAW,EAAE;MACtBI,UAAU,GAAG,mBAAmB;MAChCL,OAAO,GAAG,KAAK;IACjB;IAEA,MAAMO,aAAa,GAAG,CACpB,GAAG,IAAI,CAACvD,OAAO,CAACsD,MAAM,aAAa,EACnCT,cAAc,CAACS,MAAM,GAAG,GAAGT,cAAc,CAACS,MAAM,SAAS,GAAG,YAAY,EACxE9B,eAAe,CAAC8B,MAAM,GAAG,GAAG9B,eAAe,CAAC8B,MAAM,aAAa,GAAG,aAAa,CAChF,CAACE,IAAI,CAAC,KAAK,CAAC;IAEb,OAAO;MACLpC,EAAE,EAAE,UAAUN,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE;MAC1BG,SAAS;MACTG,SAAS,EAAEP,IAAI,CAACC,GAAG,CAAC,CAAC;MACrBO,OAAO,EAAER,IAAI,CAACC,GAAG,CAAC,CAAC;MACnBQ,QAAQ,EAAE,CAAC;MACXvB,OAAO,EAAE,IAAI,CAACA,OAAO,CAACyD,KAAK,CAAC,CAAC;MAC7BxD,QAAQ,EAAEuB,eAAe;MACzBkC,eAAe,EAAEvB,KAAK,CAACE,IAAI,CAACZ,MAAM,CAAC;MACnCkC,OAAO,EAAEJ,aAAa;MACtBP,OAAO;MACPK,UAAU;MACVE;IACF,CAAC;EACH;AACF;AAACK,OAAA,CAAA7D,mBAAA,GAAAA,mBAAA","ignoreList":[]}