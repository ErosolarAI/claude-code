{"version":3,"names":["_globals","require","_nodeFs","_nodeOs","_nodePath","_humanOpsTools","originalEnvDir","tempDir","beforeEach","process","env","mkdtempSync","join","tmpdir","afterEach","undefined","rmSync","recursive","force","describe","it","tools","createHumanOpsTools","tool","find","t","name","expect","toBeDefined","output","handler","title","context","urgency","needsBrowser","needsCaptcha","emailDomain","catchAll","domainRegistrar","paymentMethod","phoneVerification","ssoProviders","proxyPolicy","steps","artifacts","toContain","filePathLine","split","line","startsWith","toBeTruthy","filePath","replace","trim","content","JSON","parse","readFileSync","toBe","Array","isArray","length","toBeGreaterThan","updates","createOutput","updateOutput","taskPath","update","last","slice","note"],"sources":["humanOpsTools.test.ts"],"sourcesContent":["import { describe, it, expect, beforeEach, afterEach } from '@jest/globals';\nimport { mkdtempSync, readFileSync, rmSync } from 'node:fs';\nimport { tmpdir } from 'node:os';\nimport { join } from 'node:path';\nimport { createHumanOpsTools } from '../src/tools/humanOpsTools.js';\n\nlet originalEnvDir: string | undefined;\nlet tempDir: string;\n\nbeforeEach(() => {\n  originalEnvDir = process.env['AGI_HUMAN_TASK_DIR'];\n  tempDir = mkdtempSync(join(tmpdir(), 'human-ops-'));\n  process.env['AGI_HUMAN_TASK_DIR'] = join(tempDir, 'ops');\n});\n\nafterEach(() => {\n  if (originalEnvDir === undefined) {\n    delete process.env['AGI_HUMAN_TASK_DIR'];\n  } else {\n    process.env['AGI_HUMAN_TASK_DIR'] = originalEnvDir;\n  }\n  rmSync(tempDir, { recursive: true, force: true });\n});\n\ndescribe('HumanIntegration tool', () => {\n  it('records a human task with metadata and returns a summary', async () => {\n    const tools = createHumanOpsTools();\n    const tool = tools.find(t => t.name === 'HumanIntegration');\n    expect(tool).toBeDefined();\n    if (!tool) return;\n\n    const output = await tool.handler({\n      title: 'Solve checkout captcha',\n      context: 'Staging checkout blocks at captcha after address step.',\n      urgency: 'high',\n      needsBrowser: true,\n      needsCaptcha: true,\n      emailDomain: 'fastmail.test',\n      catchAll: true,\n      domainRegistrar: 'Namecheap',\n      paymentMethod: 'Virtual card (no auto-renew)',\n      phoneVerification: true,\n      ssoProviders: ['Google'],\n      proxyPolicy: 'Residential US IP, consistent UA',\n      steps: ['Open staging checkout', 'Proceed to address', 'Solve captcha', 'Complete order'],\n      artifacts: ['screenshot', 'HAR'],\n    } as any);\n\n    expect(output).toContain('Human task recorded');\n    expect(output).toContain('Urgency: high');\n    expect(output).toContain('Requires browser use');\n    expect(output).toContain('Requires captcha');\n    expect(output).toContain('Email domain:');\n    expect(output).toContain(tempDir);\n\n    // Ensure a task file was written and contains JSON with expected fields\n    const filePathLine = output.split('\\n').find(line => line.startsWith('Saved at: '));\n    expect(filePathLine).toBeTruthy();\n    const filePath = filePathLine?.replace('Saved at: ', '').trim() ?? '';\n    const content = JSON.parse(readFileSync(filePath, 'utf8'));\n    expect(content.title).toBe('Solve checkout captcha');\n    expect(content.urgency).toBe('high');\n    expect(content.needsBrowser).toBe(true);\n    expect(Array.isArray(content.steps)).toBe(true);\n    expect(content.steps.length).toBeGreaterThan(0);\n    expect(Array.isArray(content.updates)).toBe(true);\n    expect(content.updates?.length).toBeGreaterThan(0);\n    expect(content.emailDomain).toBe('fastmail.test');\n  });\n\n  it('appends an update to an existing task file', async () => {\n    const tools = createHumanOpsTools();\n    const tool = tools.find(t => t.name === 'HumanIntegration');\n    expect(tool).toBeDefined();\n    if (!tool) return;\n\n    const createOutput = await tool.handler({\n      title: 'Browser QA',\n      context: 'Need manual end-to-end with captcha',\n    } as any);\n    const filePathLine = createOutput.split('\\n').find(line => line.startsWith('Saved at: '));\n    expect(filePathLine).toBeTruthy();\n    const filePath = filePathLine?.replace('Saved at: ', '').trim() ?? '';\n\n    const updateOutput = await tool.handler({\n      title: 'Browser QA',\n      taskPath: filePath,\n      update: 'Ran captcha solver; waiting on email verification.',\n    } as any);\n\n    expect(updateOutput).toContain('Update appended to human task');\n    const content = JSON.parse(readFileSync(filePath, 'utf8'));\n    expect(content.updates?.length).toBeGreaterThan(1);\n    const last = content.updates?.slice(-1)[0];\n    expect(last?.note).toContain('captcha solver');\n  });\n});\n"],"mappings":"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","ignoreList":[]}