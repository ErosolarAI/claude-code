{"version":3,"names":["_nodeFs","require","_nodePath","_nodeOs","_globals","_repoUpgradeOrchestrator","simpleModule","id","label","description","scope","steps","intent","makePlan","modules","describe","it","calls","executor","jest","fn","input","push","success","summary","step","variant","score","execution","output","duration","command","module","orchestrator","RepoUpgradeOrchestrator","plan","report","run","mode","objective","expect","map","s","winnerVariant","toEqual","every","call","toBe","results","toHaveLength","length","result","endsWith","rewardSignals","executionSuccess","testsPassed","toContain","expectedCalls","toHaveBeenCalledTimes","error","continueOnFailure","status","dir","mkdtempSync","join","tmpdir","buildRepoWidePlan","rmSync","recursive","force","writeFileSync","JSON","stringify","name","workspaces","mkdirSync","ids","m","some","includes","workspaceModule","find","validationCommands","toBeGreaterThan","moduleIds","arrayContaining","skillsModule"],"sources":["repoUpgradeOrchestrator.test.ts"],"sourcesContent":["import { mkdtempSync, mkdirSync, rmSync, writeFileSync } from 'node:fs';\nimport { join } from 'node:path';\nimport { tmpdir } from 'node:os';\nimport { describe, expect, it, jest } from '@jest/globals';\nimport {\n  RepoUpgradeOrchestrator,\n  buildRepoWidePlan,\n  type RepoUpgradeModule,\n  type RepoUpgradePlan,\n  type UpgradeStepExecutionInput,\n} from '../src/core/repoUpgradeOrchestrator.js';\n\nconst simpleModule = (id: string): RepoUpgradeModule => ({\n  id,\n  label: id,\n  description: `Module ${id}`,\n  scope: [`${id}/**/*`],\n  steps: [\n    { id: `${id}-analyze`, intent: 'analyze', description: 'analyze' },\n    { id: `${id}-upgrade`, intent: 'upgrade', description: 'upgrade' },\n    { id: `${id}-verify`, intent: 'verify', description: 'verify' },\n  ],\n});\n\nconst makePlan = (...modules: RepoUpgradeModule[]): RepoUpgradePlan => ({ modules });\n\ndescribe('RepoUpgradeOrchestrator - modes', () => {\n  it('runs primary only in single-continuous mode and records winning executions', async () => {\n    const calls: UpgradeStepExecutionInput[] = [];\n    const executor = jest.fn(async (input: UpgradeStepExecutionInput) => {\n      calls.push(input);\n      return {\n        success: true,\n        summary: `${input.step.id}-${input.variant}`,\n        score: input.variant === 'primary' ? 0.4 : 0.9,\n        execution: {\n          success: true,\n          output: 'ok',\n          duration: 1,\n          command: `${input.module.id}/${input.step.id}/${input.variant}`,\n        },\n      };\n    });\n\n    const orchestrator = new RepoUpgradeOrchestrator(executor);\n    const plan = makePlan(simpleModule('source'));\n\n    const report = await orchestrator.run(plan, {\n      mode: 'single-continuous',\n      objective: 'upgrade',\n    });\n\n    expect(report.modules[0]?.steps.map((s) => s.winnerVariant)).toEqual(['primary', 'primary', 'primary']);\n    expect(calls.every((call) => call.variant === 'primary')).toBe(true);\n    expect(report.results).toHaveLength(plan.modules[0]?.steps.length ?? 0);\n    expect(report.results.every((result) => result.command?.endsWith('/primary'))).toBe(true);\n  });\n\n  it('prefers the refiner path in dual-rl-continuous mode when it scores higher', async () => {\n    const executor = jest.fn(async (input: UpgradeStepExecutionInput) => {\n      if (input.variant === 'primary') {\n        return {\n          success: true,\n          summary: 'primary version',\n          score: 0.2,\n          rewardSignals: { executionSuccess: 1, testsPassed: 0.2 },\n          execution: {\n            success: true,\n            output: 'primary',\n            duration: 1,\n            command: `${input.module.id}/${input.step.id}/primary`,\n          },\n        };\n      }\n      return {\n        success: true,\n        summary: 'refiner wins',\n        score: 0.9,\n        rewardSignals: { executionSuccess: 1, testsPassed: 0.9 },\n        execution: {\n          success: true,\n          output: 'refiner',\n          duration: 1,\n          command: `${input.module.id}/${input.step.id}/refiner`,\n        },\n      };\n    });\n\n    const orchestrator = new RepoUpgradeOrchestrator(executor);\n    const plan = makePlan(simpleModule('src-only'));\n\n    const report = await orchestrator.run(plan, { mode: 'dual-rl-continuous' });\n    const step = report.modules[0]?.steps[0];\n\n    expect(step?.winnerVariant).toBe('refiner');\n    expect(report.results[0]?.command).toContain('/refiner');\n    const expectedCalls = (plan.modules[0]?.steps.length ?? 0) * 2;\n    expect(executor).toHaveBeenCalledTimes(expectedCalls);\n  });\n\n  it('halts when continueOnFailure is false and marks remaining modules as skipped', async () => {\n    const executor = jest.fn(async (input: UpgradeStepExecutionInput) => {\n      if (input.module.id === 'first') {\n        return {\n          success: false,\n          summary: 'failed primary',\n          execution: {\n            success: false,\n            output: 'failed',\n            duration: 0,\n            command: `${input.module.id}/${input.step.id}/${input.variant}`,\n            error: 'failed',\n          },\n        };\n      }\n      return {\n        success: true,\n        summary: 'should not run',\n        execution: {\n          success: true,\n          output: 'ok',\n          duration: 0,\n          command: `${input.module.id}/${input.step.id}/${input.variant}`,\n        },\n      };\n    });\n\n    const orchestrator = new RepoUpgradeOrchestrator(executor);\n    const plan = makePlan(simpleModule('first'), simpleModule('second'));\n\n    const report = await orchestrator.run(plan, {\n      mode: 'single-continuous',\n      continueOnFailure: false,\n    });\n\n    expect(report.modules[0]?.status).toBe('failed');\n    expect(report.modules[1]?.status).toBe('skipped');\n    expect(executor).toHaveBeenCalledTimes(1);\n    expect(report.results[0]?.success).toBe(false);\n  });\n\n  it('uses refiner bias to break ties when both variants succeed', async () => {\n    const executor = jest.fn(async (input: UpgradeStepExecutionInput) => ({\n      success: true,\n      summary: `${input.step.id}-${input.variant}`,\n      score: 0.4,\n      rewardSignals: { executionSuccess: 1, testsPassed: 0.4 },\n      execution: {\n        success: true,\n        output: input.variant,\n        duration: 1,\n        command: `${input.module.id}/${input.step.id}/${input.variant}`,\n      },\n    }));\n\n    const orchestrator = new RepoUpgradeOrchestrator(executor);\n    const plan = makePlan(simpleModule('tie-breaker'));\n\n    const report = await orchestrator.run(plan, { mode: 'dual-rl-continuous' });\n    const step = report.modules[0]?.steps[0];\n\n    expect(step?.winnerVariant).toBe('refiner');\n    expect(executor).toHaveBeenCalledTimes((plan.modules[0]?.steps.length ?? 0) * 2);\n  });\n});\n\ndescribe('buildRepoWidePlan', () => {\n  it('returns a fallback module when no known scopes exist', () => {\n    const dir = mkdtempSync(join(tmpdir(), 'upgrade-fw-'));\n    try {\n      const plan = buildRepoWidePlan(dir);\n      expect(plan.modules).toHaveLength(1);\n      expect(plan.modules[0]?.id).toBe('repo-wide');\n    } finally {\n      rmSync(dir, { recursive: true, force: true });\n    }\n  });\n\n  it('expands npm/yarn workspaces into dedicated modules', () => {\n    const dir = mkdtempSync(join(tmpdir(), 'upgrade-fw-'));\n    try {\n      writeFileSync(join(dir, 'package.json'), JSON.stringify({ name: 'workspace-test', workspaces: ['packages/*'] }));\n      mkdirSync(join(dir, 'packages', 'svc-a'), { recursive: true });\n      const plan = buildRepoWidePlan(dir);\n      const ids = plan.modules.map((m) => m.id);\n\n      expect(ids.some((id) => id.includes('workspace-packages-svc-a'))).toBe(true);\n      const workspaceModule = plan.modules.find((m) => m.id.includes('workspace-packages-svc-a'));\n      expect(workspaceModule?.scope).toEqual(['packages/svc-a/**/*']);\n      expect(workspaceModule?.validationCommands?.length).toBeGreaterThan(0);\n    } finally {\n      rmSync(dir, { recursive: true, force: true });\n    }\n  });\n\n  it('detects repo-specific scopes like skills/agents/examples and carries validation hints', () => {\n    const dir = mkdtempSync(join(tmpdir(), 'upgrade-fw-'));\n    try {\n      mkdirSync(join(dir, 'src'));\n      mkdirSync(join(dir, 'skills'));\n      mkdirSync(join(dir, 'agents'));\n      mkdirSync(join(dir, 'examples'));\n\n      const plan = buildRepoWidePlan(dir);\n      const moduleIds = plan.modules.map((m) => m.id);\n\n      expect(moduleIds).toEqual(expect.arrayContaining(['source', 'skills', 'agents', 'examples']));\n\n      const skillsModule = plan.modules.find((m) => m.id === 'skills');\n      expect(skillsModule?.validationCommands?.length).toBeGreaterThan(0);\n    } finally {\n      rmSync(dir, { recursive: true, force: true });\n    }\n  });\n});\n"],"mappings":"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","ignoreList":[]}