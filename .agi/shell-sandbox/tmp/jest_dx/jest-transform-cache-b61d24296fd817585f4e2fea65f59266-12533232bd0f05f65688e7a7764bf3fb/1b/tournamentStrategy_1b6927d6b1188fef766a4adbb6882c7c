7e876f38e0f52528a90472c08e2a56d0
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.buildEvaluatorConfig = buildEvaluatorConfig;
var _dualTournament = require("./dualTournament.js");
var _repoUpgradeOrchestrator = require("./repoUpgradeOrchestrator.js");
function buildEvaluatorConfig(module, telemetry) {
  const repoType = getRepoTypeFromModule(module);

  // Default: balanced weights
  let rewardWeights = _dualTournament.DEFAULT_HUMAN_REWARD_WEIGHTS;
  let hardWeight = 1.35;
  let qualityWeight = 1.0;
  let rewardWeight = 0.9;
  if (repoType === 'tests') {
    rewardWeights = {
      alpha: 0.7,
      beta: 0.15,
      gamma: 0.15
    };
    hardWeight = 1.55;
    qualityWeight = 0.9;
    rewardWeight = 0.85;
  } else if (repoType === 'docs') {
    rewardWeights = {
      alpha: 0.45,
      beta: 0.3,
      gamma: 0.25
    };
    hardWeight = 1.0;
    qualityWeight = 1.2;
    rewardWeight = 1.0;
  } else if (repoType === 'refactor') {
    rewardWeights = {
      alpha: 0.55,
      beta: 0.25,
      gamma: 0.2
    };
    hardWeight = 1.25;
    qualityWeight = 1.15;
    rewardWeight = 0.95;
  }
  const telemetrySnapshot = telemetry?.get(repoType);
  if (telemetrySnapshot) {
    const total = Math.max(1, telemetrySnapshot.winsPrimary + telemetrySnapshot.winsRefiner);
    const bias = (telemetrySnapshot.winsPrimary - telemetrySnapshot.winsRefiner) / total;
    if (bias > 0.1) {
      hardWeight = (0, _repoUpgradeOrchestrator.clampScore)(hardWeight + 0.1, 0.8, 2);
      rewardWeights = {
        alpha: (0, _repoUpgradeOrchestrator.clampScore)((rewardWeights.alpha ?? 0.6) + 0.05, 0, 1),
        beta: rewardWeights.beta,
        gamma: (0, _repoUpgradeOrchestrator.clampScore)((rewardWeights.gamma ?? 0.2) - 0.02, 0, 1)
      };
    } else if (bias < -0.1) {
      qualityWeight = (0, _repoUpgradeOrchestrator.clampScore)(qualityWeight + 0.1, 0.8, 2);
      rewardWeight = (0, _repoUpgradeOrchestrator.clampScore)(rewardWeight + 0.05, 0.5, 1.5);
      rewardWeights = {
        alpha: (0, _repoUpgradeOrchestrator.clampScore)((rewardWeights.alpha ?? 0.6) - 0.05, 0, 1),
        beta: (0, _repoUpgradeOrchestrator.clampScore)((rewardWeights.beta ?? 0.25) + 0.05, 0, 1),
        gamma: (0, _repoUpgradeOrchestrator.clampScore)((rewardWeights.gamma ?? 0.2) + 0.02, 0, 1)
      };
    }
  }
  return {
    rewardWeights,
    evaluators: [{
      id: 'hard-metrics',
      label: 'Hard metrics',
      weight: hardWeight,
      kind: 'hard'
    }, {
      id: 'quality',
      label: 'Quality',
      weight: qualityWeight,
      kind: 'hybrid'
    }, {
      id: 'reward-signal',
      label: 'Reward signal',
      weight: rewardWeight,
      kind: 'hybrid'
    }]
  };
}
function getRepoTypeFromModule(module) {
  const scope = (module.scope || []).join(' ').toLowerCase();
  const label = (module.label || '').toLowerCase();
  if (/\btest|__tests__|spec\b/i.test(scope) || /\btest\b/i.test(label)) return 'tests';
  if (/\bdocs?\b/i.test(scope) || /\bdoc\b/i.test(label)) return 'docs';
  if (/\brefactor|cleanup|source\b/i.test(scope + ' ' + label)) return 'refactor';
  return 'general';
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZHVhbFRvdXJuYW1lbnQiLCJyZXF1aXJlIiwiX3JlcG9VcGdyYWRlT3JjaGVzdHJhdG9yIiwiYnVpbGRFdmFsdWF0b3JDb25maWciLCJtb2R1bGUiLCJ0ZWxlbWV0cnkiLCJyZXBvVHlwZSIsImdldFJlcG9UeXBlRnJvbU1vZHVsZSIsInJld2FyZFdlaWdodHMiLCJERUZBVUxUX0hVTUFOX1JFV0FSRF9XRUlHSFRTIiwiaGFyZFdlaWdodCIsInF1YWxpdHlXZWlnaHQiLCJyZXdhcmRXZWlnaHQiLCJhbHBoYSIsImJldGEiLCJnYW1tYSIsInRlbGVtZXRyeVNuYXBzaG90IiwiZ2V0IiwidG90YWwiLCJNYXRoIiwibWF4Iiwid2luc1ByaW1hcnkiLCJ3aW5zUmVmaW5lciIsImJpYXMiLCJjbGFtcFNjb3JlIiwiZXZhbHVhdG9ycyIsImlkIiwibGFiZWwiLCJ3ZWlnaHQiLCJraW5kIiwic2NvcGUiLCJqb2luIiwidG9Mb3dlckNhc2UiLCJ0ZXN0Il0sInNvdXJjZXMiOlsidG91cm5hbWVudFN0cmF0ZWd5LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgUmVwb1VwZ3JhZGVNb2R1bGUgfSBmcm9tICcuL3JlcG9VcGdyYWRlT3JjaGVzdHJhdG9yLmpzJztcbmltcG9ydCB7IERFRkFVTFRfSFVNQU5fUkVXQVJEX1dFSUdIVFMsIHR5cGUgSHVtYW5SZXdhcmRXZWlnaHRzIH0gZnJvbSAnLi9kdWFsVG91cm5hbWVudC5qcyc7XG5pbXBvcnQgeyBjbGFtcFNjb3JlIH0gZnJvbSAnLi9yZXBvVXBncmFkZU9yY2hlc3RyYXRvci5qcyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRXZhbHVhdG9yQ29uZmlnIHtcbiAgcmV3YXJkV2VpZ2h0czogSHVtYW5SZXdhcmRXZWlnaHRzO1xuICBldmFsdWF0b3JzOiBBcnJheTx7XG4gICAgaWQ6IHN0cmluZztcbiAgICBsYWJlbDogc3RyaW5nO1xuICAgIHdlaWdodDogbnVtYmVyO1xuICAgIGtpbmQ6ICdoYXJkJyB8ICdzb2Z0JyB8ICdoeWJyaWQnO1xuICAgIGVsbz86IG51bWJlcjtcbiAgfT47XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBidWlsZEV2YWx1YXRvckNvbmZpZyhcbiAgbW9kdWxlOiBSZXBvVXBncmFkZU1vZHVsZSxcbiAgdGVsZW1ldHJ5PzogTWFwPHN0cmluZywgVGVsZW1ldHJ5U25hcHNob3Q+XG4pOiBFdmFsdWF0b3JDb25maWcge1xuICBjb25zdCByZXBvVHlwZSA9IGdldFJlcG9UeXBlRnJvbU1vZHVsZShtb2R1bGUpO1xuXG4gIC8vIERlZmF1bHQ6IGJhbGFuY2VkIHdlaWdodHNcbiAgbGV0IHJld2FyZFdlaWdodHMgPSBERUZBVUxUX0hVTUFOX1JFV0FSRF9XRUlHSFRTO1xuICBsZXQgaGFyZFdlaWdodCA9IDEuMzU7XG4gIGxldCBxdWFsaXR5V2VpZ2h0ID0gMS4wO1xuICBsZXQgcmV3YXJkV2VpZ2h0ID0gMC45O1xuXG4gIGlmIChyZXBvVHlwZSA9PT0gJ3Rlc3RzJykge1xuICAgIHJld2FyZFdlaWdodHMgPSB7IGFscGhhOiAwLjcsIGJldGE6IDAuMTUsIGdhbW1hOiAwLjE1IH07XG4gICAgaGFyZFdlaWdodCA9IDEuNTU7XG4gICAgcXVhbGl0eVdlaWdodCA9IDAuOTtcbiAgICByZXdhcmRXZWlnaHQgPSAwLjg1O1xuICB9IGVsc2UgaWYgKHJlcG9UeXBlID09PSAnZG9jcycpIHtcbiAgICByZXdhcmRXZWlnaHRzID0geyBhbHBoYTogMC40NSwgYmV0YTogMC4zLCBnYW1tYTogMC4yNSB9O1xuICAgIGhhcmRXZWlnaHQgPSAxLjA7XG4gICAgcXVhbGl0eVdlaWdodCA9IDEuMjtcbiAgICByZXdhcmRXZWlnaHQgPSAxLjA7XG4gIH0gZWxzZSBpZiAocmVwb1R5cGUgPT09ICdyZWZhY3RvcicpIHtcbiAgICByZXdhcmRXZWlnaHRzID0geyBhbHBoYTogMC41NSwgYmV0YTogMC4yNSwgZ2FtbWE6IDAuMiB9O1xuICAgIGhhcmRXZWlnaHQgPSAxLjI1O1xuICAgIHF1YWxpdHlXZWlnaHQgPSAxLjE1O1xuICAgIHJld2FyZFdlaWdodCA9IDAuOTU7XG4gIH1cblxuICBjb25zdCB0ZWxlbWV0cnlTbmFwc2hvdCA9IHRlbGVtZXRyeT8uZ2V0KHJlcG9UeXBlKTtcbiAgaWYgKHRlbGVtZXRyeVNuYXBzaG90KSB7XG4gICAgY29uc3QgdG90YWwgPSBNYXRoLm1heCgxLCB0ZWxlbWV0cnlTbmFwc2hvdC53aW5zUHJpbWFyeSArIHRlbGVtZXRyeVNuYXBzaG90LndpbnNSZWZpbmVyKTtcbiAgICBjb25zdCBiaWFzID0gKHRlbGVtZXRyeVNuYXBzaG90LndpbnNQcmltYXJ5IC0gdGVsZW1ldHJ5U25hcHNob3Qud2luc1JlZmluZXIpIC8gdG90YWw7XG4gICAgaWYgKGJpYXMgPiAwLjEpIHtcbiAgICAgIGhhcmRXZWlnaHQgPSBjbGFtcFNjb3JlKGhhcmRXZWlnaHQgKyAwLjEsIDAuOCwgMik7XG4gICAgICByZXdhcmRXZWlnaHRzID0ge1xuICAgICAgICBhbHBoYTogY2xhbXBTY29yZSgocmV3YXJkV2VpZ2h0cy5hbHBoYSA/PyAwLjYpICsgMC4wNSwgMCwgMSksXG4gICAgICAgIGJldGE6IHJld2FyZFdlaWdodHMuYmV0YSxcbiAgICAgICAgZ2FtbWE6IGNsYW1wU2NvcmUoKHJld2FyZFdlaWdodHMuZ2FtbWEgPz8gMC4yKSAtIDAuMDIsIDAsIDEpLFxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKGJpYXMgPCAtMC4xKSB7XG4gICAgICBxdWFsaXR5V2VpZ2h0ID0gY2xhbXBTY29yZShxdWFsaXR5V2VpZ2h0ICsgMC4xLCAwLjgsIDIpO1xuICAgICAgcmV3YXJkV2VpZ2h0ID0gY2xhbXBTY29yZShyZXdhcmRXZWlnaHQgKyAwLjA1LCAwLjUsIDEuNSk7XG4gICAgICByZXdhcmRXZWlnaHRzID0ge1xuICAgICAgICBhbHBoYTogY2xhbXBTY29yZSgocmV3YXJkV2VpZ2h0cy5hbHBoYSA/PyAwLjYpIC0gMC4wNSwgMCwgMSksXG4gICAgICAgIGJldGE6IGNsYW1wU2NvcmUoKHJld2FyZFdlaWdodHMuYmV0YSA/PyAwLjI1KSArIDAuMDUsIDAsIDEpLFxuICAgICAgICBnYW1tYTogY2xhbXBTY29yZSgocmV3YXJkV2VpZ2h0cy5nYW1tYSA/PyAwLjIpICsgMC4wMiwgMCwgMSksXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgcmV3YXJkV2VpZ2h0cyxcbiAgICBldmFsdWF0b3JzOiBbXG4gICAgICB7IGlkOiAnaGFyZC1tZXRyaWNzJywgbGFiZWw6ICdIYXJkIG1ldHJpY3MnLCB3ZWlnaHQ6IGhhcmRXZWlnaHQsIGtpbmQ6ICdoYXJkJyB9LFxuICAgICAgeyBpZDogJ3F1YWxpdHknLCBsYWJlbDogJ1F1YWxpdHknLCB3ZWlnaHQ6IHF1YWxpdHlXZWlnaHQsIGtpbmQ6ICdoeWJyaWQnIH0sXG4gICAgICB7IGlkOiAncmV3YXJkLXNpZ25hbCcsIGxhYmVsOiAnUmV3YXJkIHNpZ25hbCcsIHdlaWdodDogcmV3YXJkV2VpZ2h0LCBraW5kOiAnaHlicmlkJyB9LFxuICAgIF0sXG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGVsZW1ldHJ5U25hcHNob3Qge1xuICB3aW5zUHJpbWFyeTogbnVtYmVyO1xuICB3aW5zUmVmaW5lcjogbnVtYmVyO1xufVxuXG5mdW5jdGlvbiBnZXRSZXBvVHlwZUZyb21Nb2R1bGUobW9kdWxlOiBSZXBvVXBncmFkZU1vZHVsZSk6IHN0cmluZyB7XG4gIGNvbnN0IHNjb3BlID0gKG1vZHVsZS5zY29wZSB8fCBbXSkuam9pbignICcpLnRvTG93ZXJDYXNlKCk7XG4gIGNvbnN0IGxhYmVsID0gKG1vZHVsZS5sYWJlbCB8fCAnJykudG9Mb3dlckNhc2UoKTtcbiAgaWYgKC9cXGJ0ZXN0fF9fdGVzdHNfX3xzcGVjXFxiL2kudGVzdChzY29wZSkgfHwgL1xcYnRlc3RcXGIvaS50ZXN0KGxhYmVsKSkgcmV0dXJuICd0ZXN0cyc7XG4gIGlmICgvXFxiZG9jcz9cXGIvaS50ZXN0KHNjb3BlKSB8fCAvXFxiZG9jXFxiL2kudGVzdChsYWJlbCkpIHJldHVybiAnZG9jcyc7XG4gIGlmICgvXFxicmVmYWN0b3J8Y2xlYW51cHxzb3VyY2VcXGIvaS50ZXN0KHNjb3BlICsgJyAnICsgbGFiZWwpKSByZXR1cm4gJ3JlZmFjdG9yJztcbiAgcmV0dXJuICdnZW5lcmFsJztcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsSUFBQUEsZUFBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsd0JBQUEsR0FBQUQsT0FBQTtBQWFPLFNBQVNFLG9CQUFvQkEsQ0FDbENDLE1BQXlCLEVBQ3pCQyxTQUEwQyxFQUN6QjtFQUNqQixNQUFNQyxRQUFRLEdBQUdDLHFCQUFxQixDQUFDSCxNQUFNLENBQUM7O0VBRTlDO0VBQ0EsSUFBSUksYUFBYSxHQUFHQyw0Q0FBNEI7RUFDaEQsSUFBSUMsVUFBVSxHQUFHLElBQUk7RUFDckIsSUFBSUMsYUFBYSxHQUFHLEdBQUc7RUFDdkIsSUFBSUMsWUFBWSxHQUFHLEdBQUc7RUFFdEIsSUFBSU4sUUFBUSxLQUFLLE9BQU8sRUFBRTtJQUN4QkUsYUFBYSxHQUFHO01BQUVLLEtBQUssRUFBRSxHQUFHO01BQUVDLElBQUksRUFBRSxJQUFJO01BQUVDLEtBQUssRUFBRTtJQUFLLENBQUM7SUFDdkRMLFVBQVUsR0FBRyxJQUFJO0lBQ2pCQyxhQUFhLEdBQUcsR0FBRztJQUNuQkMsWUFBWSxHQUFHLElBQUk7RUFDckIsQ0FBQyxNQUFNLElBQUlOLFFBQVEsS0FBSyxNQUFNLEVBQUU7SUFDOUJFLGFBQWEsR0FBRztNQUFFSyxLQUFLLEVBQUUsSUFBSTtNQUFFQyxJQUFJLEVBQUUsR0FBRztNQUFFQyxLQUFLLEVBQUU7SUFBSyxDQUFDO0lBQ3ZETCxVQUFVLEdBQUcsR0FBRztJQUNoQkMsYUFBYSxHQUFHLEdBQUc7SUFDbkJDLFlBQVksR0FBRyxHQUFHO0VBQ3BCLENBQUMsTUFBTSxJQUFJTixRQUFRLEtBQUssVUFBVSxFQUFFO0lBQ2xDRSxhQUFhLEdBQUc7TUFBRUssS0FBSyxFQUFFLElBQUk7TUFBRUMsSUFBSSxFQUFFLElBQUk7TUFBRUMsS0FBSyxFQUFFO0lB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