908ed00c96349b0377ac9597fe2738e4
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.calculateContextThresholds = calculateContextThresholds;
exports.getContextWindowTokens = getContextWindowTokens;
exports.getModelContextInfo = getModelContextInfo;
exports.getSafeTargetTokens = getSafeTargetTokens;
/**
 * Model Context Window Management
 *
 * Maps models to their context window sizes and provides utilities
 * for dynamic context limit configuration.
 */

const MODEL_CONTEXT_WINDOWS = [
// OpenAI GPT-5.x series (200K context)
{
  pattern: /^gpt-5\.1-?codex/i,
  contextWindow: 200_000,
  targetTokens: 140_000
}, {
  pattern: /^gpt-5(?:\.1|-?pro|-?mini|-?nano|-?max)/i,
  contextWindow: 200_000,
  targetTokens: 140_000
}, {
  pattern: /^gpt-5$/i,
  contextWindow: 200_000,
  targetTokens: 140_000
},
// OpenAI GPT-4o series (128K context)
{
  pattern: /^gpt-4o/i,
  contextWindow: 128_000,
  targetTokens: 90_000
}, {
  pattern: /^gpt-4-turbo/i,
  contextWindow: 128_000,
  targetTokens: 90_000
}, {
  pattern: /^gpt-4-(?:0125|1106)/i,
  contextWindow: 128_000,
  targetTokens: 90_000
},
// OpenAI GPT-4 (8K-32K context)
{
  pattern: /^gpt-4-32k/i,
  contextWindow: 32_000,
  targetTokens: 24_000
}, {
  pattern: /^gpt-4(?![o-])/i,
  contextWindow: 8_192,
  targetTokens: 6_000
},
// OpenAI o1/o3 reasoning models (200K context)
{
  pattern: /^o1(?:-pro|-mini)?/i,
  contextWindow: 200_000,
  targetTokens: 140_000
}, {
  pattern: /^o3(?:-pro|-mini)?/i,
  contextWindow: 200_000,
  targetTokens: 140_000
},
// OpenAI GPT-3.5 (16K context)
{
  pattern: /^gpt-3\.5-turbo-16k/i,
  contextWindow: 16_000,
  targetTokens: 12_000
}, {
  pattern: /^gpt-3\.5/i,
  contextWindow: 4_096,
  targetTokens: 3_000
},
// Anthropic Claude 4.x series (200K context)
{
  pattern: /^claude-(?:sonnet|opus|haiku)-4/i,
  contextWindow: 200_000,
  targetTokens: 140_000
}, {
  pattern: /^(?:sonnet|opus|haiku)-4/i,
  contextWindow: 200_000,
  targetTokens: 140_000
},
// Anthropic Claude 3.x series (200K context)
{
  pattern: /^claude-3/i,
  contextWindow: 200_000,
  targetTokens: 140_000
},
// Anthropic Claude 2.x (100K context)
{
  pattern: /^claude-2/i,
  contextWindow: 100_000,
  targetTokens: 70_000
},
// Google Gemini Pro (1M+ context, capped at 200K for safety)
{
  pattern: /^gemini-(?:1\.5|2\.0)-(?:pro|flash)/i,
  contextWindow: 1_000_000,
  targetTokens: 200_000
}, {
  pattern: /^gemini-pro/i,
  contextWindow: 32_000,
  targetTokens: 24_000
},
// DeepSeek (64K-128K context)
{
  pattern: /^deepseek-(?:chat|coder|reasoner)/i,
  contextWindow: 128_000,
  targetTokens: 90_000
}, {
  pattern: /^deepseek/i,
  contextWindow: 64_000,
  targetTokens: 45_000
},
// xAI Grok (128K context)
{
  pattern: /^grok/i,
  contextWindow: 128_000,
  targetTokens: 90_000
},
// Ollama/Local models
{
  pattern: /^llama-?3\.?[12]?:?(?:70b|405b)/i,
  contextWindow: 128_000,
  targetTokens: 90_000
}, {
  pattern: /^llama-?3/i,
  contextWindow: 8_192,
  targetTokens: 6_000
}, {
  pattern: /^llama-?2/i,
  contextWindow: 4_096,
  targetTokens: 3_000
}, {
  pattern: /^mistral/i,
  contextWindow: 32_000,
  targetTokens: 24_000
}, {
  pattern: /^mixtral/i,
  contextWindow: 32_000,
  targetTokens: 24_000
}, {
  pattern: /^codellama/i,
  contextWindow: 16_000,
  targetTokens: 12_000
}, {
  pattern: /^qwen/i,
  contextWindow: 32_000,
  targetTokens: 24_000
}, {
  pattern: /^phi/i,
  contextWindow: 4_096,
  targetTokens: 3_000
}];

// Default fallback values
const DEFAULT_CONTEXT_WINDOW = 128_000;
const DEFAULT_TARGET_TOKENS = 90_000;
/**
 * Get context window information for a model.
 */
function getModelContextInfo(model) {
  if (!model) {
    return {
      model: 'unknown',
      contextWindow: DEFAULT_CONTEXT_WINDOW,
      targetTokens: DEFAULT_TARGET_TOKENS,
      isDefault: true
    };
  }
  const normalized = model.trim();
  for (const entry of MODEL_CONTEXT_WINDOWS) {
    if (entry.pattern.test(normalized)) {
      return {
        model,
        contextWindow: entry.contextWindow,
        targetTokens: entry.targetTokens,
        isDefault: false
      };
    }
  }
  return {
    model,
    contextWindow: DEFAULT_CONTEXT_WINDOW,
    targetTokens: DEFAULT_TARGET_TOKENS,
    isDefault: true
  };
}

/**
 * Returns the approximate context window (in tokens) for the provided model id.
 * Falls back to null when the model is unknown so callers can handle gracefully.
 */
function getContextWindowTokens(model) {
  if (!model) {
    return null;
  }
  const info = getModelContextInfo(model);
  return info.isDefault ? null : info.contextWindow;
}

/**
 * Get safe target token count for a model.
 * This is the threshold at which context pruning should begin.
 */
function getSafeTargetTokens(model) {
  const info = getModelContextInfo(model);
  return info.targetTokens;
}

/**
 * Calculate all context management thresholds for a model.
 *
 * Thresholds are set conservatively to prevent context overflow errors:
 * - targetTokens: Start proactive pruning at 60% to leave ample room
 * - warningTokens: Show warning at 50% so user is aware
 * - criticalTokens: Aggressive pruning at 75%
 * - safetyBuffer: Reserve 5% for API overhead and response tokens
 */
function calculateContextThresholds(model) {
  const info = getModelContextInfo(model);
  const contextWindow = info.contextWindow;

  // Apply 5% safety buffer to account for API overhead
  const effectiveMax = Math.floor(contextWindow * 0.95);
  return {
    maxTokens: effectiveMax,
    targetTokens: Math.floor(contextWindow * 0.60),
    // Start pruning at 60% (more aggressive)
    warningTokens: Math.floor(contextWindow * 0.50),
    // Warn at 50%
    criticalTokens: Math.floor(contextWindow * 0.75) // Critical at 75%
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNT0RFTF9DT05URVhUX1dJTkRPV1MiLCJwYXR0ZXJuIiwiY29udGV4dFdpbmRvdyIsInRhcmdldFRva2VucyIsIkRFRkFVTFRfQ09OVEVYVF9XSU5ET1ciLCJERUZBVUxUX1RBUkdFVF9UT0tFTlMiLCJnZXRNb2RlbENvbnRleHRJbmZvIiwibW9kZWwiLCJpc0RlZmF1bHQiLCJub3JtYWxpemVkIiwidHJpbSIsImVudHJ5IiwidGVzdCIsImdldENvbnRleHRXaW5kb3dUb2tlbnMiLCJpbmZvIiwiZ2V0U2FmZVRhcmdldFRva2VucyIsImNhbGN1bGF0ZUNvbnRleHRUaHJlc2hvbGRzIiwiZWZmZWN0aXZlTWF4IiwiTWF0aCIsImZsb29yIiwibWF4VG9rZW5zIiwid2FybmluZ1Rva2VucyIsImNyaXRpY2FsVG9rZW5zIl0sInNvdXJjZXMiOlsiY29udGV4dFdpbmRvdy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE1vZGVsIENvbnRleHQgV2luZG93IE1hbmFnZW1lbnRcbiAqXG4gKiBNYXBzIG1vZGVscyB0byB0aGVpciBjb250ZXh0IHdpbmRvdyBzaXplcyBhbmQgcHJvdmlkZXMgdXRpbGl0aWVzXG4gKiBmb3IgZHluYW1pYyBjb250ZXh0IGxpbWl0IGNvbmZpZ3VyYXRpb24uXG4gKi9cblxuaW50ZXJmYWNlIE1vZGVsQ29udGV4dEVudHJ5IHtcbiAgcGF0dGVybjogUmVnRXhwO1xuICBjb250ZXh0V2luZG93OiBudW1iZXI7XG4gIHRhcmdldFRva2VuczogbnVtYmVyOyAgLy8gU2FmZSB0aHJlc2hvbGQgKDcwJSBvZiBjb250ZXh0KVxufVxuXG5jb25zdCBNT0RFTF9DT05URVhUX1dJTkRPV1M6IE1vZGVsQ29udGV4dEVudHJ5W10gPSBbXG4gIC8vIE9wZW5BSSBHUFQtNS54IHNlcmllcyAoMjAwSyBjb250ZXh0KVxuICB7IHBhdHRlcm46IC9eZ3B0LTVcXC4xLT9jb2RleC9pLCBjb250ZXh0V2luZG93OiAyMDBfMDAwLCB0YXJnZXRUb2tlbnM6IDE0MF8wMDAgfSxcbiAgeyBwYXR0ZXJuOiAvXmdwdC01KD86XFwuMXwtP3Byb3wtP21pbml8LT9uYW5vfC0/bWF4KS9pLCBjb250ZXh0V2luZG93OiAyMDBfMDAwLCB0YXJnZXRUb2tlbnM6IDE0MF8wMDAgfSxcbiAgeyBwYXR0ZXJuOiAvXmdwdC01JC9pLCBjb250ZXh0V2luZG93OiAyMDBfMDAwLCB0YXJnZXRUb2tlbnM6IDE0MF8wMDAgfSxcblxuICAvLyBPcGVuQUkgR1BULTRvIHNlcmllcyAoMTI4SyBjb250ZXh0KVxuICB7IHBhdHRlcm46IC9eZ3B0LTRvL2ksIGNvbnRleHRXaW5kb3c6IDEyOF8wMDAsIHRhcmdldFRva2VuczogOTBfMDAwIH0sXG4gIHsgcGF0dGVybjogL15ncHQtNC10dXJiby9pLCBjb250ZXh0V2luZG93OiAxMjhfMDAwLCB0YXJnZXRUb2tlbnM6IDkwXzAwMCB9LFxuICB7IHBhdHRlcm46IC9eZ3B0LTQtKD86MDEyNXwxMTA2KS9pLCBjb250ZXh0V2luZG93OiAxMjhfMDAwLCB0YXJnZXRUb2tlbnM6IDkwXzAwMCB9LFxuXG4gIC8vIE9wZW5BSSBHUFQtNCAoOEstMzJLIGNvbnRleHQpXG4gIHsgcGF0dGVybjogL15ncHQtNC0zMmsvaSwgY29udGV4dFdpbmRvdzogMzJfMDAwLCB0YXJnZXRUb2tlbnM6IDI0XzAwMCB9LFxuICB7IHBhdHRlcm46IC9eZ3B0LTQoPyFbby1dKS9pLCBjb250ZXh0V2luZG93OiA4XzE5MiwgdGFyZ2V0VG9rZW5zOiA2XzAwMCB9LFxuXG4gIC8vIE9wZW5BSSBvMS9vMyByZWFzb25pbmcgbW9kZWxzICgyMDBLIGNvbnRleHQpXG4gIHsgcGF0dGVybjogL15vMSg/Oi1wcm98LW1pbmkpPy9pLCBjb250ZXh0V2luZG93OiAyMDBfMDAwLCB0YXJnZXRUb2tlbnM6IDE0MF8wMDAgfSxcbiAgeyBwYXR0ZXJuOiAvXm8zKD86LXByb3wtbWluaSk/L2ksIGNvbnRleHRXaW5kb3c6IDIwMF8wMDAsIHRhcmdldFRva2VuczogMTQwXzAwMCB9LFxuXG4gIC8vIE9wZW5BSSBHUFQtMy41ICgxNksgY29udGV4dClcbiAgeyBwYXR0ZXJuOiAvXmdwdC0zXFwuNS10dXJiby0xNmsvaSwgY29udGV4dFdpbmRvdzogMTZfMDAwLCB0YXJnZXRUb2tlbnM6IDEyXzAwMCB9LFxuICB7IHBhdHRlcm46IC9eZ3B0LTNcXC41L2ksIGNvbnRleHRXaW5kb3c6IDRfMDk2LCB0YXJnZXRUb2tlbnM6IDNfMDAwIH0sXG5cbiAgLy8gQW50aHJvcGljIENsYXVkZSA0Lnggc2VyaWVzICgyMDBLIGNvbnRleHQpXG4gIHsgcGF0dGVybjogL15jbGF1ZGUtKD86c29ubmV0fG9wdXN8aGFpa3UpLTQvaSwgY29udGV4dFdpbmRvdzogMjAwXzAwMCwgdGFyZ2V0VG9rZW5zOiAxNDBfMDAwIH0sXG4gIHsgcGF0dGVybjogL14oPzpzb25uZXR8b3B1c3xoYWlrdSktNC9pLCBjb250ZXh0V2luZG93OiAyMDBfMDAwLCB0YXJnZXRUb2tlbnM6IDE0MF8wMDAgfSxcblxuICAvLyBBbnRocm9waWMgQ2xhdWRlIDMueCBzZXJpZXMgKDIwMEsgY29udGV4dClcbiAgeyBwYXR0ZXJuOiAvXmNsYXVkZS0zL2ksIGNvbnRleHRXaW5kb3c6IDIwMF8wMDAsIHRhcmdldFRva2VuczogMTQwXzAwMCB9LFxuXG4gIC8vIEFudGhyb3BpYyBDbGF1ZGUgMi54ICgxMDBLIGNvbnRleHQpXG4gIHsgcGF0dGVybjogL15jbGF1ZGUtMi9pLCBjb250ZXh0V2luZG93OiAxMDBfMDAwLCB0YXJnZXRUb2tlbnM6IDcwXzAwMCB9LFxuXG4gIC8vIEdvb2dsZSBHZW1pbmkgUHJvICgxTSsgY29udGV4dCwgY2FwcGVkIGF0IDIwMEsgZm9yIHNhZmV0eSlcbiAgeyBwYXR0ZXJuOiAvXmdlbWluaS0oPzoxXFwuNXwyXFwuMCktKD86cHJvfGZsYXNoKS9pLCBjb250ZXh0V2luZG93OiAxXzAwMF8wMDAsIHRhcmdldFRva2VuczogMjAwXzAwMCB9LFxuICB7IHBhdHRlcm46IC9eZ2VtaW5pLXByby9pLCBjb250ZXh0V2luZG93OiAzMl8wMDAsIHRhcmdldFRva2VuczogMjRfMDAwIH0sXG5cbiAgLy8gRGVlcFNlZWsgKDY0Sy0xMjhLIGNvbnRleHQpXG4gIHsgcGF0dGVybjogL15kZWVwc2Vlay0oPzpjaGF0fGNvZGVyfHJlYXNvbmVyKS9pLCBjb250ZXh0V2luZG93OiAxMjhfMDAwLCB0YXJnZXRUb2tlbnM6IDkwXzAwMCB9LFxuICB7IHBhdHRlcm46IC9eZGVlcHNlZWsvaSwgY29udGV4dFdpbmRvdzogNjRfMDAwLCB0YXJnZXRUb2tlbnM6IDQ1XzAwMCB9LFxuXG4gIC8vIHhBSSBHcm9rICgxMjhLIGNvbnRleHQpXG4gIHsgcGF0dGVybjogL15ncm9rL2ksIGNvbnRleHRXaW5kb3c6IDEyOF8wMDAsIHRhcmdldFRva2VuczogOTBfMDAwIH0sXG5cbiAgLy8gT2xsYW1hL0xvY2FsIG1vZGVsc1xuICB7IHBhdHRlcm46IC9ebGxhbWEtPzNcXC4/WzEyXT86Pyg/OjcwYnw0MDViKS9pLCBjb250ZXh0V2luZG93OiAxMjhfMDAwLCB0YXJnZXRUb2tlbnM6IDkwXzAwMCB9LFxuICB7IHBhdHRlcm46IC9ebGxhbWEtPzMvaSwgY29udGV4dFdpbmRvdzogOF8xOTIsIHRhcmdldFRva2VuczogNl8wMDAgfSxcbiAgeyBwYXR0ZXJuOiAvXmxsYW1hLT8yL2ksIGNvbnRleHRXaW5kb3c6IDRfMDk2LCB0YXJnZXRUb2tlbnM6IDNfMDAwIH0sXG4gIHsgcGF0dGVybjogL15taXN0cmFsL2ksIGNvbnRleHRXaW5kb3c6IDMyXzAwMCwgdGFyZ2V0VG9rZW5zOiAyNF8wMDAgfSxcbiAgeyBwYXR0ZXJuOiAvXm1peHRyYWwvaSwgY29udGV4dFdpbmRvdzogMzJfMDAwLCB0YXJnZXRUb2tlbnM6IDI0XzAwMCB9LFxuICB7IHBhdHRlcm46IC9eY29kZWxsYW1hL2ksIGNvbnRleHRXaW5kb3c6IDE2XzAwMCwgdGFyZ2V0VG9rZW5zOiAxMl8wMDAgfSxcbiAgeyBwYXR0ZXJuOiAvXnF3ZW4vaSwgY29udGV4dFdpbmRvdzogMzJfMDAwLCB0YXJnZXRUb2tlbnM6IDI0XzAwMCB9LFxuICB7IHBhdHRlcm46IC9ecGhpL2ksIGNvbnRleHRXaW5kb3c6IDRfMDk2LCB0YXJnZXRUb2tlbnM6IDNfMDAwIH0sXG5dO1xuXG4vLyBEZWZhdWx0IGZhbGxiYWNrIHZhbHVlc1xuY29uc3QgREVGQVVMVF9DT05URVhUX1dJTkRPVyA9IDEyOF8wMDA7XG5jb25zdCBERUZBVUxUX1RBUkdFVF9UT0tFTlMgPSA5MF8wMDA7XG5cbmV4cG9ydCBpbnRlcmZhY2UgTW9kZWxDb250ZXh0SW5mbyB7XG4gIG1vZGVsOiBzdHJpbmc7XG4gIGNvbnRleHRXaW5kb3c6IG51bWJlcjtcbiAgdGFyZ2V0VG9rZW5zOiBudW1iZXI7XG4gIGlzRGVmYXVsdDogYm9vbGVhbjtcbn1cblxuLyoqXG4gKiBHZXQgY29udGV4dCB3aW5kb3cgaW5mb3JtYXRpb24gZm9yIGEgbW9kZWwuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRNb2RlbENvbnRleHRJbmZvKG1vZGVsOiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkKTogTW9kZWxDb250ZXh0SW5mbyB7XG4gIGlmICghbW9kZWwpIHtcbiAgICByZXR1cm4ge1xuICAgICAgbW9kZWw6ICd1bmtub3duJyxcbiAgICAgIGNvbnRleHRXaW5kb3c6IERFRkFVTFRfQ09OVEVYVF9XSU5ET1csXG4gICAgICB0YXJnZXRUb2tlbnM6IERFRkFVTFRfVEFSR0VUX1RPS0VOUyxcbiAgICAgIGlzRGVmYXVsdDogdHJ1ZSxcbiAgICB9O1xuICB9XG5cbiAgY29uc3Qgbm9ybWFsaXplZCA9IG1vZGVsLnRyaW0oKTtcblxuICBmb3IgKGNvbnN0IGVudHJ5IG9mIE1PREVMX0NPTlRFWFRfV0lORE9XUykge1xuICAgIGlmIChlbnRyeS5wYXR0ZXJuLnRlc3Qobm9ybWFsaXplZCkpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIG1vZGVsLFxuICAgICAgICBjb250ZXh0V2luZG93OiBlbnRyeS5jb250ZXh0V2luZG93LFxuICAgICAgICB0YXJnZXRUb2tlbnM6IGVudHJ5LnRhcmdldFRva2VucyxcbiAgICAgICAgaXNEZWZhdWx0OiBmYWxzZSxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBtb2RlbCxcbiAgICBjb250ZXh0V2luZG93OiBERUZBVUxUX0NPTlRFWFRfV0lORE9XLFxuICAgIHRhcmdldFRva2VuczogREVGQVVMVF9UQVJHRVRfVE9LRU5TLFxuICAgIGlzRGVmYXVsdDogdHJ1ZSxcbiAgfTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBhcHByb3hpbWF0ZSBjb250ZXh0IHdpbmRvdyAoaW4gdG9rZW5zKSBmb3IgdGhlIHByb3ZpZGVkIG1vZGVsIGlkLlxuICogRmFsbHMgYmFjayB0byBudWxsIHdoZW4gdGhlIG1vZGVsIGlzIHVua25vd24gc28gY2FsbGVycyBjYW4gaGFuZGxlIGdyYWNlZnVsbHkuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb250ZXh0V2luZG93VG9rZW5zKG1vZGVsOiBzdHJpbmcgfCBudWxsIHwgdW5kZWZpbmVkKTogbnVtYmVyIHwgbnVsbCB7XG4gIGlmICghbW9kZWwpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGNvbnN0IGluZm8gPSBnZXRNb2RlbENvbnRleHRJbmZvKG1vZGVsKTtcbiAgcmV0dXJuIGluZm8uaXNEZWZhdWx0ID8gbnVsbCA6IGluZm8uY29udGV4dFdpbmRvdztcbn1cblxuLyoqXG4gKiBHZXQgc2FmZSB0YXJnZXQgdG9rZW4gY291bnQgZm9yIGEgbW9kZWwuXG4gKiBUaGlzIGlzIHRoZSB0aHJlc2hvbGQgYXQgd2hpY2ggY29udGV4dCBwcnVuaW5nIHNob3VsZCBiZWdpbi5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFNhZmVUYXJnZXRUb2tlbnMobW9kZWw6IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQpOiBudW1iZXIge1xuICBjb25zdCBpbmZvID0gZ2V0TW9kZWxDb250ZXh0SW5mbyhtb2RlbCk7XG4gIHJldHVybiBpbmZvLnRhcmdldFRva2Vucztcbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgYWxsIGNvbnRleHQgbWFuYWdlbWVudCB0aHJlc2hvbGRzIGZvciBhIG1vZGVsLlxuICpcbiAqIFRocmVzaG9sZHMgYXJlIHNldCBjb25zZXJ2YXRpdmVseSB0byBwcmV2ZW50IGNvbnRleHQgb3ZlcmZsb3cgZXJyb3JzOlxuICogLSB0YXJnZXRUb2tlbnM6IFN0YXJ0IHByb2FjdGl2ZSBwcnVuaW5nIGF0IDYwJSB0byBsZWF2ZSBhbXBsZSByb29tXG4gKiAtIHdhcm5pbmdUb2tlbnM6IFNob3cgd2FybmluZyBhdCA1MCUgc28gdXNlciBpcyBhd2FyZVxuICogLSBjcml0aWNhbFRva2VuczogQWdncmVzc2l2ZSBwcnVuaW5nIGF0IDc1JVxuICogLSBzYWZldHlCdWZmZXI6IFJlc2VydmUgNSUgZm9yIEFQSSBvdmVyaGVhZCBhbmQgcmVzcG9uc2UgdG9rZW5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVDb250ZXh0VGhyZXNob2xkcyhtb2RlbDogc3RyaW5nIHwgbnVsbCB8IHVuZGVmaW5lZCk6IHtcbiAgbWF4VG9rZW5zOiBudW1iZXI7XG4gIHRhcmdldFRva2VuczogbnVtYmVyO1xuICB3YXJuaW5nVG9rZW5zOiBudW1iZXI7XG4gIGNyaXRpY2FsVG9rZW5zOiBudW1iZXI7XG59IHtcbiAgY29uc3QgaW5mbyA9IGdldE1vZGVsQ29udGV4dEluZm8obW9kZWwpO1xuICBjb25zdCBjb250ZXh0V2luZG93ID0gaW5mby5jb250ZXh0V2luZG93O1xuXG4gIC8vIEFwcGx5IDUlIHNhZmV0eSBidWZmZXIgdG8gYWNjb3VudCBmb3IgQVBJIG92ZXJoZWFkXG4gIGNvbnN0IGVmZmVjdGl2ZU1heCA9IE1hdGguZmxvb3IoY29udGV4dFdpbmRvdyAqIDAuOTUpO1xuXG4gIHJldHVybiB7XG4gICAgbWF4VG9rZW5zOiBlZmZlY3RpdmVNYXgsXG4gICAgdGFyZ2V0VG9rZW5zOiBNYXRoLmZsb29yKGNvbnRleHRXaW5kb3cgKiAwLjYwKSwgIC8vIFN0YXJ0IHBydW5pbmcgYXQgNjAlIChtb3JlIGFnZ3Jlc3NpdmUpXG4gICAgd2FybmluZ1Rva2VuczogTWF0aC5mbG9vcihjb250ZXh0V2luZG93ICogMC41MCksICAvLyBXYXJuIGF0IDUwJVxuICAgIGNyaXRpY2FsVG9rZW5zOiBNYXRoLmZsb29yKGNvbnRleHRXaW5kb3cgKiAwLjc1KSwgIC8vIENyaXRpY2FsIGF0IDc1JVxuICB9O1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBUUEsTUFBTUEscUJBQTBDLEdBQUc7QUFDakQ7QUFDQTtFQUFFQyxPQUFPLEVBQUUsbUJBQW1CO0VBQUVDLGFBQWEsRUFBRSxPQUFPO0VBQUVDLFlBQVksRUFBRTtBQUFRLENBQUMsRUFDL0U7RUFBRUYsT0FBTyxFQUFFLDBDQUEwQztFQUFFQyxhQUFhLEVBQUUsT0FBTztFQUFFQyxZQUFZLEVBQUU7QUFBUSxDQUFDLEVBQ3RHO0VBQUVGLE9BQU8sRUFBRSxVQUFVO0VBQUVDLGFBQWEsRUFBRSxPQUFPO0VBQUVDLFlBQVksRUFBRTtBQUFRLENBQUM7QUFFdEU7QUFDQTtFQUFFRixPQUFPLEVBQUUsVUFBVTtFQUFFQyxhQUFhLEVBQUUsT0FBTztFQUFFQyxZQUFZLEVBQUU7QUFBTyxDQUFDLEVBQ3JFO0VBQUVGLE9BQU8sRUFBRSxlQUFlO0VBQUVDLGFBQWEsRUFBRSxPQUFPO0VBQUVDLFlBQVksRUFBRTtBQUFPLENBQUMsRUFDMUU7RUFBRUYsT0FBTyxFQUFFLHVCQUF1QjtFQUFFQyxhQUFhLEVBQUUsT0FBTztFQUFFQyxZQUFZLEVBQUU7QUFBTyxDQUFDO0FBRWxGO0FBQ0E7RUFBRUYsT0FBTyxFQUFFLGFBQWE7RUFBRUMsYUFBYSxFQUFFLE1BQU07RUFBRUMsWUFBWSxFQUFFO0FBQU8sQ0FBQyxFQUN2RTtFQUFFRixPQUFPLEVBQUUsaUJBQWlCO0VBQUVDLGFBQWEsRUFBRSxLQUFLO0VBQUVDLFlBQVksRUFBRTtBQUFNLENBQUM7QUFFekU7QUFDQTtFQUFFRixPQUFPLEVB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