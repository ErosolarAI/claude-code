{"version":3,"names":["cov_u41s6m18w","actualCoverage","NEXT_STEPS_HEADING","s","ensureNextSteps","content","f","normalized","b","trimEnd","output","appended","test","fallbackSteps","join"],"sources":["finalResponseFormatter.ts"],"sourcesContent":["/**\n * Ensures final assistant responses include a \"Next steps\" section.\n * Returns both the full output and any appended text so callers can stream just the delta.\n */\nexport interface FinalResponseFormat {\n  output: string;\n  appended: string | null;\n}\n\nconst NEXT_STEPS_HEADING = /(^|\\n)\\s*next steps?\\s*:/i;\n\nexport function ensureNextSteps(content: string): FinalResponseFormat {\n  const normalized = content?.trimEnd() ?? '';\n  if (!normalized) {\n    return { output: '', appended: null };\n  }\n\n  if (NEXT_STEPS_HEADING.test(normalized)) {\n    return { output: normalized, appended: null };\n  }\n\n  const fallbackSteps = [\n    '- Tell me if you want more changes or tests.',\n    '- I can run checks or prep a PR-style summary if needed.',\n  ];\n\n  const appended = ['\\n', 'Next steps:', ...fallbackSteps].join('\\n');\n  return {\n    output: `${normalized}${appended}`,\n    appended,\n  };\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,aAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,aAAA;AAfZ;AACA;AACA;AACA;;AAMA,MAAME,kBAAkB;AAAA;AAAA,CAAAF,aAAA,GAAAG,CAAA,OAAG,2BAA2B;AAE/C,SAASC,eAAeA,CAACC,OAAe,EAAuB;EAAA;EAAAL,aAAA,GAAAM,CAAA;EACpE,MAAMC,UAAU;EAAA;EAAA,CAAAP,aAAA,GAAAG,CAAA;EAAG;EAAA,CAAAH,aAAA,GAAAQ,CAAA,UAAAH,OAAO,EAAEI,OAAO,CAAC,CAAC;EAAA;EAAA,CAAAT,aAAA,GAAAQ,CAAA,UAAI,EAAE;EAAC;EAAAR,aAAA,GAAAG,CAAA;EAC5C,IAAI,CAACI,UAAU,EAAE;IAAA;IAAAP,aAAA,GAAAQ,CAAA;IAAAR,aAAA,GAAAG,CAAA;IACf,OAAO;MAAEO,MAAM,EAAE,EAAE;MAAEC,QAAQ,EAAE;IAAK,CAAC;EACvC,CAAC;EAAA;EAAA;IAAAX,aAAA,GAAAQ,CAAA;EAAA;EAAAR,aAAA,GAAAG,CAAA;EAED,IAAID,kBAAkB,CAACU,IAAI,CAACL,UAAU,CAAC,EAAE;IAAA;IAAAP,aAAA,GAAAQ,CAAA;IAAAR,aAAA,GAAAG,CAAA;IACvC,OAAO;MAAEO,MAAM,EAAEH,UAAU;MAAEI,QAAQ,EAAE;IAAK,CAAC;EAC/C,CAAC;EAAA;EAAA;IAAAX,aAAA,GAAAQ,CAAA;EAAA;EAED,MAAMK,aAAa;EAAA;EAAA,CAAAb,aAAA,GAAAG,CAAA,OAAG,CACpB,8CAA8C,EAC9C,0DAA0D,CAC3D;EAED,MAAMQ,QAAQ;EAAA;EAAA,CAAAX,aAAA,GAAAG,CAAA,OAAG,CAAC,IAAI,EAAE,aAAa,EAAE,GAAGU,aAAa,CAAC,CAACC,IAAI,CAAC,IAAI,CAAC;EAAC;EAAAd,aAAA,GAAAG,CAAA;EACpE,OAAO;IACLO,MAAM,EAAE,GAAGH,UAAU,GAAGI,QAAQ,EAAE;IAClCA;EACF,CAAC;AACH","ignoreList":[]}