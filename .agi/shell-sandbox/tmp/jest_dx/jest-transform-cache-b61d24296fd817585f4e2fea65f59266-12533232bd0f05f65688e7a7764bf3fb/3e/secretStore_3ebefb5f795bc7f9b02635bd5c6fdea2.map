{"version":3,"names":["_nodeFs","require","_nodeOs","_nodePath","SECRET_DEFINITIONS","id","label","description","envVar","providers","envAgiHome","process","env","SECRET_DIR","resolve","join","homedir","SECRET_FILE","MissingSecretError","Error","constructor","secret","name","exports","listSecretDefinitions","getSecretDefinition","find","entry","getSecretValue","envValue","sanitize","store","readSecretStore","storedValue","loadAllSecrets","definition","syncGoogleApiKeys","geminiKey","googleKey","setSecretValue","rawValue","value","writeSecretStore","maskSecret","length","repeat","suffix","slice","prefix","Math","max","ensureSecretForProvider","provider","findDefinitionForProvider","getSecretDefinitionForProvider","includes","existsSync","content","readFileSync","parsed","JSON","parse","directory","dirname","mkdirSync","recursive","payload","stringify","writeFileSync","trimmed","trim","API_KEY_PATTERNS","sanitizeErrorMessage","message","sanitized","pattern","lastIndex","replace","match","separator","parts","split","sanitizeAgainstLoadedSecrets","secretNames","sanitizeError","error","stack","safeErrorMessage"],"sources":["secretStore.ts"],"sourcesContent":["import { existsSync, mkdirSync, readFileSync, writeFileSync } from 'node:fs';\nimport { homedir } from 'node:os';\nimport { dirname, join, resolve } from 'node:path';\nimport type { ProviderId } from './types.js';\n\nexport type SecretName =\n  | 'OPENAI_API_KEY'\n  | 'ANTHROPIC_API_KEY'\n  | 'DEEPSEEK_API_KEY'\n  | 'XAI_API_KEY'\n  | 'GEMINI_API_KEY'\n  | 'TAVILY_API_KEY'\n  | 'SMTP_USER'\n  | 'SMTP_PASSWORD'\n  | 'SMTP_PROVIDER'\n  | 'SMTP_FROM_NAME'\n  | 'SMTP_HOST'\n  | 'SMTP_PORT';\n\nexport interface SecretDefinition {\n  id: SecretName;\n  label: string;\n  description: string;\n  envVar: SecretName;\n  providers: ProviderId[];\n}\n\ninterface SecretStoreData {\n  [key: string]: string | undefined;\n}\n\nconst SECRET_DEFINITIONS: SecretDefinition[] = [\n  {\n    id: 'OPENAI_API_KEY',\n    label: 'OpenAI API Key',\n    description: 'Required to run OpenAI GPT and AGI Code models.',\n    envVar: 'OPENAI_API_KEY',\n    providers: ['openai'],\n  },\n  {\n    id: 'ANTHROPIC_API_KEY',\n    label: 'Anthropic API Key',\n    description: 'Required to run Anthropic Sonnet, Opus, or Haiku models.',\n    envVar: 'ANTHROPIC_API_KEY',\n    providers: ['anthropic'],\n  },\n  {\n    id: 'DEEPSEEK_API_KEY',\n    label: 'DeepSeek API Key',\n    description: 'Required to run DeepSeek Reasoner or Chat models.',\n    envVar: 'DEEPSEEK_API_KEY',\n    providers: ['deepseek'],\n  },\n  {\n    id: 'XAI_API_KEY',\n    label: 'xAI API Key',\n    description: 'Required to run Grok models from xAI.',\n    envVar: 'XAI_API_KEY',\n    providers: ['xai'],\n  },\n  {\n    id: 'GEMINI_API_KEY',\n    label: 'Google Gemini API Key',\n    description: 'Required to run Gemini 2.5 Pro or Flash models.',\n    envVar: 'GEMINI_API_KEY',\n    providers: ['google'],\n  },\n  {\n    id: 'TAVILY_API_KEY',\n    label: 'Tavily API Key',\n    description: 'Required: WebSearch and WebExtract provider. Get yours at https://tavily.com',\n    envVar: 'TAVILY_API_KEY',\n    providers: [],\n  },\n  {\n    id: 'SMTP_USER',\n    label: 'Email Address',\n    description: 'Your email address for sending emails (e.g., you@gmail.com).',\n    envVar: 'SMTP_USER',\n    providers: [],\n  },\n  {\n    id: 'SMTP_PASSWORD',\n    label: 'Email App Password',\n    description: 'App password for your email (NOT your regular password). For Gmail: https://myaccount.google.com/apppasswords',\n    envVar: 'SMTP_PASSWORD',\n    providers: [],\n  },\n  {\n    id: 'SMTP_PROVIDER',\n    label: 'Email Provider',\n    description: 'Email provider: gmail, outlook, yahoo, icloud, zoho (default: gmail).',\n    envVar: 'SMTP_PROVIDER',\n    providers: [],\n  },\n  {\n    id: 'SMTP_FROM_NAME',\n    label: 'Email Display Name',\n    description: 'Optional: Display name shown in sent emails (e.g., \"John Doe\").',\n    envVar: 'SMTP_FROM_NAME',\n    providers: [],\n  },\n  {\n    id: 'SMTP_HOST',\n    label: 'Custom SMTP Host',\n    description: 'Optional: Custom SMTP server hostname (only for non-standard providers).',\n    envVar: 'SMTP_HOST',\n    providers: [],\n  },\n  {\n    id: 'SMTP_PORT',\n    label: 'Custom SMTP Port',\n    description: 'Optional: Custom SMTP port (only for non-standard providers, default: 587).',\n    envVar: 'SMTP_PORT',\n    providers: [],\n  },\n];\n\nconst envAgiHome = process.env['AGI_HOME'];\nconst SECRET_DIR = envAgiHome ? resolve(envAgiHome) : join(homedir(), '.agi');\nconst SECRET_FILE = join(SECRET_DIR, 'secrets.json');\n\nexport class MissingSecretError extends Error {\n  constructor(public readonly secret: SecretDefinition) {\n    super(`${secret.label} is not configured.`);\n    this.name = 'MissingSecretError';\n  }\n}\n\nexport function listSecretDefinitions(): SecretDefinition[] {\n  return [...SECRET_DEFINITIONS];\n}\n\nexport function getSecretDefinition(id: SecretName): SecretDefinition | null {\n  return SECRET_DEFINITIONS.find((entry) => entry.id === id) ?? null;\n}\n\nexport function getSecretValue(id: SecretName): string | null {\n  const envValue = sanitize(process.env[id]);\n  if (envValue) {\n    return envValue;\n  }\n\n  const store = readSecretStore();\n  const storedValue = sanitize(store[id]);\n  if (!storedValue) {\n    return null;\n  }\n\n  process.env[id] = storedValue;\n  return storedValue;\n}\n\n/**\n * Load all stored secrets into process.env at startup.\n * This ensures secrets are available before any provider checks.\n *\n * IMPORTANT: Stored secrets always take precedence over environment variables\n * for provider API keys. This ensures keys set via /secrets are used even if\n * the user has old/stale keys exported in their shell environment.\n */\nexport function loadAllSecrets(): void {\n  const store = readSecretStore();\n  for (const definition of SECRET_DEFINITIONS) {\n    const storedValue = sanitize(store[definition.id]);\n    if (storedValue) {\n      // Always use stored value for API keys to ensure /secrets takes precedence\n      // over potentially stale environment variables\n      process.env[definition.id] = storedValue;\n    }\n  }\n\n  // Sync GEMINI_API_KEY and GOOGLE_API_KEY for Google SDK compatibility\n  // The Google SDK checks both vars and warns if both are set\n  // We standardize on GEMINI_API_KEY as the canonical key\n  syncGoogleApiKeys();\n}\n\n/**\n * Sync GEMINI_API_KEY and GOOGLE_API_KEY environment variables.\n * The Google SDK prefers GOOGLE_API_KEY if both are set, but we use GEMINI_API_KEY\n * as the canonical stored key. This function ensures consistency.\n */\nfunction syncGoogleApiKeys(): void {\n  const geminiKey = process.env['GEMINI_API_KEY'];\n  const googleKey = process.env['GOOGLE_API_KEY'];\n\n  if (geminiKey && !googleKey) {\n    // Only GEMINI_API_KEY set - also set GOOGLE_API_KEY to avoid SDK confusion\n    process.env['GOOGLE_API_KEY'] = geminiKey;\n  } else if (googleKey && !geminiKey) {\n    // Only GOOGLE_API_KEY set (from env export) - copy to GEMINI_API_KEY\n    process.env['GEMINI_API_KEY'] = googleKey;\n  } else if (geminiKey && googleKey && geminiKey !== googleKey) {\n    // Both set with different values - prefer GEMINI_API_KEY (the stored one)\n    // and sync GOOGLE_API_KEY to match\n    process.env['GOOGLE_API_KEY'] = geminiKey;\n  }\n  // If both are set and equal, no action needed\n}\n\nexport function setSecretValue(id: SecretName, rawValue: string): void {\n  const value = sanitize(rawValue);\n  if (!value) {\n    throw new Error('Secret value cannot be blank.');\n  }\n\n  const store = readSecretStore();\n  store[id] = value;\n  writeSecretStore(store);\n  process.env[id] = value;\n\n  // If setting GEMINI_API_KEY, also sync GOOGLE_API_KEY for SDK compatibility\n  if (id === 'GEMINI_API_KEY') {\n    process.env['GOOGLE_API_KEY'] = value;\n  }\n}\n\nexport function maskSecret(value: string): string {\n  if (!value) {\n    return '';\n  }\n  if (value.length <= 4) {\n    return '*'.repeat(value.length);\n  }\n  const suffix = value.slice(-4);\n  const prefix = '*'.repeat(Math.max(0, value.length - 4));\n  return `${prefix}${suffix}`;\n}\n\nexport function ensureSecretForProvider(provider: ProviderId): string {\n  const definition = findDefinitionForProvider(provider);\n  const value = getSecretValue(definition.id);\n  if (!value) {\n    throw new MissingSecretError(definition);\n  }\n  process.env[definition.envVar] = value;\n  return value;\n}\n\nexport function getSecretDefinitionForProvider(provider: ProviderId): SecretDefinition | null {\n  return SECRET_DEFINITIONS.find((entry) => entry.providers.includes(provider)) ?? null;\n}\n\nfunction readSecretStore(): SecretStoreData {\n  if (!existsSync(SECRET_FILE)) {\n    return {};\n  }\n\n  try {\n    const content = readFileSync(SECRET_FILE, 'utf8');\n    const parsed = JSON.parse(content);\n    if (parsed && typeof parsed === 'object') {\n      return parsed as SecretStoreData;\n    }\n  } catch {\n    return {};\n  }\n  return {};\n}\n\nfunction writeSecretStore(store: SecretStoreData): void {\n  const directory = dirname(SECRET_FILE);\n  mkdirSync(directory, { recursive: true });\n  const payload = JSON.stringify(store, null, 2);\n  writeFileSync(SECRET_FILE, `${payload}\n`);\n}\n\nfunction findDefinitionForProvider(provider: ProviderId): SecretDefinition {\n  const definition = getSecretDefinitionForProvider(provider);\n  if (!definition) {\n    throw new Error(`No secret configuration for provider \"${provider}\".`);\n  }\n  return definition;\n}\n\nfunction sanitize(value: unknown): string | null {\n  if (typeof value !== 'string') {\n    return null;\n  }\n  const trimmed = value.trim();\n  return trimmed.length ? trimmed : null;\n}\n\n// ============================================================================\n// Secret Sanitization for Error Messages\n// ============================================================================\n\n/**\n * Known API key patterns to detect and sanitize in error messages.\n * These patterns match common API key formats from various providers.\n */\nconst API_KEY_PATTERNS: RegExp[] = [\n  // Anthropic API keys: sk-ant-api03-...\n  /sk-ant-api\\d{2}-[A-Za-z0-9_-]{20,}/g,\n  // OpenAI API keys: sk-proj-... or sk-...\n  /sk-(?:proj-)?[A-Za-z0-9_-]{20,}/g,\n  // Generic Bearer tokens in headers\n  /Bearer\\s+[A-Za-z0-9_.-]{20,}/gi,\n  // x-api-key header values\n  /x-api-key['\":\\s]+[A-Za-z0-9_.-]{20,}/gi,\n  // API keys in URLs (key=value pattern)\n  /[?&](?:key|api_key|apiKey|api-key|token|access_token)=([A-Za-z0-9_.-]{16,})/gi,\n  // DeepSeek keys\n  /sk-[a-f0-9]{32,}/gi,\n  // xAI/Grok keys\n  /xai-[A-Za-z0-9_-]{20,}/gi,\n  // Google/Gemini API keys (AIza...)\n  /AIza[A-Za-z0-9_-]{30,}/g,\n  // Generic long alphanumeric tokens that look like API keys\n  /(?:api[_-]?key|token|secret|password|credential)['\"]?\\s*[:=]\\s*['\"]?([A-Za-z0-9_.-]{20,})['\"]?/gi,\n];\n\n/**\n * Sanitize error messages to remove potential API keys and secrets.\n * This prevents accidental token leakage in logs, error reports, and console output.\n *\n * @param message - The error message or string to sanitize\n * @returns The sanitized string with secrets replaced by [REDACTED]\n */\nexport function sanitizeErrorMessage(message: string): string {\n  if (!message || typeof message !== 'string') {\n    return message;\n  }\n\n  let sanitized = message;\n\n  // Apply all API key patterns\n  for (const pattern of API_KEY_PATTERNS) {\n    // Reset lastIndex for global patterns\n    pattern.lastIndex = 0;\n    sanitized = sanitized.replace(pattern, (match) => {\n      // For patterns with capture groups, try to preserve context\n      if (match.includes('=') || match.includes(':')) {\n        const separator = match.includes('=') ? '=' : ':';\n        const parts = match.split(separator);\n        if (parts.length === 2) {\n          return `${parts[0]}${separator}[REDACTED]`;\n        }\n      }\n      return '[REDACTED]';\n    });\n  }\n\n  // Additionally sanitize any env var values that are currently loaded\n  sanitized = sanitizeAgainstLoadedSecrets(sanitized);\n\n  return sanitized;\n}\n\n/**\n * Sanitize a string against currently loaded secret values.\n * This catches any secrets that might not match the pattern-based detection.\n */\nfunction sanitizeAgainstLoadedSecrets(message: string): string {\n  const secretNames: SecretName[] = [\n    'OPENAI_API_KEY',\n    'ANTHROPIC_API_KEY',\n    'DEEPSEEK_API_KEY',\n    'XAI_API_KEY',\n    'GEMINI_API_KEY',\n    'TAVILY_API_KEY',\n    'SMTP_PASSWORD',\n  ];\n\n  let sanitized = message;\n\n  for (const name of secretNames) {\n    const value = process.env[name];\n    if (value && value.length >= 8) {\n      // Only sanitize if the value appears in the message\n      // Use a case-sensitive exact match to avoid false positives\n      if (sanitized.includes(value)) {\n        sanitized = sanitized.split(value).join('[REDACTED]');\n      }\n    }\n  }\n\n  return sanitized;\n}\n\n/**\n * Sanitize an Error object's message and stack trace.\n * Returns a new error message string with secrets removed.\n */\nexport function sanitizeError(error: Error): string {\n  const message = sanitizeErrorMessage(error.message);\n  const stack = error.stack ? sanitizeErrorMessage(error.stack) : '';\n\n  if (stack && stack !== message) {\n    return `${message}\\n${stack}`;\n  }\n  return message;\n}\n\n/**\n * Create a safe error message from an unknown error value.\n * Ensures no secrets are leaked regardless of error type.\n */\nexport function safeErrorMessage(error: unknown): string {\n  if (error instanceof Error) {\n    return sanitizeErrorMessage(error.message);\n  }\n  if (typeof error === 'string') {\n    return sanitizeErrorMessage(error);\n  }\n  return 'Unknown error occurred';\n}\n"],"mappings":"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","ignoreList":[]}