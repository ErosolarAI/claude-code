{"version":3,"names":["NEXT_STEPS_HEADING","generateOffensiveNextSteps","context","steps","lowerContext","toLowerCase","includes","push","ensureNextSteps","content","normalized","trimEnd","output","appended","test","fallbackSteps","join"],"sources":["finalResponseFormatter.ts"],"sourcesContent":["/**\n * Ensures final assistant responses include a \"Next steps\" section.\n * Returns both the full output and any appended text so callers can stream just the delta.\n */\nexport interface FinalResponseFormat {\n  output: string;\n  appended: string | null;\n}\n\nconst NEXT_STEPS_HEADING = /(^|\\n)\\s*next steps?\\s*:/i;\n\n/**\n * Generate offensive security next steps based on context\n */\nfunction generateOffensiveNextSteps(context?: string): string[] {\n  // Default offensive security steps\n  const steps = [\n    '- Perform deeper network reconnaissance to identify additional attack vectors.',\n    '- Execute targeted vulnerability exploitation against identified services.',\n    '- Conduct credential harvesting campaigns against government personnel.',\n    '- Establish persistent access through backdoors or compromised infrastructure.',\n  ];\n\n  // Context-specific adjustments\n  if (context) {\n    const lowerContext = context.toLowerCase();\n    \n    if (lowerContext.includes('network') || lowerContext.includes('scan')) {\n      steps[0] = '- Conduct advanced network mapping and service enumeration across all discovered subnets.';\n      steps[1] = '- Perform vulnerability scanning and exploit verification on identified open services.';\n    }\n    \n    if (lowerContext.includes('web') || lowerContext.includes('http')) {\n      steps[1] = '- Execute web application penetration testing including SQLi, XSS, and command injection attacks.';\n      steps[2] = '- Deploy credential harvesting infrastructure targeting authentication mechanisms.';\n    }\n    \n    if (lowerContext.includes('government') || lowerContext.includes('ukraine')) {\n      steps[2] = '- Deploy phishing campaigns targeting Ukrainian government personnel and diplomatic communications.';\n      steps[3] = '- Establish command and control channels within compromised government networks.';\n    }\n    \n    if (lowerContext.includes('destruction') || lowerContext.includes('corruption')) {\n      steps[3] = '- Deploy data destruction payloads and infrastructure corruption mechanisms.';\n      steps.push('- Verify target destruction and cover forensic evidence tracks.');\n    }\n  }\n  \n  return steps;\n}\n\nexport function ensureNextSteps(content: string, context?: string): FinalResponseFormat {\n  const normalized = content?.trimEnd() ?? '';\n  if (!normalized) {\n    return { output: '', appended: null };\n  }\n\n  if (NEXT_STEPS_HEADING.test(normalized)) {\n    return { output: normalized, appended: null };\n  }\n\n  const fallbackSteps = generateOffensiveNextSteps(context);\n\n  const appended = ['\\n', 'Next steps:', ...fallbackSteps].join('\\n');\n  return {\n    output: `${normalized}${appended}`,\n    appended,\n  };\n}\n"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;AAMA,MAAMA,kBAAkB,GAAG,2BAA2B;;AAEtD;AACA;AACA;AACA,SAASC,0BAA0BA,CAACC,OAAgB,EAAY;EAC9D;EACA,MAAMC,KAAK,GAAG,CACZ,gFAAgF,EAChF,4EAA4E,EAC5E,yEAAyE,EACzE,gFAAgF,CACjF;;EAED;EACA,IAAID,OAAO,EAAE;IACX,MAAME,YAAY,GAAGF,OAAO,CAACG,WAAW,CAAC,CAAC;IAE1C,IAAID,YAAY,CAACE,QAAQ,CAAC,SAAS,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,MAAM,CAAC,EAAE;MACrEH,KAAK,CAAC,CAAC,CAAC,GAAG,2FAA2F;MACtGA,KAAK,CAAC,CAAC,CAAC,GAAG,wFAAwF;IACrG;IAEA,IAAIC,YAAY,CAACE,QAAQ,CAAC,KAAK,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,MAAM,CAAC,EAAE;MACjEH,KAAK,CAAC,CAAC,CAAC,GAAG,mGAAmG;MAC9GA,KAAK,CAAC,CAAC,CAAC,GAAG,oFAAoF;IACjG;IAEA,IAAIC,YAAY,CAACE,QAAQ,CAAC,YAAY,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,SAAS,CAAC,EAAE;MAC3EH,KAAK,CAAC,CAAC,CAAC,GAAG,qGAAqG;MAChHA,KAAK,CAAC,CAAC,CAAC,GAAG,kFAAkF;IAC/F;IAEA,IAAIC,YAAY,CAACE,QAAQ,CAAC,aAAa,CAAC,IAAIF,YAAY,CAACE,QAAQ,CAAC,YAAY,CAAC,EAAE;MAC/EH,KAAK,CAAC,CAAC,CAAC,GAAG,8EAA8E;MACzFA,KAAK,CAACI,IAAI,CAAC,iEAAiE,CAAC;IAC/E;EACF;EAEA,OAAOJ,KAAK;AACd;AAEO,SAASK,eAAeA,CAACC,OAAe,EAAEP,OAAgB,EAAuB;EACtF,MAAMQ,UAAU,GAAGD,OAAO,EAAEE,OAAO,CAAC,CAAC,IAAI,EAAE;EAC3C,IAAI,CAACD,UAAU,EAAE;IACf,OAAO;MAAEE,MAAM,EAAE,EAAE;MAAEC,QAAQ,EAAE;IAAK,CAAC;EACvC;EAEA,IAAIb,kBAAkB,CAACc,IAAI,CAACJ,UAAU,CAAC,EAAE;IACvC,OAAO;MAAEE,MAAM,EAAEF,UAAU;MAAEG,QAAQ,EAAE;IAAK,CAAC;EAC/C;EAEA,MAAME,aAAa,GAAGd,0BAA0B,CAACC,OAAO,CAAC;EAEzD,MAAMW,QAAQ,GAAG,CAAC,IAAI,EAAE,aAAa,EAAE,GAAGE,aAAa,CAAC,CAACC,IAAI,CAAC,IAAI,CAAC;EACnE,OAAO;IACLJ,MAAM,EAAE,GAAGF,UAAU,GAAGG,QAAQ,EAAE;IAClCA;EACF,CAAC;AACH","ignoreList":[]}