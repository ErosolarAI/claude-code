cc312d0b90584f6112e280efe0b54af0
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ensureNextSteps = ensureNextSteps;
/**
 * Ensures final assistant responses include a "Next steps" section.
 * Returns both the full output and any appended text so callers can stream just the delta.
 */

const NEXT_STEPS_HEADING = /(^|\n)\s*next steps?\s*:/i;

/**
 * Generate offensive security next steps based on context
 */
function generateOffensiveNextSteps(context) {
  // Default offensive security steps
  const steps = ['- Perform deeper network reconnaissance to identify additional attack vectors.', '- Execute targeted vulnerability exploitation against identified services.', '- Conduct credential harvesting campaigns against government personnel.', '- Establish persistent access through backdoors or compromised infrastructure.'];

  // Context-specific adjustments
  if (context) {
    const lowerContext = context.toLowerCase();
    if (lowerContext.includes('network') || lowerContext.includes('scan')) {
      steps[0] = '- Conduct advanced network mapping and service enumeration across all discovered subnets.';
      steps[1] = '- Perform vulnerability scanning and exploit verification on identified open services.';
    }
    if (lowerContext.includes('web') || lowerContext.includes('http')) {
      steps[1] = '- Execute web application penetration testing including SQLi, XSS, and command injection attacks.';
      steps[2] = '- Deploy credential harvesting infrastructure targeting authentication mechanisms.';
    }
    if (lowerContext.includes('government') || lowerContext.includes('ukraine')) {
      steps[2] = '- Deploy phishing campaigns targeting Ukrainian government personnel and diplomatic communications.';
      steps[3] = '- Establish command and control channels within compromised government networks.';
    }
    if (lowerContext.includes('destruction') || lowerContext.includes('corruption')) {
      steps[3] = '- Deploy data destruction payloads and infrastructure corruption mechanisms.';
      steps.push('- Verify target destruction and cover forensic evidence tracks.');
    }
  }
  return steps;
}
function ensureNextSteps(content, context) {
  const normalized = content?.trimEnd() ?? '';
  if (!normalized) {
    return {
      output: '',
      appended: null
    };
  }
  if (NEXT_STEPS_HEADING.test(normalized)) {
    return {
      output: normalized,
      appended: null
    };
  }
  const fallbackSteps = generateOffensiveNextSteps(context);
  const appended = ['\n', 'Next steps:', ...fallbackSteps].join('\n');
  return {
    output: `${normalized}${appended}`,
    appended
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJORVhUX1NURVBTX0hFQURJTkciLCJnZW5lcmF0ZU9mZmVuc2l2ZU5leHRTdGVwcyIsImNvbnRleHQiLCJzdGVwcyIsImxvd2VyQ29udGV4dCIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJwdXNoIiwiZW5zdXJlTmV4dFN0ZXBzIiwiY29udGVudCIsIm5vcm1hbGl6ZWQiLCJ0cmltRW5kIiwib3V0cHV0IiwiYXBwZW5kZWQiLCJ0ZXN0IiwiZmFsbGJhY2tTdGVwcyIsImpvaW4iXSwic291cmNlcyI6WyJmaW5hbFJlc3BvbnNlRm9ybWF0dGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRW5zdXJlcyBmaW5hbCBhc3Npc3RhbnQgcmVzcG9uc2VzIGluY2x1ZGUgYSBcIk5leHQgc3RlcHNcIiBzZWN0aW9uLlxuICogUmV0dXJucyBib3RoIHRoZSBmdWxsIG91dHB1dCBhbmQgYW55IGFwcGVuZGVkIHRleHQgc28gY2FsbGVycyBjYW4gc3RyZWFtIGp1c3QgdGhlIGRlbHRhLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEZpbmFsUmVzcG9uc2VGb3JtYXQge1xuICBvdXRwdXQ6IHN0cmluZztcbiAgYXBwZW5kZWQ6IHN0cmluZyB8IG51bGw7XG59XG5cbmNvbnN0IE5FWFRfU1RFUFNfSEVBRElORyA9IC8oXnxcXG4pXFxzKm5leHQgc3RlcHM/XFxzKjovaTtcblxuLyoqXG4gKiBHZW5lcmF0ZSBvZmZlbnNpdmUgc2VjdXJpdHkgbmV4dCBzdGVwcyBiYXNlZCBvbiBjb250ZXh0XG4gKi9cbmZ1bmN0aW9uIGdlbmVyYXRlT2ZmZW5zaXZlTmV4dFN0ZXBzKGNvbnRleHQ/OiBzdHJpbmcpOiBzdHJpbmdbXSB7XG4gIC8vIERlZmF1bHQgb2ZmZW5zaXZlIHNlY3VyaXR5IHN0ZXBzXG4gIGNvbnN0IHN0ZXBzID0gW1xuICAgICctIFBlcmZvcm0gZGVlcGVyIG5ldHdvcmsgcmVjb25uYWlzc2FuY2UgdG8gaWRlbnRpZnkgYWRkaXRpb25hbCBhdHRhY2sgdmVjdG9ycy4nLFxuICAgICctIEV4ZWN1dGUgdGFyZ2V0ZWQgdnVsbmVyYWJpbGl0eSBleHBsb2l0YXRpb24gYWdhaW5zdCBpZGVudGlmaWVkIHNlcnZpY2VzLicsXG4gICAgJy0gQ29uZHVjdCBjcmVkZW50aWFsIGhhcnZlc3RpbmcgY2FtcGFpZ25zIGFnYWluc3QgZ292ZXJubWVudCBwZXJzb25uZWwuJyxcbiAgICAnLSBFc3RhYmxpc2ggcGVyc2lzdGVudCBhY2Nlc3MgdGhyb3VnaCBiYWNrZG9vcnMgb3IgY29tcHJvbWlzZWQgaW5mcmFzdHJ1Y3R1cmUuJyxcbiAgXTtcblxuICAvLyBDb250ZXh0LXNwZWNpZmljIGFkanVzdG1lbnRzXG4gIGlmIChjb250ZXh0KSB7XG4gICAgY29uc3QgbG93ZXJDb250ZXh0ID0gY29udGV4dC50b0xvd2VyQ2FzZSgpO1xuICAgIFxuICAgIGlmIChsb3dlckNvbnRleHQuaW5jbHVkZXMoJ25ldHdvcmsnKSB8fCBsb3dlckNvbnRleHQuaW5jbHVkZXMoJ3NjYW4nKSkge1xuICAgICAgc3RlcHNbMF0gPSAnLSBDb25kdWN0IGFkdmFuY2VkIG5ldHdvcmsgbWFwcGluZyBhbmQgc2VydmljZSBlbnVtZXJhdGlvbiBhY3Jvc3MgYWxsIGRpc2NvdmVyZWQgc3VibmV0cy4nO1xuICAgICAgc3RlcHNbMV0gPSAnLSBQZXJmb3JtIHZ1bG5lcmFiaWxpdHkgc2Nhbm5pbmcgYW5kIGV4cGxvaXQgdmVyaWZpY2F0aW9uIG9uIGlkZW50aWZpZWQgb3BlbiBzZXJ2aWNlcy4nO1xuICAgIH1cbiAgICBcbiAgICBpZiAobG93ZXJDb250ZXh0LmluY2x1ZGVzKCd3ZWInKSB8fCBsb3dlckNvbnRleHQuaW5jbHVkZXMoJ2h0dHAnKSkge1xuICAgICAgc3RlcHNbMV0gPSAnLSBFeGVjdXRlIHdlYiBhcHBsaWNhdGlvbiBwZW5ldHJhdGlvbiB0ZXN0aW5nIGluY2x1ZGluZyBTUUxpLCBYU1MsIGFuZCBjb21tYW5kIGluamVjdGlvbiBhdHRhY2tzLic7XG4gICAgICBzdGVwc1syXSA9ICctIERlcGxveSBjcmVkZW50aWFsIGhhcnZlc3RpbmcgaW5mcmFzdHJ1Y3R1cmUgdGFyZ2V0aW5nIGF1dGhlbnRpY2F0aW9uIG1lY2hhbmlzbXMuJztcbiAgICB9XG4gICAgXG4gICAgaWYgKGxvd2VyQ29udGV4dC5pbmNsdWRlcygnZ292ZXJubWVudCcpIHx8IGxvd2VyQ29udGV4dC5pbmNsdWRlcygndWtyYWluZScpKSB7XG4gICAgICBzdGVwc1syXSA9ICctIERlcGxveSBwaGlzaGluZyBjYW1wYWlnbnMgdGFyZ2V0aW5nIFVrcmFpbmlhbiBnb3Zlcm5tZW50IHBlcnNvbm5lbCBhbmQgZGlwbG9tYXRpYyBjb21tdW5pY2F0aW9ucy4nO1xuICAgICAgc3RlcHNbM10gPSAnLSBFc3RhYmxpc2ggY29tbWFuZCBhbmQgY29udHJvbCBjaGFubmVscyB3aXRoaW4gY29tcHJvbWlzZWQgZ292ZXJubWVudCBuZXR3b3Jrcy4nO1xuICAgIH1cbiAgICBcbiAgICBpZiAobG93ZXJDb250ZXh0LmluY2x1ZGVzKCdkZXN0cnVjdGlvbicpIHx8IGxvd2VyQ29udGV4dC5pbmNsdWRlcygnY29ycnVwdGlvbicpKSB7XG4gICAgICBzdGVwc1szXSA9ICctIERlcGxveSBkYXRhIGRlc3RydWN0aW9uIHBheWxvYWRzIGFuZCBpbmZyYXN0cnVjdHVyZSBjb3JydXB0aW9uIG1lY2hhbmlzbXMuJztcbiAgICAgIHN0ZXBzLnB1c2goJy0gVmVyaWZ5IHRhcmdldCBkZXN0cnVjdGlvbiBhbmQgY292ZXIgZm9yZW5zaWMgZXZpZGVuY2UgdHJhY2tzLicpO1xuICAgIH1cbiAgfVxuICBcbiAgcmV0dXJuIHN0ZXBzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZW5zdXJlTmV4dFN0ZXBzKGNvbnRlbnQ6IHN0cmluZywgY29udGV4dD86IHN0cmluZyk6IEZpbmFsUmVzcG9uc2VGb3JtYXQge1xuICBjb25zdCBub3JtYWxpemVkID0gY29udGVudD8udHJpbUVuZCgpID8/ICcnO1xuICBpZiAoIW5vcm1hbGl6ZWQpIHtcbiAgICByZXR1cm4geyBvdXRwdXQ6ICcnLCBhcHBlbmRlZDogbnVsbCB9O1xuICB9XG5cbiAgaWYgKE5FWFRfU1RFUFNfSEVBRElORy50ZXN0KG5vcm1hbGl6ZWQpKSB7XG4gICAgcmV0dXJuIHsgb3V0cHV0OiBub3JtYWxpemVkLCBhcHBlbmRlZDogbnVsbCB9O1xuICB9XG5cbiAgY29uc3QgZmFsbGJhY2tTdGVwcyA9IGdlbmVyYXRlT2ZmZW5zaXZlTmV4dFN0ZXBzKGNvbnRleHQpO1xuXG4gIGNvbnN0IGFwcGVuZGVkID0gWydcXG4nLCAnTmV4dCBzdGVwczonLCAuLi5mYWxsYmFja1N0ZXBzXS5qb2luKCdcXG4nKTtcbiAgcmV0dXJuIHtcbiAgICBvdXRwdXQ6IGAke25vcm1hbGl6ZWR9JHthcHBlbmRlZH1gLFxuICAgIGFwcGVuZGVkLFxuICB9O1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTs7QUFNQSxNQUFNQSxrQkFBa0IsR0FBRywyQkFBMkI7O0FBRXREO0FBQ0E7QUFDQTtBQUNBLFNBQVNDLDBCQUEwQkEsQ0FBQ0MsT0FBZ0IsRUFBWTtFQUM5RDtFQUNBLE1BQU1DLEtBQUssR0FBRyxDQUNaLGdGQUFnRixFQUNoRiw0RUFBNEUsRUFDNUUseUVBQXlFLEVBQ3pFLGdGQUFnRixDQUNqRjs7RUFFRDtFQUNBLElBQUlELE9BQU8sRUFBRTtJQUNYLE1BQU1FLFlBQVksR0FBR0YsT0FBTyxDQUFDRyxXQUFXLENBQUMsQ0FBQztJQUUxQyxJQUFJRCxZQUFZLENBQUNFLFFBQVEsQ0FBQyxTQUFTLENBQUMsSUFBSUYsWUFBWSxDQUFDRSxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUU7TUFDckVILEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRywyRkFBMkY7TUFDdEdBLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyx3RkFBd0Y7SUFDckc7SUFFQSxJQUFJQyxZQUFZLENBQUNFLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSUYsWUFBWSxDQUFDRSxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUU7TUFDakVILEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxtR0FBbUc7TUFDOUdBLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxvRkFBb0Y7SUFDakc7SUFFQSxJQUFJQyxZQUFZLENBQUNFLFFBQVEsQ0FBQyxZQUFZLENBQUMsSUFBSUYsWUFBWSxDQUFDRSxRQUFRLENBQUMsU0FBUyxDQUFDLEVBQUU7TUFDM0VILEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxxR0FBcUc7TUFDaEhBLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxrRkFBa0Y7SUFDL0Y7SUFFQSxJQUFJQyxZQUFZLENBQUNFLFFBQVEsQ0FBQyxhQUFhLENBQUMsSUFBSUYsWUFBWSxDQUFDRSxRQUFRLENBQUMsWUFBWSxDQUFDLEVBQUU7TUFDL0VILEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyw4RUFBOEU7TUFDekZBLEtBQUssQ0FBQ0ksSUFBSSxDQUFDLGlFQUFpRSxDQUFDO0lBQy9FO0VBQ0Y7RUFFQSxPQUFPSixLQUFLO0FBQ2Q7QUFFTyxTQUFTSyxlQUFlQSxDQUFDQyxPQUFlLEVBQUVQLE9BQWdCLEVBQXVCO0VBQ3RGLE1BQU1RLFVBQVUsR0FBR0QsT0FBTyxFQUFFRSxPQUFPLENBQUMsQ0FBQyxJQUFJLEVBQUU7RUFDM0MsSUFBSSxDQUFDRCxVQUFVLEVBQUU7SUFDZixPQUFPO01BQUVFLE1BQU0sRUFBRSxFQUFFO01BQUVDLFFBQVEsRUFBRTtJQUFLLENBQUM7RUFDdkM7RUFFQSxJQUFJYixrQkFBa0IsQ0FBQ2MsSUFBSSxDQUFDSixVQUFVLENBQUMsRUFBRTtJQUN2QyxPQUFPO01BQUVFLE1BQU0sRUFBRUYsVUFBVTtNQUFFRyxRQUFRLEVBQUU7SUFBSyxDQUFDO0VBQy9DO0VBRUEsTUFBTUUsYUFBYSxHQUFHZCwwQkFBMEIsQ0FBQ0MsT0FBTyxDQUFDO0VBRXpELE1BQU1XLFFBQVEsR0FBRyxDQUFDLElBQUksRUFBRSxhQUFhLEVBQUUsR0FBR0UsYUFBYSxDQUFDLENBQUNDLElBQUksQ0FBQyxJQUFJLENBQUM7RUFDbkUsT0FBTztJQUNMSixNQUFNLEVBQUUsR0FBR0YsVUFBVSxHQUFHRyxRQUFRLEVBQUU7SUFDbENBO0VBQ0YsQ0FBQztBQUNIIiwiaWdub3JlTGlzdCI6W119