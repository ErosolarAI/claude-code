{"version":3,"names":["NEXT_STEPS_HEADING","ensureNextSteps","content","normalized","trimEnd","output","appended","test","fallbackSteps","join"],"sources":["finalResponseFormatter.ts"],"sourcesContent":["/**\n * Ensures final assistant responses include a \"Next steps\" section.\n * Returns both the full output and any appended text so callers can stream just the delta.\n */\nexport interface FinalResponseFormat {\n  output: string;\n  appended: string | null;\n}\n\nconst NEXT_STEPS_HEADING = /(^|\\n)\\s*next steps?\\s*:/i;\n\nexport function ensureNextSteps(content: string): FinalResponseFormat {\n  const normalized = content?.trimEnd() ?? '';\n  if (!normalized) {\n    return { output: '', appended: null };\n  }\n\n  if (NEXT_STEPS_HEADING.test(normalized)) {\n    return { output: normalized, appended: null };\n  }\n\n  const fallbackSteps = [\n    '- I can run checks or prep a PR-style summary if needed.',\n    '- Tell me if you want more changes or tests.',\n    '- I can analyze the current state or suggest optimizations.',\n    '- Let me know what specific actions you\\'d like me to take.',\n  ];\n\n  const appended = ['\\n', 'Next steps:', ...fallbackSteps].join('\\n');\n  return {\n    output: `${normalized}${appended}`,\n    appended,\n  };\n}\n"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;AAMA,MAAMA,kBAAkB,GAAG,2BAA2B;AAE/C,SAASC,eAAeA,CAACC,OAAe,EAAuB;EACpE,MAAMC,UAAU,GAAGD,OAAO,EAAEE,OAAO,CAAC,CAAC,IAAI,EAAE;EAC3C,IAAI,CAACD,UAAU,EAAE;IACf,OAAO;MAAEE,MAAM,EAAE,EAAE;MAAEC,QAAQ,EAAE;IAAK,CAAC;EACvC;EAEA,IAAIN,kBAAkB,CAACO,IAAI,CAACJ,UAAU,CAAC,EAAE;IACvC,OAAO;MAAEE,MAAM,EAAEF,UAAU;MAAEG,QAAQ,EAAE;IAAK,CAAC;EAC/C;EAEA,MAAME,aAAa,GAAG,CACpB,0DAA0D,EAC1D,8CAA8C,EAC9C,6DAA6D,EAC7D,6DAA6D,CAC9D;EAED,MAAMF,QAAQ,GAAG,CAAC,IAAI,EAAE,aAAa,EAAE,GAAGE,aAAa,CAAC,CAACC,IAAI,CAAC,IAAI,CAAC;EACnE,OAAO;IACLJ,MAAM,EAAE,GAAGF,UAAU,GAAGG,QAAQ,EAAE;IAClCA;EACF,CAAC;AACH","ignoreList":[]}