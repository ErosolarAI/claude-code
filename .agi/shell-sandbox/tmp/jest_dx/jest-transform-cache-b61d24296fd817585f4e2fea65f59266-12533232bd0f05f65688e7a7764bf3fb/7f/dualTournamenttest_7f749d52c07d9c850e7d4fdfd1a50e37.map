{"version":3,"names":["_dualTournament","require","_repoUpgradeOrchestrator","describe","it","outcome","runDualTournament","id","goal","policyId","metrics","executionSuccess","testsPassed","staticAnalysis","signals","rewardModelScore","expect","ranked","toHaveLength","solo","humanAccuracy","toBe","aggregateScore","toBeGreaterThan","Object","keys","pairwise","orchestrator","RepoUpgradeOrchestrator","success","summary","score","def","REPO_UPGRADE_MODE_DEFINITIONS","primary","refiner","winnerVariant","pickWinner","top","bottom"],"sources":["dualTournament.test.ts"],"sourcesContent":["import { runDualTournament } from '../src/core/dualTournament.js';\nimport { RepoUpgradeOrchestrator, REPO_UPGRADE_MODE_DEFINITIONS, type UpgradeStepResult } from '../src/core/repoUpgradeOrchestrator.js';\n\ndescribe('dualTournament engine', () => {\n  it('uses fast path for single candidate with human accuracy = 1', () => {\n    const outcome = runDualTournament(\n      { id: 't1', goal: 'single candidate fast path' },\n      [\n        {\n          id: 'primary',\n          policyId: 'primary',\n          metrics: { executionSuccess: 1, testsPassed: 1, staticAnalysis: 1 },\n          signals: { rewardModelScore: 0.8 },\n        },\n      ]\n    );\n\n    expect(outcome.ranked).toHaveLength(1);\n    const solo = outcome.ranked[0]!;\n    expect(solo.humanAccuracy).toBe(1);\n    expect(solo.aggregateScore).toBeGreaterThan(0.5);\n    expect(Object.keys(outcome.pairwise)).toHaveLength(0);\n  });\n\n  it('prefers higher human accuracy when scores are tied', () => {\n    const orchestrator = new RepoUpgradeOrchestrator(async () => ({\n      success: true,\n      summary: 'noop',\n      score: 0,\n    }));\n    const def = REPO_UPGRADE_MODE_DEFINITIONS['dual-rl-tournament'];\n\n    const primary: UpgradeStepResult = {\n      success: true,\n      summary: 'p',\n      score: 0.5,\n      humanAccuracy: 0.2,\n    };\n    const refiner: UpgradeStepResult = {\n      success: true,\n      summary: 'r',\n      score: 0.5,\n      humanAccuracy: 0.9,\n    };\n\n    // @ts-expect-error - access private helper for targeted tie-break test\n    const { winnerVariant } = (orchestrator as unknown as { pickWinner: typeof orchestrator['pickWinner'] }).pickWinner(\n      def,\n      primary,\n      refiner\n    );\n\n    expect(winnerVariant).toBe('refiner');\n  });\n\n  it('assigns descending human accuracy across ranked candidates', () => {\n    const outcome = runDualTournament(\n      { id: 't2', goal: 'rank accuracy' },\n      [\n        { id: 'p', policyId: 'p', metrics: { executionSuccess: 1, testsPassed: 1 }, signals: { rewardModelScore: 0.8 } },\n        { id: 'r', policyId: 'r', metrics: { executionSuccess: 0.2, testsPassed: 0 }, signals: { rewardModelScore: 0.2 } },\n      ]\n    );\n\n    const [top, bottom] = outcome.ranked;\n    expect(top.humanAccuracy).toBe(1);\n    expect(bottom.humanAccuracy).toBe(0);\n    expect(top.aggregateScore).toBeGreaterThan(bottom.aggregateScore);\n  });\n});\n"],"mappings":"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","ignoreList":[]}