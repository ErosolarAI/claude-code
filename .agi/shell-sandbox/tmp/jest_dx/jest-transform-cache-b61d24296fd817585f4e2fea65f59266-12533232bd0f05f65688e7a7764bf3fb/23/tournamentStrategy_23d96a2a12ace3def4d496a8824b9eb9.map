{"version":3,"names":["_dualTournament","require","cloneWeights","weights","isTestHeavy","module","label","toLowerCase","includes","scope","some","s","buildEvaluatorConfig","telemetry","rewardWeights","DEFAULT_HUMAN_REWARD_WEIGHTS","evaluators","id","weight","alpha","Math","max","hard","find","e","key","snapshot","get","winsPrimary","winsRefiner","min","beta","quality"],"sources":["tournamentStrategy.ts"],"sourcesContent":["import {\n  DEFAULT_HUMAN_REWARD_WEIGHTS,\n  type HumanRewardWeights,\n  type TournamentEvaluator,\n} from './dualTournament.js';\nimport type { RepoUpgradeModule } from './repoUpgradeOrchestrator.js';\n\nexport interface TelemetrySnapshot {\n  winsPrimary: number;\n  winsRefiner: number;\n}\n\nexport interface EvaluatorConfig {\n  rewardWeights: HumanRewardWeights;\n  evaluators: TournamentEvaluator[];\n}\n\nfunction cloneWeights(weights: HumanRewardWeights): HumanRewardWeights {\n  return { ...weights };\n}\n\nfunction isTestHeavy(module: RepoUpgradeModule): boolean {\n  return module.label.toLowerCase().includes('test') || module.scope.some((s) => s.includes('test'));\n}\n\nexport function buildEvaluatorConfig(\n  module: RepoUpgradeModule,\n  telemetry?: Map<string, TelemetrySnapshot>\n): EvaluatorConfig {\n  const rewardWeights = cloneWeights(DEFAULT_HUMAN_REWARD_WEIGHTS);\n  const evaluators: TournamentEvaluator[] = [\n    { id: 'hard-metrics', weight: 1.2 },\n    { id: 'quality', weight: 1.0 },\n    { id: 'reward-model', weight: 1.0 },\n  ];\n\n  // Emphasize correctness for test-heavy modules\n  if (isTestHeavy(module)) {\n    rewardWeights.alpha = Math.max(rewardWeights.alpha, 0.7);\n    const hard = evaluators.find((e) => e.id === 'hard-metrics');\n    if (hard) hard.weight = Math.max(hard.weight ?? 1, 1.8);\n  }\n\n  // Apply telemetry bias\n  const key = module.label.toLowerCase().includes('test') ? 'tests' : 'general';\n  const snapshot = telemetry?.get(key);\n  if (snapshot) {\n    if (snapshot.winsPrimary > snapshot.winsRefiner) {\n      rewardWeights.alpha = Math.min(0.85, rewardWeights.alpha + 0.05);\n      const hard = evaluators.find((e) => e.id === 'hard-metrics');\n      if (hard) hard.weight = (hard.weight ?? 1) + 0.4;\n    } else if (snapshot.winsRefiner > snapshot.winsPrimary) {\n      rewardWeights.beta = Math.max(0.3, rewardWeights.beta + 0.05);\n      const quality = evaluators.find((e) => e.id === 'quality');\n      if (quality) quality.weight = (quality.weight ?? 1) + 0.2;\n    }\n  }\n\n  return { rewardWeights, evaluators };\n}\n"],"mappings":";;;;;;AAAA,IAAAA,eAAA,GAAAC,OAAA;AAiBA,SAASC,YAAYA,CAACC,OAA2B,EAAsB;EACrE,OAAO;IAAE,GAAGA;EAAQ,CAAC;AACvB;AAEA,SAASC,WAAWA,CAACC,MAAyB,EAAW;EACvD,OAAOA,MAAM,CAACC,KAAK,CAACC,WAAW,CAAC,CAAC,CAACC,QAAQ,CAAC,MAAM,CAAC,IAAIH,MAAM,CAACI,KAAK,CAACC,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACH,QAAQ,CAAC,MAAM,CAAC,CAAC;AACpG;AAEO,SAASI,oBAAoBA,CAClCP,MAAyB,EACzBQ,SAA0C,EACzB;EACjB,MAAMC,aAAa,GAAGZ,YAAY,CAACa,4CAA4B,CAAC;EAChE,MAAMC,UAAiC,GAAG,CACxC;IAAEC,EAAE,EAAE,cAAc;IAAEC,MAAM,EAAE;EAAI,CAAC,EACnC;IAAED,EAAE,EAAE,SAAS;IAAEC,MAAM,EAAE;EAAI,CAAC,EAC9B;IAAED,EAAE,EAAE,cAAc;IAAEC,MAAM,EAAE;EAAI,CAAC,CACpC;;EAED;EACA,IAAId,WAAW,CAACC,MAAM,CAAC,EAAE;IACvBS,aAAa,CAACK,KAAK,GAAGC,IAAI,CAACC,GAAG,CAACP,aAAa,CAACK,KAAK,EAAE,GAAG,CAAC;IACxD,MAAMG,IAAI,GAAGN,UAAU,CAACO,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACP,EAAE,KAAK,cAAc,CAAC;IAC5D,IAAIK,IAAI,EAAEA,IAAI,CAACJ,MAAM,GAAGE,IAAI,CAACC,GAAG,CAACC,IAAI,CAACJ,MAAM,IAAI,CAAC,EAAE,GAAG,CAAC;EACzD;;EAEA;EACA,MAAMO,GAAG,GAAGpB,MAAM,CAACC,KAAK,CAACC,WAAW,CAAC,CAAC,CAACC,QAAQ,CAAC,MAAM,CAAC,GAAG,OAAO,GAAG,SAAS;EAC7E,MAAMkB,QAAQ,GAAGb,SAAS,EAAEc,GAAG,CAACF,GAAG,CAAC;EACpC,IAAIC,QAAQ,EAAE;IACZ,IAAIA,QAAQ,CAACE,WAAW,GAAGF,QAAQ,CAACG,WAAW,EAAE;MAC/Cf,aAAa,CAACK,KAAK,GAAGC,IAAI,CAACU,GAAG,CAAC,IAAI,EAAEhB,aAAa,CAACK,KAAK,GAAG,IAAI,CAAC;MAChE,MAAMG,IAAI,GAAGN,UAAU,CAACO,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACP,EAAE,KAAK,cAAc,CAAC;MAC5D,IAAIK,IAAI,EAAEA,IAAI,CAACJ,MAAM,GAAG,CAACI,IAAI,CAACJ,MAAM,IAAI,CAAC,IAAI,GAAG;IAClD,CAAC,MAAM,IAAIQ,QAAQ,CAACG,WAAW,GAAGH,QAAQ,CAACE,WAAW,EAAE;MACtDd,aAAa,CAACiB,IAAI,GAAGX,IAAI,CAACC,GAAG,CAAC,GAAG,EAAEP,aAAa,CAACiB,IAAI,GAAG,IAAI,CAAC;MAC7D,MAAMC,OAAO,GAAGhB,UAAU,CAACO,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACP,EAAE,KAAK,SAAS,CAAC;MAC1D,IAAIe,OAAO,EAAEA,OAAO,CAACd,MAAM,GAAG,CAACc,OAAO,CAACd,MAAM,IAAI,CAAC,IAAI,GAAG;IAC3D;EACF;EAEA,OAAO;IAAEJ,aAAa;IAAEE;EAAW,CAAC;AACtC","ignoreList":[]}