880e0e0edfef5239593820de727d31a7
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.DEFAULT_HUMAN_REWARD_WEIGHTS = void 0;
exports.runDualTournament = runDualTournament;
/**
 * Dual Tournament Engine
 *
 * Shared scoring/ranking utilities used by dual tournaments in both /upgrade and /attack flows.
 * Encodes policy vs evaluator tournaments with human-like reward heuristics and multi-evaluator
 * aggregation to approximate human code review preferences.
 */

const DEFAULT_HUMAN_REWARD_WEIGHTS = exports.DEFAULT_HUMAN_REWARD_WEIGHTS = {
  alpha: 0.6,
  beta: 0.25,
  gamma: 0.15
};
/**
  * Run a dual tournament over candidate patches/agents, combining hard metrics,
  * human-like reward heuristics, and evaluator rankings.
  */
function runDualTournament(task, candidates, options = {}) {
  const maxCandidates = options.maxCandidates ?? 8;
  const boundedCandidates = candidates.slice(0, Math.max(1, maxCandidates));

  // Fast path: single candidate - avoid unnecessary aggregation work
  if (boundedCandidates.length === 1) {
    const solo = boundedCandidates[0];
    const correctness = scoreCorrectness(solo.metrics);
    const quality = scoreQuality(solo.metrics, options.preferSmallerDiff ?? true);
    const learned = scoreLearnedSignals(solo.signals);
    const aggregateScore = combineReward(correctness, quality, learned, options.rewardWeights ?? DEFAULT_HUMAN_REWARD_WEIGHTS);
    const ranked = [{
      candidateId: solo.id,
      aggregateScore,
      humanAccuracy: 1,
      rank: 1,
      correctnessScore: correctness,
      qualityScore: quality,
      learnedScore: learned,
      evaluatorScore: aggregateScore
    }];
    return {
      task,
      ranked,
      pairwise: {},
      evaluatorBreakdown: {}
    };
  }
  const rewardWeights = options.rewardWeights ?? DEFAULT_HUMAN_REWARD_WEIGHTS;
  const evaluatorWeights = new Map();
  for (const evaluator of options.evaluators ?? []) {
    const eloWeight = evaluator.elo ? 1 + Math.max(0, (evaluator.elo - 1200) / 2400) : 1;
    evaluatorWeights.set(evaluator.id, (evaluator.weight ?? 1) * eloWeight);
  }

  // Compute evaluator aggregates and pairwise wins first (needed for composite score)
  const {
    aggregatedEvaluatorScores,
    pairwise,
    evaluatorBreakdown
  } = aggregateEvaluatorScores(boundedCandidates, evaluatorWeights);
  const ranked = boundedCandidates.map(candidate => {
    const correctness = scoreCorrectness(candidate.metrics);
    const quality = scoreQuality(candidate.metrics, options.preferSmallerDiff ?? true);
    const learned = scoreLearnedSignals(candidate.signals);
    const rewardScore = combineReward(correctness, quality, learned, rewardWeights);
    const evaluatorScore = aggregatedEvaluatorScores.get(candidate.id) ?? rewardScore;

    // Combine human-like reward with evaluator aggregate (relative preference)
    const aggregateScore = clamp(0.55 * rewardScore + 0.45 * evaluatorScore);
    return {
      candidateId: candidate.id,
      aggregateScore,
      humanAccuracy: 0,
      rank: 0,
      // set after sorting
      correctnessScore: correctness,
      qualityScore: quality,
      learnedScore: learned,
      evaluatorScore
    };
  });
  ranked.sort((a, b) => b.aggregateScore - a.aggregateScore);
  ranked.forEach((entry, idx) => {
    entry.rank = idx + 1;
    entry.humanAccuracy = computeHumanAccuracy(idx, ranked.length);
  });
  return {
    task,
    ranked,
    pairwise,
    evaluatorBreakdown
  };
}

// ════════════════════════════════════════════════════════════════════════════
// Internal scoring helpers
// ════════════════════════════════════════════════════════════════════════════

function scoreCorrectness(metrics) {
  if (!metrics) return 0.5;
  const execution = metrics.executionSuccess ?? 0;
  const tests = metrics.testsPassed ?? 0;
  const failures = metrics.testsFailed ?? 0;
  const toolSuccess = metrics.toolSuccesses ? Math.min(1, metrics.toolSuccesses / 3) : 0;
  let score = execution * 0.35 + tests * 0.45 + toolSuccess * 0.2;
  if (failures > 0) {
    score -= Math.min(0.35, failures * 0.1);
  }
  return clamp(score);
}
function scoreQuality(metrics, preferSmallerDiff = true) {
  if (!metrics) return 0.5;
  const staticAnalysis = metrics.staticAnalysis ?? 0.5;
  const codeQuality = metrics.codeQuality ?? 0.5;
  const complexityComponent = typeof metrics.complexityDelta === 'number' ? metrics.complexityDelta < 0 ? 0.7 : 0.45 : 0.55;
  const blastRadius = metrics.blastRadius ?? (preferSmallerDiff && metrics.diffSize ? 1 - clamp(metrics.diffSize / 500) : 0.55);
  const dependencyPenalty = metrics.dependenciesAdded ? Math.min(0.3, metrics.dependenciesAdded * 0.05) : 0;
  const warningPenalty = metrics.warnings ? Math.min(0.2, metrics.warnings * 0.05) : 0;
  let score = staticAnalysis * 0.35 + codeQuality * 0.25 + blastRadius * 0.25 + complexityComponent * 0.15;
  score -= dependencyPenalty + warningPenalty;
  return clamp(score);
}
function scoreLearnedSignals(signals) {
  if (!signals) return 0.5;
  const rewardModel = signals.rewardModelScore;
  const human = signals.humanPreference;
  const self = signals.selfAssessment;
  const base = typeof rewardModel === 'number' ? rewardModel : 0.5;
  const blendedHuman = typeof human === 'number' ? (base + human) / 2 : base;
  const withSelf = typeof self === 'number' ? 0.7 * blendedHuman + 0.3 * self : blendedHuman;
  return clamp(withSelf);
}
function combineReward(correctness, quality, learned, weights) {
  const weighted = weights.alpha * correctness + weights.beta * quality + weights.gamma * learned;
  const total = weights.alpha + weights.beta + weights.gamma;
  return total > 0 ? clamp(weighted / total) : clamp(weighted);
}
function aggregateEvaluatorScores(candidates, evaluatorWeights) {
  const pairwise = {};
  const aggregated = new Map();
  const evaluatorBreakdown = {};
  if (candidates.length === 0) {
    return {
      aggregatedEvaluatorScores: aggregated,
      pairwise,
      evaluatorBreakdown
    };
  }

  // Pre-size for small tournaments to avoid unnecessary O(n^2) when not needed
  const twoCandidateFastPath = candidates.length <= 2;
  const candidateIds = candidates.map(c => c.id);
  for (const id of candidateIds) {
    pairwise[id] = {};
    for (const other of candidateIds) {
      if (id !== other) pairwise[id][other] = 0;
    }
  }

  // Collect scores per evaluator
  const scoresByEvaluator = new Map();
  for (const candidate of candidates) {
    for (const score of candidate.evaluatorScores ?? []) {
      if (!scoresByEvaluator.has(score.evaluatorId)) {
        scoresByEvaluator.set(score.evaluatorId, []);
      }
      scoresByEvaluator.get(score.evaluatorId).push({
        evaluatorId: score.evaluatorId,
        score: clamp(score.score),
        weight: score.weight,
        notes: score.notes,
        candidateId: candidate.id
      });
    }
  }

  // If no evaluator scores provided, fall back to neutral rankings
  if (scoresByEvaluator.size === 0) {
    const fallback = [];
    for (const candidate of candidates) {
      fallback.push({
        evaluatorId: 'reward-fallback',
        score: 0.5,
        weight: 1,
        candidateId: candidate.id
      });
    }
    scoresByEvaluator.set('reward-fallback', fallback);
  }
  let totalBordaWeight = 0;
  for (const [evaluatorId, rawScores] of scoresByEvaluator.entries()) {
    const weight = evaluatorWeights.get(evaluatorId) ?? 1;
    totalBordaWeight += weight * Math.max(1, candidates.length - 1);

    // Sort descending by score to assign ranks (Borda)
    const ranked = rawScores.filter(entry => typeof entry.score === 'number').sort((a, b) => (b.score ?? 0) - (a.score ?? 0));
    evaluatorBreakdown[evaluatorId] = ranked.map(({
      candidateId: _candidateId,
      ...rest
    }) => rest);
    ranked.forEach((entry, idx) => {
      const candidateId = entry.candidateId;
      const bordaPoints = (candidates.length - idx - 1) * weight;
      aggregated.set(candidateId, (aggregated.get(candidateId) ?? 0) + bordaPoints);
    });

    // Pairwise wins for this evaluator (lightweight path for <=2 candidates)
    if (twoCandidateFastPath && ranked.length === 2) {
      const higher = ranked[0];
      const lower = ranked[1];
      if (higher.score === lower.score) {
        pairwise[higher.candidateId][lower.candidateId] += weight * 0.5;
        pairwise[lower.candidateId][higher.candidateId] += weight * 0.5;
      } else {
        pairwise[higher.candidateId][lower.candidateId] += weight;
      }
    } else {
      for (let i = 0; i < ranked.length; i++) {
        for (let j = i + 1; j < ranked.length; j++) {
          const higher = ranked[i];
          const lower = ranked[j];
          if (higher.score === lower.score) {
            pairwise[higher.candidateId][lower.candidateId] += weight * 0.5;
            pairwise[lower.candidateId][higher.candidateId] += weight * 0.5;
          } else {
            pairwise[higher.candidateId][lower.candidateId] += weight;
          }
        }
      }
    }
  }

  // Normalize aggregated Borda scores into [0,1]
  if (totalBordaWeight > 0) {
    for (const [candidateId, points] of aggregated.entries()) {
      aggregated.set(candidateId, clamp(points / totalBordaWeight));
    }
  }

  // Ensure every candidate has an entry
  for (const candidateId of candidateIds) {
    if (!aggregated.has(candidateId)) {
      aggregated.set(candidateId, 0.5);
    }
  }
  return {
    aggregatedEvaluatorScores: aggregated,
    pairwise,
    evaluatorBreakdown
  };
}
function clamp(value, min = 0, max = 1) {
  if (Number.isNaN(value)) return min;
  return Math.max(min, Math.min(max, value));
}
function computeHumanAccuracy(rankIndex, total) {
  if (total <= 1) return 1;
  const maxIndex = Math.max(1, total - 1);
  const relative = 1 - rankIndex / maxIndex;
  return clamp(relative);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJERUZBVUxUX0hVTUFOX1JFV0FSRF9XRUlHSFRTIiwiZXhwb3J0cyIsImFscGhhIiwiYmV0YSIsImdhbW1hIiwicnVuRHVhbFRvdXJuYW1lbnQiLCJ0YXNrIiwiY2FuZGlkYXRlcyIsIm9wdGlvbnMiLCJtYXhDYW5kaWRhdGVzIiwiYm91bmRlZENhbmRpZGF0ZXMiLCJzbGljZSIsIk1hdGgiLCJtYXgiLCJsZW5ndGgiLCJzb2xvIiwiY29ycmVjdG5lc3MiLCJzY29yZUNvcnJlY3RuZXNzIiwibWV0cmljcyIsInF1YWxpdHkiLCJzY29yZVF1YWxpdHkiLCJwcmVmZXJTbWFsbGVyRGlmZiIsImxlYXJuZWQiLCJzY29yZUxlYXJuZWRTaWduYWxzIiwic2lnbmFscyIsImFnZ3JlZ2F0ZVNjb3JlIiwiY29tYmluZVJld2FyZCIsInJld2FyZFdlaWdodHMiLCJyYW5rZWQiLCJjYW5kaWRhdGVJZCIsImlkIiwiaHVtYW5BY2N1cmFjeSIsInJhbmsiLCJjb3JyZWN0bmVzc1Njb3JlIiwicXVhbGl0eVNjb3JlIiwibGVhcm5lZFNjb3JlIiwiZXZhbHVhdG9yU2NvcmUiLCJwYWlyd2lzZSIsImV2YWx1YXRvckJyZWFrZG93biIsImV2YWx1YXRvcldlaWdodHMiLCJNYXAiLCJldmFsdWF0b3IiLCJldmFsdWF0b3JzIiwiZWxvV2VpZ2h0IiwiZWxvIiwic2V0Iiwid2VpZ2h0IiwiYWdncmVnYXRlZEV2YWx1YXRvclNjb3JlcyIsImFnZ3JlZ2F0ZUV2YWx1YXRvclNjb3JlcyIsIm1hcCIsImNhbmRpZGF0ZSIsInJld2FyZFNjb3JlIiwiZ2V0IiwiY2xhbXAiLCJzb3J0IiwiYSIsImIiLCJmb3JFYWNoIiwiZW50cnkiLCJpZHgiLCJjb21wdXRlSHVtYW5BY2N1cmFjeSIsImV4ZWN1dGlvbiIsImV4ZWN1dGlvblN1Y2Nlc3MiLCJ0ZXN0cyIsInRlc3RzUGFzc2VkIiwiZmFpbHVyZXMiLCJ0ZXN0c0ZhaWxlZCIsInRvb2xTdWNjZXNzIiwidG9vbFN1Y2Nlc3NlcyIsIm1pbiIsInNjb3JlIiwic3RhdGljQW5hbHlzaXMiLCJjb2RlUXVhbGl0eSIsImNvbXBsZXhpdHlDb21wb25lbnQiLCJjb21wbGV4aXR5RGVsdGEiLCJibGFzdFJhZGl1cyIsImRpZmZTaXplIiwiZGVwZW5kZW5jeVBlbmFsdHkiLCJkZXBlbmRlbmNpZXNBZGRlZCIsIndhcm5pbmdQZW5hbHR5Iiwid2FybmluZ3MiLCJyZXdhcmRNb2RlbCIsInJld2FyZE1vZGVsU2NvcmUiLCJodW1hbiIsImh1bWFuUHJlZmVyZW5jZSIsInNlbGYiLCJzZWxmQXNzZXNzbWVudCIsImJhc2UiLCJibGVuZGVkSHVtYW4iLCJ3aXRoU2VsZiIsIndlaWdodHMiLCJ3ZWlnaHRlZCIsInRvdGFsIiwiYWdncmVnYXRlZCIsInR3b0NhbmRpZGF0ZUZhc3RQYXRoIiwiY2FuZGlkYXRlSWRzIiwiYyIsIm90aGVyIiwic2NvcmVzQnlFdmFsdWF0b3IiLCJldmFsdWF0b3JTY29yZXMiLCJoYXMiLCJldmFsdWF0b3JJZCIsInB1c2giLCJub3RlcyIsInNpemUiLCJmYWxsYmFjayIsInRvdGFsQm9yZGFXZWlnaHQiLCJyYXdTY29yZXMiLCJlbnRyaWVzIiwiZmlsdGVyIiwiX2NhbmRpZGF0ZUlkIiwicmVzdCIsImJvcmRhUG9pbnRzIiwiaGlnaGVyIiwibG93ZXIiLCJpIiwiaiIsInBvaW50cyIsInZhbHVlIiwiTnVtYmVyIiwiaXNOYU4iLCJyYW5rSW5kZXgiLCJtYXhJbmRleCIsInJlbGF0aXZlIl0sInNvdXJjZXMiOlsiZHVhbFRvdXJuYW1lbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBEdWFsIFRvdXJuYW1lbnQgRW5naW5lXG4gKlxuICogU2hhcmVkIHNjb3JpbmcvcmFua2luZyB1dGlsaXRpZXMgdXNlZCBieSBkdWFsIHRvdXJuYW1lbnRzIGluIGJvdGggL3VwZ3JhZGUgYW5kIC9hdHRhY2sgZmxvd3MuXG4gKiBFbmNvZGVzIHBvbGljeSB2cyBldmFsdWF0b3IgdG91cm5hbWVudHMgd2l0aCBodW1hbi1saWtlIHJld2FyZCBoZXVyaXN0aWNzIGFuZCBtdWx0aS1ldmFsdWF0b3JcbiAqIGFnZ3JlZ2F0aW9uIHRvIGFwcHJveGltYXRlIGh1bWFuIGNvZGUgcmV2aWV3IHByZWZlcmVuY2VzLlxuICovXG5cbmV4cG9ydCB0eXBlIFBvbGljeUlkID0gc3RyaW5nO1xuXG5leHBvcnQgaW50ZXJmYWNlIFRvdXJuYW1lbnRQb2xpY3kge1xuICBpZDogUG9saWN5SWQ7XG4gIGxhYmVsPzogc3RyaW5nO1xuICBraW5kPzogJ3ByaW1hcnknIHwgJ3JlZmluZXInIHwgJ2NoZWNrcG9pbnQnIHwgJ2F0dGFjayc7XG4gIGVsbz86IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUb3VybmFtZW50RXZhbHVhdG9yIHtcbiAgaWQ6IHN0cmluZztcbiAgbGFiZWw/OiBzdHJpbmc7XG4gIC8qKiBXZWlnaHQgdXNlZCB3aGVuIGNvbWJpbmluZyBldmFsdWF0b3IgcmFua2luZ3MgKGNhbiBiZSBpbmZsdWVuY2VkIGJ5IGhpc3RvcmljYWwgRUxPKS4gKi9cbiAgd2VpZ2h0PzogbnVtYmVyO1xuICBraW5kPzogJ2hhcmQnIHwgJ3NvZnQnIHwgJ2h5YnJpZCc7XG4gIGVsbz86IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUb3VybmFtZW50VGFzayB7XG4gIGlkOiBzdHJpbmc7XG4gIGdvYWw6IHN0cmluZztcbiAgcmVwb1NuYXBzaG90Pzogc3RyaW5nO1xuICB0ZXN0cz86IHN0cmluZ1tdO1xuICBjb25zdHJhaW50cz86IHN0cmluZ1tdO1xuICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENhbmRpZGF0ZU1ldHJpY3Mge1xuICBleGVjdXRpb25TdWNjZXNzPzogbnVtYmVyOyAvLyAwLTFcbiAgdGVzdHNQYXNzZWQ/OiBudW1iZXI7IC8vIDAtMVxuICB0ZXN0c0ZhaWxlZD86IG51bWJlcjsgLy8gY291bnRcbiAgc3RhdGljQW5hbHlzaXM/OiBudW1iZXI7IC8vIDAtMVxuICBjb2RlUXVhbGl0eT86IG51bWJlcjsgLy8gMC0xXG4gIGJsYXN0UmFkaXVzPzogbnVtYmVyOyAvLyAwLTEgKHNtYWxsZXIgZGlmZiA9PiBoaWdoZXIpXG4gIGRpZmZTaXplPzogbnVtYmVyOyAvLyBsaW5lcyBjaGFuZ2VkXG4gIGNvbXBsZXhpdHlEZWx0YT86IG51bWJlcjsgLy8gbmVnYXRpdmUgYmV0dGVyXG4gIGRlcGVuZGVuY2llc0FkZGVkPzogbnVtYmVyOyAvLyBjb3VudFxuICBzcGVlZEJvbnVzPzogbnVtYmVyOyAvLyAwLTFcbiAgdG9vbFN1Y2Nlc3Nlcz86IG51bWJlcjsgLy8gY291bnRcbiAgdG9vbEZhaWx1cmVzPzogbnVtYmVyOyAvLyBjb3VudFxuICB3YXJuaW5ncz86IG51bWJlcjsgLy8gY291bnRcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDYW5kaWRhdGVTaWduYWxzIHtcbiAgLyoqIExlYXJuZWQgcmV3YXJkIG1vZGVsIC8gcHJlZmVyZW5jZSBzY29yZSAoMC0xKSAqL1xuICByZXdhcmRNb2RlbFNjb3JlPzogbnVtYmVyO1xuICAvKiogU2VsZi1hc3Nlc3NlZCBjb25maWRlbmNlIGZyb20gdGhlIGFnZW50ICgwLTEpICovXG4gIHNlbGZBc3Nlc3NtZW50PzogbnVtYmVyO1xuICAvKiogT3B0aW9uYWwgaHVtYW4gcHJlZmVyZW5jZSBsYWJlbCAoMC0xKSAqL1xuICBodW1hblByZWZlcmVuY2U/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRXZhbHVhdG9yU2NvcmUge1xuICBldmFsdWF0b3JJZDogc3RyaW5nO1xuICBzY29yZTogbnVtYmVyO1xuICB3ZWlnaHQ/OiBudW1iZXI7XG4gIG5vdGVzPzogc3RyaW5nO1xufVxuXG50eXBlIENhbmRpZGF0ZUV2YWx1YXRvclNjb3JlID0gRXZhbHVhdG9yU2NvcmUgJiB7IGNhbmRpZGF0ZUlkOiBzdHJpbmcgfTtcblxuZXhwb3J0IGludGVyZmFjZSBUb3VybmFtZW50Q2FuZGlkYXRlIHtcbiAgaWQ6IHN0cmluZztcbiAgcG9saWN5SWQ6IFBvbGljeUlkO1xuICBwYXRjaFN1bW1hcnk/OiBzdHJpbmc7XG4gIGRpZmZTdW1tYXJ5Pzogc3RyaW5nO1xuICBtZXRyaWNzPzogQ2FuZGlkYXRlTWV0cmljcztcbiAgc2lnbmFscz86IENhbmRpZGF0ZVNpZ25hbHM7XG4gIGV2YWx1YXRvclNjb3Jlcz86IEV2YWx1YXRvclNjb3JlW107XG4gIHJhd091dHB1dD86IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBIdW1hblJld2FyZFdlaWdodHMge1xuICAvKiogQ29ycmVjdG5lc3Mgd2VpZ2h0ICovXG4gIGFscGhhOiBudW1iZXI7XG4gIC8qKiBDb2RlIHF1YWxpdHkgLyByb2J1c3RuZXNzIHdlaWdodCAqL1xuICBiZXRhOiBudW1iZXI7XG4gIC8qKiBMZWFybmVkIHJld2FyZCAvIGh1bWFuIHByZWZlcmVuY2Ugd2VpZ2h0ICovXG4gIGdhbW1hOiBudW1iZXI7XG59XG5cbmV4cG9ydCBjb25zdCBERUZBVUxUX0hVTUFOX1JFV0FSRF9XRUlHSFRTOiBIdW1hblJld2FyZFdlaWdodHMgPSB7XG4gIGFscGhhOiAwLjYsXG4gIGJldGE6IDAuMjUsXG4gIGdhbW1hOiAwLjE1LFxufTtcblxuZXhwb3J0IGludGVyZmFjZSBSYW5rZWRDYW5kaWRhdGUge1xuICBjYW5kaWRhdGVJZDogc3RyaW5nO1xuICBhZ2dyZWdhdGVTY29yZTogbnVtYmVyO1xuICAvKiogUmVsYXRpdmUgaHVtYW4tbGlrZSBhY2N1cmFjeSAoMSA9IGJlc3QgcmFuaywgMCA9IHdvcnN0IHJhbmspICovXG4gIGh1bWFuQWNjdXJhY3k6IG51bWJlcjtcbiAgcmFuazogbnVtYmVyO1xuICBjb3JyZWN0bmVzc1Njb3JlOiBudW1iZXI7XG4gIHF1YWxpdHlTY29yZTogbnVtYmVyO1xuICBsZWFybmVkU2NvcmU6IG51bWJlcjtcbiAgZXZhbHVhdG9yU2NvcmU6IG51bWJlcjtcbn1cblxuZXhwb3J0IHR5cGUgUGFpcndpc2VXaW5zID0gUmVjb3JkPHN0cmluZywgUmVjb3JkPHN0cmluZywgbnVtYmVyPj47XG5cbmV4cG9ydCBpbnRlcmZhY2UgVG91cm5hbWVudE91dGNvbWUge1xuICB0YXNrOiBUb3VybmFtZW50VGFzaztcbiAgcmFua2VkOiBSYW5rZWRDYW5kaWRhdGVbXTtcbiAgcGFpcndpc2U6IFBhaXJ3aXNlV2lucztcbiAgZXZhbHVhdG9yQnJlYWtkb3duOiBSZWNvcmQ8c3RyaW5nLCBFdmFsdWF0b3JTY29yZVtdPjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUb3VybmFtZW50T3B0aW9ucyB7XG4gIHJld2FyZFdlaWdodHM/OiBIdW1hblJld2FyZFdlaWdodHM7XG4gIGV2YWx1YXRvcnM/OiBUb3VybmFtZW50RXZhbHVhdG9yW107XG4gIC8qKiBXaGVuIHRydWUsIHByZWZlciBzbWFsbGVyIGRpZmZzIGJ5IGRlZmF1bHQgaWYgZGlmZlNpemUgaXMgcHJvdmlkZWQgKi9cbiAgcHJlZmVyU21hbGxlckRpZmY/OiBib29sZWFuO1xuICAvKiogTWF4aW11bSBjYW5kaWRhdGVzIHRvIGV2YWx1YXRlIChjYXBzIE8obl4yKSB3b3JrKSAqL1xuICBtYXhDYW5kaWRhdGVzPzogbnVtYmVyO1xufVxuXG4vKipcbiAgKiBSdW4gYSBkdWFsIHRvdXJuYW1lbnQgb3ZlciBjYW5kaWRhdGUgcGF0Y2hlcy9hZ2VudHMsIGNvbWJpbmluZyBoYXJkIG1ldHJpY3MsXG4gICogaHVtYW4tbGlrZSByZXdhcmQgaGV1cmlzdGljcywgYW5kIGV2YWx1YXRvciByYW5raW5ncy5cbiAgKi9cbmV4cG9ydCBmdW5jdGlvbiBydW5EdWFsVG91cm5hbWVudChcbiAgdGFzazogVG91cm5hbWVudFRhc2ssXG4gIGNhbmRpZGF0ZXM6IFRvdXJuYW1lbnRDYW5kaWRhdGVbXSxcbiAgb3B0aW9uczogVG91cm5hbWVudE9wdGlvbnMgPSB7fVxuKTogVG91cm5hbWVudE91dGNvbWUge1xuICBjb25zdCBtYXhDYW5kaWRhdGVzID0gb3B0aW9ucy5tYXhDYW5kaWRhdGVzID8/IDg7XG4gIGNvbnN0IGJvdW5kZWRDYW5kaWRhdGVzID0gY2FuZGlkYXRlcy5zbGljZSgwLCBNYXRoLm1heCgxLCBtYXhDYW5kaWRhdGVzKSk7XG5cbiAgLy8gRmFzdCBwYXRoOiBzaW5nbGUgY2FuZGlkYXRlIC0gYXZvaWQgdW5uZWNlc3NhcnkgYWdncmVnYXRpb24gd29ya1xuICBpZiAoYm91bmRlZENhbmRpZGF0ZXMubGVuZ3RoID09PSAxKSB7XG4gICAgY29uc3Qgc29sbyA9IGJvdW5kZWRDYW5kaWRhdGVzWzBdITtcbiAgICBjb25zdCBjb3JyZWN0bmVzcyA9IHNjb3JlQ29ycmVjdG5lc3Moc29sby5tZXRyaWNzKTtcbiAgICBjb25zdCBxdWFsaXR5ID0gc2NvcmVRdWFsaXR5KHNvbG8ubWV0cmljcywgb3B0aW9ucy5wcmVmZXJTbWFsbGVyRGlmZiA/PyB0cnVlKTtcbiAgICBjb25zdCBsZWFybmVkID0gc2NvcmVMZWFybmVkU2lnbmFscyhzb2xvLnNpZ25hbHMpO1xuICAgIGNvbnN0IGFnZ3JlZ2F0ZVNjb3JlID0gY29tYmluZVJld2FyZChjb3JyZWN0bmVzcywgcXVhbGl0eSwgbGVhcm5lZCwgb3B0aW9ucy5yZXdhcmRXZWlnaHRzID8/IERFRkFVTFRfSFVNQU5fUkVXQVJEX1dFSUdIVFMpO1xuXG4gICAgY29uc3QgcmFua2VkOiBSYW5rZWRDYW5kaWRhdGVbXSA9IFt7XG4gICAgICBjYW5kaWRhdGVJZDogc29sby5pZCxcbiAgICAgIGFnZ3JlZ2F0ZVNjb3JlLFxuICAgICAgaHVtYW5BY2N1cmFjeTogMSxcbiAgICAgIHJhbms6IDEsXG4gICAgICBjb3JyZWN0bmVzc1Njb3JlOiBjb3JyZWN0bmVzcyxcbiAgICAgIHF1YWxpdHlTY29yZTogcXVhbGl0eSxcbiAgICAgIGxlYXJuZWRTY29yZTogbGVhcm5lZCxcbiAgICAgIGV2YWx1YXRvclNjb3JlOiBhZ2dyZWdhdGVTY29yZSxcbiAgICB9XTtcblxuICAgIHJldHVybiB7XG4gICAgICB0YXNrLFxuICAgICAgcmFua2VkLFxuICAgICAgcGFpcndpc2U6IHt9LFxuICAgICAgZXZhbHVhdG9yQnJlYWtkb3duOiB7fSxcbiAgICB9O1xuICB9XG5cbiAgY29uc3QgcmV3YXJkV2VpZ2h0cyA9IG9wdGlvbnMucmV3YXJkV2VpZ2h0cyA/PyBERUZBVUxUX0hVTUFOX1JFV0FSRF9XRUlHSFRTO1xuICBjb25zdCBldmFsdWF0b3JXZWlnaHRzID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgZm9yIChjb25zdCBldmFsdWF0b3Igb2Ygb3B0aW9ucy5ldmFsdWF0b3JzID8/IFtdKSB7XG4gICAgY29uc3QgZWxvV2VpZ2h0ID0gZXZhbHVhdG9yLmVsbyA/IDEgKyBNYXRoLm1heCgwLCAoZXZhbHVhdG9yLmVsbyAtIDEyMDApIC8gMjQwMCkgOiAxO1xuICAgIGV2YWx1YXRvcldlaWdodHMuc2V0KGV2YWx1YXRvci5pZCwgKGV2YWx1YXRvci53ZWlnaHQgPz8gMSkgKiBlbG9XZWlnaHQpO1xuICB9XG5cbiAgLy8gQ29tcHV0ZSBldmFsdWF0b3IgYWdncmVnYXRlcyBhbmQgcGFpcndpc2Ugd2lucyBmaXJzdCAobmVlZGVkIGZvciBjb21wb3NpdGUgc2NvcmUpXG4gIGNvbnN0IHsgYWdncmVnYXRlZEV2YWx1YXRvclNjb3JlcywgcGFpcndpc2UsIGV2YWx1YXRvckJyZWFrZG93biB9ID0gYWdncmVnYXRlRXZhbHVhdG9yU2NvcmVzKFxuICAgIGJvdW5kZWRDYW5kaWRhdGVzLFxuICAgIGV2YWx1YXRvcldlaWdodHNcbiAgKTtcblxuICBjb25zdCByYW5rZWQ6IFJhbmtlZENhbmRpZGF0ZVtdID0gYm91bmRlZENhbmRpZGF0ZXMubWFwKChjYW5kaWRhdGUpID0+IHtcbiAgICBjb25zdCBjb3JyZWN0bmVzcyA9IHNjb3JlQ29ycmVjdG5lc3MoY2FuZGlkYXRlLm1ldHJpY3MpO1xuICAgIGNvbnN0IHF1YWxpdHkgPSBzY29yZVF1YWxpdHkoY2FuZGlkYXRlLm1ldHJpY3MsIG9wdGlvbnMucHJlZmVyU21hbGxlckRpZmYgPz8gdHJ1ZSk7XG4gICAgY29uc3QgbGVhcm5lZCA9IHNjb3JlTGVhcm5lZFNpZ25hbHMoY2FuZGlkYXRlLnNpZ25hbHMpO1xuICAgIGNvbnN0IHJld2FyZFNjb3JlID0gY29tYmluZVJld2FyZChjb3JyZWN0bmVzcywgcXVhbGl0eSwgbGVhcm5lZCwgcmV3YXJkV2VpZ2h0cyk7XG4gICAgY29uc3QgZXZhbHVhdG9yU2NvcmUgPSBhZ2dyZWdhdGVkRXZhbHVhdG9yU2NvcmVzLmdldChjYW5kaWRhdGUuaWQpID8/IHJld2FyZFNjb3JlO1xuXG4gICAgLy8gQ29tYmluZSBodW1hbi1saWtlIHJld2FyZCB3aXRoIGV2YWx1YXRvciBhZ2dyZWdhdGUgKHJlbGF0aXZlIHByZWZlcmVuY2UpXG4gICAgY29uc3QgYWdncmVnYXRlU2NvcmUgPSBjbGFtcCgwLjU1ICogcmV3YXJkU2NvcmUgKyAwLjQ1ICogZXZhbHVhdG9yU2NvcmUpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGNhbmRpZGF0ZUlkOiBjYW5kaWRhdGUuaWQsXG4gICAgICBhZ2dyZWdhdGVTY29yZSxcbiAgICAgIGh1bWFuQWNjdXJhY3k6IDAsXG4gICAgICByYW5rOiAwLCAvLyBzZXQgYWZ0ZXIgc29ydGluZ1xuICAgICAgY29ycmVjdG5lc3NTY29yZTogY29ycmVjdG5lc3MsXG4gICAgICBxdWFsaXR5U2NvcmU6IHF1YWxpdHksXG4gICAgICBsZWFybmVkU2NvcmU6IGxlYXJuZWQsXG4gICAgICBldmFsdWF0b3JTY29yZSxcbiAgICB9O1xuICB9KTtcblxuICByYW5rZWQuc29ydCgoYSwgYikgPT4gYi5hZ2dyZWdhdGVTY29yZSAtIGEuYWdncmVnYXRlU2NvcmUpO1xuICByYW5rZWQuZm9yRWFjaCgoZW50cnksIGlkeCkgPT4ge1xuICAgIGVudHJ5LnJhbmsgPSBpZHggKyAxO1xuICAgIGVudHJ5Lmh1bWFuQWNjdXJhY3kgPSBjb21wdXRlSHVtYW5BY2N1cmFjeShpZHgsIHJhbmtlZC5sZW5ndGgpO1xuICB9KTtcblxuICByZXR1cm4ge1xuICAgIHRhc2ssXG4gICAgcmFua2VkLFxuICAgIHBhaXJ3aXNlLFxuICAgIGV2YWx1YXRvckJyZWFrZG93bixcbiAgfTtcbn1cblxuLy8g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQXG4vLyBJbnRlcm5hbCBzY29yaW5nIGhlbHBlcnNcbi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxuXG5mdW5jdGlvbiBzY29yZUNvcnJlY3RuZXNzKG1ldHJpY3M/OiBDYW5kaWRhdGVNZXRyaWNzKTogbnVtYmVyIHtcbiAgaWYgKCFtZXRyaWNzKSByZXR1cm4gMC41O1xuXG4gIGNvbnN0IGV4ZWN1dGlvbiA9IG1ldHJpY3MuZXhlY3V0aW9uU3VjY2VzcyA/PyAwO1xuICBjb25zdCB0ZXN0cyA9IG1ldHJpY3MudGVzdHNQYXNzZWQgPz8gMDtcbiAgY29uc3QgZmFpbHVyZXMgPSBtZXRyaWNzLnRlc3RzRmFpbGVkID8/IDA7XG4gIGNvbnN0IHRvb2xTdWNjZXNzID0gbWV0cmljcy50b29sU3VjY2Vzc2VzID8gTWF0aC5taW4oMSwgbWV0cmljcy50b29sU3VjY2Vzc2VzIC8gMykgOiAwO1xuXG4gIGxldCBzY29yZSA9IGV4ZWN1dGlvbiAqIDAuMzUgKyB0ZXN0cyAqIDAuNDUgKyB0b29sU3VjY2VzcyAqIDAuMjtcbiAgaWYgKGZhaWx1cmVzID4gMCkge1xuICAgIHNjb3JlIC09IE1hdGgubWluKDAuMzUsIGZhaWx1cmVzICogMC4xKTtcbiAgfVxuXG4gIHJldHVybiBjbGFtcChzY29yZSk7XG59XG5cbmZ1bmN0aW9uIHNjb3JlUXVhbGl0eShtZXRyaWNzPzogQ2FuZGlkYXRlTWV0cmljcywgcHJlZmVyU21hbGxlckRpZmYgPSB0cnVlKTogbnVtYmVyIHtcbiAgaWYgKCFtZXRyaWNzKSByZXR1cm4gMC41O1xuXG4gIGNvbnN0IHN0YXRpY0FuYWx5c2lzID0gbWV0cmljcy5zdGF0aWNBbmFseXNpcyA/PyAwLjU7XG4gIGNvbnN0IGNvZGVRdWFsaXR5ID0gbWV0cmljcy5jb2RlUXVhbGl0eSA/PyAwLjU7XG4gIGNvbnN0IGNvbXBsZXhpdHlDb21wb25lbnQgPVxuICAgIHR5cGVvZiBtZXRyaWNzLmNvbXBsZXhpdHlEZWx0YSA9PT0gJ251bWJlcidcbiAgICAgID8gbWV0cmljcy5jb21wbGV4aXR5RGVsdGEgPCAwXG4gICAgICAgID8gMC43XG4gICAgICAgIDogMC40NVxuICAgICAgOiAwLjU1O1xuXG4gIGNvbnN0IGJsYXN0UmFkaXVzID1cbiAgICBtZXRyaWNzLmJsYXN0UmFkaXVzID8/XG4gICAgKHByZWZlclNtYWxsZXJEaWZmICYmIG1ldHJpY3MuZGlmZlNpemUgPyAxIC0gY2xhbXAobWV0cmljcy5kaWZmU2l6ZSAvIDUwMCkgOiAwLjU1KTtcblxuICBjb25zdCBkZXBlbmRlbmN5UGVuYWx0eSA9IG1ldHJpY3MuZGVwZW5kZW5jaWVzQWRkZWQgPyBNYXRoLm1pbigwLjMsIG1ldHJpY3MuZGVwZW5kZW5jaWVzQWRkZWQgKiAwLjA1KSA6IDA7XG4gIGNvbnN0IHdhcm5pbmdQZW5hbHR5ID0gbWV0cmljcy53YXJuaW5ncyA/IE1hdGgubWluKDAuMiwgbWV0cmljcy53YXJuaW5ncyAqIDAuMDUpIDogMDtcblxuICBsZXQgc2NvcmUgPSBzdGF0aWNBbmFseXNpcyAqIDAuMzUgKyBjb2RlUXVhbGl0eSAqIDAuMjUgKyBibGFzdFJhZGl1cyAqIDAuMjUgKyBjb21wbGV4aXR5Q29tcG9uZW50ICogMC4xNTtcbiAgc2NvcmUgLT0gZGVwZW5kZW5jeVBlbmFsdHkgKyB3YXJuaW5nUGVuYWx0eTtcblxuICByZXR1cm4gY2xhbXAoc2NvcmUpO1xufVxuXG5mdW5jdGlvbiBzY29yZUxlYXJuZWRTaWduYWxzKHNpZ25hbHM/OiBDYW5kaWRhdGVTaWduYWxzKTogbnVtYmVyIHtcbiAgaWYgKCFzaWduYWxzKSByZXR1cm4gMC41O1xuXG4gIGNvbnN0IHJld2FyZE1vZGVsID0gc2lnbmFscy5yZXdhcmRNb2RlbFNjb3JlO1xuICBjb25zdCBodW1hbiA9IHNpZ25hbHMuaHVtYW5QcmVmZXJlbmNlO1xuICBjb25zdCBzZWxmID0gc2lnbmFscy5zZWxmQXNzZXNzbWVudDtcblxuICBjb25zdCBiYXNlID0gdHlwZW9mIHJld2FyZE1vZGVsID09PSAnbnVtYmVyJyA/IHJld2FyZE1vZGVsIDogMC41O1xuICBjb25zdCBibGVuZGVkSHVtYW4gPSB0eXBlb2YgaHVtYW4gPT09ICdudW1iZXInID8gKGJhc2UgKyBodW1hbikgLyAyIDogYmFzZTtcbiAgY29uc3Qgd2l0aFNlbGYgPSB0eXBlb2Ygc2VsZiA9PT0gJ251bWJlcicgPyAwLjcgKiBibGVuZGVkSHVtYW4gKyAwLjMgKiBzZWxmIDogYmxlbmRlZEh1bWFuO1xuXG4gIHJldHVybiBjbGFtcCh3aXRoU2VsZik7XG59XG5cbmZ1bmN0aW9uIGNvbWJpbmVSZXdhcmQoXG4gIGNvcnJlY3RuZXNzOiBudW1iZXIsXG4gIHF1YWxpdHk6IG51bWJlcixcbiAgbGVhcm5lZDogbnVtYmVyLFxuICB3ZWlnaHRzOiBIdW1hblJld2FyZFdlaWdodHNcbik6IG51bWJlciB7XG4gIGNvbnN0IHdlaWdodGVkID1cbiAgICB3ZWlnaHRzLmFscGhhICogY29ycmVjdG5lc3MgK1xuICAgIHdlaWdodHMuYmV0YSAqIHF1YWxpdHkgK1xuICAgIHdlaWdodHMuZ2FtbWEgKiBsZWFybmVkO1xuICBjb25zdCB0b3RhbCA9IHdlaWdodHMuYWxwaGEgKyB3ZWlnaHRzLmJldGEgKyB3ZWlnaHRzLmdhbW1hO1xuICByZXR1cm4gdG90YWwgPiAwID8gY2xhbXAod2VpZ2h0ZWQgLyB0b3RhbCkgOiBjbGFtcCh3ZWlnaHRlZCk7XG59XG5cbmZ1bmN0aW9uIGFnZ3JlZ2F0ZUV2YWx1YXRvclNjb3JlcyhcbiAgY2FuZGlkYXRlczogVG91cm5hbWVudENhbmRpZGF0ZVtdLFxuICBldmFsdWF0b3JXZWlnaHRzOiBNYXA8c3RyaW5nLCBudW1iZXI+XG4pOiB7XG4gIGFnZ3JlZ2F0ZWRFdmFsdWF0b3JTY29yZXM6IE1hcDxzdHJpbmcsIG51bWJlcj47XG4gIHBhaXJ3aXNlOiBQYWlyd2lzZVdpbnM7XG4gIGV2YWx1YXRvckJyZWFrZG93bjogUmVjb3JkPHN0cmluZywgRXZhbHVhdG9yU2NvcmVbXT47XG59IHtcbiAgY29uc3QgcGFpcndpc2U6IFBhaXJ3aXNlV2lucyA9IHt9O1xuICBjb25zdCBhZ2dyZWdhdGVkID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgY29uc3QgZXZhbHVhdG9yQnJlYWtkb3duOiBSZWNvcmQ8c3RyaW5nLCBFdmFsdWF0b3JTY29yZVtdPiA9IHt9O1xuXG4gIGlmIChjYW5kaWRhdGVzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiB7IGFnZ3JlZ2F0ZWRFdmFsdWF0b3JTY29yZXM6IGFnZ3JlZ2F0ZWQsIHBhaXJ3aXNlLCBldmFsdWF0b3JCcmVha2Rvd24gfTtcbiAgfVxuXG4gIC8vIFByZS1zaXplIGZvciBzbWFsbCB0b3VybmFtZW50cyB0byBhdm9pZCB1bm5lY2Vzc2FyeSBPKG5eMikgd2hlbiBub3QgbmVlZGVkXG4gIGNvbnN0IHR3b0NhbmRpZGF0ZUZhc3RQYXRoID0gY2FuZGlkYXRlcy5sZW5ndGggPD0gMjtcblxuICBjb25zdCBjYW5kaWRhdGVJZHMgPSBjYW5kaWRhdGVzLm1hcCgoYykgPT4gYy5pZCk7XG4gIGZvciAoY29uc3QgaWQgb2YgY2FuZGlkYXRlSWRzKSB7XG4gICAgcGFpcndpc2VbaWRdID0ge307XG4gICAgZm9yIChjb25zdCBvdGhlciBvZiBjYW5kaWRhdGVJZHMpIHtcbiAgICAgIGlmIChpZCAhPT0gb3RoZXIpIHBhaXJ3aXNlW2lkXVtvdGhlcl0gPSAwO1xuICAgIH1cbiAgfVxuXG4gIC8vIENvbGxlY3Qgc2NvcmVzIHBlciBldmFsdWF0b3JcbiAgY29uc3Qgc2NvcmVzQnlFdmFsdWF0b3IgPSBuZXcgTWFwPHN0cmluZywgQ2FuZGlkYXRlRXZhbHVhdG9yU2NvcmVbXT4oKTtcbiAgZm9yIChjb25zdCBjYW5kaWRhdGUgb2YgY2FuZGlkYXRlcykge1xuICAgIGZvciAoY29uc3Qgc2NvcmUgb2YgY2FuZGlkYXRlLmV2YWx1YXRvclNjb3JlcyA/PyBbXSkge1xuICAgICAgaWYgKCFzY29yZXNCeUV2YWx1YXRvci5oYXMoc2NvcmUuZXZhbHVhdG9ySWQpKSB7XG4gICAgICAgIHNjb3Jlc0J5RXZhbHVhdG9yLnNldChzY29yZS5ldmFsdWF0b3JJZCwgW10pO1xuICAgICAgfVxuICAgICAgc2NvcmVzQnlFdmFsdWF0b3IuZ2V0KHNjb3JlLmV2YWx1YXRvcklkKSEucHVzaCh7XG4gICAgICAgIGV2YWx1YXRvcklkOiBzY29yZS5ldmFsdWF0b3JJZCxcbiAgICAgICAgc2NvcmU6IGNsYW1wKHNjb3JlLnNjb3JlKSxcbiAgICAgICAgd2VpZ2h0OiBzY29yZS53ZWlnaHQsXG4gICAgICAgIG5vdGVzOiBzY29yZS5ub3RlcyxcbiAgICAgICAgY2FuZGlkYXRlSWQ6IGNhbmRpZGF0ZS5pZCxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8vIElmIG5vIGV2YWx1YXRvciBzY29yZXMgcHJvdmlkZWQsIGZhbGwgYmFjayB0byBuZXV0cmFsIHJhbmtpbmdzXG4gIGlmIChzY29yZXNCeUV2YWx1YXRvci5zaXplID09PSAwKSB7XG4gICAgY29uc3QgZmFsbGJhY2s6IENhbmRpZGF0ZUV2YWx1YXRvclNjb3JlW10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IGNhbmRpZGF0ZSBvZiBjYW5kaWRhdGVzKSB7XG4gICAgICBmYWxsYmFjay5wdXNoKHtcbiAgICAgICAgZXZhbHVhdG9ySWQ6ICdyZXdhcmQtZmFsbGJhY2snLFxuICAgICAgICBzY29yZTogMC41LFxuICAgICAgICB3ZWlnaHQ6IDEsXG4gICAgICAgIGNhbmRpZGF0ZUlkOiBjYW5kaWRhdGUuaWQsXG4gICAgICB9KTtcbiAgICB9XG4gICAgc2NvcmVzQnlFdmFsdWF0b3Iuc2V0KCdyZXdhcmQtZmFsbGJhY2snLCBmYWxsYmFjayk7XG4gIH1cblxuICBsZXQgdG90YWxCb3JkYVdlaWdodCA9IDA7XG5cbiAgZm9yIChjb25zdCBbZXZhbHVhdG9ySWQsIHJhd1Njb3Jlc10gb2Ygc2NvcmVzQnlFdmFsdWF0b3IuZW50cmllcygpKSB7XG4gICAgY29uc3Qgd2VpZ2h0ID0gZXZhbHVhdG9yV2VpZ2h0cy5nZXQoZXZhbHVhdG9ySWQpID8/IDE7XG4gICAgdG90YWxCb3JkYVdlaWdodCArPSB3ZWlnaHQgKiBNYXRoLm1heCgxLCBjYW5kaWRhdGVzLmxlbmd0aCAtIDEpO1xuXG4gICAgLy8gU29ydCBkZXNjZW5kaW5nIGJ5IHNjb3JlIHRvIGFzc2lnbiByYW5rcyAoQm9yZGEpXG4gICAgY29uc3QgcmFua2VkID0gcmF3U2NvcmVzXG4gICAgICAuZmlsdGVyKChlbnRyeSkgPT4gdHlwZW9mIGVudHJ5LnNjb3JlID09PSAnbnVtYmVyJylcbiAgICAgIC5zb3J0KChhLCBiKSA9PiAoYi5zY29yZSA/PyAwKSAtIChhLnNjb3JlID8/IDApKTtcblxuICAgIGV2YWx1YXRvckJyZWFrZG93bltldmFsdWF0b3JJZF0gPSByYW5rZWQubWFwKCh7IGNhbmRpZGF0ZUlkOiBfY2FuZGlkYXRlSWQsIC4uLnJlc3QgfSkgPT4gcmVzdCBhcyBFdmFsdWF0b3JTY29yZSk7XG5cbiAgICByYW5rZWQuZm9yRWFjaCgoZW50cnksIGlkeCkgPT4ge1xuICAgICAgY29uc3QgY2FuZGlkYXRlSWQgPSAoZW50cnkgYXMgdW5rbm93biBhcyB7IGNhbmRpZGF0ZUlkOiBzdHJpbmcgfSkuY2FuZGlkYXRlSWQ7XG4gICAgICBjb25zdCBib3JkYVBvaW50cyA9IChjYW5kaWRhdGVzLmxlbmd0aCAtIGlkeCAtIDEpICogd2VpZ2h0O1xuICAgICAgYWdncmVnYXRlZC5zZXQoY2FuZGlkYXRlSWQsIChhZ2dyZWdhdGVkLmdldChjYW5kaWRhdGVJZCkgPz8gMCkgKyBib3JkYVBvaW50cyk7XG4gICAgfSk7XG5cbiAgICAvLyBQYWlyd2lzZSB3aW5zIGZvciB0aGlzIGV2YWx1YXRvciAobGlnaHR3ZWlnaHQgcGF0aCBmb3IgPD0yIGNhbmRpZGF0ZXMpXG4gICAgaWYgKHR3b0NhbmRpZGF0ZUZhc3RQYXRoICYmIHJhbmtlZC5sZW5ndGggPT09IDIpIHtcbiAgICAgIGNvbnN0IGhpZ2hlciA9IHJhbmtlZFswXSBhcyB1bmtub3duIGFzIHsgY2FuZGlkYXRlSWQ6IHN0cmluZzsgc2NvcmU6IG51bWJlciB9O1xuICAgICAgY29uc3QgbG93ZXIgPSByYW5rZWRbMV0gYXMgdW5rbm93biBhcyB7IGNhbmRpZGF0ZUlkOiBzdHJpbmc7IHNjb3JlOiBudW1iZXIgfTtcbiAgICAgIGlmIChoaWdoZXIuc2NvcmUgPT09IGxvd2VyLnNjb3JlKSB7XG4gICAgICAgIHBhaXJ3aXNlW2hpZ2hlci5jYW5kaWRhdGVJZF1bbG93ZXIuY2FuZGlkYXRlSWRdICs9IHdlaWdodCAqIDAuNTtcbiAgICAgICAgcGFpcndpc2VbbG93ZXIuY2FuZGlkYXRlSWRdW2hpZ2hlci5jYW5kaWRhdGVJZF0gKz0gd2VpZ2h0ICogMC41O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGFpcndpc2VbaGlnaGVyLmNhbmRpZGF0ZUlkXVtsb3dlci5jYW5kaWRhdGVJZF0gKz0gd2VpZ2h0O1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHJhbmtlZC5sZW5ndGg7IGkrKykge1xuICAgICAgICBmb3IgKGxldCBqID0gaSArIDE7IGogPCByYW5rZWQubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICBjb25zdCBoaWdoZXIgPSByYW5rZWRbaV0gYXMgdW5rbm93biBhcyB7IGNhbmRpZGF0ZUlkOiBzdHJpbmc7IHNjb3JlOiBudW1iZXIgfTtcbiAgICAgICAgICBjb25zdCBsb3dlciA9IHJhbmtlZFtqXSBhcyB1bmtub3duIGFzIHsgY2FuZGlkYXRlSWQ6IHN0cmluZzsgc2NvcmU6IG51bWJlciB9O1xuICAgICAgICAgIGlmIChoaWdoZXIuc2NvcmUgPT09IGxvd2VyLnNjb3JlKSB7XG4gICAgICAgICAgICBwYWlyd2lzZVtoaWdoZXIuY2FuZGlkYXRlSWRdW2xvd2VyLmNhbmRpZGF0ZUlkXSArPSB3ZWlnaHQgKiAwLjU7XG4gICAgICAgICAgICBwYWlyd2lzZVtsb3dlci5jYW5kaWRhdGVJZF1baGlnaGVyLmNhbmRpZGF0ZUlkXSArPSB3ZWlnaHQgKiAwLjU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHBhaXJ3aXNlW2hpZ2hlci5jYW5kaWRhdGVJZF1bbG93ZXIuY2FuZGlkYXRlSWRdICs9IHdlaWdodDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBOb3JtYWxpemUgYWdncmVnYXRlZCBCb3JkYSBzY29yZXMgaW50byBbMCwxXVxuICBpZiAodG90YWxCb3JkYVdlaWdodCA+IDApIHtcbiAgICBmb3IgKGNvbnN0IFtjYW5kaWRhdGVJZCwgcG9pbnRzXSBvZiBhZ2dyZWdhdGVkLmVudHJpZXMoKSkge1xuICAgICAgYWdncmVnYXRlZC5zZXQoY2FuZGlkYXRlSWQsIGNsYW1wKHBvaW50cyAvIHRvdGFsQm9yZGFXZWlnaHQpKTtcbiAgICB9XG4gIH1cblxuICAvLyBFbnN1cmUgZXZlcnkgY2FuZGlkYXRlIGhhcyBhbiBlbnRyeVxuICBmb3IgKGNvbnN0IGNhbmRpZGF0ZUlkIG9mIGNhbmRpZGF0ZUlkcykge1xuICAgIGlmICghYWdncmVnYXRlZC5oYXMoY2FuZGlkYXRlSWQpKSB7XG4gICAgICBhZ2dyZWdhdGVkLnNldChjYW5kaWRhdGVJZCwgMC41KTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4geyBhZ2dyZWdhdGVkRXZhbHVhdG9yU2NvcmVzOiBhZ2dyZWdhdGVkLCBwYWlyd2lzZSwgZXZhbHVhdG9yQnJlYWtkb3duIH07XG59XG5cbmZ1bmN0aW9uIGNsYW1wKHZhbHVlOiBudW1iZXIsIG1pbiA9IDAsIG1heCA9IDEpOiBudW1iZXIge1xuICBpZiAoTnVtYmVyLmlzTmFOKHZhbHVlKSkgcmV0dXJuIG1pbjtcbiAgcmV0dXJuIE1hdGgubWF4KG1pbiwgTWF0aC5taW4obWF4LCB2YWx1ZSkpO1xufVxuXG5mdW5jdGlvbiBjb21wdXRlSHVtYW5BY2N1cmFjeShyYW5rSW5kZXg6IG51bWJlciwgdG90YWw6IG51bWJlcik6IG51bWJlciB7XG4gIGlmICh0b3RhbCA8PSAxKSByZXR1cm4gMTtcbiAgY29uc3QgbWF4SW5kZXggPSBNYXRoLm1heCgxLCB0b3RhbCAtIDEpO1xuICBjb25zdCByZWxhdGl2ZSA9IDEgLSByYW5rSW5kZXggLyBtYXhJbmRleDtcbiAgcmV0dXJuIGNsYW1wKHJlbGF0aXZlKTtcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQW1GTyxNQUFNQSw0QkFBZ0QsR0FBQUMsT0FBQSxDQUFBRCw0QkFBQSxHQUFHO0VBQzlERSxLQUFLLEVBQUUsR0FBRztFQUNWQyxJQUFJLEVBQUUsSUFBSTtFQUNWQyxLQUFLLEVBQUU7QUFDVCxDQUFDO0FBZ0NEO0FBQ0E7QUFDQTtBQUNBO0FBQ08sU0FBU0MsaUJBQWlCQSxDQUMvQkMsSUFBb0IsRUFDcEJDLFVBQWlDLEVBQ2pDQyxPQUEwQixHQUFHLENBQUMsQ0FBQyxFQUNaO0VBQ25CLE1BQU1DLGFBQWEsR0FBR0QsT0FBTyxDQUFDQyxhQUFhLElBQUksQ0FBQztFQUNoRCxNQUFNQyxpQkFBaUIsR0FBR0gsVUFBVSxDQUFDSSxLQUFLLENBQUMsQ0FBQyxFQUFFQyxJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFDLEVBQUVKLGFBQWEsQ0FBQyxDQUFDOztFQUV6RTtFQUNBLElBQUlDLGlCQUFpQixDQUFDSSxNQUFNLEtBQUssQ0FBQyxFQUFFO0lBQ2xDLE1BQU1DLElBQUksR0FBR0wsaUJBQWlCLENBQUMsQ0FBQyxDQUFFO0lBQ2xDLE1BQU1NLFdBQVcsR0FBR0MsZ0JBQWdCLENBQUNGLElBQUksQ0FBQ0csT0FBTyxDQUFDO0lBQ2xELE1BQU1DLE9BQU8sR0FBR0MsWUFBWSxDQUFDTCxJQUFJLENBQUNHLE9BQU8sRUFBRVYsT0FBTyxDQUFDYSxpQkFBaUIsSUFBSSxJQUFJLENBQUM7SUFDN0UsTUFBTUMsT0FBTyxHQUFHQyxtQkFBbUIsQ0FBQ1IsSUFBSSxDQUFDUyxPQUFPLENBQUM7SUFDakQsTUFBTUMsY0FBYyxHQUFHQyxhQUFhLENBQUNWLFdBQVcsRUFBRUcsT0FBTyxFQUFFRyxPQUFPLEVBQUVkLE9BQU8sQ0FBQ21CLGFBQWEsSUFBSTNCLDRCQUE0QixDQUFDO0lBRTFILE1BQU00QixNQUF5QixHQUFHLENBQUM7TUFDakNDLFdBQVcsRUFBRWQsSUFBSSxDQUFDZSxFQUFFO01BQ3BCTCxjQUFjO01BQ2RNLGFBQWEsRUFBRSxDQUFDO01BQ2hCQyxJQUFJLEVBQUUsQ0FBQztNQUNQQyxnQkFBZ0IsRUFBRWpCLFdBQVc7TUFDN0JrQixZQUFZLEVBQUVmLE9BQU87TUFDckJnQixZQUFZLEVBQUViLE9BQU87TUFDckJjLGNBQWMsRUFBRVg7SUFDbEIsQ0FBQyxDQUFDO0lBRUYsT0FBTztNQUNMbkIsSUFBSTtNQUNKc0IsTUFBTTtNQUNOUyxRQUFRLEVBQUUsQ0FBQyxDQUFDO01BQ1pDLGtCQUFrQixFQUFFLENBQUM7SUFDdkIsQ0FBQztFQUNIO0VBRUEsTUFBTVgsYUFBYSxHQUFHbkIsT0FBTyxDQUFDbUIsYUFBYSxJQUFJM0IsNEJBQTRCO0VBQzNFLE1BQU11QyxnQkFBZ0IsR0FBRyxJQUFJQyxHQUFHLENBQWlCLENBQUM7RUFDbEQsS0FBSyxNQUFNQyxTQUFTLElBQUlqQyxPQUFPLENBQUNrQyxVQUFVLElBQUksRUFBRSxFQUFFO0lBQ2hELE1BQU1DLFNBQVMsR0FBR0YsU0FBUyxDQUFDRyxHQUFHLEdBQUcsQ0FBQyxHQUFHaEMsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUM0QixTQUFTLENBQUNHLEdBQUcsR0FBRyxJQUFJLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQztJQUNwRkwsZ0JBQWdCLENBQUNNLEdBQUcsQ0FBQ0osU0FBUyxDQUFDWCxFQUFFLEVBQUUsQ0FBQ1csU0FBUyxDQUFDSyxNQUFNLElBQUksQ0FBQyxJQUFJSCxTQUFTLENBQUM7RUFDekU7O0VBRUE7RUFDQSxNQUFNO0lBQUVJLHlCQUF5QjtJQUFFVixRQUFRO0lBQUVDO0VBQW1CLENBQUMsR0FBR1Usd0JBQXdCLENBQzFGdEMsaUJBQWlCLEVBQ2pCNkIsZ0JBQ0YsQ0FBQztFQUVELE1BQU1YLE1BQXlCLEdBQUdsQixpQkFBaUIsQ0FBQ3VDLEdBQUcsQ0FBRUMsU0FBUyxJQUFLO0lBQ3JFLE1BQU1sQyxXQUFXLEdBQUdDLGdCQUFnQixDQUFDaUMsU0FBUyxDQUFDaEMsT0FBTyxDQUFDO0lBQ3ZELE1BQU1DLE9BQU8sR0FBR0MsWUFBWSxDQUFDOEIsU0FBUyxDQUFDaEMsT0FBTyxFQUFFVixPQUFPLENBQUNhLGlCQUFpQixJQUFJLElBQUksQ0FBQztJQUNsRixNQUFNQyxPQUFPLEdBQUdDLG1CQUFtQixDQUFDMkIsU0FBUyxDQUFDMUIsT0FBTyxDQUFDO0lBQ3RELE1BQU0yQixXQUFXLEdBQUd6QixhQUFhLENBQUNWLFdBQVcsRUFBRUcsT0FBTyxFQUFFRyxPQUFPLEVBQUVLLGFBQWEsQ0FBQztJQUMvRSxNQUFNUyxjQUFjLEdBQUdXLHlCQUF5QixDQUFDSyxHQUFHLENBQUNGLFNBQVMsQ0FBQ3BCLEVBQUUsQ0FBQyxJQUFJcUIsV0FBVzs7SUFFakY7SUFDQSxNQUFNMUIsY0FBYyxHQUFHNEIsS0FBSyxDQUFDLElBQUksR0FBR0YsV0FBVyxHQUFHLElBQUksR0FBR2YsY0FBYyxDQUFDO0lBRXhFLE9BQU87TUFDTFAsV0FBVyxFQUFFcUIsU0FBUyxDQUFDcEIsRUFBRTtNQUN6QkwsY0FBYztNQUNkTSxhQUFhLEVBQUUsQ0FBQztNQUNoQkMsSUFBSSxFQUFFLENBQUM7TUFBRTtNQUNUQyxnQkFBZ0IsRUFBRWpCLFdBQVc7TUFDN0JrQixZQUFZLEVBQUVmLE9BQU87TUFDckJnQixZQUFZLEVBQUViLE9BQU87TUFDckJjO0lBQ0YsQ0FBQztFQUNILENBQUMsQ0FBQztFQUVGUixNQUFNLENBQUMwQixJQUFJLENBQUMsQ0FBQ0MsQ0FBQyxFQUFFQyxDQUFDLEtBQUtBLENBQUMsQ0FBQy9CLGNBQWMsR0FBRzhCLENBQUMsQ0FBQzlCLGNBQWMsQ0FBQztFQUMxREcsTUFBTSxDQUFDNkIsT0FBTyxDQUFDLENBQUNDLEtBQUssRUFBRUMsR0FBRyxLQUFLO0lBQzdCRCxLQUFLLENBQUMxQixJQUFJLEdBQUcyQixHQUFHLEdBQUcsQ0FBQztJQUNwQkQsS0FBSyxDQUFDM0IsYUFBYSxHQUFHNkIsb0JBQW9CLENBQUNELEdBQUcsRUFBRS9CLE1BQU0sQ0FBQ2QsTUFBTSxDQUFDO0VBQ2hFLENBQUMsQ0FBQztFQUVGLE9BQU87SUFDTFIsSUFBSTtJQUNKc0IsTUFBTTtJQUNOUyxRQUFRO0lBQ1JDO0VBQ0YsQ0FBQztBQUNIOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSxTQUFTckIsZ0JBQWdCQSxDQUFDQyxPQUEwQixFQUFVO0VBQzVELElBQUksQ0FBQ0EsT0FBTyxFQUFFLE9BQU8sR0FBRztFQUV4QixNQUFNMkMsU0FBUyxHQUFHM0MsT0FBTyxDQUFDNEMsZ0JBQWdCLElBQUksQ0FBQztFQUMvQyxNQUFNQyxLQUFLLEdBQUc3QyxPQUFPLENBQUM4QyxXQUFXLElBQUksQ0FBQztFQUN0QyxNQUFNQyxRQUFRLEdBQUcvQyxPQUFPLENBQUNnRCxXQUFXLElBQUksQ0FBQztFQUN6QyxNQUFNQyxXQUFXLEdBQUdqRCxPQUFPLENBQUNrRCxhQUFhLEdBQUd4RCxJQUFJLENBQUN5RCxHQUFHLENBQUMsQ0FBQyxFQUFFbkQsT0FBTyxDQUFDa0QsYUFBYSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUM7RUFFdEYsSUFBSUUsS0FBSyxHQUFHVCxTQUFTLEdBQUcsSUFBSSxHQUFHRSxLQUFLLEdBQUcsSUFBSSxHQUFHSSxXQUFXLEdBQUcsR0FBRztFQUMvRCxJQUFJRixRQUFRLEdBQUcsQ0FBQyxFQUFFO0lBQ2hCSyxLQUFLLElBQUkxRCxJQUFJLENBQUN5RCxHQUFHLENBQUMsSUFBSSxFQUFFSixRQUFRLEdBQUcsR0FBRyxDQUFDO0VBQ3pDO0VBRUEsT0FBT1osS0FBSyxDQUFDaUIsS0FBSyxDQUFDO0FBQ3JCO0FBRUEsU0FBU2xELFlBQVlBLENBQUNGLE9BQTBCLEVBQUVHLGlCQUFpQixHQUFHLElBQUksRUFBVTtFQUNsRixJQUFJLENBQUNILE9BQU8sRUFBRSxPQUFPLEdBQUc7RUFFeEIsTUFBTXFELGNBQWMsR0FBR3JELE9BQU8sQ0FBQ3FELGNBQWMsSUFBSSxHQUFHO0VBQ3BELE1BQU1DLFdBQVcsR0FBR3RELE9BQU8sQ0FBQ3NELFdBQVcsSUFBSSxHQUFHO0VBQzlDLE1BQU1DLG1CQUFtQixHQUN2QixPQUFPdkQsT0FBTyxDQUFDd0QsZUFBZSxLQUFLLFFBQVEsR0FDdkN4RCxPQUFPLENBQUN3RCxlQUFlLEdBQUcsQ0FBQyxHQUN6QixHQUFHLEdBQ0gsSUFBSSxHQUNOLElBQUk7RUFFVixNQUFNQyxXQUFXLEdBQ2Z6RCxPQUFPLENBQUN5RCxXQUFXLEtBQ2xCdEQsaUJBQWlCLElBQUlILE9BQU8sQ0FBQzBELFFBQVEsR0FBRyxDQUFDLEdBQUd2QixLQUFLLENBQUNuQyxPQUFPLENBQUMwRCxRQUFRLEdBQUcsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDO0VBRXBGLE1BQU1DLGlCQUFpQixHQUFHM0QsT0FBTyxDQUFDNEQsaUJBQWlCLEdBQUdsRSxJQUFJLENBQUN5RCxHQUFHLENBQUMsR0FBRyxFQUFFbkQsT0FBTyxDQUFDNEQsaUJBQWlCLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQztFQUN6RyxNQUFNQyxjQUFjLEdBQUc3RCxPQUFPLENBQUM4RCxRQUFRLEdBQUdwRSxJQUFJLENBQUN5RCxHQUFHLENBQUMsR0FBRyxFQUFFbkQsT0FBTyxDQUFDOEQsUUFBUSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUM7RUFFcEYsSUFBSVYsS0FBSyxHQUFHQyxjQUFjLEdBQUcsSUFBSSxHQUFHQyxXQUFXLEdBQUcsSUFBSSxHQUFHRyxXQUFXLEdBQUcsSUFBSSxHQUFHRixtQkFBbUIsR0FBRyxJQUFJO0VBQ3hHSCxLQUFLLElBQUlPLGlCQUFpQixHQUFHRSxjQUFjO0VBRTNDLE9BQU8xQixLQUFLLENBQUNpQixLQUFLLENBQUM7QUFDckI7QUFFQSxTQUFTL0MsbUJBQW1CQSxDQUFDQyxPQUEwQixFQUFVO0VBQy9ELElBQUksQ0FBQ0EsT0FBTyxFQUFFLE9BQU8sR0FBRztFQUV4QixNQUFNeUQsV0FBVyxHQUFHekQsT0FBTyxDQUFDMEQsZ0JBQWdCO0VBQzVDLE1BQU1DLEtBQUssR0FBRzNELE9BQU8sQ0FBQzRELGVBQWU7RUFDckMsTUFBTUMsSUFBSSxHQUFHN0QsT0FBTyxDQUFDOEQsY0FBYztFQUVuQyxNQUFNQyxJQUFJLEdBQUcsT0FBT04sV0FBVyxLQUFLLFFBQVEsR0FBR0EsV0FBVyxHQUFHLEdBQUc7RUFDaEUsTUFBTU8sWUFBWSxHQUFHLE9BQU9MLEtBQUssS0FBSyxRQUFRLEdBQUcsQ0FBQ0ksSUFBSSxHQUFHSixLQUFLLElBQUksQ0FBQyxHQUFHSSxJQUFJO0VBQzFFLE1BQU1FLFFBQVEsR0FBRyxPQUFPSixJQUFJLEtBQUssUUFBUSxHQUFHLEdBQUcsR0FBR0csWUFBWSxHQUFHLEdBQUcsR0FBR0gsSUFBSSxHQUFHRyxZQUFZO0VBRTFGLE9BQU9uQyxLQUFLLENBQUNvQyxRQUFRLENBQUM7QUFDeEI7QUFFQSxTQUFTL0QsYUFBYUEsQ0FDcEJWLFdBQW1CLEVBQ25CRyxPQUFlLEVBQ2ZHLE9BQWUsRUFDZm9FLE9BQTJCLEVBQ25CO0VBQ1IsTUFBTUMsUUFBUSxHQUNaRCxPQUFPLENBQUN4RixLQUFLLEdBQUdjLFdBQVcsR0FDM0IwRSxPQUFPLENBQUN2RixJQUFJLEdBQUdnQixPQUFPLEdBQ3RCdUUsT0FBTyxDQUFDdEYsS0FBSyxHQUFHa0IsT0FBTztFQUN6QixNQUFNc0UsS0FBSyxHQUFHRixPQUFPLENBQUN4RixLQUFLLEdBQUd3RixPQUFPLENBQUN2RixJQUFJLEdBQUd1RixPQUFPLENBQUN0RixLQUFLO0VBQzFELE9BQU93RixLQUFLLEdBQUcsQ0FBQyxHQUFHdkMsS0FBSyxDQUFDc0MsUUFBUSxHQUFHQyxLQUFLLENBQUMsR0FBR3ZDLEtBQUssQ0FBQ3NDLFFBQVEsQ0FBQztBQUM5RDtBQUVBLFNBQVMzQyx3QkFBd0JBLENBQy9CekMsVUFBaUMsRUFDakNnQyxnQkFBcUMsRUFLckM7RUFDQSxNQUFNRixRQUFzQixHQUFHLENBQUMsQ0FBQztFQUNqQyxNQUFNd0QsVUFBVSxHQUFHLElBQUlyRCxHQUFHLENBQWlCLENBQUM7RUFDNUMsTUFBTUYsa0JBQW9ELEdBQUcsQ0FBQyxDQUFDO0VBRS9ELElBQUkvQixVQUFVLENBQUNPLE1BQU0sS0FBSyxDQUFDLEVBQUU7SUFDM0IsT0FBTztNQUFFaUMseUJBQXlCLEVBQUU4QyxVQUFVO01BQUV4RCxRQUFRO01BQUVDO0lBQW1CLENBQUM7RUFDaEY7O0VBRUE7RUFDQSxNQUFNd0Qsb0JBQW9CLEdBQUd2RixVQUFVLENBQUNPLE1BQU0sSUFBSSxDQUFDO0VBRW5ELE1BQU1pRixZQUFZLEdBQUd4RixVQUFVLENBQUMwQyxHQUFHLENBQUUrQyxDQUFDLElBQUtBLENBQUMsQ0FBQ2xFLEVBQUUsQ0FBQztFQUNoRCxLQUFLLE1BQU1BLEVBQUUsSUFBSWlFLFlBQVksRUFBRTtJQUM3QjFELFFBQVEsQ0FBQ1AsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2pCLEtBQUssTUFBTW1FLEtBQUssSUFBSUYsWUFBWSxFQUFFO01BQ2hDLElBQUlqRSxFQUFFLEtBQUttRSxLQUFLLEVBQUU1RCxRQUFRLENBQUNQLEVBQUUsQ0FBQyxDQUFDbUUsS0FBSyxDQUFDLEdBQUcsQ0FBQztJQUMzQztFQUNGOztFQUVBO0VBQ0EsTUFBTUMsaUJBQWlCLEdBQUcsSUFBSTFELEdBQUcsQ0FBb0MsQ0FBQztFQUN0RSxLQUFLLE1BQU1VLFNBQVMsSUFBSTNDLFVBQVUsRUFBRTtJQUNsQyxLQUFLLE1BQU0rRCxLQUFLLElBQUlwQixTQUFTLENBQUNpRCxlQUFlLElBQUksRUFBRSxFQUFFO01BQ25ELElBQUksQ0FBQ0QsaUJBQWlCLENBQUNFLEdBQUcsQ0FBQzlCLEtBQUssQ0FBQytCLFdBQVcsQ0FBQyxFQUFFO1FBQzdDSCxpQkFBaUIsQ0FBQ3JELEdBQUcsQ0FBQ3lCLEtBQUssQ0FBQytCLFdBQVcsRUFBRSxFQUFFLENBQUM7TUFDOUM7TUFDQUgsaUJBQWlCLENBQUM5QyxHQUFHLENBQUNrQixLQUFLLENBQUMrQixXQUFXLENBQUMsQ0FBRUMsSUFBSSxDQUFDO1FBQzdDRCxXQUFXLEVBQUUvQixLQUFLLENBQUMrQixXQUFXO1FBQzlCL0IsS0FBSyxFQUFFakIsS0FBSyxDQUFDaUIsS0FBSyxDQUFDQSxLQUFLLENBQUM7UUFDekJ4QixNQUFNLEVBQUV3QixLQUFLLENBQUN4QixNQUFNO1FBQ3BCeUQsS0FBSyxFQUFFakMsS0FBSyxDQUFDaUMsS0FBSztRQUNsQjFFLFdBQVcsRUFBRXFCLFNBQVMsQ0FBQ3BCO01BQ3pCLENBQUMsQ0FBQztJQUNKO0VBQ0Y7O0VBRUE7RUFDQSxJQUFJb0UsaUJBQWlCLENBQUNNLElBQUksS0FBSyxDQUFDLEVBQUU7SUFDaEMsTUFBTUMsUUFBbUMsR0FBRyxFQUFFO0lBQzlDLEtBQUssTUFBTXZELFNBQVMsSUFBSTNDLFVBQVUsRUFBRTtNQUNsQ2tHLFFBQVEsQ0FBQ0gsSUFBSSxDQUFDO1FBQ1pELFdBQVcsRUFBRSxpQkFBaUI7UUFDOUIvQixLQUFLLEVBQUUsR0FBRztRQUNWeEIsTUFBTSxFQUFFLENBQUM7UUFDVGpCLFdBQVcsRUFBRXFCLFNBQVMsQ0FBQ3BCO01BQ3pCLENBQUMsQ0FBQztJQUNKO0lBQ0FvRSxpQkFBaUIsQ0FBQ3JELEdBQUcsQ0FBQyxpQkFBaUIsRUFBRTRELFFBQVEsQ0FBQztFQUNwRDtFQUVBLElBQUlDLGdCQUFnQixHQUFHLENBQUM7RUFFeEIsS0FBSyxNQUFNLENBQUNMLFdBQVcsRUFBRU0sU0FBUyxDQUFDLElBQUlULGlCQUFpQixDQUFDVSxPQUFPLENBQUMsQ0FBQyxFQUFFO0lBQ2xFLE1BQU05RCxNQUFNLEdBQUdQLGdCQUFnQixDQUFDYSxHQUFHLENBQUNpRCxXQUFXLENBQUMsSUFBSSxDQUFDO0lBQ3JESyxnQkFBZ0IsSUFBSTVELE1BQU0sR0FBR2xDLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUMsRUFBRU4sVUFBVSxDQUFDTyxNQUFNLEdBQUcsQ0FBQyxDQUFDOztJQUUvRDtJQUNBLE1BQU1jLE1BQU0sR0FBRytFLFNBQVMsQ0FDckJFLE1BQU0sQ0FBRW5ELEtBQUssSUFBSyxPQUFPQSxLQUFLLENBQUNZLEtBQUssS0FBSyxRQUFRLENBQUMsQ0FDbERoQixJQUFJLENBQUMsQ0FBQ0MsQ0FBQyxFQUFFQyxDQUFDLEtBQUssQ0FBQ0EsQ0FBQyxDQUFDYyxLQUFLLElBQUksQ0FBQyxLQUFLZixDQUFDLENBQUNlLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztJQUVsRGhDLGtCQUFrQixDQUFDK0QsV0FBVyxDQUFDLEdBQUd6RSxNQUFNLENBQUNxQixHQUFHLENBQUMsQ0FBQztNQUFFcEIsV0FBVyxFQUFFaUYsWUFBWTtNQUFFLEdBQUdDO0lBQUssQ0FBQyxLQUFLQSxJQUFzQixDQUFDO0lBRWhIbkYsTUFBTSxDQUFDNkIsT0FBTyxDQUFDLENBQUNDLEtBQUssRUFBRUMsR0FBRyxLQUFLO01BQzdCLE1BQU05QixXQUFXLEdBQUk2QixLQUFLLENBQXdDN0IsV0FBVztNQUM3RSxNQUFNbUYsV0FBVyxHQUFHLENBQUN6RyxVQUFVLENBQUNPLE1BQU0sR0FBRzZDLEdBQUcsR0FBRyxDQUFDLElBQUliLE1BQU07TUFDMUQrQyxVQUFVLENBQUNoRCxHQUFHLENBQUNoQixXQUFXLEVBQUUsQ0FBQ2dFLFVBQVUsQ0FBQ3pDLEdBQUcsQ0FBQ3ZCLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSW1GLFdBQVcsQ0FBQztJQUMvRSxDQUFDLENBQUM7O0lBRUY7SUFDQSxJQUFJbEIsb0JBQW9CLElBQUlsRSxNQUFNLENBQUNkLE1BQU0sS0FBSyxDQUFDLEVBQUU7TUFDL0MsTUFBTW1HLE1BQU0sR0FBR3JGLE1BQU0sQ0FBQyxDQUFDLENBQXNEO01BQzdFLE1BQU1zRixLQUFLLEdBQUd0RixNQUFNLENBQUMsQ0FBQyxDQUFzRDtNQUM1RSxJQUFJcUYsTUFBTSxDQUFDM0MsS0FBSyxLQUFLNEMsS0FBSyxDQUFDNUMsS0FBSyxFQUFFO1FBQ2hDakMsUUFBUSxDQUFDNEUsTUFBTSxDQUFDcEYsV0FBVyxDQUFDLENBQUNxRixLQUFLLENBQUNyRixXQUFXLENBQUMsSUFBSWlCLE1BQU0sR0FBRyxHQUFHO1FBQy9EVCxRQUFRLENBQUM2RSxLQUFLLENBQUNyRixXQUFXLENBQUMsQ0FBQ29GLE1BQU0sQ0FBQ3BGLFdBQVcsQ0FBQyxJQUFJaUIsTUFBTSxHQUFHLEdBQUc7TUFDakUsQ0FBQyxNQUFNO1FBQ0xULFFBQVEsQ0FBQzRFLE1BQU0sQ0FBQ3BGLFdBQVcsQ0FBQyxDQUFDcUYsS0FBSyxDQUFDckYsV0FBVyxDQUFDLElBQUlpQixNQUFNO01BQzNEO0lBQ0YsQ0FBQyxNQUFNO01BQ0wsS0FBSyxJQUFJcUUsQ0FBQyxHQUFHLENBQUMsRUFBRUEsQ0FBQyxHQUFHdkYsTUFBTSxDQUFDZCxNQUFNLEVBQUVxRyxDQUFDLEVBQUUsRUFBRTtRQUN0QyxLQUFLLElBQUlDLENBQUMsR0FBR0QsQ0FBQyxHQUFHLENBQUMsRUFBRUMsQ0FBQyxHQUFHeEYsTUFBTSxDQUFDZCxNQUFNLEVBQUVzRyxDQUFDLEVBQUUsRUFBRTtVQUMxQyxNQUFNSCxNQUFNLEdBQUdyRixNQUFNLENBQUN1RixDQUFDLENBQXNEO1VBQzdFLE1BQU1ELEtBQUssR0FBR3RGLE1BQU0sQ0FBQ3dGLENBQUMsQ0FBc0Q7VUFDNUUsSUFBSUgsTUFBTSxDQUFDM0MsS0FBSyxLQUFLNEMsS0FBSyxDQUFDNUMsS0FBSyxFQUFFO1lBQ2hDakMsUUFBUSxDQUFDNEUsTUFBTSxDQUFDcEYsV0FBVyxDQUFDLENBQUNxRixLQUFLLENBQUNyRixXQUFXLENBQUMsSUFBSWlCLE1BQU0sR0FBRyxHQUFHO1lBQy9EVCxRQUFRLENBQUM2RSxLQUFLLENBQUNyRixXQUFXLENBQUMsQ0FBQ29GLE1BQU0sQ0FBQ3BGLFdBQVcsQ0FBQyxJQUFJaUIsTUFBTSxHQUFHLEdBQUc7VUFDakUsQ0FBQyxNQUFNO1lBQ0xULFFBQVEsQ0FBQzRFLE1BQU0sQ0FBQ3BGLFdBQVcsQ0FBQyxDQUFDcUYsS0FBSyxDQUFDckYsV0FBVyxDQUFDLElBQUlpQixNQUFNO1VBQzNEO1FBQ0Y7TUFDRjtJQUNGO0VBQ0Y7O0VBRUE7RUFDQSxJQUFJNEQsZ0JBQWdCLEdBQUcsQ0FBQyxFQUFFO0lBQ3hCLEtBQUssTUFBTSxDQUFDN0UsV0FBVyxFQUFFd0YsTUFBTSxDQUFDLElBQUl4QixVQUFVLENBQUNlLE9BQU8sQ0FBQyxDQUFDLEVBQUU7TUFDeERmLFVBQVUsQ0FBQ2hELEdBQUcsQ0FBQ2hCLFdBQVcsRUFBRXdCLEtBQUssQ0FBQ2dFLE1BQU0sR0FBR1gsZ0JBQWdCLENBQUMsQ0FBQztJQUMvRDtFQUNGOztFQUVBO0VBQ0EsS0FBSyxNQUFNN0UsV0FBVyxJQUFJa0UsWUFBWSxFQUFFO0lBQ3RDLElBQUksQ0FBQ0YsVUFBVSxDQUFDTyxHQUFHLENBQUN2RSxXQUFXLENBQUMsRUFBRTtNQUNoQ2dFLFVBQVUsQ0FBQ2hELEdBQUcsQ0FBQ2hCLFdBQVcsRUFBRSxHQUFHLENBQUM7SUFDbEM7RUFDRjtFQUVBLE9BQU87SUFBRWtCLHlCQUF5QixFQUFFOEMsVUFBVTtJQUFFeEQsUUFBUTtJQUFFQztFQUFtQixDQUFDO0FBQ2hGO0FBRUEsU0FBU2UsS0FBS0EsQ0FBQ2lFLEtBQWEsRUFBRWpELEdBQUcsR0FBRyxDQUFDLEVBQUV4RCxHQUFHLEdBQUcsQ0FBQyxFQUFVO0VBQ3RELElBQUkwRyxNQUFNLENBQUNDLEtBQUssQ0FBQ0YsS0FBSyxDQUFDLEVBQUUsT0FBT2pELEdBQUc7RUFDbkMsT0FBT3pELElBQUksQ0FBQ0MsR0FBRyxDQUFDd0QsR0FBRyxFQUFFekQsSUFBSSxDQUFDeUQsR0FBRyxDQUFDeEQsR0FBRyxFQUFFeUcsS0FBSyxDQUFDLENBQUM7QUFDNUM7QUFFQSxTQUFTMUQsb0JBQW9CQSxDQUFDNkQsU0FBaUIsRUFBRTdCLEtBQWEsRUFBVTtFQUN0RSxJQUFJQSxLQUFLLElBQUksQ0FBQyxFQUFFLE9BQU8sQ0FBQztFQUN4QixNQUFNOEIsUUFBUSxHQUFHOUcsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQyxFQUFFK0UsS0FBSyxHQUFHLENBQUMsQ0FBQztFQUN2QyxNQUFNK0IsUUFBUSxHQUFHLENBQUMsR0FBR0YsU0FBUyxHQUFHQyxRQUFRO0VBQ3pDLE9BQU9yRSxLQUFLLENBQUNzRSxRQUFRLENBQUM7QUFDeEIiLCJpZ25vcmVMaXN0IjpbXX0=