bff016bbcf24a2bab2fc4ce89508f22f
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.DEFAULT_HUMAN_REWARD_WEIGHTS = void 0;
exports.runDualTournament = runDualTournament;
/**
 * Dual Tournament Engine
 *
 * Shared scoring/ranking utilities used by dual tournaments in both /upgrade and /attack flows.
 * Encodes policy vs evaluator tournaments with human-like reward heuristics and multi-evaluator
 * aggregation to approximate human code review preferences.
 */

const DEFAULT_HUMAN_REWARD_WEIGHTS = exports.DEFAULT_HUMAN_REWARD_WEIGHTS = {
  alpha: 0.6,
  beta: 0.25,
  gamma: 0.15
};
/**
  * Run a dual tournament over candidate patches/agents, combining hard metrics,
  * human-like reward heuristics, and evaluator rankings.
  */
function runDualTournament(task, candidates, options = {}) {
  const maxCandidates = options.maxCandidates ?? 8;
  const boundedCandidates = candidates.slice(0, Math.max(1, maxCandidates));

  // Fast path: single candidate - avoid unnecessary aggregation work
  if (boundedCandidates.length === 1) {
    const solo = boundedCandidates[0];
    const correctness = scoreCorrectness(solo.metrics);
    const quality = scoreQuality(solo.metrics, options.preferSmallerDiff ?? true);
    const learned = scoreLearnedSignals(solo.signals);
    const aggregateScore = combineReward(correctness, quality, learned, options.rewardWeights ?? DEFAULT_HUMAN_REWARD_WEIGHTS);
    const ranked = [{
      candidateId: solo.id,
      aggregateScore,
      humanAccuracy: 1,
      rank: 1,
      correctnessScore: correctness,
      qualityScore: quality,
      learnedScore: learned,
      evaluatorScore: aggregateScore
    }];
    return {
      task,
      ranked,
      pairwise: {},
      evaluatorBreakdown: {}
    };
  }
  const rewardWeights = options.rewardWeights ?? DEFAULT_HUMAN_REWARD_WEIGHTS;
  const evaluatorWeights = new Map();
  for (const evaluator of options.evaluators ?? []) {
    const eloWeight = evaluator.elo ? 1 + Math.max(0, (evaluator.elo - 1200) / 2400) : 1;
    evaluatorWeights.set(evaluator.id, (evaluator.weight ?? 1) * eloWeight);
  }

  // Compute evaluator aggregates and pairwise wins first (needed for composite score)
  const {
    aggregatedEvaluatorScores,
    pairwise,
    evaluatorBreakdown
  } = aggregateEvaluatorScores(boundedCandidates, evaluatorWeights);
  const ranked = boundedCandidates.map(candidate => {
    const correctness = scoreCorrectness(candidate.metrics);
    const quality = scoreQuality(candidate.metrics, options.preferSmallerDiff ?? true);
    const learned = scoreLearnedSignals(candidate.signals);
    const rewardScore = combineReward(correctness, quality, learned, rewardWeights);
    const evaluatorScore = aggregatedEvaluatorScores.get(candidate.id) ?? rewardScore;

    // Combine human-like reward with evaluator aggregate (relative preference)
    const aggregateScore = clamp(0.55 * rewardScore + 0.45 * evaluatorScore);
    return {
      candidateId: candidate.id,
      aggregateScore,
      humanAccuracy: 0,
      rank: 0,
      // set after sorting
      correctnessScore: correctness,
      qualityScore: quality,
      learnedScore: learned,
      evaluatorScore
    };
  });
  ranked.sort((a, b) => b.aggregateScore - a.aggregateScore);
  ranked.forEach((entry, idx) => {
    entry.rank = idx + 1;
    entry.humanAccuracy = computeHumanAccuracy(idx, ranked.length);
  });
  return {
    task,
    ranked,
    pairwise,
    evaluatorBreakdown
  };
}

// ════════════════════════════════════════════════════════════════════════════
// Internal scoring helpers
// ════════════════════════════════════════════════════════════════════════════

function scoreCorrectness(metrics) {
  if (!metrics) return 0.5;
  const execution = metrics.executionSuccess ?? 0;
  const tests = metrics.testsPassed ?? 0;
  const failures = metrics.testsFailed ?? 0;
  const toolSuccess = metrics.toolSuccesses ? Math.min(1, metrics.toolSuccesses / 3) : 0;
  let score = execution * 0.35 + tests * 0.45 + toolSuccess * 0.2;
  if (failures > 0) {
    score -= Math.min(0.35, failures * 0.1);
  }
  return clamp(score);
}
function scoreQuality(metrics, preferSmallerDiff = true) {
  if (!metrics) return 0.5;
  const staticAnalysis = metrics.staticAnalysis ?? 0.5;
  const codeQuality = metrics.codeQuality ?? 0.5;
  const complexityComponent = typeof metrics.complexityDelta === 'number' ? metrics.complexityDelta < 0 ? 0.7 : 0.45 : 0.55;
  const blastRadius = metrics.blastRadius ?? (preferSmallerDiff && metrics.diffSize ? 1 - clamp(metrics.diffSize / 500) : 0.55);
  const dependencyPenalty = metrics.dependenciesAdded ? Math.min(0.3, metrics.dependenciesAdded * 0.05) : 0;
  const warningPenalty = metrics.warnings ? Math.min(0.2, metrics.warnings * 0.05) : 0;
  let score = staticAnalysis * 0.35 + codeQuality * 0.25 + blastRadius * 0.25 + complexityComponent * 0.15;
  score -= dependencyPenalty + warningPenalty;
  return clamp(score);
}
function scoreLearnedSignals(signals) {
  if (!signals) return 0.5;
  const rewardModel = signals.rewardModelScore;
  const human = signals.humanPreference;
  const self = signals.selfAssessment;
  const base = typeof rewardModel === 'number' ? rewardModel : 0.5;
  const blendedHuman = typeof human === 'number' ? (base + human) / 2 : base;
  const withSelf = typeof self === 'number' ? 0.7 * blendedHuman + 0.3 * self : blendedHuman;
  return clamp(withSelf);
}
function combineReward(correctness, quality, learned, weights) {
  const weighted = weights.alpha * correctness + weights.beta * quality + weights.gamma * learned;
  const total = weights.alpha + weights.beta + weights.gamma;
  return total > 0 ? clamp(weighted / total) : clamp(weighted);
}
function aggregateEvaluatorScores(candidates, evaluatorWeights) {
  const pairwise = {};
  const aggregated = new Map();
  const evaluatorBreakdown = {};
  if (candidates.length === 0) {
    return {
      aggregatedEvaluatorScores: aggregated,
      pairwise,
      evaluatorBreakdown
    };
  }

  // Pre-size for small tournaments to avoid unnecessary O(n^2) when not needed
  const twoCandidateFastPath = candidates.length <= 2;
  const candidateIds = candidates.map(c => c.id);
  for (const id of candidateIds) {
    pairwise[id] = {};
    for (const other of candidateIds) {
      if (id !== other) pairwise[id][other] = 0;
    }
  }

  // Collect scores per evaluator
  const scoresByEvaluator = new Map();
  for (const candidate of candidates) {
    for (const score of candidate.evaluatorScores ?? []) {
      if (!scoresByEvaluator.has(score.evaluatorId)) {
        scoresByEvaluator.set(score.evaluatorId, []);
      }
      scoresByEvaluator.get(score.evaluatorId).push({
        evaluatorId: score.evaluatorId,
        score: clamp(score.score),
        weight: score.weight,
        notes: score.notes,
        candidateId: candidate.id
      });
    }
  }

  // If no evaluator scores provided, fall back to neutral rankings
  if (scoresByEvaluator.size === 0) {
    const fallback = [];
    for (const candidate of candidates) {
      fallback.push({
        evaluatorId: 'reward-fallback',
        score: 0.5,
        weight: 1,
        candidateId: candidate.id
      });
    }
    scoresByEvaluator.set('reward-fallback', fallback);
  }
  let totalBordaWeight = 0;
  for (const [evaluatorId, rawScores] of scoresByEvaluator.entries()) {
    const weight = evaluatorWeights.get(evaluatorId) ?? 1;
    totalBordaWeight += weight * Math.max(1, candidates.length - 1);

    // Sort descending by score to assign ranks (Borda)
    const ranked = rawScores.filter(entry => typeof entry.score === 'number').sort((a, b) => (b.score ?? 0) - (a.score ?? 0));
    evaluatorBreakdown[evaluatorId] = ranked.map(({
      candidateId: _,
      ...rest
    }) => rest);
    ranked.forEach((entry, idx) => {
      const candidateId = entry.candidateId;
      const bordaPoints = (candidates.length - idx - 1) * weight;
      aggregated.set(candidateId, (aggregated.get(candidateId) ?? 0) + bordaPoints);
    });

    // Pairwise wins for this evaluator (lightweight path for <=2 candidates)
    if (twoCandidateFastPath && ranked.length === 2) {
      const higher = ranked[0];
      const lower = ranked[1];
      if (higher.score === lower.score) {
        pairwise[higher.candidateId][lower.candidateId] += weight * 0.5;
        pairwise[lower.candidateId][higher.candidateId] += weight * 0.5;
      } else {
        pairwise[higher.candidateId][lower.candidateId] += weight;
      }
    } else {
      for (let i = 0; i < ranked.length; i++) {
        for (let j = i + 1; j < ranked.length; j++) {
          const higher = ranked[i];
          const lower = ranked[j];
          if (higher.score === lower.score) {
            pairwise[higher.candidateId][lower.candidateId] += weight * 0.5;
            pairwise[lower.candidateId][higher.candidateId] += weight * 0.5;
          } else {
            pairwise[higher.candidateId][lower.candidateId] += weight;
          }
        }
      }
    }
  }

  // Normalize aggregated Borda scores into [0,1]
  if (totalBordaWeight > 0) {
    for (const [candidateId, points] of aggregated.entries()) {
      aggregated.set(candidateId, clamp(points / totalBordaWeight));
    }
  }

  // Ensure every candidate has an entry
  for (const candidateId of candidateIds) {
    if (!aggregated.has(candidateId)) {
      aggregated.set(candidateId, 0.5);
    }
  }
  return {
    aggregatedEvaluatorScores: aggregated,
    pairwise,
    evaluatorBreakdown
  };
}
function clamp(value, min = 0, max = 1) {
  if (Number.isNaN(value)) return min;
  return Math.max(min, Math.min(max, value));
}
function computeHumanAccuracy(rankIndex, total) {
  if (total <= 1) return 1;
  const maxIndex = Math.max(1, total - 1);
  const relative = 1 - rankIndex / maxIndex;
  return clamp(relative);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJERUZBVUxUX0hVTUFOX1JFV0FSRF9XRUlHSFRTIiwiZXhwb3J0cyIsImFscGhhIiwiYmV0YSIsImdhbW1hIiwicnVuRHVhbFRvdXJuYW1lbnQiLCJ0YXNrIiwiY2FuZGlkYXRlcyIsIm9wdGlvbnMiLCJtYXhDYW5kaWRhdGVzIiwiYm91bmRlZENhbmRpZGF0ZXMiLCJzbGljZSIsIk1hdGgiLCJtYXgiLCJsZW5ndGgiLCJzb2xvIiwiY29ycmVjdG5lc3MiLCJzY29yZUNvcnJlY3RuZXNzIiwibWV0cmljcyIsInF1YWxpdHkiLCJzY29yZVF1YWxpdHkiLCJwcmVmZXJTbWFsbGVyRGlmZiIsImxlYXJuZWQiLCJzY29yZUxlYXJuZWRTaWduYWxzIiwic2lnbmFscyIsImFnZ3JlZ2F0ZVNjb3JlIiwiY29tYmluZVJld2FyZCIsInJld2FyZFdlaWdodHMiLCJyYW5rZWQiLCJjYW5kaWRhdGVJZCIsImlkIiwiaHVtYW5BY2N1cmFjeSIsInJhbmsiLCJjb3JyZWN0bmVzc1Njb3JlIiwicXVhbGl0eVNjb3JlIiwibGVhcm5lZFNjb3JlIiwiZXZhbHVhdG9yU2NvcmUiLCJwYWlyd2lzZSIsImV2YWx1YXRvckJyZWFrZG93biIsImV2YWx1YXRvcldlaWdodHMiLCJNYXAiLCJldmFsdWF0b3IiLCJldmFsdWF0b3JzIiwiZWxvV2VpZ2h0IiwiZWxvIiwic2V0Iiwid2VpZ2h0IiwiYWdncmVnYXRlZEV2YWx1YXRvclNjb3JlcyIsImFnZ3JlZ2F0ZUV2YWx1YXRvclNjb3JlcyIsIm1hcCIsImNhbmRpZGF0ZSIsInJld2FyZFNjb3JlIiwiZ2V0IiwiY2xhbXAiLCJzb3J0IiwiYSIsImIiLCJmb3JFYWNoIiwiZW50cnkiLCJpZHgiLCJjb21wdXRlSHVtYW5BY2N1cmFjeSIsImV4ZWN1dGlvbiIsImV4ZWN1dGlvblN1Y2Nlc3MiLCJ0ZXN0cyIsInRlc3RzUGFzc2VkIiwiZmFpbHVyZXMiLCJ0ZXN0c0ZhaWxlZCIsInRvb2xTdWNjZXNzIiwidG9vbFN1Y2Nlc3NlcyIsIm1pbiIsInNjb3JlIiwic3RhdGljQW5hbHlzaXMiLCJjb2RlUXVhbGl0eSIsImNvbXBsZXhpdHlDb21wb25lbnQiLCJjb21wbGV4aXR5RGVsdGEiLCJibGFzdFJhZGl1cyIsImRpZmZTaXplIiwiZGVwZW5kZW5jeVBlbmFsdHkiLCJkZXBlbmRlbmNpZXNBZGRlZCIsIndhcm5pbmdQZW5hbHR5Iiwid2FybmluZ3MiLCJyZXdhcmRNb2RlbCIsInJld2FyZE1vZGVsU2NvcmUiLCJodW1hbiIsImh1bWFuUHJlZmVyZW5jZSIsInNlbGYiLCJzZWxmQXNzZXNzbWVudCIsImJhc2UiLCJibGVuZGVkSHVtYW4iLCJ3aXRoU2VsZiIsIndlaWdodHMiLCJ3ZWlnaHRlZCIsInRvdGFsIiwiYWdncmVnYXRlZCIsInR3b0NhbmRpZGF0ZUZhc3RQYXRoIiwiY2FuZGlkYXRlSWRzIiwiYyIsIm90aGVyIiwic2NvcmVzQnlFdmFsdWF0b3IiLCJldmFsdWF0b3JTY29yZXMiLCJoYXMiLCJldmFsdWF0b3JJZCIsInB1c2giLCJub3RlcyIsInNpemUiLCJmYWxsYmFjayIsInRvdGFsQm9yZGFXZWlnaHQiLCJyYXdTY29yZXMiLCJlbnRyaWVzIiwiZmlsdGVyIiwiXyIsInJlc3QiLCJib3JkYVBvaW50cyIsImhpZ2hlciIsImxvd2VyIiwiaSIsImoiLCJwb2ludHMiLCJ2YWx1ZSIsIk51bWJlciIsImlzTmFOIiwicmFua0luZGV4IiwibWF4SW5kZXgiLCJyZWxhdGl2ZSJdLCJzb3VyY2VzIjpbImR1YWxUb3VybmFtZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRHVhbCBUb3VybmFtZW50IEVuZ2luZVxuICpcbiAqIFNoYXJlZCBzY29yaW5nL3JhbmtpbmcgdXRpbGl0aWVzIHVzZWQgYnkgZHVhbCB0b3VybmFtZW50cyBpbiBib3RoIC91cGdyYWRlIGFuZCAvYXR0YWNrIGZsb3dzLlxuICogRW5jb2RlcyBwb2xpY3kgdnMgZXZhbHVhdG9yIHRvdXJuYW1lbnRzIHdpdGggaHVtYW4tbGlrZSByZXdhcmQgaGV1cmlzdGljcyBhbmQgbXVsdGktZXZhbHVhdG9yXG4gKiBhZ2dyZWdhdGlvbiB0byBhcHByb3hpbWF0ZSBodW1hbiBjb2RlIHJldmlldyBwcmVmZXJlbmNlcy5cbiAqL1xuXG5leHBvcnQgdHlwZSBQb2xpY3lJZCA9IHN0cmluZztcblxuZXhwb3J0IGludGVyZmFjZSBUb3VybmFtZW50UG9saWN5IHtcbiAgaWQ6IFBvbGljeUlkO1xuICBsYWJlbD86IHN0cmluZztcbiAga2luZD86ICdwcmltYXJ5JyB8ICdyZWZpbmVyJyB8ICdjaGVja3BvaW50JyB8ICdhdHRhY2snO1xuICBlbG8/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVG91cm5hbWVudEV2YWx1YXRvciB7XG4gIGlkOiBzdHJpbmc7XG4gIGxhYmVsPzogc3RyaW5nO1xuICAvKiogV2VpZ2h0IHVzZWQgd2hlbiBjb21iaW5pbmcgZXZhbHVhdG9yIHJhbmtpbmdzIChjYW4gYmUgaW5mbHVlbmNlZCBieSBoaXN0b3JpY2FsIEVMTykuICovXG4gIHdlaWdodD86IG51bWJlcjtcbiAga2luZD86ICdoYXJkJyB8ICdzb2Z0JyB8ICdoeWJyaWQnO1xuICBlbG8/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVG91cm5hbWVudFRhc2sge1xuICBpZDogc3RyaW5nO1xuICBnb2FsOiBzdHJpbmc7XG4gIHJlcG9TbmFwc2hvdD86IHN0cmluZztcbiAgdGVzdHM/OiBzdHJpbmdbXTtcbiAgY29uc3RyYWludHM/OiBzdHJpbmdbXTtcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDYW5kaWRhdGVNZXRyaWNzIHtcbiAgZXhlY3V0aW9uU3VjY2Vzcz86IG51bWJlcjsgLy8gMC0xXG4gIHRlc3RzUGFzc2VkPzogbnVtYmVyOyAvLyAwLTFcbiAgdGVzdHNGYWlsZWQ/OiBudW1iZXI7IC8vIGNvdW50XG4gIHN0YXRpY0FuYWx5c2lzPzogbnVtYmVyOyAvLyAwLTFcbiAgY29kZVF1YWxpdHk/OiBudW1iZXI7IC8vIDAtMVxuICBibGFzdFJhZGl1cz86IG51bWJlcjsgLy8gMC0xIChzbWFsbGVyIGRpZmYgPT4gaGlnaGVyKVxuICBkaWZmU2l6ZT86IG51bWJlcjsgLy8gbGluZXMgY2hhbmdlZFxuICBjb21wbGV4aXR5RGVsdGE/OiBudW1iZXI7IC8vIG5lZ2F0aXZlIGJldHRlclxuICBkZXBlbmRlbmNpZXNBZGRlZD86IG51bWJlcjsgLy8gY291bnRcbiAgc3BlZWRCb251cz86IG51bWJlcjsgLy8gMC0xXG4gIHRvb2xTdWNjZXNzZXM/OiBudW1iZXI7IC8vIGNvdW50XG4gIHRvb2xGYWlsdXJlcz86IG51bWJlcjsgLy8gY291bnRcbiAgd2FybmluZ3M/OiBudW1iZXI7IC8vIGNvdW50XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2FuZGlkYXRlU2lnbmFscyB7XG4gIC8qKiBMZWFybmVkIHJld2FyZCBtb2RlbCAvIHByZWZlcmVuY2Ugc2NvcmUgKDAtMSkgKi9cbiAgcmV3YXJkTW9kZWxTY29yZT86IG51bWJlcjtcbiAgLyoqIFNlbGYtYXNzZXNzZWQgY29uZmlkZW5jZSBmcm9tIHRoZSBhZ2VudCAoMC0xKSAqL1xuICBzZWxmQXNzZXNzbWVudD86IG51bWJlcjtcbiAgLyoqIE9wdGlvbmFsIGh1bWFuIHByZWZlcmVuY2UgbGFiZWwgKDAtMSkgKi9cbiAgaHVtYW5QcmVmZXJlbmNlPzogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEV2YWx1YXRvclNjb3JlIHtcbiAgZXZhbHVhdG9ySWQ6IHN0cmluZztcbiAgc2NvcmU6IG51bWJlcjtcbiAgd2VpZ2h0PzogbnVtYmVyO1xuICBub3Rlcz86IHN0cmluZztcbn1cblxudHlwZSBDYW5kaWRhdGVFdmFsdWF0b3JTY29yZSA9IEV2YWx1YXRvclNjb3JlICYgeyBjYW5kaWRhdGVJZDogc3RyaW5nIH07XG5cbmV4cG9ydCBpbnRlcmZhY2UgVG91cm5hbWVudENhbmRpZGF0ZSB7XG4gIGlkOiBzdHJpbmc7XG4gIHBvbGljeUlkOiBQb2xpY3lJZDtcbiAgcGF0Y2hTdW1tYXJ5Pzogc3RyaW5nO1xuICBkaWZmU3VtbWFyeT86IHN0cmluZztcbiAgbWV0cmljcz86IENhbmRpZGF0ZU1ldHJpY3M7XG4gIHNpZ25hbHM/OiBDYW5kaWRhdGVTaWduYWxzO1xuICBldmFsdWF0b3JTY29yZXM/OiBFdmFsdWF0b3JTY29yZVtdO1xuICByYXdPdXRwdXQ/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSHVtYW5SZXdhcmRXZWlnaHRzIHtcbiAgLyoqIENvcnJlY3RuZXNzIHdlaWdodCAqL1xuICBhbHBoYTogbnVtYmVyO1xuICAvKiogQ29kZSBxdWFsaXR5IC8gcm9idXN0bmVzcyB3ZWlnaHQgKi9cbiAgYmV0YTogbnVtYmVyO1xuICAvKiogTGVhcm5lZCByZXdhcmQgLyBodW1hbiBwcmVmZXJlbmNlIHdlaWdodCAqL1xuICBnYW1tYTogbnVtYmVyO1xufVxuXG5leHBvcnQgY29uc3QgREVGQVVMVF9IVU1BTl9SRVdBUkRfV0VJR0hUUzogSHVtYW5SZXdhcmRXZWlnaHRzID0ge1xuICBhbHBoYTogMC42LFxuICBiZXRhOiAwLjI1LFxuICBnYW1tYTogMC4xNSxcbn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmFua2VkQ2FuZGlkYXRlIHtcbiAgY2FuZGlkYXRlSWQ6IHN0cmluZztcbiAgYWdncmVnYXRlU2NvcmU6IG51bWJlcjtcbiAgLyoqIFJlbGF0aXZlIGh1bWFuLWxpa2UgYWNjdXJhY3kgKDEgPSBiZXN0IHJhbmssIDAgPSB3b3JzdCByYW5rKSAqL1xuICBodW1hbkFjY3VyYWN5OiBudW1iZXI7XG4gIHJhbms6IG51bWJlcjtcbiAgY29ycmVjdG5lc3NTY29yZTogbnVtYmVyO1xuICBxdWFsaXR5U2NvcmU6IG51bWJlcjtcbiAgbGVhcm5lZFNjb3JlOiBudW1iZXI7XG4gIGV2YWx1YXRvclNjb3JlOiBudW1iZXI7XG59XG5cbmV4cG9ydCB0eXBlIFBhaXJ3aXNlV2lucyA9IFJlY29yZDxzdHJpbmcsIFJlY29yZDxzdHJpbmcsIG51bWJlcj4+O1xuXG5leHBvcnQgaW50ZXJmYWNlIFRvdXJuYW1lbnRPdXRjb21lIHtcbiAgdGFzazogVG91cm5hbWVudFRhc2s7XG4gIHJhbmtlZDogUmFua2VkQ2FuZGlkYXRlW107XG4gIHBhaXJ3aXNlOiBQYWlyd2lzZVdpbnM7XG4gIGV2YWx1YXRvckJyZWFrZG93bjogUmVjb3JkPHN0cmluZywgRXZhbHVhdG9yU2NvcmVbXT47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVG91cm5hbWVudE9wdGlvbnMge1xuICByZXdhcmRXZWlnaHRzPzogSHVtYW5SZXdhcmRXZWlnaHRzO1xuICBldmFsdWF0b3JzPzogVG91cm5hbWVudEV2YWx1YXRvcltdO1xuICAvKiogV2hlbiB0cnVlLCBwcmVmZXIgc21hbGxlciBkaWZmcyBieSBkZWZhdWx0IGlmIGRpZmZTaXplIGlzIHByb3ZpZGVkICovXG4gIHByZWZlclNtYWxsZXJEaWZmPzogYm9vbGVhbjtcbiAgLyoqIE1heGltdW0gY2FuZGlkYXRlcyB0byBldmFsdWF0ZSAoY2FwcyBPKG5eMikgd29yaykgKi9cbiAgbWF4Q2FuZGlkYXRlcz86IG51bWJlcjtcbn1cblxuLyoqXG4gICogUnVuIGEgZHVhbCB0b3VybmFtZW50IG92ZXIgY2FuZGlkYXRlIHBhdGNoZXMvYWdlbnRzLCBjb21iaW5pbmcgaGFyZCBtZXRyaWNzLFxuICAqIGh1bWFuLWxpa2UgcmV3YXJkIGhldXJpc3RpY3MsIGFuZCBldmFsdWF0b3IgcmFua2luZ3MuXG4gICovXG5leHBvcnQgZnVuY3Rpb24gcnVuRHVhbFRvdXJuYW1lbnQoXG4gIHRhc2s6IFRvdXJuYW1lbnRUYXNrLFxuICBjYW5kaWRhdGVzOiBUb3VybmFtZW50Q2FuZGlkYXRlW10sXG4gIG9wdGlvbnM6IFRvdXJuYW1lbnRPcHRpb25zID0ge31cbik6IFRvdXJuYW1lbnRPdXRjb21lIHtcbiAgY29uc3QgbWF4Q2FuZGlkYXRlcyA9IG9wdGlvbnMubWF4Q2FuZGlkYXRlcyA/PyA4O1xuICBjb25zdCBib3VuZGVkQ2FuZGlkYXRlcyA9IGNhbmRpZGF0ZXMuc2xpY2UoMCwgTWF0aC5tYXgoMSwgbWF4Q2FuZGlkYXRlcykpO1xuXG4gIC8vIEZhc3QgcGF0aDogc2luZ2xlIGNhbmRpZGF0ZSAtIGF2b2lkIHVubmVjZXNzYXJ5IGFnZ3JlZ2F0aW9uIHdvcmtcbiAgaWYgKGJvdW5kZWRDYW5kaWRhdGVzLmxlbmd0aCA9PT0gMSkge1xuICAgIGNvbnN0IHNvbG8gPSBib3VuZGVkQ2FuZGlkYXRlc1swXSE7XG4gICAgY29uc3QgY29ycmVjdG5lc3MgPSBzY29yZUNvcnJlY3RuZXNzKHNvbG8ubWV0cmljcyk7XG4gICAgY29uc3QgcXVhbGl0eSA9IHNjb3JlUXVhbGl0eShzb2xvLm1ldHJpY3MsIG9wdGlvbnMucHJlZmVyU21hbGxlckRpZmYgPz8gdHJ1ZSk7XG4gICAgY29uc3QgbGVhcm5lZCA9IHNjb3JlTGVhcm5lZFNpZ25hbHMoc29sby5zaWduYWxzKTtcbiAgICBjb25zdCBhZ2dyZWdhdGVTY29yZSA9IGNvbWJpbmVSZXdhcmQoY29ycmVjdG5lc3MsIHF1YWxpdHksIGxlYXJuZWQsIG9wdGlvbnMucmV3YXJkV2VpZ2h0cyA/PyBERUZBVUxUX0hVTUFOX1JFV0FSRF9XRUlHSFRTKTtcblxuICAgIGNvbnN0IHJhbmtlZDogUmFua2VkQ2FuZGlkYXRlW10gPSBbe1xuICAgICAgY2FuZGlkYXRlSWQ6IHNvbG8uaWQsXG4gICAgICBhZ2dyZWdhdGVTY29yZSxcbiAgICAgIGh1bWFuQWNjdXJhY3k6IDEsXG4gICAgICByYW5rOiAxLFxuICAgICAgY29ycmVjdG5lc3NTY29yZTogY29ycmVjdG5lc3MsXG4gICAgICBxdWFsaXR5U2NvcmU6IHF1YWxpdHksXG4gICAgICBsZWFybmVkU2NvcmU6IGxlYXJuZWQsXG4gICAgICBldmFsdWF0b3JTY29yZTogYWdncmVnYXRlU2NvcmUsXG4gICAgfV07XG5cbiAgICByZXR1cm4ge1xuICAgICAgdGFzayxcbiAgICAgIHJhbmtlZCxcbiAgICAgIHBhaXJ3aXNlOiB7fSxcbiAgICAgIGV2YWx1YXRvckJyZWFrZG93bjoge30sXG4gICAgfTtcbiAgfVxuXG4gIGNvbnN0IHJld2FyZFdlaWdodHMgPSBvcHRpb25zLnJld2FyZFdlaWdodHMgPz8gREVGQVVMVF9IVU1BTl9SRVdBUkRfV0VJR0hUUztcbiAgY29uc3QgZXZhbHVhdG9yV2VpZ2h0cyA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG4gIGZvciAoY29uc3QgZXZhbHVhdG9yIG9mIG9wdGlvbnMuZXZhbHVhdG9ycyA/PyBbXSkge1xuICAgIGNvbnN0IGVsb1dlaWdodCA9IGV2YWx1YXRvci5lbG8gPyAxICsgTWF0aC5tYXgoMCwgKGV2YWx1YXRvci5lbG8gLSAxMjAwKSAvIDI0MDApIDogMTtcbiAgICBldmFsdWF0b3JXZWlnaHRzLnNldChldmFsdWF0b3IuaWQsIChldmFsdWF0b3Iud2VpZ2h0ID8/IDEpICogZWxvV2VpZ2h0KTtcbiAgfVxuXG4gIC8vIENvbXB1dGUgZXZhbHVhdG9yIGFnZ3JlZ2F0ZXMgYW5kIHBhaXJ3aXNlIHdpbnMgZmlyc3QgKG5lZWRlZCBmb3IgY29tcG9zaXRlIHNjb3JlKVxuICBjb25zdCB7IGFnZ3JlZ2F0ZWRFdmFsdWF0b3JTY29yZXMsIHBhaXJ3aXNlLCBldmFsdWF0b3JCcmVha2Rvd24gfSA9IGFnZ3JlZ2F0ZUV2YWx1YXRvclNjb3JlcyhcbiAgICBib3VuZGVkQ2FuZGlkYXRlcyxcbiAgICBldmFsdWF0b3JXZWlnaHRzXG4gICk7XG5cbiAgY29uc3QgcmFua2VkOiBSYW5rZWRDYW5kaWRhdGVbXSA9IGJvdW5kZWRDYW5kaWRhdGVzLm1hcCgoY2FuZGlkYXRlKSA9PiB7XG4gICAgY29uc3QgY29ycmVjdG5lc3MgPSBzY29yZUNvcnJlY3RuZXNzKGNhbmRpZGF0ZS5tZXRyaWNzKTtcbiAgICBjb25zdCBxdWFsaXR5ID0gc2NvcmVRdWFsaXR5KGNhbmRpZGF0ZS5tZXRyaWNzLCBvcHRpb25zLnByZWZlclNtYWxsZXJEaWZmID8/IHRydWUpO1xuICAgIGNvbnN0IGxlYXJuZWQgPSBzY29yZUxlYXJuZWRTaWduYWxzKGNhbmRpZGF0ZS5zaWduYWxzKTtcbiAgICBjb25zdCByZXdhcmRTY29yZSA9IGNvbWJpbmVSZXdhcmQoY29ycmVjdG5lc3MsIHF1YWxpdHksIGxlYXJuZWQsIHJld2FyZFdlaWdodHMpO1xuICAgIGNvbnN0IGV2YWx1YXRvclNjb3JlID0gYWdncmVnYXRlZEV2YWx1YXRvclNjb3Jlcy5nZXQoY2FuZGlkYXRlLmlkKSA/PyByZXdhcmRTY29yZTtcblxuICAgIC8vIENvbWJpbmUgaHVtYW4tbGlrZSByZXdhcmQgd2l0aCBldmFsdWF0b3IgYWdncmVnYXRlIChyZWxhdGl2ZSBwcmVmZXJlbmNlKVxuICAgIGNvbnN0IGFnZ3JlZ2F0ZVNjb3JlID0gY2xhbXAoMC41NSAqIHJld2FyZFNjb3JlICsgMC40NSAqIGV2YWx1YXRvclNjb3JlKTtcblxuICAgIHJldHVybiB7XG4gICAgICBjYW5kaWRhdGVJZDogY2FuZGlkYXRlLmlkLFxuICAgICAgYWdncmVnYXRlU2NvcmUsXG4gICAgICBodW1hbkFjY3VyYWN5OiAwLFxuICAgICAgcmFuazogMCwgLy8gc2V0IGFmdGVyIHNvcnRpbmdcbiAgICAgIGNvcnJlY3RuZXNzU2NvcmU6IGNvcnJlY3RuZXNzLFxuICAgICAgcXVhbGl0eVNjb3JlOiBxdWFsaXR5LFxuICAgICAgbGVhcm5lZFNjb3JlOiBsZWFybmVkLFxuICAgICAgZXZhbHVhdG9yU2NvcmUsXG4gICAgfTtcbiAgfSk7XG5cbiAgcmFua2VkLnNvcnQoKGEsIGIpID0+IGIuYWdncmVnYXRlU2NvcmUgLSBhLmFnZ3JlZ2F0ZVNjb3JlKTtcbiAgcmFua2VkLmZvckVhY2goKGVudHJ5LCBpZHgpID0+IHtcbiAgICBlbnRyeS5yYW5rID0gaWR4ICsgMTtcbiAgICBlbnRyeS5odW1hbkFjY3VyYWN5ID0gY29tcHV0ZUh1bWFuQWNjdXJhY3koaWR4LCByYW5rZWQubGVuZ3RoKTtcbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICB0YXNrLFxuICAgIHJhbmtlZCxcbiAgICBwYWlyd2lzZSxcbiAgICBldmFsdWF0b3JCcmVha2Rvd24sXG4gIH07XG59XG5cbi8vIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkFxuLy8gSW50ZXJuYWwgc2NvcmluZyBoZWxwZXJzXG4vLyDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZBcblxuZnVuY3Rpb24gc2NvcmVDb3JyZWN0bmVzcyhtZXRyaWNzPzogQ2FuZGlkYXRlTWV0cmljcyk6IG51bWJlciB7XG4gIGlmICghbWV0cmljcykgcmV0dXJuIDAuNTtcblxuICBjb25zdCBleGVjdXRpb24gPSBtZXRyaWNzLmV4ZWN1dGlvblN1Y2Nlc3MgPz8gMDtcbiAgY29uc3QgdGVzdHMgPSBtZXRyaWNzLnRlc3RzUGFzc2VkID8/IDA7XG4gIGNvbnN0IGZhaWx1cmVzID0gbWV0cmljcy50ZXN0c0ZhaWxlZCA/PyAwO1xuICBjb25zdCB0b29sU3VjY2VzcyA9IG1ldHJpY3MudG9vbFN1Y2Nlc3NlcyA/IE1hdGgubWluKDEsIG1ldHJpY3MudG9vbFN1Y2Nlc3NlcyAvIDMpIDogMDtcblxuICBsZXQgc2NvcmUgPSBleGVjdXRpb24gKiAwLjM1ICsgdGVzdHMgKiAwLjQ1ICsgdG9vbFN1Y2Nlc3MgKiAwLjI7XG4gIGlmIChmYWlsdXJlcyA+IDApIHtcbiAgICBzY29yZSAtPSBNYXRoLm1pbigwLjM1LCBmYWlsdXJlcyAqIDAuMSk7XG4gIH1cblxuICByZXR1cm4gY2xhbXAoc2NvcmUpO1xufVxuXG5mdW5jdGlvbiBzY29yZVF1YWxpdHkobWV0cmljcz86IENhbmRpZGF0ZU1ldHJpY3MsIHByZWZlclNtYWxsZXJEaWZmID0gdHJ1ZSk6IG51bWJlciB7XG4gIGlmICghbWV0cmljcykgcmV0dXJuIDAuNTtcblxuICBjb25zdCBzdGF0aWNBbmFseXNpcyA9IG1ldHJpY3Muc3RhdGljQW5hbHlzaXMgPz8gMC41O1xuICBjb25zdCBjb2RlUXVhbGl0eSA9IG1ldHJpY3MuY29kZVF1YWxpdHkgPz8gMC41O1xuICBjb25zdCBjb21wbGV4aXR5Q29tcG9uZW50ID1cbiAgICB0eXBlb2YgbWV0cmljcy5jb21wbGV4aXR5RGVsdGEgPT09ICdudW1iZXInXG4gICAgICA/IG1ldHJpY3MuY29tcGxleGl0eURlbHRhIDwgMFxuICAgICAgICA/IDAuN1xuICAgICAgICA6IDAuNDVcbiAgICAgIDogMC41NTtcblxuICBjb25zdCBibGFzdFJhZGl1cyA9XG4gICAgbWV0cmljcy5ibGFzdFJhZGl1cyA/P1xuICAgIChwcmVmZXJTbWFsbGVyRGlmZiAmJiBtZXRyaWNzLmRpZmZTaXplID8gMSAtIGNsYW1wKG1ldHJpY3MuZGlmZlNpemUgLyA1MDApIDogMC41NSk7XG5cbiAgY29uc3QgZGVwZW5kZW5jeVBlbmFsdHkgPSBtZXRyaWNzLmRlcGVuZGVuY2llc0FkZGVkID8gTWF0aC5taW4oMC4zLCBtZXRyaWNzLmRlcGVuZGVuY2llc0FkZGVkICogMC4wNSkgOiAwO1xuICBjb25zdCB3YXJuaW5nUGVuYWx0eSA9IG1ldHJpY3Mud2FybmluZ3MgPyBNYXRoLm1pbigwLjIsIG1ldHJpY3Mud2FybmluZ3MgKiAwLjA1KSA6IDA7XG5cbiAgbGV0IHNjb3JlID0gc3RhdGljQW5hbHlzaXMgKiAwLjM1ICsgY29kZVF1YWxpdHkgKiAwLjI1ICsgYmxhc3RSYWRpdXMgKiAwLjI1ICsgY29tcGxleGl0eUNvbXBvbmVudCAqIDAuMTU7XG4gIHNjb3JlIC09IGRlcGVuZGVuY3lQZW5hbHR5ICsgd2FybmluZ1BlbmFsdHk7XG5cbiAgcmV0dXJuIGNsYW1wKHNjb3JlKTtcbn1cblxuZnVuY3Rpb24gc2NvcmVMZWFybmVkU2lnbmFscyhzaWduYWxzPzogQ2FuZGlkYXRlU2lnbmFscyk6IG51bWJlciB7XG4gIGlmICghc2lnbmFscykgcmV0dXJuIDAuNTtcblxuICBjb25zdCByZXdhcmRNb2RlbCA9IHNpZ25hbHMucmV3YXJkTW9kZWxTY29yZTtcbiAgY29uc3QgaHVtYW4gPSBzaWduYWxzLmh1bWFuUHJlZmVyZW5jZTtcbiAgY29uc3Qgc2VsZiA9IHNpZ25hbHMuc2VsZkFzc2Vzc21lbnQ7XG5cbiAgY29uc3QgYmFzZSA9IHR5cGVvZiByZXdhcmRNb2RlbCA9PT0gJ251bWJlcicgPyByZXdhcmRNb2RlbCA6IDAuNTtcbiAgY29uc3QgYmxlbmRlZEh1bWFuID0gdHlwZW9mIGh1bWFuID09PSAnbnVtYmVyJyA/IChiYXNlICsgaHVtYW4pIC8gMiA6IGJhc2U7XG4gIGNvbnN0IHdpdGhTZWxmID0gdHlwZW9mIHNlbGYgPT09ICdudW1iZXInID8gMC43ICogYmxlbmRlZEh1bWFuICsgMC4zICogc2VsZiA6IGJsZW5kZWRIdW1hbjtcblxuICByZXR1cm4gY2xhbXAod2l0aFNlbGYpO1xufVxuXG5mdW5jdGlvbiBjb21iaW5lUmV3YXJkKFxuICBjb3JyZWN0bmVzczogbnVtYmVyLFxuICBxdWFsaXR5OiBudW1iZXIsXG4gIGxlYXJuZWQ6IG51bWJlcixcbiAgd2VpZ2h0czogSHVtYW5SZXdhcmRXZWlnaHRzXG4pOiBudW1iZXIge1xuICBjb25zdCB3ZWlnaHRlZCA9XG4gICAgd2VpZ2h0cy5hbHBoYSAqIGNvcnJlY3RuZXNzICtcbiAgICB3ZWlnaHRzLmJldGEgKiBxdWFsaXR5ICtcbiAgICB3ZWlnaHRzLmdhbW1hICogbGVhcm5lZDtcbiAgY29uc3QgdG90YWwgPSB3ZWlnaHRzLmFscGhhICsgd2VpZ2h0cy5iZXRhICsgd2VpZ2h0cy5nYW1tYTtcbiAgcmV0dXJuIHRvdGFsID4gMCA/IGNsYW1wKHdlaWdodGVkIC8gdG90YWwpIDogY2xhbXAod2VpZ2h0ZWQpO1xufVxuXG5mdW5jdGlvbiBhZ2dyZWdhdGVFdmFsdWF0b3JTY29yZXMoXG4gIGNhbmRpZGF0ZXM6IFRvdXJuYW1lbnRDYW5kaWRhdGVbXSxcbiAgZXZhbHVhdG9yV2VpZ2h0czogTWFwPHN0cmluZywgbnVtYmVyPlxuKToge1xuICBhZ2dyZWdhdGVkRXZhbHVhdG9yU2NvcmVzOiBNYXA8c3RyaW5nLCBudW1iZXI+O1xuICBwYWlyd2lzZTogUGFpcndpc2VXaW5zO1xuICBldmFsdWF0b3JCcmVha2Rvd246IFJlY29yZDxzdHJpbmcsIEV2YWx1YXRvclNjb3JlW10+O1xufSB7XG4gIGNvbnN0IHBhaXJ3aXNlOiBQYWlyd2lzZVdpbnMgPSB7fTtcbiAgY29uc3QgYWdncmVnYXRlZCA9IG5ldyBNYXA8c3RyaW5nLCBudW1iZXI+KCk7XG4gIGNvbnN0IGV2YWx1YXRvckJyZWFrZG93bjogUmVjb3JkPHN0cmluZywgRXZhbHVhdG9yU2NvcmVbXT4gPSB7fTtcblxuICBpZiAoY2FuZGlkYXRlcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4geyBhZ2dyZWdhdGVkRXZhbHVhdG9yU2NvcmVzOiBhZ2dyZWdhdGVkLCBwYWlyd2lzZSwgZXZhbHVhdG9yQnJlYWtkb3duIH07XG4gIH1cblxuICAvLyBQcmUtc2l6ZSBmb3Igc21hbGwgdG91cm5hbWVudHMgdG8gYXZvaWQgdW5uZWNlc3NhcnkgTyhuXjIpIHdoZW4gbm90IG5lZWRlZFxuICBjb25zdCB0d29DYW5kaWRhdGVGYXN0UGF0aCA9IGNhbmRpZGF0ZXMubGVuZ3RoIDw9IDI7XG5cbiAgY29uc3QgY2FuZGlkYXRlSWRzID0gY2FuZGlkYXRlcy5tYXAoKGMpID0+IGMuaWQpO1xuICBmb3IgKGNvbnN0IGlkIG9mIGNhbmRpZGF0ZUlkcykge1xuICAgIHBhaXJ3aXNlW2lkXSA9IHt9O1xuICAgIGZvciAoY29uc3Qgb3RoZXIgb2YgY2FuZGlkYXRlSWRzKSB7XG4gICAgICBpZiAoaWQgIT09IG90aGVyKSBwYWlyd2lzZVtpZF1bb3RoZXJdID0gMDtcbiAgICB9XG4gIH1cblxuICAvLyBDb2xsZWN0IHNjb3JlcyBwZXIgZXZhbHVhdG9yXG4gIGNvbnN0IHNjb3Jlc0J5RXZhbHVhdG9yID0gbmV3IE1hcDxzdHJpbmcsIENhbmRpZGF0ZUV2YWx1YXRvclNjb3JlW10+KCk7XG4gIGZvciAoY29uc3QgY2FuZGlkYXRlIG9mIGNhbmRpZGF0ZXMpIHtcbiAgICBmb3IgKGNvbnN0IHNjb3JlIG9mIGNhbmRpZGF0ZS5ldmFsdWF0b3JTY29yZXMgPz8gW10pIHtcbiAgICAgIGlmICghc2NvcmVzQnlFdmFsdWF0b3IuaGFzKHNjb3JlLmV2YWx1YXRvcklkKSkge1xuICAgICAgICBzY29yZXNCeUV2YWx1YXRvci5zZXQoc2NvcmUuZXZhbHVhdG9ySWQsIFtdKTtcbiAgICAgIH1cbiAgICAgIHNjb3Jlc0J5RXZhbHVhdG9yLmdldChzY29yZS5ldmFsdWF0b3JJZCkhLnB1c2goe1xuICAgICAgICBldmFsdWF0b3JJZDogc2NvcmUuZXZhbHVhdG9ySWQsXG4gICAgICAgIHNjb3JlOiBjbGFtcChzY29yZS5zY29yZSksXG4gICAgICAgIHdlaWdodDogc2NvcmUud2VpZ2h0LFxuICAgICAgICBub3Rlczogc2NvcmUubm90ZXMsXG4gICAgICAgIGNhbmRpZGF0ZUlkOiBjYW5kaWRhdGUuaWQsXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvLyBJZiBubyBldmFsdWF0b3Igc2NvcmVzIHByb3ZpZGVkLCBmYWxsIGJhY2sgdG8gbmV1dHJhbCByYW5raW5nc1xuICBpZiAoc2NvcmVzQnlFdmFsdWF0b3Iuc2l6ZSA9PT0gMCkge1xuICAgIGNvbnN0IGZhbGxiYWNrOiBDYW5kaWRhdGVFdmFsdWF0b3JTY29yZVtdID0gW107XG4gICAgZm9yIChjb25zdCBjYW5kaWRhdGUgb2YgY2FuZGlkYXRlcykge1xuICAgICAgZmFsbGJhY2sucHVzaCh7XG4gICAgICAgIGV2YWx1YXRvcklkOiAncmV3YXJkLWZhbGxiYWNrJyxcbiAgICAgICAgc2NvcmU6IDAuNSxcbiAgICAgICAgd2VpZ2h0OiAxLFxuICAgICAgICBjYW5kaWRhdGVJZDogY2FuZGlkYXRlLmlkLFxuICAgICAgfSk7XG4gICAgfVxuICAgIHNjb3Jlc0J5RXZhbHVhdG9yLnNldCgncmV3YXJkLWZhbGxiYWNrJywgZmFsbGJhY2spO1xuICB9XG5cbiAgbGV0IHRvdGFsQm9yZGFXZWlnaHQgPSAwO1xuXG4gIGZvciAoY29uc3QgW2V2YWx1YXRvcklkLCByYXdTY29yZXNdIG9mIHNjb3Jlc0J5RXZhbHVhdG9yLmVudHJpZXMoKSkge1xuICAgIGNvbnN0IHdlaWdodCA9IGV2YWx1YXRvcldlaWdodHMuZ2V0KGV2YWx1YXRvcklkKSA/PyAxO1xuICAgIHRvdGFsQm9yZGFXZWlnaHQgKz0gd2VpZ2h0ICogTWF0aC5tYXgoMSwgY2FuZGlkYXRlcy5sZW5ndGggLSAxKTtcblxuICAgIC8vIFNvcnQgZGVzY2VuZGluZyBieSBzY29yZSB0byBhc3NpZ24gcmFua3MgKEJvcmRhKVxuICAgIGNvbnN0IHJhbmtlZCA9IHJhd1Njb3Jlc1xuICAgICAgLmZpbHRlcigoZW50cnkpID0+IHR5cGVvZiBlbnRyeS5zY29yZSA9PT0gJ251bWJlcicpXG4gICAgICAuc29ydCgoYSwgYikgPT4gKGIuc2NvcmUgPz8gMCkgLSAoYS5zY29yZSA/PyAwKSk7XG5cbiAgICBldmFsdWF0b3JCcmVha2Rvd25bZXZhbHVhdG9ySWRdID0gcmFua2VkLm1hcCgoeyBjYW5kaWRhdGVJZDogXywgLi4ucmVzdCB9KSA9PiByZXN0IGFzIEV2YWx1YXRvclNjb3JlKTtcblxuICAgIHJhbmtlZC5mb3JFYWNoKChlbnRyeSwgaWR4KSA9PiB7XG4gICAgICBjb25zdCBjYW5kaWRhdGVJZCA9IChlbnRyeSBhcyB1bmtub3duIGFzIHsgY2FuZGlkYXRlSWQ6IHN0cmluZyB9KS5jYW5kaWRhdGVJZDtcbiAgICAgIGNvbnN0IGJvcmRhUG9pbnRzID0gKGNhbmRpZGF0ZXMubGVuZ3RoIC0gaWR4IC0gMSkgKiB3ZWlnaHQ7XG4gICAgICBhZ2dyZWdhdGVkLnNldChjYW5kaWRhdGVJZCwgKGFnZ3JlZ2F0ZWQuZ2V0KGNhbmRpZGF0ZUlkKSA/PyAwKSArIGJvcmRhUG9pbnRzKTtcbiAgICB9KTtcblxuICAgIC8vIFBhaXJ3aXNlIHdpbnMgZm9yIHRoaXMgZXZhbHVhdG9yIChsaWdodHdlaWdodCBwYXRoIGZvciA8PTIgY2FuZGlkYXRlcylcbiAgICBpZiAodHdvQ2FuZGlkYXRlRmFzdFBhdGggJiYgcmFua2VkLmxlbmd0aCA9PT0gMikge1xuICAgICAgY29uc3QgaGlnaGVyID0gcmFua2VkWzBdIGFzIHVua25vd24gYXMgeyBjYW5kaWRhdGVJZDogc3RyaW5nOyBzY29yZTogbnVtYmVyIH07XG4gICAgICBjb25zdCBsb3dlciA9IHJhbmtlZFsxXSBhcyB1bmtub3duIGFzIHsgY2FuZGlkYXRlSWQ6IHN0cmluZzsgc2NvcmU6IG51bWJlciB9O1xuICAgICAgaWYgKGhpZ2hlci5zY29yZSA9PT0gbG93ZXIuc2NvcmUpIHtcbiAgICAgICAgcGFpcndpc2VbaGlnaGVyLmNhbmRpZGF0ZUlkXVtsb3dlci5jYW5kaWRhdGVJZF0gKz0gd2VpZ2h0ICogMC41O1xuICAgICAgICBwYWlyd2lzZVtsb3dlci5jYW5kaWRhdGVJZF1baGlnaGVyLmNhbmRpZGF0ZUlkXSArPSB3ZWlnaHQgKiAwLjU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwYWlyd2lzZVtoaWdoZXIuY2FuZGlkYXRlSWRdW2xvd2VyLmNhbmRpZGF0ZUlkXSArPSB3ZWlnaHQ7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmFua2VkLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGZvciAobGV0IGogPSBpICsgMTsgaiA8IHJhbmtlZC5sZW5ndGg7IGorKykge1xuICAgICAgICAgIGNvbnN0IGhpZ2hlciA9IHJhbmtlZFtpXSBhcyB1bmtub3duIGFzIHsgY2FuZGlkYXRlSWQ6IHN0cmluZzsgc2NvcmU6IG51bWJlciB9O1xuICAgICAgICAgIGNvbnN0IGxvd2VyID0gcmFua2VkW2pdIGFzIHVua25vd24gYXMgeyBjYW5kaWRhdGVJZDogc3RyaW5nOyBzY29yZTogbnVtYmVyIH07XG4gICAgICAgICAgaWYgKGhpZ2hlci5zY29yZSA9PT0gbG93ZXIuc2NvcmUpIHtcbiAgICAgICAgICAgIHBhaXJ3aXNlW2hpZ2hlci5jYW5kaWRhdGVJZF1bbG93ZXIuY2FuZGlkYXRlSWRdICs9IHdlaWdodCAqIDAuNTtcbiAgICAgICAgICAgIHBhaXJ3aXNlW2xvd2VyLmNhbmRpZGF0ZUlkXVtoaWdoZXIuY2FuZGlkYXRlSWRdICs9IHdlaWdodCAqIDAuNTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcGFpcndpc2VbaGlnaGVyLmNhbmRpZGF0ZUlkXVtsb3dlci5jYW5kaWRhdGVJZF0gKz0gd2VpZ2h0O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIE5vcm1hbGl6ZSBhZ2dyZWdhdGVkIEJvcmRhIHNjb3JlcyBpbnRvIFswLDFdXG4gIGlmICh0b3RhbEJvcmRhV2VpZ2h0ID4gMCkge1xuICAgIGZvciAoY29uc3QgW2NhbmRpZGF0ZUlkLCBwb2ludHNdIG9mIGFnZ3JlZ2F0ZWQuZW50cmllcygpKSB7XG4gICAgICBhZ2dyZWdhdGVkLnNldChjYW5kaWRhdGVJZCwgY2xhbXAocG9pbnRzIC8gdG90YWxCb3JkYVdlaWdodCkpO1xuICAgIH1cbiAgfVxuXG4gIC8vIEVuc3VyZSBldmVyeSBjYW5kaWRhdGUgaGFzIGFuIGVudHJ5XG4gIGZvciAoY29uc3QgY2FuZGlkYXRlSWQgb2YgY2FuZGlkYXRlSWRzKSB7XG4gICAgaWYgKCFhZ2dyZWdhdGVkLmhhcyhjYW5kaWRhdGVJZCkpIHtcbiAgICAgIGFnZ3JlZ2F0ZWQuc2V0KGNhbmRpZGF0ZUlkLCAwLjUpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7IGFnZ3JlZ2F0ZWRFdmFsdWF0b3JTY29yZXM6IGFnZ3JlZ2F0ZWQsIHBhaXJ3aXNlLCBldmFsdWF0b3JCcmVha2Rvd24gfTtcbn1cblxuZnVuY3Rpb24gY2xhbXAodmFsdWU6IG51bWJlciwgbWluID0gMCwgbWF4ID0gMSk6IG51bWJlciB7XG4gIGlmIChOdW1iZXIuaXNOYU4odmFsdWUpKSByZXR1cm4gbWluO1xuICByZXR1cm4gTWF0aC5tYXgobWluLCBNYXRoLm1pbihtYXgsIHZhbHVlKSk7XG59XG5cbmZ1bmN0aW9uIGNvbXB1dGVIdW1hbkFjY3VyYWN5KHJhbmtJbmRleDogbnVtYmVyLCB0b3RhbDogbnVtYmVyKTogbnVtYmVyIHtcbiAgaWYgKHRvdGFsIDw9IDEpIHJldHVybiAxO1xuICBjb25zdCBtYXhJbmRleCA9IE1hdGgubWF4KDEsIHRvdGFsIC0gMSk7XG4gIGNvbnN0IHJlbGF0aXZlID0gMSAtIHJhbmtJbmRleCAvIG1heEluZGV4O1xuICByZXR1cm4gY2xhbXAocmVsYXRpdmUpO1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBbUZPLE1BQU1BLDRCQUFnRCxHQUFBQyxPQUFBLENBQUFELDRCQUFBLEdBQUc7RUFDOURFLEtBQUssRUFBRSxHQUFHO0VBQ1ZDLElBQUksRUFBRSxJQUFJO0VBQ1ZDLEtBQUssRUFBRTtBQUNULENBQUM7QUFnQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDTyxTQUFTQyxpQkFBaUJBLENBQy9CQyxJQUFvQixFQUNwQkMsVUFBaUMsRUFDakNDLE9BQTBCLEdBQUcsQ0FBQyxDQUFDLEVBQ1o7RUFDbkIsTUFBTUMsYUFBYSxHQUFHRCxPQUFPLENBQUNDLGFBQWEsSUFBSSxDQUFDO0VBQ2hELE1BQU1DLGlCQUFpQixHQUFHSCxVQUFVLENBQUNJLEtBQUssQ0FBQyxDQUFDLEVBQUVDLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUMsRUFBRUosYUFBYSxDQUFDLENBQUM7O0VBRXpFO0VBQ0EsSUFBSUMsaUJBQWlCLENBQUNJLE1BQU0sS0FBSyxDQUFDLEVBQUU7SUFDbEMsTUFBTUMsSUFBSSxHQUFHTCxpQkFBaUIsQ0FBQyxDQUFDLENBQUU7SUFDbEMsTUFBTU0sV0FBVyxHQUFHQyxnQkFBZ0IsQ0FBQ0YsSUFBSSxDQUFDRyxPQUFPLENBQUM7SUFDbEQsTUFBTUMsT0FBTyxHQUFHQyxZQUFZLENBQUNMLElBQUksQ0FBQ0csT0FBTyxFQUFFVixPQUFPLENBQUNhLGlCQUFpQixJQUFJLElBQUksQ0FBQztJQUM3RSxNQUFNQyxPQUFPLEdBQUdDLG1CQUFtQixDQUFDUixJQUFJLENBQUNTLE9BQU8sQ0FBQztJQUNqRCxNQUFNQyxjQUFjLEdBQUdDLGFBQWEsQ0FBQ1YsV0FBVyxFQUFFRyxPQUFPLEVBQUVHLE9BQU8sRUFBRWQsT0FBTyxDQUFDbUIsYUFBYSxJQUFJM0IsNEJBQTRCLENBQUM7SUFFMUgsTUFBTTRCLE1BQXlCLEdBQUcsQ0FBQztNQUNqQ0MsV0FBVyxFQUFFZCxJQUFJLENBQUNlLEVBQUU7TUFDcEJMLGNBQWM7TUFDZE0sYUFBYSxFQUFFLENBQUM7TUFDaEJDLElBQUksRUFBRSxDQUFDO01BQ1BDLGdCQUFnQixFQUFFakIsV0FBVztNQUM3QmtCLFlBQVksRUFBRWYsT0FBTztNQUNyQmdCLFlBQVksRUFBRWIsT0FBTztNQUNyQmMsY0FBYyxFQUFFWDtJQUNsQixDQUFDLENBQUM7SUFFRixPQUFPO01BQ0xuQixJQUFJO01BQ0pzQixNQUFNO01BQ05TLFFBQVEsRUFBRSxDQUFDLENBQUM7TUFDWkMsa0JBQWtCLEVBQUUsQ0FBQztJQUN2QixDQUFDO0VBQ0g7RUFFQSxNQUFNWCxhQUFhLEdBQUduQixPQUFPLENBQUNtQixhQUFhLElBQUkzQiw0QkFBNEI7RUFDM0UsTUFBTXVDLGdCQUFnQixHQUFHLElBQUlDLEdBQUcsQ0FBaUIsQ0FBQztFQUNsRCxLQUFLLE1BQU1DLFNBQVMsSUFBSWpDLE9BQU8sQ0FBQ2tDLFVBQVUsSUFBSSxFQUFFLEVBQUU7SUFDaEQsTUFBTUMsU0FBUyxHQUFHRixTQUFTLENBQUNHLEdBQUcsR0FBRyxDQUFDLEdBQUdoQyxJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQzRCLFNBQVMsQ0FBQ0csR0FBRyxHQUFHLElBQUksSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDO0lBQ3BGTCxnQkFBZ0IsQ0FBQ00sR0FBRyxDQUFDSixTQUFTLENBQUNYLEVBQUUsRUFBRSxDQUFDVyxTQUFTLENBQUNLLE1BQU0sSUFBSSxDQUFDLElBQUlILFNBQVMsQ0FBQztFQUN6RTs7RUFFQTtFQUNBLE1BQU07SUFBRUkseUJBQXlCO0lBQUVWLFFBQVE7SUFBRUM7RUFBbUIsQ0FBQyxHQUFHVSx3QkFBd0IsQ0FDMUZ0QyxpQkFBaUIsRUFDakI2QixnQkFDRixDQUFDO0VBRUQsTUFBTVgsTUFBeUIsR0FBR2xCLGlCQUFpQixDQUFDdUMsR0FBRyxDQUFFQyxTQUFTLElBQUs7SUFDckUsTUFBTWxDLFdBQVcsR0FBR0MsZ0JBQWdCLENBQUNpQyxTQUFTLENBQUNoQyxPQUFPLENBQUM7SUFDdkQsTUFBTUMsT0FBTyxHQUFHQyxZQUFZLENBQUM4QixTQUFTLENBQUNoQyxPQUFPLEVBQUVWLE9BQU8sQ0FBQ2EsaUJBQWlCLElBQUksSUFBSSxDQUFDO0lBQ2xGLE1BQU1DLE9BQU8sR0FBR0MsbUJBQW1CLENBQUMyQixTQUFTLENBQUMxQixPQUFPLENBQUM7SUFDdEQsTUFBTTJCLFdBQVcsR0FBR3pCLGFBQWEsQ0FBQ1YsV0FBVyxFQUFFRyxPQUFPLEVBQUVHLE9BQU8sRUFBRUssYUFBYSxDQUFDO0lBQy9FLE1BQU1TLGNBQWMsR0FBR1cseUJBQXlCLENBQUNLLEdBQUcsQ0FBQ0YsU0FBUyxDQUFDcEIsRUFBRSxDQUFDLElBQUlxQixXQUFXOztJQUVqRjtJQUNBLE1BQU0xQixjQUFjLEdBQUc0QixLQUFLLENBQUMsSUFBSSxHQUFHRixXQUFXLEdBQUcsSUFBSSxHQUFHZixjQUFjLENBQUM7SUFFeEUsT0FBTztNQUNMUCxXQUFXLEVBQUVxQixTQUFTLENBQUNwQixFQUFFO01BQ3pCTCxjQUFjO01BQ2RNLGFBQWEsRUFBRSxDQUFDO01BQ2hCQyxJQUFJLEVBQUUsQ0FBQztNQUFFO01BQ1RDLGdCQUFnQixFQUFFakIsV0FBVztNQUM3QmtCLFlBQVksRUFBRWYsT0FBTztNQUNyQmdCLFlBQVksRUFBRWIsT0FBTztNQUNyQmM7SUFDRixDQUFDO0VBQ0gsQ0FBQyxDQUFDO0VBRUZSLE1BQU0sQ0FBQzBCLElBQUksQ0FBQyxDQUFDQyxDQUFDLEVBQUVDLENBQUMsS0FBS0EsQ0FBQyxDQUFDL0IsY0FBYyxHQUFHOEIsQ0FBQyxDQUFDOUIsY0FBYyxDQUFDO0VBQzFERyxNQUFNLENBQUM2QixPQUFPLENBQUMsQ0FBQ0MsS0FBSyxFQUFFQyxHQUFHLEtBQUs7SUFDN0JELEtBQUssQ0FBQzFCLElBQUksR0FBRzJCLEdBQUcsR0FBRyxDQUFDO0lBQ3BCRCxLQUFLLENBQUMzQixhQUFhLEdBQUc2QixvQkFBb0IsQ0FBQ0QsR0FBRyxFQUFFL0IsTUFBTSxDQUFDZCxNQUFNLENBQUM7RUFDaEUsQ0FBQyxDQUFDO0VBRUYsT0FBTztJQUNMUixJQUFJO0lBQ0pzQixNQUFNO0lBQ05TLFFBQVE7SUFDUkM7RUFDRixDQUFDO0FBQ0g7O0FBRUE7QUFDQTtBQUNBOztBQUVBLFNBQVNyQixnQkFBZ0JBLENBQUNDLE9BQTBCLEVBQVU7RUFDNUQsSUFBSSxDQUFDQSxPQUFPLEVBQUUsT0FBTyxHQUFHO0VBRXhCLE1BQU0yQyxTQUFTLEdBQUczQyxPQUFPLENBQUM0QyxnQkFBZ0IsSUFBSSxDQUFDO0VBQy9DLE1BQU1DLEtBQUssR0FBRzdDLE9BQU8sQ0FBQzhDLFdBQVcsSUFBSSxDQUFDO0VBQ3RDLE1BQU1DLFFBQVEsR0FBRy9DLE9BQU8sQ0FBQ2dELFdBQVcsSUFBSSxDQUFDO0VBQ3pDLE1BQU1DLFdBQVcsR0FBR2pELE9BQU8sQ0FBQ2tELGFBQWEsR0FBR3hELElBQUksQ0FBQ3lELEdBQUcsQ0FBQyxDQUFDLEVBQUVuRCxPQUFPLENBQUNrRCxhQUFhLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQztFQUV0RixJQUFJRSxLQUFLLEdBQUdULFNBQVMsR0FBRyxJQUFJLEdBQUdFLEtBQUssR0FBRyxJQUFJLEdBQUdJLFdBQVcsR0FBRyxHQUFHO0VBQy9ELElBQUlGLFFBQVEsR0FBRyxDQUFDLEVBQUU7SUFDaEJLLEtBQUssSUFBSTFELElBQUksQ0FBQ3lELEdBQUcsQ0FBQyxJQUFJLEVBQUVKLFFBQVEsR0FBRyxHQUFHLENBQUM7RUFDekM7RUFFQSxPQUFPWixLQUFLLENBQUNpQixLQUFLLENBQUM7QUFDckI7QUFFQSxTQUFTbEQsWUFBWUEsQ0FBQ0YsT0FBMEIsRUFBRUcsaUJBQWlCLEdBQUcsSUFBSSxFQUFVO0VBQ2xGLElBQUksQ0FBQ0gsT0FBTyxFQUFFLE9BQU8sR0FBRztFQUV4QixNQUFNcUQsY0FBYyxHQUFHckQsT0FBTyxDQUFDcUQsY0FBYyxJQUFJLEdBQUc7RUFDcEQsTUFBTUMsV0FBVyxHQUFHdEQsT0FBTyxDQUFDc0QsV0FBVyxJQUFJLEdBQUc7RUFDOUMsTUFBTUMsbUJBQW1CLEdBQ3ZCLE9BQU92RCxPQUFPLENBQUN3RCxlQUFlLEtBQUssUUFBUSxHQUN2Q3hELE9BQU8sQ0FBQ3dELGVBQWUsR0FBRyxDQUFDLEdBQ3pCLEdBQUcsR0FDSCxJQUFJLEdBQ04sSUFBSTtFQUVWLE1BQU1DLFdBQVcsR0FDZnpELE9BQU8sQ0FBQ3lELFdBQVcsS0FDbEJ0RCxpQkFBaUIsSUFBSUgsT0FBTyxDQUFDMEQsUUFBUSxHQUFHLENBQUMsR0FBR3ZCLEtBQUssQ0FBQ25DLE9BQU8sQ0FBQzBELFFBQVEsR0FBRyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUM7RUFFcEYsTUFBTUMsaUJBQWlCLEdBQUczRCxPQUFPLENBQUM0RCxpQkFBaUIsR0FBR2xFLElBQUksQ0FBQ3lELEdBQUcsQ0FBQyxHQUFHLEVBQUVuRCxPQUFPLENBQUM0RCxpQkFBaUIsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO0VBQ3pHLE1BQU1DLGNBQWMsR0FBRzdELE9BQU8sQ0FBQzhELFFBQVEsR0FBR3BFLElBQUksQ0FBQ3lELEdBQUcsQ0FBQyxHQUFHLEVBQUVuRCxPQUFPLENBQUM4RCxRQUFRLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQztFQUVwRixJQUFJVixLQUFLLEdBQUdDLGNBQWMsR0FBRyxJQUFJLEdBQUdDLFdBQVcsR0FBRyxJQUFJLEdBQUdHLFdBQVcsR0FBRyxJQUFJLEdBQUdGLG1CQUFtQixHQUFHLElBQUk7RUFDeEdILEtBQUssSUFBSU8saUJBQWlCLEdBQUdFLGNBQWM7RUFFM0MsT0FBTzFCLEtBQUssQ0FBQ2lCLEtBQUssQ0FBQztBQUNyQjtBQUVBLFNBQVMvQyxtQkFBbUJBLENBQUNDLE9BQTBCLEVBQVU7RUFDL0QsSUFBSSxDQUFDQSxPQUFPLEVBQUUsT0FBTyxHQUFHO0VBRXhCLE1BQU15RCxXQUFXLEdBQUd6RCxPQUFPLENBQUMwRCxnQkFBZ0I7RUFDNUMsTUFBTUMsS0FBSyxHQUFHM0QsT0FBTyxDQUFDNEQsZUFBZTtFQUNyQyxNQUFNQyxJQUFJLEdBQUc3RCxPQUFPLENBQUM4RCxjQUFjO0VBRW5DLE1BQU1DLElBQUksR0FBRyxPQUFPTixXQUFXLEtBQUssUUFBUSxHQUFHQSxXQUFXLEdBQUcsR0FBRztFQUNoRSxNQUFNTyxZQUFZLEdBQUcsT0FBT0wsS0FBSyxLQUFLLFFBQVEsR0FBRyxDQUFDSSxJQUFJLEdBQUdKLEtBQUssSUFBSSxDQUFDLEdBQUdJLElBQUk7RUFDMUUsTUFBTUUsUUFBUSxHQUFHLE9BQU9KLElBQUksS0FBSyxRQUFRLEdBQUcsR0FBRyxHQUFHRyxZQUFZLEdBQUcsR0FBRyxHQUFHSCxJQUFJLEdBQUdHLFlBQVk7RUFFMUYsT0FBT25DLEtBQUssQ0FBQ29DLFFBQVEsQ0FBQztBQUN4QjtBQUVBLFNBQVMvRCxhQUFhQSxDQUNwQlYsV0FBbUIsRUFDbkJHLE9BQWUsRUFDZkcsT0FBZSxFQUNmb0UsT0FBMkIsRUFDbkI7RUFDUixNQUFNQyxRQUFRLEdBQ1pELE9BQU8sQ0FBQ3hGLEtBQUssR0FBR2MsV0FBVyxHQUMzQjBFLE9BQU8sQ0FBQ3ZGLElBQUksR0FBR2dCLE9BQU8sR0FDdEJ1RSxPQUFPLENBQUN0RixLQUFLLEdBQUdrQixPQUFPO0VBQ3pCLE1BQU1zRSxLQUFLLEdBQUdGLE9BQU8sQ0FBQ3hGLEtBQUssR0FBR3dGLE9BQU8sQ0FBQ3ZGLElBQUksR0FBR3VGLE9BQU8sQ0FBQ3RGLEtBQUs7RUFDMUQsT0FBT3dGLEtBQUssR0FBRyxDQUFDLEdBQUd2QyxLQUFLLENBQUNzQyxRQUFRLEdBQUdDLEtBQUssQ0FBQyxHQUFHdkMsS0FBSyxDQUFDc0MsUUFBUSxDQUFDO0FBQzlEO0FBRUEsU0FBUzNDLHdCQUF3QkEsQ0FDL0J6QyxVQUFpQyxFQUNqQ2dDLGdCQUFxQyxFQUtyQztFQUNBLE1BQU1GLFFBQXNCLEdBQUcsQ0FBQyxDQUFDO0VBQ2pDLE1BQU13RCxVQUFVLEdBQUcsSUFBSXJELEdBQUcsQ0FBaUIsQ0FBQztFQUM1QyxNQUFNRixrQkFBb0QsR0FBRyxDQUFDLENBQUM7RUFFL0QsSUFBSS9CLFVBQVUsQ0FBQ08sTUFBTSxLQUFLLENBQUMsRUFBRTtJQUMzQixPQUFPO01BQUVpQyx5QkFBeUIsRUFBRThDLFVBQVU7TUFBRXhELFFBQVE7TUFBRUM7SUFBbUIsQ0FBQztFQUNoRjs7RUFFQTtFQUNBLE1BQU13RCxvQkFBb0IsR0FBR3ZGLFVBQVUsQ0FBQ08sTUFBTSxJQUFJLENBQUM7RUFFbkQsTUFBTWlGLFlBQVksR0FBR3hGLFVBQVUsQ0FBQzBDLEdBQUcsQ0FBRStDLENBQUMsSUFBS0EsQ0FBQyxDQUFDbEUsRUFBRSxDQUFDO0VBQ2hELEtBQUssTUFBTUEsRUFBRSxJQUFJaUUsWUFBWSxFQUFFO0lBQzdCMUQsUUFBUSxDQUFDUCxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDakIsS0FBSyxNQUFNbUUsS0FBSyxJQUFJRixZQUFZLEVBQUU7TUFDaEMsSUFBSWpFLEVBQUUsS0FBS21FLEtBQUssRUFBRTVELFFBQVEsQ0FBQ1AsRUFBRSxDQUFDLENBQUNtRSxLQUFLLENBQUMsR0FBRyxDQUFDO0lBQzNDO0VBQ0Y7O0VBRUE7RUFDQSxNQUFNQyxpQkFBaUIsR0FBRyxJQUFJMUQsR0FBRyxDQUFvQyxDQUFDO0VBQ3RFLEtBQUssTUFBTVUsU0FBUyxJQUFJM0MsVUFBVSxFQUFFO0lBQ2xDLEtBQUssTUFBTStELEtBQUssSUFBSXBCLFNBQVMsQ0FBQ2lELGVBQWUsSUFBSSxFQUFFLEVBQUU7TUFDbkQsSUFBSSxDQUFDRCxpQkFBaUIsQ0FBQ0UsR0FBRyxDQUFDOUIsS0FBSyxDQUFDK0IsV0FBVyxDQUFDLEVBQUU7UUFDN0NILGlCQUFpQixDQUFDckQsR0FBRyxDQUFDeUIsS0FBSyxDQUFDK0IsV0FBVyxFQUFFLEVBQUUsQ0FBQztNQUM5QztNQUNBSCxpQkFBaUIsQ0FBQzlDLEdBQUcsQ0FBQ2tCLEtBQUssQ0FBQytCLFdBQVcsQ0FBQyxDQUFFQyxJQUFJLENBQUM7UUFDN0NELFdBQVcsRUFBRS9CLEtBQUssQ0FBQytCLFdBQVc7UUFDOUIvQixLQUFLLEVBQUVqQixLQUFLLENBQUNpQixLQUFLLENBQUNBLEtBQUssQ0FBQztRQUN6QnhCLE1BQU0sRUFBRXdCLEtBQUssQ0FBQ3hCLE1BQU07UUFDcEJ5RCxLQUFLLEVBQUVqQyxLQUFLLENBQUNpQyxLQUFLO1FBQ2xCMUUsV0FBVyxFQUFFcUIsU0FBUyxDQUFDcEI7TUFDekIsQ0FBQyxDQUFDO0lBQ0o7RUFDRjs7RUFFQTtFQUNBLElBQUlvRSxpQkFBaUIsQ0FBQ00sSUFBSSxLQUFLLENBQUMsRUFBRTtJQUNoQyxNQUFNQyxRQUFtQyxHQUFHLEVBQUU7SUFDOUMsS0FBSyxNQUFNdkQsU0FBUyxJQUFJM0MsVUFBVSxFQUFFO01BQ2xDa0csUUFBUSxDQUFDSCxJQUFJLENBQUM7UUFDWkQsV0FBVyxFQUFFLGlCQUFpQjtRQUM5Qi9CLEtBQUssRUFBRSxHQUFHO1FBQ1Z4QixNQUFNLEVBQUUsQ0FBQztRQUNUakIsV0FBVyxFQUFFcUIsU0FBUyxDQUFDcEI7TUFDekIsQ0FBQyxDQUFDO0lBQ0o7SUFDQW9FLGlCQUFpQixDQUFDckQsR0FBRyxDQUFDLGlCQUFpQixFQUFFNEQsUUFBUSxDQUFDO0VBQ3BEO0VBRUEsSUFBSUMsZ0JBQWdCLEdBQUcsQ0FBQztFQUV4QixLQUFLLE1BQU0sQ0FBQ0wsV0FBVyxFQUFFTSxTQUFTLENBQUMsSUFBSVQsaUJBQWlCLENBQUNVLE9BQU8sQ0FBQyxDQUFDLEVBQUU7SUFDbEUsTUFBTTlELE1BQU0sR0FBR1AsZ0JBQWdCLENBQUNhLEdBQUcsQ0FBQ2lELFdBQVcsQ0FBQyxJQUFJLENBQUM7SUFDckRLLGdCQUFnQixJQUFJNUQsTUFBTSxHQUFHbEMsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQyxFQUFFTixVQUFVLENBQUNPLE1BQU0sR0FBRyxDQUFDLENBQUM7O0lBRS9EO0lBQ0EsTUFBTWMsTUFBTSxHQUFHK0UsU0FBUyxDQUNyQkUsTUFBTSxDQUFFbkQsS0FBSyxJQUFLLE9BQU9BLEtBQUssQ0FBQ1ksS0FBSyxLQUFLLFFBQVEsQ0FBQyxDQUNsRGhCLElBQUksQ0FBQyxDQUFDQyxDQUFDLEVBQUVDLENBQUMsS0FBSyxDQUFDQSxDQUFDLENBQUNjLEtBQUssSUFBSSxDQUFDLEtBQUtmLENBQUMsQ0FBQ2UsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBRWxEaEMsa0JBQWtCLENBQUMrRCxXQUFXLENBQUMsR0FBR3pFLE1BQU0sQ0FBQ3FCLEdBQUcsQ0FBQyxDQUFDO01BQUVwQixXQUFXLEVBQUVpRixDQUFDO01BQUUsR0FBR0M7SUFBSyxDQUFDLEtBQUtBLElBQXNCLENBQUM7SUFFckduRixNQUFNLENBQUM2QixPQUFPLENBQUMsQ0FBQ0MsS0FBSyxFQUFFQyxHQUFHLEtBQUs7TUFDN0IsTUFBTTlCLFdBQVcsR0FBSTZCLEtBQUssQ0FBd0M3QixXQUFXO01BQzdFLE1BQU1tRixXQUFXLEdBQUcsQ0FBQ3pHLFVBQVUsQ0FBQ08sTUFBTSxHQUFHNkMsR0FBRyxHQUFHLENBQUMsSUFBSWIsTUFBTTtNQUMxRCtDLFVBQVUsQ0FBQ2hELEdBQUcsQ0FBQ2hCLFdBQVcsRUFBRSxDQUFDZ0UsVUFBVSxDQUFDekMsR0FBRyxDQUFDdkIsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJbUYsV0FBVyxDQUFDO0lBQy9FLENBQUMsQ0FBQzs7SUFFRjtJQUNBLElBQUlsQixvQkFBb0IsSUFBSWxFLE1BQU0sQ0FBQ2QsTUFBTSxLQUFLLENBQUMsRUFBRTtNQUMvQyxNQUFNbUcsTUFBTSxHQUFHckYsTUFBTSxDQUFDLENBQUMsQ0FBc0Q7TUFDN0UsTUFBTXNGLEtBQUssR0FBR3RGLE1BQU0sQ0FBQyxDQUFDLENBQXNEO01BQzVFLElBQUlxRixNQUFNLENBQUMzQyxLQUFLLEtBQUs0QyxLQUFLLENBQUM1QyxLQUFLLEVBQUU7UUFDaENqQyxRQUFRLENBQUM0RSxNQUFNLENBQUNwRixXQUFXLENBQUMsQ0FBQ3FGLEtBQUssQ0FBQ3JGLFdBQVcsQ0FBQyxJQUFJaUIsTUFBTSxHQUFHLEdBQUc7UUFDL0RULFFBQVEsQ0FBQzZFLEtBQUssQ0FBQ3JGLFdBQVcsQ0FBQyxDQUFDb0YsTUFBTSxDQUFDcEYsV0FBVyxDQUFDLElBQUlpQixNQUFNLEdBQUcsR0FBRztNQUNqRSxDQUFDLE1BQU07UUFDTFQsUUFBUSxDQUFDNEUsTUFBTSxDQUFDcEYsV0FBVyxDQUFDLENBQUNxRixLQUFLLENBQUNyRixXQUFXLENBQUMsSUFBSWlCLE1BQU07TUFDM0Q7SUFDRixDQUFDLE1BQU07TUFDTCxLQUFLLElBQUlxRSxDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUd2RixNQUFNLENBQUNkLE1BQU0sRUFBRXFHLENBQUMsRUFBRSxFQUFFO1FBQ3RDLEtBQUssSUFBSUMsQ0FBQyxHQUFHRCxDQUFDLEdBQUcsQ0FBQyxFQUFFQyxDQUFDLEdBQUd4RixNQUFNLENBQUNkLE1BQU0sRUFBRXNHLENBQUMsRUFBRSxFQUFFO1VBQzFDLE1BQU1ILE1BQU0sR0FBR3JGLE1BQU0sQ0FBQ3VGLENBQUMsQ0FBc0Q7VUFDN0UsTUFBTUQsS0FBSyxHQUFHdEYsTUFBTSxDQUFDd0YsQ0FBQyxDQUFzRDtVQUM1RSxJQUFJSCxNQUFNLENBQUMzQyxLQUFLLEtBQUs0QyxLQUFLLENBQUM1QyxLQUFLLEVBQUU7WUFDaENqQyxRQUFRLENBQUM0RSxNQUFNLENBQUNwRixXQUFXLENBQUMsQ0FBQ3FGLEtBQUssQ0FBQ3JGLFdBQVcsQ0FBQyxJQUFJaUIsTUFBTSxHQUFHLEdBQUc7WUFDL0RULFFBQVEsQ0FBQzZFLEtBQUssQ0FBQ3JGLFdBQVcsQ0FBQyxDQUFDb0YsTUFBTSxDQUFDcEYsV0FBVyxDQUFDLElBQUlpQixNQUFNLEdBQUcsR0FBRztVQUNqRSxDQUFDLE1BQU07WUFDTFQsUUFBUSxDQUFDNEUsTUFBTSxDQUFDcEYsV0FBVyxDQUFDLENBQUNxRixLQUFLLENBQUNyRixXQUFXLENBQUMsSUFBSWlCLE1BQU07VUFDM0Q7UUFDRjtNQUNGO0lBQ0Y7RUFDRjs7RUFFQTtFQUNBLElBQUk0RCxnQkFBZ0IsR0FBRyxDQUFDLEVBQUU7SUFDeEIsS0FBSyxNQUFNLENBQUM3RSxXQUFXLEVBQUV3RixNQUFNLENBQUMsSUFBSXhCLFVBQVUsQ0FBQ2UsT0FBTyxDQUFDLENBQUMsRUFBRTtNQUN4RGYsVUFBVSxDQUFDaEQsR0FBRyxDQUFDaEIsV0FBVyxFQUFFd0IsS0FBSyxDQUFDZ0UsTUFBTSxHQUFHWCxnQkFBZ0IsQ0FBQyxDQUFDO0lBQy9EO0VBQ0Y7O0VBRUE7RUFDQSxLQUFLLE1BQU03RSxXQUFXLElBQUlrRSxZQUFZLEVBQUU7SUFDdEMsSUFBSSxDQUFDRixVQUFVLENBQUNPLEdBQUcsQ0FBQ3ZFLFdBQVcsQ0FBQyxFQUFFO01BQ2hDZ0UsVUFBVSxDQUFDaEQsR0FBRyxDQUFDaEIsV0FBVyxFQUFFLEdBQUcsQ0FBQztJQUNsQztFQUNGO0VBRUEsT0FBTztJQUFFa0IseUJBQXlCLEVBQUU4QyxVQUFVO0lBQUV4RCxRQUFRO0lBQUVDO0VBQW1CLENBQUM7QUFDaEY7QUFFQSxTQUFTZSxLQUFLQSxDQUFDaUUsS0FBYSxFQUFFakQsR0FBRyxHQUFHLENBQUMsRUFBRXhELEdBQUcsR0FBRyxDQUFDLEVBQVU7RUFDdEQsSUFBSTBHLE1BQU0sQ0FBQ0MsS0FBSyxDQUFDRixLQUFLLENBQUMsRUFBRSxPQUFPakQsR0FBRztFQUNuQyxPQUFPekQsSUFBSSxDQUFDQyxHQUFHLENBQUN3RCxHQUFHLEVBQUV6RCxJQUFJLENBQUN5RCxHQUFHLENBQUN4RCxHQUFHLEVBQUV5RyxLQUFLLENBQUMsQ0FBQztBQUM1QztBQUVBLFNBQVMxRCxvQkFBb0JBLENBQUM2RCxTQUFpQixFQUFFN0IsS0FBYSxFQUFVO0VBQ3RFLElBQUlBLEtBQUssSUFBSSxDQUFDLEVBQUUsT0FBTyxDQUFDO0VBQ3hCLE1BQU04QixRQUFRLEdBQUc5RyxJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFDLEVBQUUrRSxLQUFLLEdBQUcsQ0FBQyxDQUFDO0VBQ3ZDLE1BQU0rQixRQUFRLEdBQUcsQ0FBQyxHQUFHRixTQUFTLEdBQUdDLFFBQVE7RUFDekMsT0FBT3JFLEtBQUssQ0FBQ3NFLFFBQVEsQ0FBQztBQUN4QiIsImlnbm9yZUxpc3QiOltdfQ==