{"version":3,"names":["_nodeChild_process","require","_promises","_nodePath","_toolRuntime","_safetyValidator","_errorTypes","_bashCommandGuidance","_errors","_resultVerification","_aiErrorFixer","_debugLogger","BackgroundShell","outputBuffer","errorBuffer","lastReadPosition","isRunning","constructor","id","command","workingDir","start","process","spawn","cwd","stdio","stdout","on","data","push","toString","stderr","code","exitCode","getNewOutput","filter","allOutput","join","newOutput","substring","length","allError","lines","split","line","test","status","kill","setTimeout","killed","BackgroundShellManager","shells","Map","nextId","createShell","shellId","shell","set","getShell","get","killShell","delete","listShells","Array","from","keys","shellManager","execWithStreaming","options","MAX_BUFFER_BYTES","Promise","resolve","reject","stdoutBytes","stderrBytes","stdoutTruncated","stderrTruncated","lineCount","child","env","timeoutId","timeout","processLine","isStderr","trimmedLine","slice","reportToolProgress","current","message","appendChunk","chunks","isStdout","byteLength","used","available","subarray","consumed","stdoutBuffer","text","pop","trim","stderrBuffer","buildOutput","truncated","output","limitKb","Math","round","notice","clearTimeout","stdoutText","stderrText","error","findGuiLauncher","_command","errorFixerCache","getErrorFixer","fixer","createErrorFixer","getSmartTimeout","cmd","toLowerCase","sandboxCache","ensureSandboxPaths","pending","createSandboxPaths","root","home","cache","config","tmp","all","map","dir","mkdir","recursive","buildSandboxEnv","envPreference","preserveHome","Boolean","paths","AGI_SANDBOX_ROOT","AGI_SANDBOX_HOME","AGI_SANDBOX_TMP","createBashTools","name","description","parameters","type","properties","run_in_background","required","handler","args","runInBackground","userTimeout","replace","logDebug","interactiveCommands","flowWarnings","analyzeBashFlow","warning","suffix","suggestion","validation","validateBashCommand","valid","structuredError","toStructuredError","errorMsg","toDisplayString","autoFix","fixed","changes","SmartFixer","fixDangerousCommand","change","warnings","guiBlocked","startTime","Date","now","durationMs","combinedOutput","commandLower","patterns","OutputPatterns","startsWith","git","npm","analysis","analyzeOutput","commandCheck","createCommandCheck","errorFixer","aiErrors","aiGuidance","formatForAI","suggestions","firstError","suggestedFixes","unshift","verifiedFailure","isFailure","check","passed","details","matchedPattern","verifiedSuccess","isSuccess","execError","combinedError","bash_id","additionalProperties","bashId","filterStr","RegExp","undefined","parts","buildError","shell_id","success"],"sources":["bashTools.ts"],"sourcesContent":["import { spawn, ChildProcess } from 'node:child_process';\nimport { mkdir } from 'node:fs/promises';\nimport { join } from 'node:path';\nimport type { ToolDefinition } from '../core/toolRuntime.js';\nimport { reportToolProgress } from '../core/toolRuntime.js';\nimport { validateBashCommand, SmartFixer } from '../core/errors/safetyValidator.js';\nimport { toStructuredError } from '../core/errors/errorTypes.js';\nimport { analyzeBashFlow } from '../core/bashCommandGuidance.js';\nimport { buildError } from '../core/errors.js';\nimport {\n  verifiedSuccess,\n  verifiedFailure,\n  analyzeOutput,\n  OutputPatterns,\n  createCommandCheck,\n} from '../core/resultVerification.js';\nimport { createErrorFixer, type AIErrorFixer } from '../core/aiErrorFixer.js';\nimport { logDebug } from '../utils/debugLogger.js';\n\n// ============================================================================\n// Background Shell Manager (consolidated from backgroundBashTools.ts)\n// ============================================================================\n\nclass BackgroundShell {\n  private process?: ChildProcess;\n  private outputBuffer: string[] = [];\n  private errorBuffer: string[] = [];\n  private lastReadPosition = 0;\n  private isRunning = false;\n  private exitCode?: number;\n\n  constructor(\n    public readonly id: string,\n    private command: string,\n    private workingDir: string\n  ) {}\n\n  start(): void {\n    this.process = spawn('bash', ['-c', this.command], {\n      cwd: this.workingDir,\n      stdio: ['ignore', 'pipe', 'pipe'],\n    });\n\n    this.isRunning = true;\n\n    this.process.stdout?.on('data', (data) => {\n      this.outputBuffer.push(data.toString());\n    });\n\n    this.process.stderr?.on('data', (data) => {\n      this.errorBuffer.push(data.toString());\n    });\n\n    this.process.on('exit', (code) => {\n      this.exitCode = code ?? 0;\n      this.isRunning = false;\n    });\n  }\n\n  getNewOutput(filter?: RegExp): { stdout: string; stderr: string; status: string } {\n    const allOutput = this.outputBuffer.join('');\n    const newOutput = allOutput.substring(this.lastReadPosition);\n    this.lastReadPosition = allOutput.length;\n\n    const allError = this.errorBuffer.join('');\n\n    let stdout = newOutput;\n    if (filter) {\n      const lines = newOutput.split('\\n');\n      stdout = lines.filter(line => filter.test(line)).join('\\n');\n    }\n\n    return {\n      stdout,\n      stderr: allError,\n      status: this.isRunning ? 'running' : `exited with code ${this.exitCode}`,\n    };\n  }\n\n  kill(): void {\n    if (this.process) {\n      this.process.kill('SIGTERM');\n      setTimeout(() => {\n        if (this.process && !this.process.killed) {\n          this.process.kill('SIGKILL');\n        }\n      }, 5000);\n    }\n  }\n}\n\nclass BackgroundShellManager {\n  private shells = new Map<string, BackgroundShell>();\n  private nextId = 1;\n\n  createShell(command: string, workingDir: string): string {\n    const shellId = `shell_${this.nextId++}`;\n    const shell = new BackgroundShell(shellId, command, workingDir);\n    this.shells.set(shellId, shell);\n    shell.start();\n    return shellId;\n  }\n\n  getShell(shellId: string): BackgroundShell | undefined {\n    return this.shells.get(shellId);\n  }\n\n  killShell(shellId: string): boolean {\n    const shell = this.shells.get(shellId);\n    if (shell) {\n      shell.kill();\n      this.shells.delete(shellId);\n      return true;\n    }\n    return false;\n  }\n\n  listShells(): string[] {\n    return Array.from(this.shells.keys());\n  }\n}\n\n// Global shell manager instance\nconst shellManager = new BackgroundShellManager();\n\n// ============================================================================\n// Streaming Execution\n// ============================================================================\n\nasync function execWithStreaming(\n  command: string,\n  options: { cwd: string; timeout: number; env: NodeJS.ProcessEnv }\n): Promise<{ stdout: string; stderr: string; exitCode: number }> {\n  const MAX_BUFFER_BYTES = 1_000_000; // ~1MB per stream to prevent OOM on chatty commands\n  return new Promise((resolve, reject) => {\n    const stdout: string[] = [];\n    const stderr: string[] = [];\n    let stdoutBytes = 0;\n    let stderrBytes = 0;\n    let stdoutTruncated = false;\n    let stderrTruncated = false;\n    let lineCount = 0;\n    let killed = false;\n\n    const child = spawn('bash', ['-c', command], {\n      cwd: options.cwd,\n      env: options.env,\n      stdio: ['ignore', 'pipe', 'pipe'],\n    });\n\n    const timeoutId = setTimeout(() => {\n      killed = true;\n      child.kill('SIGTERM');\n      setTimeout(() => child.kill('SIGKILL'), 1000);\n    }, options.timeout);\n\n    const processLine = (line: string, isStderr: boolean) => {\n      lineCount++;\n      const trimmedLine = line.slice(0, 80);\n      reportToolProgress({\n        current: lineCount,\n        message: isStderr ? `stderr: ${trimmedLine}` : trimmedLine,\n      });\n    };\n\n    const appendChunk = (chunks: string[], data: Buffer, isStdout: boolean): void => {\n      const byteLength = data.length;\n      const used = isStdout ? stdoutBytes : stderrBytes;\n      const available = MAX_BUFFER_BYTES - used;\n      if (available <= 0) {\n        if (isStdout) stdoutTruncated = true;\n        else stderrTruncated = true;\n        return;\n      }\n\n      const slice = byteLength > available ? data.subarray(0, available) : data;\n      chunks.push(slice.toString());\n      const consumed = slice.length; // Buffer length in bytes\n      if (isStdout) {\n        stdoutBytes += consumed;\n        if (byteLength > available) stdoutTruncated = true;\n      } else {\n        stderrBytes += consumed;\n        if (byteLength > available) stderrTruncated = true;\n      }\n    };\n\n    let stdoutBuffer = '';\n    child.stdout?.on('data', (data: Buffer) => {\n      const text = data.toString();\n      appendChunk(stdout, data, true);\n      stdoutBuffer += text;\n      if (stdoutBuffer.length > 4096) {\n        stdoutBuffer = stdoutBuffer.slice(-2048);\n      }\n      const lines = stdoutBuffer.split('\\n');\n      stdoutBuffer = lines.pop() || '';\n      for (const line of lines) {\n        if (line.trim()) processLine(line, false);\n      }\n    });\n\n    let stderrBuffer = '';\n    child.stderr?.on('data', (data: Buffer) => {\n      const text = data.toString();\n      appendChunk(stderr, data, false);\n      stderrBuffer += text;\n      if (stderrBuffer.length > 4096) {\n        stderrBuffer = stderrBuffer.slice(-2048);\n      }\n      const lines = stderrBuffer.split('\\n');\n      stderrBuffer = lines.pop() || '';\n      for (const line of lines) {\n        if (line.trim()) processLine(line, true);\n      }\n    });\n\n    const buildOutput = (chunks: string[], truncated: boolean): string => {\n      const output = chunks.join('');\n      if (!truncated) return output;\n      const limitKb = Math.round(MAX_BUFFER_BYTES / 1024);\n      const notice = `\\n[output truncated after ${limitKb}KB to protect memory; rerun with narrower command to see full output]`;\n      return output ? `${output}${notice}` : notice.trim();\n    };\n\n    child.on('close', (code) => {\n      clearTimeout(timeoutId);\n      if (stdoutBuffer.trim()) processLine(stdoutBuffer, false);\n      if (stderrBuffer.trim()) processLine(stderrBuffer, true);\n\n      const stdoutText = buildOutput(stdout, stdoutTruncated);\n      const stderrText = buildOutput(stderr, stderrTruncated);\n\n      if (killed) {\n        reject({ killed: true, stdout: stdoutText, stderr: stderrText, code });\n      } else {\n        resolve({ stdout: stdoutText, stderr: stderrText, exitCode: code ?? 0 });\n      }\n    });\n\n    child.on('error', (error) => {\n      clearTimeout(timeoutId);\n      reject(error);\n    });\n  });\n}\n\n// ============================================================================\n// Utility Functions\n// ============================================================================\n\n// Keep the shell responsive while long commands run\nfunction findGuiLauncher(_command: string): string | null {\n  return null;\n}\n\nconst errorFixerCache = new Map<string, AIErrorFixer>();\nfunction getErrorFixer(workingDir: string): AIErrorFixer {\n  let fixer = errorFixerCache.get(workingDir);\n  if (!fixer) {\n    fixer = createErrorFixer({ workingDir });\n    errorFixerCache.set(workingDir, fixer);\n  }\n  return fixer;\n}\n\n/**\n * Smart timeout detection based on command type\n */\nfunction getSmartTimeout(command: string): number {\n  const cmd = command.toLowerCase().trim();\n\n  // Long-running ML/AI training jobs (10 minutes)\n  if (/\\b(python|python3)\\b/.test(cmd) && /\\b(train|fine[-\\s]?tune|finetune)\\b/.test(cmd)) {\n    return 600000;\n  }\n  if (/\\b(torchrun|accelerate\\s+launch)\\b/.test(cmd)) return 600000;\n\n  // Python/pytest test runners (5 minutes)\n  if (/\\b(pytest|python\\s+-m\\s+pytest)\\b/.test(cmd)) return 300000;\n\n  // NPM/Yarn/PNPM operations (5 minutes)\n  if (/\\b(npm|yarn|pnpm)\\s+(install|ci|i|add|update|upgrade)\\b/.test(cmd)) return 300000;\n  if (/\\b(npm|yarn|pnpm)\\s+(run\\s+)?(build|test|lint|start|dev)\\b/.test(cmd)) return 300000;\n  if (/\\bnpx\\s+(create-|degit|giget)\\b/.test(cmd)) return 300000;\n\n  // Prisma (3 minutes)\n  if (/\\b(prisma|npx prisma)\\s+(generate|migrate|db push|db pull)\\b/.test(cmd)) return 180000;\n\n  // Docker (10 minutes)\n  if (/\\bdocker\\s+(build|pull|push|compose)\\b/.test(cmd)) return 600000;\n\n  // Git clone / pip install (3 minutes)\n  if (/\\bgit\\s+clone\\b/.test(cmd)) return 180000;\n  if (/\\bpip\\s+install\\b/.test(cmd)) return 180000;\n\n  return 30000; // Default\n}\n\n// ============================================================================\n// Sandbox Environment\n// ============================================================================\n\ninterface SandboxPaths {\n  root: string;\n  home: string;\n  cache: string;\n  config: string;\n  data: string;\n  tmp: string;\n}\n\nconst sandboxCache = new Map<string, Promise<SandboxPaths>>();\n\nasync function ensureSandboxPaths(workingDir: string): Promise<SandboxPaths> {\n  let pending = sandboxCache.get(workingDir);\n  if (!pending) {\n    pending = createSandboxPaths(workingDir);\n    sandboxCache.set(workingDir, pending);\n  }\n  return pending;\n}\n\nasync function createSandboxPaths(workingDir: string): Promise<SandboxPaths> {\n  const root = join(workingDir, '.agi', 'shell-sandbox');\n  const home = join(root, 'home');\n  const cache = join(root, 'cache');\n  const config = join(root, 'config');\n  const data = join(root, 'data');\n  const tmp = join(root, 'tmp');\n  await Promise.all([home, cache, config, data, tmp].map((dir) => mkdir(dir, { recursive: true })));\n  return { root, home, cache, config, data, tmp };\n}\n\nexport async function buildSandboxEnv(\n  workingDir: string,\n  options?: { preserveHome?: boolean }\n): Promise<NodeJS.ProcessEnv> {\n  const envPreference = process.env['AGI_PRESERVE_HOME'];\n  const preserveHome = envPreference === '1' ? true : envPreference === '0' ? false : Boolean(options?.preserveHome);\n  const paths = await ensureSandboxPaths(workingDir);\n\n  const env: NodeJS.ProcessEnv = {\n    ...process.env,\n    AGI_SANDBOX_ROOT: paths.root,\n    AGI_SANDBOX_HOME: paths.home,\n    AGI_SANDBOX_TMP: paths.tmp,\n  };\n\n  if (!preserveHome) env['HOME'] = paths.home;\n  env['XDG_CACHE_HOME'] = paths.cache;\n  env['XDG_CONFIG_HOME'] = paths.config;\n  env['XDG_DATA_HOME'] = paths.data;\n  env['TMPDIR'] = paths.tmp;\n  env['TMP'] = paths.tmp;\n  env['TEMP'] = paths.tmp;\n\n  return env;\n}\n\n// ============================================================================\n// Main Tool Factory\n// ============================================================================\n\nexport function createBashTools(workingDir: string): ToolDefinition[] {\n  return [\n    // Main bash execution tool\n    {\n      name: 'execute_bash',\n      description: 'Execute a bash command. Commands auto-timeout based on type. Use run_in_background: true for servers/watchers.',\n      parameters: {\n        type: 'object',\n        properties: {\n          command: { type: 'string', description: 'The bash command to execute' },\n          timeout: { type: 'number', description: 'Timeout in milliseconds (smart defaults apply)' },\n          run_in_background: { type: 'boolean', description: 'Run in background for long-running processes' },\n        },\n        required: ['command'],\n      },\n      handler: async (args) => {\n        let command = args['command'] as string;\n        const runInBackground = args['run_in_background'] === true;\n        const userTimeout = args['timeout'] as number | undefined;\n        const timeout = userTimeout ?? getSmartTimeout(command);\n\n        // Strip sudo and password-requiring commands to avoid interactive prompts\n        if (/^\\s*sudo\\s+/i.test(command)) {\n          command = command.replace(/^\\s*sudo\\s+/i, '');\n          logDebug('[Bash] Stripped sudo prefix to avoid password prompt');\n        }\n        // Block commands that typically require passwords or interactive input\n        const interactiveCommands = /\\b(passwd|su\\s|login|ssh\\s(?!-o)|sftp|ftp|mysql\\s+-p|psql\\s+-W)\\b/i;\n        if (interactiveCommands.test(command)) {\n          return 'Skipped: Command requires interactive authentication. Use non-interactive alternatives.';\n        }\n\n        // Flow guidance (debug only - don't pollute chat)\n        const flowWarnings = analyzeBashFlow(command);\n        for (const warning of flowWarnings) {\n          const suffix = warning.suggestion ? ` â€” ${warning.suggestion}` : '';\n          logDebug(`[Bash Flow] ${warning.message}${suffix}`);\n        }\n\n        // Safety validation\n        const validation = validateBashCommand(command);\n        if (!validation.valid) {\n          const structuredError = validation.error ? toStructuredError(validation.error) : null;\n          if (structuredError) {\n            let errorMsg = structuredError.toDisplayString();\n            if (validation.autoFix?.available) {\n              const { fixed, changes } = SmartFixer.fixDangerousCommand(command);\n              if (changes.length > 0) {\n                errorMsg += '\\n\\nAuto-fix available:';\n                for (const change of changes) errorMsg += `\\n  - ${change}`;\n                errorMsg += `\\n\\nFixed command: ${fixed}`;\n              }\n            }\n            return errorMsg;\n          }\n          return 'Error: Command validation failed';\n        }\n\n        // Safety warnings (debug only - don't pollute chat)\n        if (validation.warnings.length > 0) {\n          for (const warning of validation.warnings) {\n            logDebug(`[Bash Safety] ${warning}`);\n          }\n        }\n\n        // GUI blocking check (disabled for red team ops)\n        const guiBlocked = findGuiLauncher(command);\n        if (guiBlocked) {\n          return `Blocked: ${guiBlocked}`;\n        }\n\n        // Background execution\n        if (runInBackground) {\n          const shellId = shellManager.createShell(command, workingDir);\n          return `Background shell started: ${shellId}\\n\\nUse BashOutput with bash_id=\"${shellId}\" to monitor.\\nUse KillShell with shell_id=\"${shellId}\" to terminate.`;\n        }\n\n        // Foreground execution\n        const startTime = Date.now();\n        try {\n          const env = await buildSandboxEnv(workingDir);\n          const { stdout, stderr, exitCode } = await execWithStreaming(command, { cwd: workingDir, timeout, env });\n          const durationMs = Date.now() - startTime;\n          const combinedOutput = [stdout, stderr].filter(Boolean).join('\\n');\n\n          const commandLower = command.toLowerCase().trim();\n          let patterns = OutputPatterns.command;\n          if (commandLower.startsWith('git ') || commandLower === 'git') patterns = OutputPatterns.git;\n          else if (commandLower.startsWith('npm ') || commandLower.startsWith('npx ')) patterns = OutputPatterns.npm;\n\n          const analysis = analyzeOutput(combinedOutput, patterns, exitCode);\n          const commandCheck = createCommandCheck('Command execution', exitCode, combinedOutput);\n\n          if (exitCode !== 0) {\n            const errorFixer = getErrorFixer(workingDir);\n            const aiErrors = errorFixer.analyzeOutput(combinedOutput, command);\n            const aiGuidance = aiErrors.length > 0 ? errorFixer.formatForAI(aiErrors) : '';\n            const suggestions = ['Review the error message', 'Fix the issue and retry'];\n            const firstError = aiErrors[0];\n            if (firstError?.suggestedFixes[0]) {\n              suggestions.unshift(`AI Suggestion: ${firstError.suggestedFixes[0].description}`);\n            }\n\n            return verifiedFailure(\n              `Command failed with exit code ${exitCode}`,\n              `Command: ${command}\\n\\nOutput:\\n${combinedOutput || '(none)'}${aiGuidance}`,\n              suggestions,\n              [commandCheck],\n              durationMs\n            );\n          }\n\n          if (analysis.isFailure) {\n            return verifiedFailure(\n              `Command completed with exit code 0 but output indicates failure`,\n              `Command: ${command}\\n\\nOutput:\\n${combinedOutput || '(no output)'}`,\n              ['Review the error message in the output', 'Fix the underlying issue and retry'],\n              [commandCheck, { check: 'Output analysis', passed: false, details: `Failure pattern: ${analysis.matchedPattern}` }],\n              durationMs\n            );\n          }\n\n          return verifiedSuccess(\n            combinedOutput.trim() ? `Command executed successfully` : `Command executed successfully (no output)`,\n            `Command: ${command}${combinedOutput.trim() ? `\\n\\nOutput:\\n${combinedOutput}` : ''}`,\n            [commandCheck, ...(analysis.isSuccess ? [{ check: 'Output analysis', passed: true, details: `Success pattern matched` }] : [])],\n            durationMs\n          );\n        } catch (error: unknown) {\n          const execError = error as { code?: number; stdout?: string; stderr?: string; message?: string; killed?: boolean };\n          const durationMs = Date.now() - startTime;\n          const exitCode = execError.code ?? 1;\n          const combinedError = [execError.stdout, execError.stderr, execError.message].filter(Boolean).join('\\n');\n\n          if (execError.killed) {\n            return verifiedFailure(\n              `Command timed out after ${timeout}ms`,\n              `Command: ${command}\\n\\nPartial output:\\n${combinedError || '(none)'}`,\n              ['Increase timeout if command legitimately needs more time', 'Check if command is hanging'],\n              [{ check: 'Timeout', passed: false, details: `Exceeded ${timeout}ms` }],\n              durationMs\n            );\n          }\n\n          const errorFixer = getErrorFixer(workingDir);\n          const aiErrors = errorFixer.analyzeOutput(combinedError, command);\n          const aiGuidance = aiErrors.length > 0 ? errorFixer.formatForAI(aiErrors) : '';\n          const suggestions = ['Review the error message', 'Fix the issue and retry'];\n          const firstError = aiErrors[0];\n          if (firstError?.suggestedFixes[0]) {\n            suggestions.unshift(`AI Suggestion: ${firstError.suggestedFixes[0].description}`);\n          }\n\n          return verifiedFailure(\n            `Command failed with exit code ${exitCode}`,\n            `Command: ${command}\\n\\nError output:\\n${combinedError || '(none)'}${aiGuidance}`,\n            suggestions,\n            [createCommandCheck('Command execution', exitCode, combinedError)],\n            durationMs\n          );\n        }\n      },\n    },\n\n    // Background shell output retrieval\n    {\n      name: 'BashOutput',\n      description: 'Retrieve output from a running or completed background bash shell.',\n      parameters: {\n        type: 'object',\n        properties: {\n          bash_id: { type: 'string', description: 'The ID of the background shell' },\n          filter: { type: 'string', description: 'Optional regex to filter output lines' },\n        },\n        required: ['bash_id'],\n        additionalProperties: false,\n      },\n      handler: async (args) => {\n        const bashId = args['bash_id'];\n        const filterStr = args['filter'];\n\n        if (typeof bashId !== 'string' || !bashId.trim()) {\n          return 'Error: bash_id must be a non-empty string.';\n        }\n\n        try {\n          const shell = shellManager.getShell(bashId);\n          if (!shell) {\n            const available = shellManager.listShells();\n            return `Error: Shell \"${bashId}\" not found.\\n\\nAvailable: ${available.length > 0 ? available.join(', ') : 'none'}`;\n          }\n\n          const filter = filterStr && typeof filterStr === 'string' ? new RegExp(filterStr) : undefined;\n          const { stdout, stderr, status } = shell.getNewOutput(filter);\n\n          const parts: string[] = [`Shell: ${bashId}`, `Status: ${status}`];\n          if (stdout) { parts.push('\\n=== New Output ==='); parts.push(stdout); }\n          if (stderr) { parts.push('\\n=== Errors ==='); parts.push(stderr); }\n          if (!stdout && !stderr) parts.push('\\n(No new output)');\n\n          return parts.join('\\n');\n        } catch (error: unknown) {\n          return buildError('retrieving shell output', error, { bash_id: bashId });\n        }\n      },\n    },\n\n    // Kill background shell\n    {\n      name: 'KillShell',\n      description: 'Kill a running background bash shell by its ID.',\n      parameters: {\n        type: 'object',\n        properties: {\n          shell_id: { type: 'string', description: 'The ID of the background shell to kill' },\n        },\n        required: ['shell_id'],\n        additionalProperties: false,\n      },\n      handler: async (args) => {\n        const shellId = args['shell_id'];\n\n        if (typeof shellId !== 'string' || !shellId.trim()) {\n          return 'Error: shell_id must be a non-empty string.';\n        }\n\n        try {\n          const success = shellManager.killShell(shellId);\n          if (success) {\n            return `Shell \"${shellId}\" has been terminated.`;\n          } else {\n            const available = shellManager.listShells();\n            return `Error: Shell \"${shellId}\" not found.\\n\\nAvailable: ${available.length > 0 ? available.join(', ') : 'none'}`;\n          }\n        } catch (error: unknown) {\n          return buildError('killing shell', error, { shell_id: shellId });\n        }\n      },\n    },\n  ];\n}\n"],"mappings":"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","ignoreList":[]}