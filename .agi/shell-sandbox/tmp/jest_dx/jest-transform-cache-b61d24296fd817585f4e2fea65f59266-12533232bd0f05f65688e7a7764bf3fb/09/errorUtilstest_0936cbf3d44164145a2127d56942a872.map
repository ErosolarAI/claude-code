{"version":3,"names":["_errorUtils","require","describe","it","error","Error","context","userId","action","details","createErrorDetails","expect","message","toBe","code","toEqual","stack","toBeTruthy","timestamp","toBeUndefined","formatted","formatErrorForLogging","toContain","isRetryableError","attempts","operation","result","withRetry","rejects","toThrow"],"sources":["errorUtils.test.ts"],"sourcesContent":["import {\n  createErrorDetails,\n  formatErrorForLogging,\n  isRetryableError,\n  withRetry,\n} from '../src/utils/errorUtils.js';\n\ndescribe('errorUtils', () => {\n  it('createErrorDetails creates proper error details from Error', () => {\n    const error = new Error('Test error');\n    const context = { userId: '123', action: 'test' };\n    const details = createErrorDetails(error, context);\n\n    expect(details.message).toBe('Test error');\n    expect(details.code).toBe('TEST_ERROR');\n    expect(details.context).toEqual(context);\n    expect(details.stack).toBeTruthy();\n    expect(details.timestamp).toBeTruthy();\n  });\n\n  it('createErrorDetails handles non-Error objects', () => {\n    const details = createErrorDetails('String error');\n\n    expect(details.message).toBe('String error');\n    expect(details.code).toBeUndefined();\n    expect(details.context).toBeUndefined();\n    expect(details.stack).toBeUndefined();\n    expect(details.timestamp).toBeTruthy();\n  });\n\n  it('formatErrorForLogging formats error with context', () => {\n    const error = new Error('Test error');\n    const context = { userId: '123', action: 'test' };\n    const formatted = formatErrorForLogging(error, context);\n\n    expect(formatted).toContain('Test error');\n    expect(formatted).toContain('Context: {\"userId\":\"123\",\"action\":\"test\"}');\n    expect(formatted).toContain('Stack:');\n  });\n\n  it('isRetryableError identifies retryable errors', () => {\n    expect(isRetryableError(new Error('Request timeout'))).toBe(true);\n    expect(isRetryableError(new Error('Network error'))).toBe(true);\n    expect(isRetryableError(new Error('Rate limit exceeded'))).toBe(true);\n    expect(isRetryableError(new Error('Too many requests'))).toBe(true);\n    expect(isRetryableError(new Error('Service unavailable'))).toBe(true);\n    expect(isRetryableError(new Error('Regular error'))).toBe(false);\n    expect(isRetryableError('String error')).toBe(false);\n  });\n\n  it('withRetry retries on retryable errors', async () => {\n    let attempts = 0;\n\n    const operation = async () => {\n      attempts++;\n      if (attempts < 3) {\n        throw new Error('Rate limit exceeded');\n      }\n      return 'success';\n    };\n\n    const result = await withRetry(operation, 3, 10);\n\n    expect(result).toBe('success');\n    expect(attempts).toBe(3);\n  });\n\n  it('withRetry fails after max retries', async () => {\n    let attempts = 0;\n\n    const operation = async () => {\n      attempts++;\n      throw new Error('Rate limit exceeded');\n    };\n\n    await expect(withRetry(operation, 2, 10)).rejects.toThrow('Rate limit exceeded');\n    expect(attempts).toBe(3); // initial + 2 retries\n  });\n\n  it('withRetry does not retry non-retryable errors', async () => {\n    let attempts = 0;\n\n    const operation = async () => {\n      attempts++;\n      throw new Error('Validation error');\n    };\n\n    await expect(withRetry(operation, 3, 10)).rejects.toThrow('Validation error');\n    expect(attempts).toBe(1); // no retries for non-retryable errors\n  });\n});\n"],"mappings":"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","ignoreList":[]}