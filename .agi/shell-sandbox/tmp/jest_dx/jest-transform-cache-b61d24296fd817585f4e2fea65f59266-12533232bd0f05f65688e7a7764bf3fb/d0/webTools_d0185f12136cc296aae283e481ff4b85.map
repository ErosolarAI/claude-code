{"version":3,"names":["_secretStore","require","_errors","createWebTools","name","description","parameters","type","properties","query","maxResults","searchDepth","enum","includeAnswer","required","additionalProperties","handler","args","trim","Math","min","tavilyKey","getSecretValue","searchTavily","braveKey","searchBrave","serpKey","searchSerpAPI","error","buildError","urls","items","url","Array","isArray","filter","u","length","slice","extractTavily","join","apiKey","options","controller","AbortController","timeout","setTimeout","abort","response","fetch","method","headers","body","JSON","stringify","api_key","search_depth","include_answer","max_results","signal","ok","text","Error","status","data","json","formatTavilyResults","clearTimeout","params","URLSearchParams","q","count","String","formatBraveResults","engine","num","formatSerpAPIResults","formatExtractResults","provider","lines","answer","push","results","result","title","content","snippet","published_date","web","profile","publishedDate","organic_results","link","source","date","raw_content"],"sources":["webTools.ts"],"sourcesContent":["/**\n * Web Tools - Web search and content extraction capabilities\n *\n * Provides:\n * - WebSearch: Search the web using Tavily, Brave, or SerpAPI\n * - WebExtract: Extract and summarize content from URLs\n */\n\nimport type { ToolDefinition } from '../core/toolRuntime.js';\nimport { getSecretValue } from '../core/secretStore.js';\nimport { buildError } from '../core/errors.js';\n\ninterface TavilySearchResult {\n  title: string;\n  url: string;\n  content: string;\n  score?: number;\n  published_date?: string;\n}\n\ninterface TavilySearchResponse {\n  results: TavilySearchResult[];\n  answer?: string;\n  query: string;\n}\n\ninterface TavilyExtractResponse {\n  results: Array<{\n    url: string;\n    raw_content: string;\n  }>;\n}\n\ninterface BraveSearchResult {\n  title: string;\n  url: string;\n  description: string;\n  profile?: { name: string };\n  publishedDate?: string;\n}\n\ninterface BraveSearchResponse {\n  web?: {\n    results: BraveSearchResult[];\n  };\n}\n\ninterface SerpAPIResult {\n  title: string;\n  link: string;\n  snippet: string;\n  source?: string;\n  date?: string;\n}\n\ninterface SerpAPIResponse {\n  organic_results?: SerpAPIResult[];\n}\n\ntype SearchProvider = 'tavily' | 'brave' | 'serpapi';\n\n/**\n * Create web tools for search and extraction.\n */\nexport function createWebTools(): ToolDefinition[] {\n  return [\n    {\n      name: 'WebSearch',\n      description: 'Search the web for information. Returns relevant results from search engines. Requires TAVILY_API_KEY, BRAVE_SEARCH_API_KEY, or SERPAPI_API_KEY.',\n      parameters: {\n        type: 'object',\n        properties: {\n          query: {\n            type: 'string',\n            description: 'The search query',\n          },\n          maxResults: {\n            type: 'number',\n            description: 'Maximum number of results to return (default: 5, max: 10)',\n          },\n          searchDepth: {\n            type: 'string',\n            enum: ['basic', 'advanced'],\n            description: 'Search depth for Tavily: basic (fast) or advanced (thorough). Default: basic',\n          },\n          includeAnswer: {\n            type: 'boolean',\n            description: 'For Tavily: include AI-generated answer summary. Default: true',\n          },\n        },\n        required: ['query'],\n        additionalProperties: false,\n      },\n      handler: async (args) => {\n        const query = args['query'];\n        if (typeof query !== 'string' || !query.trim()) {\n          return 'Error: query is required';\n        }\n\n        const maxResults = Math.min(\n          typeof args['maxResults'] === 'number' ? args['maxResults'] : 5,\n          10\n        );\n        const searchDepth = args['searchDepth'] === 'advanced' ? 'advanced' : 'basic';\n        const includeAnswer = args['includeAnswer'] !== false;\n\n        try {\n          // Try providers in order of preference\n          const tavilyKey = getSecretValue('TAVILY_API_KEY');\n          if (tavilyKey) {\n            return await searchTavily(query, tavilyKey, { maxResults, searchDepth, includeAnswer });\n          }\n\n          const braveKey = getSecretValue('BRAVE_SEARCH_API_KEY');\n          if (braveKey) {\n            return await searchBrave(query, braveKey, { maxResults });\n          }\n\n          const serpKey = getSecretValue('SERPAPI_API_KEY');\n          if (serpKey) {\n            return await searchSerpAPI(query, serpKey, { maxResults });\n          }\n\n          return 'WebSearch requires either TAVILY_API_KEY (recommended), BRAVE_SEARCH_API_KEY, or SERPAPI_API_KEY to be configured. Use /secrets set to configure.';\n        } catch (error) {\n          return buildError('WebSearch', error, { query });\n        }\n      },\n    },\n    {\n      name: 'WebExtract',\n      description: 'Extract and summarize content from one or more URLs. Uses Tavily for high-quality extraction. Requires TAVILY_API_KEY.',\n      parameters: {\n        type: 'object',\n        properties: {\n          urls: {\n            type: 'array',\n            items: { type: 'string' },\n            description: 'URLs to extract content from (max 5)',\n          },\n          url: {\n            type: 'string',\n            description: 'Single URL to extract content from (alternative to urls array)',\n          },\n        },\n        additionalProperties: false,\n      },\n      handler: async (args) => {\n        let urls: string[] = [];\n\n        if (Array.isArray(args['urls'])) {\n          urls = args['urls'].filter((u): u is string => typeof u === 'string');\n        } else if (typeof args['url'] === 'string') {\n          urls = [args['url']];\n        }\n\n        if (urls.length === 0) {\n          return 'Error: at least one URL is required';\n        }\n\n        // Limit to 5 URLs\n        urls = urls.slice(0, 5);\n\n        const tavilyKey = getSecretValue('TAVILY_API_KEY');\n        if (!tavilyKey) {\n          return 'WebExtract requires TAVILY_API_KEY to be configured. Use /secrets set TAVILY_API_KEY to configure.';\n        }\n\n        try {\n          return await extractTavily(urls, tavilyKey);\n        } catch (error) {\n          return buildError('WebExtract', error, { urls: urls.join(', ') });\n        }\n      },\n    },\n  ];\n}\n\n/**\n * Search using Tavily API (recommended provider)\n */\nasync function searchTavily(\n  query: string,\n  apiKey: string,\n  options: { maxResults: number; searchDepth: string; includeAnswer: boolean }\n): Promise<string> {\n  const controller = new AbortController();\n  const timeout = setTimeout(() => controller.abort(), 30000); // 30 second timeout\n\n  try {\n    const response = await fetch('https://api.tavily.com/search', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        api_key: apiKey,\n        query,\n        search_depth: options.searchDepth,\n        include_answer: options.includeAnswer,\n        max_results: options.maxResults,\n      }),\n      signal: controller.signal,\n    });\n    if (!response.ok) {\n      const text = await response.text();\n      throw new Error(`Tavily API error: ${response.status} ${text}`);\n    }\n\n    const data = (await response.json()) as TavilySearchResponse;\n    return formatTavilyResults(data, 'Tavily');\n  } catch (error) {\n    if (error instanceof Error && error.name === 'AbortError') {\n      throw new Error('Tavily search timed out after 30 seconds');\n    }\n    throw error;\n  } finally {\n    clearTimeout(timeout);\n  }\n}\n\n/**\n * Search using Brave Search API\n */\nasync function searchBrave(\n  query: string,\n  apiKey: string,\n  options: { maxResults: number }\n): Promise<string> {\n  const params = new URLSearchParams({\n    q: query,\n    count: String(options.maxResults),\n  });\n\n  const controller = new AbortController();\n  const timeout = setTimeout(() => controller.abort(), 30000); // 30 second timeout\n\n  try {\n    const response = await fetch(`https://api.search.brave.com/res/v1/web/search?${params}`, {\n      headers: {\n        'Accept': 'application/json',\n        'X-Subscription-Token': apiKey,\n      },\n      signal: controller.signal,\n    });\n\n    if (!response.ok) {\n      const text = await response.text();\n      throw new Error(`Brave Search API error: ${response.status} ${text}`);\n    }\n\n    const data = (await response.json()) as BraveSearchResponse;\n    return formatBraveResults(data, 'Brave Search');\n  } catch (error) {\n    if (error instanceof Error && error.name === 'AbortError') {\n      throw new Error('Brave search timed out after 30 seconds');\n    }\n    throw error;\n  } finally {\n    clearTimeout(timeout);\n  }\n}\n\n/**\n * Search using SerpAPI\n */\nasync function searchSerpAPI(\n  query: string,\n  apiKey: string,\n  options: { maxResults: number }\n): Promise<string> {\n  const params = new URLSearchParams({\n    q: query,\n    api_key: apiKey,\n    engine: 'google',\n    num: String(options.maxResults),\n  });\n\n  const controller = new AbortController();\n  const timeout = setTimeout(() => controller.abort(), 30000); // 30 second timeout\n\n  try {\n    const response = await fetch(`https://serpapi.com/search?${params}`, {\n      signal: controller.signal,\n    });\n\n    if (!response.ok) {\n      const text = await response.text();\n      throw new Error(`SerpAPI error: ${response.status} ${text}`);\n    }\n\n    const data = (await response.json()) as SerpAPIResponse;\n    return formatSerpAPIResults(data, 'SerpAPI');\n  } catch (error) {\n    if (error instanceof Error && error.name === 'AbortError') {\n      throw new Error('SerpAPI search timed out after 30 seconds');\n    }\n    throw error;\n  } finally {\n    clearTimeout(timeout);\n  }\n}\n\n/**\n * Extract content using Tavily Extract API\n */\nasync function extractTavily(urls: string[], apiKey: string): Promise<string> {\n  const response = await fetch('https://api.tavily.com/extract', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n    },\n    body: JSON.stringify({\n      api_key: apiKey,\n      urls,\n    }),\n  });\n\n  if (!response.ok) {\n    const text = await response.text();\n    throw new Error(`Tavily Extract API error: ${response.status} ${text}`);\n  }\n\n  const data = (await response.json()) as TavilyExtractResponse;\n  return formatExtractResults(data);\n}\n\n/**\n * Format Tavily search results\n */\nfunction formatTavilyResults(data: TavilySearchResponse, provider: string): string {\n  const lines: string[] = [`[WebSearch via ${provider}]`, ''];\n\n  if (data.answer) {\n    lines.push('Summary:', data.answer, '');\n  }\n\n  if (!data.results || data.results.length === 0) {\n    lines.push('No results found.');\n    return lines.join('\\n');\n  }\n\n  lines.push(`Results for \"${data.query}\":`);\n  lines.push('');\n\n  for (const result of data.results) {\n    lines.push(`**${result.title}**`);\n    lines.push(result.url);\n    if (result.content) {\n      const snippet = result.content.length > 300\n        ? result.content.slice(0, 300) + '...'\n        : result.content;\n      lines.push(snippet);\n    }\n    if (result.published_date) {\n      lines.push(`Published: ${result.published_date}`);\n    }\n    lines.push('');\n  }\n\n  return lines.join('\\n');\n}\n\n/**\n * Format Brave search results\n */\nfunction formatBraveResults(data: BraveSearchResponse, provider: string): string {\n  const lines: string[] = [`[WebSearch via ${provider}]`, ''];\n\n  const results = data.web?.results || [];\n  if (results.length === 0) {\n    lines.push('No results found.');\n    return lines.join('\\n');\n  }\n\n  for (const result of results) {\n    lines.push(`**${result.title}**`);\n    lines.push(result.url);\n    if (result.description) {\n      lines.push(result.description);\n    }\n    if (result.profile?.name) {\n      lines.push(`Source: ${result.profile.name}`);\n    }\n    if (result.publishedDate) {\n      lines.push(`Published: ${result.publishedDate}`);\n    }\n    lines.push('');\n  }\n\n  return lines.join('\\n');\n}\n\n/**\n * Format SerpAPI results\n */\nfunction formatSerpAPIResults(data: SerpAPIResponse, provider: string): string {\n  const lines: string[] = [`[WebSearch via ${provider}]`, ''];\n\n  const results = data.organic_results || [];\n  if (results.length === 0) {\n    lines.push('No results found.');\n    return lines.join('\\n');\n  }\n\n  for (const result of results) {\n    lines.push(`**${result.title}**`);\n    lines.push(result.link);\n    if (result.snippet) {\n      lines.push(result.snippet);\n    }\n    if (result.source) {\n      lines.push(`Source: ${result.source}`);\n    }\n    if (result.date) {\n      lines.push(`Date: ${result.date}`);\n    }\n    lines.push('');\n  }\n\n  return lines.join('\\n');\n}\n\n/**\n * Format Tavily extract results\n */\nfunction formatExtractResults(data: TavilyExtractResponse): string {\n  const lines: string[] = ['[WebExtract via Tavily]', ''];\n\n  if (!data.results || data.results.length === 0) {\n    lines.push('No content extracted.');\n    return lines.join('\\n');\n  }\n\n  for (const result of data.results) {\n    lines.push(`**${result.url}**`);\n    lines.push('');\n    if (result.raw_content) {\n      // Truncate very long content\n      const content = result.raw_content.length > 5000\n        ? result.raw_content.slice(0, 5000) + '\\n\\n[Content truncated...]'\n        : result.raw_content;\n      lines.push(content);\n    }\n    lines.push('');\n    lines.push('---');\n    lines.push('');\n  }\n\n  return lines.join('\\n');\n}\n\n// Export types for testing\nexport type { SearchProvider, TavilySearchResponse, BraveSearchResponse, SerpAPIResponse };\n"],"mappings":"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","ignoreList":[]}