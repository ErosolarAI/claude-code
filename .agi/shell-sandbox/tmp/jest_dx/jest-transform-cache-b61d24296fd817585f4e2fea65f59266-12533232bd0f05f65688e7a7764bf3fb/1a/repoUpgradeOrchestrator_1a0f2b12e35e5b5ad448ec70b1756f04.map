{"version":3,"names":["_nodeFs","require","_nodePath","_nodeOs","_unifiedOrchestrator","_parallelExecutor","_dualTournament","DEFAULT_REWARD_WEIGHTS","exports","executionSuccess","testsPassed","staticAnalysis","codeQuality","blastRadius","selfAssessment","speedBonus","calculateRewardScore","signals","weights","score","totalWeight","key","weight","Object","entries","signal","extractRewardSignals","output","durationMs","baselineDurationMs","lower","toLowerCase","clamp","value","Math","max","min","hasErrors","test","testMatch","match","failMatch","passed","parseInt","failed","total","diffMatch","filesChanged","speedRatio","REPO_UPGRADE_MODE_DEFINITIONS","id","label","description","variants","variantGuidance","primary","parallelVariants","refiner","refinerBias","buildRepoWidePlan","workspaceRoot","additionalScopes","areas","scope","candidates","codemodCommands","validationCommands","extra","trim","slug","replace","push","modules","workspaceModules","detectWorkspaceModules","area","matches","some","candidate","existsSync","join","steps","buildDefaultSteps","length","pkgPath","workspaces","pkg","JSON","parse","readFileSync","parseWorkspaceField","seen","Set","pattern","paths","expandWorkspacePattern","relPath","has","add","cleanPath","name","split","filter","Boolean","pop","normalizedPath","Array","isArray","map","entry","record","packages","normalized","includes","target","base","baseDir","readdirSync","withFileTypes","isDirectory","RepoUpgradeOrchestrator","UnifiedOrchestrator","parallelExecutor","repoTypeTelemetry","Map","disableTelemetryPersistence","process","env","AGI_DISABLE_RL_TELEMETRY","constructor","executor","getParallelExecutor","concurrency","ParallelExecutor","maxConcurrency","continueOnFailure","onTaskEvent","event","emit","type","timestamp","data","run","plan","options","mode","objective","modeDefinition","getModeDefinition","parallelModules","parallelModuleConcurrency","variantWorkspaceRoots","repoPolicy","undefined","results","findings","variantStats","primaryWins","refinerWins","ties","totalSteps","Date","now","moduleReports","runModulesInParallel","runModulesSequentially","baseReport","generateReport","halted","module","status","moduleReport","processModule","moduleCount","tasks","createTask","parallelizable","group","batchResult","execute","totalDurationMs","successCount","failureCount","parallelismAchieved","result","moduleId","taskId","find","m","step","outcome","runStep","updateVariantStats","winner","success","stepId","variant","variantResults","canRunParallel","variantPromises","safeExecuteVariant","previousResult","Promise","all","tournamentOutcome","evaluateTournamentOutcome","attachTournamentBreakdown","winnerVariant","ranked","top","topVariant","candidateId","humanAccuracy","tournament","fallback","pickWinner","recordOutcomeArtifacts","primaryScore","aggregateScore","refinerScore","primaryAccuracy","refinerAccuracy","primarySuccess","refinerSuccess","tournamentRankings","intent","updateRepoTypeTelemetry","getRepoTypeFromModule","buildTournamentCandidate","task","goal","constraints","metadata","evaluatorConfig","buildEvaluatorConfig","runDualTournament","rewardWeights","evaluators","maxCandidates","rewardSignals","rawReward","clampScore","adjustedReward","evaluatorScores","evaluatorId","qualityScore","averageDefined","Number","isNaN","policyId","patchSummary","summary","metrics","rewardModelScore","rawOutput","detail","repoType","getRepoTypeFromOutcomeMetadata","input","error","message","Error","String","execution","duration","command","notes","definition","updateRepoTypeTelemetryMap","stats","primaryTournamentScore","refinerScoreRaw","scoresClose","abs","bothSucceeded","isFinite","values","nums","v","NaN","reduce","sum","val","DEFAULT_HUMAN_REWARD_WEIGHTS","hardWeight","qualityWeight","rewardWeight","alpha","beta","gamma","telemetry","get","winsPrimary","winsRefiner","bias","kind","scopeText","ensureTelemetryLoaded","current","updated","set","persistTelemetry","TELEMETRY_DIR","homedir","TELEMETRY_FILE","telemetryLoaded","mkdirSync","recursive","payload","writeFileSync","stringify","prompt"],"sources":["repoUpgradeOrchestrator.ts"],"sourcesContent":["import { existsSync, readFileSync, readdirSync, writeFileSync, mkdirSync } from 'node:fs';\nimport { join } from 'node:path';\nimport { homedir } from 'node:os';\nimport { UnifiedOrchestrator, type ExecutionResult, type Finding, type OperationReport } from './unifiedOrchestrator.js';\nimport { ParallelExecutor, createTask, type ParallelTask } from './parallelExecutor.js';\nimport {\n  DEFAULT_HUMAN_REWARD_WEIGHTS,\n  runDualTournament,\n  type RankedCandidate,\n  type TournamentCandidate,\n  type TournamentOutcome,\n  type TournamentTask,\n} from './dualTournament.js';\n\nexport type RepoUpgradeMode = 'single-continuous' | 'dual-rl-continuous' | 'dual-rl-tournament';\nexport type UpgradeVariant = 'primary' | 'refiner';\n\n/**\n * Reward signal components for multi-objective RL scoring.\n * Each signal is normalized to [0, 1] range.\n */\nexport interface RewardSignals {\n  /** Did the execution complete without errors? (0 or 1) */\n  executionSuccess: number;\n  /** Did tests pass? (0-1, partial credit for some passing) */\n  testsPassed: number;\n  /** Did lint/type checks pass? (0-1) */\n  staticAnalysis: number;\n  /** Code quality metrics (complexity reduction, no new warnings) */\n  codeQuality: number;\n  /** How minimal/surgical were the changes? (inverse of blast radius) */\n  blastRadius: number;\n  /** Confidence from LLM self-assessment keywords */\n  selfAssessment: number;\n  /** Bonus for faster execution (relative to baseline) */\n  speedBonus: number;\n}\n\n/**\n * Weights for combining reward signals into final score.\n * Tuned for safe, high-quality upgrades.\n */\nexport interface RewardWeights {\n  executionSuccess: number;\n  testsPassed: number;\n  staticAnalysis: number;\n  codeQuality: number;\n  blastRadius: number;\n  selfAssessment: number;\n  speedBonus: number;\n}\n\nexport const DEFAULT_REWARD_WEIGHTS: RewardWeights = {\n  executionSuccess: 0.25,\n  testsPassed: 0.30,\n  staticAnalysis: 0.15,\n  codeQuality: 0.10,\n  blastRadius: 0.10,\n  selfAssessment: 0.05,\n  speedBonus: 0.05,\n};\n\n/**\n * Calculate composite reward score from individual signals.\n */\nexport function calculateRewardScore(\n  signals: Partial<RewardSignals>,\n  weights: RewardWeights = DEFAULT_REWARD_WEIGHTS\n): number {\n  let score = 0;\n  let totalWeight = 0;\n\n  for (const [key, weight] of Object.entries(weights)) {\n    const signal = signals[key as keyof RewardSignals];\n    if (typeof signal === 'number') {\n      score += signal * weight;\n      totalWeight += weight;\n    }\n  }\n\n  return totalWeight > 0 ? score / totalWeight : 0;\n}\n\n/**\n * Extract reward signals from execution output text.\n */\nexport function extractRewardSignals(\n  output: string,\n  durationMs: number,\n  baselineDurationMs = 60000\n): Partial<RewardSignals> {\n  const lower = output.toLowerCase();\n  const signals: Partial<RewardSignals> = {};\n  const clamp = (value: number) => Math.max(0, Math.min(1, value));\n\n  // Execution success - no error keywords\n  const hasErrors = /\\b(error|exception|failed|failure|fatal)\\b/i.test(output);\n  signals.executionSuccess = hasErrors ? 0 : 1;\n\n  // Tests passed - look for test result patterns\n  const testMatch = output.match(/(\\d+)\\s*(?:tests?\\s*)?pass(?:ed|ing)?/i);\n  const failMatch = output.match(/(\\d+)\\s*(?:tests?\\s*)?fail(?:ed|ing)?/i);\n  if (testMatch || failMatch) {\n    const passed = parseInt(testMatch?.[1] ?? '0', 10);\n    const failed = parseInt(failMatch?.[1] ?? '0', 10);\n    const total = passed + failed;\n    signals.testsPassed = total > 0 ? passed / total : (/pass|success|✓/i.test(lower) ? 1 : 0.5);\n  } else if (/all tests pass|tests passing|✓.*test/i.test(lower)) {\n    signals.testsPassed = 1;\n  }\n\n  // Static analysis - lint/type check patterns\n  if (/lint.*pass|no.*lint.*error|eslint.*clean|tsc.*success/i.test(lower)) {\n    signals.staticAnalysis = 1;\n  } else if (/lint.*warn|eslint.*warn/i.test(lower)) {\n    signals.staticAnalysis = 0.7;\n  } else if (/lint.*error|type.*error|eslint.*error/i.test(lower)) {\n    signals.staticAnalysis = 0.3;\n  }\n\n  // Code quality heuristics (TODO/HACK penalties vs cleanup/refactor bonuses)\n  if (/todo|hack|workaround|temporary fix/i.test(lower)) {\n    signals.codeQuality = 0.45;\n  } else if (/refactor|cleanup|simplif|reducing complexity|streamlined/i.test(lower)) {\n    signals.codeQuality = Math.max(signals.codeQuality ?? 0, 0.65);\n  }\n\n  // Blast radius approximation from diff summaries / dependency adds\n  const diffMatch = output.match(/(\\d+)\\s+files?\\s+changed/i);\n  if (diffMatch) {\n    const filesChanged = parseInt(diffMatch[1] ?? '0', 10);\n    signals.blastRadius = clamp(1 - Math.min(1, filesChanged / 8));\n  }\n  if (/npm install|yarn add|pnpm add|pip install|go get|cargo add/i.test(lower)) {\n    signals.blastRadius = clamp((signals.blastRadius ?? 0.6) - 0.15);\n  }\n\n  // Self-assessment from confidence keywords\n  if (/confident|verified|validated|confirmed/i.test(lower)) {\n    signals.selfAssessment = 0.9;\n  } else if (/likely|probably|should work/i.test(lower)) {\n    signals.selfAssessment = 0.6;\n  } else if (/uncertain|unclear|might|may/i.test(lower)) {\n    signals.selfAssessment = 0.3;\n  }\n\n  // Speed bonus - faster than baseline gets bonus\n  if (durationMs > 0 && baselineDurationMs > 0) {\n    const speedRatio = baselineDurationMs / durationMs;\n    signals.speedBonus = Math.min(1, Math.max(0, (speedRatio - 0.5) / 1.5));\n  }\n\n  return signals;\n}\n\nexport interface RepoUpgradeModeDefinition {\n  id: RepoUpgradeMode;\n  label: string;\n  description: string;\n  /** Ordered list of variants to execute for this mode */\n  variants: UpgradeVariant[];\n  /** Guidance to inject into prompts per variant */\n  variantGuidance?: Partial<Record<UpgradeVariant, string>>;\n  /** Bias to apply to the refiner when scores are tied (encourages RL exploration) */\n  refinerBias?: number;\n  /** Enable parallel variant execution (requires isolated workspaces) */\n  parallelVariants?: boolean;\n}\n\nexport const REPO_UPGRADE_MODE_DEFINITIONS: Record<RepoUpgradeMode, RepoUpgradeModeDefinition> = {\n  'single-continuous': {\n    id: 'single-continuous',\n    label: 'Single continuous',\n    description: 'Single-pass deterministic execution focused on minimal blast radius.',\n    variants: ['primary'],\n    variantGuidance: {\n      primary: 'Plan and execute the best possible upgrade in one pass. Keep edits surgical and runnable.',\n    },\n    parallelVariants: false,\n  },\n  'dual-rl-continuous': {\n    id: 'dual-rl-continuous',\n    label: 'Dual-agent RL continuous',\n    description: 'Primary + refiner loop where the refiner competes to improve safety and quality. Refiner sees primary output.',\n    variants: ['primary', 'refiner'],\n    variantGuidance: {\n      primary: 'Primary pass sets the baseline plan and changes with conservative scope and runnable checks.',\n      refiner:\n        'RL refiner critiques the primary, fixes gaps, tightens safety, and only repeats steps if they materially improve the result.',\n    },\n    refinerBias: 0.05,\n    parallelVariants: false, // Sequential so refiner can see primary's work\n  },\n  'dual-rl-tournament': {\n    id: 'dual-rl-tournament',\n    label: 'Dual-agent RL tournament',\n    description: 'Primary and refiner compete in parallel with isolated workspaces. Best result wins per step.',\n    variants: ['primary', 'refiner'],\n    variantGuidance: {\n      primary: 'Execute the upgrade with focus on correctness and test coverage. You are competing against another agent.',\n      refiner:\n        'Execute the upgrade with focus on safety and minimal changes. You are competing against another agent.',\n    },\n    refinerBias: 0.03, // Lower bias since both start fresh\n    parallelVariants: true, // Run in parallel with git worktree isolation\n  },\n};\n\nexport type UpgradeStepIntent = 'analyze' | 'upgrade' | 'verify' | 'cleanup';\n\nexport interface RepoUpgradeStep {\n  id: string;\n  intent: UpgradeStepIntent;\n  description: string;\n  /** Optional instruction or prompt to feed into the executor */\n  prompt?: string;\n}\n\nexport interface RepoUpgradeModule {\n  id: string;\n  label: string;\n  description: string;\n  scope: string[];\n  /** Suggested codemod commands to run for this module (display only, not executed automatically). */\n  codemodCommands?: string[];\n  /** Suggested validation commands to run for this module (display only, not executed automatically). */\n  validationCommands?: string[];\n  steps: RepoUpgradeStep[];\n}\n\nexport interface RepoUpgradePlan {\n  modules: RepoUpgradeModule[];\n}\n\nexport interface UpgradeStepExecutionInput {\n  module: RepoUpgradeModule;\n  step: RepoUpgradeStep;\n  /** Which path we are taking: single-pass primary or the dual RL refiner */\n  variant: UpgradeVariant;\n  mode: RepoUpgradeMode;\n  previousResult?: UpgradeStepResult;\n  workspaceRoot?: string;\n  repoPolicy?: string;\n}\n\nexport interface UpgradeStepResult {\n  success: boolean;\n  summary: string;\n  detail?: string;\n  score?: number;\n  /** Tournament-derived human accuracy (1=best, 0=worst across variants) */\n  humanAccuracy?: number;\n  rewardSignals?: Partial<RewardSignals>;\n  /** Tournament breakdown for dual competitions */\n  tournament?: RankedCandidate;\n  durationMs?: number;\n  execution?: ExecutionResult;\n  findings?: Finding[];\n  notes?: string[];\n}\n\nexport interface UpgradeStepOutcome {\n  stepId: string;\n  intent: UpgradeStepIntent;\n  description: string;\n  primary: UpgradeStepResult;\n  refiner?: UpgradeStepResult;\n  winner: UpgradeStepResult;\n  winnerVariant: UpgradeVariant;\n  status: 'completed' | 'failed';\n}\n\nexport interface UpgradeModuleReport {\n  id: string;\n  label: string;\n  scope: string[];\n  codemodCommands?: string[];\n  validationCommands?: string[];\n  steps: UpgradeStepOutcome[];\n  status: 'completed' | 'failed' | 'skipped';\n  validations?: ValidationRunResult[];\n}\n\nexport interface RepoUpgradeReport extends OperationReport {\n  mode: RepoUpgradeMode;\n  continueOnFailure: boolean;\n  modules: UpgradeModuleReport[];\n  validationArtifacts?: ValidationRunResult[];\n  /** True when validation commands were executed instead of just suggested */\n  validationsExecuted?: boolean;\n  variantStats: VariantWinStats;\n  /** Paths used per variant when running dual workspaces (for git/worktree integrations). */\n  variantWorkspaceRoots?: Partial<Record<UpgradeVariant, string>>;\n  /** Optional policy that guided the run (e.g., upgrade or change-management policy). */\n  repoPolicy?: string;\n}\n\nexport interface RepoUpgradeRunOptions {\n  objective?: string;\n  mode: RepoUpgradeMode;\n  continueOnFailure?: boolean;\n  /** Optional per-variant workspace roots when running dual RL with separate repos. */\n  variantWorkspaceRoots?: Partial<Record<UpgradeVariant, string>>;\n  /** Optional policy/guideline string to surface in prompts and reports. */\n  repoPolicy?: string;\n  /** Enable parallel module processing (default: false for safety). */\n  parallelModules?: boolean;\n  /** Maximum concurrent modules when parallel processing is enabled (default: 3). */\n  parallelModuleConcurrency?: number;\n  /** Enable parallel variant execution in dual-RL mode (default: true). */\n  parallelVariants?: boolean;\n}\n\nexport type UpgradeStepExecutor = (input: UpgradeStepExecutionInput) => Promise<UpgradeStepResult>;\n\nexport interface ValidationRunResult {\n  command: string;\n  success: boolean;\n  output: string;\n  error?: string;\n  durationMs: number;\n  skipped?: boolean;\n  reason?: string;\n}\n\nexport interface VariantWinStats {\n  primaryWins: number;\n  refinerWins: number;\n  /** Number of steps where scores were effectively tied and bias picked the winner */\n  ties: number;\n  totalSteps: number;\n}\n\n/**\n * Build a repo-wide upgrade plan using common directories. Falls back to a single\n * catch-all module when no known scopes are found.\n */\nexport function buildRepoWidePlan(workspaceRoot: string, additionalScopes: string[] = []): RepoUpgradePlan {\n  const areas: Array<{\n    id: string;\n    label: string;\n    description: string;\n    scope: string[];\n    candidates: string[];\n    codemodCommands?: string[];\n    validationCommands?: string[];\n  }> = [\n    {\n      id: 'source',\n      label: 'Source',\n      description: 'Core application and library code.',\n      scope: ['src/**/*', 'lib/**/*'],\n      candidates: ['src', 'lib'],\n      codemodCommands: ['npx jscodeshift -t <transform> src'],\n      validationCommands: ['npm run build', 'npm test'],\n    },\n    {\n      id: 'tests',\n      label: 'Tests',\n      description: 'Unit, integration, and smoke tests.',\n      scope: ['test/**/*', '__tests__/**/*'],\n      candidates: ['test', '__tests__'],\n      validationCommands: ['npm test -- --runInBand', 'npm run lint'],\n    },\n    {\n      id: 'docs',\n      label: 'Docs',\n      description: 'Documentation and guides.',\n      scope: ['docs/**/*', 'README.md'],\n      candidates: ['docs', 'README.md'],\n    },\n    {\n      id: 'scripts',\n      label: 'Tooling Scripts',\n      description: 'Build, migration, and maintenance scripts.',\n      scope: ['scripts/**/*'],\n      candidates: ['scripts'],\n      validationCommands: ['npm run lint -- scripts/**/*.ts'],\n    },\n    {\n      id: 'agents',\n      label: 'Agents',\n      description: 'Agent rules and behaviors.',\n      scope: ['agents/**/*'],\n      candidates: ['agents'],\n      validationCommands: ['npm run build'],\n    },\n    {\n      id: 'skills',\n      label: 'Skills',\n      description: 'Skill packs and reusable automation.',\n      scope: ['skills/**/*'],\n      candidates: ['skills'],\n      validationCommands: ['npm run build'],\n    },\n    {\n      id: 'examples',\n      label: 'Examples',\n      description: 'Example flows and templates.',\n      scope: ['examples/**/*'],\n      candidates: ['examples'],\n    },\n    {\n      id: 'configs',\n      label: 'Configuration',\n      description: 'Configuration and deployment settings.',\n      scope: ['config/**/*', '*.config.*', '*.rc', '*.json'],\n      candidates: ['config'],\n    },\n  ];\n\n  for (const extra of additionalScopes) {\n    if (!extra?.trim()) continue;\n    const slug = extra.replace(/[^\\w]/g, '-').toLowerCase() || 'custom';\n    areas.push({\n      id: `custom-${slug}`,\n      label: `Custom: ${extra}`,\n      description: `User-specified scope: ${extra}`,\n      scope: [`${extra}/**/*`],\n      candidates: [extra],\n    });\n  }\n\n  const modules: RepoUpgradeModule[] = [];\n  const workspaceModules = detectWorkspaceModules(workspaceRoot);\n  modules.push(...workspaceModules);\n\n  for (const area of areas) {\n    const matches = area.candidates.some((candidate) => existsSync(join(workspaceRoot, candidate)));\n    if (!matches) {\n      continue;\n    }\n    modules.push({\n      id: area.id,\n      label: area.label,\n      description: area.description,\n      scope: area.scope,\n      codemodCommands: area.codemodCommands,\n      validationCommands: area.validationCommands,\n      steps: buildDefaultSteps(area.id),\n    });\n  }\n\n  if (modules.length === 0) {\n    modules.push({\n      id: 'repo-wide',\n      label: 'Repository',\n      description: 'Fallback repo-wide upgrade module.',\n      scope: ['**/*'],\n      steps: buildDefaultSteps('repo'),\n    });\n  }\n\n  return { modules };\n}\n\nfunction detectWorkspaceModules(workspaceRoot: string): RepoUpgradeModule[] {\n  const pkgPath = join(workspaceRoot, 'package.json');\n  if (!existsSync(pkgPath)) {\n    return [];\n  }\n\n  let workspaces: string[] = [];\n  try {\n    const pkg = JSON.parse(readFileSync(pkgPath, 'utf8'));\n    workspaces = parseWorkspaceField(pkg?.workspaces);\n  } catch {\n    return [];\n  }\n\n  if (!workspaces.length) {\n    return [];\n  }\n\n  const modules: RepoUpgradeModule[] = [];\n  const seen = new Set<string>();\n\n  for (const pattern of workspaces) {\n    const paths = expandWorkspacePattern(workspaceRoot, pattern);\n    for (const relPath of paths) {\n      if (seen.has(relPath)) {\n        continue;\n      }\n      seen.add(relPath);\n\n      const cleanPath = relPath.replace(/\\/+$/, '');\n      const name = cleanPath.split('/').filter(Boolean).pop() ?? cleanPath;\n      const normalizedPath = cleanPath.replace(/[/\\\\]+/g, '-');\n      const slug = `workspace-${normalizedPath.replace(/[^\\w-]+/g, '-').replace(/-+/g, '-').toLowerCase() || 'default'}`;\n\n      modules.push({\n        id: slug,\n        label: `Workspace: ${name}`,\n        description: `Upgrade tasks scoped to workspace \"${name}\" (${cleanPath}).`,\n        scope: [`${cleanPath}/**/*`],\n        validationCommands: [\n          `npm test --workspace ${name} --if-present`,\n          `npm run lint --workspace ${name} --if-present`,\n        ],\n        steps: buildDefaultSteps(slug),\n      });\n    }\n  }\n\n  return modules;\n}\n\nfunction parseWorkspaceField(value: unknown): string[] {\n  if (Array.isArray(value)) {\n    return value.map((entry) => (typeof entry === 'string' ? entry.trim() : '')).filter(Boolean);\n  }\n  if (value && typeof value === 'object') {\n    const record = value as { packages?: unknown };\n    if (Array.isArray(record.packages)) {\n      return record.packages.map((entry) => (typeof entry === 'string' ? entry.trim() : '')).filter(Boolean);\n    }\n  }\n  return [];\n}\n\nfunction expandWorkspacePattern(workspaceRoot: string, pattern: string): string[] {\n  const normalized = pattern.trim();\n  if (!normalized) return [];\n\n  if (!normalized.includes('*')) {\n    const target = join(workspaceRoot, normalized);\n    return existsSync(target) ? [normalized] : [];\n  }\n\n  const base = normalized.split('*')[0]?.replace(/\\/+$/, '') ?? '';\n  if (!base) return [];\n\n  const baseDir = join(workspaceRoot, base);\n  if (!existsSync(baseDir)) return [];\n\n  try {\n    const entries = readdirSync(baseDir, { withFileTypes: true });\n    return entries.filter((entry) => entry.isDirectory()).map((entry) => `${base}/${entry.name}`);\n  } catch {\n    return [];\n  }\n}\n\nexport class RepoUpgradeOrchestrator extends UnifiedOrchestrator {\n  private readonly executor: UpgradeStepExecutor;\n  private variantWorkspaceRoots: Partial<Record<UpgradeVariant, string>> | undefined;\n  private repoPolicy: string | undefined;\n  private parallelExecutor: ParallelExecutor | null = null;\n  private objective: string | undefined;\n  static repoTypeTelemetry: Map<string, { winsPrimary: number; winsRefiner: number }> = new Map();\n  /** Disable persisted telemetry via env or flag */\n  static disableTelemetryPersistence = process.env.AGI_DISABLE_RL_TELEMETRY === '1';\n\n  constructor(executor: UpgradeStepExecutor) {\n    super();\n    this.executor = executor;\n  }\n\n  /**\n   * Get or create a parallel executor instance\n   */\n  private getParallelExecutor(concurrency: number): ParallelExecutor {\n    if (!this.parallelExecutor) {\n      this.parallelExecutor = new ParallelExecutor({\n        maxConcurrency: concurrency,\n        continueOnFailure: true,\n        onTaskEvent: (event) => {\n          this.emit({\n            type: `parallel.${event.type}`,\n            timestamp: event.timestamp,\n            data: event.data,\n          });\n        },\n      });\n    }\n    return this.parallelExecutor;\n  }\n\n  /**\n   * Execute the repo-wide plan using either single continuous or dual RL continuous mode.\n   * Supports parallel module processing and parallel variant execution for improved performance.\n   */\n  async run(plan: RepoUpgradePlan, options: RepoUpgradeRunOptions): Promise<RepoUpgradeReport> {\n    const mode = options.mode;\n    const continueOnFailure = options.continueOnFailure ?? true;\n    const objective = options.objective ?? 'Repository-wide source code upgrade';\n    const modeDefinition = getModeDefinition(mode);\n    this.objective = objective;\n    const parallelModules = options.parallelModules ?? false;\n    const parallelModuleConcurrency = options.parallelModuleConcurrency ?? 3;\n    const parallelVariants = options.parallelVariants ?? true;\n    this.variantWorkspaceRoots = options.variantWorkspaceRoots;\n    this.repoPolicy = options.repoPolicy ?? undefined;\n\n    // Reset state per run to keep reports clean\n    this.results = [];\n    this.findings = [];\n    this.parallelExecutor = null;\n\n    const variantStats: VariantWinStats = { primaryWins: 0, refinerWins: 0, ties: 0, totalSteps: 0 };\n\n    // Emit parallel mode info\n    this.emit({\n      type: 'upgrade.parallel.config',\n      timestamp: Date.now(),\n      data: {\n        parallelModules,\n        parallelModuleConcurrency,\n        parallelVariants,\n        mode,\n      },\n    });\n\n    let moduleReports: UpgradeModuleReport[];\n\n    if (parallelModules && plan.modules.length > 1) {\n      // PARALLEL MODULE PROCESSING\n      moduleReports = await this.runModulesInParallel(\n        plan.modules,\n        mode,\n        modeDefinition,\n        parallelModuleConcurrency,\n        parallelVariants,\n        continueOnFailure,\n        variantStats\n      );\n    } else {\n      // SEQUENTIAL MODULE PROCESSING (original behavior)\n      moduleReports = await this.runModulesSequentially(\n        plan.modules,\n        mode,\n        modeDefinition,\n        parallelVariants,\n        continueOnFailure,\n        variantStats\n      );\n    }\n\n    const baseReport = this.generateReport(objective);\n    return {\n      ...baseReport,\n      mode,\n      continueOnFailure,\n      modules: moduleReports,\n      variantStats,\n      variantWorkspaceRoots: this.variantWorkspaceRoots,\n      repoPolicy: this.repoPolicy,\n    };\n  }\n\n  /**\n   * Run modules sequentially (original behavior)\n   */\n  private async runModulesSequentially(\n    modules: RepoUpgradeModule[],\n    mode: RepoUpgradeMode,\n    modeDefinition: RepoUpgradeModeDefinition,\n    parallelVariants: boolean,\n    continueOnFailure: boolean,\n    variantStats: VariantWinStats\n  ): Promise<UpgradeModuleReport[]> {\n    const moduleReports: UpgradeModuleReport[] = [];\n    let halted = false;\n\n    for (const module of modules) {\n      if (halted) {\n        moduleReports.push({\n          id: module.id,\n          label: module.label,\n          scope: module.scope,\n          steps: [],\n          status: 'skipped',\n        });\n        continue;\n      }\n\n      const moduleReport = await this.processModule(module, mode, modeDefinition, parallelVariants, variantStats, continueOnFailure);\n      moduleReports.push(moduleReport);\n\n      if (moduleReport.status === 'failed' && !continueOnFailure) {\n        halted = true;\n      }\n    }\n\n    return moduleReports;\n  }\n\n  /**\n   * Run modules in parallel using the ParallelExecutor\n   */\n  private async runModulesInParallel(\n    modules: RepoUpgradeModule[],\n    mode: RepoUpgradeMode,\n    modeDefinition: RepoUpgradeModeDefinition,\n    concurrency: number,\n    parallelVariants: boolean,\n    continueOnFailure: boolean,\n    variantStats: VariantWinStats\n  ): Promise<UpgradeModuleReport[]> {\n    const executor = this.getParallelExecutor(concurrency);\n\n    this.emit({\n      type: 'upgrade.parallel.start',\n      timestamp: Date.now(),\n      data: { moduleCount: modules.length, concurrency },\n    });\n\n    // Create parallel tasks for each module\n    const tasks: ParallelTask<UpgradeModuleReport>[] = modules.map((module) =>\n      createTask(\n        `module:${module.id}`,\n        async () => this.processModule(module, mode, modeDefinition, parallelVariants, variantStats, continueOnFailure),\n        {\n          label: module.label,\n          parallelizable: true,\n          group: 'modules',\n        }\n      )\n    );\n\n    const batchResult = await executor.execute(tasks);\n\n    this.emit({\n      type: 'upgrade.parallel.complete',\n      timestamp: Date.now(),\n      data: {\n        totalDurationMs: batchResult.totalDurationMs,\n        successCount: batchResult.successCount,\n        failureCount: batchResult.failureCount,\n        parallelismAchieved: batchResult.parallelismAchieved,\n      },\n    });\n\n    // Extract results in order, handling failures\n    const moduleReports: UpgradeModuleReport[] = [];\n    for (const result of batchResult.results) {\n      if (result.status === 'completed' && result.result) {\n        moduleReports.push(result.result);\n      } else {\n        // Create a failed report for tasks that couldn't complete\n        const moduleId = result.taskId.replace('module:', '');\n        const module = modules.find((m) => m.id === moduleId);\n        moduleReports.push({\n          id: moduleId,\n          label: module?.label ?? moduleId,\n          scope: module?.scope ?? [],\n          steps: [],\n          status: 'failed',\n        });\n\n        if (!continueOnFailure) {\n          // Mark remaining as skipped\n          break;\n        }\n      }\n    }\n\n    return moduleReports;\n  }\n\n  /**\n   * Process a single module (can be called in parallel or sequentially)\n   */\n  private async processModule(\n    module: RepoUpgradeModule,\n    mode: RepoUpgradeMode,\n    modeDefinition: RepoUpgradeModeDefinition,\n    parallelVariants: boolean,\n    variantStats: VariantWinStats,\n    continueOnFailure = true\n  ): Promise<UpgradeModuleReport> {\n    this.emit({\n      type: 'upgrade.module.start',\n      timestamp: Date.now(),\n      data: { moduleId: module.id, label: module.label, scope: module.scope, mode },\n    });\n\n    const moduleReport: UpgradeModuleReport = {\n      id: module.id,\n      label: module.label,\n      scope: module.scope,\n      codemodCommands: module.codemodCommands,\n      validationCommands: module.validationCommands,\n      steps: [],\n      status: 'completed',\n    };\n\n    for (const step of module.steps) {\n      const outcome = await this.runStep(module, step, mode, parallelVariants);\n      moduleReport.steps.push(outcome);\n      this.updateVariantStats(variantStats, outcome, modeDefinition);\n\n      if (!outcome.winner.success) {\n        moduleReport.status = 'failed';\n        // Stop processing this module's steps if continueOnFailure is false\n        if (!continueOnFailure) {\n          break;\n        }\n      }\n    }\n\n    this.emit({\n      type: 'upgrade.module.complete',\n      timestamp: Date.now(),\n      data: { moduleId: module.id, status: moduleReport.status },\n    });\n\n    return moduleReport;\n  }\n\n  private async runStep(\n    module: RepoUpgradeModule,\n    step: RepoUpgradeStep,\n    mode: RepoUpgradeMode,\n    parallelVariants = true\n  ): Promise<UpgradeStepOutcome> {\n    const modeDefinition = getModeDefinition(mode);\n    this.emit({\n      type: 'upgrade.step.start',\n      timestamp: Date.now(),\n      data: { moduleId: module.id, stepId: step.id, variant: 'primary', mode, parallelVariants },\n    });\n\n    const variantResults: Partial<Record<UpgradeVariant, UpgradeStepResult>> = {};\n\n    // Determine if we can run variants in parallel\n    // Parallel is possible when:\n    // 1. parallelVariants is enabled\n    // 2. We have both primary and refiner variants\n    // 3. We have separate workspace roots for each variant\n    const canRunParallel =\n      parallelVariants &&\n      modeDefinition.variants.includes('refiner') &&\n      this.variantWorkspaceRoots?.refiner &&\n      this.variantWorkspaceRoots.refiner !== this.variantWorkspaceRoots.primary;\n\n    if (canRunParallel && modeDefinition.variants.length > 1) {\n      // PARALLEL VARIANT EXECUTION\n      this.emit({\n        type: 'upgrade.step.variants.parallel',\n        timestamp: Date.now(),\n        data: { moduleId: module.id, stepId: step.id, variants: modeDefinition.variants },\n      });\n\n      const variantPromises = modeDefinition.variants.map(async (variant) => {\n        const result = await this.safeExecuteVariant({\n          module,\n          step,\n          mode,\n          variant,\n          // In parallel mode, refiner doesn't get primary's result as it runs concurrently\n          previousResult: undefined,\n          workspaceRoot: this.variantWorkspaceRoots?.[variant] ?? this.variantWorkspaceRoots?.primary,\n          repoPolicy: this.repoPolicy,\n        });\n        return { variant, result };\n      });\n\n      const results = await Promise.all(variantPromises);\n      for (const { variant, result } of results) {\n        variantResults[variant] = result;\n      }\n    } else {\n      // SEQUENTIAL VARIANT EXECUTION (original behavior)\n      // Refiner gets primary's result for informed refinement\n      for (const variant of modeDefinition.variants) {\n        const previousResult = variant === 'refiner' ? variantResults.primary : undefined;\n        const result = await this.safeExecuteVariant({\n          module,\n          step,\n          mode,\n          variant,\n          previousResult,\n          workspaceRoot: this.variantWorkspaceRoots?.[variant] ?? this.variantWorkspaceRoots?.primary,\n          repoPolicy: this.repoPolicy,\n        });\n        variantResults[variant] = result;\n      }\n    }\n\n    const primary = variantResults.primary as UpgradeStepResult;\n    const refiner = variantResults.refiner;\n\n    const tournamentOutcome = this.evaluateTournamentOutcome(module, step, modeDefinition, primary, refiner);\n    if (tournamentOutcome) {\n      this.attachTournamentBreakdown(variantResults, tournamentOutcome);\n    }\n\n    let winner: UpgradeStepResult;\n    let winnerVariant: UpgradeVariant;\n\n    if (tournamentOutcome?.ranked?.length) {\n      const top = tournamentOutcome.ranked[0];\n      const topVariant = top.candidateId === 'refiner' && refiner ? 'refiner' : 'primary';\n      winnerVariant = topVariant;\n      winner = topVariant === 'refiner' && refiner ? refiner : primary;\n      this.attachTournamentBreakdown(variantResults, tournamentOutcome);\n      primary.humanAccuracy = primary.tournament?.humanAccuracy ?? primary.humanAccuracy;\n      if (refiner) {\n        refiner.humanAccuracy = refiner.tournament?.humanAccuracy ?? refiner.humanAccuracy;\n      }\n    } else {\n      const fallback = this.pickWinner(modeDefinition, primary, refiner);\n      winner = fallback.winner;\n      winnerVariant = fallback.winnerVariant;\n    }\n\n    this.recordOutcomeArtifacts(module, step, winner, winnerVariant);\n\n    const primaryScore = primary.tournament?.aggregateScore ?? primary.score;\n    const refinerScore = refiner?.tournament?.aggregateScore ?? refiner?.score;\n    const primaryAccuracy = primary.tournament?.humanAccuracy ?? primary.humanAccuracy;\n    const refinerAccuracy = refiner?.tournament?.humanAccuracy ?? refiner?.humanAccuracy;\n\n    this.emit({\n      type: 'upgrade.step.complete',\n      timestamp: Date.now(),\n      data: {\n        moduleId: module.id,\n        stepId: step.id,\n        variant: winnerVariant,\n        success: winner.success,\n        // Include outcome details for UI scoring\n        primaryScore,\n        primarySuccess: primary.success,\n        refinerScore,\n        refinerSuccess: refiner?.success,\n        winnerVariant,\n        primaryAccuracy,\n        refinerAccuracy,\n        tournamentRankings: tournamentOutcome?.ranked,\n      },\n    });\n\n    return {\n      stepId: step.id,\n      intent: step.intent,\n      description: step.description,\n      primary,\n      refiner,\n      winner,\n      winnerVariant,\n      status: winner.success ? 'completed' : 'failed',\n    };\n  }\n\n  private evaluateTournamentOutcome(\n    module: RepoUpgradeModule,\n    step: RepoUpgradeStep,\n    modeDefinition: RepoUpgradeModeDefinition,\n    primary: UpgradeStepResult,\n    refiner?: UpgradeStepResult\n  ): TournamentOutcome | null {\n    // Fast exits: if only one variant succeeded, avoid tournament overhead\n    if (primary.success && (!refiner || !refiner.success)) {\n      primary.humanAccuracy = 1;\n      if (refiner) refiner.humanAccuracy = 0;\n      this.updateRepoTypeTelemetry(getRepoTypeFromModule(module), 'primary');\n      return null;\n    }\n    if (refiner?.success && !primary.success) {\n      refiner.humanAccuracy = 1;\n      primary.humanAccuracy = 0;\n      this.updateRepoTypeTelemetry(getRepoTypeFromModule(module), 'refiner');\n      return null;\n    }\n\n    // If neither variant succeeded, skip tournament aggregation for efficiency\n    if (!primary.success && (!refiner || !refiner.success)) {\n      return null;\n    }\n\n    const candidates: TournamentCandidate[] = [\n      this.buildTournamentCandidate('primary', primary, modeDefinition),\n    ];\n\n    if (refiner) {\n      candidates.push(this.buildTournamentCandidate('refiner', refiner, modeDefinition));\n    }\n\n    const task: TournamentTask = {\n      id: `${module.id}:${step.id}`,\n      goal: step.description,\n      constraints: module.scope,\n      metadata: {\n        module: module.label,\n        objective: this.objective,\n        repoPolicy: this.repoPolicy,\n        intent: step.intent,\n      },\n    };\n\n    const evaluatorConfig = buildEvaluatorConfig(module);\n\n    try {\n      return runDualTournament(task, candidates, {\n        rewardWeights: evaluatorConfig.rewardWeights,\n        evaluators: evaluatorConfig.evaluators,\n        maxCandidates: 8,\n      });\n    } catch {\n      return null;\n    }\n  }\n\n  private buildTournamentCandidate(\n    variant: UpgradeVariant,\n    result: UpgradeStepResult,\n    modeDefinition: RepoUpgradeModeDefinition\n  ): TournamentCandidate {\n    const signals = result.rewardSignals ?? {};\n    const rawReward = typeof result.score === 'number' ? clampScore(result.score) : 0;\n    const adjustedReward =\n      variant === 'refiner' ? clampScore(rawReward + (modeDefinition.refinerBias ?? 0)) : rawReward;\n\n    const evaluatorScores: TournamentCandidate['evaluatorScores'] = [\n      { evaluatorId: 'reward-signal', score: adjustedReward, weight: 1 },\n      { evaluatorId: 'hard-metrics', score: signals.executionSuccess ?? (result.success ? 1 : 0), weight: 1.1 },\n    ];\n\n    if (typeof signals.testsPassed === 'number') {\n      evaluatorScores.push({ evaluatorId: 'tests', score: signals.testsPassed, weight: 0.8 });\n    }\n    if (typeof signals.staticAnalysis === 'number') {\n      evaluatorScores.push({ evaluatorId: 'static-analysis', score: signals.staticAnalysis, weight: 0.6 });\n    }\n    if (typeof signals.codeQuality === 'number' || typeof signals.blastRadius === 'number') {\n      const qualityScore = averageDefined([\n        signals.codeQuality,\n        signals.blastRadius,\n        signals.staticAnalysis,\n      ]);\n      if (!Number.isNaN(qualityScore)) {\n        evaluatorScores.push({ evaluatorId: 'quality', score: qualityScore, weight: 0.9 });\n      }\n    }\n\n    return {\n      id: variant,\n      policyId: variant,\n      patchSummary: result.summary,\n      metrics: {\n        executionSuccess: signals.executionSuccess ?? (result.success ? 1 : 0),\n        testsPassed: signals.testsPassed,\n        staticAnalysis: signals.staticAnalysis,\n        codeQuality: signals.codeQuality,\n        blastRadius: signals.blastRadius,\n        speedBonus: signals.speedBonus,\n      },\n      signals: {\n        rewardModelScore: adjustedReward,\n        selfAssessment: signals.selfAssessment,\n      },\n      evaluatorScores: evaluatorScores ?? [],\n      rawOutput: result.detail,\n    };\n  }\n\n  private attachTournamentBreakdown(\n    variantResults: Partial<Record<UpgradeVariant, UpgradeStepResult>>,\n    outcome: TournamentOutcome\n  ): void {\n    for (const entry of outcome.ranked) {\n      const variant = entry.candidateId as UpgradeVariant;\n      const target = variantResults[variant];\n      if (target) {\n        target.tournament = entry;\n        target.humanAccuracy = entry.humanAccuracy;\n      }\n    }\n    // Update telemetry based on winner to auto-tune per repo type\n    const top = outcome.ranked[0];\n    if (top) {\n      const repoType = getRepoTypeFromOutcomeMetadata(outcome.task);\n      this.updateRepoTypeTelemetry(repoType, top.candidateId as UpgradeVariant);\n    }\n  }\n\n  private async safeExecuteVariant(input: UpgradeStepExecutionInput): Promise<UpgradeStepResult> {\n    try {\n      return await this.executor(input);\n    } catch (error) {\n      const message = error instanceof Error ? error.message : String(error);\n      return {\n        success: false,\n        summary: 'Execution failed',\n        detail: message,\n        score: 0,\n        durationMs: 0,\n        execution: {\n          success: false,\n          output: 'Execution failed',\n          duration: 0,\n          command: `${input.module.id}/${input.step.id}/${input.variant}`,\n          error: message,\n        },\n        notes: ['Executor threw an error'],\n      };\n    }\n  }\n\n  private pickWinner(\n    definition: RepoUpgradeModeDefinition,\n    primary: UpgradeStepResult,\n    refiner?: UpgradeStepResult\n  ): { winner: UpgradeStepResult; winnerVariant: UpgradeVariant } {\n    if (!refiner || !definition.variants.includes('refiner')) {\n      return { winner: primary, winnerVariant: 'primary' };\n    }\n\n    if (refiner.success && !primary.success) {\n      return { winner: refiner, winnerVariant: 'refiner' };\n    }\n    if (primary.success && !refiner.success) {\n      return { winner: primary, winnerVariant: 'primary' };\n    }\n\n    const primaryScore = typeof primary.score === 'number' ? primary.score : 0;\n    const refinerScore = (typeof refiner.score === 'number' ? refiner.score : 0) + (definition.refinerBias ?? 0);\n    const primaryAccuracy = typeof primary.humanAccuracy === 'number' ? primary.humanAccuracy : 0;\n    const refinerAccuracy = typeof refiner.humanAccuracy === 'number' ? refiner.humanAccuracy : 0;\n\n    if (refinerScore > primaryScore) {\n      return { winner: refiner, winnerVariant: 'refiner' };\n    }\n    if (primaryScore > refinerScore) {\n      return { winner: primary, winnerVariant: 'primary' };\n    }\n\n    // Accuracy-aware tie break\n    if (refinerAccuracy > primaryAccuracy + 1e-6) {\n      return { winner: refiner, winnerVariant: 'refiner' };\n    }\n    if (primaryAccuracy > refinerAccuracy + 1e-6) {\n      return { winner: primary, winnerVariant: 'primary' };\n    }\n\n    // Tie breaker: prefer refiner to encourage RL exploration\n    return { winner: refiner, winnerVariant: 'refiner' };\n  }\n\n  private recordOutcomeArtifacts(\n    module: RepoUpgradeModule,\n    step: RepoUpgradeStep,\n    result: UpgradeStepResult,\n    variant: 'primary' | 'refiner'\n  ): void {\n    if (result.findings?.length) {\n      this.findings.push(...result.findings);\n    }\n\n    const execution: ExecutionResult = result.execution ?? {\n      success: result.success,\n      output: result.summary,\n      duration: result.durationMs ?? 0,\n      command: `${module.id}/${step.id}/${variant}`,\n      error: result.success ? undefined : result.detail ?? result.summary,\n    };\n\n    // Ensure we only track a single winner record per step to keep reports clean\n    this.results.push(execution);\n\n    // Update telemetry after each recorded outcome\n    const repoType = getRepoTypeFromModule(module);\n    this.updateRepoTypeTelemetry(repoType, variant);\n  }\n\n  private updateRepoTypeTelemetry(repoType: string, winner: UpgradeVariant): void {\n    updateRepoTypeTelemetryMap(repoType, winner);\n  }\n\n  private updateVariantStats(\n    stats: VariantWinStats,\n    outcome: UpgradeStepOutcome,\n    modeDefinition: RepoUpgradeModeDefinition\n  ): void {\n    stats.totalSteps += 1;\n    if (outcome.winnerVariant === 'refiner') {\n      stats.refinerWins += 1;\n    } else {\n      stats.primaryWins += 1;\n    }\n\n    if (!outcome.refiner) {\n      return;\n    }\n\n    const primaryScore = typeof outcome.primary.score === 'number' ? outcome.primary.score : 0;\n    const primaryTournamentScore =\n      typeof outcome.primary.tournament?.aggregateScore === 'number'\n        ? outcome.primary.tournament.aggregateScore\n        : primaryScore;\n    const refinerScoreRaw = typeof outcome.refiner.tournament?.aggregateScore === 'number'\n      ? outcome.refiner.tournament.aggregateScore\n      : typeof outcome.refiner.score === 'number'\n        ? outcome.refiner.score\n        : 0;\n    const refinerScore = refinerScoreRaw + (modeDefinition.refinerBias ?? 0);\n    const scoresClose = Math.abs(primaryTournamentScore - refinerScore) < 1e-6;\n    const bothSucceeded = outcome.primary.success && outcome.refiner.success;\n    if (bothSucceeded && scoresClose) {\n      stats.ties += 1;\n    }\n  }\n}\n\nfunction clampScore(value: number, min = 0, max = 1): number {\n  if (!Number.isFinite(value)) return min;\n  return Math.max(min, Math.min(max, value));\n}\n\nfunction averageDefined(values: Array<number | undefined>): number {\n  const nums = values.filter((v): v is number => typeof v === 'number');\n  if (!nums.length) return NaN;\n  const total = nums.reduce((sum, val) => sum + val, 0);\n  return total / nums.length;\n}\n\nfunction buildEvaluatorConfig(module: RepoUpgradeModule): {\n  rewardWeights: import('./dualTournament.js').HumanRewardWeights;\n  evaluators: Array<{\n    id: string;\n    label: string;\n    weight: number;\n    kind: 'hard' | 'soft' | 'hybrid';\n    elo?: number;\n  }>;\n} {\n  const repoType = getRepoTypeFromModule(module);\n\n  // Default: balanced weights\n  let rewardWeights = DEFAULT_HUMAN_REWARD_WEIGHTS;\n  let hardWeight = 1.35;\n  let qualityWeight = 1.0;\n  let rewardWeight = 0.9;\n\n  if (repoType === 'tests') {\n    rewardWeights = { alpha: 0.7, beta: 0.15, gamma: 0.15 };\n    hardWeight = 1.55;\n    qualityWeight = 0.9;\n    rewardWeight = 0.85;\n  } else if (repoType === 'docs') {\n    rewardWeights = { alpha: 0.45, beta: 0.3, gamma: 0.25 };\n    hardWeight = 1.0;\n    qualityWeight = 1.2;\n    rewardWeight = 1.0;\n  } else if (repoType === 'refactor') {\n    rewardWeights = { alpha: 0.55, beta: 0.25, gamma: 0.2 };\n    hardWeight = 1.25;\n    qualityWeight = 1.15;\n    rewardWeight = 0.95;\n  }\n\n  // Telemetry-based nudges per repo type\n  const telemetry = RepoUpgradeOrchestrator.repoTypeTelemetry.get(repoType);\n    if (telemetry) {\n      const total = Math.max(1, telemetry.winsPrimary + telemetry.winsRefiner);\n      const bias = (telemetry.winsPrimary - telemetry.winsRefiner) / total;\n      if (bias > 0.1) {\n        hardWeight = clampScore(hardWeight + 0.1, 0.8, 2);\n        rewardWeights = {\n          alpha: clampScore((rewardWeights.alpha ?? 0.6) + 0.05, 0, 1),\n          beta: rewardWeights.beta,\n          gamma: clampScore((rewardWeights.gamma ?? 0.2) - 0.02, 0, 1),\n        };\n      } else if (bias < -0.1) {\n        qualityWeight = clampScore(qualityWeight + 0.1, 0.8, 2);\n        rewardWeight = clampScore(rewardWeight + 0.05, 0.5, 1.5);\n        rewardWeights = {\n          alpha: clampScore((rewardWeights.alpha ?? 0.6) - 0.05, 0, 1),\n          beta: clampScore((rewardWeights.beta ?? 0.25) + 0.05, 0, 1),\n          gamma: clampScore((rewardWeights.gamma ?? 0.2) + 0.02, 0, 1),\n        };\n      }\n    }\n\n  return {\n    rewardWeights,\n    evaluators: [\n      { id: 'hard-metrics', label: 'Hard metrics', weight: hardWeight, kind: 'hard' },\n      { id: 'quality', label: 'Quality', weight: qualityWeight, kind: 'hybrid' },\n      { id: 'reward-signal', label: 'Reward signal', weight: rewardWeight, kind: 'hybrid' },\n    ],\n  };\n}\n\nfunction getRepoTypeFromModule(module: RepoUpgradeModule): string {\n  const scope = (module.scope || []).join(' ').toLowerCase();\n  const label = (module.label || '').toLowerCase();\n  if (/\\btest|__tests__|spec\\b/i.test(scope) || /\\btest\\b/i.test(label)) return 'tests';\n  if (/\\bdocs?\\b/i.test(scope) || /\\bdoc\\b/i.test(label)) return 'docs';\n  if (/\\brefactor|cleanup|source\\b/i.test(scope + ' ' + label)) return 'refactor';\n  return 'general';\n}\n\nfunction getRepoTypeFromOutcomeMetadata(task: TournamentTask): string {\n  const scopeText = Array.isArray(task.constraints) ? task.constraints.join(' ').toLowerCase() : '';\n  const intent = typeof task.metadata?.intent === 'string' ? task.metadata.intent.toLowerCase() : '';\n  if (/\\btest|__tests__|spec\\b/i.test(scopeText) || /\\btest\\b/i.test(intent)) return 'tests';\n  if (/\\bdoc\\b/i.test(scopeText) || /\\bdoc\\b/i.test(intent)) return 'docs';\n  if (/\\brefactor|cleanup\\b/i.test(scopeText + ' ' + intent)) return 'refactor';\n  return 'general';\n}\n\nfunction updateRepoTypeTelemetryMap(repoType: string, winner: UpgradeVariant): void {\n  if (RepoUpgradeOrchestrator.disableTelemetryPersistence) {\n    return;\n  }\n  ensureTelemetryLoaded();\n  const current = RepoUpgradeOrchestrator.repoTypeTelemetry.get(repoType) ?? { winsPrimary: 0, winsRefiner: 0 };\n  const updated =\n    winner === 'primary'\n      ? { ...current, winsPrimary: current.winsPrimary + 1 }\n      : { ...current, winsRefiner: current.winsRefiner + 1 };\n  RepoUpgradeOrchestrator.repoTypeTelemetry.set(repoType, updated);\n  persistTelemetry();\n}\n\n// Simple persistence of repo-type telemetry to inform future runs\nconst TELEMETRY_DIR = join(homedir(), '.agi');\nconst TELEMETRY_FILE = join(TELEMETRY_DIR, 'rl-telemetry.json');\nlet telemetryLoaded = false;\n\nfunction ensureTelemetryLoaded(): void {\n  if (RepoUpgradeOrchestrator.disableTelemetryPersistence) return;\n  if (telemetryLoaded) return;\n  telemetryLoaded = true;\n  try {\n    if (!existsSync(TELEMETRY_FILE)) return;\n    const data = JSON.parse(readFileSync(TELEMETRY_FILE, 'utf-8'));\n    if (data && typeof data === 'object') {\n      for (const [key, value] of Object.entries(data)) {\n        if (value && typeof value === 'object' && 'winsPrimary' in value && 'winsRefiner' in value) {\n          RepoUpgradeOrchestrator.repoTypeTelemetry.set(key, {\n            winsPrimary: Number((value as any).winsPrimary) || 0,\n            winsRefiner: Number((value as any).winsRefiner) || 0,\n          });\n        }\n      }\n    }\n  } catch {\n    // ignore load errors\n  }\n}\n\nfunction persistTelemetry(): void {\n  if (RepoUpgradeOrchestrator.disableTelemetryPersistence) return;\n  try {\n    mkdirSync(TELEMETRY_DIR, { recursive: true });\n    const payload: Record<string, { winsPrimary: number; winsRefiner: number }> = {};\n    for (const [key, value] of RepoUpgradeOrchestrator.repoTypeTelemetry.entries()) {\n      payload[key] = value;\n    }\n    writeFileSync(TELEMETRY_FILE, JSON.stringify(payload, null, 2), 'utf-8');\n  } catch {\n    // ignore persistence errors\n  }\n}\n\nfunction buildDefaultSteps(moduleId: string): RepoUpgradeStep[] {\n  return [\n    {\n      id: `${moduleId}-analyze`,\n      intent: 'analyze',\n      description: `Map the upgrade surface for ${moduleId}. Identify risky files and coupling.`,\n      prompt: 'Inventory files, dependencies, and breaking-change areas before upgrading.',\n    },\n    {\n      id: `${moduleId}-upgrade`,\n      intent: 'upgrade',\n      description: `Apply modular upgrades for ${moduleId} with minimal blast radius.`,\n      prompt: 'Execute codemods or targeted edits. Keep edits small, atomic, and well scoped.',\n    },\n    {\n      id: `${moduleId}-verify`,\n      intent: 'verify',\n      description: `Validate ${moduleId} after the upgrade.`,\n      prompt: 'Run tests/lint/health checks relevant to this scope. Summarize residual risks.',\n    },\n  ];\n}\n\nfunction getModeDefinition(mode: RepoUpgradeMode): RepoUpgradeModeDefinition {\n  return REPO_UPGRADE_MODE_DEFINITIONS[mode] ?? REPO_UPGRADE_MODE_DEFINITIONS['single-continuous'];\n}\n"],"mappings":"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","ignoreList":[]}