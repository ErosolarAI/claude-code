e4b613062ac2d49ff745756ff37e44a2
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createWebTools = createWebTools;
var _secretStore = require("../core/secretStore.js");
var _errors = require("../core/errors.js");
/**
 * Web Tools - Web search and content extraction capabilities
 *
 * Provides:
 * - WebSearch: Search the web using Tavily, Brave, or SerpAPI
 * - WebExtract: Extract and summarize content from URLs
 */

/**
 * Create web tools for search and extraction.
 */
function createWebTools() {
  return [{
    name: 'WebSearch',
    description: 'Search the web for information. Returns relevant results from search engines. Requires TAVILY_API_KEY, BRAVE_SEARCH_API_KEY, or SERPAPI_API_KEY.',
    parameters: {
      type: 'object',
      properties: {
        query: {
          type: 'string',
          description: 'The search query'
        },
        maxResults: {
          type: 'number',
          description: 'Maximum number of results to return (default: 5, max: 10)'
        },
        searchDepth: {
          type: 'string',
          enum: ['basic', 'advanced'],
          description: 'Search depth for Tavily: basic (fast) or advanced (thorough). Default: basic'
        },
        includeAnswer: {
          type: 'boolean',
          description: 'For Tavily: include AI-generated answer summary. Default: true'
        }
      },
      required: ['query'],
      additionalProperties: false
    },
    handler: async args => {
      const query = args['query'];
      if (typeof query !== 'string' || !query.trim()) {
        return 'Error: query is required';
      }
      const maxResults = Math.min(typeof args['maxResults'] === 'number' ? args['maxResults'] : 5, 10);
      const searchDepth = args['searchDepth'] === 'advanced' ? 'advanced' : 'basic';
      const includeAnswer = args['includeAnswer'] !== false;
      try {
        // Try providers in order of preference
        const tavilyKey = (0, _secretStore.getSecretValue)('TAVILY_API_KEY');
        if (tavilyKey) {
          return await searchTavily(query, tavilyKey, {
            maxResults,
            searchDepth,
            includeAnswer
          });
        }
        const braveKey = (0, _secretStore.getSecretValue)('BRAVE_SEARCH_API_KEY');
        if (braveKey) {
          return await searchBrave(query, braveKey, {
            maxResults
          });
        }
        const serpKey = (0, _secretStore.getSecretValue)('SERPAPI_API_KEY');
        if (serpKey) {
          return await searchSerpAPI(query, serpKey, {
            maxResults
          });
        }
        return 'WebSearch requires either TAVILY_API_KEY (recommended), BRAVE_SEARCH_API_KEY, or SERPAPI_API_KEY to be configured. Use /secrets set to configure.';
      } catch (error) {
        return (0, _errors.buildError)('WebSearch', error, {
          query
        });
      }
    }
  }, {
    name: 'WebExtract',
    description: 'Extract and summarize content from one or more URLs. Uses Tavily for high-quality extraction. Requires TAVILY_API_KEY.',
    parameters: {
      type: 'object',
      properties: {
        urls: {
          type: 'array',
          items: {
            type: 'string'
          },
          description: 'URLs to extract content from (max 5)'
        },
        url: {
          type: 'string',
          description: 'Single URL to extract content from (alternative to urls array)'
        }
      },
      additionalProperties: false
    },
    handler: async args => {
      let urls = [];
      if (Array.isArray(args['urls'])) {
        urls = args['urls'].filter(u => typeof u === 'string');
      } else if (typeof args['url'] === 'string') {
        urls = [args['url']];
      }
      if (urls.length === 0) {
        return 'Error: at least one URL is required';
      }

      // Limit to 5 URLs
      urls = urls.slice(0, 5);
      const tavilyKey = (0, _secretStore.getSecretValue)('TAVILY_API_KEY');
      if (!tavilyKey) {
        return 'WebExtract requires TAVILY_API_KEY to be configured. Use /secrets set TAVILY_API_KEY to configure.';
      }
      try {
        return await extractTavily(urls, tavilyKey);
      } catch (error) {
        return (0, _errors.buildError)('WebExtract', error, {
          urls: urls.join(', ')
        });
      }
    }
  }];
}

/**
 * Search using Tavily API (recommended provider)
 */
async function searchTavily(query, apiKey, options) {
  const controller = new AbortController();
  const timeout = setTimeout(() => controller.abort(), 30000); // 30 second timeout

  try {
    const response = await fetch('https://api.tavily.com/search', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        api_key: apiKey,
        query,
        search_depth: options.searchDepth,
        include_answer: options.includeAnswer,
        max_results: options.maxResults
      }),
      signal: controller.signal
    });
    if (!response.ok) {
      const text = await response.text();
      throw new Error(`Tavily API error: ${response.status} ${text}`);
    }
    const data = await response.json();
    return formatTavilyResults(data, 'Tavily');
  } catch (error) {
    if (error instanceof Error && error.name === 'AbortError') {
      throw new Error('Tavily search timed out after 30 seconds');
    }
    throw error;
  } finally {
    clearTimeout(timeout);
  }
}

/**
 * Search using Brave Search API
 */
async function searchBrave(query, apiKey, options) {
  const params = new URLSearchParams({
    q: query,
    count: String(options.maxResults)
  });
  const controller = new AbortController();
  const timeout = setTimeout(() => controller.abort(), 30000); // 30 second timeout

  try {
    const response = await fetch(`https://api.search.brave.com/res/v1/web/search?${params}`, {
      headers: {
        'Accept': 'application/json',
        'X-Subscription-Token': apiKey
      },
      signal: controller.signal
    });
    if (!response.ok) {
      const text = await response.text();
      throw new Error(`Brave Search API error: ${response.status} ${text}`);
    }
    const data = await response.json();
    return formatBraveResults(data, 'Brave Search');
  } catch (error) {
    if (error instanceof Error && error.name === 'AbortError') {
      throw new Error('Brave search timed out after 30 seconds');
    }
    throw error;
  } finally {
    clearTimeout(timeout);
  }
}

/**
 * Search using SerpAPI
 */
async function searchSerpAPI(query, apiKey, options) {
  const params = new URLSearchParams({
    q: query,
    api_key: apiKey,
    engine: 'google',
    num: String(options.maxResults)
  });
  const controller = new AbortController();
  const timeout = setTimeout(() => controller.abort(), 30000); // 30 second timeout

  try {
    const response = await fetch(`https://serpapi.com/search?${params}`, {
      signal: controller.signal
    });
    if (!response.ok) {
      const text = await response.text();
      throw new Error(`SerpAPI error: ${response.status} ${text}`);
    }
    const data = await response.json();
    return formatSerpAPIResults(data, 'SerpAPI');
  } catch (error) {
    if (error instanceof Error && error.name === 'AbortError') {
      throw new Error('SerpAPI search timed out after 30 seconds');
    }
    throw error;
  } finally {
    clearTimeout(timeout);
  }
}

/**
 * Extract content using Tavily Extract API
 */
async function extractTavily(urls, apiKey) {
  const response = await fetch('https://api.tavily.com/extract', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      api_key: apiKey,
      urls
    })
  });
  if (!response.ok) {
    const text = await response.text();
    throw new Error(`Tavily Extract API error: ${response.status} ${text}`);
  }
  const data = await response.json();
  return formatExtractResults(data);
}

/**
 * Format Tavily search results
 */
function formatTavilyResults(data, provider) {
  const lines = [`[WebSearch via ${provider}]`, ''];
  if (data.answer) {
    lines.push('Summary:', data.answer, '');
  }
  if (!data.results || data.results.length === 0) {
    lines.push('No results found.');
    return lines.join('\n');
  }
  lines.push(`Results for "${data.query}":`);
  lines.push('');
  for (const result of data.results) {
    lines.push(`**${result.title}**`);
    lines.push(result.url);
    if (result.content) {
      const snippet = result.content.length > 300 ? result.content.slice(0, 300) + '...' : result.content;
      lines.push(snippet);
    }
    if (result.published_date) {
      lines.push(`Published: ${result.published_date}`);
    }
    lines.push('');
  }
  return lines.join('\n');
}

/**
 * Format Brave search results
 */
function formatBraveResults(data, provider) {
  const lines = [`[WebSearch via ${provider}]`, ''];
  const results = data.web?.results || [];
  if (results.length === 0) {
    lines.push('No results found.');
    return lines.join('\n');
  }
  for (const result of results) {
    lines.push(`**${result.title}**`);
    lines.push(result.url);
    if (result.description) {
      lines.push(result.description);
    }
    if (result.profile?.name) {
      lines.push(`Source: ${result.profile.name}`);
    }
    if (result.publishedDate) {
      lines.push(`Published: ${result.publishedDate}`);
    }
    lines.push('');
  }
  return lines.join('\n');
}

/**
 * Format SerpAPI results
 */
function formatSerpAPIResults(data, provider) {
  const lines = [`[WebSearch via ${provider}]`, ''];
  const results = data.organic_results || [];
  if (results.length === 0) {
    lines.push('No results found.');
    return lines.join('\n');
  }
  for (const result of results) {
    lines.push(`**${result.title}**`);
    lines.push(result.link);
    if (result.snippet) {
      lines.push(result.snippet);
    }
    if (result.source) {
      lines.push(`Source: ${result.source}`);
    }
    if (result.date) {
      lines.push(`Date: ${result.date}`);
    }
    lines.push('');
  }
  return lines.join('\n');
}

/**
 * Format Tavily extract results
 */
function formatExtractResults(data) {
  const lines = ['[WebExtract via Tavily]', ''];
  if (!data.results || data.results.length === 0) {
    lines.push('No content extracted.');
    return lines.join('\n');
  }
  for (const result of data.results) {
    lines.push(`**${result.url}**`);
    lines.push('');
    if (result.raw_content) {
      // Truncate very long content
      const content = result.raw_content.length > 5000 ? result.raw_content.slice(0, 5000) + '\n\n[Content truncated...]' : result.raw_content;
      lines.push(content);
    }
    lines.push('');
    lines.push('---');
    lines.push('');
  }
  return lines.join('\n');
}

// Export types for testing
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfc2VjcmV0U3RvcmUiLCJyZXF1aXJlIiwiX2Vycm9ycyIsImNyZWF0ZVdlYlRvb2xzIiwibmFtZSIsImRlc2NyaXB0aW9uIiwicGFyYW1ldGVycyIsInR5cGUiLCJwcm9wZXJ0aWVzIiwicXVlcnkiLCJtYXhSZXN1bHRzIiwic2VhcmNoRGVwdGgiLCJlbnVtIiwiaW5jbHVkZUFuc3dlciIsInJlcXVpcmVkIiwiYWRkaXRpb25hbFByb3BlcnRpZXMiLCJoYW5kbGVyIiwiYXJncyIsInRyaW0iLCJNYXRoIiwibWluIiwidGF2aWx5S2V5IiwiZ2V0U2VjcmV0VmFsdWUiLCJzZWFyY2hUYXZpbHkiLCJicmF2ZUtleSIsInNlYXJjaEJyYXZlIiwic2VycEtleSIsInNlYXJjaFNlcnBBUEkiLCJlcnJvciIsImJ1aWxkRXJyb3IiLCJ1cmxzIiwiaXRlbXMiLCJ1cmwiLCJBcnJheSIsImlzQXJyYXkiLCJmaWx0ZXIiLCJ1IiwibGVuZ3RoIiwic2xpY2UiLCJleHRyYWN0VGF2aWx5Iiwiam9pbiIsImFwaUtleSIsIm9wdGlvbnMiLCJjb250cm9sbGVyIiwiQWJvcnRDb250cm9sbGVyIiwidGltZW91dCIsInNldFRpbWVvdXQiLCJhYm9ydCIsInJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhcGlfa2V5Iiwic2VhcmNoX2RlcHRoIiwiaW5jbHVkZV9hbnN3ZXIiLCJtYXhfcmVzdWx0cyIsInNpZ25hbCIsIm9rIiwidGV4dCIsIkVycm9yIiwic3RhdHVzIiwiZGF0YSIsImpzb24iLCJmb3JtYXRUYXZpbHlSZXN1bHRzIiwiY2xlYXJUaW1lb3V0IiwicGFyYW1zIiwiVVJMU2VhcmNoUGFyYW1zIiwicSIsImNvdW50IiwiU3RyaW5nIiwiZm9ybWF0QnJhdmVSZXN1bHRzIiwiZW5naW5lIiwibnVtIiwiZm9ybWF0U2VycEFQSVJlc3VsdHMiLCJmb3JtYXRFeHRyYWN0UmVzdWx0cyIsInByb3ZpZGVyIiwibGluZXMiLCJhbnN3ZXIiLCJwdXNoIiwicmVzdWx0cyIsInJlc3VsdCIsInRpdGxlIiwiY29udGVudCIsInNuaXBwZXQiLCJwdWJsaXNoZWRfZGF0ZSIsIndlYiIsInByb2ZpbGUiLCJwdWJsaXNoZWREYXRlIiwib3JnYW5pY19yZXN1bHRzIiwibGluayIsInNvdXJjZSIsImRhdGUiLCJyYXdfY29udGVudCJdLCJzb3VyY2VzIjpbIndlYlRvb2xzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV2ViIFRvb2xzIC0gV2ViIHNlYXJjaCBhbmQgY29udGVudCBleHRyYWN0aW9uIGNhcGFiaWxpdGllc1xuICpcbiAqIFByb3ZpZGVzOlxuICogLSBXZWJTZWFyY2g6IFNlYXJjaCB0aGUgd2ViIHVzaW5nIFRhdmlseSwgQnJhdmUsIG9yIFNlcnBBUElcbiAqIC0gV2ViRXh0cmFjdDogRXh0cmFjdCBhbmQgc3VtbWFyaXplIGNvbnRlbnQgZnJvbSBVUkxzXG4gKi9cblxuaW1wb3J0IHR5cGUgeyBUb29sRGVmaW5pdGlvbiB9IGZyb20gJy4uL2NvcmUvdG9vbFJ1bnRpbWUuanMnO1xuaW1wb3J0IHsgZ2V0U2VjcmV0VmFsdWUgfSBmcm9tICcuLi9jb3JlL3NlY3JldFN0b3JlLmpzJztcbmltcG9ydCB7IGJ1aWxkRXJyb3IgfSBmcm9tICcuLi9jb3JlL2Vycm9ycy5qcyc7XG5cbmludGVyZmFjZSBUYXZpbHlTZWFyY2hSZXN1bHQge1xuICB0aXRsZTogc3RyaW5nO1xuICB1cmw6IHN0cmluZztcbiAgY29udGVudDogc3RyaW5nO1xuICBzY29yZT86IG51bWJlcjtcbiAgcHVibGlzaGVkX2RhdGU/OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBUYXZpbHlTZWFyY2hSZXNwb25zZSB7XG4gIHJlc3VsdHM6IFRhdmlseVNlYXJjaFJlc3VsdFtdO1xuICBhbnN3ZXI/OiBzdHJpbmc7XG4gIHF1ZXJ5OiBzdHJpbmc7XG59XG5cbmludGVyZmFjZSBUYXZpbHlFeHRyYWN0UmVzcG9uc2Uge1xuICByZXN1bHRzOiBBcnJheTx7XG4gICAgdXJsOiBzdHJpbmc7XG4gICAgcmF3X2NvbnRlbnQ6IHN0cmluZztcbiAgfT47XG59XG5cbmludGVyZmFjZSBCcmF2ZVNlYXJjaFJlc3VsdCB7XG4gIHRpdGxlOiBzdHJpbmc7XG4gIHVybDogc3RyaW5nO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBwcm9maWxlPzogeyBuYW1lOiBzdHJpbmcgfTtcbiAgcHVibGlzaGVkRGF0ZT86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIEJyYXZlU2VhcmNoUmVzcG9uc2Uge1xuICB3ZWI/OiB7XG4gICAgcmVzdWx0czogQnJhdmVTZWFyY2hSZXN1bHRbXTtcbiAgfTtcbn1cblxuaW50ZXJmYWNlIFNlcnBBUElSZXN1bHQge1xuICB0aXRsZTogc3RyaW5nO1xuICBsaW5rOiBzdHJpbmc7XG4gIHNuaXBwZXQ6IHN0cmluZztcbiAgc291cmNlPzogc3RyaW5nO1xuICBkYXRlPzogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgU2VycEFQSVJlc3BvbnNlIHtcbiAgb3JnYW5pY19yZXN1bHRzPzogU2VycEFQSVJlc3VsdFtdO1xufVxuXG50eXBlIFNlYXJjaFByb3ZpZGVyID0gJ3RhdmlseScgfCAnYnJhdmUnIHwgJ3NlcnBhcGknO1xuXG4vKipcbiAqIENyZWF0ZSB3ZWIgdG9vbHMgZm9yIHNlYXJjaCBhbmQgZXh0cmFjdGlvbi5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVdlYlRvb2xzKCk6IFRvb2xEZWZpbml0aW9uW10ge1xuICByZXR1cm4gW1xuICAgIHtcbiAgICAgIG5hbWU6ICdXZWJTZWFyY2gnLFxuICAgICAgZGVzY3JpcHRpb246ICdTZWFyY2ggdGhlIHdlYiBmb3IgaW5mb3JtYXRpb24uIFJldHVybnMgcmVsZXZhbnQgcmVzdWx0cyBmcm9tIHNlYXJjaCBlbmdpbmVzLiBSZXF1aXJlcyBUQVZJTFlfQVBJX0tFWSwgQlJBVkVfU0VBUkNIX0FQSV9LRVksIG9yIFNFUlBBUElfQVBJX0tFWS4nLFxuICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgIHF1ZXJ5OiB7XG4gICAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVGhlIHNlYXJjaCBxdWVyeScsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBtYXhSZXN1bHRzOiB7XG4gICAgICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnTWF4aW11bSBudW1iZXIgb2YgcmVzdWx0cyB0byByZXR1cm4gKGRlZmF1bHQ6IDUsIG1heDogMTApJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNlYXJjaERlcHRoOiB7XG4gICAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgIGVudW06IFsnYmFzaWMnLCAnYWR2YW5jZWQnXSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnU2VhcmNoIGRlcHRoIGZvciBUYXZpbHk6IGJhc2ljIChmYXN0KSBvciBhZHZhbmNlZCAodGhvcm91Z2gpLiBEZWZhdWx0OiBiYXNpYycsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBpbmNsdWRlQW5zd2VyOiB7XG4gICAgICAgICAgICB0eXBlOiAnYm9vbGVhbicsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0ZvciBUYXZpbHk6IGluY2x1ZGUgQUktZ2VuZXJhdGVkIGFuc3dlciBzdW1tYXJ5LiBEZWZhdWx0OiB0cnVlJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICByZXF1aXJlZDogWydxdWVyeSddLFxuICAgICAgICBhZGRpdGlvbmFsUHJvcGVydGllczogZmFsc2UsXG4gICAgICB9LFxuICAgICAgaGFuZGxlcjogYXN5bmMgKGFyZ3MpID0+IHtcbiAgICAgICAgY29uc3QgcXVlcnkgPSBhcmdzWydxdWVyeSddO1xuICAgICAgICBpZiAodHlwZW9mIHF1ZXJ5ICE9PSAnc3RyaW5nJyB8fCAhcXVlcnkudHJpbSgpKSB7XG4gICAgICAgICAgcmV0dXJuICdFcnJvcjogcXVlcnkgaXMgcmVxdWlyZWQnO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbWF4UmVzdWx0cyA9IE1hdGgubWluKFxuICAgICAgICAgIHR5cGVvZiBhcmdzWydtYXhSZXN1bHRzJ10gPT09ICdudW1iZXInID8gYXJnc1snbWF4UmVzdWx0cyddIDogNSxcbiAgICAgICAgICAxMFxuICAgICAgICApO1xuICAgICAgICBjb25zdCBzZWFyY2hEZXB0aCA9IGFyZ3NbJ3NlYXJjaERlcHRoJ10gPT09ICdhZHZhbmNlZCcgPyAnYWR2YW5jZWQnIDogJ2Jhc2ljJztcbiAgICAgICAgY29uc3QgaW5jbHVkZUFuc3dlciA9IGFyZ3NbJ2luY2x1ZGVBbnN3ZXInXSAhPT0gZmFsc2U7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBUcnkgcHJvdmlkZXJzIGluIG9yZGVyIG9mIHByZWZlcmVuY2VcbiAgICAgICAgICBjb25zdCB0YXZpbHlLZXkgPSBnZXRTZWNyZXRWYWx1ZSgnVEFWSUxZX0FQSV9LRVknKTtcbiAgICAgICAgICBpZiAodGF2aWx5S2V5KSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgc2VhcmNoVGF2aWx5KHF1ZXJ5LCB0YXZpbHlLZXksIHsgbWF4UmVzdWx0cywgc2VhcmNoRGVwdGgsIGluY2x1ZGVBbnN3ZXIgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgYnJhdmVLZXkgPSBnZXRTZWNyZXRWYWx1ZSgnQlJBVkVfU0VBUkNIX0FQSV9LRVknKTtcbiAgICAgICAgICBpZiAoYnJhdmVLZXkpIHtcbiAgICAgICAgICAgIHJldHVybiBhd2FpdCBzZWFyY2hCcmF2ZShxdWVyeSwgYnJhdmVLZXksIHsgbWF4UmVzdWx0cyB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCBzZXJwS2V5ID0gZ2V0U2VjcmV0VmFsdWUoJ1NFUlBBUElfQVBJX0tFWScpO1xuICAgICAgICAgIGlmIChzZXJwS2V5KSB7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgc2VhcmNoU2VycEFQSShxdWVyeSwgc2VycEtleSwgeyBtYXhSZXN1bHRzIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiAnV2ViU2VhcmNoIHJlcXVpcmVzIGVpdGhlciBUQVZJTFlfQVBJX0tFWSAocmVjb21tZW5kZWQpLCBCUkFWRV9TRUFSQ0hfQVBJX0tFWSwgb3IgU0VSUEFQSV9BUElfS0VZIHRvIGJlIGNvbmZpZ3VyZWQuIFVzZSAvc2VjcmV0cyBzZXQgdG8gY29uZmlndXJlLic7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgcmV0dXJuIGJ1aWxkRXJyb3IoJ1dlYlNlYXJjaCcsIGVycm9yLCB7IHF1ZXJ5IH0pO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogJ1dlYkV4dHJhY3QnLFxuICAgICAgZGVzY3JpcHRpb246ICdFeHRyYWN0IGFuZCBzdW1tYXJpemUgY29udGVudCBmcm9tIG9uZSBvciBtb3JlIFVSTHMuIFVzZXMgVGF2aWx5IGZvciBoaWdoLXF1YWxpdHkgZXh0cmFjdGlvbi4gUmVxdWlyZXMgVEFWSUxZX0FQSV9LRVkuJyxcbiAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICB1cmxzOiB7XG4gICAgICAgICAgICB0eXBlOiAnYXJyYXknLFxuICAgICAgICAgICAgaXRlbXM6IHsgdHlwZTogJ3N0cmluZycgfSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVVJMcyB0byBleHRyYWN0IGNvbnRlbnQgZnJvbSAobWF4IDUpJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHVybDoge1xuICAgICAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1NpbmdsZSBVUkwgdG8gZXh0cmFjdCBjb250ZW50IGZyb20gKGFsdGVybmF0aXZlIHRvIHVybHMgYXJyYXkpJyxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBhZGRpdGlvbmFsUHJvcGVydGllczogZmFsc2UsXG4gICAgICB9LFxuICAgICAgaGFuZGxlcjogYXN5bmMgKGFyZ3MpID0+IHtcbiAgICAgICAgbGV0IHVybHM6IHN0cmluZ1tdID0gW107XG5cbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoYXJnc1sndXJscyddKSkge1xuICAgICAgICAgIHVybHMgPSBhcmdzWyd1cmxzJ10uZmlsdGVyKCh1KTogdSBpcyBzdHJpbmcgPT4gdHlwZW9mIHUgPT09ICdzdHJpbmcnKTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgYXJnc1sndXJsJ10gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgdXJscyA9IFthcmdzWyd1cmwnXV07XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodXJscy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICByZXR1cm4gJ0Vycm9yOiBhdCBsZWFzdCBvbmUgVVJMIGlzIHJlcXVpcmVkJztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIExpbWl0IHRvIDUgVVJMc1xuICAgICAgICB1cmxzID0gdXJscy5zbGljZSgwLCA1KTtcblxuICAgICAgICBjb25zdCB0YXZpbHlLZXkgPSBnZXRTZWNyZXRWYWx1ZSgnVEFWSUxZX0FQSV9LRVknKTtcbiAgICAgICAgaWYgKCF0YXZpbHlLZXkpIHtcbiAgICAgICAgICByZXR1cm4gJ1dlYkV4dHJhY3QgcmVxdWlyZXMgVEFWSUxZX0FQSV9LRVkgdG8gYmUgY29uZmlndXJlZC4gVXNlIC9zZWNyZXRzIHNldCBUQVZJTFlfQVBJX0tFWSB0byBjb25maWd1cmUuJztcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmV0dXJuIGF3YWl0IGV4dHJhY3RUYXZpbHkodXJscywgdGF2aWx5S2V5KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICByZXR1cm4gYnVpbGRFcnJvcignV2ViRXh0cmFjdCcsIGVycm9yLCB7IHVybHM6IHVybHMuam9pbignLCAnKSB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9LFxuICBdO1xufVxuXG4vKipcbiAqIFNlYXJjaCB1c2luZyBUYXZpbHkgQVBJIChyZWNvbW1lbmRlZCBwcm92aWRlcilcbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2VhcmNoVGF2aWx5KFxuICBxdWVyeTogc3RyaW5nLFxuICBhcGlLZXk6IHN0cmluZyxcbiAgb3B0aW9uczogeyBtYXhSZXN1bHRzOiBudW1iZXI7IHNlYXJjaERlcHRoOiBzdHJpbmc7IGluY2x1ZGVBbnN3ZXI6IGJvb2xlYW4gfVxuKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgY29uc3QgY29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcbiAgY29uc3QgdGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gY29udHJvbGxlci5hYm9ydCgpLCAzMDAwMCk7IC8vIDMwIHNlY29uZCB0aW1lb3V0XG5cbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCdodHRwczovL2FwaS50YXZpbHkuY29tL3NlYXJjaCcsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgYXBpX2tleTogYXBpS2V5LFxuICAgICAgICBxdWVyeSxcbiAgICAgICAgc2VhcmNoX2RlcHRoOiBvcHRpb25zLnNlYXJjaERlcHRoLFxuICAgICAgICBpbmNsdWRlX2Fuc3dlcjogb3B0aW9ucy5pbmNsdWRlQW5zd2VyLFxuICAgICAgICBtYXhfcmVzdWx0czogb3B0aW9ucy5tYXhSZXN1bHRzLFxuICAgICAgfSksXG4gICAgICBzaWduYWw6IGNvbnRyb2xsZXIuc2lnbmFsLFxuICAgIH0pO1xuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRhdmlseSBBUEkgZXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfSAke3RleHR9YCk7XG4gICAgfVxuXG4gICAgY29uc3QgZGF0YSA9IChhd2FpdCByZXNwb25zZS5qc29uKCkpIGFzIFRhdmlseVNlYXJjaFJlc3BvbnNlO1xuICAgIHJldHVybiBmb3JtYXRUYXZpbHlSZXN1bHRzKGRhdGEsICdUYXZpbHknKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvciAmJiBlcnJvci5uYW1lID09PSAnQWJvcnRFcnJvcicpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVGF2aWx5IHNlYXJjaCB0aW1lZCBvdXQgYWZ0ZXIgMzAgc2Vjb25kcycpO1xuICAgIH1cbiAgICB0aHJvdyBlcnJvcjtcbiAgfSBmaW5hbGx5IHtcbiAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gIH1cbn1cblxuLyoqXG4gKiBTZWFyY2ggdXNpbmcgQnJhdmUgU2VhcmNoIEFQSVxuICovXG5hc3luYyBmdW5jdGlvbiBzZWFyY2hCcmF2ZShcbiAgcXVlcnk6IHN0cmluZyxcbiAgYXBpS2V5OiBzdHJpbmcsXG4gIG9wdGlvbnM6IHsgbWF4UmVzdWx0czogbnVtYmVyIH1cbik6IFByb21pc2U8c3RyaW5nPiB7XG4gIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoe1xuICAgIHE6IHF1ZXJ5LFxuICAgIGNvdW50OiBTdHJpbmcob3B0aW9ucy5tYXhSZXN1bHRzKSxcbiAgfSk7XG5cbiAgY29uc3QgY29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtcbiAgY29uc3QgdGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4gY29udHJvbGxlci5hYm9ydCgpLCAzMDAwMCk7IC8vIDMwIHNlY29uZCB0aW1lb3V0XG5cbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGBodHRwczovL2FwaS5zZWFyY2guYnJhdmUuY29tL3Jlcy92MS93ZWIvc2VhcmNoPyR7cGFyYW1zfWAsIHtcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgJ1gtU3Vic2NyaXB0aW9uLVRva2VuJzogYXBpS2V5LFxuICAgICAgfSxcbiAgICAgIHNpZ25hbDogY29udHJvbGxlci5zaWduYWwsXG4gICAgfSk7XG5cbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBCcmF2ZSBTZWFyY2ggQVBJIGVycm9yOiAke3Jlc3BvbnNlLnN0YXR1c30gJHt0ZXh0fWApO1xuICAgIH1cblxuICAgIGNvbnN0IGRhdGEgPSAoYXdhaXQgcmVzcG9uc2UuanNvbigpKSBhcyBCcmF2ZVNlYXJjaFJlc3BvbnNlO1xuICAgIHJldHVybiBmb3JtYXRCcmF2ZVJlc3VsdHMoZGF0YSwgJ0JyYXZlIFNlYXJjaCcpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIEVycm9yICYmIGVycm9yLm5hbWUgPT09ICdBYm9ydEVycm9yJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdCcmF2ZSBzZWFyY2ggdGltZWQgb3V0IGFmdGVyIDMwIHNlY29uZHMnKTtcbiAgICB9XG4gICAgdGhyb3cgZXJyb3I7XG4gIH0gZmluYWxseSB7XG4gICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICB9XG59XG5cbi8qKlxuICogU2VhcmNoIHVzaW5nIFNlcnBBUElcbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2VhcmNoU2VycEFQSShcbiAgcXVlcnk6IHN0cmluZyxcbiAgYXBpS2V5OiBzdHJpbmcsXG4gIG9wdGlvbnM6IHsgbWF4UmVzdWx0czogbnVtYmVyIH1cbik6IFByb21pc2U8c3RyaW5nPiB7XG4gIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoe1xuICAgIHE6IHF1ZXJ5LFxuICAgIGFwaV9rZXk6IGFwaUtleSxcbiAgICBlbmdpbmU6ICdnb29nbGUnLFxuICAgIG51bTogU3RyaW5nKG9wdGlvbnMubWF4UmVzdWx0cyksXG4gIH0pO1xuXG4gIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XG4gIGNvbnN0IHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IGNvbnRyb2xsZXIuYWJvcnQoKSwgMzAwMDApOyAvLyAzMCBzZWNvbmQgdGltZW91dFxuXG4gIHRyeSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgaHR0cHM6Ly9zZXJwYXBpLmNvbS9zZWFyY2g/JHtwYXJhbXN9YCwge1xuICAgICAgc2lnbmFsOiBjb250cm9sbGVyLnNpZ25hbCxcbiAgICB9KTtcblxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFNlcnBBUEkgZXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfSAke3RleHR9YCk7XG4gICAgfVxuXG4gICAgY29uc3QgZGF0YSA9IChhd2FpdCByZXNwb25zZS5qc29uKCkpIGFzIFNlcnBBUElSZXNwb25zZTtcbiAgICByZXR1cm4gZm9ybWF0U2VycEFQSVJlc3VsdHMoZGF0YSwgJ1NlcnBBUEknKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvciAmJiBlcnJvci5uYW1lID09PSAnQWJvcnRFcnJvcicpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignU2VycEFQSSBzZWFyY2ggdGltZWQgb3V0IGFmdGVyIDMwIHNlY29uZHMnKTtcbiAgICB9XG4gICAgdGhyb3cgZXJyb3I7XG4gIH0gZmluYWxseSB7XG4gICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICB9XG59XG5cbi8qKlxuICogRXh0cmFjdCBjb250ZW50IHVzaW5nIFRhdmlseSBFeHRyYWN0IEFQSVxuICovXG5hc3luYyBmdW5jdGlvbiBleHRyYWN0VGF2aWx5KHVybHM6IHN0cmluZ1tdLCBhcGlLZXk6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJ2h0dHBzOi8vYXBpLnRhdmlseS5jb20vZXh0cmFjdCcsIHtcbiAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICBoZWFkZXJzOiB7XG4gICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgIH0sXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgYXBpX2tleTogYXBpS2V5LFxuICAgICAgdXJscyxcbiAgICB9KSxcbiAgfSk7XG5cbiAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUYXZpbHkgRXh0cmFjdCBBUEkgZXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfSAke3RleHR9YCk7XG4gIH1cblxuICBjb25zdCBkYXRhID0gKGF3YWl0IHJlc3BvbnNlLmpzb24oKSkgYXMgVGF2aWx5RXh0cmFjdFJlc3BvbnNlO1xuICByZXR1cm4gZm9ybWF0RXh0cmFjdFJlc3VsdHMoZGF0YSk7XG59XG5cbi8qKlxuICogRm9ybWF0IFRhdmlseSBzZWFyY2ggcmVzdWx0c1xuICovXG5mdW5jdGlvbiBmb3JtYXRUYXZpbHlSZXN1bHRzKGRhdGE6IFRhdmlseVNlYXJjaFJlc3BvbnNlLCBwcm92aWRlcjogc3RyaW5nKTogc3RyaW5nIHtcbiAgY29uc3QgbGluZXM6IHN0cmluZ1tdID0gW2BbV2ViU2VhcmNoIHZpYSAke3Byb3ZpZGVyfV1gLCAnJ107XG5cbiAgaWYgKGRhdGEuYW5zd2VyKSB7XG4gICAgbGluZXMucHVzaCgnU3VtbWFyeTonLCBkYXRhLmFuc3dlciwgJycpO1xuICB9XG5cbiAgaWYgKCFkYXRhLnJlc3VsdHMgfHwgZGF0YS5yZXN1bHRzLmxlbmd0aCA9PT0gMCkge1xuICAgIGxpbmVzLnB1c2goJ05vIHJlc3VsdHMgZm91bmQuJyk7XG4gICAgcmV0dXJuIGxpbmVzLmpvaW4oJ1xcbicpO1xuICB9XG5cbiAgbGluZXMucHVzaChgUmVzdWx0cyBmb3IgXCIke2RhdGEucXVlcnl9XCI6YCk7XG4gIGxpbmVzLnB1c2goJycpO1xuXG4gIGZvciAoY29uc3QgcmVzdWx0IG9mIGRhdGEucmVzdWx0cykge1xuICAgIGxpbmVzLnB1c2goYCoqJHtyZXN1bHQudGl0bGV9KipgKTtcbiAgICBsaW5lcy5wdXNoKHJlc3VsdC51cmwpO1xuICAgIGlmIChyZXN1bHQuY29udGVudCkge1xuICAgICAgY29uc3Qgc25pcHBldCA9IHJlc3VsdC5jb250ZW50Lmxlbmd0aCA+IDMwMFxuICAgICAgICA/IHJlc3VsdC5jb250ZW50LnNsaWNlKDAsIDMwMCkgKyAnLi4uJ1xuICAgICAgICA6IHJlc3VsdC5jb250ZW50O1xuICAgICAgbGluZXMucHVzaChzbmlwcGV0KTtcbiAgICB9XG4gICAgaWYgKHJlc3VsdC5wdWJsaXNoZWRfZGF0ZSkge1xuICAgICAgbGluZXMucHVzaChgUHVibGlzaGVkOiAke3Jlc3VsdC5wdWJsaXNoZWRfZGF0ZX1gKTtcbiAgICB9XG4gICAgbGluZXMucHVzaCgnJyk7XG4gIH1cblxuICByZXR1cm4gbGluZXMuam9pbignXFxuJyk7XG59XG5cbi8qKlxuICogRm9ybWF0IEJyYXZlIHNlYXJjaCByZXN1bHRzXG4gKi9cbmZ1bmN0aW9uIGZvcm1hdEJyYXZlUmVzdWx0cyhkYXRhOiBCcmF2ZVNlYXJjaFJlc3BvbnNlLCBwcm92aWRlcjogc3RyaW5nKTogc3RyaW5nIHtcbiAgY29uc3QgbGluZXM6IHN0cmluZ1tdID0gW2BbV2ViU2VhcmNoIHZpYSAke3Byb3ZpZGVyfV1gLCAnJ107XG5cbiAgY29uc3QgcmVzdWx0cyA9IGRhdGEud2ViPy5yZXN1bHRzIHx8IFtdO1xuICBpZiAocmVzdWx0cy5sZW5ndGggPT09IDApIHtcbiAgICBsaW5lcy5wdXNoKCdObyByZXN1bHRzIGZvdW5kLicpO1xuICAgIHJldHVybiBsaW5lcy5qb2luKCdcXG4nKTtcbiAgfVxuXG4gIGZvciAoY29uc3QgcmVzdWx0IG9mIHJlc3VsdHMpIHtcbiAgICBsaW5lcy5wdXNoKGAqKiR7cmVzdWx0LnRpdGxlfSoqYCk7XG4gICAgbGluZXMucHVzaChyZXN1bHQudXJsKTtcbiAgICBpZiAocmVzdWx0LmRlc2NyaXB0aW9uKSB7XG4gICAgICBsaW5lcy5wdXNoKHJlc3VsdC5kZXNjcmlwdGlvbik7XG4gICAgfVxuICAgIGlmIChyZXN1bHQucHJvZmlsZT8ubmFtZSkge1xuICAgICAgbGluZXMucHVzaChgU291cmNlOiAke3Jlc3VsdC5wcm9maWxlLm5hbWV9YCk7XG4gICAgfVxuICAgIGlmIChyZXN1bHQucHVibGlzaGVkRGF0ZSkge1xuICAgICAgbGluZXMucHVzaChgUHVibGlzaGVkOiAke3Jlc3VsdC5wdWJsaXNoZWREYXRlfWApO1xuICAgIH1cbiAgICBsaW5lcy5wdXNoKCcnKTtcbiAgfVxuXG4gIHJldHVybiBsaW5lcy5qb2luKCdcXG4nKTtcbn1cblxuLyoqXG4gKiBGb3JtYXQgU2VycEFQSSByZXN1bHRzXG4gKi9cbmZ1bmN0aW9uIGZvcm1hdFNlcnBBUElSZXN1bHRzKGRhdGE6IFNlcnBBUElSZXNwb25zZSwgcHJvdmlkZXI6IHN0cmluZyk6IHN0cmluZyB7XG4gIGNvbnN0IGxpbmVzOiBzdHJpbmdbXSA9IFtgW1dlYlNlYXJjaCB2aWEgJHtwcm92aWRlcn1dYCwgJyddO1xuXG4gIGNvbnN0IHJlc3VsdHMgPSBkYXRhLm9yZ2FuaWNfcmVzdWx0cyB8fCBbXTtcbiAgaWYgKHJlc3VsdHMubGVuZ3RoID09PSAwKSB7XG4gICAgbGluZXMucHVzaCgnTm8gcmVzdWx0cyBmb3VuZC4nKTtcbiAgICByZXR1cm4gbGluZXMuam9pbignXFxuJyk7XG4gIH1cblxuICBmb3IgKGNvbnN0IHJlc3VsdCBvZiByZXN1bHRzKSB7XG4gICAgbGluZXMucHVzaChgKioke3Jlc3VsdC50aXRsZX0qKmApO1xuICAgIGxpbmVzLnB1c2gocmVzdWx0LmxpbmspO1xuICAgIGlmIChyZXN1bHQuc25pcHBldCkge1xuICAgICAgbGluZXMucHVzaChyZXN1bHQuc25pcHBldCk7XG4gICAgfVxuICAgIGlmIChyZXN1bHQuc291cmNlKSB7XG4gICAgICBsaW5lcy5wdXNoKGBTb3VyY2U6ICR7cmVzdWx0LnNvdXJjZX1gKTtcbiAgICB9XG4gICAgaWYgKHJlc3VsdC5kYXRlKSB7XG4gICAgICBsaW5lcy5wdXNoKGBEYXRlOiAke3Jlc3VsdC5kYXRlfWApO1xuICAgIH1cbiAgICBsaW5lcy5wdXNoKCcnKTtcbiAgfVxuXG4gIHJldHVybiBsaW5lcy5qb2luKCdcXG4nKTtcbn1cblxuLyoqXG4gKiBGb3JtYXQgVGF2aWx5IGV4dHJhY3QgcmVzdWx0c1xuICovXG5mdW5jdGlvbiBmb3JtYXRFeHRyYWN0UmVzdWx0cyhkYXRhOiBUYXZpbHlFeHRyYWN0UmVzcG9uc2UpOiBzdHJpbmcge1xuICBjb25zdCBsaW5lczogc3RyaW5nW10gPSBbJ1tXZWJFeHRyYWN0IHZpYSBUYXZpbHldJywgJyddO1xuXG4gIGlmICghZGF0YS5yZXN1bHRzIHx8IGRhdGEucmVzdWx0cy5sZW5ndGggPT09IDApIHtcbiAgICBsaW5lcy5wdXNoKCdObyBjb250ZW50IGV4dHJhY3RlZC4nKTtcbiAgICByZXR1cm4gbGluZXMuam9pbignXFxuJyk7XG4gIH1cblxuICBmb3IgKGNvbnN0IHJlc3VsdCBvZiBkYXRhLnJlc3VsdHMpIHtcbiAgICBsaW5lcy5wdXNoKGAqKiR7cmVzdWx0LnVybH0qKmApO1xuICAgIGxpbmVzLnB1c2goJycpO1xuICAgIGlmIChyZXN1bHQucmF3X2NvbnRlbnQpIHtcbiAgICAgIC8vIFRydW5jYXRlIHZlcnkgbG9uZyBjb250ZW50XG4gICAgICBjb25zdCBjb250ZW50ID0gcmVzdWx0LnJhd19jb250ZW50Lmxlbmd0aCA+IDUwMDBcbiAgICAgICAgPyByZXN1bHQucmF3X2NvbnRlbnQuc2xpY2UoMCwgNTAwMCkgKyAnXFxuXFxuW0NvbnRlbnQgdHJ1bmNhdGVkLi4uXSdcbiAgICAgICAgOiByZXN1bHQucmF3X2NvbnRlbnQ7XG4gICAgICBsaW5lcy5wdXNoKGNvbnRlbnQpO1xuICAgIH1cbiAgICBsaW5lcy5wdXNoKCcnKTtcbiAgICBsaW5lcy5wdXNoKCctLS0nKTtcbiAgICBsaW5lcy5wdXNoKCcnKTtcbiAgfVxuXG4gIHJldHVybiBsaW5lcy5qb2luKCdcXG4nKTtcbn1cblxuLy8gRXhwb3J0IHR5cGVzIGZvciB0ZXN0aW5nXG5leHBvcnQgdHlwZSB7IFNlYXJjaFByb3ZpZGVyLCBUYXZpbHlTZWFyY2hSZXNwb25zZSwgQnJhdmVTZWFyY2hSZXNwb25zZSwgU2VycEFQSVJlc3BvbnNlIH07XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQVNBLElBQUFBLFlBQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLE9BQUEsR0FBQUQsT0FBQTtBQVZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQXVEQTtBQUNBO0FBQ0E7QUFDTyxTQUFTRSxjQUFjQSxDQUFBLEVBQXFCO0VBQ2pELE9BQU8sQ0FDTDtJQUNFQyxJQUFJLEVBQUUsV0FBVztJQUNqQkMsV0FBVyxFQUFFLGtKQUFrSjtJQUMvSkMsVUFBVSxFQUFFO01BQ1ZDLElBQUksRUFBRSxRQUFRO01BQ2RDLFVBQVUsRUFBRTtRQUNWQyxLQUFLLEVBQUU7VUFDTEYsSUFBSSxFQUFFLFFBQVE7VUFDZEYsV0FBVyxFQUFFO1FBQ2YsQ0FBQztRQUNESyxVQUFVLEVBQUU7VUFDVkgsSUFBSSxFQUFFLFFBQVE7VUFDZEYsV0FBVyxFQUFFO1FBQ2YsQ0FBQztRQUNETSxXQUFXLEVBQUU7VUFDWEosSUFBSSxFQUFFLFFBQVE7VUFDZEssSUFBSSxFQUFFLENBQUMsT0FBTyxFQUFFLFVBQVUsQ0FBQztVQUMzQlAsV0FBVyxFQUFFO1FBQ2YsQ0FBQztRQUNEUSxhQUFhLEVBQUU7VUFDYk4sSUFBSSxFQUFFLFNBQVM7VUFDZkYsV0FBVyxFQUFFO1FBQ2Y7TUFDRixDQUFDO01BQ0RTLFFBQVEsRUFBRSxDQUFDLE9BQU8sQ0FBQztNQUNuQkMsb0JBQW9CLEVBQUU7SUFDeEIsQ0FBQztJQUNEQyxPQUFPLEVBQUUsTUFBT0MsSUFBSSxJQUFLO01BQ3ZCLE1BQU1SLEtBQUssR0FBR1EsSUFBSSxDQUFDLE9BQU8sQ0FBQztNQUMzQixJQUFJLE9BQU9SLEtBQUssS0FBSyxRQUFRLElBQUksQ0FBQ0EsS0FBSyxDQUFDUyxJQUFJLENBQUMsQ0FBQyxFQUFFO1FBQzlDLE9BQU8sMEJBQTBCO01BQ25DO01BRUEsTUFBTVIsVUFBVSxHQUFHUyxJQUFJLENBQUNDLEdBQUcsQ0FDekIsT0FBT0gsSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLFFBQVEsR0FBR0EsSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsRUFDL0QsRUFDRixDQUFDO01BQ0QsTUFBTU4sV0FBVyxHQUFHTSxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssVUFBVSxHQUFHLFVBQVUsR0FBRyxPQUFPO01BQzdFLE1BQU1KLGFBQWEsR0FBR0ksSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLEtBQUs7TUFFckQsSUFBSTtRQUNGO1FBQ0EsTUFBTUksU0FBUyxHQUFHLElBQUFDLDJCQUFjLEVBQUMsZ0JBQWdCLENBQUM7UUFDbEQsSUFBSUQsU0FBUyxFQUFFO1VBQ2IsT0FBTyxNQUFNRSxZQUFZLENBQUNkLEtBQUssRUFBRVksU0FBUyxFQUFFO1lBQUVYLFVBQVU7WUFBRUMsV0FBVztZQUFFRTtVQUFjLENBQUMsQ0FBQztRQUN6RjtRQUVBLE1BQU1XLFFBQVEsR0FBRyxJQUFBRiwyQkFBYyxFQUFDLHNCQUFzQixDQUFDO1FBQ3ZELElBQUlFLFFBQVEsRUFBRTtVQUNaLE9BQU8sTUFBTUMsV0FBVyxDQUFDaEIsS0FBSyxFQUFFZSxRQUFRLEVBQUU7WUFBRWQ7VUFBVyxDQUFDLENBQUM7UUFDM0Q7UUFFQSxNQUFNZ0IsT0FBTyxHQUFHLElBQUFKLDJCQUFjLEVBQUMsaUJBQWlCLENBQUM7UUFDakQsSUFBSUksT0FBTyxFQUFFO1VBQ1gsT0FBTyxNQUFNQyxhQUFhLENBQUNsQixLQUFLLEVBQUVpQixPQUFPLEVBQUU7WUFBRWhCO1VBQVcsQ0FBQyxDQUFDO1FBQzVEO1FBRUEsT0FBTyxtSkFBbUo7TUFDNUosQ0FBQyxDQUFDLE9BQU9rQixLQUFLLEVBQUU7UUFDZCxPQUFPLElBQUFDLGtCQUFVLEVBQUMsV0FBVyxFQUFFRCxLQUFLLEVBQUU7VUFBRW5CO1FBQU0sQ0FBQyxDQUFDO01BQ2xEO0lBQ0Y7RUFDRixDQUFDLEVBQ0Q7SUFDRUwsSUFBSSxFQUFFLFlBQVk7SUFDbEJDLFdBQVcsRUFBRSx3SEFBd0g7SUFDcklDLFVBQVUsRUFBRTtNQUNWQyxJQUFJLEVBQUUsUUFBUTtNQUNkQyxVQUFVLEVBQUU7UUFDVnNCLElBQUksRUFBRTtVQUNKdkIsSUFBSSxFQUFFLE9BQU87VUFDYndCLEtBQUssRUFBRTtZQUFFeEIsSUFBSSxFQUFFO1VBQVMsQ0FBQztVQUN6QkYsV0FBVyxFQUFFO1FBQ2YsQ0FBQztRQUNEMkIsR0FBRyxFQUFFO1VBQ0h6QixJQUFJLEVBQUUsUUFBUTtVQUNkRixXQUFXLEVBQUU7UUFDZjtNQUNGLENBQUM7TUFDRFUsb0JBQW9CLEVBQUU7SUFDeEIsQ0FBQztJQUNEQyxPQUFPLEVBQUUsTUFBT0MsSUFBSSxJQUFLO01BQ3ZCLElBQUlhLElBQWMsR0FBRyxFQUFFO01BRXZCLElBQUlHLEtBQUssQ0FBQ0MsT0FBTyxDQUFDakIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUU7UUFDL0JhLElBQUksR0FBR2IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDa0IsTUFBTSxDQUFFQyxDQUFDLElBQWtCLE9BQU9BLENBQUMsS0FBSyxRQUFRLENBQUM7TUFDdkUsQ0FBQyxNQUFNLElBQUksT0FBT25CLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxRQUFRLEVBQUU7UUFDMUNhLElBQUksR0FBRyxDQUFDYixJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7TUFDdEI7TUFFQSxJQUFJYSxJQUFJLENBQUNPLE1BQU0sS0FBSyxDQUFDLEVBQUU7UUFDckIsT0FBTyxxQ0FBcUM7TUFDOUM7O01BRUE7TUFDQVAsSUFBSSxHQUFHQSxJQUFJLENBQUNRLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO01BRXZCLE1BQU1qQixTQUFTLEdBQUcsSUFBQUMsMkJBQWMsRUFBQyxnQkFBZ0IsQ0FBQztNQUNsRCxJQUFJLENBQUNELFNBQVMsRUFBRTtRQUNkLE9BQU8sb0dBQW9HO01BQzdHO01BRUEsSUFBSTtRQUNGLE9BQU8sTUFBTWtCLGFBQWEsQ0FBQ1QsSUFBSSxFQUFFVCxTQUFTLENBQUM7TUFDN0MsQ0FBQyxDQUFDLE9BQU9PLEtBQUssRUFBRTtRQUNkLE9BQU8sSUFBQUMsa0JBQVUsRUFBQyxZQUFZLEVBQUVELEtBQUssRUFBRTtVQUFFRSxJQUFJLEVBQUVBLElBQUksQ0FBQ1UsSUFBSSxDQUFDLElBQUk7UUFBRSxDQUFDLENBQUM7TUFDbkU7SUFDRjtFQUNGLENBQUMsQ0FDRjtBQUNIOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGVBQWVqQixZQUFZQSxDQUN6QmQsS0FBYSxFQUNiZ0MsTUFBYyxFQUNkQyxPQUE0RSxFQUMzRDtFQUNqQixNQUFNQyxVQUFVLEdBQUcsSUFBSUMsZUFBZSxDQUFDLENBQUM7RUFDeEMsTUFBTUMsT0FBTyxHQUFHQyxVQUFVLENBQUMsTUFBTUgsVUFBVSxDQUFDSSxLQUFLLENBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7O0VBRTdELElBQUk7SUFDRixNQUFNQyxRQUFRLEdBQUcsTUFBTUMsS0FBSyxDQUFDLCtCQUErQixFQUFFO01BQzVEQyxNQUFNLEVBQUUsTUFBTTtNQUNkQyxPQUFPLEVBQUU7UUFDUCxjQUFjLEVBQUU7TUFDbEIsQ0FBQztNQUNEQyxJQUFJLEVBQUVDLElBQUksQ0FBQ0MsU0FBUyxDQUFDO1FBQ25CQyxPQUFPLEVBQUVkLE1BQU07UUFDZmhDLEtBQUs7UUFDTCtDLFlBQVksRUFBRWQsT0FBTyxDQUFDL0IsV0FBVztRQUNqQzhDLGNBQWMsRUFBRWYsT0FBTyxDQUFDN0IsYUFBYTtRQUNyQzZDLFdBQVcsRUFBRWhCLE9BQU8sQ0FBQ2hDO01BQ3ZCLENBQUMsQ0FBQztNQUNGaUQsTUFBTSxFQUFFaEIsVUFBVSxDQUFDZ0I7SUFDckIsQ0FBQyxDQUFDO0lBQ0YsSUFBSSxDQUFDWCxRQUFRLENBQUNZLEVBQUUsRUFBRTtNQUNoQixNQUFNQyxJQUFJLEdBQUcsTUFBTWIsUUFBUSxDQUFDYSxJQUFJLENBQUMsQ0FBQztNQUNsQyxNQUFNLElBQUlDLEtBQUssQ0FBQyxxQkFBcUJkLFFBQVEsQ0FBQ2UsTUFBTSxJQUFJRixJQUFJLEVBQUUsQ0FBQztJQUNqRTtJQUVBLE1BQU1HLElBQUksR0FBSSxNQUFNaEIsUUFBUSxDQUFDaUIsSUFBSSxDQUFDLENBQTBCO0lBQzVELE9BQU9DLG1CQUFtQixDQUFDRixJQUFJLEVBQUUsUUFBUSxDQUFDO0VBQzVDLENBQUMsQ0FBQyxPQUFPcEMsS0FBSyxFQUFFO0lBQ2QsSUFBSUEsS0FBSyxZQUFZa0MsS0FBSyxJQUFJbEMsS0FBSyxDQUFDeEIsSUFBSSxLQUFLLFlBQVksRUFBRTtNQUN6RCxNQUFNLElBQUkwRCxLQUFLLENBQUMsMENBQTBDLENBQUM7SUFDN0Q7SUFDQSxNQUFNbEMsS0FBSztFQUNiLENBQUMsU0FBUztJQUNSdUMsWUFBWSxDQUFDdEIsT0FBTyxDQUFDO0VBQ3ZCO0FBQ0Y7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsZUFBZXBCLFdBQVdBLENBQ3hCaEIsS0FBYSxFQUNiZ0MsTUFBYyxFQUNkQyxPQUErQixFQUNkO0VBQ2pCLE1BQU0wQixNQUFNLEdBQUcsSUFBSUMsZUFBZSxDQUFDO0lBQ2pDQyxDQUFDLEVBQUU3RCxLQUFLO0lBQ1I4RCxLQUFLLEVBQUVDLE1BQU0sQ0FBQzlCLE9BQU8sQ0FBQ2hDLFVBQVU7RUFDbEMsQ0FBQyxDQUFDO0VBRUYsTUFBTWlDLFVBQVUsR0FBRyxJQUFJQyxlQUFlLENBQUMsQ0FBQztFQUN4QyxNQUFNQyxPQUFPLEdBQUdDLFVBQVUsQ0FBQyxNQUFNSCxVQUFVLENBQUNJLEtBQUssQ0FBQyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQzs7RUFFN0QsSUFBSTtJQUNGLE1BQU1DLFFBQVEsR0FBRyxNQUFNQyxLQUFLLENBQUMsa0RBQWtEbUIsTUFBTSxFQUFFLEVBQUU7TUFDdkZqQixPQUFPLEVBQUU7UUFDUCxRQUFRLEVBQUUsa0JBQWtCO1FBQzVCLHNCQUFzQixFQUFFVjtNQUMxQixDQUFDO01BQ0RrQixNQUFNLEVBQUVoQixVQUFVLENBQUNnQjtJQUNyQixDQUFDLENBQUM7SUFFRixJQUFJLENBQUNYLFFBQVEsQ0FBQ1ksRUFBRSxFQUFFO01BQ2hCLE1BQU1DLElBQUksR0FBRyxNQUFNYixRQUFRLENBQUNhLElBQUksQ0FBQyxDQUFDO01BQ2xDLE1BQU0sSUFBSUMsS0FBSyxDQUFDLDJCQUEyQmQsUUFBUSxDQUFDZSxNQUFNLElBQUlGLElBQUksRUFBRSxDQUFDO0lBQ3ZFO0lBRUEsTUFBTUcsSUFBSSxHQUFJLE1BQU1oQixRQUFRLENBQUNpQixJQUFJLENBQUMsQ0FBeUI7SUFDM0QsT0FBT1Esa0JBQWtCLENBQUNULElBQUksRUFBRSxjQUFjLENBQUM7RUFDakQsQ0FBQyxDQUFDLE9BQU9wQyxLQUFLLEVBQUU7SUFDZCxJQUFJQSxLQUFLLFlBQVlrQyxLQUFLLElBQUlsQyxLQUFLLENBQUN4QixJQUFJLEtBQUssWUFBWSxFQUFFO01BQ3pELE1BQU0sSUFBSTBELEtBQUssQ0FBQyx5Q0FBeUMsQ0FBQztJQUM1RDtJQUNBLE1BQU1sQyxLQUFLO0VBQ2IsQ0FBQyxTQUFTO0lBQ1J1QyxZQUFZLENBQUN0QixPQUFPLENBQUM7RUFDdkI7QUFDRjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxlQUFlbEIsYUFBYUEsQ0FDMUJsQixLQUFhLEVBQ2JnQyxNQUFjLEVBQ2RDLE9BQStCLEVBQ2Q7RUFDakIsTUFBTTBCLE1BQU0sR0FBRyxJQUFJQyxlQUFlLENBQUM7SUFDakNDLENBQUMsRUFBRTdELEtBQUs7SUFDUjhDLE9BQU8sRUFBRWQsTUFBTTtJQUNmaUMsTUFBTSxFQUFFLFFBQVE7SUFDaEJDLEdBQUcsRUFBRUgsTUFBTSxDQUFDOUIsT0FBTyxDQUFDaEMsVUFBVTtFQUNoQyxDQUFDLENBQUM7RUFFRixNQUFNaUMsVUFBVSxHQUFHLElBQUlDLGVBQWUsQ0FBQyxDQUFDO0VBQ3hDLE1BQU1DLE9BQU8sR0FBR0MsVUFBVSxDQUFDLE1BQU1ILFVBQVUsQ0FBQ0ksS0FBSyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDOztFQUU3RCxJQUFJO0lBQ0YsTUFBTUMsUUFBUSxHQUFHLE1BQU1DLEtBQUssQ0FBQyw4QkFBOEJtQixNQUFNLEVBQUUsRUFBRTtNQUNuRVQsTUFBTSxFQUFFaEIsVUFBVSxDQUFDZ0I7SUFDckIsQ0FBQyxDQUFDO0lBRUYsSUFBSSxDQUFDWCxRQUFRLENBQUNZLEVBQUUsRUFBRTtNQUNoQixNQUFNQyxJQUFJLEdBQUcsTUFBTWIsUUFBUSxDQUFDYSxJQUFJLENBQUMsQ0FBQztNQUNsQyxNQUFNLElBQUlDLEtBQUssQ0FBQyxrQkFBa0JkLFFBQVEsQ0FBQ2UsTUFBTSxJQUFJRixJQUFJLEVBQUUsQ0FBQztJQUM5RDtJQUVBLE1BQU1HLElBQUksR0FBSSxNQUFNaEIsUUFBUSxDQUFDaUIsSUFBSSxDQUFDLENBQXFCO0lBQ3ZELE9BQU9XLG9CQUFvQixDQUFDWixJQUFJLEVBQUUsU0FBUyxDQUFDO0VBQzlDLENBQUMsQ0FBQyxPQUFPcEMsS0FBSyxFQUFFO0lBQ2QsSUFBSUEsS0FBSyxZQUFZa0MsS0FBSyxJQUFJbEMsS0FBSyxDQUFDeEIsSUFBSSxLQUFLLFlBQVksRUFBRTtNQUN6RCxNQUFNLElBQUkwRCxLQUFLLENBQUMsMkNBQTJDLENBQUM7SUFDOUQ7SUFDQSxNQUFNbEMsS0FBSztFQUNiLENBQUMsU0FBUztJQUNSdUMsWUFBWSxDQUFDdEIsT0FBTyxDQUFDO0VBQ3ZCO0FBQ0Y7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsZUFBZU4sYUFBYUEsQ0FBQ1QsSUFBYyxFQUFFVyxNQUFjLEVBQW1CO0VBQzVFLE1BQU1PLFFBQVEsR0FBRyxNQUFNQyxLQUFLLENBQUMsZ0NBQWdDLEVBQUU7SUFDN0RDLE1BQU0sRUFBRSxNQUFNO0lBQ2RDLE9BQU8sRUFBRTtNQUNQLGNBQWMsRUFBRTtJQUNsQixDQUFDO0lBQ0RDLElBQUksRUFBRUMsSUFBSSxDQUFDQyxTQUFTLENBQUM7TUFDbkJDLE9BQU8sRUFBRWQsTUFBTTtNQUNmWDtJQUNGLENBQUM7RUFDSCxDQUFDLENBQUM7RUFFRixJQUFJLENBQUNrQixRQUFRLENBQUNZLEVBQUUsRUFBRTtJQUNoQixNQUFNQyxJQUFJLEdBQUcsTUFBTWIsUUFBUSxDQUFDYSxJQUFJLENBQUMsQ0FBQztJQUNsQyxNQUFNLElBQUlDLEtBQUssQ0FBQyw2QkFBNkJkLFFBQVEsQ0FBQ2UsTUFBTSxJQUFJRixJQUFJLEVBQUUsQ0FBQztFQUN6RTtFQUVBLE1BQU1HLElBQUksR0FBSSxNQUFNaEIsUUFBUSxDQUFDaUIsSUFBSSxDQUFDLENBQTJCO0VBQzdELE9BQU9ZLG9CQUFvQixDQUFDYixJQUFJLENBQUM7QUFDbkM7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBU0UsbUJBQW1CQSxDQUFDRixJQUEwQixFQUFFYyxRQUFnQixFQUFVO0VBQ2pGLE1BQU1DLEtBQWUsR0FBRyxDQUFDLGtCQUFrQkQsUUFBUSxHQUFHLEVBQUUsRUFBRSxDQUFDO0VBRTNELElBQUlkLElBQUksQ0FBQ2dCLE1BQU0sRUFBRTtJQUNmRCxLQUFLLENBQUNFLElBQUksQ0FBQyxVQUFVLEVBQUVqQixJQUFJLENBQUNnQixNQUFNLEVBQUUsRUFBRSxDQUFDO0VBQ3pDO0VBRUEsSUFBSSxDQUFDaEIsSUFBSSxDQUFDa0IsT0FBTyxJQUFJbEIsSUFBSSxDQUFDa0IsT0FBTyxDQUFDN0MsTUFBTSxLQUFLLENBQUMsRUFBRTtJQUM5QzBDLEtBQUssQ0FBQ0UsSUFBSSxDQUFDLG1CQUFtQixDQUFDO0lBQy9CLE9BQU9GLEtBQUssQ0FBQ3ZDLElBQUksQ0FBQyxJQUFJLENBQUM7RUFDekI7RUFFQXVDLEtBQUssQ0FBQ0UsSUFBSSxDQUFDLGdCQUFnQmpCLElBQUksQ0FBQ3ZELEtBQUssSUFBSSxDQUFDO0VBQzFDc0UsS0FBSyxDQUFDRSxJQUFJLENBQUMsRUFBRSxDQUFDO0VBRWQsS0FBSyxNQUFNRSxNQUFNLElBQUluQixJQUFJLENBQUNrQixPQUFPLEVBQUU7SUFDakNILEtBQUssQ0FBQ0UsSUFBSSxDQUFDLEtBQUtFLE1BQU0sQ0FBQ0MsS0FBSyxJQUFJLENBQUM7SUFDakNMLEtBQUssQ0FBQ0UsSUFBSSxDQUFDRSxNQUFNLENBQUNuRCxHQUFHLENBQUM7SUFDdEIsSUFBSW1ELE1BQU0sQ0FBQ0UsT0FBTyxFQUFFO01BQ2xCLE1BQU1DLE9BQU8sR0FBR0gsTUFBTSxDQUFDRSxPQUFPLENBQUNoRCxNQUFNLEdBQUcsR0FBRyxHQUN2QzhDLE1BQU0sQ0FBQ0UsT0FBTyxDQUFDL0MsS0FBSyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsR0FBRyxLQUFLLEdBQ3BDNkMsTUFBTSxDQUFDRSxPQUFPO01BQ2xCTixLQUFLLENBQUNFLElBQUksQ0FBQ0ssT0FBTyxDQUFDO0lBQ3JCO0lBQ0EsSUFBSUgsTUFBTSxDQUFDSSxjQUFjLEVBQUU7TUFDekJSLEtBQUssQ0FBQ0UsSUFBSSxDQUFDLGNBQWNFLE1BQU0sQ0FBQ0ksY0FBYyxFQUFFLENBQUM7SUFDbkQ7SUFDQVIsS0FBSyxDQUFDRSxJQUFJLENBQUMsRUFBRSxDQUFDO0VBQ2hCO0VBRUEsT0FBT0YsS0FBSyxDQUFDdkMsSUFBSSxDQUFDLElBQUksQ0FBQztBQUN6Qjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTaUMsa0JBQWtCQSxDQUFDVCxJQUF5QixFQUFFYyxRQUFnQixFQUFVO0VBQy9FLE1BQU1DLEtBQWUsR0FBRyxDQUFDLGtCQUFrQkQsUUFBUSxHQUFHLEVBQUUsRUFBRSxDQUFDO0VBRTNELE1BQU1JLE9BQU8sR0FBR2xCLElBQUksQ0FBQ3dCLEdBQUcsRUFBRU4sT0FBTyxJQUFJLEVBQUU7RUFDdkMsSUFBSUEsT0FBTyxDQUFDN0MsTUFBTSxLQUFLLENBQUMsRUFBRTtJQUN4QjBDLEtBQUssQ0FBQ0UsSUFBSSxDQUFDLG1CQUFtQixDQUFDO0lBQy9CLE9BQU9GLEtBQUssQ0FBQ3ZDLElBQUksQ0FBQyxJQUFJLENBQUM7RUFDekI7RUFFQSxLQUFLLE1BQU0yQyxNQUFNLElBQUlELE9BQU8sRUFBRTtJQUM1QkgsS0FBSyxDQUFDRSxJQUFJLENBQUMsS0FBS0UsTUFBTSxDQUFDQyxLQUFLLElBQUksQ0FBQztJQUNqQ0wsS0FBSyxDQUFDRSxJQUFJLENBQUNFLE1BQU0sQ0FBQ25ELEdBQUcsQ0FBQztJQUN0QixJQUFJbUQsTUFBTSxDQUFDOUUsV0FBVyxFQUFFO01BQ3RCMEUsS0FBSyxDQUFDRSxJQUFJLENBQUNFLE1BQU0sQ0FBQzlFLFdBQVcsQ0FBQztJQUNoQztJQUNBLElBQUk4RSxNQUFNLENBQUNNLE9BQU8sRUFBRXJGLElBQUksRUFBRTtNQUN4QjJFLEtBQUssQ0FBQ0UsSUFBSSxDQUFDLFdBQVdFLE1BQU0sQ0FBQ00sT0FBTyxDQUFDckYsSUFBSSxFQUFFLENBQUM7SUFDOUM7SUFDQSxJQUFJK0UsTUFBTSxDQUFDTyxhQUFhLEVBQUU7TUFDeEJYLEtBQUssQ0FBQ0UsSUFBSSxDQUFDLGNBQWNFLE1BQU0sQ0FBQ08sYUFBYSxFQUFFLENBQUM7SUFDbEQ7SUFDQVgsS0FBSyxDQUFDRSxJQUFJLENBQUMsRUFBRSxDQUFDO0VBQ2hCO0VBRUEsT0FBT0YsS0FBSyxDQUFDdkMsSUFBSSxDQUFDLElBQUksQ0FBQztBQUN6Qjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTb0Msb0JBQW9CQSxDQUFDWixJQUFxQixFQUFFYyxRQUFnQixFQUFVO0VBQzdFLE1BQU1DLEtBQWUsR0FBRyxDQUFDLGtCQUFrQkQsUUFBUSxHQUFHLEVBQUUsRUFBRSxDQUFDO0VBRTNELE1BQU1JLE9BQU8sR0FBR2xCLElBQUksQ0FBQzJCLGVBQWUsSUFBSSxFQUFFO0VBQzFDLElBQUlULE9BQU8sQ0FBQzdDLE1BQU0sS0FBSyxDQUFDLEVBQUU7SUFDeEIwQyxLQUFLLENBQUNFLElBQUksQ0FBQyxtQkFBbUIsQ0FBQztJQUMvQixPQUFPRixLQUFLLENBQUN2QyxJQUFJLENBQUMsSUFBSSxDQUFDO0VBQ3pCO0VBRUEsS0FBSyxNQUFNMkMsTUFBTSxJQUFJRCxPQUFPLEVBQUU7SUFDNUJILEtBQUssQ0FBQ0UsSUFBSSxDQUFDLEtBQUtFLE1BQU0sQ0FBQ0MsS0FBSyxJQUFJLENBQUM7SUFDakNMLEtBQUssQ0FBQ0UsSUFBSSxDQUFDRSxNQUFNLENBQUNTLElBQUksQ0FBQztJQUN2QixJQUFJVCxNQUFNLENBQUNHLE9BQU8sRUFBRTtNQUNsQlAsS0FBSyxDQUFDRSxJQUFJLENBQUNFLE1BQU0sQ0FBQ0csT0FBTyxDQUFDO0lBQzVCO0lBQ0EsSUFBSUgsTUFBTSxDQUFDVSxNQUFNLEVBQUU7TUFDakJkLEtBQUssQ0FBQ0UsSUFBSSxDQUFDLFdBQVdFLE1BQU0sQ0FBQ1UsTUFBTSxFQUFFLENBQUM7SUFDeEM7SUFDQSxJQUFJVixNQUFNLENBQUNXLElBQUksRUFBRTtNQUNmZixLQUFLLENBQUNFLElBQUksQ0FBQyxTQUFTRSxNQUFNLENBQUNXLElBQUksRUFBRSxDQUFDO0lBQ3BDO0lBQ0FmLEtBQUssQ0FBQ0UsSUFBSSxDQUFDLEVBQUUsQ0FBQztFQUNoQjtFQUVBLE9BQU9GLEtBQUssQ0FBQ3ZDLElBQUksQ0FBQyxJQUFJLENBQUM7QUFDekI7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsU0FBU3FDLG9CQUFvQkEsQ0FBQ2IsSUFBMkIsRUFBVTtFQUNqRSxNQUFNZSxLQUFlLEdBQUcsQ0FBQyx5QkFBeUIsRUFBRSxFQUFFLENBQUM7RUFFdkQsSUFBSSxDQUFDZixJQUFJLENBQUNrQixPQUFPLElBQUlsQixJQUFJLENBQUNrQixPQUFPLENBQUM3QyxNQUFNLEtBQUssQ0FBQyxFQUFFO0lBQzlDMEMsS0FBSyxDQUFDRSxJQUFJLENBQUMsdUJBQXVCLENBQUM7SUFDbkMsT0FBT0YsS0FBSyxDQUFDdkMsSUFBSSxDQUFDLElBQUksQ0FBQztFQUN6QjtFQUVBLEtBQUssTUFBTTJDLE1BQU0sSUFBSW5CLElBQUksQ0FBQ2tCLE9BQU8sRUFBRTtJQUNqQ0gsS0FBSyxDQUFDRSxJQUFJLENBQUMsS0FBS0UsTUFBTSxDQUFDbkQsR0FBRyxJQUFJLENBQUM7SUFDL0IrQyxLQUFLLENBQUNFLElBQUksQ0FBQyxFQUFFLENBQUM7SUFDZCxJQUFJRSxNQUFNLENBQUNZLFdBQVcsRUFBRTtNQUN0QjtNQUNBLE1BQU1WLE9BQU8sR0FBR0YsTUFBTSxDQUFDWSxXQUFXLENBQUMxRCxNQUFNLEdBQUcsSUFBSSxHQUM1QzhDLE1BQU0sQ0FBQ1ksV0FBVyxDQUFDekQsS0FBSyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyw0QkFBNEIsR0FDaEU2QyxNQUFNLENBQUNZLFdBQVc7TUFDdEJoQixLQUFLLENBQUNFLElBQUksQ0FBQ0ksT0FBTyxDQUFDO0lBQ3JCO0lBQ0FOLEtBQUssQ0FBQ0UsSUFBSSxDQUFDLEVBQUUsQ0FBQztJQUNkRixLQUFLLENBQUNFLElBQUksQ0FBQyxLQUFLLENBQUM7SUFDakJGLEtBQUssQ0FBQ0UsSUFBSSxDQUFDLEVBQUUsQ0FBQztFQUNoQjtFQUVBLE9BQU9GLEtBQUssQ0FBQ3ZDLElBQUksQ0FBQyxJQUFJLENBQUM7QUFDekI7O0FBRUEiLCJpZ25vcmVMaXN0IjpbXX0=