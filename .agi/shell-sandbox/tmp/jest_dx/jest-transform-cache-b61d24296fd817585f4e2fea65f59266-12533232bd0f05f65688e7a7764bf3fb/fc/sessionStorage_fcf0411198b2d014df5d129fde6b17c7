8482206f6543b0fed5c4b46f481173d1
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createInMemorySessionStorage = createInMemorySessionStorage;
exports.getSessionStorage = getSessionStorage;
exports.setSessionStorage = setSessionStorage;
var _nodeFs = require("node:fs");
var _nodePath = require("node:path");
var _nodeOs = require("node:os");
class FsSessionStorage {
  constructor(root) {
    this.root = root;
  }
  ensureDir(path) {
    (0, _nodeFs.mkdirSync)(path, {
      recursive: true
    });
  }
  readFile(path) {
    try {
      return (0, _nodeFs.readFileSync)(path, 'utf-8');
    } catch {
      return null;
    }
  }
  writeFile(path, content) {
    (0, _nodeFs.writeFileSync)(path, content, 'utf-8');
  }
  deleteFile(path) {
    try {
      (0, _nodeFs.rmSync)(path, {
        force: true
      });
    } catch {
      // ignore
    }
  }
  listFiles(path) {
    try {
      return (0, _nodeFs.readdirSync)(path);
    } catch {
      return [];
    }
  }
  exists(path) {
    return (0, _nodeFs.existsSync)(path);
  }
}
function resolveDataRoot() {
  return process.env['AGI_DATA_DIR']?.trim() || process.env['EROSOLAR_DATA_DIR']?.trim() || (0, _nodePath.join)((0, _nodeOs.homedir)(), '.agi');
}
let sessionStorage = null;
function getSessionStorage() {
  if (!sessionStorage) {
    sessionStorage = new FsSessionStorage(resolveDataRoot());
  }
  return sessionStorage;
}
function setSessionStorage(storage) {
  sessionStorage = storage;
}
function createInMemorySessionStorage(root = '/mem') {
  const files = new Map();
  return {
    root,
    ensureDir: () => {},
    readFile: path => files.get(path) ?? null,
    writeFile: (path, content) => {
      files.set(path, content);
    },
    deleteFile: path => {
      files.delete(path);
    },
    listFiles: () => Array.from(files.keys()),
    exists: path => files.has(path)
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbm9kZUZzIiwicmVxdWlyZSIsIl9ub2RlUGF0aCIsIl9ub2RlT3MiLCJGc1Nlc3Npb25TdG9yYWdlIiwiY29uc3RydWN0b3IiLCJyb290IiwiZW5zdXJlRGlyIiwicGF0aCIsIm1rZGlyU3luYyIsInJlY3Vyc2l2ZSIsInJlYWRGaWxlIiwicmVhZEZpbGVTeW5jIiwid3JpdGVGaWxlIiwiY29udGVudCIsIndyaXRlRmlsZVN5bmMiLCJkZWxldGVGaWxlIiwicm1TeW5jIiwiZm9yY2UiLCJsaXN0RmlsZXMiLCJyZWFkZGlyU3luYyIsImV4aXN0cyIsImV4aXN0c1N5bmMiLCJyZXNvbHZlRGF0YVJvb3QiLCJwcm9jZXNzIiwiZW52IiwidHJpbSIsImpvaW4iLCJob21lZGlyIiwic2Vzc2lvblN0b3JhZ2UiLCJnZXRTZXNzaW9uU3RvcmFnZSIsInNldFNlc3Npb25TdG9yYWdlIiwic3RvcmFnZSIsImNyZWF0ZUluTWVtb3J5U2Vzc2lvblN0b3JhZ2UiLCJmaWxlcyIsIk1hcCIsImdldCIsInNldCIsImRlbGV0ZSIsIkFycmF5IiwiZnJvbSIsImtleXMiLCJoYXMiXSwic291cmNlcyI6WyJzZXNzaW9uU3RvcmFnZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBta2RpclN5bmMsIHJlYWRGaWxlU3luYywgd3JpdGVGaWxlU3luYywgcm1TeW5jLCByZWFkZGlyU3luYywgZXhpc3RzU3luYyB9IGZyb20gJ25vZGU6ZnMnO1xuaW1wb3J0IHsgam9pbiB9IGZyb20gJ25vZGU6cGF0aCc7XG5pbXBvcnQgeyBob21lZGlyIH0gZnJvbSAnbm9kZTpvcyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2Vzc2lvblN0b3JhZ2Uge1xuICByb290OiBzdHJpbmc7XG4gIGVuc3VyZURpcihwYXRoOiBzdHJpbmcpOiB2b2lkO1xuICByZWFkRmlsZShwYXRoOiBzdHJpbmcpOiBzdHJpbmcgfCBudWxsO1xuICB3cml0ZUZpbGUocGF0aDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiB2b2lkO1xuICBkZWxldGVGaWxlKHBhdGg6IHN0cmluZyk6IHZvaWQ7XG4gIGxpc3RGaWxlcyhwYXRoOiBzdHJpbmcpOiBzdHJpbmdbXTtcbiAgZXhpc3RzKHBhdGg6IHN0cmluZyk6IGJvb2xlYW47XG59XG5cbmNsYXNzIEZzU2Vzc2lvblN0b3JhZ2UgaW1wbGVtZW50cyBTZXNzaW9uU3RvcmFnZSB7XG4gIHJvb3Q6IHN0cmluZztcblxuICBjb25zdHJ1Y3Rvcihyb290OiBzdHJpbmcpIHtcbiAgICB0aGlzLnJvb3QgPSByb290O1xuICB9XG5cbiAgZW5zdXJlRGlyKHBhdGg6IHN0cmluZyk6IHZvaWQge1xuICAgIG1rZGlyU3luYyhwYXRoLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgfVxuXG4gIHJlYWRGaWxlKHBhdGg6IHN0cmluZyk6IHN0cmluZyB8IG51bGwge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gcmVhZEZpbGVTeW5jKHBhdGgsICd1dGYtOCcpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgd3JpdGVGaWxlKHBhdGg6IHN0cmluZywgY29udGVudDogc3RyaW5nKTogdm9pZCB7XG4gICAgd3JpdGVGaWxlU3luYyhwYXRoLCBjb250ZW50LCAndXRmLTgnKTtcbiAgfVxuXG4gIGRlbGV0ZUZpbGUocGF0aDogc3RyaW5nKTogdm9pZCB7XG4gICAgdHJ5IHtcbiAgICAgIHJtU3luYyhwYXRoLCB7IGZvcmNlOiB0cnVlIH0pO1xuICAgIH0gY2F0Y2gge1xuICAgICAgLy8gaWdub3JlXG4gICAgfVxuICB9XG5cbiAgbGlzdEZpbGVzKHBhdGg6IHN0cmluZyk6IHN0cmluZ1tdIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIHJlYWRkaXJTeW5jKHBhdGgpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuXG4gIGV4aXN0cyhwYXRoOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gZXhpc3RzU3luYyhwYXRoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiByZXNvbHZlRGF0YVJvb3QoKTogc3RyaW5nIHtcbiAgcmV0dXJuIChcbiAgICBwcm9jZXNzLmVudlsnQUdJX0RBVEFfRElSJ10/LnRyaW0oKSB8fFxuICAgIHByb2Nlc3MuZW52WydFUk9TT0xBUl9EQVRBX0RJUiddPy50cmltKCkgfHxcbiAgICBqb2luKGhvbWVkaXIoKSwgJy5hZ2knKVxuICApO1xufVxuXG5sZXQgc2Vzc2lvblN0b3JhZ2U6IFNlc3Npb25TdG9yYWdlIHwgbnVsbCA9IG51bGw7XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRTZXNzaW9uU3RvcmFnZSgpOiBTZXNzaW9uU3RvcmFnZSB7XG4gIGlmICghc2Vzc2lvblN0b3JhZ2UpIHtcbiAgICBzZXNzaW9uU3RvcmFnZSA9IG5ldyBGc1Nlc3Npb25TdG9yYWdlKHJlc29sdmVEYXRhUm9vdCgpKTtcbiAgfVxuICByZXR1cm4gc2Vzc2lvblN0b3JhZ2U7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXRTZXNzaW9uU3RvcmFnZShzdG9yYWdlOiBTZXNzaW9uU3RvcmFnZSk6IHZvaWQge1xuICBzZXNzaW9uU3RvcmFnZSA9IHN0b3JhZ2U7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVJbk1lbW9yeVNlc3Npb25TdG9yYWdlKHJvb3QgPSAnL21lbScpOiBTZXNzaW9uU3RvcmFnZSB7XG4gIGNvbnN0IGZpbGVzID0gbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oKTtcbiAgcmV0dXJuIHtcbiAgICByb290LFxuICAgIGVuc3VyZURpcjogKCkgPT4ge30sXG4gICAgcmVhZEZpbGU6IChwYXRoKSA9PiBmaWxlcy5nZXQocGF0aCkgPz8gbnVsbCxcbiAgICB3cml0ZUZpbGU6IChwYXRoLCBjb250ZW50KSA9PiB7XG4gICAgICBmaWxlcy5zZXQocGF0aCwgY29udGVudCk7XG4gICAgfSxcbiAgICBkZWxldGVGaWxlOiAocGF0aCkgPT4ge1xuICAgICAgZmlsZXMuZGVsZXRlKHBhdGgpO1xuICAgIH0sXG4gICAgbGlzdEZpbGVzOiAoKSA9PiBBcnJheS5mcm9tKGZpbGVzLmtleXMoKSksXG4gICAgZXhpc3RzOiAocGF0aCkgPT4gZmlsZXMuaGFzKHBhdGgpLFxuICB9O1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBLElBQUFBLE9BQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLFNBQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLE9BQUEsR0FBQUYsT0FBQTtBQVlBLE1BQU1HLGdCQUFnQixDQUEyQjtFQUcvQ0MsV0FBV0EsQ0FBQ0MsSUFBWSxFQUFFO0lBQ3hCLElBQUksQ0FBQ0EsSUFBSSxHQUFHQSxJQUFJO0VBQ2xCO0VBRUFDLFNBQVNBLENBQUNDLElBQVksRUFBUTtJQUM1QixJQUFBQyxpQkFBUyxFQUFDRCxJQUFJLEVBQUU7TUFBRUUsU0FBUyxFQUFFO0lBQUssQ0FBQyxDQUFDO0VBQ3RDO0VBRUFDLFFBQVFBLENBQUNILElBQVksRUFBaUI7SUFDcEMsSUFBSTtNQUNGLE9BQU8sSUFBQUksb0JBQVksRUFBQ0osSUFBSSxFQUFFLE9BQU8sQ0FBQztJQUNwQyxDQUFDLENBQUMsTUFBTTtNQUNOLE9BQU8sSUFBSTtJQUNiO0VBQ0Y7RUFFQUssU0FBU0EsQ0FBQ0wsSUFBWSxFQUFFTSxPQUFlLEVBQVE7SUFDN0MsSUFBQUMscUJBQWEsRUFBQ1AsSUFBSSxFQUFFTSxPQUFPLEVBQUUsT0FBTyxDQUFDO0VBQ3ZDO0VBRUFFLFVBQVVBLENBQUNSLElBQVksRUFBUTtJQUM3QixJQUFJO01BQ0YsSUFBQVMsY0FBTSxFQUFDVCxJQUFJLEVBQUU7UUFBRVUsS0FBSyxFQUFFO01BQUssQ0FBQyxDQUFDO0lBQy9CLENBQUMsQ0FBQyxNQUFNO01BQ047SUFBQTtFQUVKO0VBRUFDLFNBQVNBLENBQUNYLElBQVksRUFBWTtJQUNoQyxJQUFJO01BQ0YsT0FBTyxJQUFBWSxtQkFBVyxFQUFDWixJQUFJLENBQUM7SUFDMUIsQ0FBQyxDQUFDLE1BQU07TUFDTixPQUFPLEVBQUU7SUFDWDtFQUNGO0VBRUFhLE1BQU1BLENBQUNiLElBQVksRUFBVztJQUM1QixPQUFPLElBQUFjLGtCQUFVLEVBQUNkLElBQUksQ0FBQztFQUN6QjtBQUNGO0FBRUEsU0FBU2UsZUFBZUEsQ0FBQSxFQUFXO0VBQ2pDLE9BQ0VDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLGNBQWMsQ0FBQyxFQUFFQyxJQUFJLENBQUMsQ0FBQyxJQUNuQ0YsT0FBTyxDQUFDQyxHQUFHLENBQUMsbUJBQW1CLENBQUMsRUFBRUMsSUFBSSxDQUFDLENBQUMsSUFDeEMsSUFBQUMsY0FBSSxFQUFDLElBQUFDLGVBQU8sRUFBQyxDQUFDLEVBQUUsTUFBTSxDQUFDO0FBRTNCO0FBRUEsSUFBSUMsY0FBcUMsR0FBRyxJQUFJO0FBRXpDLFNBQVNDLGlCQUFpQkEsQ0FBQSxFQUFtQjtFQUNsRCxJQUFJLENBQUNELGNBQWMsRUFBRTtJQUNuQkEsY0FBYyxHQUFHLElBQUl6QixnQkFBZ0IsQ0FBQ21CLGVBQWUsQ0FBQyxDQUFDLENBQUM7RUFDMUQ7RUFDQSxPQUFPTSxjQUFjO0FBQ3ZCO0FBRU8sU0FBU0UsaUJBQWlCQSxDQUFDQyxPQUF1QixFQUFRO0VBQy9ESCxjQUFjLEdBQUdHLE9BQU87QUFDMUI7QUFFTyxTQUFTQyw0QkFBNEJBLENBQUMzQixJQUFJLEdBQUcsTUFBTSxFQUFrQjtFQUMxRSxNQUFNNEIsS0FBSyxHQUFHLElBQUlDLEdBQUcsQ0FBaUIsQ0FBQztFQUN2QyxPQUFPO0lBQ0w3QixJQUFJO0lBQ0pDLFNBQVMsRUFBRUEsQ0FBQSxLQUFNLENBQUMsQ0FBQztJQUNuQkksUUFBUSxFQUFHSCxJQUFJLElBQUswQixLQUFLLENBQUNFLEdBQUcsQ0FBQzVCLElBQUksQ0FBQyxJQUFJLElBQUk7SUFDM0NLLFNBQVMsRUFBRUEsQ0FBQ0wsSUFBSSxFQUFFTSxPQUFPLEtBQUs7TUFDNUJvQixLQUFLLENBQUNHLEdBQUcsQ0FBQzdCLElBQUksRUFBRU0sT0FBTyxDQUFDO0lBQzFCLENBQUM7SUFDREUsVUFBVSxFQUFHUixJQUFJLElBQUs7TUFDcEIwQixLQUFLLENBQUNJLE1BQU0sQ0FBQzlCLElBQUksQ0FBQztJQUNwQixDQUFDO0lBQ0RXLFNBQVMsRUFBRUEsQ0FBQSxLQUFNb0IsS0FBSyxDQUFDQyxJQUFJLENBQUNOLEtBQUssQ0FBQ08sSUFBSSxDQUFDLENBQUMsQ0FBQztJQUN6Q3BCLE1BQU0sRUFBR2IsSUFBSSxJQUFLMEIsS0FBSyxDQUFDUSxHQUFHLENBQUNsQyxJQUFJO0VBQ2xDLENBQUM7QUFDSCIsImlnbm9yZUxpc3QiOltdfQ==