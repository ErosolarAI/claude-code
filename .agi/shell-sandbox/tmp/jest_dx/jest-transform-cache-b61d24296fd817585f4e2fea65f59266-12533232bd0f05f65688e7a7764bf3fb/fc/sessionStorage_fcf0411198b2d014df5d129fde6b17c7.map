{"version":3,"names":["_nodeFs","require","_nodePath","_nodeOs","FsSessionStorage","constructor","root","ensureDir","path","mkdirSync","recursive","readFile","readFileSync","writeFile","content","writeFileSync","deleteFile","rmSync","force","listFiles","readdirSync","exists","existsSync","resolveDataRoot","process","env","trim","join","homedir","sessionStorage","getSessionStorage","setSessionStorage","storage","createInMemorySessionStorage","files","Map","get","set","delete","Array","from","keys","has"],"sources":["sessionStorage.ts"],"sourcesContent":["import { mkdirSync, readFileSync, writeFileSync, rmSync, readdirSync, existsSync } from 'node:fs';\nimport { join } from 'node:path';\nimport { homedir } from 'node:os';\n\nexport interface SessionStorage {\n  root: string;\n  ensureDir(path: string): void;\n  readFile(path: string): string | null;\n  writeFile(path: string, content: string): void;\n  deleteFile(path: string): void;\n  listFiles(path: string): string[];\n  exists(path: string): boolean;\n}\n\nclass FsSessionStorage implements SessionStorage {\n  root: string;\n\n  constructor(root: string) {\n    this.root = root;\n  }\n\n  ensureDir(path: string): void {\n    mkdirSync(path, { recursive: true });\n  }\n\n  readFile(path: string): string | null {\n    try {\n      return readFileSync(path, 'utf-8');\n    } catch {\n      return null;\n    }\n  }\n\n  writeFile(path: string, content: string): void {\n    writeFileSync(path, content, 'utf-8');\n  }\n\n  deleteFile(path: string): void {\n    try {\n      rmSync(path, { force: true });\n    } catch {\n      // ignore\n    }\n  }\n\n  listFiles(path: string): string[] {\n    try {\n      return readdirSync(path);\n    } catch {\n      return [];\n    }\n  }\n\n  exists(path: string): boolean {\n    return existsSync(path);\n  }\n}\n\nfunction resolveDataRoot(): string {\n  return (\n    process.env['AGI_DATA_DIR']?.trim() ||\n    process.env['EROSOLAR_DATA_DIR']?.trim() ||\n    join(homedir(), '.agi')\n  );\n}\n\nlet sessionStorage: SessionStorage | null = null;\n\nexport function getSessionStorage(): SessionStorage {\n  if (!sessionStorage) {\n    sessionStorage = new FsSessionStorage(resolveDataRoot());\n  }\n  return sessionStorage;\n}\n\nexport function setSessionStorage(storage: SessionStorage): void {\n  sessionStorage = storage;\n}\n\nexport function createInMemorySessionStorage(root = '/mem'): SessionStorage {\n  const files = new Map<string, string>();\n  return {\n    root,\n    ensureDir: () => {},\n    readFile: (path) => files.get(path) ?? null,\n    writeFile: (path, content) => {\n      files.set(path, content);\n    },\n    deleteFile: (path) => {\n      files.delete(path);\n    },\n    listFiles: () => Array.from(files.keys()),\n    exists: (path) => files.has(path),\n  };\n}\n"],"mappings":";;;;;;;;AAAA,IAAAA,OAAA,GAAAC,OAAA;AACA,IAAAC,SAAA,GAAAD,OAAA;AACA,IAAAE,OAAA,GAAAF,OAAA;AAYA,MAAMG,gBAAgB,CAA2B;EAG/CC,WAAWA,CAACC,IAAY,EAAE;IACxB,IAAI,CAACA,IAAI,GAAGA,IAAI;EAClB;EAEAC,SAASA,CAACC,IAAY,EAAQ;IAC5B,IAAAC,iBAAS,EAACD,IAAI,EAAE;MAAEE,SAAS,EAAE;IAAK,CAAC,CAAC;EACtC;EAEAC,QAAQA,CAACH,IAAY,EAAiB;IACpC,IAAI;MACF,OAAO,IAAAI,oBAAY,EAACJ,IAAI,EAAE,OAAO,CAAC;IACpC,CAAC,CAAC,MAAM;MACN,OAAO,IAAI;IACb;EACF;EAEAK,SAASA,CAACL,IAAY,EAAEM,OAAe,EAAQ;IAC7C,IAAAC,qBAAa,EAACP,IAAI,EAAEM,OAAO,EAAE,OAAO,CAAC;EACvC;EAEAE,UAAUA,CAACR,IAAY,EAAQ;IAC7B,IAAI;MACF,IAAAS,cAAM,EAACT,IAAI,EAAE;QAAEU,KAAK,EAAE;MAAK,CAAC,CAAC;IAC/B,CAAC,CAAC,MAAM;MACN;IAAA;EAEJ;EAEAC,SAASA,CAACX,IAAY,EAAY;IAChC,IAAI;MACF,OAAO,IAAAY,mBAAW,EAACZ,IAAI,CAAC;IAC1B,CAAC,CAAC,MAAM;MACN,OAAO,EAAE;IACX;EACF;EAEAa,MAAMA,CAACb,IAAY,EAAW;IAC5B,OAAO,IAAAc,kBAAU,EAACd,IAAI,CAAC;EACzB;AACF;AAEA,SAASe,eAAeA,CAAA,EAAW;EACjC,OACEC,OAAO,CAACC,GAAG,CAAC,cAAc,CAAC,EAAEC,IAAI,CAAC,CAAC,IACnCF,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAC,EAAEC,IAAI,CAAC,CAAC,IACxC,IAAAC,cAAI,EAAC,IAAAC,eAAO,EAAC,CAAC,EAAE,MAAM,CAAC;AAE3B;AAEA,IAAIC,cAAqC,GAAG,IAAI;AAEzC,SAASC,iBAAiBA,CAAA,EAAmB;EAClD,IAAI,CAACD,cAAc,EAAE;IACnBA,cAAc,GAAG,IAAIzB,gBAAgB,CAACmB,eAAe,CAAC,CAAC,CAAC;EAC1D;EACA,OAAOM,cAAc;AACvB;AAEO,SAASE,iBAAiBA,CAACC,OAAuB,EAAQ;EAC/DH,cAAc,GAAGG,OAAO;AAC1B;AAEO,SAASC,4BAA4BA,CAAC3B,IAAI,GAAG,MAAM,EAAkB;EAC1E,MAAM4B,KAAK,GAAG,IAAIC,GAAG,CAAiB,CAAC;EACvC,OAAO;IACL7B,IAAI;IACJC,SAAS,EAAEA,CAAA,KAAM,CAAC,CAAC;IACnBI,QAAQ,EAAGH,IAAI,IAAK0B,KAAK,CAACE,GAAG,CAAC5B,IAAI,CAAC,IAAI,IAAI;IAC3CK,SAAS,EAAEA,CAACL,IAAI,EAAEM,OAAO,KAAK;MAC5BoB,KAAK,CAACG,GAAG,CAAC7B,IAAI,EAAEM,OAAO,CAAC;IAC1B,CAAC;IACDE,UAAU,EAAGR,IAAI,IAAK;MACpB0B,KAAK,CAACI,MAAM,CAAC9B,IAAI,CAAC;IACpB,CAAC;IACDW,SAAS,EAAEA,CAAA,KAAMoB,KAAK,CAACC,IAAI,CAACN,KAAK,CAACO,IAAI,CAAC,CAAC,CAAC;IACzCpB,MAAM,EAAGb,IAAI,IAAK0B,KAAK,CAACQ,GAAG,CAAClC,IAAI;EAClC,CAAC;AACH","ignoreList":[]}