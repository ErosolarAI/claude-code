2ee74d118154c6a113528addd2be5a65
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createGrepTools = exports.createSearchTools = createSearchTools;
var _nodeFs = require("node:fs");
var _nodePath = require("node:path");
var _errors = require("../core/errors.js");
var _grepTools = require("./grepTools.js");
/**
 * Unified Search Tools - Combines file pattern matching and content search
 *
 * Provides a single, powerful Search tool that handles:
 * - File pattern matching (glob)
 * - Content search (regex/grep)
 * - Definition finding
 */

const MAX_FILE_SIZE = 5 * 1024 * 1024; // 5MB

const IGNORED_DIRS = new Set(['.git', 'node_modules', 'dist', '.next', 'build', 'coverage', '.turbo', '.cache', '__pycache__', '.pytest_cache', '.venv', 'venv', '.agi']);
const BINARY_EXTENSIONS = new Set(['.png', '.jpg', '.jpeg', '.gif', '.bmp', '.ico', '.svg', '.pdf', '.zip', '.tar', '.gz', '.7z', '.rar', '.exe', '.dll', '.so', '.dylib', '.bin', '.mp3', '.mp4', '.avi', '.mov', '.flv', '.woff', '.woff2', '.ttf', '.eot']);
const FILE_TYPE_MAP = {
  js: ['.js', '.jsx', '.mjs', '.cjs'],
  ts: ['.ts', '.tsx'],
  py: ['.py'],
  rust: ['.rs'],
  go: ['.go'],
  java: ['.java'],
  cpp: ['.cpp', '.cc', '.cxx', '.hpp', '.h'],
  c: ['.c', '.h'],
  ruby: ['.rb'],
  php: ['.php'],
  html: ['.html', '.htm'],
  css: ['.css', '.scss', '.sass', '.less'],
  json: ['.json'],
  yaml: ['.yaml', '.yml'],
  md: ['.md', '.markdown'],
  swift: ['.swift'],
  kotlin: ['.kt', '.kts']
};
function createSearchTools(workingDir) {
  const tools = [{
    name: 'Search',
    description: 'Unified search tool for files and content. Use mode="files" for glob patterns, mode="content" for regex search, mode="definition" for code definitions.',
    parameters: {
      type: 'object',
      properties: {
        pattern: {
          type: 'string',
          description: 'Search pattern - glob pattern for files mode, regex for content/definition mode'
        },
        mode: {
          type: 'string',
          enum: ['files', 'content', 'definition'],
          description: 'Search mode: "files" (glob), "content" (grep), "definition" (find functions/classes)'
        },
        path: {
          type: 'string',
          description: 'Directory to search in (defaults to working directory)'
        },
        type: {
          type: 'string',
          description: 'File type filter (js, ts, py, go, etc.) or definition type (function, class, interface)'
        },
        glob: {
          type: 'string',
          description: 'Glob pattern to filter files (e.g., "*.ts", "src/**/*.js")'
        },
        ignoreCase: {
          type: 'boolean',
          description: 'Case insensitive search (default: true for content, false for files)'
        },
        context: {
          type: 'number',
          description: 'Lines of context around matches (content mode only)'
        },
        limit: {
          type: 'number',
          description: 'Maximum results to return (default: 20)'
        }
      },
      required: ['pattern'],
      additionalProperties: true
    },
    handler: async args => {
      const pattern = args['pattern'];
      if (typeof pattern !== 'string' || !pattern.trim()) {
        return 'Error: pattern is required';
      }
      const mode = args['mode'] || inferMode(pattern);
      const pathArg = args['path'];
      const fileType = args['type'];
      const globPattern = args['glob'];
      const ignoreCase = args['ignoreCase'] === true || args['ignoreCase'] !== false && mode === 'content';
      const contextLines = typeof args['context'] === 'number' ? args['context'] : 0;
      const limit = typeof args['limit'] === 'number' ? Math.min(args['limit'], 100) : 20;
      const searchPath = pathArg && typeof pathArg === 'string' ? resolvePath(workingDir, pathArg) : workingDir;
      try {
        switch (mode) {
          case 'files':
            return searchFiles(searchPath, workingDir, pattern, {
              limit
            });
          case 'definition':
            return searchDefinitions(searchPath, workingDir, pattern, {
              definitionType: typeof fileType === 'string' ? fileType : 'any',
              limit
            });
          case 'content':
          default:
            return searchContent(searchPath, workingDir, pattern, {
              ignoreCase,
              fileType: typeof fileType === 'string' ? fileType : undefined,
              globPattern: typeof globPattern === 'string' ? globPattern : undefined,
              contextLines,
              limit
            });
        }
      } catch (error) {
        return (0, _errors.buildError)('search', error, {
          pattern: String(pattern),
          mode: String(mode)
        });
      }
    }
  }];

  // Add grep-style search as a complementary tool for backward compatibility
  tools.push(...(0, _grepTools.createGrepTools)(workingDir));
  return tools;
}
function inferMode(pattern) {
  // Glob patterns
  if (pattern.includes('*') || pattern.includes('?') || pattern.includes('[')) {
    if (pattern.includes('/') || pattern.startsWith('*.')) {
      return 'files';
    }
  }
  return 'content';
}
function resolvePath(workingDir, path) {
  const normalized = path.trim();
  return normalized.startsWith('/') ? normalized : (0, _nodePath.join)(workingDir, normalized);
}

// ============================================================================
// FILES MODE - Glob pattern matching
// ============================================================================

function searchFiles(searchPath, workingDir, pattern, options) {
  const regex = globToRegex(pattern);
  const matches = [];
  function walk(dir) {
    if (matches.length >= options.limit * 2) return;
    try {
      const entries = (0, _nodeFs.readdirSync)(dir, {
        withFileTypes: true
      });
      for (const entry of entries) {
        if (IGNORED_DIRS.has(entry.name)) continue;
        const fullPath = (0, _nodePath.join)(dir, entry.name);
        if (entry.isDirectory()) {
          walk(fullPath);
        } else if (regex.test(fullPath)) {
          try {
            const stat = (0, _nodeFs.statSync)(fullPath);
            matches.push({
              path: fullPath,
              mtime: stat.mtimeMs
            });
          } catch {/* skip */}
        }
      }
    } catch {/* skip */}
  }
  walk(searchPath);

  // Sort by modification time (newest first)
  matches.sort((a, b) => b.mtime - a.mtime);
  const limited = matches.slice(0, options.limit);
  if (limited.length === 0) {
    return `No files matching: ${pattern}`;
  }
  const relativePaths = limited.map(m => {
    const rel = (0, _nodePath.relative)(workingDir, m.path);
    return rel && !rel.startsWith('..') ? rel : m.path;
  });
  let result = `${matches.length} file(s) matching "${pattern}"`;
  if (matches.length > options.limit) {
    result += ` (showing ${options.limit})`;
  }
  result += `:\n${relativePaths.join('\n')}`;
  return result;
}
function globToRegex(pattern) {
  const escaped = pattern.replace(/[.+^${}()|[\]\\]/g, '\\$&').replace(/\*\*/g, '<!GLOBSTAR!>').replace(/\*/g, '[^/]*').replace(/<!GLOBSTAR!>/g, '.*').replace(/\?/g, '.');
  return new RegExp(`${escaped}$`);
}

// ============================================================================
// CONTENT MODE - Regex search in file contents
// ============================================================================

function searchContent(searchPath, workingDir, pattern, options) {
  const flags = options.ignoreCase ? 'gi' : 'g';
  const regex = new RegExp(pattern, flags);
  const matches = [];
  const maxScan = options.limit * 3;
  function walk(dir) {
    if (matches.length >= maxScan) return;
    try {
      const entries = (0, _nodeFs.readdirSync)(dir, {
        withFileTypes: true
      });
      for (const entry of entries) {
        if (IGNORED_DIRS.has(entry.name)) continue;
        if (matches.length >= maxScan) break;
        const fullPath = (0, _nodePath.join)(dir, entry.name);
        if (entry.isDirectory()) {
          walk(fullPath);
        } else {
          searchFile(fullPath);
        }
      }
    } catch {/* skip */}
  }
  function searchFile(filePath) {
    // Filter by type
    if (options.fileType && !matchesFileType(filePath, options.fileType)) return;
    if (options.globPattern && !matchesGlob(filePath, options.globPattern)) return;
    if (isBinary(filePath)) return;
    try {
      const stat = (0, _nodeFs.statSync)(filePath);
      if (stat.size > MAX_FILE_SIZE) return;
      const content = (0, _nodeFs.readFileSync)(filePath, 'utf-8');
      const lines = content.split('\n');
      for (let i = 0; i < lines.length && matches.length < maxScan; i++) {
        if (regex.test(lines[i])) {
          matches.push({
            file: filePath,
            line: i + 1,
            content: lines[i].trim()
          });
        }
        regex.lastIndex = 0; // Reset for next test
      }
    } catch {/* skip */}
  }
  walk(searchPath);
  if (matches.length === 0) {
    return `No matches for: ${pattern}`;
  }
  const limited = matches.slice(0, options.limit);
  const lines = [];
  for (const m of limited) {
    const relPath = (0, _nodePath.relative)(workingDir, m.file);
    const displayPath = relPath && !relPath.startsWith('..') ? relPath : m.file;
    lines.push(`${displayPath}:${m.line}: ${m.content}`);
  }
  let result = lines.join('\n');
  if (matches.length > options.limit) {
    result += `\n\n[${matches.length - options.limit} more matches, use limit parameter to see more]`;
  }
  return result;
}

// ============================================================================
// DEFINITION MODE - Find code definitions
// ============================================================================

function searchDefinitions(searchPath, workingDir, name, options) {
  const patterns = {
    function: `(function\\s+${name}|const\\s+${name}\\s*=.*=>|${name}\\s*\\([^)]*\\)\\s*\\{)`,
    class: `class\\s+${name}`,
    interface: `interface\\s+${name}`,
    type: `type\\s+${name}`,
    const: `const\\s+${name}`,
    any: `(function\\s+${name}|class\\s+${name}|interface\\s+${name}|type\\s+${name}|const\\s+${name})`
  };
  const patternStr = patterns[options.definitionType] || patterns['any'];
  const regex = new RegExp(patternStr, 'gi');
  const matches = [];
  function walk(dir) {
    if (matches.length >= options.limit * 2) return;
    try {
      const entries = (0, _nodeFs.readdirSync)(dir, {
        withFileTypes: true
      });
      for (const entry of entries) {
        if (IGNORED_DIRS.has(entry.name)) continue;
        if (matches.length >= options.limit * 2) break;
        const fullPath = (0, _nodePath.join)(dir, entry.name);
        if (entry.isDirectory()) {
          walk(fullPath);
        } else if (isCodeFile(fullPath)) {
          searchFile(fullPath);
        }
      }
    } catch {/* skip */}
  }
  function searchFile(filePath) {
    try {
      const stat = (0, _nodeFs.statSync)(filePath);
      if (stat.size > MAX_FILE_SIZE) return;
      const content = (0, _nodeFs.readFileSync)(filePath, 'utf-8');
      const lines = content.split('\n');
      for (let i = 0; i < lines.length && matches.length < options.limit * 2; i++) {
        if (regex.test(lines[i])) {
          matches.push({
            file: filePath,
            line: i + 1,
            content: lines[i].trim()
          });
        }
        regex.lastIndex = 0;
      }
    } catch {/* skip */}
  }
  walk(searchPath);
  if (matches.length === 0) {
    return `No definitions found for: ${name}`;
  }
  const limited = matches.slice(0, options.limit);
  const lines = [];
  for (const m of limited) {
    const relPath = (0, _nodePath.relative)(workingDir, m.file);
    const displayPath = relPath && !relPath.startsWith('..') ? relPath : m.file;
    lines.push(`${displayPath}:${m.line}: ${m.content}`);
  }
  return lines.join('\n');
}

// ============================================================================
// Utility functions
// ============================================================================

function matchesFileType(filePath, fileType) {
  const ext = (0, _nodePath.extname)(filePath).toLowerCase();
  const extensions = FILE_TYPE_MAP[fileType.toLowerCase()];
  return extensions ? extensions.includes(ext) : false;
}
function matchesGlob(filePath, pattern) {
  const regex = globToRegex(pattern);
  return regex.test(filePath);
}
function isBinary(filePath) {
  return BINARY_EXTENSIONS.has((0, _nodePath.extname)(filePath).toLowerCase());
}
function isCodeFile(filePath) {
  const ext = (0, _nodePath.extname)(filePath).toLowerCase();
  const codeExts = ['.ts', '.tsx', '.js', '.jsx', '.py', '.go', '.rs', '.java', '.rb', '.swift', '.kt'];
  return codeExts.includes(ext);
}

// Legacy exports for backward compatibility
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbm9kZUZzIiwicmVxdWlyZSIsIl9ub2RlUGF0aCIsIl9lcnJvcnMiLCJfZ3JlcFRvb2xzIiwiTUFYX0ZJTEVfU0laRSIsIklHTk9SRURfRElSUyIsIlNldCIsIkJJTkFSWV9FWFRFTlNJT05TIiwiRklMRV9UWVBFX01BUCIsImpzIiwidHMiLCJweSIsInJ1c3QiLCJnbyIsImphdmEiLCJjcHAiLCJjIiwicnVieSIsInBocCIsImh0bWwiLCJjc3MiLCJqc29uIiwieWFtbCIsIm1kIiwic3dpZnQiLCJrb3RsaW4iLCJjcmVhdGVTZWFyY2hUb29scyIsIndvcmtpbmdEaXIiLCJ0b29scyIsIm5hbWUiLCJkZXNjcmlwdGlvbiIsInBhcmFtZXRlcnMiLCJ0eXBlIiwicHJvcGVydGllcyIsInBhdHRlcm4iLCJtb2RlIiwiZW51bSIsInBhdGgiLCJnbG9iIiwiaWdub3JlQ2FzZSIsImNvbnRleHQiLCJsaW1pdCIsInJlcXVpcmVkIiwiYWRkaXRpb25hbFByb3BlcnRpZXMiLCJoYW5kbGVyIiwiYXJncyIsInRyaW0iLCJpbmZlck1vZGUiLCJwYXRoQXJnIiwiZmlsZVR5cGUiLCJnbG9iUGF0dGVybiIsImNvbnRleHRMaW5lcyIsIk1hdGgiLCJtaW4iLCJzZWFyY2hQYXRoIiwicmVzb2x2ZVBhdGgiLCJzZWFyY2hGaWxlcyIsInNlYXJjaERlZmluaXRpb25zIiwiZGVmaW5pdGlvblR5cGUiLCJzZWFyY2hDb250ZW50IiwidW5kZWZpbmVkIiwiZXJyb3IiLCJidWlsZEVycm9yIiwiU3RyaW5nIiwicHVzaCIsImNyZWF0ZUdyZXBUb29scyIsImluY2x1ZGVzIiwic3RhcnRzV2l0aCIsIm5vcm1hbGl6ZWQiLCJqb2luIiwib3B0aW9ucyIsInJlZ2V4IiwiZ2xvYlRvUmVnZXgiLCJtYXRjaGVzIiwid2FsayIsImRpciIsImxlbmd0aCIsImVudHJpZXMiLCJyZWFkZGlyU3luYyIsIndpdGhGaWxlVHlwZXMiLCJlbnRyeSIsImhhcyIsImZ1bGxQYXRoIiwiaXNEaXJlY3RvcnkiLCJ0ZXN0Iiwic3RhdCIsInN0YXRTeW5jIiwibXRpbWUiLCJtdGltZU1zIiwic29ydCIsImEiLCJiIiwibGltaXRlZCIsInNsaWNlIiwicmVsYXRpdmVQYXRocyIsIm1hcCIsIm0iLCJyZWwiLCJyZWxhdGl2ZSIsInJlc3VsdCIsImVzY2FwZWQiLCJyZXBsYWNlIiwiUmVnRXhwIiwiZmxhZ3MiLCJtYXhTY2FuIiwic2VhcmNoRmlsZSIsImZpbGVQYXRoIiwibWF0Y2hlc0ZpbGVUeXBlIiwibWF0Y2hlc0dsb2IiLCJpc0JpbmFyeSIsInNpemUiLCJjb250ZW50IiwicmVhZEZpbGVTeW5jIiwibGluZXMiLCJzcGxpdCIsImkiLCJmaWxlIiwibGluZSIsImxhc3RJbmRleCIsInJlbFBhdGgiLCJkaXNwbGF5UGF0aCIsInBhdHRlcm5zIiwiZnVuY3Rpb24iLCJjbGFzcyIsImludGVyZmFjZSIsImNvbnN0IiwiYW55IiwicGF0dGVyblN0ciIsImlzQ29kZUZpbGUiLCJleHQiLCJleHRuYW1lIiwidG9Mb3dlckNhc2UiLCJleHRlbnNpb25zIiwiY29kZUV4dHMiXSwic291cmNlcyI6WyJzZWFyY2hUb29scy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFVuaWZpZWQgU2VhcmNoIFRvb2xzIC0gQ29tYmluZXMgZmlsZSBwYXR0ZXJuIG1hdGNoaW5nIGFuZCBjb250ZW50IHNlYXJjaFxuICpcbiAqIFByb3ZpZGVzIGEgc2luZ2xlLCBwb3dlcmZ1bCBTZWFyY2ggdG9vbCB0aGF0IGhhbmRsZXM6XG4gKiAtIEZpbGUgcGF0dGVybiBtYXRjaGluZyAoZ2xvYilcbiAqIC0gQ29udGVudCBzZWFyY2ggKHJlZ2V4L2dyZXApXG4gKiAtIERlZmluaXRpb24gZmluZGluZ1xuICovXG5cbmltcG9ydCB7IHJlYWRGaWxlU3luYywgcmVhZGRpclN5bmMsIHN0YXRTeW5jIH0gZnJvbSAnbm9kZTpmcyc7XG5pbXBvcnQgeyBqb2luLCByZWxhdGl2ZSwgZXh0bmFtZSB9IGZyb20gJ25vZGU6cGF0aCc7XG5pbXBvcnQgdHlwZSB7IFRvb2xEZWZpbml0aW9uIH0gZnJvbSAnLi4vY29yZS90b29sUnVudGltZS5qcyc7XG5pbXBvcnQgeyBidWlsZEVycm9yIH0gZnJvbSAnLi4vY29yZS9lcnJvcnMuanMnO1xuaW1wb3J0IHsgY3JlYXRlR3JlcFRvb2xzIH0gZnJvbSAnLi9ncmVwVG9vbHMuanMnO1xuXG5jb25zdCBNQVhfRklMRV9TSVpFID0gNSAqIDEwMjQgKiAxMDI0OyAvLyA1TUJcblxuY29uc3QgSUdOT1JFRF9ESVJTID0gbmV3IFNldChbXG4gICcuZ2l0JywgJ25vZGVfbW9kdWxlcycsICdkaXN0JywgJy5uZXh0JywgJ2J1aWxkJywgJ2NvdmVyYWdlJyxcbiAgJy50dXJibycsICcuY2FjaGUnLCAnX19weWNhY2hlX18nLCAnLnB5dGVzdF9jYWNoZScsICcudmVudicsICd2ZW52JyxcbiAgJy5hZ2knLFxuXSk7XG5cbmNvbnN0IEJJTkFSWV9FWFRFTlNJT05TID0gbmV3IFNldChbXG4gICcucG5nJywgJy5qcGcnLCAnLmpwZWcnLCAnLmdpZicsICcuYm1wJywgJy5pY28nLCAnLnN2ZycsXG4gICcucGRmJywgJy56aXAnLCAnLnRhcicsICcuZ3onLCAnLjd6JywgJy5yYXInLFxuICAnLmV4ZScsICcuZGxsJywgJy5zbycsICcuZHlsaWInLCAnLmJpbicsXG4gICcubXAzJywgJy5tcDQnLCAnLmF2aScsICcubW92JywgJy5mbHYnLFxuICAnLndvZmYnLCAnLndvZmYyJywgJy50dGYnLCAnLmVvdCcsXG5dKTtcblxuY29uc3QgRklMRV9UWVBFX01BUDogUmVjb3JkPHN0cmluZywgc3RyaW5nW10+ID0ge1xuICBqczogWycuanMnLCAnLmpzeCcsICcubWpzJywgJy5janMnXSxcbiAgdHM6IFsnLnRzJywgJy50c3gnXSxcbiAgcHk6IFsnLnB5J10sXG4gIHJ1c3Q6IFsnLnJzJ10sXG4gIGdvOiBbJy5nbyddLFxuICBqYXZhOiBbJy5qYXZhJ10sXG4gIGNwcDogWycuY3BwJywgJy5jYycsICcuY3h4JywgJy5ocHAnLCAnLmgnXSxcbiAgYzogWycuYycsICcuaCddLFxuICBydWJ5OiBbJy5yYiddLFxuICBwaHA6IFsnLnBocCddLFxuICBodG1sOiBbJy5odG1sJywgJy5odG0nXSxcbiAgY3NzOiBbJy5jc3MnLCAnLnNjc3MnLCAnLnNhc3MnLCAnLmxlc3MnXSxcbiAganNvbjogWycuanNvbiddLFxuICB5YW1sOiBbJy55YW1sJywgJy55bWwnXSxcbiAgbWQ6IFsnLm1kJywgJy5tYXJrZG93biddLFxuICBzd2lmdDogWycuc3dpZnQnXSxcbiAga290bGluOiBbJy5rdCcsICcua3RzJ10sXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlU2VhcmNoVG9vbHMod29ya2luZ0Rpcjogc3RyaW5nKTogVG9vbERlZmluaXRpb25bXSB7XG4gIGNvbnN0IHRvb2xzOiBUb29sRGVmaW5pdGlvbltdID0gW1xuICAgIHtcbiAgICAgIG5hbWU6ICdTZWFyY2gnLFxuICAgICAgZGVzY3JpcHRpb246ICdVbmlmaWVkIHNlYXJjaCB0b29sIGZvciBmaWxlcyBhbmQgY29udGVudC4gVXNlIG1vZGU9XCJmaWxlc1wiIGZvciBnbG9iIHBhdHRlcm5zLCBtb2RlPVwiY29udGVudFwiIGZvciByZWdleCBzZWFyY2gsIG1vZGU9XCJkZWZpbml0aW9uXCIgZm9yIGNvZGUgZGVmaW5pdGlvbnMuJyxcbiAgICAgIHBhcmFtZXRlcnM6IHtcbiAgICAgICAgdHlwZTogJ29iamVjdCcsXG4gICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICBwYXR0ZXJuOiB7XG4gICAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnU2VhcmNoIHBhdHRlcm4gLSBnbG9iIHBhdHRlcm4gZm9yIGZpbGVzIG1vZGUsIHJlZ2V4IGZvciBjb250ZW50L2RlZmluaXRpb24gbW9kZScsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBtb2RlOiB7XG4gICAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgIGVudW06IFsnZmlsZXMnLCAnY29udGVudCcsICdkZWZpbml0aW9uJ10sXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1NlYXJjaCBtb2RlOiBcImZpbGVzXCIgKGdsb2IpLCBcImNvbnRlbnRcIiAoZ3JlcCksIFwiZGVmaW5pdGlvblwiIChmaW5kIGZ1bmN0aW9ucy9jbGFzc2VzKScsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBwYXRoOiB7XG4gICAgICAgICAgICB0eXBlOiAnc3RyaW5nJyxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRGlyZWN0b3J5IHRvIHNlYXJjaCBpbiAoZGVmYXVsdHMgdG8gd29ya2luZyBkaXJlY3RvcnkpJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHR5cGU6IHtcbiAgICAgICAgICAgIHR5cGU6ICdzdHJpbmcnLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdGaWxlIHR5cGUgZmlsdGVyIChqcywgdHMsIHB5LCBnbywgZXRjLikgb3IgZGVmaW5pdGlvbiB0eXBlIChmdW5jdGlvbiwgY2xhc3MsIGludGVyZmFjZSknLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZ2xvYjoge1xuICAgICAgICAgICAgdHlwZTogJ3N0cmluZycsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0dsb2IgcGF0dGVybiB0byBmaWx0ZXIgZmlsZXMgKGUuZy4sIFwiKi50c1wiLCBcInNyYy8qKi8qLmpzXCIpJyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGlnbm9yZUNhc2U6IHtcbiAgICAgICAgICAgIHR5cGU6ICdib29sZWFuJyxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnQ2FzZSBpbnNlbnNpdGl2ZSBzZWFyY2ggKGRlZmF1bHQ6IHRydWUgZm9yIGNvbnRlbnQsIGZhbHNlIGZvciBmaWxlcyknLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgY29udGV4dDoge1xuICAgICAgICAgICAgdHlwZTogJ251bWJlcicsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0xpbmVzIG9mIGNvbnRleHQgYXJvdW5kIG1hdGNoZXMgKGNvbnRlbnQgbW9kZSBvbmx5KScsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBsaW1pdDoge1xuICAgICAgICAgICAgdHlwZTogJ251bWJlcicsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ01heGltdW0gcmVzdWx0cyB0byByZXR1cm4gKGRlZmF1bHQ6IDIwKScsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgcmVxdWlyZWQ6IFsncGF0dGVybiddLFxuICAgICAgICBhZGRpdGlvbmFsUHJvcGVydGllczogdHJ1ZSxcbiAgICAgIH0sXG4gICAgICBoYW5kbGVyOiBhc3luYyAoYXJncykgPT4ge1xuICAgICAgICBjb25zdCBwYXR0ZXJuID0gYXJnc1sncGF0dGVybiddO1xuICAgICAgICBpZiAodHlwZW9mIHBhdHRlcm4gIT09ICdzdHJpbmcnIHx8ICFwYXR0ZXJuLnRyaW0oKSkge1xuICAgICAgICAgIHJldHVybiAnRXJyb3I6IHBhdHRlcm4gaXMgcmVxdWlyZWQnO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbW9kZSA9IChhcmdzWydtb2RlJ10gYXMgc3RyaW5nKSB8fCBpbmZlck1vZGUocGF0dGVybik7XG4gICAgICAgIGNvbnN0IHBhdGhBcmcgPSBhcmdzWydwYXRoJ107XG4gICAgICAgIGNvbnN0IGZpbGVUeXBlID0gYXJnc1sndHlwZSddO1xuICAgICAgICBjb25zdCBnbG9iUGF0dGVybiA9IGFyZ3NbJ2dsb2InXTtcbiAgICAgICAgY29uc3QgaWdub3JlQ2FzZSA9IGFyZ3NbJ2lnbm9yZUNhc2UnXSA9PT0gdHJ1ZSB8fCAoYXJnc1snaWdub3JlQ2FzZSddICE9PSBmYWxzZSAmJiBtb2RlID09PSAnY29udGVudCcpO1xuICAgICAgICBjb25zdCBjb250ZXh0TGluZXMgPSB0eXBlb2YgYXJnc1snY29udGV4dCddID09PSAnbnVtYmVyJyA/IGFyZ3NbJ2NvbnRleHQnXSA6IDA7XG4gICAgICAgIGNvbnN0IGxpbWl0ID0gdHlwZW9mIGFyZ3NbJ2xpbWl0J10gPT09ICdudW1iZXInID8gTWF0aC5taW4oYXJnc1snbGltaXQnXSwgMTAwKSA6IDIwO1xuXG4gICAgICAgIGNvbnN0IHNlYXJjaFBhdGggPSBwYXRoQXJnICYmIHR5cGVvZiBwYXRoQXJnID09PSAnc3RyaW5nJ1xuICAgICAgICAgID8gcmVzb2x2ZVBhdGgod29ya2luZ0RpciwgcGF0aEFyZylcbiAgICAgICAgICA6IHdvcmtpbmdEaXI7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBzd2l0Y2ggKG1vZGUpIHtcbiAgICAgICAgICAgIGNhc2UgJ2ZpbGVzJzpcbiAgICAgICAgICAgICAgcmV0dXJuIHNlYXJjaEZpbGVzKHNlYXJjaFBhdGgsIHdvcmtpbmdEaXIsIHBhdHRlcm4sIHsgbGltaXQgfSk7XG5cbiAgICAgICAgICAgIGNhc2UgJ2RlZmluaXRpb24nOlxuICAgICAgICAgICAgICByZXR1cm4gc2VhcmNoRGVmaW5pdGlvbnMoc2VhcmNoUGF0aCwgd29ya2luZ0RpciwgcGF0dGVybiwge1xuICAgICAgICAgICAgICAgIGRlZmluaXRpb25UeXBlOiB0eXBlb2YgZmlsZVR5cGUgPT09ICdzdHJpbmcnID8gZmlsZVR5cGUgOiAnYW55JyxcbiAgICAgICAgICAgICAgICBsaW1pdCxcbiAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGNhc2UgJ2NvbnRlbnQnOlxuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgcmV0dXJuIHNlYXJjaENvbnRlbnQoc2VhcmNoUGF0aCwgd29ya2luZ0RpciwgcGF0dGVybiwge1xuICAgICAgICAgICAgICAgIGlnbm9yZUNhc2UsXG4gICAgICAgICAgICAgICAgZmlsZVR5cGU6IHR5cGVvZiBmaWxlVHlwZSA9PT0gJ3N0cmluZycgPyBmaWxlVHlwZSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgICAgICBnbG9iUGF0dGVybjogdHlwZW9mIGdsb2JQYXR0ZXJuID09PSAnc3RyaW5nJyA/IGdsb2JQYXR0ZXJuIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgIGNvbnRleHRMaW5lcyxcbiAgICAgICAgICAgICAgICBsaW1pdCxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIHJldHVybiBidWlsZEVycm9yKCdzZWFyY2gnLCBlcnJvciwgeyBwYXR0ZXJuOiBTdHJpbmcocGF0dGVybiksIG1vZGU6IFN0cmluZyhtb2RlKSB9KTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICB9LFxuICBdO1xuXG4gIC8vIEFkZCBncmVwLXN0eWxlIHNlYXJjaCBhcyBhIGNvbXBsZW1lbnRhcnkgdG9vbCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eVxuICB0b29scy5wdXNoKC4uLmNyZWF0ZUdyZXBUb29scyh3b3JraW5nRGlyKSk7XG5cbiAgcmV0dXJuIHRvb2xzO1xufVxuXG5mdW5jdGlvbiBpbmZlck1vZGUocGF0dGVybjogc3RyaW5nKTogc3RyaW5nIHtcbiAgLy8gR2xvYiBwYXR0ZXJuc1xuICBpZiAocGF0dGVybi5pbmNsdWRlcygnKicpIHx8IHBhdHRlcm4uaW5jbHVkZXMoJz8nKSB8fCBwYXR0ZXJuLmluY2x1ZGVzKCdbJykpIHtcbiAgICBpZiAocGF0dGVybi5pbmNsdWRlcygnLycpIHx8IHBhdHRlcm4uc3RhcnRzV2l0aCgnKi4nKSkge1xuICAgICAgcmV0dXJuICdmaWxlcyc7XG4gICAgfVxuICB9XG4gIHJldHVybiAnY29udGVudCc7XG59XG5cbmZ1bmN0aW9uIHJlc29sdmVQYXRoKHdvcmtpbmdEaXI6IHN0cmluZywgcGF0aDogc3RyaW5nKTogc3RyaW5nIHtcbiAgY29uc3Qgbm9ybWFsaXplZCA9IHBhdGgudHJpbSgpO1xuICByZXR1cm4gbm9ybWFsaXplZC5zdGFydHNXaXRoKCcvJykgPyBub3JtYWxpemVkIDogam9pbih3b3JraW5nRGlyLCBub3JtYWxpemVkKTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gRklMRVMgTU9ERSAtIEdsb2IgcGF0dGVybiBtYXRjaGluZ1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBzZWFyY2hGaWxlcyhcbiAgc2VhcmNoUGF0aDogc3RyaW5nLFxuICB3b3JraW5nRGlyOiBzdHJpbmcsXG4gIHBhdHRlcm46IHN0cmluZyxcbiAgb3B0aW9uczogeyBsaW1pdDogbnVtYmVyIH1cbik6IHN0cmluZyB7XG4gIGNvbnN0IHJlZ2V4ID0gZ2xvYlRvUmVnZXgocGF0dGVybik7XG4gIGNvbnN0IG1hdGNoZXM6IEFycmF5PHsgcGF0aDogc3RyaW5nOyBtdGltZTogbnVtYmVyIH0+ID0gW107XG5cbiAgZnVuY3Rpb24gd2FsayhkaXI6IHN0cmluZykge1xuICAgIGlmIChtYXRjaGVzLmxlbmd0aCA+PSBvcHRpb25zLmxpbWl0ICogMikgcmV0dXJuO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBlbnRyaWVzID0gcmVhZGRpclN5bmMoZGlyLCB7IHdpdGhGaWxlVHlwZXM6IHRydWUgfSk7XG4gICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGVudHJpZXMpIHtcbiAgICAgICAgaWYgKElHTk9SRURfRElSUy5oYXMoZW50cnkubmFtZSkpIGNvbnRpbnVlO1xuICAgICAgICBjb25zdCBmdWxsUGF0aCA9IGpvaW4oZGlyLCBlbnRyeS5uYW1lKTtcbiAgICAgICAgaWYgKGVudHJ5LmlzRGlyZWN0b3J5KCkpIHtcbiAgICAgICAgICB3YWxrKGZ1bGxQYXRoKTtcbiAgICAgICAgfSBlbHNlIGlmIChyZWdleC50ZXN0KGZ1bGxQYXRoKSkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBzdGF0ID0gc3RhdFN5bmMoZnVsbFBhdGgpO1xuICAgICAgICAgICAgbWF0Y2hlcy5wdXNoKHsgcGF0aDogZnVsbFBhdGgsIG10aW1lOiBzdGF0Lm10aW1lTXMgfSk7XG4gICAgICAgICAgfSBjYXRjaCB7IC8qIHNraXAgKi8gfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCB7IC8qIHNraXAgKi8gfVxuICB9XG5cbiAgd2FsayhzZWFyY2hQYXRoKTtcblxuICAvLyBTb3J0IGJ5IG1vZGlmaWNhdGlvbiB0aW1lIChuZXdlc3QgZmlyc3QpXG4gIG1hdGNoZXMuc29ydCgoYSwgYikgPT4gYi5tdGltZSAtIGEubXRpbWUpO1xuXG4gIGNvbnN0IGxpbWl0ZWQgPSBtYXRjaGVzLnNsaWNlKDAsIG9wdGlvbnMubGltaXQpO1xuICBpZiAobGltaXRlZC5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gYE5vIGZpbGVzIG1hdGNoaW5nOiAke3BhdHRlcm59YDtcbiAgfVxuXG4gIGNvbnN0IHJlbGF0aXZlUGF0aHMgPSBsaW1pdGVkLm1hcChtID0+IHtcbiAgICBjb25zdCByZWwgPSByZWxhdGl2ZSh3b3JraW5nRGlyLCBtLnBhdGgpO1xuICAgIHJldHVybiByZWwgJiYgIXJlbC5zdGFydHNXaXRoKCcuLicpID8gcmVsIDogbS5wYXRoO1xuICB9KTtcblxuICBsZXQgcmVzdWx0ID0gYCR7bWF0Y2hlcy5sZW5ndGh9IGZpbGUocykgbWF0Y2hpbmcgXCIke3BhdHRlcm59XCJgO1xuICBpZiAobWF0Y2hlcy5sZW5ndGggPiBvcHRpb25zLmxpbWl0KSB7XG4gICAgcmVzdWx0ICs9IGAgKHNob3dpbmcgJHtvcHRpb25zLmxpbWl0fSlgO1xuICB9XG4gIHJlc3VsdCArPSBgOlxcbiR7cmVsYXRpdmVQYXRocy5qb2luKCdcXG4nKX1gO1xuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIGdsb2JUb1JlZ2V4KHBhdHRlcm46IHN0cmluZyk6IFJlZ0V4cCB7XG4gIGNvbnN0IGVzY2FwZWQgPSBwYXR0ZXJuXG4gICAgLnJlcGxhY2UoL1suK14ke30oKXxbXFxdXFxcXF0vZywgJ1xcXFwkJicpXG4gICAgLnJlcGxhY2UoL1xcKlxcKi9nLCAnPCFHTE9CU1RBUiE+JylcbiAgICAucmVwbGFjZSgvXFwqL2csICdbXi9dKicpXG4gICAgLnJlcGxhY2UoLzwhR0xPQlNUQVIhPi9nLCAnLionKVxuICAgIC5yZXBsYWNlKC9cXD8vZywgJy4nKTtcbiAgcmV0dXJuIG5ldyBSZWdFeHAoYCR7ZXNjYXBlZH0kYCk7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIENPTlRFTlQgTU9ERSAtIFJlZ2V4IHNlYXJjaCBpbiBmaWxlIGNvbnRlbnRzXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmludGVyZmFjZSBDb250ZW50TWF0Y2gge1xuICBmaWxlOiBzdHJpbmc7XG4gIGxpbmU6IG51bWJlcjtcbiAgY29udGVudDogc3RyaW5nO1xufVxuXG5mdW5jdGlvbiBzZWFyY2hDb250ZW50KFxuICBzZWFyY2hQYXRoOiBzdHJpbmcsXG4gIHdvcmtpbmdEaXI6IHN0cmluZyxcbiAgcGF0dGVybjogc3RyaW5nLFxuICBvcHRpb25zOiB7XG4gICAgaWdub3JlQ2FzZTogYm9vbGVhbjtcbiAgICBmaWxlVHlwZT86IHN0cmluZztcbiAgICBnbG9iUGF0dGVybj86IHN0cmluZztcbiAgICBjb250ZXh0TGluZXM6IG51bWJlcjtcbiAgICBsaW1pdDogbnVtYmVyO1xuICB9XG4pOiBzdHJpbmcge1xuICBjb25zdCBmbGFncyA9IG9wdGlvbnMuaWdub3JlQ2FzZSA/ICdnaScgOiAnZyc7XG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChwYXR0ZXJuLCBmbGFncyk7XG4gIGNvbnN0IG1hdGNoZXM6IENvbnRlbnRNYXRjaFtdID0gW107XG4gIGNvbnN0IG1heFNjYW4gPSBvcHRpb25zLmxpbWl0ICogMztcblxuICBmdW5jdGlvbiB3YWxrKGRpcjogc3RyaW5nKSB7XG4gICAgaWYgKG1hdGNoZXMubGVuZ3RoID49IG1heFNjYW4pIHJldHVybjtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZW50cmllcyA9IHJlYWRkaXJTeW5jKGRpciwgeyB3aXRoRmlsZVR5cGVzOiB0cnVlIH0pO1xuICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBlbnRyaWVzKSB7XG4gICAgICAgIGlmIChJR05PUkVEX0RJUlMuaGFzKGVudHJ5Lm5hbWUpKSBjb250aW51ZTtcbiAgICAgICAgaWYgKG1hdGNoZXMubGVuZ3RoID49IG1heFNjYW4pIGJyZWFrO1xuICAgICAgICBjb25zdCBmdWxsUGF0aCA9IGpvaW4oZGlyLCBlbnRyeS5uYW1lKTtcbiAgICAgICAgaWYgKGVudHJ5LmlzRGlyZWN0b3J5KCkpIHtcbiAgICAgICAgICB3YWxrKGZ1bGxQYXRoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZWFyY2hGaWxlKGZ1bGxQYXRoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggeyAvKiBza2lwICovIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHNlYXJjaEZpbGUoZmlsZVBhdGg6IHN0cmluZykge1xuICAgIC8vIEZpbHRlciBieSB0eXBlXG4gICAgaWYgKG9wdGlvbnMuZmlsZVR5cGUgJiYgIW1hdGNoZXNGaWxlVHlwZShmaWxlUGF0aCwgb3B0aW9ucy5maWxlVHlwZSkpIHJldHVybjtcbiAgICBpZiAob3B0aW9ucy5nbG9iUGF0dGVybiAmJiAhbWF0Y2hlc0dsb2IoZmlsZVBhdGgsIG9wdGlvbnMuZ2xvYlBhdHRlcm4pKSByZXR1cm47XG4gICAgaWYgKGlzQmluYXJ5KGZpbGVQYXRoKSkgcmV0dXJuO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN0YXQgPSBzdGF0U3luYyhmaWxlUGF0aCk7XG4gICAgICBpZiAoc3RhdC5zaXplID4gTUFYX0ZJTEVfU0laRSkgcmV0dXJuO1xuXG4gICAgICBjb25zdCBjb250ZW50ID0gcmVhZEZpbGVTeW5jKGZpbGVQYXRoLCAndXRmLTgnKTtcbiAgICAgIGNvbnN0IGxpbmVzID0gY29udGVudC5zcGxpdCgnXFxuJyk7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoICYmIG1hdGNoZXMubGVuZ3RoIDwgbWF4U2NhbjsgaSsrKSB7XG4gICAgICAgIGlmIChyZWdleC50ZXN0KGxpbmVzW2ldISkpIHtcbiAgICAgICAgICBtYXRjaGVzLnB1c2goe1xuICAgICAgICAgICAgZmlsZTogZmlsZVBhdGgsXG4gICAgICAgICAgICBsaW5lOiBpICsgMSxcbiAgICAgICAgICAgIGNvbnRlbnQ6IGxpbmVzW2ldIS50cmltKCksXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmVnZXgubGFzdEluZGV4ID0gMDsgLy8gUmVzZXQgZm9yIG5leHQgdGVzdFxuICAgICAgfVxuICAgIH0gY2F0Y2ggeyAvKiBza2lwICovIH1cbiAgfVxuXG4gIHdhbGsoc2VhcmNoUGF0aCk7XG5cbiAgaWYgKG1hdGNoZXMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIGBObyBtYXRjaGVzIGZvcjogJHtwYXR0ZXJufWA7XG4gIH1cblxuICBjb25zdCBsaW1pdGVkID0gbWF0Y2hlcy5zbGljZSgwLCBvcHRpb25zLmxpbWl0KTtcbiAgY29uc3QgbGluZXM6IHN0cmluZ1tdID0gW107XG5cbiAgZm9yIChjb25zdCBtIG9mIGxpbWl0ZWQpIHtcbiAgICBjb25zdCByZWxQYXRoID0gcmVsYXRpdmUod29ya2luZ0RpciwgbS5maWxlKTtcbiAgICBjb25zdCBkaXNwbGF5UGF0aCA9IHJlbFBhdGggJiYgIXJlbFBhdGguc3RhcnRzV2l0aCgnLi4nKSA/IHJlbFBhdGggOiBtLmZpbGU7XG4gICAgbGluZXMucHVzaChgJHtkaXNwbGF5UGF0aH06JHttLmxpbmV9OiAke20uY29udGVudH1gKTtcbiAgfVxuXG4gIGxldCByZXN1bHQgPSBsaW5lcy5qb2luKCdcXG4nKTtcbiAgaWYgKG1hdGNoZXMubGVuZ3RoID4gb3B0aW9ucy5saW1pdCkge1xuICAgIHJlc3VsdCArPSBgXFxuXFxuWyR7bWF0Y2hlcy5sZW5ndGggLSBvcHRpb25zLmxpbWl0fSBtb3JlIG1hdGNoZXMsIHVzZSBsaW1pdCBwYXJhbWV0ZXIgdG8gc2VlIG1vcmVdYDtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIERFRklOSVRJT04gTU9ERSAtIEZpbmQgY29kZSBkZWZpbml0aW9uc1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5mdW5jdGlvbiBzZWFyY2hEZWZpbml0aW9ucyhcbiAgc2VhcmNoUGF0aDogc3RyaW5nLFxuICB3b3JraW5nRGlyOiBzdHJpbmcsXG4gIG5hbWU6IHN0cmluZyxcbiAgb3B0aW9uczogeyBkZWZpbml0aW9uVHlwZTogc3RyaW5nOyBsaW1pdDogbnVtYmVyIH1cbik6IHN0cmluZyB7XG4gIGNvbnN0IHBhdHRlcm5zOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgIGZ1bmN0aW9uOiBgKGZ1bmN0aW9uXFxcXHMrJHtuYW1lfXxjb25zdFxcXFxzKyR7bmFtZX1cXFxccyo9Lio9Pnwke25hbWV9XFxcXHMqXFxcXChbXildKlxcXFwpXFxcXHMqXFxcXHspYCxcbiAgICBjbGFzczogYGNsYXNzXFxcXHMrJHtuYW1lfWAsXG4gICAgaW50ZXJmYWNlOiBgaW50ZXJmYWNlXFxcXHMrJHtuYW1lfWAsXG4gICAgdHlwZTogYHR5cGVcXFxccyske25hbWV9YCxcbiAgICBjb25zdDogYGNvbnN0XFxcXHMrJHtuYW1lfWAsXG4gICAgYW55OiBgKGZ1bmN0aW9uXFxcXHMrJHtuYW1lfXxjbGFzc1xcXFxzKyR7bmFtZX18aW50ZXJmYWNlXFxcXHMrJHtuYW1lfXx0eXBlXFxcXHMrJHtuYW1lfXxjb25zdFxcXFxzKyR7bmFtZX0pYCxcbiAgfTtcblxuICBjb25zdCBwYXR0ZXJuU3RyID0gcGF0dGVybnNbb3B0aW9ucy5kZWZpbml0aW9uVHlwZV0gfHwgcGF0dGVybnNbJ2FueSddO1xuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAocGF0dGVyblN0ciEsICdnaScpO1xuICBjb25zdCBtYXRjaGVzOiBDb250ZW50TWF0Y2hbXSA9IFtdO1xuXG4gIGZ1bmN0aW9uIHdhbGsoZGlyOiBzdHJpbmcpIHtcbiAgICBpZiAobWF0Y2hlcy5sZW5ndGggPj0gb3B0aW9ucy5saW1pdCAqIDIpIHJldHVybjtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZW50cmllcyA9IHJlYWRkaXJTeW5jKGRpciwgeyB3aXRoRmlsZVR5cGVzOiB0cnVlIH0pO1xuICAgICAgZm9yIChjb25zdCBlbnRyeSBvZiBlbnRyaWVzKSB7XG4gICAgICAgIGlmIChJR05PUkVEX0RJUlMuaGFzKGVudHJ5Lm5hbWUpKSBjb250aW51ZTtcbiAgICAgICAgaWYgKG1hdGNoZXMubGVuZ3RoID49IG9wdGlvbnMubGltaXQgKiAyKSBicmVhaztcbiAgICAgICAgY29uc3QgZnVsbFBhdGggPSBqb2luKGRpciwgZW50cnkubmFtZSk7XG4gICAgICAgIGlmIChlbnRyeS5pc0RpcmVjdG9yeSgpKSB7XG4gICAgICAgICAgd2FsayhmdWxsUGF0aCk7XG4gICAgICAgIH0gZWxzZSBpZiAoaXNDb2RlRmlsZShmdWxsUGF0aCkpIHtcbiAgICAgICAgICBzZWFyY2hGaWxlKGZ1bGxQYXRoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggeyAvKiBza2lwICovIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHNlYXJjaEZpbGUoZmlsZVBhdGg6IHN0cmluZykge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzdGF0ID0gc3RhdFN5bmMoZmlsZVBhdGgpO1xuICAgICAgaWYgKHN0YXQuc2l6ZSA+IE1BWF9GSUxFX1NJWkUpIHJldHVybjtcblxuICAgICAgY29uc3QgY29udGVudCA9IHJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0Zi04Jyk7XG4gICAgICBjb25zdCBsaW5lcyA9IGNvbnRlbnQuc3BsaXQoJ1xcbicpO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aCAmJiBtYXRjaGVzLmxlbmd0aCA8IG9wdGlvbnMubGltaXQgKiAyOyBpKyspIHtcbiAgICAgICAgaWYgKHJlZ2V4LnRlc3QobGluZXNbaV0hKSkge1xuICAgICAgICAgIG1hdGNoZXMucHVzaCh7XG4gICAgICAgICAgICBmaWxlOiBmaWxlUGF0aCxcbiAgICAgICAgICAgIGxpbmU6IGkgKyAxLFxuICAgICAgICAgICAgY29udGVudDogbGluZXNbaV0hLnRyaW0oKSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZWdleC5sYXN0SW5kZXggPSAwO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggeyAvKiBza2lwICovIH1cbiAgfVxuXG4gIHdhbGsoc2VhcmNoUGF0aCk7XG5cbiAgaWYgKG1hdGNoZXMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIGBObyBkZWZpbml0aW9ucyBmb3VuZCBmb3I6ICR7bmFtZX1gO1xuICB9XG5cbiAgY29uc3QgbGltaXRlZCA9IG1hdGNoZXMuc2xpY2UoMCwgb3B0aW9ucy5saW1pdCk7XG4gIGNvbnN0IGxpbmVzOiBzdHJpbmdbXSA9IFtdO1xuXG4gIGZvciAoY29uc3QgbSBvZiBsaW1pdGVkKSB7XG4gICAgY29uc3QgcmVsUGF0aCA9IHJlbGF0aXZlKHdvcmtpbmdEaXIsIG0uZmlsZSk7XG4gICAgY29uc3QgZGlzcGxheVBhdGggPSByZWxQYXRoICYmICFyZWxQYXRoLnN0YXJ0c1dpdGgoJy4uJykgPyByZWxQYXRoIDogbS5maWxlO1xuICAgIGxpbmVzLnB1c2goYCR7ZGlzcGxheVBhdGh9OiR7bS5saW5lfTogJHttLmNvbnRlbnR9YCk7XG4gIH1cblxuICByZXR1cm4gbGluZXMuam9pbignXFxuJyk7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFV0aWxpdHkgZnVuY3Rpb25zXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmZ1bmN0aW9uIG1hdGNoZXNGaWxlVHlwZShmaWxlUGF0aDogc3RyaW5nLCBmaWxlVHlwZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gIGNvbnN0IGV4dCA9IGV4dG5hbWUoZmlsZVBhdGgpLnRvTG93ZXJDYXNlKCk7XG4gIGNvbnN0IGV4dGVuc2lvbnMgPSBGSUxFX1RZUEVfTUFQW2ZpbGVUeXBlLnRvTG93ZXJDYXNlKCldO1xuICByZXR1cm4gZXh0ZW5zaW9ucyA/IGV4dGVuc2lvbnMuaW5jbHVkZXMoZXh0KSA6IGZhbHNlO1xufVxuXG5mdW5jdGlvbiBtYXRjaGVzR2xvYihmaWxlUGF0aDogc3RyaW5nLCBwYXR0ZXJuOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgY29uc3QgcmVnZXggPSBnbG9iVG9SZWdleChwYXR0ZXJuKTtcbiAgcmV0dXJuIHJlZ2V4LnRlc3QoZmlsZVBhdGgpO1xufVxuXG5mdW5jdGlvbiBpc0JpbmFyeShmaWxlUGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiBCSU5BUllfRVhURU5TSU9OUy5oYXMoZXh0bmFtZShmaWxlUGF0aCkudG9Mb3dlckNhc2UoKSk7XG59XG5cbmZ1bmN0aW9uIGlzQ29kZUZpbGUoZmlsZVBhdGg6IHN0cmluZyk6IGJvb2xlYW4ge1xuICBjb25zdCBleHQgPSBleHRuYW1lKGZpbGVQYXRoKS50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCBjb2RlRXh0cyA9IFsnLnRzJywgJy50c3gnLCAnLmpzJywgJy5qc3gnLCAnLnB5JywgJy5nbycsICcucnMnLCAnLmphdmEnLCAnLnJiJywgJy5zd2lmdCcsICcua3QnXTtcbiAgcmV0dXJuIGNvZGVFeHRzLmluY2x1ZGVzKGV4dCk7XG59XG5cbi8vIExlZ2FjeSBleHBvcnRzIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XG5leHBvcnQgeyBjcmVhdGVTZWFyY2hUb29scyBhcyBjcmVhdGVHcmVwVG9vbHMgfTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBU0EsSUFBQUEsT0FBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsU0FBQSxHQUFBRCxPQUFBO0FBRUEsSUFBQUUsT0FBQSxHQUFBRixPQUFBO0FBQ0EsSUFBQUcsVUFBQSxHQUFBSCxPQUFBO0FBYkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFRQSxNQUFNSSxhQUFhLEdBQUcsQ0FBQyxHQUFHLElBQUksR0FBRyxJQUFJLENBQUMsQ0FBQzs7QUFFdkMsTUFBTUMsWUFBWSxHQUFHLElBQUlDLEdBQUcsQ0FBQyxDQUMzQixNQUFNLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFDNUQsUUFBUSxFQUFFLFFBQVEsRUFBRSxhQUFhLEVBQUUsZUFBZSxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQ25FLE1BQU0sQ0FDUCxDQUFDO0FBRUYsTUFBTUMsaUJBQWlCLEdBQUcsSUFBSUQsR0FBRyxDQUFDLENBQ2hDLE1BQU0sRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFDdkQsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQzVDLE1BQU0sRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQ3ZDLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQ3RDLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FDbEMsQ0FB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