{"version":3,"names":["cov_2h2kejdugu","actualCoverage","OpenAIEmbeddingProvider","name","s","constructor","config","f","apiKey","model","b","baseUrl","dimension","embed","text","response","fetch","method","headers","body","JSON","stringify","input","ok","error","Error","status","data","json","embedding","OllamaEmbeddingProvider","prompt","DeepSeekEmbeddingProvider","CachedEmbeddingProvider","cache","Map","provider","maxCacheSize","cached","get","size","firstKey","keys","next","value","delete","set","clearCache","clear","getCacheStats","maxSize","createEmbeddingProvider","options","type","tokens","toLowerCase","replace","split","filter","t","length","vector","Array","fill","token","hash","i","charCodeAt","Math","abs","mag","sqrt","reduce","v","map","useCache","autoDetectEmbeddingProvider","openaiKey","process","env","deepseekKey"],"sources":["embeddingProviders.ts"],"sourcesContent":["/**\n * Embedding Providers - Pluggable vector embedding backends\n *\n * Supports:\n * - Simple (built-in, no dependencies)\n * - OpenAI text-embedding-3-small/large\n * - Ollama local embeddings\n * - Custom providers via interface\n */\n\nimport type { EmbeddingProvider } from './episodicMemory.js';\n\n// ============================================================================\n// OPENAI EMBEDDING PROVIDER\n// ============================================================================\n\nexport interface OpenAIEmbeddingConfig {\n  apiKey: string;\n  model?: 'text-embedding-3-small' | 'text-embedding-3-large' | 'text-embedding-ada-002';\n  baseUrl?: string;\n}\n\nexport class OpenAIEmbeddingProvider implements EmbeddingProvider {\n  readonly name = 'openai';\n  readonly dimension: number;\n\n  private apiKey: string;\n  private model: string;\n  private baseUrl: string;\n\n  constructor(config: OpenAIEmbeddingConfig) {\n    this.apiKey = config.apiKey;\n    this.model = config.model || 'text-embedding-3-small';\n    this.baseUrl = config.baseUrl || 'https://api.openai.com/v1';\n\n    // Set dimension based on model\n    switch (this.model) {\n      case 'text-embedding-3-large':\n        this.dimension = 3072;\n        break;\n      case 'text-embedding-ada-002':\n        this.dimension = 1536;\n        break;\n      case 'text-embedding-3-small':\n      default:\n        this.dimension = 1536;\n        break;\n    }\n  }\n\n  async embed(text: string): Promise<number[]> {\n    const response = await fetch(`${this.baseUrl}/embeddings`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.apiKey}`,\n      },\n      body: JSON.stringify({\n        model: this.model,\n        input: text,\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`OpenAI embedding failed: ${response.status} ${error}`);\n    }\n\n    const data = await response.json() as {\n      data: Array<{ embedding: number[] }>;\n    };\n\n    return data.data[0]?.embedding || [];\n  }\n}\n\n// ============================================================================\n// OLLAMA EMBEDDING PROVIDER\n// ============================================================================\n\nexport interface OllamaEmbeddingConfig {\n  model?: string;\n  baseUrl?: string;\n}\n\nexport class OllamaEmbeddingProvider implements EmbeddingProvider {\n  readonly name = 'ollama';\n  readonly dimension = 4096; // Default for most Ollama models\n\n  private model: string;\n  private baseUrl: string;\n\n  constructor(config: OllamaEmbeddingConfig = {}) {\n    this.model = config.model || 'nomic-embed-text';\n    this.baseUrl = config.baseUrl || 'http://localhost:11434';\n  }\n\n  async embed(text: string): Promise<number[]> {\n    const response = await fetch(`${this.baseUrl}/api/embeddings`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        model: this.model,\n        prompt: text,\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`Ollama embedding failed: ${response.status} ${error}`);\n    }\n\n    const data = await response.json() as {\n      embedding: number[];\n    };\n\n    return data.embedding || [];\n  }\n}\n\n// ============================================================================\n// DEEPSEEK EMBEDDING PROVIDER\n// ============================================================================\n\nexport interface DeepSeekEmbeddingConfig {\n  apiKey: string;\n  baseUrl?: string;\n}\n\nexport class DeepSeekEmbeddingProvider implements EmbeddingProvider {\n  readonly name = 'deepseek';\n  readonly dimension = 1024;\n\n  private apiKey: string;\n  private baseUrl: string;\n\n  constructor(config: DeepSeekEmbeddingConfig) {\n    this.apiKey = config.apiKey;\n    this.baseUrl = config.baseUrl || 'https://api.deepseek.com/v1';\n  }\n\n  async embed(text: string): Promise<number[]> {\n    // DeepSeek uses OpenAI-compatible API\n    const response = await fetch(`${this.baseUrl}/embeddings`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Authorization': `Bearer ${this.apiKey}`,\n      },\n      body: JSON.stringify({\n        model: 'deepseek-embedding',\n        input: text,\n      }),\n    });\n\n    if (!response.ok) {\n      const error = await response.text();\n      throw new Error(`DeepSeek embedding failed: ${response.status} ${error}`);\n    }\n\n    const data = await response.json() as {\n      data: Array<{ embedding: number[] }>;\n    };\n\n    return data.data[0]?.embedding || [];\n  }\n}\n\n// ============================================================================\n// CACHED EMBEDDING PROVIDER WRAPPER\n// ============================================================================\n\nexport class CachedEmbeddingProvider implements EmbeddingProvider {\n  readonly name: string;\n  readonly dimension: number;\n\n  private provider: EmbeddingProvider;\n  private cache: Map<string, number[]> = new Map();\n  private maxCacheSize: number;\n\n  constructor(provider: EmbeddingProvider, maxCacheSize = 10000) {\n    this.provider = provider;\n    this.name = `cached-${provider.name}`;\n    this.dimension = provider.dimension;\n    this.maxCacheSize = maxCacheSize;\n  }\n\n  async embed(text: string): Promise<number[]> {\n    // Check cache first\n    const cached = this.cache.get(text);\n    if (cached) {\n      return cached;\n    }\n\n    // Generate embedding\n    const embedding = await this.provider.embed(text);\n\n    // Cache result\n    if (this.cache.size >= this.maxCacheSize) {\n      // Remove oldest entry (first key)\n      const firstKey = this.cache.keys().next().value;\n      if (firstKey) this.cache.delete(firstKey);\n    }\n    this.cache.set(text, embedding);\n\n    return embedding;\n  }\n\n  clearCache(): void {\n    this.cache.clear();\n  }\n\n  getCacheStats(): { size: number; maxSize: number } {\n    return {\n      size: this.cache.size,\n      maxSize: this.maxCacheSize,\n    };\n  }\n}\n\n// ============================================================================\n// FACTORY\n// ============================================================================\n\nexport type EmbeddingProviderType = 'simple' | 'openai' | 'ollama' | 'deepseek';\n\nexport interface EmbeddingProviderOptions {\n  type: EmbeddingProviderType;\n  apiKey?: string;\n  model?: string;\n  baseUrl?: string;\n  useCache?: boolean;\n  maxCacheSize?: number;\n}\n\n/**\n * Create an embedding provider based on configuration\n */\nexport function createEmbeddingProvider(options: EmbeddingProviderOptions): EmbeddingProvider {\n  let provider: EmbeddingProvider;\n\n  switch (options.type) {\n    case 'openai':\n      if (!options.apiKey) {\n        throw new Error('OpenAI embedding provider requires apiKey');\n      }\n      provider = new OpenAIEmbeddingProvider({\n        apiKey: options.apiKey,\n        model: options.model as OpenAIEmbeddingConfig['model'],\n        baseUrl: options.baseUrl,\n      });\n      break;\n\n    case 'ollama':\n      provider = new OllamaEmbeddingProvider({\n        model: options.model,\n        baseUrl: options.baseUrl,\n      });\n      break;\n\n    case 'deepseek':\n      if (!options.apiKey) {\n        throw new Error('DeepSeek embedding provider requires apiKey');\n      }\n      provider = new DeepSeekEmbeddingProvider({\n        apiKey: options.apiKey,\n        baseUrl: options.baseUrl,\n      });\n      break;\n\n    case 'simple':\n    default:\n      // Simple provider is built into episodicMemory.ts\n      // Return a placeholder that will use the default\n      return {\n        name: 'simple',\n        dimension: 256,\n        embed: async (text: string) => {\n          // This is a simplified version - the real one is in episodicMemory.ts\n          const tokens = text.toLowerCase().replace(/[^a-z0-9\\s]/g, ' ').split(/\\s+/).filter(t => t.length > 2);\n          const vector = new Array(256).fill(0);\n          for (const token of tokens) {\n            let hash = 0;\n            for (let i = 0; i < token.length; i++) {\n              hash = ((hash << 5) - hash) + token.charCodeAt(i);\n              hash = hash & hash;\n            }\n            vector[Math.abs(hash) % 256] += 1;\n          }\n          const mag = Math.sqrt(vector.reduce((s, v) => s + v * v, 0));\n          return mag > 0 ? vector.map(v => v / mag) : vector;\n        },\n      };\n  }\n\n  // Wrap with cache if requested\n  if (options.useCache) {\n    return new CachedEmbeddingProvider(provider, options.maxCacheSize);\n  }\n\n  return provider;\n}\n\n/**\n * Auto-detect best available embedding provider\n */\nexport function autoDetectEmbeddingProvider(): EmbeddingProvider {\n  // Check for API keys in environment\n  const openaiKey = process.env['OPENAI_API_KEY'];\n  const deepseekKey = process.env['DEEPSEEK_API_KEY'];\n\n  if (openaiKey) {\n    return createEmbeddingProvider({\n      type: 'openai',\n      apiKey: openaiKey,\n      useCache: true,\n    });\n  }\n\n  if (deepseekKey) {\n    return createEmbeddingProvider({\n      type: 'deepseek',\n      apiKey: deepseekKey,\n      useCache: true,\n    });\n  }\n\n  // Try Ollama (local)\n  // Could add a ping check here, but for now just use simple\n  return createEmbeddingProvider({ type: 'simple' });\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}