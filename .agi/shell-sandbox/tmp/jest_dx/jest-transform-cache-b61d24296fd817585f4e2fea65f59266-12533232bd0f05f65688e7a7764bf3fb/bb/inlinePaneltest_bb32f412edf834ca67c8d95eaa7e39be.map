{"version":3,"names":["_events","require","_UnifiedUIRenderer","makeMockStream","emitter","EventEmitter","stream","isTTY","rows","columns","write","jest","fn","on","bind","off","removeListener","once","emit","listenerCount","setMaxListeners","getMaxListeners","resume","pause","setRawMode","makeLines","count","Array","from","length","_","index","describe","test","renderer","UnifiedUIRenderer","input","result","limitInlinePanel","expectedMax","Math","max","min","maxInlinePanelLines","expectedTailCount","expect","toContain","toBe","slice","toEqual","toBeLessThan"],"sources":["inlinePanel.test.ts"],"sourcesContent":["import { EventEmitter } from 'events';\nimport { UnifiedUIRenderer } from '../../src/ui/UnifiedUIRenderer.js';\n\ntype WritableLike = NodeJS.WriteStream & { isTTY?: boolean; rows?: number; columns?: number };\ntype ReadableLike = NodeJS.ReadStream & { isTTY?: boolean };\n\nconst makeMockStream = (): WritableLike & ReadableLike => {\n  const emitter = new EventEmitter();\n  const stream: Partial<WritableLike & ReadableLike> = {\n    isTTY: false,\n    rows: 24,\n    columns: 80,\n    write: jest.fn(),\n    on: emitter.on.bind(emitter),\n    off: emitter.off.bind(emitter),\n    removeListener: emitter.removeListener.bind(emitter),\n    once: emitter.once.bind(emitter),\n    emit: emitter.emit.bind(emitter),\n    listenerCount: emitter.listenerCount.bind(emitter),\n    setMaxListeners: emitter.setMaxListeners.bind(emitter),\n    getMaxListeners: emitter.getMaxListeners.bind(emitter),\n    resume: jest.fn(),\n    pause: jest.fn(),\n    setRawMode: jest.fn(),\n  };\n  return stream as WritableLike & ReadableLike;\n};\n\nconst makeLines = (count: number): string[] =>\n  Array.from({ length: count }, (_, index) => `line-${index + 1}`);\n\ndescribe('inline panel clamping', () => {\n  test('UnifiedUIRenderer.limitInlinePanel caps lines and prepends overflow indicator', () => {\n    const renderer = new UnifiedUIRenderer(makeMockStream(), makeMockStream());\n    // Simulate a taller terminal to make the math predictable\n    (renderer as any).rows = 32;\n\n    const input = makeLines(20);\n    const result = (renderer as any).limitInlinePanel(input) as string[];\n\n    const expectedMax = Math.max(4, Math.min((renderer as any).maxInlinePanelLines, Math.max(2, 32 - 8)));\n    const expectedTailCount = Math.max(1, expectedMax - 1);\n\n    expect(result[0]).toContain('more lines');\n    expect(result.length).toBe(expectedTailCount + 1);\n    expect(result.slice(1)).toEqual(input.slice(-expectedTailCount));\n  });\n\n  test('UnifiedUIRenderer inline panel clamping with large input', () => {\n    const renderer = new UnifiedUIRenderer(makeMockStream(), makeMockStream());\n    // Simulate terminal height\n    (renderer as any).rows = 24;\n\n    const input = makeLines(70);\n    const result = (renderer as any).limitInlinePanel(input) as string[];\n\n    // Result should be clamped with overflow indicator\n    expect(result[0]).toContain('more lines');\n    expect(result.length).toBeLessThan(input.length);\n  });\n});\n"],"mappings":"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","ignoreList":[]}