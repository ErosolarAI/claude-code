d35c1d9dbc33eb5967e330fdc745b7e3
"use strict";

var _events = require("events");
var _UnifiedUIRenderer = require("../../src/ui/UnifiedUIRenderer.js");
const makeMockStream = () => {
  const emitter = new _events.EventEmitter();
  const stream = {
    isTTY: false,
    rows: 24,
    columns: 80,
    write: jest.fn(),
    on: emitter.on.bind(emitter),
    off: emitter.off.bind(emitter),
    removeListener: emitter.removeListener.bind(emitter),
    once: emitter.once.bind(emitter),
    emit: emitter.emit.bind(emitter),
    listenerCount: emitter.listenerCount.bind(emitter),
    setMaxListeners: emitter.setMaxListeners.bind(emitter),
    getMaxListeners: emitter.getMaxListeners.bind(emitter),
    resume: jest.fn(),
    pause: jest.fn(),
    setRawMode: jest.fn()
  };
  return stream;
};
const makeLines = count => Array.from({
  length: count
}, (_, index) => `line-${index + 1}`);
describe('inline panel clamping', () => {
  test('UnifiedUIRenderer.limitInlinePanel caps lines and prepends overflow indicator', () => {
    const renderer = new _UnifiedUIRenderer.UnifiedUIRenderer(makeMockStream(), makeMockStream());
    // Simulate a taller terminal to make the math predictable
    renderer.rows = 32;
    const input = makeLines(20);
    const result = renderer.limitInlinePanel(input);
    const expectedMax = Math.max(4, Math.min(renderer.maxInlinePanelLines, Math.max(2, 32 - 8)));
    const expectedTailCount = Math.max(1, expectedMax - 1);
    expect(result[0]).toContain('more lines');
    expect(result.length).toBe(expectedTailCount + 1);
    expect(result.slice(1)).toEqual(input.slice(-expectedTailCount));
  });
  test('UnifiedUIRenderer inline panel clamping with large input', () => {
    const renderer = new _UnifiedUIRenderer.UnifiedUIRenderer(makeMockStream(), makeMockStream());
    // Simulate terminal height
    renderer.rows = 24;
    const input = makeLines(70);
    const result = renderer.limitInlinePanel(input);

    // Result should be clamped with overflow indicator
    expect(result[0]).toContain('more lines');
    expect(result.length).toBeLessThan(input.length);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXZlbnRzIiwicmVxdWlyZSIsIl9VbmlmaWVkVUlSZW5kZXJlciIsIm1ha2VNb2NrU3RyZWFtIiwiZW1pdHRlciIsIkV2ZW50RW1pdHRlciIsInN0cmVhbSIsImlzVFRZIiwicm93cyIsImNvbHVtbnMiLCJ3cml0ZSIsImplc3QiLCJmbiIsIm9uIiwiYmluZCIsIm9mZiIsInJlbW92ZUxpc3RlbmVyIiwib25jZSIsImVtaXQiLCJsaXN0ZW5lckNvdW50Iiwic2V0TWF4TGlzdGVuZXJzIiwiZ2V0TWF4TGlzdGVuZXJzIiwicmVzdW1lIiwicGF1c2UiLCJzZXRSYXdNb2RlIiwibWFrZUxpbmVzIiwiY291bnQiLCJBcnJheSIsImZyb20iLCJsZW5ndGgiLCJfIiwiaW5kZXgiLCJkZXNjcmliZSIsInRlc3QiLCJyZW5kZXJlciIsIlVuaWZpZWRVSVJlbmRlcmVyIiwiaW5wdXQiLCJyZXN1bHQiLCJsaW1pdElubGluZVBhbmVsIiwiZXhwZWN0ZWRNYXgiLCJNYXRoIiwibWF4IiwibWluIiwibWF4SW5saW5lUGFuZWxMaW5lcyIsImV4cGVjdGVkVGFpbENvdW50IiwiZXhwZWN0IiwidG9Db250YWluIiwidG9CZSIsInNsaWNlIiwidG9FcXVhbCIsInRvQmVMZXNzVGhhbiJdLCJzb3VyY2VzIjpbImlubGluZVBhbmVsLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcbmltcG9ydCB7IFVuaWZpZWRVSVJlbmRlcmVyIH0gZnJvbSAnLi4vLi4vc3JjL3VpL1VuaWZpZWRVSVJlbmRlcmVyLmpzJztcblxudHlwZSBXcml0YWJsZUxpa2UgPSBOb2RlSlMuV3JpdGVTdHJlYW0gJiB7IGlzVFRZPzogYm9vbGVhbjsgcm93cz86IG51bWJlcjsgY29sdW1ucz86IG51bWJlciB9O1xudHlwZSBSZWFkYWJsZUxpa2UgPSBOb2RlSlMuUmVhZFN0cmVhbSAmIHsgaXNUVFk/OiBib29sZWFuIH07XG5cbmNvbnN0IG1ha2VNb2NrU3RyZWFtID0gKCk6IFdyaXRhYmxlTGlrZSAmIFJlYWRhYmxlTGlrZSA9PiB7XG4gIGNvbnN0IGVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIGNvbnN0IHN0cmVhbTogUGFydGlhbDxXcml0YWJsZUxpa2UgJiBSZWFkYWJsZUxpa2U+ID0ge1xuICAgIGlzVFRZOiBmYWxzZSxcbiAgICByb3dzOiAyNCxcbiAgICBjb2x1bW5zOiA4MCxcbiAgICB3cml0ZTogamVzdC5mbigpLFxuICAgIG9uOiBlbWl0dGVyLm9uLmJpbmQoZW1pdHRlciksXG4gICAgb2ZmOiBlbWl0dGVyLm9mZi5iaW5kKGVtaXR0ZXIpLFxuICAgIHJlbW92ZUxpc3RlbmVyOiBlbWl0dGVyLnJlbW92ZUxpc3RlbmVyLmJpbmQoZW1pdHRlciksXG4gICAgb25jZTogZW1pdHRlci5vbmNlLmJpbmQoZW1pdHRlciksXG4gICAgZW1pdDogZW1pdHRlci5lbWl0LmJpbmQoZW1pdHRlciksXG4gICAgbGlzdGVuZXJDb3VudDogZW1pdHRlci5saXN0ZW5lckNvdW50LmJpbmQoZW1pdHRlciksXG4gICAgc2V0TWF4TGlzdGVuZXJzOiBlbWl0dGVyLnNldE1heExpc3RlbmVycy5iaW5kKGVtaXR0ZXIpLFxuICAgIGdldE1heExpc3RlbmVyczogZW1pdHRlci5nZXRNYXhMaXN0ZW5lcnMuYmluZChlbWl0dGVyKSxcbiAgICByZXN1bWU6IGplc3QuZm4oKSxcbiAgICBwYXVzZTogamVzdC5mbigpLFxuICAgIHNldFJhd01vZGU6IGplc3QuZm4oKSxcbiAgfTtcbiAgcmV0dXJuIHN0cmVhbSBhcyBXcml0YWJsZUxpa2UgJiBSZWFkYWJsZUxpa2U7XG59O1xuXG5jb25zdCBtYWtlTGluZXMgPSAoY291bnQ6IG51bWJlcik6IHN0cmluZ1tdID0+XG4gIEFycmF5LmZyb20oeyBsZW5ndGg6IGNvdW50IH0sIChfLCBpbmRleCkgPT4gYGxpbmUtJHtpbmRleCArIDF9YCk7XG5cbmRlc2NyaWJlKCdpbmxpbmUgcGFuZWwgY2xhbXBpbmcnLCAoKSA9PiB7XG4gIHRlc3QoJ1VuaWZpZWRVSVJlbmRlcmVyLmxpbWl0SW5saW5lUGFuZWwgY2FwcyBsaW5lcyBhbmQgcHJlcGVuZHMgb3ZlcmZsb3cgaW5kaWNhdG9yJywgKCkgPT4ge1xuICAgIGNvbnN0IHJlbmRlcmVyID0gbmV3IFVuaWZpZWRVSVJlbmRlcmVyKG1ha2VNb2NrU3RyZWFtKCksIG1ha2VNb2NrU3RyZWFtKCkpO1xuICAgIC8vIFNpbXVsYXRlIGEgdGFsbGVyIHRlcm1pbmFsIHRvIG1ha2UgdGhlIG1hdGggcHJlZGljdGFibGVcbiAgICAocmVuZGVyZXIgYXMgYW55KS5yb3dzID0gMzI7XG5cbiAgICBjb25zdCBpbnB1dCA9IG1ha2VMaW5lcygyMCk7XG4gICAgY29uc3QgcmVzdWx0ID0gKHJlbmRlcmVyIGFzIGFueSkubGltaXRJbmxpbmVQYW5lbChpbnB1dCkgYXMgc3RyaW5nW107XG5cbiAgICBjb25zdCBleHBlY3RlZE1heCA9IE1hdGgubWF4KDQsIE1hdGgubWluKChyZW5kZXJlciBhcyBhbnkpLm1heElubGluZVBhbmVsTGluZXMsIE1hdGgubWF4KDIsIDMyIC0gOCkpKTtcbiAgICBjb25zdCBleHBlY3RlZFRhaWxDb3VudCA9IE1hdGgubWF4KDEsIGV4cGVjdGVkTWF4IC0gMSk7XG5cbiAgICBleHBlY3QocmVzdWx0WzBdKS50b0NvbnRhaW4oJ21vcmUgbGluZXMnKTtcbiAgICBleHBlY3QocmVzdWx0Lmxlbmd0aCkudG9CZShleHBlY3RlZFRhaWxDb3VudCArIDEpO1xuICAgIGV4cGVjdChyZXN1bHQuc2xpY2UoMSkpLnRvRXF1YWwoaW5wdXQuc2xpY2UoLWV4cGVjdGVkVGFpbENvdW50KSk7XG4gIH0pO1xuXG4gIHRlc3QoJ1VuaWZpZWRVSVJlbmRlcmVyIGlubGluZSBwYW5lbCBjbGFtcGluZyB3aXRoIGxhcmdlIGlucHV0JywgKCkgPT4ge1xuICAgIGNvbnN0IHJlbmRlcmVyID0gbmV3IFVuaWZpZWRVSVJlbmRlcmVyKG1ha2VNb2NrU3RyZWFtKCksIG1ha2VNb2NrU3RyZWFtKCkpO1xuICAgIC8vIFNpbXVsYXRlIHRlcm1pbmFsIGhlaWdodFxuICAgIChyZW5kZXJlciBhcyBhbnkpLnJvd3MgPSAyNDtcblxuICAgIGNvbnN0IGlucHV0ID0gbWFrZUxpbmVzKDcwKTtcbiAgICBjb25zdCByZXN1bHQgPSAocmVuZGVyZXIgYXMgYW55KS5saW1pdElubGluZVBhbmVsKGlucHV0KSBhcyBzdHJpbmdbXTtcblxuICAgIC8vIFJlc3VsdCBzaG91bGQgYmUgY2xhbXBlZCB3aXRoIG92ZXJmbG93IGluZGljYXRvclxuICAgIGV4cGVjdChyZXN1bHRbMF0pLnRvQ29udGFpbignbW9yZSBsaW5lcycpO1xuICAgIGV4cGVjdChyZXN1bHQubGVuZ3RoKS50b0JlTGVzc1RoYW4oaW5wdXQubGVuZ3RoKTtcbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFBQSxPQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxrQkFBQSxHQUFBRCxPQUFBO0FBS0EsTUFBTUUsY0FBYyxHQUFHQSxDQUFBLEtBQW1DO0VBQ3hELE1BQU1DLE9BQU8sR0FBRyxJQUFJQyxvQkFBWSxDQUFDLENBQUM7RUFDbEMsTUFBTUMsTUFBNEMsR0FBRztJQUNuREMsS0FBSyxFQUFFLEtBQUs7SUFDWkMsSUFBSSxFQUFFLEVBQUU7SUFDUkMsT0FBTyxFQUFFLEVBQUU7SUFDWEMsS0FBSyxFQUFFQyxJQUFJLENBQUNDLEVBQUUsQ0FBQyxDQUFDO0lBQ2hCQyxFQUFFLEVBQUVULE9BQU8sQ0FBQ1MsRUFBRSxDQUFDQyxJQUFJLENBQUNWLE9BQU8sQ0FBQztJQUM1QlcsR0FBRyxFQUFFWCxPQUFPLENBQUNXLEdBQUcsQ0FBQ0QsSUFBSSxDQUFDVixPQUFPLENBQUM7SUFDOUJZLGNBQWMsRUFBRVosT0FBTyxDQUFDWSxjQUFjLENBQUNGLElBQUksQ0FBQ1YsT0FBTyxDQUFDO0lBQ3BEYSxJQUFJLEVBQUViLE9BQU8sQ0FBQ2EsSUFBSSxDQUFDSCxJQUFJLENBQUNWLE9BQU8sQ0FBQztJQUNoQ2MsSUFB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