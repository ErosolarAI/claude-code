{"version":3,"names":["cov_2hxkechba7","actualCoverage","readFileSync","dirname","resolve","fileURLToPath","MODULE_DIR","s","import","meta","url","DEFAULT_RULEBOOK_ROOT","manifestCache","Map","promptCache","loadAgentRulebook","profile","options","b","f","inline","manifest","Error","root","filePath","resolveRulebookPath","file","cacheKey","cached","get","raw","JSON","parse","set","buildAgentRulebookPrompt","formatAgentRulebook","prompt","lines","headerLabel","label","push","version","contractVersion","description","trim","globalPrinciples","length","rule","formatRuleLine","phase","phases","phaseSummary","id","join","trigger","step","steps","formatStepLine","filter","Boolean","fileOverride","trimmedOverride","indent","severity","toUpperCase","parts","summary","detail","evidenceRequired","details","intent","header","title","entryCriteria","exitCriteria","allowedTools","blockedTools","notes","rules","subSteps","subStep","replace"],"sources":["agentRulebook.ts"],"sourcesContent":["import { readFileSync } from 'node:fs';\nimport { dirname, resolve } from 'node:path';\nimport { fileURLToPath } from 'node:url';\nimport type { AgentRulesetManifest, AgentStepRule, AgentRuleDefinition } from '../contracts/v1/agentRules.js';\nimport type { ProfileName } from './agentProfiles.js';\n\nconst MODULE_DIR = dirname(fileURLToPath(import.meta.url));\nconst DEFAULT_RULEBOOK_ROOT = resolve(MODULE_DIR, '..', '..');\n\nconst manifestCache = new Map<string, AgentRulesetManifest>();\nconst promptCache = new Map<string, string>();\n\nexport interface LoadRulebookOptions {\n  root?: string;\n  file?: string;\n  inline?: AgentRulesetManifest;\n}\n\nexport function loadAgentRulebook(profile: ProfileName, options: LoadRulebookOptions = {}): AgentRulesetManifest {\n  // If inline manifest is provided, use it directly\n  if (options.inline) {\n    const manifest = options.inline;\n    if (manifest.profile !== profile) {\n      throw new Error(\n        `Rulebook profile mismatch for ${profile}. Expected \"${profile}\" but inline manifest declares \"${manifest.profile}\".`\n      );\n    }\n    return manifest;\n  }\n\n  // Otherwise load from file\n  const root = options.root ?? DEFAULT_RULEBOOK_ROOT;\n  const filePath = resolveRulebookPath(profile, root, options.file);\n  const cacheKey = filePath;\n\n  const cached = manifestCache.get(cacheKey);\n  if (cached) {\n    return cached;\n  }\n\n  const raw = readFileSync(filePath, 'utf8');\n  const manifest = JSON.parse(raw) as AgentRulesetManifest;\n\n  if (manifest.profile !== profile) {\n    throw new Error(\n      `Rulebook profile mismatch for ${profile}. Expected \"${profile}\" but file declares \"${manifest.profile}\".`\n    );\n  }\n\n  manifestCache.set(cacheKey, manifest);\n  return manifest;\n}\n\nexport function buildAgentRulebookPrompt(profile: ProfileName, options: LoadRulebookOptions = {}): string {\n  // If inline, don't cache (since it might change)\n  if (options.inline) {\n    const manifest = loadAgentRulebook(profile, { inline: options.inline });\n    return formatAgentRulebook(manifest);\n  }\n\n  const root = options.root ?? DEFAULT_RULEBOOK_ROOT;\n  const filePath = resolveRulebookPath(profile, root, options.file);\n  const cacheKey = filePath;\n\n  const cached = promptCache.get(cacheKey);\n  if (cached) {\n    return cached;\n  }\n\n  const manifest = loadAgentRulebook(profile, { root, file: options.file });\n  const prompt = formatAgentRulebook(manifest);\n  promptCache.set(cacheKey, prompt);\n  return prompt;\n}\n\nexport function formatAgentRulebook(manifest: AgentRulesetManifest): string {\n  const lines: string[] = [];\n  const headerLabel = manifest.label || manifest.profile;\n\n  lines.push(\n    `${headerLabel} — rulebook version ${manifest.version} (contract ${manifest.contractVersion}).`\n  );\n\n  if (manifest.description) {\n    lines.push(manifest.description.trim());\n  }\n\n  if (manifest.globalPrinciples?.length) {\n    lines.push('\\nGLOBAL PRINCIPLES:');\n    for (const rule of manifest.globalPrinciples) {\n      lines.push(formatRuleLine(rule));\n    }\n  }\n\n  for (const phase of manifest.phases) {\n    const phaseSummary = [phase.label || phase.id];\n    if (phase.description) {\n      phaseSummary.push(`– ${phase.description}`);\n    }\n    lines.push(`\\nPHASE ${phase.id}: ${phaseSummary.join(' ')}`);\n    if (phase.trigger) {\n      lines.push(`  Trigger: ${phase.trigger}`);\n    }\n    for (const step of phase.steps) {\n      lines.push(formatStepLine(step));\n    }\n  }\n\n  return lines.filter(Boolean).join('\\n');\n}\n\nfunction resolveRulebookPath(profile: ProfileName, root: string, fileOverride?: string): string {\n  const trimmedOverride = fileOverride?.trim();\n  if (trimmedOverride) {\n    return resolve(root, trimmedOverride);\n  }\n  return resolve(root, 'agents', `${profile}.rules.json`);\n}\n\nfunction formatRuleLine(rule: AgentRuleDefinition, indent = '  '): string {\n  const severity = rule.severity?.toUpperCase() ?? 'INFO';\n  const parts = [`[${severity}] (${rule.id}) ${rule.summary}`];\n  if (rule.detail) {\n    parts.push(`— ${rule.detail}`);\n  }\n  if (rule.evidenceRequired) {\n    parts.push(`Evidence: ${rule.evidenceRequired}`);\n  }\n  return `${indent}${parts.join(' ')}`;\n}\n\nfunction formatStepLine(step: AgentStepRule): string {\n  const details: string[] = [];\n  if (step.intent) {\n    details.push(step.intent);\n  }\n  if (step.description && step.description !== step.intent) {\n    details.push(step.description);\n  }\n\n  const header = [`  STEP ${step.id}: ${step.title}`];\n  if (details.length) {\n    header.push(`(${details.join(' — ')})`);\n  }\n  const lines = [header.join(' ')];\n\n  if (step.entryCriteria?.length) {\n    lines.push(`    Entry: ${step.entryCriteria.join('; ')}`);\n  }\n  if (step.exitCriteria?.length) {\n    lines.push(`    Exit: ${step.exitCriteria.join('; ')}`);\n  }\n  if (step.allowedTools?.length) {\n    lines.push(`    Allowed tools: ${step.allowedTools.join(', ')}`);\n  }\n  if (step.blockedTools?.length) {\n    lines.push(`    Blocked tools: ${step.blockedTools.join(', ')}`);\n  }\n  if (step.notes?.length) {\n    lines.push(`    Notes: ${step.notes.join(' ')}`);\n  }\n\n  for (const rule of step.rules) {\n    lines.push(formatRuleLine(rule, '    - '));\n  }\n\n  if (step.subSteps?.length) {\n    lines.push('    Sub-steps:');\n    for (const subStep of step.subSteps) {\n      lines.push(formatStepLine(subStep).replace(/^ {2}/gm, '      '));\n    }\n  }\n\n  return lines.join('\\n');\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}