{"version":3,"names":["cov_3fk6by3c","actualCoverage","OpenAIChatCompletionsProvider","registerProvider","withProviderResilience","registered","s","registerOllamaProviderPlugin","f","b","config","baseURL","process","env","options","apiKey","model","providerId","timeout","maxRetries","temperature","maxTokens","baseProvider","getAvailableOllamaModels","response","fetch","ok","data","json","models","map","m","name","isOllamaAvailable","method","signal","AbortSignal"],"sources":["index.ts"],"sourcesContent":["import { OpenAIChatCompletionsProvider } from '../../../providers/openaiChatCompletionsProvider.js';\nimport { registerProvider } from '../../../providers/providerFactory.js';\nimport { withProviderResilience } from '../../../providers/resilientProvider.js';\n\nlet registered = false;\n\n/**\n * Ollama Provider Plugin\n *\n * Registers the Ollama provider with hardened error handling.\n * Ollama provides an OpenAI-compatible API, so we can reuse the OpenAI provider\n * with a custom base URL. By default, Ollama runs on http://localhost:11434.\n *\n * Note: Ollama is local so circuit breaker is disabled, but retries are still useful\n * for handling temporary resource constraints.\n */\nexport function registerOllamaProviderPlugin(): void {\n  if (registered) {\n    return;\n  }\n\n  registerProvider('ollama', (config) => {\n    const baseURL = process.env['OLLAMA_BASE_URL'] || 'http://localhost:11434/v1';\n\n    const options = {\n      apiKey: 'ollama', // Ollama doesn't require an API key for local instances\n      model: config.model,\n      providerId: 'ollama' as const,\n      baseURL,\n      timeout: 300000, // 5 minutes - local models can be slow\n      maxRetries: 2,\n      ...(typeof config.temperature === 'number' ? { temperature: config.temperature } : {}),\n      ...(typeof config.maxTokens === 'number' ? { maxTokens: config.maxTokens } : {}),\n    };\n\n    const baseProvider = new OpenAIChatCompletionsProvider(options);\n\n    // Wrap with resilience layer (circuit breaker disabled for local)\n    return withProviderResilience(baseProvider, 'ollama');\n  });\n\n  registered = true;\n}\n\n/**\n * Query available models from local Ollama instance.\n * Returns an array of model names that are currently available.\n */\nexport async function getAvailableOllamaModels(\n  baseURL: string = 'http://localhost:11434'\n): Promise<string[]> {\n  try {\n    const response = await fetch(`${baseURL}/api/tags`);\n    if (!response.ok) {\n      return [];\n    }\n\n    const data = (await response.json()) as { models?: Array<{ name: string }> };\n    return data.models?.map((m) => m.name) ?? [];\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Check if Ollama is running and accessible.\n */\nexport async function isOllamaAvailable(\n  baseURL: string = 'http://localhost:11434'\n): Promise<boolean> {\n  try {\n    const response = await fetch(`${baseURL}/api/tags`, {\n      method: 'GET',\n      signal: AbortSignal.timeout(2000), // 2 second timeout\n    });\n    return response.ok;\n  } catch {\n    return false;\n  }\n}\n"],"mappings":"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","ignoreList":[]}