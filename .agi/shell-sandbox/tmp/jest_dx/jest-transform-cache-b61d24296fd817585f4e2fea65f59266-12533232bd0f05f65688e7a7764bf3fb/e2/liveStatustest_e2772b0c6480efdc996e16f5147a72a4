021aeb974413aa269c72e00b287ebe63
"use strict";

var _liveStatus = require("../liveStatus");
describe('LiveStatusTracker timing', () => {
  beforeEach(() => {
    jest.useFakeTimers();
    jest.setSystemTime(new Date('2024-01-01T00:00:00Z'));
  });
  afterEach(() => {
    jest.useRealTimers();
  });
  it('preserves startedAt when the base status text stays the same', () => {
    const tracker = new _liveStatus.LiveStatusTracker();
    tracker.setBase('Ready for prompts');
    let current = null;
    const unsubscribe = tracker.subscribe(state => {
      current = state;
    });
    const firstStartedAt = current?.startedAt;

    // Move time forward and update the base status with the same text but new detail
    jest.advanceTimersByTime(1500);
    tracker.setBase('Ready for prompts', {
      detail: 'details change without resetting timer'
    });
    expect(current?.startedAt).toBe(firstStartedAt);
    unsubscribe();
  });
  it('preserves startedAt when updating an existing override with the same text', () => {
    const tracker = new _liveStatus.LiveStatusTracker();
    let current = null;
    tracker.subscribe(state => {
      current = state;
    });
    tracker.pushOverride('streaming', 'Processing');
    const firstStartedAt = current?.startedAt;
    jest.advanceTimersByTime(1200);
    tracker.pushOverride('streaming', 'Processing', {
      detail: 'still running'
    });
    expect(current?.startedAt).toBe(firstStartedAt);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbGl2ZVN0YXR1cyIsInJlcXVpcmUiLCJkZXNjcmliZSIsImJlZm9yZUVhY2giLCJqZXN0IiwidXNlRmFrZVRpbWVycyIsInNldFN5c3RlbVRpbWUiLCJEYXRlIiwiYWZ0ZXJFYWNoIiwidXNlUmVhbFRpbWVycyIsIml0IiwidHJhY2tlciIsIkxpdmVTdGF0dXNUcmFja2VyIiwic2V0QmFzZSIsImN1cnJlbnQiLCJ1bnN1YnNjcmliZSIsInN1YnNjcmliZSIsInN0YXRlIiwiZmlyc3RTdGFydGVkQXQiLCJzdGFydGVkQXQiLCJhZHZhbmNlVGltZXJzQnlUaW1lIiwiZGV0YWlsIiwiZXhwZWN0IiwidG9CZSIsInB1c2hPdmVycmlkZSJdLCJzb3VyY2VzIjpbImxpdmVTdGF0dXMudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBMaXZlU3RhdHVzVHJhY2tlciwgdHlwZSBMaXZlU3RhdHVzU3RhdGUgfSBmcm9tICcuLi9saXZlU3RhdHVzJztcblxuZGVzY3JpYmUoJ0xpdmVTdGF0dXNUcmFja2VyIHRpbWluZycsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC51c2VGYWtlVGltZXJzKCk7XG4gICAgamVzdC5zZXRTeXN0ZW1UaW1lKG5ldyBEYXRlKCcyMDI0LTAxLTAxVDAwOjAwOjAwWicpKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LnVzZVJlYWxUaW1lcnMoKTtcbiAgfSk7XG5cbiAgaXQoJ3ByZXNlcnZlcyBzdGFydGVkQXQgd2hlbiB0aGUgYmFzZSBzdGF0dXMgdGV4dCBzdGF5cyB0aGUgc2FtZScsICgpID0+IHtcbiAgICBjb25zdCB0cmFja2VyID0gbmV3IExpdmVTdGF0dXNUcmFja2VyKCk7XG5cbiAgICB0cmFja2VyLnNldEJhc2UoJ1JlYWR5IGZvciBwcm9tcHRzJyk7XG5cbiAgICBsZXQgY3VycmVudDogTGl2ZVN0YXR1c1N0YXRlIHwgbnVsbCA9IG51bGw7XG4gICAgY29uc3QgdW5zdWJzY3JpYmUgPSB0cmFja2VyLnN1YnNjcmliZSgoc3RhdGUpID0+IHtcbiAgICAgIGN1cnJlbnQgPSBzdGF0ZTtcbiAgICB9KTtcblxuICAgIGNvbnN0IGZpcnN0U3RhcnRlZEF0ID0gY3VycmVudD8uc3RhcnRlZEF0O1xuXG4gICAgLy8gTW92ZSB0aW1lIGZvcndhcmQgYW5kIHVwZGF0ZSB0aGUgYmFzZSBzdGF0dXMgd2l0aCB0aGUgc2FtZSB0ZXh0IGJ1dCBuZXcgZGV0YWlsXG4gICAgamVzdC5hZHZhbmNlVGltZXJzQnlUaW1lKDE1MDApO1xuICAgIHRyYWNrZXIuc2V0QmFzZSgnUmVhZHkgZm9yIHByb21wdHMnLCB7IGRldGFpbDogJ2RldGFpbHMgY2hhbmdlIHdpdGhvdXQgcmVzZXR0aW5nIHRpbWVyJyB9KTtcblxuICAgIGV4cGVjdChjdXJyZW50Py5zdGFydGVkQXQpLnRvQmUoZmlyc3RTdGFydGVkQXQpO1xuXG4gICAgdW5zdWJzY3JpYmUoKTtcbiAgfSk7XG5cbiAgaXQoJ3ByZXNlcnZlcyBzdGFydGVkQXQgd2hlbiB1cGRhdGluZyBhbiBleGlzdGluZyBvdmVycmlkZSB3aXRoIHRoZSBzYW1lIHRleHQnLCAoKSA9PiB7XG4gICAgY29uc3QgdHJhY2tlciA9IG5ldyBMaXZlU3RhdHVzVHJhY2tlcigpO1xuICAgIGxldCBjdXJyZW50OiBMaXZlU3RhdHVzU3RhdGUgfCBudWxsID0gbnVsbDtcblxuICAgIHRyYWNrZXIuc3Vic2NyaWJlKChzdGF0ZSkgPT4ge1xuICAgICAgY3VycmVudCA9IHN0YXRlO1xuICAgIH0pO1xuXG4gICAgdHJhY2tlci5wdXNoT3ZlcnJpZGUoJ3N0cmVhbWluZycsICdQcm9jZXNzaW5nJyk7XG4gICAgY29uc3QgZmlyc3RTdGFydGVkQXQgPSBjdXJyZW50Py5zdGFydGVkQXQ7XG5cbiAgICBqZXN0LmFkdmFuY2VUaW1lcnNCeVRpbWUoMTIwMCk7XG4gICAgdHJhY2tlci5wdXNoT3ZlcnJpZGUoJ3N0cmVhbWluZycsICdQcm9jZXNzaW5nJywgeyBkZXRhaWw6ICdzdGlsbCBydW5uaW5nJyB9KTtcblxuICAgIGV4cGVjdChjdXJyZW50Py5zdGFydGVkQXQpLnRvQmUoZmlyc3RTdGFydGVkQXQpO1xuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUFBLFdBQUEsR0FBQUMsT0FBQTtBQUVBQyxRQUFRLENBQUMsMEJBQTBCLEVBQUUsTUFBTTtFQUN6Q0MsVUFBVSxDQUFDLE1BQU07SUFDZkMsSUFBSSxDQUFDQyxhQUFhLENBQUMsQ0FBQztJQUNwQkQsSUFBSSxDQUFDRSxhQUFhLENBQUMsSUFBSUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLENBQUM7RUFDdEQsQ0FBQyxDQUFDO0VBRUZDLFNBQVMsQ0FBQyxNQUFNO0lBQ2RKLElBQUksQ0FBQ0ssYUFBYSxDQUFDLENBQUM7RUFDdEIsQ0FBQyxDQUFDO0VBRUZDLEVBQUUsQ0FBQyw4REFBOEQsRUFBRSxNQUFNO0lBQ3ZFLE1BQU1DLE9BQU8sR0FBRyxJQUFJQyw2QkFBaUIsQ0FBQyxDQUFDO0lBRXZDRCxPQUFPLENBQUNFLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQztJQUVwQyxJQUFJQyxPQUErQixHQUFHLElBQUk7SUFDMUMsTUFBTUMsV0FBVyxHQUFHSixPQUFPLENBQUNLLFNBQVMsQ0FBRUMsS0FBSyxJQUFLO01BQy9DSCxPQUFPLEdBQUdHLEtBQUs7SUFDakIsQ0FBQyxDQUFDO0lBRUYsTUFBTUMsY0FBYyxHQUFHSixPQUFPLEVBQUVLLFNBQVM7O0lBRXpDO0lBQ0FmLElBQUksQ0FBQ2dCLG1CQUFtQixDQUFDLElBQUksQ0FBQztJQUM5QlQsT0FBTyxDQUFDRSxPQUFPLENBQUMsbUJBQW1CLEVBQUU7TUFBRVEsTUFBTSxFQUFFO0lBQXlDLENBQUMsQ0FBQztJQUUxRkMsTUFBTSxDQUFDUixPQUFPLEVBQUVLLFNBQVMsQ0FBQyxDQUFDSSxJQUFJLENBQUNMLGNBQWMsQ0FBQztJQUUvQ0gsV0FBVyxDQUFDLENBQUM7RUFDZixDQUFDLENBQUM7RUFFRkwsRUFBRSxDQUFDLDJFQUEyRSxFQUFFLE1BQU07SUFDcEYsTUFBTUMsT0FBTyxHQUFHLElBQUlDLDZCQUFpQixDQUFDLENBQUM7SUFDdkMsSUFBSUUsT0FBK0IsR0FBRyxJQUFJO0lBRTFDSCxPQUFPLENBQUNLLFNBQVMsQ0FBRUMsS0FBSyxJQUFLO01BQzNCSCxPQUFPLEdBQUdHLEtBQUs7SUFDakIsQ0FBQyxDQUFDO0lBRUZOLE9BQU8sQ0FBQ2EsWUFBWSxDQUFDLFdBQVcsRUFBRSxZQUFZLENBQUM7SUFDL0MsTUFBTU4sY0FBYyxHQUFHSixPQUFPLEVBQUVLLFNBQVM7SUFFekNmLElBQUksQ0FBQ2dCLG1CQUFtQixDQUFDLElBQUksQ0FBQztJQUM5QlQsT0FBTyxDQUFDYSxZQUFZLENBQUMsV0FBVyxFQUFFLFlBQVksRUFBRTtNQUFFSCxNQUFNLEVBQUU7SUFBZ0IsQ0FBQyxDQUFDO0lBRTVFQyxNQUFNLENBQUNSLE9BQU8sRUFBRUssU0FBUyxDQUFDLENBQUNJLElBQUksQ0FBQ0wsY0FBYyxDQUFDO0VBQ2pELENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==