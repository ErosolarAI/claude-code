{"version":3,"names":["_nodeAsync_hooks","require","_nodePath","_schemaValidator","_toolPreconditions","_resultVerification","_debugLogger","_toolExecutionIO","globalPerformanceMonitor","startOperation","_name","end","getMetrics","recordToolError","_call","_error","startToolCall","toolExecutionContext","AsyncLocalStorage","reportToolProgress","progress","context","getStore","observer","onToolProgress","current","Number","isFinite","Math","max","total","undefined","call","message","CACHEABLE_TOOLS","Set","buildOptimizationHint","warning","code","suggestion","EDIT_WITHOUT_READ","ToolRuntimeUtils","exports","_ToolRuntimeUtils","createToolDefinition","definition","createToolSuite","suite","isToolDefinition","__tool","expectedSchema","ToolRuntime","registry","Map","registrationOrder","cache","toolHistory","maxHistorySize","diffSnapshots","maxDiffSnapshots","maxDiffSnapshotLength","constructor","baseTools","options","io","defaultToolIO","contextManager","snapshotDir","join","process","cwd","enableCache","cacheTTLMs","length","registerSuite","id","description","tools","trim","Error","unregisterSuite","addTool","name","record","entries","suiteId","delete","removeFromOrder","listProviderTools","map","get","filter","Boolean","parameters","execute","_context","rawArgs","normalizeToolArguments","arguments","args","coerceToolArguments","augmentedCall","onToolError","isCacheable","cacheable","has","cacheTtl","cacheTtlMs","floor","canUseCache","cacheKey","getCacheKey","cached","Date","now","timestamp","onCacheHit","onToolResult","result","recordToolHistory","toolName","success","hasOutput","hasNonEmptyOutput","onToolStart","finishToolCall","validateToolArguments","preflightWarnings","validateToolPreconditions","onToolWarning","aiFlowWarnings","validateAIFlowPatterns","optimizationHints","seenOptimizationCodes","hint","add","push","run","handler","output","JSON","stringify","snapshotCandidate","truncated","truncateToolOutput","wasTruncated","content","env","logDebug","originalLength","truncatedLength","recordDiffSnapshot","set","error","formatted","ToolArgumentValidationError","String","clearCache","clear","getCacheStats","totalSize","entry","values","size","clearToolHistory","getToolHistory","shift","clearDiffSnapshots","getDiffSnapshots","owner","index","indexOf","splice","command","findGitDiffCommand","safeTruncate","writeFile","dir","filename","abs","hashString","fullPath","ensureDir","extractCommands","isGitDiffCommand","commands","commandList","Array","isArray","value","test","createDefaultToolRuntime","toolSuites","runtime","Object","fromEntries","isRecord","trimmed","parsed","parse","hash","i","charCodeAt"],"sources":["toolRuntime.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-namespace */\nimport { AsyncLocalStorage } from 'node:async_hooks';\nimport { join } from 'node:path';\nimport { type ProviderToolDefinition, type ToolCallRequest, type JSONSchemaObject } from './types.js';\nimport { ToolArgumentValidationError, coerceToolArguments, validateToolArguments } from './schemaValidator.js';\nimport { ContextManager } from './contextManager.js';\n// Performance monitor stub (legacy module removed)\nconst globalPerformanceMonitor = {\n  startOperation: (_name: string) => ({ end: () => {} }),\n  getMetrics: () => ({}),\n  recordToolError: (_call: unknown, _error: unknown) => {},\n  startToolCall: (_call: unknown) => () => {},\n};\nimport { validateToolPreconditions, validateAIFlowPatterns, EDIT_WITHOUT_READ, type PreflightWarning } from './toolPreconditions.js';\nimport { safeTruncate } from './resultVerification.js';\nimport { logDebug } from '../utils/debugLogger.js';\nimport {\n  type ToolDefinition,\n  type ToolSuite,\n  type ToolHandler,\n  type ToolExecutionContext,\n  type ToolRuntimeObserver,\n  type ToolRuntimeOptions,\n  type ToolExecutionStore,\n  type CacheEntry,\n  type ToolHistoryEntry,\n  type DiffSnapshotRecord,\n  type ToolProgressUpdate,\n  type ToolExecutionIO,\n} from './toolRuntimeTypes.js';\nimport { defaultToolIO } from './toolExecutionIO.js';\nexport type {\n  ToolDefinition,\n  ToolSuite,\n  ToolHandler,\n  ToolExecutionContext,\n  ToolRuntimeObserver,\n  ToolRuntimeOptions,\n  ToolExecutionStore,\n  CacheEntry,\n  ToolHistoryEntry,\n  DiffSnapshotRecord,\n  ToolProgressUpdate,\n  ToolExecutionIO,\n} from './toolRuntimeTypes.js';\n\ninterface ToolRecord {\n  suiteId: string;\n  definition: ToolDefinition;\n}\n\nconst toolExecutionContext = new AsyncLocalStorage<ToolExecutionStore>();\n\n/**\n * Report incremental progress for the currently executing tool.\n * Tools can call this to surface live status updates (e.g., indexing files).\n */\nexport function reportToolProgress(progress: ToolProgressUpdate): void {\n  const context = toolExecutionContext.getStore();\n  if (!context?.observer?.onToolProgress) {\n    return;\n  }\n\n  const current = Number.isFinite(progress.current) ? Math.max(0, progress.current) : 0;\n  const total = progress.total !== undefined ? Math.max(current, progress.total) : current;\n\n  try {\n    context.observer.onToolProgress(context.call, {\n      current,\n      total,\n      message: progress.message,\n    });\n  } catch {\n    // Swallow observer errors so they don't break tool execution\n  }\n}\n\n// Idempotent tools that can be safely cached\nconst CACHEABLE_TOOLS = new Set([\n  'Read',\n  'read_file',\n  'Glob',\n  'glob_search',\n  'Grep',\n  'grep_search',\n  'find_definition',\n  'analyze_code_quality',\n  'extract_exports',\n]);\n\nfunction buildOptimizationHint(\n  warning: PreflightWarning | { code?: string; suggestion?: string; message: string }\n): string | null {\n  const code = warning.code;\n  const suggestion = warning.suggestion || warning.message;\n\n  switch (code) {\n    case 'SEARCH_BROAD_PATTERN':\n    case 'SEARCH_CONTEXT_OVERFLOW_RISK':\n      return (\n        `\\n\\n<optimization-hint>\\n` +\n        `⚡ SEARCH: ${suggestion}\\n` +\n        `</optimization-hint>`\n      );\n    case EDIT_WITHOUT_READ:\n    case 'EDIT_PLACEHOLDER':\n      return (\n        `\\n\\n<optimization-hint>\\n` +\n        `⚡ EDIT: Read the file first to copy exact whitespace. ${suggestion}\\n` +\n        `</optimization-hint>`\n      );\n    case 'NPM_INCOMPLETE_WORKFLOW':\n      return (\n        `\\n\\n<optimization-hint>\\n` +\n        `⚡ PUBLISH: ${suggestion}\\n` +\n        `</optimization-hint>`\n      );\n    default:\n      return null;\n  }\n}\n\n/**\n * Type-safe utility functions for tool runtime operations\n */\nexport namespace ToolRuntimeUtils {\n  /**\n   * Creates a type-safe tool definition with inferred parameter types\n   */\n  export function createToolDefinition<T extends Record<string, unknown>>(\n    definition: ToolDefinition<T>\n  ): ToolDefinition<T> {\n    return definition;\n  }\n\n  /**\n   * Creates a type-safe tool suite with inferred tool types\n   */\n  export function createToolSuite(\n    suite: ToolSuite\n  ): ToolSuite {\n    return suite;\n  }\n\n  /**\n   * Type guard to check if a tool definition matches expected parameter schema\n   */\n  export function isToolDefinition(\n    __tool: ToolDefinition,\n    expectedSchema?: JSONSchemaObject\n  ): boolean {\n    if (!expectedSchema) return true;\n    // In a real implementation, this would validate against the schema\n    return true;\n  }\n}\n\n/**\n * Interface describing the public API of ToolRuntime.\n * Used by wrapper implementations like RestrictedToolRuntime.\n */\nexport interface IToolRuntime {\n  listProviderTools(): ProviderToolDefinition[];\n  execute(call: ToolCallRequest, context?: { profileName?: string; provider?: string; model?: string }): Promise<string>;\n  registerSuite(suite: ToolSuite): void;\n  unregisterSuite(id: string): void;\n  clearCache(): void;\n  getCacheStats(): { size: number; entries: number };\n  clearToolHistory(): void;\n  getToolHistory(): readonly ToolHistoryEntry[];\n  clearDiffSnapshots(): void;\n  getDiffSnapshots(): readonly DiffSnapshotRecord[];\n}\n\nexport class ToolRuntime implements IToolRuntime {\n  private readonly registry = new Map<string, ToolRecord>();\n  private readonly registrationOrder: string[] = [];\n  private readonly observer: ToolRuntimeObserver | null;\n  private readonly contextManager: ContextManager | null;\n  private readonly io: ToolExecutionIO;\n  private readonly snapshotDir: string | null;\n  private readonly cache = new Map<string, CacheEntry>();\n  private readonly enableCache: boolean;\n  private readonly cacheTTLMs: number;\n  private readonly toolHistory: ToolHistoryEntry[] = [];\n  private readonly maxHistorySize = 50; // Keep last 50 tool calls for AI flow pattern detection\n  private readonly diffSnapshots: DiffSnapshotRecord[] = [];\n  private readonly maxDiffSnapshots = 5; // Keep only the most recent git diff outputs\n  private readonly maxDiffSnapshotLength = 4000;\n\n  constructor(baseTools: ToolDefinition[] = [], options: ToolRuntimeOptions = {}, io: ToolExecutionIO = defaultToolIO) {\n    this.observer = options.observer ?? null;\n    this.contextManager = options.contextManager ?? null;\n    this.io = options.io ?? io;\n    this.snapshotDir = options.snapshotDir ?? join(process.cwd(), '.agi', 'tool-snapshots');\n    this.enableCache = options.enableCache ?? true;\n    this.cacheTTLMs = options.cacheTTLMs ?? 5 * 60 * 1000; // 5 minutes default\n    if (baseTools.length) {\n      this.registerSuite({\n        id: 'runtime.core',\n        description: 'Core runtime metadata tools',\n        tools: baseTools,\n      });\n    }\n  }\n\n  registerSuite(suite: ToolSuite): void {\n    if (!suite?.id?.trim()) {\n      throw new Error('Tool suite id cannot be blank.');\n    }\n    this.unregisterSuite(suite.id);\n    for (const definition of suite.tools ?? []) {\n      this.addTool(definition, suite.id);\n    }\n  }\n\n  unregisterSuite(id: string): void {\n    if (!id?.trim()) {\n      return;\n    }\n    for (const [name, record] of this.registry.entries()) {\n      if (record.suiteId === id) {\n        this.registry.delete(name);\n        this.removeFromOrder(name);\n      }\n    }\n  }\n\n  listProviderTools(): ProviderToolDefinition[] {\n    return this.registrationOrder\n      .map((name) => this.registry.get(name))\n      .filter((record): record is ToolRecord => Boolean(record))\n      .map(({ definition }) => ({\n        name: definition.name,\n        description: definition.description,\n        ...(definition.parameters && { parameters: definition.parameters }),\n      }));\n  }\n\n  async execute(call: ToolCallRequest, _context?: { profileName?: string; provider?: string; model?: string }): Promise<string> {\n    const record = this.registry.get(call.name);\n    const rawArgs = normalizeToolArguments(call.arguments);\n    const args = coerceToolArguments(record?.definition.parameters, rawArgs);\n    const augmentedCall = { ...call, args };\n\n    if (!record) {\n      const message = `Tool \"${call.name}\" is not available.`;\n      this.observer?.onToolError?.(augmentedCall, message);\n      globalPerformanceMonitor.recordToolError(call, message);\n      return message;\n    }\n\n    // Check if tool is cacheable\n    const isCacheable = record.definition.cacheable ?? CACHEABLE_TOOLS.has(call.name);\n    const cacheTtl =\n      typeof record.definition.cacheTtlMs === 'number' && Number.isFinite(record.definition.cacheTtlMs)\n        ? Math.max(0, Math.floor(record.definition.cacheTtlMs))\n        : this.cacheTTLMs;\n    const canUseCache = this.enableCache && isCacheable && cacheTtl > 0;\n\n    // Try to get from cache\n    if (canUseCache) {\n      const cacheKey = this.getCacheKey({ ...call, arguments: args });\n      const cached = this.cache.get(cacheKey);\n\n      if (cached && Date.now() - cached.timestamp < cacheTtl) {\n        this.observer?.onCacheHit?.(augmentedCall);\n        this.observer?.onToolResult?.(augmentedCall, cached.result);\n\n        // Record cache hit as successful execution with 0ms time\n        globalPerformanceMonitor.startToolCall(call)();\n        this.recordToolHistory({\n          toolName: call.name,\n          args,\n          timestamp: Date.now(),\n          success: true,\n          hasOutput: hasNonEmptyOutput(cached.result),\n        });\n        return cached.result;\n      }\n    }\n\n    this.observer?.onToolStart?.(augmentedCall);\n\n    // Start performance monitoring\n    const finishToolCall = globalPerformanceMonitor.startToolCall(call);\n\n    try {\n      validateToolArguments(record.definition.name, record.definition.parameters, args);\n\n      // Pre-flight AI flow validation - catch common tool usage failures\n      const preflightWarnings = validateToolPreconditions(call.name, args);\n      for (const warning of preflightWarnings) {\n        this.observer?.onToolWarning?.(augmentedCall, warning);\n      }\n\n      // Advanced AI flow pattern validation using tool history\n      const aiFlowWarnings = validateAIFlowPatterns(call.name, args, this.toolHistory);\n      for (const warning of aiFlowWarnings) {\n        this.observer?.onToolWarning?.(augmentedCall, warning);\n      }\n\n      // Collect optimization hints to inject into result\n      const optimizationHints: string[] = [];\n      const seenOptimizationCodes = new Set<string>();\n      for (const warning of [...preflightWarnings, ...aiFlowWarnings]) {\n        if (warning.code && seenOptimizationCodes.has(warning.code)) {\n          continue;\n        }\n        const hint = buildOptimizationHint(warning);\n        if (hint) {\n          if (warning.code) {\n            seenOptimizationCodes.add(warning.code);\n          }\n          optimizationHints.push(hint);\n        }\n      }\n\n      const result = await toolExecutionContext.run(\n        { call: augmentedCall, observer: this.observer ?? undefined },\n        async () => record.definition.handler(args)\n      );\n      let output = typeof result === 'string' ? result : JSON.stringify(result, null, 2);\n      let snapshotCandidate = output;\n\n      // Truncate output if context manager is available\n      if (this.contextManager) {\n        const truncated = this.contextManager.truncateToolOutput(output, call.name);\n        if (truncated.wasTruncated) {\n          output = truncated.content;\n          // Log truncation for debugging\n          if (process.env['DEBUG_CONTEXT']) {\n            logDebug(\n              `[Context Manager] Truncated ${call.name} output: ${truncated.originalLength} -> ${truncated.truncatedLength} chars`\n            );\n          }\n        }\n        snapshotCandidate = output;\n      }\n\n      this.recordDiffSnapshot(args, snapshotCandidate);\n\n      // Cache the result if cacheable\n      if (canUseCache) {\n        const cacheKey = this.getCacheKey({ ...call, arguments: args });\n        this.cache.set(cacheKey, {\n          result: output,\n          timestamp: Date.now(),\n        });\n      }\n\n      // Append optimization hints to guide future LLM behavior\n      if (optimizationHints.length > 0) {\n        output = output + optimizationHints.join('');\n      }\n\n      this.observer?.onToolResult?.(augmentedCall, output);\n\n      this.recordToolHistory({\n        toolName: call.name,\n        args,\n        timestamp: Date.now(),\n        success: true,\n        hasOutput: hasNonEmptyOutput(output),\n      });\n\n      // Record successful execution\n      finishToolCall();\n      return output;\n    } catch (error) {\n      let formatted: string;\n      if (error instanceof ToolArgumentValidationError) {\n        formatted = error.message;\n      } else {\n        const message = error instanceof Error ? error.message : String(error);\n        formatted = `Failed to run \"${call.name}\": ${message}`;\n      }\n      this.observer?.onToolError?.(augmentedCall, formatted);\n      this.recordToolHistory({\n        toolName: call.name,\n        args,\n        timestamp: Date.now(),\n        success: false,\n        hasOutput: hasNonEmptyOutput(formatted),\n        error: formatted,\n      });\n      \n      // Record failed execution\n      globalPerformanceMonitor.recordToolError(call, formatted);\n      return formatted;\n    }\n  }\n\n  private getCacheKey(call: ToolCallRequest): string {\n    return `${call.name}:${JSON.stringify(call.arguments)}`;\n  }\n\n  clearCache(): void {\n    this.cache.clear();\n  }\n\n  getCacheStats(): { size: number; entries: number } {\n    let totalSize = 0;\n    for (const entry of this.cache.values()) {\n      totalSize += entry.result.length;\n    }\n    return {\n      size: totalSize,\n      entries: this.cache.size,\n    };\n  }\n\n  clearToolHistory(): void {\n    this.toolHistory.length = 0;\n  }\n\n  getToolHistory(): readonly ToolHistoryEntry[] {\n    return this.toolHistory;\n  }\n\n  private recordToolHistory(entry: ToolHistoryEntry): void {\n    this.toolHistory.push(entry);\n    if (this.toolHistory.length > this.maxHistorySize) {\n      this.toolHistory.shift();\n    }\n  }\n\n  clearDiffSnapshots(): void {\n    this.diffSnapshots.length = 0;\n  }\n\n  getDiffSnapshots(): readonly DiffSnapshotRecord[] {\n    return this.diffSnapshots;\n  }\n\n  private addTool(definition: ToolDefinition, suiteId: string): void {\n    if (!definition?.name?.trim()) {\n      throw new Error(`Tool names cannot be blank (suite \"${suiteId}\").`);\n    }\n    if (this.registry.has(definition.name)) {\n      const owner = this.registry.get(definition.name)?.suiteId ?? 'unknown';\n      throw new Error(`Tool \"${definition.name}\" already registered by suite \"${owner}\".`);\n    }\n    this.registry.set(definition.name, {\n      suiteId,\n      definition,\n    });\n    this.registrationOrder.push(definition.name);\n  }\n\n  private removeFromOrder(name: string): void {\n    const index = this.registrationOrder.indexOf(name);\n    if (index >= 0) {\n      this.registrationOrder.splice(index, 1);\n    }\n  }\n\n  private recordDiffSnapshot(args: Record<string, unknown>, output: string): void {\n    const command = this.findGitDiffCommand(args);\n    if (!command || !output) {\n      return;\n    }\n\n    this.diffSnapshots.push({\n      command,\n      output: safeTruncate(output, this.maxDiffSnapshotLength, 'git-diff'),\n      timestamp: Date.now(),\n    });\n\n    if (this.snapshotDir && this.io.writeFile) {\n      const dir = this.snapshotDir;\n      const filename = `diff-${Date.now()}-${Math.abs(hashString(command))}.txt`;\n      const fullPath = join(dir, filename);\n      try {\n        if (this.io.ensureDir) {\n          this.io.ensureDir(dir);\n        }\n        this.io.writeFile(fullPath, output);\n      } catch {\n        // best-effort persistence; ignore errors\n      }\n    }\n\n    if (this.diffSnapshots.length > this.maxDiffSnapshots) {\n      this.diffSnapshots.shift();\n    }\n  }\n\n  private findGitDiffCommand(args: Record<string, unknown>): string | null {\n    for (const command of this.extractCommands(args)) {\n      if (this.isGitDiffCommand(command)) {\n        return command;\n      }\n    }\n    return null;\n  }\n\n  private extractCommands(args: Record<string, unknown>): string[] {\n    const commands: string[] = [];\n\n    const command = args['command'];\n    if (typeof command === 'string' && command.trim()) {\n      commands.push(command.trim());\n    }\n\n    const commandList = args['commands'];\n    if (Array.isArray(commandList)) {\n      for (const value of commandList) {\n        if (typeof value === 'string' && value.trim()) {\n          commands.push(value.trim());\n        }\n      }\n    }\n\n    return commands;\n  }\n\n  private isGitDiffCommand(command: string): boolean {\n    return /\\bgit\\s+(?:--no-pager\\s+)?(?:diff|show)\\b/i.test(command);\n  }\n}\n\nexport function createDefaultToolRuntime(\n  context: ToolExecutionContext,\n  toolSuites: ToolSuite[] = [],\n  options: ToolRuntimeOptions = {}\n): ToolRuntime {\n  // Start with no default introspection tools - they waste tokens\n  // Model knows its capabilities from tool definitions\n  const runtime = new ToolRuntime([], options);\n\n  for (const suite of toolSuites) {\n    runtime.registerSuite(suite);\n  }\n\n  return runtime;\n}\n\n// Removed unused introspection tools (context_snapshot, capabilities_overview, profile_details)\n// Model already knows capabilities from tool definitions; these just wasted tokens\n\nfunction hasNonEmptyOutput(output: string): boolean {\n  return typeof output === 'string' && output.trim().length > 0;\n}\n\nfunction normalizeToolArguments(value: unknown): Record<string, unknown> {\n  if (value instanceof Map) {\n    return Object.fromEntries(value.entries());\n  }\n  if (isRecord(value)) {\n    return value;\n  }\n  if (typeof value === 'string') {\n    const trimmed = value.trim();\n    if (!trimmed) {\n      return {};\n    }\n    try {\n      const parsed = JSON.parse(trimmed);\n      return isRecord(parsed) ? parsed : {};\n    } catch {\n      return {};\n    }\n  }\n  return {};\n}\n\nfunction isRecord(value: unknown): value is Record<string, unknown> {\n  return typeof value === 'object' && value !== null && !Array.isArray(value);\n}\n\nfunction hashString(value: string): number {\n  let hash = 0;\n  for (let i = 0; i < value.length; i++) {\n    hash = (hash << 5) - hash + value.charCodeAt(i);\n    hash |= 0;\n  }\n  return hash;\n}\n"],"mappings":"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","ignoreList":[]}