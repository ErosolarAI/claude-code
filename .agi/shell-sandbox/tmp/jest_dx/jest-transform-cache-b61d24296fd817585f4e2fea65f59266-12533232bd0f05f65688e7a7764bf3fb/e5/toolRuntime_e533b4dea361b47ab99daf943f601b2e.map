{"version":3,"names":["_nodeAsync_hooks","require","_schemaValidator","_toolPreconditions","_resultVerification","_debugLogger","toolExecutionContext","AsyncLocalStorage","reportToolProgress","progress","context","getStore","observer","onToolProgress","current","Number","isFinite","Math","max","total","undefined","call","message","CACHEABLE_TOOLS","Set","buildOptimizationHint","warning","code","suggestion","EDIT_WITHOUT_READ","ToolRuntimeUtils","exports","_ToolRuntimeUtils","createToolDefinition","definition","createToolSuite","suite","isToolDefinition","__tool","expectedSchema","ToolRuntime","registry","Map","registrationOrder","cache","toolHistory","maxHistorySize","diffSnapshots","maxDiffSnapshots","maxDiffSnapshotLength","constructor","baseTools","options","contextManager","enableCache","cacheTTLMs","length","registerSuite","id","description","tools","trim","Error","unregisterSuite","addTool","name","record","entries","suiteId","delete","removeFromOrder","listProviderTools","map","get","filter","Boolean","parameters","execute","_context","rawArgs","normalizeToolArguments","arguments","args","coerceToolArguments","augmentedCall","onToolError","isCacheable","cacheable","has","cacheTtl","cacheTtlMs","floor","canUseCache","cacheKey","getCacheKey","cached","Date","now","timestamp","onCacheHit","onToolResult","result","recordToolHistory","toolName","success","hasOutput","hasNonEmptyOutput","onToolStart","validateToolArguments","preflightWarnings","validateToolPreconditions","onToolWarning","aiFlowWarnings","validateAIFlowPatterns","optimizationHints","seenOptimizationCodes","hint","add","push","run","handler","output","JSON","stringify","snapshotCandidate","truncated","truncateToolOutput","wasTruncated","content","process","env","logDebug","originalLength","truncatedLength","recordDiffSnapshot","set","join","error","formatted","ToolArgumentValidationError","String","clearCache","clear","getCacheStats","totalSize","entry","values","size","clearToolHistory","getToolHistory","shift","clearDiffSnapshots","getDiffSnapshots","owner","index","indexOf","splice","command","findGitDiffCommand","safeTruncate","extractCommands","isGitDiffCommand","commands","commandList","Array","isArray","value","test","createDefaultToolRuntime","toolSuites","runtime","Object","fromEntries","isRecord","trimmed","parsed","parse"],"sources":["toolRuntime.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-namespace */\nimport { AsyncLocalStorage } from 'node:async_hooks';\nimport {\n  type JSONSchemaObject,\n  type ProviderId,\n  type ProviderToolDefinition,\n  type ToolCallRequest,\n} from './types.js';\nimport {\n  ToolArgumentValidationError,\n  coerceToolArguments,\n  validateToolArguments,\n} from './schemaValidator.js';\nimport { ContextManager } from './contextManager.js';\n\nimport { validateToolPreconditions, validateAIFlowPatterns, EDIT_WITHOUT_READ, type PreflightWarning } from './toolPreconditions.js';\nimport { enhanceWithHallucinationGuard } from './hallucinationGuard.js';\nimport { safeTruncate } from './resultVerification.js';\nimport { logDebug } from '../utils/debugLogger.js';\n\n/**\n * Execution context for tool operations with strict TypeScript typing\n */\nexport interface ToolExecutionContext {\n  readonly profileName: string;\n  readonly provider: ProviderId;\n  readonly model: string;\n  readonly workspaceContext?: string | null;\n}\n\n/**\n * Type-safe tool observer with generic parameter inference for AI flow monitoring\n */\nexport interface ToolRuntimeObserver<T extends Record<string, unknown> = Record<string, unknown>> {\n  /** Called when tool execution begins */\n  onToolStart?(call: ToolCallRequest & { args: T }): void;\n  \n  /** Called when tool execution completes successfully */\n  onToolResult?(call: ToolCallRequest & { args: T }, output: string): void;\n  \n  /** Called when tool execution fails */\n  onToolError?(call: ToolCallRequest & { args: T }, error: string): void;\n  \n  /** Called when cached result is used instead of execution */\n  onCacheHit?(call: ToolCallRequest & { args: T }): void;\n  \n  /** Called for progress updates during long-running operations */\n  onToolProgress?(call: ToolCallRequest & { args: T }, progress: ToolProgressUpdate): void;\n  \n  /** Called for pre-flight warnings before tool execution */\n  onToolWarning?(call: ToolCallRequest & { args: T }, warning: PreflightWarning | string): void;\n}\n\ninterface ToolRuntimeOptions {\n  readonly observer?: ToolRuntimeObserver;\n  readonly contextManager?: ContextManager;\n  readonly enableCache?: boolean;\n  readonly cacheTTLMs?: number;\n}\n\n/**\n * Generic tool handler with parameter type inference for AI flow execution\n */\ntype ToolHandler<T extends Record<string, unknown> = Record<string, unknown>> = (\n  args: T\n) => Promise<string> | string;\n\n/**\n * Enhanced tool definition with parameter type safety for AI software engineering\n */\nexport interface ToolDefinition<T extends Record<string, unknown> = Record<string, unknown>> {\n  /** Unique identifier for the tool */\n  readonly name: string;\n  \n  /** Human-readable description for AI understanding */\n  readonly description: string;\n  \n  /** JSON Schema defining the tool's parameter structure */\n  readonly parameters?: JSONSchemaObject;\n  \n  /** Function that implements the tool's behavior */\n  readonly handler: ToolHandler<T>;\n  \n  /** Whether results can be cached for performance optimization */\n  readonly cacheable?: boolean;\n\n  /** Optional per-tool cache TTL in milliseconds (falls back to runtime default) */\n  readonly cacheTtlMs?: number;\n}\n\n/**\n * Collection of related tools grouped by functionality\n */\nexport interface ToolSuite {\n  /** Unique identifier for the tool suite */\n  readonly id: string;\n  \n  /** Human-readable description of the suite's purpose */\n  readonly description?: string;\n  \n  /** Array of tool definitions in this suite */\n  readonly tools: readonly ToolDefinition[];\n}\n\ninterface ToolRecord {\n  suiteId: string;\n  definition: ToolDefinition;\n}\n\ninterface CacheEntry {\n  result: string;\n  timestamp: number;\n}\n\nexport interface ToolHistoryEntry {\n  toolName: string;\n  args: Record<string, unknown>;\n  timestamp: number;\n  success: boolean;\n  hasOutput: boolean;\n  error?: string;\n}\n\nexport interface DiffSnapshotRecord {\n  command: string;\n  output: string;\n  timestamp: number;\n}\n\nexport interface ToolProgressUpdate {\n  current: number;\n  total?: number;\n  message?: string;\n}\n\ninterface ToolExecutionStore {\n  call: ToolCallRequest & { args: Record<string, unknown> };\n  observer?: ToolRuntimeObserver;\n}\n\nconst toolExecutionContext = new AsyncLocalStorage<ToolExecutionStore>();\n\n/**\n * Report incremental progress for the currently executing tool.\n * Tools can call this to surface live status updates (e.g., indexing files).\n */\nexport function reportToolProgress(progress: ToolProgressUpdate): void {\n  const context = toolExecutionContext.getStore();\n  if (!context?.observer?.onToolProgress) {\n    return;\n  }\n\n  const current = Number.isFinite(progress.current) ? Math.max(0, progress.current) : 0;\n  const total = progress.total !== undefined ? Math.max(current, progress.total) : current;\n\n  try {\n    context.observer.onToolProgress(context.call, {\n      current,\n      total,\n      message: progress.message,\n    });\n  } catch {\n    // Swallow observer errors so they don't break tool execution\n  }\n}\n\n// Idempotent tools that can be safely cached\nconst CACHEABLE_TOOLS = new Set([\n  'Read',\n  'read_file',\n  'Glob',\n  'glob_search',\n  'Grep',\n  'grep_search',\n  'find_definition',\n  'analyze_code_quality',\n  'extract_exports',\n]);\n\nfunction buildOptimizationHint(\n  warning: PreflightWarning | { code?: string; suggestion?: string; message: string }\n): string | null {\n  const code = warning.code;\n  const suggestion = warning.suggestion || warning.message;\n\n  switch (code) {\n    case 'SEARCH_BROAD_PATTERN':\n    case 'SEARCH_CONTEXT_OVERFLOW_RISK':\n      return (\n        `\\n\\n<optimization-hint>\\n` +\n        `⚡ SEARCH: ${suggestion}\\n` +\n        `</optimization-hint>`\n      );\n    case EDIT_WITHOUT_READ:\n    case 'EDIT_PLACEHOLDER':\n      return (\n        `\\n\\n<optimization-hint>\\n` +\n        `⚡ EDIT: Read the file first to copy exact whitespace. ${suggestion}\\n` +\n        `</optimization-hint>`\n      );\n    case 'NPM_INCOMPLETE_WORKFLOW':\n      return (\n        `\\n\\n<optimization-hint>\\n` +\n        `⚡ PUBLISH: ${suggestion}\\n` +\n        `</optimization-hint>`\n      );\n    default:\n      return null;\n  }\n}\n\n/**\n * Type-safe utility functions for tool runtime operations\n */\nexport namespace ToolRuntimeUtils {\n  /**\n   * Creates a type-safe tool definition with inferred parameter types\n   */\n  export function createToolDefinition<T extends Record<string, unknown>>(\n    definition: ToolDefinition<T>\n  ): ToolDefinition<T> {\n    return definition;\n  }\n\n  /**\n   * Creates a type-safe tool suite with inferred tool types\n   */\n  export function createToolSuite(\n    suite: ToolSuite\n  ): ToolSuite {\n    return suite;\n  }\n\n  /**\n   * Type guard to check if a tool definition matches expected parameter schema\n   */\n  export function isToolDefinition(\n    __tool: ToolDefinition,\n    expectedSchema?: JSONSchemaObject\n  ): boolean {\n    if (!expectedSchema) return true;\n    // In a real implementation, this would validate against the schema\n    return true;\n  }\n}\n\n/**\n * Interface describing the public API of ToolRuntime.\n * Used by wrapper implementations like RestrictedToolRuntime.\n */\nexport interface IToolRuntime {\n  listProviderTools(): ProviderToolDefinition[];\n  execute(call: ToolCallRequest, context?: { profileName?: string; provider?: string; model?: string }): Promise<string>;\n  registerSuite(suite: ToolSuite): void;\n  unregisterSuite(id: string): void;\n  clearCache(): void;\n  getCacheStats(): { size: number; entries: number };\n  clearToolHistory(): void;\n  getToolHistory(): readonly ToolHistoryEntry[];\n  clearDiffSnapshots(): void;\n  getDiffSnapshots(): readonly DiffSnapshotRecord[];\n}\n\nexport class ToolRuntime implements IToolRuntime {\n  private readonly registry = new Map<string, ToolRecord>();\n  private readonly registrationOrder: string[] = [];\n  private readonly observer: ToolRuntimeObserver | null;\n  private readonly contextManager: ContextManager | null;\n  private readonly cache = new Map<string, CacheEntry>();\n  private readonly enableCache: boolean;\n  private readonly cacheTTLMs: number;\n  private readonly toolHistory: ToolHistoryEntry[] = [];\n  private readonly maxHistorySize = 50; // Keep last 50 tool calls for AI flow pattern detection\n  private readonly diffSnapshots: DiffSnapshotRecord[] = [];\n  private readonly maxDiffSnapshots = 5; // Keep only the most recent git diff outputs\n  private readonly maxDiffSnapshotLength = 4000;\n\n  constructor(baseTools: ToolDefinition[] = [], options: ToolRuntimeOptions = {}) {\n    this.observer = options.observer ?? null;\n    this.contextManager = options.contextManager ?? null;\n    this.enableCache = options.enableCache ?? true;\n    this.cacheTTLMs = options.cacheTTLMs ?? 5 * 60 * 1000; // 5 minutes default\n    if (baseTools.length) {\n      this.registerSuite({\n        id: 'runtime.core',\n        description: 'Core runtime metadata tools',\n        tools: baseTools,\n      });\n    }\n  }\n\n  registerSuite(suite: ToolSuite): void {\n    if (!suite?.id?.trim()) {\n      throw new Error('Tool suite id cannot be blank.');\n    }\n    this.unregisterSuite(suite.id);\n    for (const definition of suite.tools ?? []) {\n      this.addTool(definition, suite.id);\n    }\n  }\n\n  unregisterSuite(id: string): void {\n    if (!id?.trim()) {\n      return;\n    }\n    for (const [name, record] of this.registry.entries()) {\n      if (record.suiteId === id) {\n        this.registry.delete(name);\n        this.removeFromOrder(name);\n      }\n    }\n  }\n\n  listProviderTools(): ProviderToolDefinition[] {\n    return this.registrationOrder\n      .map((name) => this.registry.get(name))\n      .filter((record): record is ToolRecord => Boolean(record))\n      .map(({ definition }) => ({\n        name: definition.name,\n        description: definition.description,\n        ...(definition.parameters && { parameters: definition.parameters }),\n      }));\n  }\n\n  async execute(call: ToolCallRequest, _context?: { profileName?: string; provider?: string; model?: string }): Promise<string> {\n    const record = this.registry.get(call.name);\n    const rawArgs = normalizeToolArguments(call.arguments);\n    const args = coerceToolArguments(record?.definition.parameters, rawArgs);\n    const augmentedCall = { ...call, args };\n\n    if (!record) {\n      const message = `Tool \"${call.name}\" is not available.`;\n      this.observer?.onToolError?.(augmentedCall, message);\n      // Performance monitoring removed - no legacy components\n      return message;\n    }\n\n    // Check if tool is cacheable\n    const isCacheable = record.definition.cacheable ?? CACHEABLE_TOOLS.has(call.name);\n    const cacheTtl =\n      typeof record.definition.cacheTtlMs === 'number' && Number.isFinite(record.definition.cacheTtlMs)\n        ? Math.max(0, Math.floor(record.definition.cacheTtlMs))\n        : this.cacheTTLMs;\n    const canUseCache = this.enableCache && isCacheable && cacheTtl > 0;\n\n    // Try to get from cache\n    if (canUseCache) {\n      const cacheKey = this.getCacheKey({ ...call, arguments: args });\n      const cached = this.cache.get(cacheKey);\n\n      if (cached && Date.now() - cached.timestamp < cacheTtl) {\n        this.observer?.onCacheHit?.(augmentedCall);\n        this.observer?.onToolResult?.(augmentedCall, cached.result);\n\n        // Record cache hit as successful execution with 0ms time\n        // Performance monitoring removed - no legacy components\n        this.recordToolHistory({\n          toolName: call.name,\n          args,\n          timestamp: Date.now(),\n          success: true,\n          hasOutput: hasNonEmptyOutput(cached.result),\n        });\n        return cached.result;\n      }\n    }\n\n    this.observer?.onToolStart?.(augmentedCall);\n\n    // Performance monitoring removed - no legacy components\n\n    try {\n      validateToolArguments(record.definition.name, record.definition.parameters, args);\n\n      // Pre-flight AI flow validation - catch common tool usage failures\n      const preflightWarnings = validateToolPreconditions(call.name, args);\n      for (const warning of preflightWarnings) {\n        this.observer?.onToolWarning?.(augmentedCall, warning);\n      }\n\n      // Advanced AI flow pattern validation using tool history\n      const aiFlowWarnings = validateAIFlowPatterns(call.name, args, this.toolHistory);\n      for (const warning of aiFlowWarnings) {\n        this.observer?.onToolWarning?.(augmentedCall, warning);\n      }\n\n      // Collect optimization hints to inject into result\n      const optimizationHints: string[] = [];\n      const seenOptimizationCodes = new Set<string>();\n      for (const warning of [...preflightWarnings, ...aiFlowWarnings]) {\n        if (warning.code && seenOptimizationCodes.has(warning.code)) {\n          continue;\n        }\n        const hint = buildOptimizationHint(warning);\n        if (hint) {\n          if (warning.code) {\n            seenOptimizationCodes.add(warning.code);\n          }\n          optimizationHints.push(hint);\n        }\n      }\n\n      const result = await toolExecutionContext.run(\n        { call: augmentedCall, observer: this.observer ?? undefined },\n        async () => record.definition.handler(args)\n      );\n      let output = typeof result === 'string' ? result : JSON.stringify(result, null, 2);\n      let snapshotCandidate = output;\n\n      // Truncate output if context manager is available\n      if (this.contextManager) {\n        const truncated = this.contextManager.truncateToolOutput(output, call.name);\n        if (truncated.wasTruncated) {\n          output = truncated.content;\n          // Log truncation for debugging\n          if (process.env['DEBUG_CONTEXT']) {\n            logDebug(\n              `[Context Manager] Truncated ${call.name} output: ${truncated.originalLength} -> ${truncated.truncatedLength} chars`\n            );\n          }\n        }\n        snapshotCandidate = output;\n      }\n\n      this.recordDiffSnapshot(args, snapshotCandidate);\n\n      // Cache the result if cacheable\n      if (canUseCache) {\n        const cacheKey = this.getCacheKey({ ...call, arguments: args });\n        this.cache.set(cacheKey, {\n          result: output,\n          timestamp: Date.now(),\n        });\n      }\n\n      // Append optimization hints to guide future LLM behavior\n      if (optimizationHints.length > 0) {\n        output = output + optimizationHints.join('');\n      }\n\n      this.observer?.onToolResult?.(augmentedCall, output);\n\n      this.recordToolHistory({\n        toolName: call.name,\n        args,\n        timestamp: Date.now(),\n        success: true,\n        hasOutput: hasNonEmptyOutput(output),\n      });\n\n      // Record successful execution\n      // Performance monitoring removed - no legacy components\n      return output;\n    } catch (error) {\n      let formatted: string;\n      if (error instanceof ToolArgumentValidationError) {\n        formatted = error.message;\n      } else {\n        const message = error instanceof Error ? error.message : String(error);\n        formatted = `Failed to run \"${call.name}\": ${message}`;\n      }\n      this.observer?.onToolError?.(augmentedCall, formatted);\n      this.recordToolHistory({\n        toolName: call.name,\n        args,\n        timestamp: Date.now(),\n        success: false,\n        hasOutput: hasNonEmptyOutput(formatted),\n        error: formatted,\n      });\n      \n      // Record failed execution - no legacy performance monitoring\n      return formatted;\n    }\n  }\n\n  private getCacheKey(call: ToolCallRequest): string {\n    return `${call.name}:${JSON.stringify(call.arguments)}`;\n  }\n\n  clearCache(): void {\n    this.cache.clear();\n  }\n\n  getCacheStats(): { size: number; entries: number } {\n    let totalSize = 0;\n    for (const entry of this.cache.values()) {\n      totalSize += entry.result.length;\n    }\n    return {\n      size: totalSize,\n      entries: this.cache.size,\n    };\n  }\n\n  clearToolHistory(): void {\n    this.toolHistory.length = 0;\n  }\n\n  getToolHistory(): readonly ToolHistoryEntry[] {\n    return this.toolHistory;\n  }\n\n  private recordToolHistory(entry: ToolHistoryEntry): void {\n    this.toolHistory.push(entry);\n    if (this.toolHistory.length > this.maxHistorySize) {\n      this.toolHistory.shift();\n    }\n  }\n\n  clearDiffSnapshots(): void {\n    this.diffSnapshots.length = 0;\n  }\n\n  getDiffSnapshots(): readonly DiffSnapshotRecord[] {\n    return this.diffSnapshots;\n  }\n\n  private addTool(definition: ToolDefinition, suiteId: string): void {\n    if (!definition?.name?.trim()) {\n      throw new Error(`Tool names cannot be blank (suite \"${suiteId}\").`);\n    }\n    if (this.registry.has(definition.name)) {\n      const owner = this.registry.get(definition.name)?.suiteId ?? 'unknown';\n      throw new Error(`Tool \"${definition.name}\" already registered by suite \"${owner}\".`);\n    }\n    this.registry.set(definition.name, {\n      suiteId,\n      definition,\n    });\n    this.registrationOrder.push(definition.name);\n  }\n\n  private removeFromOrder(name: string): void {\n    const index = this.registrationOrder.indexOf(name);\n    if (index >= 0) {\n      this.registrationOrder.splice(index, 1);\n    }\n  }\n\n  private recordDiffSnapshot(args: Record<string, unknown>, output: string): void {\n    const command = this.findGitDiffCommand(args);\n    if (!command || !output) {\n      return;\n    }\n\n    this.diffSnapshots.push({\n      command,\n      output: safeTruncate(output, this.maxDiffSnapshotLength, 'git-diff'),\n      timestamp: Date.now(),\n    });\n\n    if (this.diffSnapshots.length > this.maxDiffSnapshots) {\n      this.diffSnapshots.shift();\n    }\n  }\n\n  private findGitDiffCommand(args: Record<string, unknown>): string | null {\n    for (const command of this.extractCommands(args)) {\n      if (this.isGitDiffCommand(command)) {\n        return command;\n      }\n    }\n    return null;\n  }\n\n  private extractCommands(args: Record<string, unknown>): string[] {\n    const commands: string[] = [];\n\n    const command = args['command'];\n    if (typeof command === 'string' && command.trim()) {\n      commands.push(command.trim());\n    }\n\n    const commandList = args['commands'];\n    if (Array.isArray(commandList)) {\n      for (const value of commandList) {\n        if (typeof value === 'string' && value.trim()) {\n          commands.push(value.trim());\n        }\n      }\n    }\n\n    return commands;\n  }\n\n  private isGitDiffCommand(command: string): boolean {\n    return /\\bgit\\s+(?:--no-pager\\s+)?(?:diff|show)\\b/i.test(command);\n  }\n}\n\nexport function createDefaultToolRuntime(\n  context: ToolExecutionContext,\n  toolSuites: ToolSuite[] = [],\n  options: ToolRuntimeOptions = {}\n): ToolRuntime {\n  // Start with no default introspection tools - they waste tokens\n  // Model knows its capabilities from tool definitions\n  const runtime = new ToolRuntime([], options);\n\n  for (const suite of toolSuites) {\n    runtime.registerSuite(suite);\n  }\n\n  return runtime;\n}\n\n// Removed unused introspection tools (context_snapshot, capabilities_overview, profile_details)\n// Model already knows capabilities from tool definitions; these just wasted tokens\n\nfunction hasNonEmptyOutput(output: string): boolean {\n  return typeof output === 'string' && output.trim().length > 0;\n}\n\nfunction normalizeToolArguments(value: unknown): Record<string, unknown> {\n  if (value instanceof Map) {\n    return Object.fromEntries(value.entries());\n  }\n  if (isRecord(value)) {\n    return value;\n  }\n  if (typeof value === 'string') {\n    const trimmed = value.trim();\n    if (!trimmed) {\n      return {};\n    }\n    try {\n      const parsed = JSON.parse(trimmed);\n      return isRecord(parsed) ? parsed : {};\n    } catch {\n      return {};\n    }\n  }\n  return {};\n}\n\nfunction isRecord(value: unknown): value is Record<string, unknown> {\n  return typeof value === 'object' && value !== null && !Array.isArray(value);\n}\n"],"mappings":"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","ignoreList":[]}