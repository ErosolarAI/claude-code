6784c2ee566e484ab78e920d06888d41
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.ToolRuntimeUtils = exports.ToolRuntime = void 0;
exports.createDefaultToolRuntime = createDefaultToolRuntime;
exports.reportToolProgress = reportToolProgress;
var _nodeAsync_hooks = require("node:async_hooks");
var _schemaValidator = require("./schemaValidator.js");
var _toolPreconditions = require("./toolPreconditions.js");
var _resultVerification = require("./resultVerification.js");
var _debugLogger = require("../utils/debugLogger.js");
/* eslint-disable @typescript-eslint/no-namespace */

/**
 * Execution context for tool operations with strict TypeScript typing
 */

/**
 * Type-safe tool observer with generic parameter inference for AI flow monitoring
 */

/**
 * Generic tool handler with parameter type inference for AI flow execution
 */

/**
 * Enhanced tool definition with parameter type safety for AI software engineering
 */

/**
 * Collection of related tools grouped by functionality
 */

const toolExecutionContext = new _nodeAsync_hooks.AsyncLocalStorage();

/**
 * Report incremental progress for the currently executing tool.
 * Tools can call this to surface live status updates (e.g., indexing files).
 */
function reportToolProgress(progress) {
  const context = toolExecutionContext.getStore();
  if (!context?.observer?.onToolProgress) {
    return;
  }
  const current = Number.isFinite(progress.current) ? Math.max(0, progress.current) : 0;
  const total = progress.total !== undefined ? Math.max(current, progress.total) : current;
  try {
    context.observer.onToolProgress(context.call, {
      current,
      total,
      message: progress.message
    });
  } catch {
    // Swallow observer errors so they don't break tool execution
  }
}

// Idempotent tools that can be safely cached
const CACHEABLE_TOOLS = new Set(['Read', 'read_file', 'Glob', 'glob_search', 'Grep', 'grep_search', 'find_definition', 'analyze_code_quality', 'extract_exports']);
function buildOptimizationHint(warning) {
  const code = warning.code;
  const suggestion = warning.suggestion || warning.message;
  switch (code) {
    case 'SEARCH_BROAD_PATTERN':
    case 'SEARCH_CONTEXT_OVERFLOW_RISK':
      return `\n\n<optimization-hint>\n` + `⚡ SEARCH: ${suggestion}\n` + `</optimization-hint>`;
    case _toolPreconditions.EDIT_WITHOUT_READ:
    case 'EDIT_PLACEHOLDER':
      return `\n\n<optimization-hint>\n` + `⚡ EDIT: Read the file first to copy exact whitespace. ${suggestion}\n` + `</optimization-hint>`;
    case 'NPM_INCOMPLETE_WORKFLOW':
      return `\n\n<optimization-hint>\n` + `⚡ PUBLISH: ${suggestion}\n` + `</optimization-hint>`;
    default:
      return null;
  }
}

/**
 * Type-safe utility functions for tool runtime operations
 */
let ToolRuntimeUtils = exports.ToolRuntimeUtils = void 0;
(function (_ToolRuntimeUtils) {
  function createToolDefinition(definition) {
    return definition;
  }
  _ToolRuntimeUtils.createToolDefinition = createToolDefinition;
  function createToolSuite(suite) {
    return suite;
  }
  _ToolRuntimeUtils.createToolSuite = createToolSuite;
  function isToolDefinition(__tool, expectedSchema) {
    if (!expectedSchema) return true;
    // In a real implementation, this would validate against the schema
    return true;
  }
  _ToolRuntimeUtils.isToolDefinition = isToolDefinition;
})(ToolRuntimeUtils || (exports.ToolRuntimeUtils = ToolRuntimeUtils = {}));
/**
 * Interface describing the public API of ToolRuntime.
 * Used by wrapper implementations like RestrictedToolRuntime.
 */
class ToolRuntime {
  registry = new Map();
  registrationOrder = [];
  cache = new Map();
  toolHistory = [];
  maxHistorySize = 50; // Keep last 50 tool calls for AI flow pattern detection
  diffSnapshots = [];
  maxDiffSnapshots = 5; // Keep only the most recent git diff outputs
  maxDiffSnapshotLength = 4000;
  constructor(baseTools = [], options = {}) {
    this.observer = options.observer ?? null;
    this.contextManager = options.contextManager ?? null;
    this.enableCache = options.enableCache ?? true;
    this.cacheTTLMs = options.cacheTTLMs ?? 5 * 60 * 1000; // 5 minutes default
    if (baseTools.length) {
      this.registerSuite({
        id: 'runtime.core',
        description: 'Core runtime metadata tools',
        tools: baseTools
      });
    }
  }
  registerSuite(suite) {
    if (!suite?.id?.trim()) {
      throw new Error('Tool suite id cannot be blank.');
    }
    this.unregisterSuite(suite.id);
    for (const definition of suite.tools ?? []) {
      this.addTool(definition, suite.id);
    }
  }
  unregisterSuite(id) {
    if (!id?.trim()) {
      return;
    }
    for (const [name, record] of this.registry.entries()) {
      if (record.suiteId === id) {
        this.registry.delete(name);
        this.removeFromOrder(name);
      }
    }
  }
  listProviderTools() {
    return this.registrationOrder.map(name => this.registry.get(name)).filter(record => Boolean(record)).map(({
      definition
    }) => ({
      name: definition.name,
      description: definition.description,
      ...(definition.parameters && {
        parameters: definition.parameters
      })
    }));
  }
  async execute(call, _context) {
    const record = this.registry.get(call.name);
    const rawArgs = normalizeToolArguments(call.arguments);
    const args = (0, _schemaValidator.coerceToolArguments)(record?.definition.parameters, rawArgs);
    const augmentedCall = {
      ...call,
      args
    };
    if (!record) {
      const message = `Tool "${call.name}" is not available.`;
      this.observer?.onToolError?.(augmentedCall, message);
      // Performance monitoring removed - no legacy components
      return message;
    }

    // Check if tool is cacheable
    const isCacheable = record.definition.cacheable ?? CACHEABLE_TOOLS.has(call.name);
    const cacheTtl = typeof record.definition.cacheTtlMs === 'number' && Number.isFinite(record.definition.cacheTtlMs) ? Math.max(0, Math.floor(record.definition.cacheTtlMs)) : this.cacheTTLMs;
    const canUseCache = this.enableCache && isCacheable && cacheTtl > 0;

    // Try to get from cache
    if (canUseCache) {
      const cacheKey = this.getCacheKey({
        ...call,
        arguments: args
      });
      const cached = this.cache.get(cacheKey);
      if (cached && Date.now() - cached.timestamp < cacheTtl) {
        this.observer?.onCacheHit?.(augmentedCall);
        this.observer?.onToolResult?.(augmentedCall, cached.result);

        // Record cache hit as successful execution with 0ms time
        // Performance monitoring removed - no legacy components
        this.recordToolHistory({
          toolName: call.name,
          args,
          timestamp: Date.now(),
          success: true,
          hasOutput: hasNonEmptyOutput(cached.result)
        });
        return cached.result;
      }
    }
    this.observer?.onToolStart?.(augmentedCall);

    // Performance monitoring removed - no legacy components

    try {
      (0, _schemaValidator.validateToolArguments)(record.definition.name, record.definition.parameters, args);

      // Pre-flight AI flow validation - catch common tool usage failures
      const preflightWarnings = (0, _toolPreconditions.validateToolPreconditions)(call.name, args);
      for (const warning of preflightWarnings) {
        this.observer?.onToolWarning?.(augmentedCall, warning);
      }

      // Advanced AI flow pattern validation using tool history
      const aiFlowWarnings = (0, _toolPreconditions.validateAIFlowPatterns)(call.name, args, this.toolHistory);
      for (const warning of aiFlowWarnings) {
        this.observer?.onToolWarning?.(augmentedCall, warning);
      }

      // Collect optimization hints to inject into result
      const optimizationHints = [];
      const seenOptimizationCodes = new Set();
      for (const warning of [...preflightWarnings, ...aiFlowWarnings]) {
        if (warning.code && seenOptimizationCodes.has(warning.code)) {
          continue;
        }
        const hint = buildOptimizationHint(warning);
        if (hint) {
          if (warning.code) {
            seenOptimizationCodes.add(warning.code);
          }
          optimizationHints.push(hint);
        }
      }
      const result = await toolExecutionContext.run({
        call: augmentedCall,
        observer: this.observer ?? undefined
      }, async () => record.definition.handler(args));
      let output = typeof result === 'string' ? result : JSON.stringify(result, null, 2);
      let snapshotCandidate = output;

      // Truncate output if context manager is available
      if (this.contextManager) {
        const truncated = this.contextManager.truncateToolOutput(output, call.name);
        if (truncated.wasTruncated) {
          output = truncated.content;
          // Log truncation for debugging
          if (process.env['DEBUG_CONTEXT']) {
            (0, _debugLogger.logDebug)(`[Context Manager] Truncated ${call.name} output: ${truncated.originalLength} -> ${truncated.truncatedLength} chars`);
          }
        }
        snapshotCandidate = output;
      }
      this.recordDiffSnapshot(args, snapshotCandidate);

      // Cache the result if cacheable
      if (canUseCache) {
        const cacheKey = this.getCacheKey({
          ...call,
          arguments: args
        });
        this.cache.set(cacheKey, {
          result: output,
          timestamp: Date.now()
        });
      }

      // Append optimization hints to guide future LLM behavior
      if (optimizationHints.length > 0) {
        output = output + optimizationHints.join('');
      }
      this.observer?.onToolResult?.(augmentedCall, output);
      this.recordToolHistory({
        toolName: call.name,
        args,
        timestamp: Date.now(),
        success: true,
        hasOutput: hasNonEmptyOutput(output)
      });

      // Record successful execution
      // Performance monitoring removed - no legacy components
      return output;
    } catch (error) {
      let formatted;
      if (error instanceof _schemaValidator.ToolArgumentValidationError) {
        formatted = error.message;
      } else {
        const message = error instanceof Error ? error.message : String(error);
        formatted = `Failed to run "${call.name}": ${message}`;
      }
      this.observer?.onToolError?.(augmentedCall, formatted);
      this.recordToolHistory({
        toolName: call.name,
        args,
        timestamp: Date.now(),
        success: false,
        hasOutput: hasNonEmptyOutput(formatted),
        error: formatted
      });

      // Record failed execution - no legacy performance monitoring
      return formatted;
    }
  }
  getCacheKey(call) {
    return `${call.name}:${JSON.stringify(call.arguments)}`;
  }
  clearCache() {
    this.cache.clear();
  }
  getCacheStats() {
    let totalSize = 0;
    for (const entry of this.cache.values()) {
      totalSize += entry.result.length;
    }
    return {
      size: totalSize,
      entries: this.cache.size
    };
  }
  clearToolHistory() {
    this.toolHistory.length = 0;
  }
  getToolHistory() {
    return this.toolHistory;
  }
  recordToolHistory(entry) {
    this.toolHistory.push(entry);
    if (this.toolHistory.length > this.maxHistorySize) {
      this.toolHistory.shift();
    }
  }
  clearDiffSnapshots() {
    this.diffSnapshots.length = 0;
  }
  getDiffSnapshots() {
    return this.diffSnapshots;
  }
  addTool(definition, suiteId) {
    if (!definition?.name?.trim()) {
      throw new Error(`Tool names cannot be blank (suite "${suiteId}").`);
    }
    if (this.registry.has(definition.name)) {
      const owner = this.registry.get(definition.name)?.suiteId ?? 'unknown';
      throw new Error(`Tool "${definition.name}" already registered by suite "${owner}".`);
    }
    this.registry.set(definition.name, {
      suiteId,
      definition
    });
    this.registrationOrder.push(definition.name);
  }
  removeFromOrder(name) {
    const index = this.registrationOrder.indexOf(name);
    if (index >= 0) {
      this.registrationOrder.splice(index, 1);
    }
  }
  recordDiffSnapshot(args, output) {
    const command = this.findGitDiffCommand(args);
    if (!command || !output) {
      return;
    }
    this.diffSnapshots.push({
      command,
      output: (0, _resultVerification.safeTruncate)(output, this.maxDiffSnapshotLength, 'git-diff'),
      timestamp: Date.now()
    });
    if (this.diffSnapshots.length > this.maxDiffSnapshots) {
      this.diffSnapshots.shift();
    }
  }
  findGitDiffCommand(args) {
    for (const command of this.extractCommands(args)) {
      if (this.isGitDiffCommand(command)) {
        return command;
      }
    }
    return null;
  }
  extractCommands(args) {
    const commands = [];
    const command = args['command'];
    if (typeof command === 'string' && command.trim()) {
      commands.push(command.trim());
    }
    const commandList = args['commands'];
    if (Array.isArray(commandList)) {
      for (const value of commandList) {
        if (typeof value === 'string' && value.trim()) {
          commands.push(value.trim());
        }
      }
    }
    return commands;
  }
  isGitDiffCommand(command) {
    return /\bgit\s+(?:--no-pager\s+)?(?:diff|show)\b/i.test(command);
  }
}
exports.ToolRuntime = ToolRuntime;
function createDefaultToolRuntime(context, toolSuites = [], options = {}) {
  // Start with no default introspection tools - they waste tokens
  // Model knows its capabilities from tool definitions
  const runtime = new ToolRuntime([], options);
  for (const suite of toolSuites) {
    runtime.registerSuite(suite);
  }
  return runtime;
}

// Removed unused introspection tools (context_snapshot, capabilities_overview, profile_details)
// Model already knows capabilities from tool definitions; these just wasted tokens

function hasNonEmptyOutput(output) {
  return typeof output === 'string' && output.trim().length > 0;
}
function normalizeToolArguments(value) {
  if (value instanceof Map) {
    return Object.fromEntries(value.entries());
  }
  if (isRecord(value)) {
    return value;
  }
  if (typeof value === 'string') {
    const trimmed = value.trim();
    if (!trimmed) {
      return {};
    }
    try {
      const parsed = JSON.parse(trimmed);
      return isRecord(parsed) ? parsed : {};
    } catch {
      return {};
    }
  }
  return {};
}
function isRecord(value) {
  return typeof value === 'object' && value !== null && !Array.isArray(value);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbm9kZUFzeW5jX2hvb2tzIiwicmVxdWlyZSIsIl9zY2hlbWFWYWxpZGF0b3IiLCJfdG9vbFByZWNvbmRpdGlvbnMiLCJfcmVzdWx0VmVyaWZpY2F0aW9uIiwiX2RlYnVnTG9nZ2VyIiwidG9vbEV4ZWN1dGlvbkNvbnRleHQiLCJBc3luY0xvY2FsU3RvcmFnZSIsInJlcG9ydFRvb2xQcm9ncmVzcyIsInByb2dyZXNzIiwiY29udGV4dCIsImdldFN0b3JlIiwib2JzZXJ2ZXIiLCJvblRvb2xQcm9ncmVzcyIsImN1cnJlbnQiLCJOdW1iZXIiLCJpc0Zpbml0ZSIsIk1hdGgiLCJtYXgiLCJ0b3RhbCIsInVuZGVmaW5lZCIsImNhbGwiLCJtZXNzYWdlIiwiQ0FDSEVBQkxFX1RPT0xTIiwiU2V0IiwiYnVpbGRPcHRpbWl6YXRpb25IaW50Iiwid2FybmluZyIsImNvZGUiLCJzdWdnZXN0aW9uIiwiRURJVF9XSVRIT1VUX1JFQUQiLCJUb29sUnVudGltZVV0aWxzIiwiZXhwb3J0cyIsIl9Ub29sUnVudGltZVV0aWxzIiwiY3JlYXRlVG9vbERlZmluaXRpb24iLCJkZWZpbml0aW9uIiwiY3JlYXRlVG9vbFN1aXRlIiwic3VpdGUiLCJpc1Rvb2xEZWZpbml0aW9uIiwiX190b29sIiwiZXhwZWN0ZWRTY2hlbWEiLCJUb29sUnVudGltZSIsInJlZ2lzdHJ5IiwiTWFwIiwicmVnaXN0cmF0aW9uT3JkZXIiLCJjYWNoZSIsInRvb2xIaXN0b3J5IiwibWF4SGlzdG9yeVNpemUiLCJkaWZmU25hcHNob3RzIiwibWF4RGlmZlNuYXBzaG90cyIsIm1heERpZmZTbmFwc2hvdExlbmd0aCIsImNvbnN0cnVjdG9yIiwiYmFzZVRvb2xzIiwib3B0aW9ucyIsImNvbnRleHRNYW5hZ2VyIiwiZW5hYmxlQ2FjaGUiLCJjYWNoZVRUTE1zIiwibGVuZ3RoIiwicmVnaXN0ZXJTdWl0ZSIsImlkIiwiZGVzY3JpcHRpb24iLCJ0b29scyIsInRyaW0iLCJFcnJvciIsInVucmVnaXN0ZXJTdWl0ZSIsImFkZFRvb2wiLCJuYW1lIiwicmVjb3JkIiwiZW50cmllcyIsInN1aXRlSWQiLCJkZWxldGUiLCJyZW1vdmVGcm9tT3JkZXIiLCJsaXN0UHJvdmlkZXJUb29scyIsIm1hcCIsImdldCIsImZpbHRlciIsIkJvb2xlYW4iLCJwYXJhbWV0ZXJzIiwiZXhlY3V0ZSIsIl9jb250ZXh0IiwicmF3QXJncyIsIm5vcm1hbGl6ZVRvb2xBcmd1bWVudHMiLCJhcmd1bWVudHMiLCJhcmdzIiwiY29lcmNlVG9vbEFyZ3VtZW50cyIsImF1Z21lbnRlZENhbGwiLCJvblRvb2xFcnJvciIsImlzQ2FjaGVhYmxlIiwiY2FjaGVhYmxlIiwiaGFzIiwiY2FjaGVUdGwiLCJjYWNoZVR0bE1zIiwiZmxvb3IiLCJjYW5Vc2VDYWNoZSIsImNhY2hlS2V5IiwiZ2V0Q2FjaGVLZXkiLCJjYWNoZWQiLCJEYXRlIiwibm93IiwidGltZXN0YW1wIiwib25DYWNoZUhpdCIsIm9uVG9vbFJlc3VsdCIsInJlc3VsdCIsInJlY29yZFRvb2xIaXN0b3J5IiwidG9vbE5hbWUiLCJzdWNjZXNzIiwiaGFzT3V0cHV0IiwiaGFzTm9uRW1wdHlPdXRwdXQiLCJvblRvb2xTdGFydCIsInZhbGlkYXRlVG9vbEFyZ3VtZW50cyIsInByZWZsaWdodFdhcm5pbmdzIiwidmFsaWRhdGVUb29sUHJlY29uZGl0aW9ucyIsIm9uVG9vbFdhcm5pbmciLCJhaUZsb3dXYXJuaW5ncyIsInZhbGlkYXRlQUlGbG93UGF0dGVybnMiLCJvcHRpbWl6YXRpb25IaW50cyIsInNlZW5PcHRpbWl6YXRpb25Db2RlcyIsImhpbnQiLCJhZGQiLCJwdXNoIiwicnVuIiwiaGFuZGxlciIsIm91dHB1dCIsIkpTT04iLCJzdHJpbmdpZnkiLCJzbmFwc2hvdENhbmRpZGF0ZSIsInRydW5jYXRlZCIsInRydW5jYXRlVG9vbE91dHB1dCIsIndhc1RydW5jYXRlZCIsImNvbnRlbnQiLCJwcm9jZXNzIiwiZW52IiwibG9nRGVidWciLCJvcmlnaW5hbExlbmd0aCIsInRydW5jYXRlZExlbmd0aCIsInJlY29yZERpZmZTbmFwc2hvdCIsInNldCIsImpvaW4iLCJlcnJvciIsImZvcm1hdHRlZCIsIlRvb2xBcmd1bWVudFZhbGlkYXRpb25FcnJvciIsIlN0cmluZyIsImNsZWFyQ2FjaGUiLCJjbGVhciIsImdldENhY2hlU3RhdHMiLCJ0b3RhbFNpemUiLCJlbnRyeSIsInZhbHVlcyIsInNpemUiLCJjbGVhclRvb2xIaXN0b3J5IiwiZ2V0VG9vbEhpc3RvcnkiLCJzaGlmdCIsImNsZWFyRGlmZlNuYXBzaG90cyIsImdldERpZmZTbmFwc2hvdHMiLCJvd25lciIsImluZGV4IiwiaW5kZXhPZiIsInNwbGljZSIsImNvbW1hbmQiLCJmaW5kR2l0RGlmZkNvbW1hbmQiLCJzYWZlVHJ1bmNhdGUiLCJleHRyYWN0Q29tbWFuZHMiLCJpc0dpdERpZmZDb21tYW5kIiwiY29tbWFuZHMiLCJjb21tYW5kTGlzdCIsIkFycmF5IiwiaXNBcnJheSIsInZhbHVlIiwidGVzdCIsImNyZWF0ZURlZmF1bHRUb29sUnVudGltZSIsInRvb2xTdWl0ZXMiLCJydW50aW1lIiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJpc1JlY29yZCIsInRyaW1tZWQiLCJwYXJzZWQiLCJwYXJzZSJdLCJzb3VyY2VzIjpbInRvb2xSdW50aW1lLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby1uYW1lc3BhY2UgKi9cbmltcG9ydCB7IEFzeW5jTG9jYWxTdG9yYWdlIH0gZnJvbSAnbm9kZTphc3luY19ob29rcyc7XG5pbXBvcnQge1xuICB0eXBlIEpTT05TY2hlbWFPYmplY3QsXG4gIHR5cGUgUHJvdmlkZXJJZCxcbiAgdHlwZSBQcm92aWRlclRvb2xEZWZpbml0aW9uLFxuICB0eXBlIFRvb2xDYWxsUmVxdWVzdCxcbn0gZnJvbSAnLi90eXBlcy5qcyc7XG5pbXBvcnQge1xuICBUb29sQXJndW1lbnRWYWxpZGF0aW9uRXJyb3IsXG4gIGNvZXJjZVRvb2xBcmd1bWVudHMsXG4gIHZhbGlkYXRlVG9vbEFyZ3VtZW50cyxcbn0gZnJvbSAnLi9zY2hlbWFWYWxpZGF0b3IuanMnO1xuaW1wb3J0IHsgQ29udGV4dE1hbmFnZXIgfSBmcm9tICcuL2NvbnRleHRNYW5hZ2VyLmpzJztcblxuaW1wb3J0IHsgdmFsaWRhdGVUb29sUHJlY29uZGl0aW9ucywgdmFsaWRhdGVBSUZsb3dQYXR0ZXJucywgRURJVF9XSVRIT1VUX1JFQUQsIHR5cGUgUHJlZmxpZ2h0V2FybmluZyB9IGZyb20gJy4vdG9vbFByZWNvbmRpdGlvbnMuanMnO1xuaW1wb3J0IHsgZW5oYW5jZVdpdGhIYWxsdWNpbmF0aW9uR3VhcmQgfSBmcm9tICcuL2hhbGx1Y2luYXRpb25HdWFyZC5qcyc7XG5pbXBvcnQgeyBzYWZlVHJ1bmNhdGUgfSBmcm9tICcuL3Jlc3VsdFZlcmlmaWNhdGlvbi5qcyc7XG5pbXBvcnQgeyBsb2dEZWJ1ZyB9IGZyb20gJy4uL3V0aWxzL2RlYnVnTG9nZ2VyLmpzJztcblxuLyoqXG4gKiBFeGVjdXRpb24gY29udGV4dCBmb3IgdG9vbCBvcGVyYXRpb25zIHdpdGggc3RyaWN0IFR5cGVTY3JpcHQgdHlwaW5nXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVG9vbEV4ZWN1dGlvbkNvbnRleHQge1xuICByZWFkb25seSBwcm9maWxlTmFtZTogc3RyaW5nO1xuICByZWFkb25seSBwcm92aWRlcjogUHJvdmlkZXJJZDtcbiAgcmVhZG9ubHkgbW9kZWw6IHN0cmluZztcbiAgcmVhZG9ubHkgd29ya3NwYWNlQ29udGV4dD86IHN0cmluZyB8IG51bGw7XG59XG5cbi8qKlxuICogVHlwZS1zYWZlIHRvb2wgb2JzZXJ2ZXIgd2l0aCBnZW5lcmljIHBhcmFtZXRlciBpbmZlcmVuY2UgZm9yIEFJIGZsb3cgbW9uaXRvcmluZ1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFRvb2xSdW50aW1lT2JzZXJ2ZXI8VCBleHRlbmRzIFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0gUmVjb3JkPHN0cmluZywgdW5rbm93bj4+IHtcbiAgLyoqIENhbGxlZCB3aGVuIHRvb2wgZXhlY3V0aW9uIGJlZ2lucyAqL1xuICBvblRvb2xTdGFydD8oY2FsbDogVG9vbENhbGxSZXF1ZXN0ICYgeyBhcmdzOiBUIH0pOiB2b2lkO1xuICBcbiAgLyoqIENhbGxlZCB3aGVuIHRvb2wgZXhlY3V0aW9uIGNvbXBsZXRlcyBzdWNjZXNzZnVsbHkgKi9cbiAgb25Ub29sUmVzdWx0PyhjYWxsOiBUb29sQ2FsbFJlcXVlc3QgJiB7IGFyZ3M6IFQgfSwgb3V0cHV0OiBzdHJpbmcpOiB2b2lkO1xuICBcbiAgLyoqIENhbGxlZCB3aGVuIHRvb2wgZXhlY3V0aW9uIGZhaWxzICovXG4gIG9uVG9vbEVycm9yPyhjYWxsOiBUb29sQ2FsbFJlcXVlc3QgJiB7IGFyZ3M6IFQgfSwgZXJyb3I6IHN0cmluZyk6IHZvaWQ7XG4gIFxuICAvKiogQ2FsbGVkIHdoZW4gY2FjaGVkIHJlc3VsdCBpcyB1c2VkIGluc3RlYWQgb2YgZXhlY3V0aW9uICovXG4gIG9uQ2FjaGVIaXQ/KGNhbGw6IFRvb2xDYWxsUmVxdWVzdCAmIHsgYXJnczogVCB9KTogdm9pZDtcbiAgXG4gIC8qKiBDYWxsZWQgZm9yIHByb2dyZXNzIHVwZGF0ZXMgZHVyaW5nIGxvbmctcnVubmluZyBvcGVyYXRpb25zICovXG4gIG9uVG9vbFByb2dyZXNzPyhjYWxsOiBUb29sQ2FsbFJlcXVlc3QgJiB7IGFyZ3M6IFQgfSwgcHJvZ3Jlc3M6IFRvb2xQcm9ncmVzc1VwZGF0ZSk6IHZvaWQ7XG4gIFxuICAvKiogQ2FsbGVkIGZvciBwcmUtZmxpZ2h0IHdhcm5pbmdzIGJlZm9yZSB0b29sIGV4ZWN1dGlvbiAqL1xuICBvblRvb2xXYXJuaW5nPyhjYWxsOiBUb29sQ2FsbFJlcXVlc3QgJiB7IGFyZ3M6IFQgfSwgd2FybmluZzogUHJlZmxpZ2h0V2FybmluZyB8IHN0cmluZyk6IHZvaWQ7XG59XG5cbmludGVyZmFjZSBUb29sUnVudGltZU9wdGlvbnMge1xuICByZWFkb25seSBvYnNlcnZlcj86IFRvb2xSdW50aW1lT2JzZXJ2ZXI7XG4gIHJlYWRvbmx5IGNvbnRleHRNYW5hZ2VyPzogQ29udGV4dE1hbmFnZXI7XG4gIHJlYWRvbmx5IGVuYWJsZUNhY2hlPzogYm9vbGVhbjtcbiAgcmVhZG9ubHkgY2FjaGVUVExNcz86IG51bWJlcjtcbn1cblxuLyoqXG4gKiBHZW5lcmljIHRvb2wgaGFuZGxlciB3aXRoIHBhcmFtZXRlciB0eXBlIGluZmVyZW5jZSBmb3IgQUkgZmxvdyBleGVjdXRpb25cbiAqL1xudHlwZSBUb29sSGFuZGxlcjxUIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4gPSAoXG4gIGFyZ3M6IFRcbikgPT4gUHJvbWlzZTxzdHJpbmc+IHwgc3RyaW5nO1xuXG4vKipcbiAqIEVuaGFuY2VkIHRvb2wgZGVmaW5pdGlvbiB3aXRoIHBhcmFtZXRlciB0eXBlIHNhZmV0eSBmb3IgQUkgc29mdHdhcmUgZW5naW5lZXJpbmdcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBUb29sRGVmaW5pdGlvbjxUIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4ge1xuICAvKiogVW5pcXVlIGlkZW50aWZpZXIgZm9yIHRoZSB0b29sICovXG4gIHJlYWRvbmx5IG5hbWU6IHN0cmluZztcbiAgXG4gIC8qKiBIdW1hbi1yZWFkYWJsZSBkZXNjcmlwdGlvbiBmb3IgQUkgdW5kZXJzdGFuZGluZyAqL1xuICByZWFkb25seSBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBcbiAgLyoqIEpTT04gU2NoZW1hIGRlZmluaW5nIHRoZSB0b29sJ3MgcGFyYW1ldGVyIHN0cnVjdHVyZSAqL1xuICByZWFkb25seSBwYXJhbWV0ZXJzPzogSlNPTlNjaGVtYU9iamVjdDtcbiAgXG4gIC8qKiBGdW5jdGlvbiB0aGF0IGltcGxlbWVudHMgdGhlIHRvb2wncyBiZWhhdmlvciAqL1xuICByZWFkb25seSBoYW5kbGVyOiBUb29sSGFuZGxlcjxUPjtcbiAgXG4gIC8qKiBXaGV0aGVyIHJlc3VsdHMgY2FuIGJlIGNhY2hlZCBmb3IgcGVyZm9ybWFuY2Ugb3B0aW1pemF0aW9uICovXG4gIHJlYWRvbmx5IGNhY2hlYWJsZT86IGJvb2xlYW47XG5cbiAgLyoqIE9wdGlvbmFsIHBlci10b29sIGNhY2hlIFRUTCBpbiBtaWxsaXNlY29uZHMgKGZhbGxzIGJhY2sgdG8gcnVudGltZSBkZWZhdWx0KSAqL1xuICByZWFkb25seSBjYWNoZVR0bE1zPzogbnVtYmVyO1xufVxuXG4vKipcbiAqIENvbGxlY3Rpb24gb2YgcmVsYXRlZCB0b29scyBncm91cGVkIGJ5IGZ1bmN0aW9uYWxpdHlcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBUb29sU3VpdGUge1xuICAvKiogVW5pcXVlIGlkZW50aWZpZXIgZm9yIHRoZSB0b29sIHN1aXRlICovXG4gIHJlYWRvbmx5IGlkOiBzdHJpbmc7XG4gIFxuICAvKiogSHVtYW4tcmVhZGFibGUgZGVzY3JpcHRpb24gb2YgdGhlIHN1aXRlJ3MgcHVycG9zZSAqL1xuICByZWFkb25seSBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgXG4gIC8qKiBBcnJheSBvZiB0b29sIGRlZmluaXRpb25zIGluIHRoaXMgc3VpdGUgKi9cbiAgcmVhZG9ubHkgdG9vbHM6IHJlYWRvbmx5IFRvb2xEZWZpbml0aW9uW107XG59XG5cbmludGVyZmFjZSBUb29sUmVjb3JkIHtcbiAgc3VpdGVJZDogc3RyaW5nO1xuICBkZWZpbml0aW9uOiBUb29sRGVmaW5pdGlvbjtcbn1cblxuaW50ZXJmYWNlIENhY2hlRW50cnkge1xuICByZXN1bHQ6IHN0cmluZztcbiAgdGltZXN0YW1wOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVG9vbEhpc3RvcnlFbnRyeSB7XG4gIHRvb2xOYW1lOiBzdHJpbmc7XG4gIGFyZ3M6IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbiAgc3VjY2VzczogYm9vbGVhbjtcbiAgaGFzT3V0cHV0OiBib29sZWFuO1xuICBlcnJvcj86IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBEaWZmU25hcHNob3RSZWNvcmQge1xuICBjb21tYW5kOiBzdHJpbmc7XG4gIG91dHB1dDogc3RyaW5nO1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUb29sUHJvZ3Jlc3NVcGRhdGUge1xuICBjdXJyZW50OiBudW1iZXI7XG4gIHRvdGFsPzogbnVtYmVyO1xuICBtZXNzYWdlPzogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgVG9vbEV4ZWN1dGlvblN0b3JlIHtcbiAgY2FsbDogVG9vbENhbGxSZXF1ZXN0ICYgeyBhcmdzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiB9O1xuICBvYnNlcnZlcj86IFRvb2xSdW50aW1lT2JzZXJ2ZXI7XG59XG5cbmNvbnN0IHRvb2xFeGVjdXRpb25Db250ZXh0ID0gbmV3IEFzeW5jTG9jYWxTdG9yYWdlPFRvb2xFeGVjdXRpb25TdG9yZT4oKTtcblxuLyoqXG4gKiBSZXBvcnQgaW5jcmVtZW50YWwgcHJvZ3Jlc3MgZm9yIHRoZSBjdXJyZW50bHkgZXhlY3V0aW5nIHRvb2wuXG4gKiBUb29scyBjYW4gY2FsbCB0aGlzIHRvIHN1cmZhY2UgbGl2ZSBzdGF0dXMgdXBkYXRlcyAoZS5nLiwgaW5kZXhpbmcgZmlsZXMpLlxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVwb3J0VG9vbFByb2dyZXNzKHByb2dyZXNzOiBUb29sUHJvZ3Jlc3NVcGRhdGUpOiB2b2lkIHtcbiAgY29uc3QgY29udGV4dCA9IHRvb2xFeGVjdXRpb25Db250ZXh0LmdldFN0b3JlKCk7XG4gIGlmICghY29udGV4dD8ub2JzZXJ2ZXI/Lm9uVG9vbFByb2dyZXNzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgY3VycmVudCA9IE51bWJlci5pc0Zpbml0ZShwcm9ncmVzcy5jdXJyZW50KSA/IE1hdGgubWF4KDAsIHByb2dyZXNzLmN1cnJlbnQpIDogMDtcbiAgY29uc3QgdG90YWwgPSBwcm9ncmVzcy50b3RhbCAhPT0gdW5kZWZpbmVkID8gTWF0aC5tYXgoY3VycmVudCwgcHJvZ3Jlc3MudG90YWwpIDogY3VycmVudDtcblxuICB0cnkge1xuICAgIGNvbnRleHQub2JzZXJ2ZXIub25Ub29sUHJvZ3Jlc3MoY29udGV4dC5jYWxsLCB7XG4gICAgICBjdXJyZW50LFxuICAgICAgdG90YWwsXG4gICAgICBtZXNzYWdlOiBwcm9ncmVzcy5tZXNzYWdlLFxuICAgIH0pO1xuICB9IGNhdGNoIHtcbiAgICAvLyBTd2FsbG93IG9ic2VydmVyIGVycm9ycyBzbyB0aGV5IGRvbid0IGJyZWFrIHRvb2wgZXhlY3V0aW9uXG4gIH1cbn1cblxuLy8gSWRlbXBvdGVudCB0b29scyB0aGF0IGNhbiBiZSBzYWZlbHkgY2FjaGVkXG5jb25zdCBDQUNIRUFCTEVfVE9PTFMgPSBuZXcgU2V0KFtcbiAgJ1JlYWQnLFxuICAncmVhZF9maWxlJyxcbiAgJ0dsb2InLFxuICAnZ2xvYl9zZWFyY2gnLFxuICAnR3JlcCcsXG4gICdncmVwX3NlYXJjaCcsXG4gICdmaW5kX2RlZmluaXRpb24nLFxuICAnYW5hbHl6ZV9jb2RlX3F1YWxpdHknLFxuICAnZXh0cmFjdF9leHBvcnRzJyxcbl0pO1xuXG5mdW5jdGlvbiBidWlsZE9wdGltaXphdGlvbkhpbnQoXG4gIHdhcm5pbmc6IFByZWZsaWdodFdhcm5pbmcgfCB7IGNvZGU/OiBzdHJpbmc7IHN1Z2dlc3Rpb24/OiBzdHJpbmc7IG1lc3NhZ2U6IHN0cmluZyB9XG4pOiBzdHJpbmcgfCBudWxsIHtcbiAgY29uc3QgY29kZSA9IHdhcm5pbmcuY29kZTtcbiAgY29uc3Qgc3VnZ2VzdGlvbiA9IHdhcm5pbmcuc3VnZ2VzdGlvbiB8fCB3YXJuaW5nLm1lc3NhZ2U7XG5cbiAgc3dpdGNoIChjb2RlKSB7XG4gICAgY2FzZSAnU0VBUkNIX0JST0FEX1BBVFRFUk4nOlxuICAgIGNhc2UgJ1NFQVJDSF9DT05URVhUX09WRVJGTE9XX1JJU0snOlxuICAgICAgcmV0dXJuIChcbiAgICAgICAgYFxcblxcbjxvcHRpbWl6YXRpb24taGludD5cXG5gICtcbiAgICAgICAgYOKaoSBTRUFSQ0g6ICR7c3VnZ2VzdGlvbn1cXG5gICtcbiAgICAgICAgYDwvb3B0aW1pemF0aW9uLWhpbnQ+YFxuICAgICAgKTtcbiAgICBjYXNlIEVESVRfV0lUSE9VVF9SRUFEOlxuICAgIGNhc2UgJ0VESVRfUExBQ0VIT0xERVInOlxuICAgICAgcmV0dXJuIChcbiAgICAgICAgYFxcblxcbjxvcHRpbWl6YXRpb24taGludD5cXG5gICtcbiAgICAgICAgYOKaoSBFRElUOiBSZWFkIHRoZSBmaWxlIGZpcnN0IHRvIGNvcHkgZXhhY3Qgd2hpdGVzcGFjZS4gJHtzdWdnZXN0aW9ufVxcbmAgK1xuICAgICAgICBgPC9vcHRpbWl6YXRpb24taGludD5gXG4gICAgICApO1xuICAgIGNhc2UgJ05QTV9JTkNPTVBMRVRFX1dPUktGTE9XJzpcbiAgICAgIHJldHVybiAoXG4gICAgICAgIGBcXG5cXG48b3B0aW1pemF0aW9uLWhpbnQ+XFxuYCArXG4gICAgICAgIGDimqEgUFVCTElTSDogJHtzdWdnZXN0aW9ufVxcbmAgK1xuICAgICAgICBgPC9vcHRpbWl6YXRpb24taGludD5gXG4gICAgICApO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vKipcbiAqIFR5cGUtc2FmZSB1dGlsaXR5IGZ1bmN0aW9ucyBmb3IgdG9vbCBydW50aW1lIG9wZXJhdGlvbnNcbiAqL1xuZXhwb3J0IG5hbWVzcGFjZSBUb29sUnVudGltZVV0aWxzIHtcbiAgLyoqXG4gICAqIENyZWF0ZXMgYSB0eXBlLXNhZmUgdG9vbCBkZWZpbml0aW9uIHdpdGggaW5mZXJyZWQgcGFyYW1ldGVyIHR5cGVzXG4gICAqL1xuICBleHBvcnQgZnVuY3Rpb24gY3JlYXRlVG9vbERlZmluaXRpb248VCBleHRlbmRzIFJlY29yZDxzdHJpbmcsIHVua25vd24+PihcbiAgICBkZWZpbml0aW9uOiBUb29sRGVmaW5pdGlvbjxUPlxuICApOiBUb29sRGVmaW5pdGlvbjxUPiB7XG4gICAgcmV0dXJuIGRlZmluaXRpb247XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIHR5cGUtc2FmZSB0b29sIHN1aXRlIHdpdGggaW5mZXJyZWQgdG9vbCB0eXBlc1xuICAgKi9cbiAgZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVRvb2xTdWl0ZShcbiAgICBzdWl0ZTogVG9vbFN1aXRlXG4gICk6IFRvb2xTdWl0ZSB7XG4gICAgcmV0dXJuIHN1aXRlO1xuICB9XG5cbiAgLyoqXG4gICAqIFR5cGUgZ3VhcmQgdG8gY2hlY2sgaWYgYSB0b29sIGRlZmluaXRpb24gbWF0Y2hlcyBleHBlY3RlZCBwYXJhbWV0ZXIgc2NoZW1hXG4gICAqL1xuICBleHBvcnQgZnVuY3Rpb24gaXNUb29sRGVmaW5pdGlvbihcbiAgICBfX3Rvb2w6IFRvb2xEZWZpbml0aW9uLFxuICAgIGV4cGVjdGVkU2NoZW1hPzogSlNPTlNjaGVtYU9iamVjdFxuICApOiBib29sZWFuIHtcbiAgICBpZiAoIWV4cGVjdGVkU2NoZW1hKSByZXR1cm4gdHJ1ZTtcbiAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHRoaXMgd291bGQgdmFsaWRhdGUgYWdhaW5zdCB0aGUgc2NoZW1hXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn1cblxuLyoqXG4gKiBJbnRlcmZhY2UgZGVzY3JpYmluZyB0aGUgcHVibGljIEFQSSBvZiBUb29sUnVudGltZS5cbiAqIFVzZWQgYnkgd3JhcHBlciBpbXBsZW1lbnRhdGlvbnMgbGlrZSBSZXN0cmljdGVkVG9vbFJ1bnRpbWUuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgSVRvb2xSdW50aW1lIHtcbiAgbGlzdFByb3ZpZGVyVG9vbHMoKTogUHJvdmlkZXJUb29sRGVmaW5pdGlvbltdO1xuICBleGVjdXRlKGNhbGw6IFRvb2xDYWxsUmVxdWVzdCwgY29udGV4dD86IHsgcHJvZmlsZU5hbWU/OiBzdHJpbmc7IHByb3ZpZGVyPzogc3RyaW5nOyBtb2RlbD86IHN0cmluZyB9KTogUHJvbWlzZTxzdHJpbmc+O1xuICByZWdpc3RlclN1aXRlKHN1aXRlOiBUb29sU3VpdGUpOiB2b2lkO1xuICB1bnJlZ2lzdGVyU3VpdGUoaWQ6IHN0cmluZyk6IHZvaWQ7XG4gIGNsZWFyQ2FjaGUoKTogdm9pZDtcbiAgZ2V0Q2FjaGVTdGF0cygpOiB7IHNpemU6IG51bWJlcjsgZW50cmllczogbnVtYmVyIH07XG4gIGNsZWFyVG9vbEhpc3RvcnkoKTogdm9pZDtcbiAgZ2V0VG9vbEhpc3RvcnkoKTogcmVhZG9ubHkgVG9vbEhpc3RvcnlFbnRyeVtdO1xuICBjbGVhckRpZmZTbmFwc2hvdHMoKTogdm9pZDtcbiAgZ2V0RGlmZlNuYXBzaG90cygpOiByZWFkb25seSBEaWZmU25hcHNob3RSZWNvcmRbXTtcbn1cblxuZXhwb3J0IGNsYXNzIFRvb2xSdW50aW1lIGltcGxlbWVudHMgSVRvb2xSdW50aW1lIHtcbiAgcHJpdmF0ZSByZWFkb25seSByZWdpc3RyeSA9IG5ldyBNYXA8c3RyaW5nLCBUb29sUmVjb3JkPigpO1xuICBwcml2YXRlIHJlYWRvbmx5IHJlZ2lzdHJhdGlvbk9yZGVyOiBzdHJpbmdbXSA9IFtdO1xuICBwcml2YXRlIHJlYWRvbmx5IG9ic2VydmVyOiBUb29sUnVudGltZU9ic2VydmVyIHwgbnVsbDtcbiAgcHJpdmF0ZSByZWFkb25seSBjb250ZXh0TWFuYWdlcjogQ29udGV4dE1hbmFnZXIgfCBudWxsO1xuICBwcml2YXRlIHJlYWRvbmx5IGNhY2hlID0gbmV3IE1hcDxzdHJpbmcsIENhY2hlRW50cnk+KCk7XG4gIHByaXZhdGUgcmVhZG9ubHkgZW5hYmxlQ2FjaGU6IGJvb2xlYW47XG4gIHByaXZhdGUgcmVhZG9ubHkgY2FjaGVUVExNczogbnVtYmVyO1xuICBwcml2YXRlIHJlYWRvbmx5IHRvb2xIaXN0b3J5OiBUb29sSGlzdG9yeUVudHJ5W10gPSBbXTtcbiAgcHJpdmF0ZSByZWFkb25seSBtYXhIaXN0b3J5U2l6ZSA9IDUwOyAvLyBLZWVwIGxhc3QgNTAgdG9vbCBjYWxscyBmb3IgQUkgZmxvdyBwYXR0ZXJuIGRldGVjdGlvblxuICBwcml2YXRlIHJlYWRvbmx5IGRpZmZTbmFwc2hvdHM6IERpZmZTbmFwc2hvdFJlY29yZFtdID0gW107XG4gIHByaXZhdGUgcmVhZG9ubHkgbWF4RGlmZlNuYXBzaG90cyA9IDU7IC8vIEtlZXAgb25seSB0aGUgbW9zdCByZWNlbnQgZ2l0IGRpZmYgb3V0cHV0c1xuICBwcml2YXRlIHJlYWRvbmx5IG1heERpZmZTbmFwc2hvdExlbmd0aCA9IDQwMDA7XG5cbiAgY29uc3RydWN0b3IoYmFzZVRvb2xzOiBUb29sRGVmaW5pdGlvbltdID0gW10sIG9wdGlvbnM6IFRvb2xSdW50aW1lT3B0aW9ucyA9IHt9KSB7XG4gICAgdGhpcy5vYnNlcnZlciA9IG9wdGlvbnMub2JzZXJ2ZXIgPz8gbnVsbDtcbiAgICB0aGlzLmNvbnRleHRNYW5hZ2VyID0gb3B0aW9ucy5jb250ZXh0TWFuYWdlciA/PyBudWxsO1xuICAgIHRoaXMuZW5hYmxlQ2FjaGUgPSBvcHRpb25zLmVuYWJsZUNhY2hlID8/IHRydWU7XG4gICAgdGhpcy5jYWNoZVRUTE1zID0gb3B0aW9ucy5jYWNoZVRUTE1zID8/IDUgKiA2MCAqIDEwMDA7IC8vIDUgbWludXRlcyBkZWZhdWx0XG4gICAgaWYgKGJhc2VUb29scy5sZW5ndGgpIHtcbiAgICAgIHRoaXMucmVnaXN0ZXJTdWl0ZSh7XG4gICAgICAgIGlkOiAncnVudGltZS5jb3JlJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdDb3JlIHJ1bnRpbWUgbWV0YWRhdGEgdG9vbHMnLFxuICAgICAgICB0b29sczogYmFzZVRvb2xzLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcmVnaXN0ZXJTdWl0ZShzdWl0ZTogVG9vbFN1aXRlKTogdm9pZCB7XG4gICAgaWYgKCFzdWl0ZT8uaWQ/LnRyaW0oKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUb29sIHN1aXRlIGlkIGNhbm5vdCBiZSBibGFuay4nKTtcbiAgICB9XG4gICAgdGhpcy51bnJlZ2lzdGVyU3VpdGUoc3VpdGUuaWQpO1xuICAgIGZvciAoY29uc3QgZGVmaW5pdGlvbiBvZiBzdWl0ZS50b29scyA/PyBbXSkge1xuICAgICAgdGhpcy5hZGRUb29sKGRlZmluaXRpb24sIHN1aXRlLmlkKTtcbiAgICB9XG4gIH1cblxuICB1bnJlZ2lzdGVyU3VpdGUoaWQ6IHN0cmluZyk6IHZvaWQge1xuICAgIGlmICghaWQ/LnRyaW0oKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IFtuYW1lLCByZWNvcmRdIG9mIHRoaXMucmVnaXN0cnkuZW50cmllcygpKSB7XG4gICAgICBpZiAocmVjb3JkLnN1aXRlSWQgPT09IGlkKSB7XG4gICAgICAgIHRoaXMucmVnaXN0cnkuZGVsZXRlKG5hbWUpO1xuICAgICAgICB0aGlzLnJlbW92ZUZyb21PcmRlcihuYW1lKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBsaXN0UHJvdmlkZXJUb29scygpOiBQcm92aWRlclRvb2xEZWZpbml0aW9uW10ge1xuICAgIHJldHVybiB0aGlzLnJlZ2lzdHJhdGlvbk9yZGVyXG4gICAgICAubWFwKChuYW1lKSA9PiB0aGlzLnJlZ2lzdHJ5LmdldChuYW1lKSlcbiAgICAgIC5maWx0ZXIoKHJlY29yZCk6IHJlY29yZCBpcyBUb29sUmVjb3JkID0+IEJvb2xlYW4ocmVjb3JkKSlcbiAgICAgIC5tYXAoKHsgZGVmaW5pdGlvbiB9KSA9PiAoe1xuICAgICAgICBuYW1lOiBkZWZpbml0aW9uLm5hbWUsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBkZWZpbml0aW9uLmRlc2NyaXB0aW9uLFxuICAgICAgICAuLi4oZGVmaW5pdGlvbi5wYXJhbWV0ZXJzICYmIHsgcGFyYW1ldGVyczogZGVmaW5pdGlvbi5wYXJhbWV0ZXJzIH0pLFxuICAgICAgfSkpO1xuICB9XG5cbiAgYXN5bmMgZXhlY3V0ZShjYWxsOiBUb29sQ2FsbFJlcXVlc3QsIF9jb250ZXh0PzogeyBwcm9maWxlTmFtZT86IHN0cmluZzsgcHJvdmlkZXI/OiBzdHJpbmc7IG1vZGVsPzogc3RyaW5nIH0pOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IHJlY29yZCA9IHRoaXMucmVnaXN0cnkuZ2V0KGNhbGwubmFtZSk7XG4gICAgY29uc3QgcmF3QXJncyA9IG5vcm1hbGl6ZVRvb2xBcmd1bWVudHMoY2FsbC5hcmd1bWVudHMpO1xuICAgIGNvbnN0IGFyZ3MgPSBjb2VyY2VUb29sQXJndW1lbnRzKHJlY29yZD8uZGVmaW5pdGlvbi5wYXJhbWV0ZXJzLCByYXdBcmdzKTtcbiAgICBjb25zdCBhdWdtZW50ZWRDYWxsID0geyAuLi5jYWxsLCBhcmdzIH07XG5cbiAgICBpZiAoIXJlY29yZCkge1xuICAgICAgY29uc3QgbWVzc2FnZSA9IGBUb29sIFwiJHtjYWxsLm5hbWV9XCIgaXMgbm90IGF2YWlsYWJsZS5gO1xuICAgICAgdGhpcy5vYnNlcnZlcj8ub25Ub29sRXJyb3I/LihhdWdtZW50ZWRDYWxsLCBtZXNzYWdlKTtcbiAgICAgIC8vIFBlcmZvcm1hbmNlIG1vbml0b3JpbmcgcmVtb3ZlZCAtIG5vIGxlZ2FjeSBjb21wb25lbnRzXG4gICAgICByZXR1cm4gbWVzc2FnZTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiB0b29sIGlzIGNhY2hlYWJsZVxuICAgIGNvbnN0IGlzQ2FjaGVhYmxlID0gcmVjb3JkLmRlZmluaXRpb24uY2FjaGVhYmxlID8/IENBQ0hFQUJMRV9UT09MUy5oYXMoY2FsbC5uYW1lKTtcbiAgICBjb25zdCBjYWNoZVR0bCA9XG4gICAgICB0eXBlb2YgcmVjb3JkLmRlZmluaXRpb24uY2FjaGVUdGxNcyA9PT0gJ251bWJlcicgJiYgTnVtYmVyLmlzRmluaXRlKHJlY29yZC5kZWZpbml0aW9uLmNhY2hlVHRsTXMpXG4gICAgICAgID8gTWF0aC5tYXgoMCwgTWF0aC5mbG9vcihyZWNvcmQuZGVmaW5pdGlvbi5jYWNoZVR0bE1zKSlcbiAgICAgICAgOiB0aGlzLmNhY2hlVFRMTXM7XG4gICAgY29uc3QgY2FuVXNlQ2FjaGUgPSB0aGlzLmVuYWJsZUNhY2hlICYmIGlzQ2FjaGVhYmxlICYmIGNhY2hlVHRsID4gMDtcblxuICAgIC8vIFRyeSB0byBnZXQgZnJvbSBjYWNoZVxuICAgIGlmIChjYW5Vc2VDYWNoZSkge1xuICAgICAgY29uc3QgY2FjaGVLZXkgPSB0aGlzLmdldENhY2hlS2V5KHsgLi4uY2FsbCwgYXJndW1lbnRzOiBhcmdzIH0pO1xuICAgICAgY29uc3QgY2FjaGVkID0gdGhpcy5jYWNoZS5nZXQoY2FjaGVLZXkpO1xuXG4gICAgICBpZiAoY2FjaGVkICYmIERhdGUubm93KCkgLSBjYWNoZWQudGltZXN0YW1wIDwgY2FjaGVUdGwpIHtcbiAgICAgICAgdGhpcy5vYnNlcnZlcj8ub25DYWNoZUhpdD8uKGF1Z21lbnRlZENhbGwpO1xuICAgICAgICB0aGlzLm9ic2VydmVyPy5vblRvb2xSZXN1bHQ/LihhdWdtZW50ZWRDYWxsLCBjYWNoZWQucmVzdWx0KTtcblxuICAgICAgICAvLyBSZWNvcmQgY2FjaGUgaGl0IGFzIHN1Y2Nlc3NmdWwgZXhlY3V0aW9uIHdpdGggMG1zIHRpbWVcbiAgICAgICAgLy8gUGVyZm9ybWFuY2UgbW9uaXRvcmluZyByZW1vdmVkIC0gbm8gbGVnYWN5IGNvbXBvbmVudHNcbiAgICAgICAgdGhpcy5yZWNvcmRUb29sSGlzdG9yeSh7XG4gICAgICAgICAgdG9vbE5hbWU6IGNhbGwubmFtZSxcbiAgICAgICAgICBhcmdzLFxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIGhhc091dHB1dDogaGFzTm9uRW1wdHlPdXRwdXQoY2FjaGVkLnJlc3VsdCksXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gY2FjaGVkLnJlc3VsdDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLm9ic2VydmVyPy5vblRvb2xTdGFydD8uKGF1Z21lbnRlZENhbGwpO1xuXG4gICAgLy8gUGVyZm9ybWFuY2UgbW9uaXRvcmluZyByZW1vdmVkIC0gbm8gbGVnYWN5IGNvbXBvbmVudHNcblxuICAgIHRyeSB7XG4gICAgICB2YWxpZGF0ZVRvb2xBcmd1bWVudHMocmVjb3JkLmRlZmluaXRpb24ubmFtZSwgcmVjb3JkLmRlZmluaXRpb24ucGFyYW1ldGVycywgYXJncyk7XG5cbiAgICAgIC8vIFByZS1mbGlnaHQgQUkgZmxvdyB2YWxpZGF0aW9uIC0gY2F0Y2ggY29tbW9uIHRvb2wgdXNhZ2UgZmFpbHVyZXNcbiAgICAgIGNvbnN0IHByZWZsaWdodFdhcm5pbmdzID0gdmFsaWRhdGVUb29sUHJlY29uZGl0aW9ucyhjYWxsLm5hbWUsIGFyZ3MpO1xuICAgICAgZm9yIChjb25zdCB3YXJuaW5nIG9mIHByZWZsaWdodFdhcm5pbmdzKSB7XG4gICAgICAgIHRoaXMub2JzZXJ2ZXI/Lm9uVG9vbFdhcm5pbmc/LihhdWdtZW50ZWRDYWxsLCB3YXJuaW5nKTtcbiAgICAgIH1cblxuICAgICAgLy8gQWR2YW5jZWQgQUkgZmxvdyBwYXR0ZXJuIHZhbGlkYXRpb24gdXNpbmcgdG9vbCBoaXN0b3J5XG4gICAgICBjb25zdCBhaUZsb3dXYXJuaW5ncyA9IHZhbGlkYXRlQUlGbG93UGF0dGVybnMoY2FsbC5uYW1lLCBhcmdzLCB0aGlzLnRvb2xIaXN0b3J5KTtcbiAgICAgIGZvciAoY29uc3Qgd2FybmluZyBvZiBhaUZsb3dXYXJuaW5ncykge1xuICAgICAgICB0aGlzLm9ic2VydmVyPy5vblRvb2xXYXJuaW5nPy4oYXVnbWVudGVkQ2FsbCwgd2FybmluZyk7XG4gICAgICB9XG5cbiAgICAgIC8vIENvbGxlY3Qgb3B0aW1pemF0aW9uIGhpbnRzIHRvIGluamVjdCBpbnRvIHJlc3VsdFxuICAgICAgY29uc3Qgb3B0aW1pemF0aW9uSGludHM6IHN0cmluZ1tdID0gW107XG4gICAgICBjb25zdCBzZWVuT3B0aW1pemF0aW9uQ29kZXMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgICAgIGZvciAoY29uc3Qgd2FybmluZyBvZiBbLi4ucHJlZmxpZ2h0V2FybmluZ3MsIC4uLmFpRmxvd1dhcm5pbmdzXSkge1xuICAgICAgICBpZiAod2FybmluZy5jb2RlICYmIHNlZW5PcHRpbWl6YXRpb25Db2Rlcy5oYXMod2FybmluZy5jb2RlKSkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGhpbnQgPSBidWlsZE9wdGltaXphdGlvbkhpbnQod2FybmluZyk7XG4gICAgICAgIGlmIChoaW50KSB7XG4gICAgICAgICAgaWYgKHdhcm5pbmcuY29kZSkge1xuICAgICAgICAgICAgc2Vlbk9wdGltaXphdGlvbkNvZGVzLmFkZCh3YXJuaW5nLmNvZGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBvcHRpbWl6YXRpb25IaW50cy5wdXNoKGhpbnQpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRvb2xFeGVjdXRpb25Db250ZXh0LnJ1bihcbiAgICAgICAgeyBjYWxsOiBhdWdtZW50ZWRDYWxsLCBvYnNlcnZlcjogdGhpcy5vYnNlcnZlciA/PyB1bmRlZmluZWQgfSxcbiAgICAgICAgYXN5bmMgKCkgPT4gcmVjb3JkLmRlZmluaXRpb24uaGFuZGxlcihhcmdzKVxuICAgICAgKTtcbiAgICAgIGxldCBvdXRwdXQgPSB0eXBlb2YgcmVzdWx0ID09PSAnc3RyaW5nJyA/IHJlc3VsdCA6IEpTT04uc3RyaW5naWZ5KHJlc3VsdCwgbnVsbCwgMik7XG4gICAgICBsZXQgc25hcHNob3RDYW5kaWRhdGUgPSBvdXRwdXQ7XG5cbiAgICAgIC8vIFRydW5jYXRlIG91dHB1dCBpZiBjb250ZXh0IG1hbmFnZXIgaXMgYXZhaWxhYmxlXG4gICAgICBpZiAodGhpcy5jb250ZXh0TWFuYWdlcikge1xuICAgICAgICBjb25zdCB0cnVuY2F0ZWQgPSB0aGlzLmNvbnRleHRNYW5hZ2VyLnRydW5jYXRlVG9vbE91dHB1dChvdXRwdXQsIGNhbGwubmFtZSk7XG4gICAgICAgIGlmICh0cnVuY2F0ZWQud2FzVHJ1bmNhdGVkKSB7XG4gICAgICAgICAgb3V0cHV0ID0gdHJ1bmNhdGVkLmNvbnRlbnQ7XG4gICAgICAgICAgLy8gTG9nIHRydW5jYXRpb24gZm9yIGRlYnVnZ2luZ1xuICAgICAgICAgIGlmIChwcm9jZXNzLmVudlsnREVCVUdfQ09OVEVYVCddKSB7XG4gICAgICAgICAgICBsb2dEZWJ1ZyhcbiAgICAgICAgICAgICAgYFtDb250ZXh0IE1hbmFnZXJdIFRydW5jYXRlZCAke2NhbGwubmFtZX0gb3V0cHV0OiAke3RydW5jYXRlZC5vcmlnaW5hbExlbmd0aH0gLT4gJHt0cnVuY2F0ZWQudHJ1bmNhdGVkTGVuZ3RofSBjaGFyc2BcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHNuYXBzaG90Q2FuZGlkYXRlID0gb3V0cHV0O1xuICAgICAgfVxuXG4gICAgICB0aGlzLnJlY29yZERpZmZTbmFwc2hvdChhcmdzLCBzbmFwc2hvdENhbmRpZGF0ZSk7XG5cbiAgICAgIC8vIENhY2hlIHRoZSByZXN1bHQgaWYgY2FjaGVhYmxlXG4gICAgICBpZiAoY2FuVXNlQ2FjaGUpIHtcbiAgICAgICAgY29uc3QgY2FjaGVLZXkgPSB0aGlzLmdldENhY2hlS2V5KHsgLi4uY2FsbCwgYXJndW1lbnRzOiBhcmdzIH0pO1xuICAgICAgICB0aGlzLmNhY2hlLnNldChjYWNoZUtleSwge1xuICAgICAgICAgIHJlc3VsdDogb3V0cHV0LFxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFwcGVuZCBvcHRpbWl6YXRpb24gaGludHMgdG8gZ3VpZGUgZnV0dXJlIExMTSBiZWhhdmlvclxuICAgICAgaWYgKG9wdGltaXphdGlvbkhpbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgb3V0cHV0ID0gb3V0cHV0ICsgb3B0aW1pemF0aW9uSGludHMuam9pbignJyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMub2JzZXJ2ZXI/Lm9uVG9vbFJlc3VsdD8uKGF1Z21lbnRlZENhbGwsIG91dHB1dCk7XG5cbiAgICAgIHRoaXMucmVjb3JkVG9vbEhpc3Rvcnkoe1xuICAgICAgICB0b29sTmFtZTogY2FsbC5uYW1lLFxuICAgICAgICBhcmdzLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGhhc091dHB1dDogaGFzTm9uRW1wdHlPdXRwdXQob3V0cHV0KSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBSZWNvcmQgc3VjY2Vzc2Z1bCBleGVjdXRpb25cbiAgICAgIC8vIFBlcmZvcm1hbmNlIG1vbml0b3JpbmcgcmVtb3ZlZCAtIG5vIGxlZ2FjeSBjb21wb25lbnRzXG4gICAgICByZXR1cm4gb3V0cHV0O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsZXQgZm9ybWF0dGVkOiBzdHJpbmc7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBUb29sQXJndW1lbnRWYWxpZGF0aW9uRXJyb3IpIHtcbiAgICAgICAgZm9ybWF0dGVkID0gZXJyb3IubWVzc2FnZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcik7XG4gICAgICAgIGZvcm1hdHRlZCA9IGBGYWlsZWQgdG8gcnVuIFwiJHtjYWxsLm5hbWV9XCI6ICR7bWVzc2FnZX1gO1xuICAgICAgfVxuICAgICAgdGhpcy5vYnNlcnZlcj8ub25Ub29sRXJyb3I/LihhdWdtZW50ZWRDYWxsLCBmb3JtYXR0ZWQpO1xuICAgICAgdGhpcy5yZWNvcmRUb29sSGlzdG9yeSh7XG4gICAgICAgIHRvb2xOYW1lOiBjYWxsLm5hbWUsXG4gICAgICAgIGFyZ3MsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGhhc091dHB1dDogaGFzTm9uRW1wdHlPdXRwdXQoZm9ybWF0dGVkKSxcbiAgICAgICAgZXJyb3I6IGZvcm1hdHRlZCxcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBSZWNvcmQgZmFpbGVkIGV4ZWN1dGlvbiAtIG5vIGxlZ2FjeSBwZXJmb3JtYW5jZSBtb25pdG9yaW5nXG4gICAgICByZXR1cm4gZm9ybWF0dGVkO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0Q2FjaGVLZXkoY2FsbDogVG9vbENhbGxSZXF1ZXN0KTogc3RyaW5nIHtcbiAgICByZXR1cm4gYCR7Y2FsbC5uYW1lfToke0pTT04uc3RyaW5naWZ5KGNhbGwuYXJndW1lbnRzKX1gO1xuICB9XG5cbiAgY2xlYXJDYWNoZSgpOiB2b2lkIHtcbiAgICB0aGlzLmNhY2hlLmNsZWFyKCk7XG4gIH1cblxuICBnZXRDYWNoZVN0YXRzKCk6IHsgc2l6ZTogbnVtYmVyOyBlbnRyaWVzOiBudW1iZXIgfSB7XG4gICAgbGV0IHRvdGFsU2l6ZSA9IDA7XG4gICAgZm9yIChjb25zdCBlbnRyeSBvZiB0aGlzLmNhY2hlLnZhbHVlcygpKSB7XG4gICAgICB0b3RhbFNpemUgKz0gZW50cnkucmVzdWx0Lmxlbmd0aDtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHNpemU6IHRvdGFsU2l6ZSxcbiAgICAgIGVudHJpZXM6IHRoaXMuY2FjaGUuc2l6ZSxcbiAgICB9O1xuICB9XG5cbiAgY2xlYXJUb29sSGlzdG9yeSgpOiB2b2lkIHtcbiAgICB0aGlzLnRvb2xIaXN0b3J5Lmxlbmd0aCA9IDA7XG4gIH1cblxuICBnZXRUb29sSGlzdG9yeSgpOiByZWFkb25seSBUb29sSGlzdG9yeUVudHJ5W10ge1xuICAgIHJldHVybiB0aGlzLnRvb2xIaXN0b3J5O1xuICB9XG5cbiAgcHJpdmF0ZSByZWNvcmRUb29sSGlzdG9yeShlbnRyeTogVG9vbEhpc3RvcnlFbnRyeSk6IHZvaWQge1xuICAgIHRoaXMudG9vbEhpc3RvcnkucHVzaChlbnRyeSk7XG4gICAgaWYgKHRoaXMudG9vbEhpc3RvcnkubGVuZ3RoID4gdGhpcy5tYXhIaXN0b3J5U2l6ZSkge1xuICAgICAgdGhpcy50b29sSGlzdG9yeS5zaGlmdCgpO1xuICAgIH1cbiAgfVxuXG4gIGNsZWFyRGlmZlNuYXBzaG90cygpOiB2b2lkIHtcbiAgICB0aGlzLmRpZmZTbmFwc2hvdHMubGVuZ3RoID0gMDtcbiAgfVxuXG4gIGdldERpZmZTbmFwc2hvdHMoKTogcmVhZG9ubHkgRGlmZlNuYXBzaG90UmVjb3JkW10ge1xuICAgIHJldHVybiB0aGlzLmRpZmZTbmFwc2hvdHM7XG4gIH1cblxuICBwcml2YXRlIGFkZFRvb2woZGVmaW5pdGlvbjogVG9vbERlZmluaXRpb24sIHN1aXRlSWQ6IHN0cmluZyk6IHZvaWQge1xuICAgIGlmICghZGVmaW5pdGlvbj8ubmFtZT8udHJpbSgpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRvb2wgbmFtZXMgY2Fubm90IGJlIGJsYW5rIChzdWl0ZSBcIiR7c3VpdGVJZH1cIikuYCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnJlZ2lzdHJ5LmhhcyhkZWZpbml0aW9uLm5hbWUpKSB7XG4gICAgICBjb25zdCBvd25lciA9IHRoaXMucmVnaXN0cnkuZ2V0KGRlZmluaXRpb24ubmFtZSk/LnN1aXRlSWQgPz8gJ3Vua25vd24nO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUb29sIFwiJHtkZWZpbml0aW9uLm5hbWV9XCIgYWxyZWFkeSByZWdpc3RlcmVkIGJ5IHN1aXRlIFwiJHtvd25lcn1cIi5gKTtcbiAgICB9XG4gICAgdGhpcy5yZWdpc3RyeS5zZXQoZGVmaW5pdGlvbi5uYW1lLCB7XG4gICAgICBzdWl0ZUlkLFxuICAgICAgZGVmaW5pdGlvbixcbiAgICB9KTtcbiAgICB0aGlzLnJlZ2lzdHJhdGlvbk9yZGVyLnB1c2goZGVmaW5pdGlvbi5uYW1lKTtcbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlRnJvbU9yZGVyKG5hbWU6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5yZWdpc3RyYXRpb25PcmRlci5pbmRleE9mKG5hbWUpO1xuICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICB0aGlzLnJlZ2lzdHJhdGlvbk9yZGVyLnNwbGljZShpbmRleCwgMSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZWNvcmREaWZmU25hcHNob3QoYXJnczogUmVjb3JkPHN0cmluZywgdW5rbm93bj4sIG91dHB1dDogc3RyaW5nKTogdm9pZCB7XG4gICAgY29uc3QgY29tbWFuZCA9IHRoaXMuZmluZEdpdERpZmZDb21tYW5kKGFyZ3MpO1xuICAgIGlmICghY29tbWFuZCB8fCAhb3V0cHV0KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5kaWZmU25hcHNob3RzLnB1c2goe1xuICAgICAgY29tbWFuZCxcbiAgICAgIG91dHB1dDogc2FmZVRydW5jYXRlKG91dHB1dCwgdGhpcy5tYXhEaWZmU25hcHNob3RMZW5ndGgsICdnaXQtZGlmZicpLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgIH0pO1xuXG4gICAgaWYgKHRoaXMuZGlmZlNuYXBzaG90cy5sZW5ndGggPiB0aGlzLm1heERpZmZTbmFwc2hvdHMpIHtcbiAgICAgIHRoaXMuZGlmZlNuYXBzaG90cy5zaGlmdCgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZmluZEdpdERpZmZDb21tYW5kKGFyZ3M6IFJlY29yZDxzdHJpbmcsIHVua25vd24+KTogc3RyaW5nIHwgbnVsbCB7XG4gICAgZm9yIChjb25zdCBjb21tYW5kIG9mIHRoaXMuZXh0cmFjdENvbW1hbmRzKGFyZ3MpKSB7XG4gICAgICBpZiAodGhpcy5pc0dpdERpZmZDb21tYW5kKGNvbW1hbmQpKSB7XG4gICAgICAgIHJldHVybiBjb21tYW5kO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHByaXZhdGUgZXh0cmFjdENvbW1hbmRzKGFyZ3M6IFJlY29yZDxzdHJpbmcsIHVua25vd24+KTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGNvbW1hbmRzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgY29uc3QgY29tbWFuZCA9IGFyZ3NbJ2NvbW1hbmQnXTtcbiAgICBpZiAodHlwZW9mIGNvbW1hbmQgPT09ICdzdHJpbmcnICYmIGNvbW1hbmQudHJpbSgpKSB7XG4gICAgICBjb21tYW5kcy5wdXNoKGNvbW1hbmQudHJpbSgpKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb21tYW5kTGlzdCA9IGFyZ3NbJ2NvbW1hbmRzJ107XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoY29tbWFuZExpc3QpKSB7XG4gICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIGNvbW1hbmRMaXN0KSB7XG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHZhbHVlLnRyaW0oKSkge1xuICAgICAgICAgIGNvbW1hbmRzLnB1c2godmFsdWUudHJpbSgpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBjb21tYW5kcztcbiAgfVxuXG4gIHByaXZhdGUgaXNHaXREaWZmQ29tbWFuZChjb21tYW5kOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gL1xcYmdpdFxccysoPzotLW5vLXBhZ2VyXFxzKyk/KD86ZGlmZnxzaG93KVxcYi9pLnRlc3QoY29tbWFuZCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURlZmF1bHRUb29sUnVudGltZShcbiAgY29udGV4dDogVG9vbEV4ZWN1dGlvbkNvbnRleHQsXG4gIHRvb2xTdWl0ZXM6IFRvb2xTdWl0ZVtdID0gW10sXG4gIG9wdGlvbnM6IFRvb2xSdW50aW1lT3B0aW9ucyA9IHt9XG4pOiBUb29sUnVudGltZSB7XG4gIC8vIFN0YXJ0IHdpdGggbm8gZGVmYXVsdCBpbnRyb3NwZWN0aW9uIHRvb2xzIC0gdGhleSB3YXN0ZSB0b2tlbnNcbiAgLy8gTW9kZWwga25vd3MgaXRzIGNhcGFiaWxpdGllcyBmcm9tIHRvb2wgZGVmaW5pdGlvbnNcbiAgY29uc3QgcnVudGltZSA9IG5ldyBUb29sUnVudGltZShbXSwgb3B0aW9ucyk7XG5cbiAgZm9yIChjb25zdCBzdWl0ZSBvZiB0b29sU3VpdGVzKSB7XG4gICAgcnVudGltZS5yZWdpc3RlclN1aXRlKHN1aXRlKTtcbiAgfVxuXG4gIHJldHVybiBydW50aW1lO1xufVxuXG4vLyBSZW1vdmVkIHVudXNlZCBpbnRyb3NwZWN0aW9uIHRvb2xzIChjb250ZXh0X3NuYXBzaG90LCBjYXBhYmlsaXRpZXNfb3ZlcnZpZXcsIHByb2ZpbGVfZGV0YWlscylcbi8vIE1vZGVsIGFscmVhZHkga25vd3MgY2FwYWJpbGl0aWVzIGZyb20gdG9vbCBkZWZpbml0aW9uczsgdGhlc2UganVzdCB3YXN0ZWQgdG9rZW5zXG5cbmZ1bmN0aW9uIGhhc05vbkVtcHR5T3V0cHV0KG91dHB1dDogc3RyaW5nKTogYm9vbGVhbiB7XG4gIHJldHVybiB0eXBlb2Ygb3V0cHV0ID09PSAnc3RyaW5nJyAmJiBvdXRwdXQudHJpbSgpLmxlbmd0aCA+IDA7XG59XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZVRvb2xBcmd1bWVudHModmFsdWU6IHVua25vd24pOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiB7XG4gIGlmICh2YWx1ZSBpbnN0YW5jZW9mIE1hcCkge1xuICAgIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXModmFsdWUuZW50cmllcygpKTtcbiAgfVxuICBpZiAoaXNSZWNvcmQodmFsdWUpKSB7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG4gIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSB7XG4gICAgY29uc3QgdHJpbW1lZCA9IHZhbHVlLnRyaW0oKTtcbiAgICBpZiAoIXRyaW1tZWQpIHtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2UodHJpbW1lZCk7XG4gICAgICByZXR1cm4gaXNSZWNvcmQocGFyc2VkKSA/IHBhcnNlZCA6IHt9O1xuICAgIH0gY2F0Y2gge1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH1cbiAgfVxuICByZXR1cm4ge307XG59XG5cbmZ1bmN0aW9uIGlzUmVjb3JkKHZhbHVlOiB1bmtub3duKTogdmFsdWUgaXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4ge1xuICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAhPT0gbnVsbCAmJiAhQXJyYXkuaXNBcnJheSh2YWx1ZSk7XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQ0EsSUFBQUEsZ0JBQUEsR0FBQUMsT0FBQTtBQU9BLElBQUFDLGdCQUFBLEdBQUFELE9BQUE7QUFPQSxJQUFBRSxrQkFBQSxHQUFBRixPQUFBO0FBRUEsSUFBQUcsbUJBQUEsR0FBQUgsT0FBQTtBQUNBLElBQUFJLFlBQUEsR0FBQUosT0FBQTtBQWxCQTs7QUFvQkE7QUFDQTtBQUNBOztBQVFBO0FBQ0E7QUFDQTs7QUE0QkE7QUFDQTtBQUNBOztBQUtBO0FBQ0E7QUFDQTs7QUFxQkE7QUFDQTtBQUNBOztBQWdEQSxNQUFNSyxvQkFBb0IsR0FBRyxJQUFJQyxrQ0FBaUIsQ0FBcUIsQ0FBQzs7QUFFeEU7QUFDQTtBQUNBO0FBQ0E7QUFDTyxTQUFTQyxrQkFBa0JBLENBQUNDLFFBQTRCLEVBQVE7RUFDckUsTUFBTUMsT0FBTyxHQUFHSixvQkFBb0IsQ0FBQ0ssUUFBUSxDQUFDLENBQUM7RUFDL0MsSUFBSSxDQUFDRCxPQUFPLEVBQUVFLFFBQVEsRUFBRUMsY0FBYyxFQUFFO0lBQ3RDO0VBQ0Y7RUFFQSxNQUFNQyxPQUFPLEdBQUdDLE1BQU0sQ0FBQ0MsUUFBUSxDQUFDUCxRQUFRLENBQUNLLE9BQU8sQ0FBQyxHQUFHRyxJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFDLEVBQUVULFFBQVEsQ0FBQ0ssT0FBTyxDQUFDLEdBQUcsQ0FBQztFQUNyRixNQUFNSyxLQUFLLEdBQUdWLFFBQVEsQ0FBQ1UsS0FBSyxLQUFLQyxTQUFTLEdBQUdILElBQUksQ0FBQ0MsR0FBRyxDQUFDSixPQUFPLEVBQUVMLFFBQVEsQ0FBQ1UsS0FBSyxDQUFD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UyxXQUFBLEdBQUFBLFdBQUE7QUFFTSxTQUFTZ0ksd0JBQXdCQSxDQUN0QzlKLE9BQTZCLEVBQzdCK0osVUFBdUIsR0FBRyxFQUFFLEVBQzVCckgsT0FBMkIsR0FBRyxDQUFDLENBQUMsRUFDbkI7RUFDYjtFQUNBO0VBQ0EsTUFBTXNILE9BQU8sR0FBRyxJQUFJbEksV0FBVyxDQUFDLEVBQUUsRUFBRVksT0FBTyxDQUFDO0VBRTVDLEtBQUssTUFBTWhCLEtBQUssSUFBSXFJLFVBQVUsRUFBRTtJQUM5QkMsT0FBTyxDQUFDakgsYUFBYSxDQUFDckIsS0FBSyxDQUFDO0VBQzlCO0VBRUEsT0FBT3NJLE9BQU87QUFDaEI7O0FBRUE7QUFDQTs7QUFFQSxTQUFTaEUsaUJBQWlCQSxDQUFDZSxNQUFjLEVBQVc7RUFDbEQsT0FBTyxPQUFPQSxNQUFNLEtBQUssUUFBUSxJQUFJQSxNQUFNLENBQUM1RCxJQUFJLENBQUMsQ0FBQyxDQUFDTCxNQUFNLEdBQUcsQ0FBQztBQUMvRDtBQUVBLFNBQVN3QixzQkFBc0JBLENBQUNzRixLQUFjLEVBQTJCO0VBQ3ZFLElBQUlBLEtBQUssWUFBWTVILEdBQUcsRUFBRTtJQUN4QixPQUFPaUksTUFBTSxDQUFDQyxXQUFXLENBQUNOLEtBQUssQ0FBQ25HLE9BQU8sQ0FBQyxDQUFDLENBQUM7RUFDNUM7RUFDQSxJQUFJMEcsUUFBUSxDQUFDUCxLQUFLLENBQUMsRUFBRTtJQUNuQixPQUFPQSxLQUFLO0VBQ2Q7RUFDQSxJQUFJLE9BQU9BLEtBQUssS0FBSyxRQUFRLEVBQUU7SUFDN0IsTUFBTVEsT0FBTyxHQUFHUixLQUFLLENBQUN6RyxJQUFJLENBQUMsQ0FBQztJQUM1QixJQUFJLENBQUNpSCxPQUFPLEVBQUU7TUFDWixPQUFPLENBQUMsQ0FBQztJQUNYO0lBQ0EsSUFBSTtNQUNGLE1BQU1DLE1BQU0sR0FBR3JELElBQUksQ0FBQ3NELEtBQUssQ0FBQ0YsT0FBTyxDQUFDO01BQ2xDLE9BQU9ELFFBQVEsQ0FBQ0UsTUFBTSxDQUFDLEdBQUdBLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDdkMsQ0FBQyxDQUFDLE1BQU07TUFDTixPQUFPLENBQUMsQ0FBQztJQUNYO0VBQ0Y7RUFDQSxPQUFPLENBQUMsQ0FBQztBQUNYO0FBRUEsU0FBU0YsUUFBUUEsQ0FBQ1AsS0FBYyxFQUFvQztFQUNsRSxPQUFPLE9BQU9BLEtBQUssS0FBSyxRQUFRLElBQUlBLEtBQUssS0FBSyxJQUFJLElBQUksQ0FBQ0YsS0FBSyxDQUFDQyxPQUFPLENBQUNDLEtBQUssQ0FBQztBQUM3RSIsImlnbm9yZUxpc3QiOltdfQ==