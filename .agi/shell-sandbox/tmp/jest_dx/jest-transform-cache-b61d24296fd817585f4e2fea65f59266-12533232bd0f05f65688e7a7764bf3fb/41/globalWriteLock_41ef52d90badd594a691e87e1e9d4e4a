15da0524e6ad175109960acab480993e
/* istanbul ignore next */
function cov_j4jwfo2m9() {
  var path = "/Users/bo/GitHub/agi-core-CLI-coding/src/ui/globalWriteLock.ts";
  var hash = "f0217839e13778e127bd52a395abb7feb48430ee";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/bo/GitHub/agi-core-CLI-coding/src/ui/globalWriteLock.ts",
    statementMap: {
      "0": {
        start: {
          line: 16,
          column: 22
        },
        end: {
          line: 16,
          column: 27
        }
      },
      "1": {
        start: {
          line: 22,
          column: 2
        },
        end: {
          line: 22,
          column: 25
        }
      },
      "2": {
        start: {
          line: 30,
          column: 2
        },
        end: {
          line: 30,
          column: 25
        }
      },
      "3": {
        start: {
          line: 38,
          column: 2
        },
        end: {
          line: 38,
          column: 26
        }
      },
      "4": {
        start: {
          line: 46,
          column: 2
        },
        end: {
          line: 48,
          column: 3
        }
      },
      "5": {
        start: {
          line: 47,
          column: 4
        },
        end: {
          line: 47,
          column: 17
        }
      },
      "6": {
        start: {
          line: 49,
          column: 2
        },
        end: {
          line: 49,
          column: 13
        }
      },
      "7": {
        start: {
          line: 50,
          column: 2
        },
        end: {
          line: 50,
          column: 14
        }
      }
    },
    fnMap: {
      "0": {
        name: "isStreamingMode",
        decl: {
          start: {
            line: 21,
            column: 16
          },
          end: {
            line: 21,
            column: 31
          }
        },
        loc: {
          start: {
            line: 21,
            column: 43
          },
          end: {
            line: 23,
            column: 1
          }
        },
        line: 21
      },
      "1": {
        name: "enterStreamingMode",
        decl: {
          start: {
            line: 28,
            column: 16
          },
          end: {
            line: 28,
            column: 34
          }
        },
        loc: {
          start: {
            line: 28,
            column: 43
          },
          end: {
            line: 31,
            column: 1
          }
        },
        line: 28
      },
      "2": {
        name: "exitStreamingMode",
        decl: {
          start: {
            line: 36,
            column: 16
          },
          end: {
            line: 36,
            column: 33
          }
        },
        loc: {
          start: {
            line: 36,
            column: 42
          },
          end: {
            line: 39,
            column: 1
          }
        },
        line: 36
      },
      "3": {
        name: "ifNotStreaming",
        decl: {
          start: {
            line: 45,
            column: 16
          },
          end: {
            line: 45,
            column: 30
          }
        },
        loc: {
          start: {
            line: 45,
            column: 62
          },
          end: {
            line: 51,
            column: 1
          }
        },
        line: 45
      },
      "4": {
        name: "installGlobalWriteLock",
        decl: {
          start: {
            line: 58,
            column: 16
          },
          end: {
            line: 58,
            column: 38
          }
        },
        loc: {
          start: {
            line: 58,
            column: 47
          },
          end: {
            line: 61,
            column: 1
          }
        },
        line: 58
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 46,
            column: 2
          },
          end: {
            line: 48,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 46,
            column: 2
          },
          end: {
            line: 48,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 46
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0
    },
    b: {
      "0": [0, 0]
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "f0217839e13778e127bd52a395abb7feb48430ee"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_j4jwfo2m9 = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_j4jwfo2m9();
/**
 * Global Write Lock - Simplified streaming-safe output coordination
 *
 * This module provides a simple mechanism to ensure streaming content
 * is not interrupted by other UI components during streaming.
 *
 * Design Principle:
 * - During streaming, ONLY streaming content writes to stdout
 * - All other UI components (status, input area, etc.) wait until streaming ends
 * - No complex lock nesting or queuing - just a simple boolean flag
 *
 * This prevents the garbled output and cutoffs that occur when multiple
 * components try to write simultaneously with cursor positioning.
 */

let streamingActive =
/* istanbul ignore next */
(cov_j4jwfo2m9().s[0]++, false);

/**
 * Check if streaming mode is currently active
 */
export function isStreamingMode() {
  /* istanbul ignore next */
  cov_j4jwfo2m9().f[0]++;
  cov_j4jwfo2m9().s[1]++;
  return streamingActive;
}

/**
 * Enter streaming mode - blocks all non-streaming output
 */
export function enterStreamingMode() {
  /* istanbul ignore next */
  cov_j4jwfo2m9().f[1]++;
  cov_j4jwfo2m9().s[2]++;
  // Silently handle re-entry - no console output to avoid polluting chat
  streamingActive = true;
}

/**
 * Exit streaming mode - allows normal UI output to resume
 */
export function exitStreamingMode() {
  /* istanbul ignore next */
  cov_j4jwfo2m9().f[2]++;
  cov_j4jwfo2m9().s[3]++;
  // Be tolerant of double-exit; just clear the flag.
  streamingActive = false;
}

/**
 * Execute a callback only if not in streaming mode.
 * Returns true if the callback was executed, false if skipped.
 */
export function ifNotStreaming(callback) {
  /* istanbul ignore next */
  cov_j4jwfo2m9().f[3]++;
  cov_j4jwfo2m9().s[4]++;
  if (streamingActive) {
    /* istanbul ignore next */
    cov_j4jwfo2m9().b[0][0]++;
    cov_j4jwfo2m9().s[5]++;
    return false;
  } else
  /* istanbul ignore next */
  {
    cov_j4jwfo2m9().b[0][1]++;
  }
  cov_j4jwfo2m9().s[6]++;
  callback();
  /* istanbul ignore next */
  cov_j4jwfo2m9().s[7]++;
  return true;
}

/**
 * Legacy: installGlobalWriteLock is now a no-op
 * The old approach of wrapping stdout.write caused nested lock issues.
 * We now use a simpler streaming mode flag instead.
 */
export function installGlobalWriteLock() {
  /* istanbul ignore next */
  cov_j4jwfo2m9().f[4]++;
} // No-op - we no longer wrap stdout.write
// The streaming mode flag handles coordination instead
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfajRqd2ZvMm05IiwiYWN0dWFsQ292ZXJhZ2UiLCJzdHJlYW1pbmdBY3RpdmUiLCJzIiwiaXNTdHJlYW1pbmdNb2RlIiwiZiIsImVudGVyU3RyZWFtaW5nTW9kZSIsImV4aXRTdHJlYW1pbmdNb2RlIiwiaWZOb3RTdHJlYW1pbmciLCJjYWxsYmFjayIsImIiLCJpbnN0YWxsR2xvYmFsV3JpdGVMb2NrIl0sInNvdXJjZXMiOlsiZ2xvYmFsV3JpdGVMb2NrLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogR2xvYmFsIFdyaXRlIExvY2sgLSBTaW1wbGlmaWVkIHN0cmVhbWluZy1zYWZlIG91dHB1dCBjb29yZGluYXRpb25cbiAqXG4gKiBUaGlzIG1vZHVsZSBwcm92aWRlcyBhIHNpbXBsZSBtZWNoYW5pc20gdG8gZW5zdXJlIHN0cmVhbWluZyBjb250ZW50XG4gKiBpcyBub3QgaW50ZXJydXB0ZWQgYnkgb3RoZXIgVUkgY29tcG9uZW50cyBkdXJpbmcgc3RyZWFtaW5nLlxuICpcbiAqIERlc2lnbiBQcmluY2lwbGU6XG4gKiAtIER1cmluZyBzdHJlYW1pbmcsIE9OTFkgc3RyZWFtaW5nIGNvbnRlbnQgd3JpdGVzIHRvIHN0ZG91dFxuICogLSBBbGwgb3RoZXIgVUkgY29tcG9uZW50cyAoc3RhdHVzLCBpbnB1dCBhcmVhLCBldGMuKSB3YWl0IHVudGlsIHN0cmVhbWluZyBlbmRzXG4gKiAtIE5vIGNvbXBsZXggbG9jayBuZXN0aW5nIG9yIHF1ZXVpbmcgLSBqdXN0IGEgc2ltcGxlIGJvb2xlYW4gZmxhZ1xuICpcbiAqIFRoaXMgcHJldmVudHMgdGhlIGdhcmJsZWQgb3V0cHV0IGFuZCBjdXRvZmZzIHRoYXQgb2NjdXIgd2hlbiBtdWx0aXBsZVxuICogY29tcG9uZW50cyB0cnkgdG8gd3JpdGUgc2ltdWx0YW5lb3VzbHkgd2l0aCBjdXJzb3IgcG9zaXRpb25pbmcuXG4gKi9cblxubGV0IHN0cmVhbWluZ0FjdGl2ZSA9IGZhbHNlO1xuXG4vKipcbiAqIENoZWNrIGlmIHN0cmVhbWluZyBtb2RlIGlzIGN1cnJlbnRseSBhY3RpdmVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzU3RyZWFtaW5nTW9kZSgpOiBib29sZWFuIHtcbiAgcmV0dXJuIHN0cmVhbWluZ0FjdGl2ZTtcbn1cblxuLyoqXG4gKiBFbnRlciBzdHJlYW1pbmcgbW9kZSAtIGJsb2NrcyBhbGwgbm9uLXN0cmVhbWluZyBvdXRwdXRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGVudGVyU3RyZWFtaW5nTW9kZSgpOiB2b2lkIHtcbiAgLy8gU2lsZW50bHkgaGFuZGxlIHJlLWVudHJ5IC0gbm8gY29uc29sZSBvdXRwdXQgdG8gYXZvaWQgcG9sbHV0aW5nIGNoYXRcbiAgc3RyZWFtaW5nQWN0aXZlID0gdHJ1ZTtcbn1cblxuLyoqXG4gKiBFeGl0IHN0cmVhbWluZyBtb2RlIC0gYWxsb3dzIG5vcm1hbCBVSSBvdXRwdXQgdG8gcmVzdW1lXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBleGl0U3RyZWFtaW5nTW9kZSgpOiB2b2lkIHtcbiAgLy8gQmUgdG9sZXJhbnQgb2YgZG91YmxlLWV4aXQ7IGp1c3QgY2xlYXIgdGhlIGZsYWcuXG4gIHN0cmVhbWluZ0FjdGl2ZSA9IGZhbHNlO1xufVxuXG4vKipcbiAqIEV4ZWN1dGUgYSBjYWxsYmFjayBvbmx5IGlmIG5vdCBpbiBzdHJlYW1pbmcgbW9kZS5cbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgY2FsbGJhY2sgd2FzIGV4ZWN1dGVkLCBmYWxzZSBpZiBza2lwcGVkLlxuICovXG5leHBvcnQgZnVuY3Rpb24gaWZOb3RTdHJlYW1pbmcoY2FsbGJhY2s6ICgpID0+IHZvaWQpOiBib29sZWFuIHtcbiAgaWYgKHN0cmVhbWluZ0FjdGl2ZSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBjYWxsYmFjaygpO1xuICByZXR1cm4gdHJ1ZTtcbn1cblxuLyoqXG4gKiBMZWdhY3k6IGluc3RhbGxHbG9iYWxXcml0ZUxvY2sgaXMgbm93IGEgbm8tb3BcbiAqIFRoZSBvbGQgYXBwcm9hY2ggb2Ygd3JhcHBpbmcgc3Rkb3V0LndyaXRlIGNhdXNlZCBuZXN0ZWQgbG9jayBpc3N1ZXMuXG4gKiBXZSBub3cgdXNlIGEgc2ltcGxlciBzdHJlYW1pbmcgbW9kZSBmbGFnIGluc3RlYWQuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbnN0YWxsR2xvYmFsV3JpdGVMb2NrKCk6IHZvaWQge1xuICAvLyBOby1vcCAtIHdlIG5vIGxvbmdlciB3cmFwIHN0ZG91dC53cml0ZVxuICAvLyBUaGUgc3RyZWFtaW5nIG1vZGUgZmxhZyBoYW5kbGVzIGNvb3JkaW5hdGlvbiBpbnN0ZWFkXG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQWVZO0lBQUFBLGFBQUEsWUFBQUEsQ0FBQTtNQUFBLE9BQUFDLGNBQUE7SUFBQTtFQUFBO0VBQUEsT0FBQUEsY0FBQTtBQUFBO0FBQUFELGFBQUE7QUFmWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLElBQUlFLGVBQWU7QUFBQTtBQUFBLENBQUFGLGFBQUEsR0FBQUcsQ0FBQSxPQUFHLEtBQUs7O0FBRTNCO0FBQ0E7QUFDQTtBQUNBLE9BQU8sU0FBU0MsZUFBZUEsQ0FBQSxFQUFZO0VBQUE7RUFBQUosYUFBQSxHQUFBSyxDQUFBO0VBQUFMLGFBQUEsR0FBQUcsQ0FBQTtFQUN6QyxPQUFPRCxlQUFlO0FBQ3hCOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sU0FBU0ksa0JBQWtCQSxDQUFBLEVBQVM7RUFBQTtFQUFBTixhQUFBLEdBQUFLLENBQUE7RUFBQUwsYUFBQSxHQUFBRyxDQUFBO0VBQ3pDO0VBQ0FELGVBQWUsR0FBRyxJQUFJO0FBQ3hCOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sU0FBU0ssaUJBQWlCQSxDQUFBLEVBQVM7RUFBQTtFQUFBUCxhQUFBLEdBQUFLLENBQUE7RUFBQUwsYUFBQSxHQUFBRyxDQUFBO0VBQ3hDO0VBQ0FELGVBQWUsR0FBRyxLQUFLO0FBQ3pCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyxTQUFTTSxjQUFjQSxDQUFDQyxRQUFvQixFQUFXO0VBQUE7RUFBQVQsYUFBQSxHQUFBSyxDQUFBO0VBQUFMLGFBQUEsR0FBQUcsQ0FBQTtFQUM1RCxJQUFJRCxlQUFlLEVBQUU7SUFBQTtJQUFBRixhQUFBLEdBQUFVLENBQUE7SUFBQVYsYUFBQSxHQUFBRyxDQUFBO0lBQ25CLE9BQU8sS0FBSztFQUNkLENBQUM7RUFBQTtFQUFBO0lBQUFILGFBQUEsR0FBQVUsQ0FBQTtFQUFBO0VBQUFWLGFBQUEsR0FBQUcsQ0FBQTtFQUNETSxRQUFRLENBQUMsQ0FBQztFQUFDO0VBQUFULGFBQUEsR0FBQUcsQ0FBQTtFQUNYLE9BQU8sSUFBSTtBQUNiOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPLFNBQVNRLHNCQUFzQkEsQ0FBQSxFQUFTO0VBQUE7RUFBQVgsYUFBQSxHQUFBSyxDQUFBO0FBRy9DLENBQUMsQ0FGQztBQUNBIiwiaWdub3JlTGlzdCI6W119