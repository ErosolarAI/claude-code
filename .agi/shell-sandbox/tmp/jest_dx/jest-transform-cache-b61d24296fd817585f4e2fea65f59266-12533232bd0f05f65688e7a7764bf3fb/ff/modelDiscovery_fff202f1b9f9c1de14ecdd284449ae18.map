{"version":3,"names":["_nodeFs","require","_promises","_nodePath","_nodeOs","_secretStore","_debugLogger","CACHE_DIR","join","homedir","CACHE_FILE","CACHE_EXPIRATION_MS","inferProviderFromModelId","model","normalized","trim","toLowerCase","patterns","pattern","provider","test","getCachedDiscoveredModels","existsSync","raw","readFileSync","cache","JSON","parse","lastUpdated","Date","getTime","now","models","error","logDebug","safeErrorMessage","saveDiscoveredModels","mkdir","recursive","version","toISOString","writeFileSync","stringify","discoverOpenAIModels","apiKey","response","fetch","headers","ok","Error","status","statusText","data","json","filter","id","startsWith","map","label","description","capabilities","success","message","String","discoverAnthropicModels","type","display_name","discoverGoogleModels","knownModels","signal","AbortSignal","timeout","name","includes","supportedGenerationMethods","replace","displayName","length","discoverDeepSeekModels","discoverXAIModels","discoverOllamaModels","baseURL","process","env","discoverAllModels","errors","totalModelsDiscovered","providers","envVar","discover","discoveryPromises","errorMessage","push","catch","settledResults","Promise","allSettled","results","settled","index","value","providerId","reason","result","allModels","r","flatMap","timestamp","clearDiscoveredModelsCache","PROVIDER_CONFIGS","defaultLatestModel","altEnvVars","MODEL_PRIORITIES","openai","anthropic","google","deepseek","xai","ollama","getModelPriority","modelId","priorities","undefined","prefix","priority","Object","entries","sortModelsByPriority","sort","a","b","priorityA","priorityB","getBestModel","config","find","p","sorted","isProviderConfigured","altVar","getProvidersStatus","configured","some","v","latestModel","getConfiguredProviders","getUnconfiguredProviders","getFirstAvailableProvider","preferenceOrder","getLatestModelForProvider","cached","providerModels","m","modelIds","quickFetchProviderModels","timeoutMs","quickCheckProviders","checks","available","resolve","bestModel","all"],"sources":["modelDiscovery.ts"],"sourcesContent":["/**\n * Model discovery system for auto-detecting new models from providers.\n *\n * This module queries provider APIs to discover available models and caches\n * them for use alongside the static model schema. It never modifies the\n * static schema - discoveries are stored separately and merged at runtime.\n */\n\nimport { readFileSync, writeFileSync, existsSync } from 'node:fs';\nimport { mkdir } from 'node:fs/promises';\nimport { join } from 'node:path';\nimport { homedir } from 'node:os';\nimport type { ProviderId } from './types.js';\nimport type { ModelConfig } from './agentSchemaLoader.js';\nimport { safeErrorMessage } from './secretStore.js';\nimport { logDebug } from '../utils/debugLogger.js';\n\n/**\n * Discovered model cache file location\n */\nconst CACHE_DIR = join(homedir(), '.agi');\nconst CACHE_FILE = join(CACHE_DIR, 'discovered-models.json');\n\n/**\n * Cache expiration time (24 hours)\n */\nconst CACHE_EXPIRATION_MS = 24 * 60 * 60 * 1000;\n\n/**\n * Discovered models cache structure\n */\ninterface DiscoveredModelsCache {\n  version: string;\n  lastUpdated: string;\n  models: ModelConfig[];\n}\n\n/**\n * Model discovery result for a single provider\n */\nexport interface ProviderDiscoveryResult {\n  provider: ProviderId;\n  success: boolean;\n  models: ModelConfig[];\n  error?: string;\n}\n\n/**\n * Complete discovery result\n */\nexport interface DiscoveryResult {\n  success: boolean;\n  timestamp: string;\n  results: ProviderDiscoveryResult[];\n  totalModelsDiscovered: number;\n  errors: string[];\n}\n\n/**\n * Infer a provider from a model ID (best-effort).\n * Used to auto-align provider/model pairs when users override models directly.\n */\nexport function inferProviderFromModelId(model: string | null | undefined): ProviderId | null {\n  if (!model) return null;\n\n  const normalized = model.trim().toLowerCase();\n  const patterns: Array<[RegExp, ProviderId]> = [\n    [/^(gpt|o1|o3|codex)/, 'openai'],\n    [/^(claude|opus|sonnet|haiku)/, 'anthropic'],\n    [/^gemini/, 'google'],\n    [/^deepseek/, 'deepseek'],\n    [/^grok/, 'xai'],\n    [/^(llama|mistral|qwen|phi)/, 'ollama'],\n    [/:/, 'ollama'], // Ollama models often include colons (e.g., llama3.2:3b)\n  ];\n\n  for (const [pattern, provider] of patterns) {\n    if (pattern.test(normalized)) {\n      return provider;\n    }\n  }\n\n  return null;\n}\n\n/**\n * Get cached discovered models\n */\nexport function getCachedDiscoveredModels(): ModelConfig[] {\n  try {\n    if (!existsSync(CACHE_FILE)) {\n      return [];\n    }\n\n    const raw = readFileSync(CACHE_FILE, 'utf-8');\n    const cache: DiscoveredModelsCache = JSON.parse(raw);\n\n    // Check if cache is expired\n    const lastUpdated = new Date(cache.lastUpdated).getTime();\n    const now = Date.now();\n    if (now - lastUpdated > CACHE_EXPIRATION_MS) {\n      return [];\n    }\n\n    return cache.models;\n  } catch (error) {\n    logDebug('Failed to read discovered models cache:', safeErrorMessage(error));\n    return [];\n  }\n}\n\n/**\n * Save discovered models to cache\n */\nasync function saveDiscoveredModels(models: ModelConfig[]): Promise<void> {\n  try {\n    await mkdir(CACHE_DIR, { recursive: true });\n\n    const cache: DiscoveredModelsCache = {\n      version: '1.0.0',\n      lastUpdated: new Date().toISOString(),\n      models,\n    };\n\n    writeFileSync(CACHE_FILE, JSON.stringify(cache, null, 2), 'utf-8');\n  } catch (error) {\n    logDebug('Failed to save discovered models cache:', safeErrorMessage(error));\n  }\n}\n\n/**\n * Discover models from OpenAI\n */\nasync function discoverOpenAIModels(apiKey: string): Promise<ProviderDiscoveryResult> {\n  const provider: ProviderId = 'openai';\n\n  try {\n    const response = await fetch('https://api.openai.com/v1/models', {\n      headers: {\n        'Authorization': `Bearer ${apiKey}`,\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`API returned ${response.status}: ${response.statusText}`);\n    }\n\n    const data = await response.json() as { data: Array<{ id: string; owned_by: string }> };\n\n    // Filter for GPT models only and create ModelConfig objects\n    const models: ModelConfig[] = data.data\n      .filter(model => {\n        // Allow both dash and non-dash variants for newer reasoning SKUs (o1/o3)\n        return (\n          model.id.startsWith('gpt-') ||\n          model.id.startsWith('o1') ||\n          model.id.startsWith('o3') ||\n          model.id.startsWith('codex-')\n        );\n      })\n      .map(model => ({\n        id: model.id,\n        label: model.id,\n        provider,\n        description: `OpenAI ${model.id} (auto-discovered)`,\n        capabilities: ['chat', 'tools', 'streaming'],\n      }));\n\n    return {\n      provider,\n      success: true,\n      models,\n    };\n  } catch (error) {\n    return {\n      provider,\n      success: false,\n      models: [],\n      error: error instanceof Error ? error.message : String(error),\n    };\n  }\n}\n\n/**\n * Discover models from Anthropic\n */\nasync function discoverAnthropicModels(apiKey: string): Promise<ProviderDiscoveryResult> {\n  const provider: ProviderId = 'anthropic';\n\n  try {\n    const response = await fetch('https://api.anthropic.com/v1/models', {\n      headers: {\n        'x-api-key': apiKey,\n        'anthropic-version': '2023-06-01',\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`API returned ${response.status}: ${response.statusText}`);\n    }\n\n    const data = await response.json() as {\n      data: Array<{\n        id: string;\n        display_name: string;\n        type: string;\n      }>\n    };\n\n    const models: ModelConfig[] = data.data\n      .filter(model => model.type === 'model')\n      .map(model => ({\n        id: model.id,\n        label: model.display_name || model.id,\n        provider,\n        description: `Anthropic ${model.display_name || model.id} (auto-discovered)`,\n        capabilities: ['chat', 'reasoning', 'tools', 'streaming'],\n      }));\n\n    return {\n      provider,\n      success: true,\n      models,\n    };\n  } catch (error) {\n    return {\n      provider,\n      success: false,\n      models: [],\n      error: error instanceof Error ? error.message : String(error),\n    };\n  }\n}\n\n/**\n * Discover models from Google Gemini\n * Note: Google's models API often requires special permissions.\n * Falls back to known models if API access fails.\n */\nasync function discoverGoogleModels(apiKey: string): Promise<ProviderDiscoveryResult> {\n  const provider: ProviderId = 'google';\n\n  // Known Google Gemini models (fallback if API doesn't work) - Updated Dec 2025\n  const knownModels: ModelConfig[] = [\n    { id: 'gemini-3.0-pro', label: 'Gemini 3.0 Pro', provider, description: 'Latest Gemini with best reasoning and coding', capabilities: ['chat', 'reasoning', 'tools', 'streaming', 'multimodal'] },\n    { id: 'gemini-3.0-flash', label: 'Gemini 3.0 Flash', provider, description: 'Fast Gemini 3.0 model', capabilities: ['chat', 'reasoning', 'tools', 'streaming', 'multimodal'] },\n    { id: 'gemini-2.5-pro', label: 'Gemini 2.5 Pro', provider, description: 'Capable Gemini model with advanced reasoning', capabilities: ['chat', 'reasoning', 'tools', 'streaming', 'multimodal'] },\n    { id: 'gemini-2.5-flash', label: 'Gemini 2.5 Flash', provider, description: 'Fast Gemini 2.5 with reasoning', capabilities: ['chat', 'reasoning', 'tools', 'streaming', 'multimodal'] },\n    { id: 'gemini-2.0-flash', label: 'Gemini 2.0 Flash', provider, description: 'Gemini 2.0 with native tool use', capabilities: ['chat', 'tools', 'streaming', 'multimodal'] },\n  ];\n\n  try {\n    // SECURITY: Use x-goog-api-key header instead of URL query parameter\n    // to prevent API key leakage in logs, error messages, and browser history\n    const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models', {\n      headers: {\n        'x-goog-api-key': apiKey,\n      },\n      signal: AbortSignal.timeout(5000),\n    });\n\n    if (!response.ok) {\n      // API access restricted - return known models with warning\n      return {\n        provider,\n        success: true, // Consider it success with fallback\n        models: knownModels,\n      };\n    }\n\n    const data = await response.json() as {\n      models: Array<{\n        name: string;\n        displayName: string;\n        supportedGenerationMethods: string[];\n      }>\n    };\n\n    const models: ModelConfig[] = data.models\n      .filter(model =>\n        model.name.includes('gemini') &&\n        model.supportedGenerationMethods?.includes('generateContent')\n      )\n      .map(model => {\n        const id = model.name.replace('models/', '');\n        return {\n          id,\n          label: id,\n          provider,\n          description: `${model.displayName} (auto-discovered)`,\n          capabilities: ['chat', 'reasoning', 'tools', 'streaming', 'multimodal'],\n        };\n      });\n\n    return {\n      provider,\n      success: true,\n      models: models.length > 0 ? models : knownModels,\n    };\n  } catch {\n    // Network error or timeout - return known models\n    return {\n      provider,\n      success: true,\n      models: knownModels,\n    };\n  }\n}\n\n/**\n * Discover models from DeepSeek (OpenAI-compatible)\n */\nasync function discoverDeepSeekModels(apiKey: string): Promise<ProviderDiscoveryResult> {\n  const provider: ProviderId = 'deepseek';\n\n  try {\n    const response = await fetch('https://api.deepseek.com/v1/models', {\n      headers: {\n        'Authorization': `Bearer ${apiKey}`,\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`API returned ${response.status}: ${response.statusText}`);\n    }\n\n    const data = await response.json() as { data: Array<{ id: string }> };\n\n    const models: ModelConfig[] = data.data.map(model => ({\n      id: model.id,\n      label: model.id,\n      provider,\n      description: `DeepSeek ${model.id} (auto-discovered)`,\n      capabilities: ['chat', 'reasoning', 'tools', 'streaming'],\n    }));\n\n    return {\n      provider,\n      success: true,\n      models,\n    };\n  } catch (error) {\n    return {\n      provider,\n      success: false,\n      models: [],\n      error: error instanceof Error ? error.message : String(error),\n    };\n  }\n}\n\n/**\n * Discover models from xAI (OpenAI-compatible)\n */\nasync function discoverXAIModels(apiKey: string): Promise<ProviderDiscoveryResult> {\n  const provider: ProviderId = 'xai';\n\n  try {\n    const response = await fetch('https://api.x.ai/v1/models', {\n      headers: {\n        'Authorization': `Bearer ${apiKey}`,\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`API returned ${response.status}: ${response.statusText}`);\n    }\n\n    const data = await response.json() as { data: Array<{ id: string }> };\n\n    const models: ModelConfig[] = data.data.map(model => ({\n      id: model.id,\n      label: model.id,\n      provider,\n      description: `xAI ${model.id} (auto-discovered)`,\n      capabilities: ['chat', 'reasoning', 'tools', 'streaming'],\n    }));\n\n    return {\n      provider,\n      success: true,\n      models,\n    };\n  } catch (error) {\n    return {\n      provider,\n      success: false,\n      models: [],\n      error: error instanceof Error ? error.message : String(error),\n    };\n  }\n}\n\n/**\n * Discover models from Ollama (local)\n */\nasync function discoverOllamaModels(): Promise<ProviderDiscoveryResult> {\n  const provider: ProviderId = 'ollama';\n  const baseURL = process.env['OLLAMA_BASE_URL'] || 'http://localhost:11434';\n\n  try {\n    const response = await fetch(`${baseURL}/api/tags`, {\n      signal: AbortSignal.timeout(2000), // 2 second timeout\n    });\n\n    if (!response.ok) {\n      throw new Error(`API returned ${response.status}: ${response.statusText}`);\n    }\n\n    const data = await response.json() as { models?: Array<{ name: string; size: number }> };\n\n    const models: ModelConfig[] = (data.models || []).map(model => ({\n      id: model.name,\n      label: model.name,\n      provider,\n      description: `Local Ollama model: ${model.name} (auto-discovered)`,\n      capabilities: ['chat', 'tools', 'streaming'],\n    }));\n\n    return {\n      provider,\n      success: true,\n      models,\n    };\n  } catch (error) {\n    return {\n      provider,\n      success: false,\n      models: [],\n      error: error instanceof Error ? error.message : String(error),\n    };\n  }\n}\n\n/**\n * Discover models from all configured providers\n *\n * PERF: Uses Promise.allSettled for parallel discovery - all providers queried\n * simultaneously. No single slow/failed provider blocks the others.\n */\nexport async function discoverAllModels(): Promise<DiscoveryResult> {\n  const errors: string[] = [];\n  let totalModelsDiscovered = 0;\n\n  // Discover from each provider if API key is available\n  const providers: Array<{\n    id: ProviderId;\n    envVar: string;\n    discover: (apiKey: string) => Promise<ProviderDiscoveryResult>;\n  }> = [\n    { id: 'openai', envVar: 'OPENAI_API_KEY', discover: discoverOpenAIModels },\n    { id: 'anthropic', envVar: 'ANTHROPIC_API_KEY', discover: discoverAnthropicModels },\n    { id: 'google', envVar: 'GEMINI_API_KEY', discover: discoverGoogleModels },\n    { id: 'deepseek', envVar: 'DEEPSEEK_API_KEY', discover: discoverDeepSeekModels },\n    { id: 'xai', envVar: 'XAI_API_KEY', discover: discoverXAIModels },\n  ];\n\n  // PERF: Build discovery promises in parallel\n  const discoveryPromises: Promise<ProviderDiscoveryResult>[] = providers.map(async (provider) => {\n    const apiKey = process.env[provider.envVar];\n\n    if (!apiKey) {\n      return {\n        provider: provider.id,\n        success: false,\n        models: [],\n        error: `API key not configured (${provider.envVar})`,\n      };\n    }\n\n    try {\n      return await provider.discover(apiKey);\n    } catch (error) {\n      const errorMessage = error instanceof Error ? error.message : String(error);\n      return {\n        provider: provider.id,\n        success: false,\n        models: [] as ModelConfig[],\n        error: errorMessage,\n      };\n    }\n  });\n\n  // Add Ollama discovery (no API key required)\n  discoveryPromises.push(\n    discoverOllamaModels().catch(() => ({\n      provider: 'ollama' as ProviderId,\n      success: false,\n      models: [] as ModelConfig[],\n      error: 'Connection failed',\n    }))\n  );\n\n  // PERF: Execute ALL provider discoveries in parallel using Promise.allSettled\n  // This ensures one slow/failed provider doesn't block others\n  const settledResults = await Promise.allSettled(discoveryPromises);\n\n  // Process results\n  const results: ProviderDiscoveryResult[] = settledResults.map((settled, index) => {\n    if (settled.status === 'fulfilled') {\n      return settled.value;\n    }\n    // Promise rejected (shouldn't happen with our error handling, but be safe)\n    const providerId = index < providers.length\n      ? providers[index]!.id\n      : 'ollama';\n    return {\n      provider: providerId,\n      success: false,\n      models: [],\n      error: settled.reason instanceof Error ? settled.reason.message : String(settled.reason),\n    };\n  });\n\n  // Collect errors and count models\n  for (const result of results) {\n    if (result.success) {\n      totalModelsDiscovered += result.models.length;\n    } else if (result.error) {\n      // Don't add Ollama connection errors (it's often not running)\n      if (result.provider === 'ollama' &&\n          (result.error.includes('ECONNREFUSED') ||\n           result.error.includes('fetch failed') ||\n           result.error.includes('Connection failed'))) {\n        continue;\n      }\n      errors.push(`${result.provider}: ${result.error}`);\n    }\n  }\n\n  // Collect all discovered models\n  const allModels = results\n    .filter(r => r.success)\n    .flatMap(r => r.models);\n\n  // Save to cache\n  if (allModels.length > 0) {\n    await saveDiscoveredModels(allModels);\n  }\n\n  return {\n    success: errors.length === 0,\n    timestamp: new Date().toISOString(),\n    results,\n    totalModelsDiscovered,\n    errors,\n  };\n}\n\n/**\n * Clear the discovered models cache\n */\nexport function clearDiscoveredModelsCache(): void {\n  try {\n    if (existsSync(CACHE_FILE)) {\n      writeFileSync(CACHE_FILE, JSON.stringify({ version: '1.0.0', lastUpdated: new Date().toISOString(), models: [] }, null, 2), 'utf-8');\n    }\n  } catch (error) {\n    logDebug('Failed to clear discovered models cache:', safeErrorMessage(error));\n  }\n}\n\n// ============================================================================\n// Provider Status Detection\n// ============================================================================\n\n/**\n * Provider configuration info\n */\nexport interface ProviderInfo {\n  id: ProviderId;\n  name: string;\n  envVar: string;\n  configured: boolean;\n  latestModel: string;\n  models?: string[];\n}\n\n/**\n * Supported providers with their environment variable requirements\n */\nconst PROVIDER_CONFIGS: Array<{\n  id: ProviderId;\n  name: string;\n  envVar: string;\n  altEnvVars?: string[];\n  defaultLatestModel: string;\n}> = [\n  { id: 'anthropic', name: 'Anthropic', envVar: 'ANTHROPIC_API_KEY', defaultLatestModel: 'claude-3-5-sonnet-20241022' },\n  { id: 'openai', name: 'OpenAI', envVar: 'OPENAI_API_KEY', defaultLatestModel: 'gpt-4o' },\n  { id: 'google', name: 'Google', envVar: 'GEMINI_API_KEY', altEnvVars: ['GOOGLE_API_KEY'], defaultLatestModel: 'gemini-2.5-flash' },\n  { id: 'deepseek', name: 'DeepSeek', envVar: 'DEEPSEEK_API_KEY', defaultLatestModel: 'deepseek-reasoner' },\n  { id: 'xai', name: 'xAI', envVar: 'XAI_API_KEY', defaultLatestModel: 'grok-4-1-fast-reasoning' },\n { id: 'ollama', name: 'Ollama', envVar: 'OLLAMA_BASE_URL', defaultLatestModel: 'llama3.2:3b' },\n];\n\n/**\n * Model priority rankings for selecting the \"best\" model\n */\nconst MODEL_PRIORITIES: Record<string, Record<string, number>> = {\n  openai: {\n    'o3-pro': 120,\n    'o3-mini': 114,\n    'o3': 112,\n    'o1-pro': 110,\n    'o1': 108,\n    'o1-mini': 104,\n    'gpt-5.1-codex-max': 105,\n    'codex-max': 105,\n    'gpt-5.1-codex': 100,\n    'gpt-5.1-codex-mini': 98,\n    'gpt-5.1': 96,\n    'gpt-5-pro': 94,\n    'gpt-5-mini': 92,\n    'gpt-5-nano': 90,\n    'gpt-4.1': 99,\n    'gpt-4o': 97,\n    'gpt-4o-mini': 94,\n  },\n  anthropic: {\n    'claude-opus-4-5': 105,\n    'claude-opus-4-5-20251101': 105,\n    'claude-sonnet-4-5': 100,\n    'claude-sonnet-4-5-20250929': 100,\n    'claude-opus-4-20250514': 96,\n    'claude-opus-4': 96,\n    'claude-sonnet-4': 94,\n    'claude-3-5-sonnet-20241022': 96,\n    'claude-3-5-haiku-20241022': 92,\n    'claude-3-opus-20240229': 90,\n    'claude-3-sonnet-20240229': 86,\n    'claude-3-haiku-20240307': 82,\n  },\n  google: {\n    'gemini-3.0-pro': 105,\n    'gemini-3.0-flash': 100,\n    'gemini-2.5-pro': 98,\n    'gemini-2.5-flash': 96,\n    'gemini-2.0-flash': 90,\n    'gemini-2.0': 88,\n    'gemini-1.5-pro': 85,\n    'gemini-1.5-flash': 82,\n  },\n  deepseek: {\n    'deepseek-reasoner': 100,\n    'deepseek-chat': 90,\n    'deepseek-coder': 85,\n  },\n  xai: {\n    'grok-4-1-fast-reasoning': 100,\n    'grok-4-1-fast-non-reasoning': 95,\n    'grok-4-fast-reasoning': 93,\n    'grok-4-fast-non-reasoning': 90,\n    'grok-4': 88,\n    'grok-code-fast-1': 86,\n    'grok-3': 82,\n    'grok-3-mini': 78,\n    'grok-2-vision-1212': 75,\n    'grok-2-1212': 72,\n    'grok-beta': 60,\n  },\n  ollama: {\n    'llama3.1:8b': 90,\n    'llama3.2:3b': 88,\n    'qwen2.5:14b': 86,\n    'qwen2.5:7b': 84,\n    'mistral:7b': 80,\n    'deepseek-coder:6.7b': 78,\n    'codellama:7b': 70,\n  },\n};\n\n/**\n * Get model priority for sorting\n */\nfunction getModelPriority(provider: ProviderId, modelId: string): number {\n  const priorities = MODEL_PRIORITIES[provider];\n  if (!priorities) return 0;\n\n  // Check for exact match first\n  if (priorities[modelId] !== undefined) {\n    return priorities[modelId];\n  }\n\n  // Check for prefix match\n  for (const [prefix, priority] of Object.entries(priorities)) {\n    if (modelId.startsWith(prefix)) {\n      return priority;\n    }\n  }\n\n  return 0;\n}\n\n/**\n * Sort models by priority (best first)\n */\nexport function sortModelsByPriority(provider: ProviderId, models: string[]): string[] {\n  return [...models].sort((a, b) => {\n    const priorityA = getModelPriority(provider, a);\n    const priorityB = getModelPriority(provider, b);\n    return priorityB - priorityA;\n  });\n}\n\n/**\n * Get the best/latest model for a provider\n */\nexport function getBestModel(provider: ProviderId, models: string[]): string {\n  if (models.length === 0) {\n    const config = PROVIDER_CONFIGS.find(p => p.id === provider);\n    return config?.defaultLatestModel || '';\n  }\n\n  const sorted = sortModelsByPriority(provider, models);\n  return sorted[0] ?? models[0] ?? '';\n}\n\n/**\n * Check if a provider is configured (has API key or is accessible)\n */\nexport function isProviderConfigured(providerId: ProviderId): boolean {\n  const config = PROVIDER_CONFIGS.find(p => p.id === providerId);\n  if (!config) return false;\n\n  // Ollama is special - it's available if the server is running (no API key needed)\n  if (providerId === 'ollama') {\n    // We'll check this via actual connection, return true for now\n    // The actual check happens in getConfiguredProviders\n    return true;\n  }\n\n  // Check main env var\n  if (process.env[config.envVar]) {\n    return true;\n  }\n\n  // Check alternative env vars\n  if (config.altEnvVars) {\n    for (const altVar of config.altEnvVars) {\n      if (process.env[altVar]) {\n        return true;\n      }\n    }\n  }\n\n  return false;\n}\n\n/**\n * Get all providers with their configuration status\n */\nexport function getProvidersStatus(): ProviderInfo[] {\n  return PROVIDER_CONFIGS.map(config => {\n    let configured = false;\n\n    if (config.id === 'ollama') {\n      // For Ollama, we can't check synchronously if it's running\n      // Mark as potentially available\n      configured = !!process.env['OLLAMA_BASE_URL'] || true; // Always show Ollama as option\n    } else {\n      configured = !!process.env[config.envVar];\n      if (!configured && config.altEnvVars) {\n        configured = config.altEnvVars.some(v => !!process.env[v]);\n      }\n    }\n\n    return {\n      id: config.id,\n      name: config.name,\n      envVar: config.envVar,\n      configured,\n      latestModel: config.defaultLatestModel,\n    };\n  });\n}\n\n/**\n * Get list of configured providers (with valid API keys)\n */\nexport function getConfiguredProviders(): ProviderInfo[] {\n  return getProvidersStatus().filter(p => p.configured);\n}\n\n/**\n * Get list of unconfigured providers\n */\nexport function getUnconfiguredProviders(): ProviderInfo[] {\n  return getProvidersStatus().filter(p => !p.configured);\n}\n\n/**\n * Get the first available provider (for auto-selection)\n */\nexport function getFirstAvailableProvider(): ProviderInfo | null {\n  const configured = getConfiguredProviders();\n\n  // Prefer in this order: anthropic, openai, google, deepseek, xai, ollama\n  const preferenceOrder = ['anthropic', 'openai', 'google', 'deepseek', 'xai', 'ollama'];\n\n  for (const providerId of preferenceOrder) {\n    const provider = configured.find(p => p.id === providerId);\n    if (provider && provider.id !== 'ollama') {\n      return provider;\n    }\n  }\n\n  // Fall back to Ollama if nothing else is configured\n  return configured.find(p => p.id === 'ollama') || null;\n}\n\n/**\n * Get latest model for a provider from cache or defaults\n */\nexport function getLatestModelForProvider(providerId: ProviderId): string {\n  // Check cache first\n  const cached = getCachedDiscoveredModels();\n  const providerModels = cached.filter(m => m.provider === providerId);\n\n  if (providerModels.length > 0) {\n    const modelIds = providerModels.map(m => m.id);\n    return getBestModel(providerId, modelIds);\n  }\n\n  // Fall back to default\n  const config = PROVIDER_CONFIGS.find(p => p.id === providerId);\n  return config?.defaultLatestModel || '';\n}\n\n/**\n * Quick provider availability check result\n */\nexport interface QuickProviderStatus {\n  provider: ProviderId;\n  available: boolean;\n  latestModel: string;\n  error?: string;\n}\n\n/**\n * Quick API check for a single provider - returns best model or null\n */\nasync function quickFetchProviderModels(\n  providerId: ProviderId,\n  apiKey: string,\n  timeoutMs: number = 3000\n): Promise<string[]> {\n  try {\n    switch (providerId) {\n      case 'openai': {\n        const response = await fetch('https://api.openai.com/v1/models', {\n          headers: { 'Authorization': `Bearer ${apiKey}` },\n          signal: AbortSignal.timeout(timeoutMs),\n        });\n        if (!response.ok) return [];\n        const data = await response.json() as { data: Array<{ id: string }> };\n        return data.data\n          .filter(m =>\n            m.id.startsWith('gpt-') ||\n            m.id.startsWith('o1') ||\n            m.id.startsWith('o3') ||\n            m.id.startsWith('codex-')\n          )\n          .map(m => m.id);\n      }\n\n      case 'anthropic': {\n        const response = await fetch('https://api.anthropic.com/v1/models', {\n          headers: {\n            'x-api-key': apiKey,\n            'anthropic-version': '2023-06-01',\n          },\n          signal: AbortSignal.timeout(timeoutMs),\n        });\n        if (!response.ok) return [];\n        const data = await response.json() as { data: Array<{ id: string; type: string }> };\n        return data.data.filter(m => m.type === 'model').map(m => m.id);\n      }\n\n      case 'google': {\n        // SECURITY: Use x-goog-api-key header instead of URL query parameter\n        const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models', {\n          headers: {\n            'x-goog-api-key': apiKey,\n          },\n          signal: AbortSignal.timeout(timeoutMs),\n        });\n        if (!response.ok) return [];\n        const data = await response.json() as {\n          models: Array<{ name: string; supportedGenerationMethods?: string[] }>\n        };\n        return data.models\n          .filter(m => m.name.includes('gemini') && m.supportedGenerationMethods?.includes('generateContent'))\n          .map(m => m.name.replace('models/', ''));\n      }\n\n      case 'deepseek': {\n        const response = await fetch('https://api.deepseek.com/v1/models', {\n          headers: { 'Authorization': `Bearer ${apiKey}` },\n          signal: AbortSignal.timeout(timeoutMs),\n        });\n        if (!response.ok) return [];\n        const data = await response.json() as { data: Array<{ id: string }> };\n        return data.data.map(m => m.id);\n      }\n\n      case 'xai': {\n        const response = await fetch('https://api.x.ai/v1/models', {\n          headers: { 'Authorization': `Bearer ${apiKey}` },\n          signal: AbortSignal.timeout(timeoutMs),\n        });\n        if (!response.ok) return [];\n        const data = await response.json() as { data: Array<{ id: string }> };\n        return data.data.map(m => m.id);\n      }\n\n      default:\n        return [];\n    }\n  } catch {\n    return [];\n  }\n}\n\n/**\n * Quickly check if providers are available by querying their APIs\n * Returns actual latest models from each provider\n */\nexport async function quickCheckProviders(): Promise<QuickProviderStatus[]> {\n  const checks: Promise<QuickProviderStatus>[] = [];\n\n  for (const config of PROVIDER_CONFIGS) {\n    // Handle Ollama separately (no API key needed)\n    if (config.id === 'ollama') {\n      checks.push((async (): Promise<QuickProviderStatus> => {\n        try {\n          const baseURL = process.env['OLLAMA_BASE_URL'] || 'http://localhost:11434';\n          const response = await fetch(`${baseURL}/api/tags`, {\n            signal: AbortSignal.timeout(1500),\n          });\n          if (response.ok) {\n            const data = await response.json() as { models?: Array<{ name: string }> };\n            const models = data.models?.map(m => m.name) || [];\n            return {\n              provider: 'ollama',\n              available: models.length > 0,\n              latestModel: models[0] || config.defaultLatestModel,\n            };\n          }\n        } catch { /* ignore */ }\n        return {\n          provider: 'ollama',\n          available: false,\n          latestModel: config.defaultLatestModel,\n          error: 'Not running',\n        };\n      })());\n      continue;\n    }\n\n    // Check for API key\n    let apiKey = process.env[config.envVar];\n    if (!apiKey && config.altEnvVars) {\n      for (const altVar of config.altEnvVars) {\n        if (process.env[altVar]) {\n          apiKey = process.env[altVar];\n          break;\n        }\n      }\n    }\n\n    if (!apiKey) {\n      checks.push(Promise.resolve({\n        provider: config.id,\n        available: false,\n        latestModel: config.defaultLatestModel,\n        error: `${config.envVar} not set`,\n      }));\n      continue;\n    }\n\n    // Query the API for actual models\n    checks.push((async (): Promise<QuickProviderStatus> => {\n      const models = await quickFetchProviderModels(config.id, apiKey, 3000);\n      if (models.length > 0) {\n        const bestModel = getBestModel(config.id, models);\n        return {\n          provider: config.id,\n          available: true,\n          latestModel: bestModel,\n        };\n      }\n      // API call failed or returned no models - still mark available if key exists\n      return {\n        provider: config.id,\n        available: true,\n        latestModel: config.defaultLatestModel,\n        error: 'Could not fetch models',\n      };\n    })());\n  }\n\n  // Run all checks in parallel for speed\n  return Promise.all(checks);\n}\n"],"mappings":"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","ignoreList":[]}