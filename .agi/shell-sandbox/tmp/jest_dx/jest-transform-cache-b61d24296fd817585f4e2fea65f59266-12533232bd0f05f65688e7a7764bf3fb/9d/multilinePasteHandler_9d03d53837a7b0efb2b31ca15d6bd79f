b93e155be9ee8caeee69b38eda084716
/* istanbul ignore next */
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.formatPasteSummaryForDisplay = formatPasteSummaryForDisplay;
exports.generatePasteSummary = generatePasteSummary;
exports.isMultilinePaste = isMultilinePaste;
exports.processPaste = processPaste;
function cov_1qd9l68u45() {
  var path = "/Users/bo/GitHub/agi-core-CLI-coding/src/core/multilinePasteHandler.ts";
  var hash = "e81126ebde8f82e41bf8953a8dbb5b6d1c12f2c1";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/bo/GitHub/agi-core-CLI-coding/src/core/multilinePasteHandler.ts",
    statementMap: {
      "0": {
        start: {
          line: 19,
          column: 16
        },
        end: {
          line: 19,
          column: 71
        }
      },
      "1": {
        start: {
          line: 19,
          column: 48
        },
        end: {
          line: 19,
          column: 70
        }
      },
      "2": {
        start: {
          line: 20,
          column: 2
        },
        end: {
          line: 20,
          column: 27
        }
      },
      "3": {
        start: {
          line: 27,
          column: 43
        },
        end: {
          line: 37,
          column: 3
        }
      },
      "4": {
        start: {
          line: 39,
          column: 2
        },
        end: {
          line: 43,
          column: 3
        }
      },
      "5": {
        start: {
          line: 40,
          column: 4
        },
        end: {
          line: 42,
          column: 5
        }
      },
      "6": {
        start: {
          line: 41,
          column: 6
        },
        end: {
          line: 41,
          column: 18
        }
      },
      "7": {
        start: {
          line: 45,
          column: 2
        },
        end: {
          line: 45,
          column: 19
        }
      },
      "8": {
        start: {
          line: 52,
          column: 16
        },
        end: {
          line: 52,
          column: 32
        }
      },
      "9": {
        start: {
          line: 53,
          column: 24
        },
        end: {
          line: 53,
          column: 68
        }
      },
      "10": {
        start: {
          line: 53,
          column: 45
        },
        end: {
          line: 53,
          column: 67
        }
      },
      "11": {
        start: {
          line: 54,
          column: 20
        },
        end: {
          line: 54,
          column: 31
        }
      },
      "12": {
        start: {
          line: 55,
          column: 20
        },
        end: {
          line: 55,
          column: 40
        }
      },
      "13": {
        start: {
          line: 56,
          column: 19
        },
        end: {
          line: 56,
          column: 39
        }
      },
      "14": {
        start: {
          line: 59,
          column: 16
        },
        end: {
          line: 59,
          column: 56
        }
      },
      "15": {
        start: {
          line: 60,
          column: 2
        },
        end: {
          line: 62,
          column: 3
        }
      },
      "16": {
        start: {
          line: 61,
          column: 4
        },
        end: {
          line: 61,
          column: 21
        }
      },
      "17": {
        start: {
          line: 65,
          column: 33
        },
        end: {
          line: 65,
          column: 35
        }
      },
      "18": {
        start: {
          line: 67,
          column: 2
        },
        end: {
          line: 69,
          column: 3
        }
      },
      "19": {
        start: {
          line: 68,
          column: 4
        },
        end: {
          line: 68,
          column: 51
        }
      },
      "20": {
        start: {
          line: 71,
          column: 2
        },
        end: {
          line: 71,
          column: 70
        }
      },
      "21": {
        start: {
          line: 72,
          column: 2
        },
        end: {
          line: 72,
          column: 70
        }
      },
      "22": {
        start: {
          line: 74,
          column: 18
        },
        end: {
          line: 74,
          column: 58
        }
      },
      "23": {
        start: {
          line: 76,
          column: 2
        },
        end: {
          line: 83,
          column: 4
        }
      },
      "24": {
        start: {
          line: 90,
          column: 2
        },
        end: {
          line: 90,
          column: 52
        }
      },
      "25": {
        start: {
          line: 104,
          column: 18
        },
        end: {
          line: 104,
          column: 44
        }
      },
      "26": {
        start: {
          line: 105,
          column: 25
        },
        end: {
          line: 105,
          column: 62
        }
      },
      "27": {
        start: {
          line: 107,
          column: 2
        },
        end: {
          line: 111,
          column: 4
        }
      }
    },
    fnMap: {
      "0": {
        name: "isMultilinePaste",
        decl: {
          start: {
            line: 18,
            column: 16
          },
          end: {
            line: 18,
            column: 32
          }
        },
        loc: {
          start: {
            line: 18,
            column: 56
          },
          end: {
            line: 21,
            column: 1
          }
        },
        line: 18
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 19,
            column: 40
          },
          end: {
            line: 19,
            column: 41
          }
        },
        loc: {
          start: {
            line: 19,
            column: 48
          },
          end: {
            line: 19,
            column: 70
          }
        },
        line: 19
      },
      "2": {
        name: "detectLanguage",
        decl: {
          start: {
            line: 26,
            column: 9
          },
          end: {
            line: 26,
            column: 23
          }
        },
        loc: {
          start: {
            line: 26,
            column: 58
          },
          end: {
            line: 46,
            column: 1
          }
        },
        line: 26
      },
      "3": {
        name: "generatePasteSummary",
        decl: {
          start: {
            line: 51,
            column: 16
          },
          end: {
            line: 51,
            column: 36
          }
        },
        loc: {
          start: {
            line: 51,
            column: 65
          },
          end: {
            line: 84,
            column: 1
          }
        },
        line: 51
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 53,
            column: 37
          },
          end: {
            line: 53,
            column: 38
          }
        },
        loc: {
          start: {
            line: 53,
            column: 45
          },
          end: {
            line: 53,
            column: 67
          }
        },
        line: 53
      },
      "5": {
        name: "formatPasteSummaryForDisplay",
        decl: {
          start: {
            line: 89,
            column: 16
          },
          end: {
            line: 89,
            column: 44
          }
        },
        loc: {
          start: {
            line: 89,
            column: 76
          },
          end: {
            line: 91,
            column: 1
          }
        },
        line: 89
      },
      "6": {
        name: "processPaste",
        decl: {
          start: {
            line: 103,
            column: 16
          },
          end: {
            line: 103,
            column: 28
          }
        },
        loc: {
          start: {
            line: 103,
            column: 59
          },
          end: {
            line: 112,
            column: 1
          }
        },
        line: 103
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 40,
            column: 4
          },
          end: {
            line: 42,
            column: 5
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 40,
            column: 4
          },
          end: {
            line: 42,
            column: 5
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 40
      },
      "1": {
        loc: {
          start: {
            line: 59,
            column: 16
          },
          end: {
            line: 59,
            column: 56
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 59,
            column: 16
          },
          end: {
            line: 59,
            column: 50
          }
        }, {
          start: {
            line: 59,
            column: 54
          },
          end: {
            line: 59,
            column: 56
          }
        }],
        line: 59
      },
      "2": {
        loc: {
          start: {
            line: 60,
            column: 2
          },
          end: {
            line: 62,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 60,
            column: 2
          },
          end: {
            line: 62,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 60
      },
      "3": {
        loc: {
          start: {
            line: 67,
            column: 2
          },
          end: {
            line: 69,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 67,
            column: 2
          },
          end: {
            line: 69,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 67
      },
      "4": {
        loc: {
          start: {
            line: 71,
            column: 40
          },
          end: {
            line: 71,
            column: 66
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 71,
            column: 58
          },
          end: {
            line: 71,
            column: 61
          }
        }, {
          start: {
            line: 71,
            column: 64
          },
          end: {
            line: 71,
            column: 66
          }
        }],
        line: 71
      },
      "5": {
        loc: {
          start: {
            line: 72,
            column: 40
          },
          end: {
            line: 72,
            column: 66
          }
        },
        type: "cond-expr",
        locations: [{
          start: {
            line: 72,
            column: 58
          },
          end: {
            line: 72,
            column: 61
          }
        }, {
          start: {
            line: 72,
            column: 64
          },
          end: {
            line: 72,
            column: 66
          }
        }],
        line: 72
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0,
      "26": 0,
      "27": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0],
      "4": [0, 0],
      "5": [0, 0]
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "e81126ebde8f82e41bf8953a8dbb5b6d1c12f2c1"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_1qd9l68u45 = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_1qd9l68u45();
/**
 * Handles multi-line paste detection and summarization
 * Provides graceful handling of large text blocks pasted into chat
 */

/**
 * Detect if text is a multi-line paste (3+ lines)
 */
function isMultilinePaste(text) {
  /* istanbul ignore next */
  cov_1qd9l68u45().f[0]++;
  const lines =
  /* istanbul ignore next */
  (cov_1qd9l68u45().s[0]++, text.split('\n').filter(line => {
    /* istanbul ignore next */
    cov_1qd9l68u45().f[1]++;
    cov_1qd9l68u45().s[1]++;
    return line.trim().length > 0;
  }));
  /* istanbul ignore next */
  cov_1qd9l68u45().s[2]++;
  return lines.length >= 3;
}

/**
 * Detect likely programming language from content
 */
function detectLanguage(text) {
  /* istanbul ignore next */
  cov_1qd9l68u45().f[2]++;
  const patterns =
  /* istanbul ignore next */
  (cov_1qd9l68u45().s[3]++, {
    javascript: /\b(const|let|var|function|async|await|import|export|=>)\b/,
    typescript: /\b(interface|type|enum|namespace|declare|as const)\b/,
    python: /\b(def|class|import|from|if __name__|async def)\b/,
    json: /^\s*(?:\{|\[).*(?:\}|\])\s*$/,
    html: /^<[a-z]/i,
    css: /^\s*[.#[]?[\w-]+\s*{/,
    sql: /\b(SELECT|FROM|WHERE|INSERT|UPDATE|DELETE|CREATE|TABLE)\b/i,
    bash: /^#!/,
    yaml: /^[\w-]+:\s*\S/m
  });
  /* istanbul ignore next */
  cov_1qd9l68u45().s[4]++;
  for (const [lang, pattern] of Object.entries(patterns)) {
    /* istanbul ignore next */
    cov_1qd9l68u45().s[5]++;
    if (pattern.test(text)) {
      /* istanbul ignore next */
      cov_1qd9l68u45().b[0][0]++;
      cov_1qd9l68u45().s[6]++;
      return lang;
    } else
    /* istanbul ignore next */
    {
      cov_1qd9l68u45().b[0][1]++;
    }
  }
  /* istanbul ignore next */
  cov_1qd9l68u45().s[7]++;
  return undefined;
}

/**
 * Generate a concise summary of pasted content
 */
function generatePasteSummary(text) {
  /* istanbul ignore next */
  cov_1qd9l68u45().f[3]++;
  const lines =
  /* istanbul ignore next */
  (cov_1qd9l68u45().s[8]++, text.split('\n'));
  const nonEmptyLines =
  /* istanbul ignore next */
  (cov_1qd9l68u45().s[9]++, lines.filter(line => {
    /* istanbul ignore next */
    cov_1qd9l68u45().f[4]++;
    cov_1qd9l68u45().s[10]++;
    return line.trim().length > 0;
  }));
  const charCount =
  /* istanbul ignore next */
  (cov_1qd9l68u45().s[11]++, text.length);
  const lineCount =
  /* istanbul ignore next */
  (cov_1qd9l68u45().s[12]++, nonEmptyLines.length);
  const language =
  /* istanbul ignore next */
  (cov_1qd9l68u45().s[13]++, detectLanguage(text));

  // Create preview: first 60 chars or first line
  let preview =
  /* istanbul ignore next */
  (cov_1qd9l68u45().s[14]++,
  /* istanbul ignore next */
  (cov_1qd9l68u45().b[1][0]++, nonEmptyLines[0]?.substring(0, 60)) ||
  /* istanbul ignore next */
  (cov_1qd9l68u45().b[1][1]++, ''));
  /* istanbul ignore next */
  cov_1qd9l68u45().s[15]++;
  if (preview.length === 60) {
    /* istanbul ignore next */
    cov_1qd9l68u45().b[2][0]++;
    cov_1qd9l68u45().s[16]++;
    preview += '...';
  } else
  /* istanbul ignore next */
  {
    cov_1qd9l68u45().b[2][1]++;
  }

  // Generate summary description
  const summaryParts =
  /* istanbul ignore next */
  (cov_1qd9l68u45().s[17]++, []);
  /* istanbul ignore next */
  cov_1qd9l68u45().s[18]++;
  if (language) {
    /* istanbul ignore next */
    cov_1qd9l68u45().b[3][0]++;
    cov_1qd9l68u45().s[19]++;
    summaryParts.push(`${language.toUpperCase()}`);
  } else
  /* istanbul ignore next */
  {
    cov_1qd9l68u45().b[3][1]++;
  }
  cov_1qd9l68u45().s[20]++;
  summaryParts.push(`${lineCount} line${lineCount !== 1 ?
  /* istanbul ignore next */
  (cov_1qd9l68u45().b[4][0]++, 's') :
  /* istanbul ignore next */
  (cov_1qd9l68u45().b[4][1]++, '')}`);
  /* istanbul ignore next */
  cov_1qd9l68u45().s[21]++;
  summaryParts.push(`${charCount} char${charCount !== 1 ?
  /* istanbul ignore next */
  (cov_1qd9l68u45().b[5][0]++, 's') :
  /* istanbul ignore next */
  (cov_1qd9l68u45().b[5][1]++, '')}`);
  const summary =
  /* istanbul ignore next */
  (cov_1qd9l68u45().s[22]++, `ðŸ“‹ Pasted: ${summaryParts.join(' â€¢ ')}`);
  /* istanbul ignore next */
  cov_1qd9l68u45().s[23]++;
  return {
    isMultiline: true,
    lineCount,
    charCount,
    preview,
    language,
    summary
  };
}

/**
 * Format a paste summary for display
 */
function formatPasteSummaryForDisplay(summary) {
  /* istanbul ignore next */
  cov_1qd9l68u45().f[5]++;
  cov_1qd9l68u45().s[24]++;
  return `${summary.summary}\n"${summary.preview}"`;
}

/**
 * Create a display-friendly version of multi-line content
 * Returns both the summary for display and the full content for sending
 */

function processPaste(text) {
  /* istanbul ignore next */
  cov_1qd9l68u45().f[6]++;
  const summary =
  /* istanbul ignore next */
  (cov_1qd9l68u45().s[25]++, generatePasteSummary(text));
  const displaySummary =
  /* istanbul ignore next */
  (cov_1qd9l68u45().s[26]++, formatPasteSummaryForDisplay(summary));
  /* istanbul ignore next */
  cov_1qd9l68u45().s[27]++;
  return {
    displaySummary,
    fullContent: text,
    metadata: summary
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMXFkOWw2OHU0NSIsImFjdHVhbENvdmVyYWdlIiwiaXNNdWx0aWxpbmVQYXN0ZSIsInRleHQiLCJmIiwibGluZXMiLCJzIiwic3BsaXQiLCJmaWx0ZXIiLCJsaW5lIiwidHJpbSIsImxlbmd0aCIsImRldGVjdExhbmd1YWdlIiwicGF0dGVybnMiLCJqYXZhc2NyaXB0IiwidHlwZXNjcmlwdCIsInB5dGhvbiIsImpzb24iLCJodG1sIiwiY3NzIiwic3FsIiwiYmFzaCIsInlhbWwiLCJsYW5nIiwicGF0dGVybiIsIk9iamVjdCIsImVudHJpZXMiLCJ0ZXN0IiwiYiIsInVuZGVmaW5lZCIsImdlbmVyYXRlUGFzdGVTdW1tYXJ5Iiwibm9uRW1wdHlMaW5lcyIsImNoYXJDb3VudCIsImxpbmVDb3VudCIsImxhbmd1YWdlIiwicHJldmlldyIsInN1YnN0cmluZyIsInN1bW1hcnlQYXJ0cyIsInB1c2giLCJ0b1VwcGVyQ2FzZSIsInN1bW1hcnkiLCJqb2luIiwiaXNNdWx0aWxpbmUiLCJmb3JtYXRQYXN0ZVN1bW1hcnlGb3JEaXNwbGF5IiwicHJvY2Vzc1Bhc3RlIiwiZGlzcGxheVN1bW1hcnkiLCJmdWxsQ29udGVudCIsIm1ldGFkYXRhIl0sInNvdXJjZXMiOlsibXVsdGlsaW5lUGFzdGVIYW5kbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSGFuZGxlcyBtdWx0aS1saW5lIHBhc3RlIGRldGVjdGlvbiBhbmQgc3VtbWFyaXphdGlvblxuICogUHJvdmlkZXMgZ3JhY2VmdWwgaGFuZGxpbmcgb2YgbGFyZ2UgdGV4dCBibG9ja3MgcGFzdGVkIGludG8gY2hhdFxuICovXG5cbmV4cG9ydCBpbnRlcmZhY2UgUGFzdGVTdW1tYXJ5IHtcbiAgaXNNdWx0aWxpbmU6IGJvb2xlYW47XG4gIGxpbmVDb3VudDogbnVtYmVyO1xuICBjaGFyQ291bnQ6IG51bWJlcjtcbiAgcHJldmlldzogc3RyaW5nO1xuICBsYW5ndWFnZT86IHN0cmluZztcbiAgc3VtbWFyeTogc3RyaW5nO1xufVxuXG4vKipcbiAqIERldGVjdCBpZiB0ZXh0IGlzIGEgbXVsdGktbGluZSBwYXN0ZSAoMysgbGluZXMpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc011bHRpbGluZVBhc3RlKHRleHQ6IHN0cmluZyk6IGJvb2xlYW4ge1xuICBjb25zdCBsaW5lcyA9IHRleHQuc3BsaXQoJ1xcbicpLmZpbHRlcihsaW5lID0+IGxpbmUudHJpbSgpLmxlbmd0aCA+IDApO1xuICByZXR1cm4gbGluZXMubGVuZ3RoID49IDM7XG59XG5cbi8qKlxuICogRGV0ZWN0IGxpa2VseSBwcm9ncmFtbWluZyBsYW5ndWFnZSBmcm9tIGNvbnRlbnRcbiAqL1xuZnVuY3Rpb24gZGV0ZWN0TGFuZ3VhZ2UodGV4dDogc3RyaW5nKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgY29uc3QgcGF0dGVybnM6IFJlY29yZDxzdHJpbmcsIFJlZ0V4cD4gPSB7XG4gICAgamF2YXNjcmlwdDogL1xcYihjb25zdHxsZXR8dmFyfGZ1bmN0aW9ufGFzeW5jfGF3YWl0fGltcG9ydHxleHBvcnR8PT4pXFxiLyxcbiAgICB0eXBlc2NyaXB0OiAvXFxiKGludGVyZmFjZXx0eXBlfGVudW18bmFtZXNwYWNlfGRlY2xhcmV8YXMgY29uc3QpXFxiLyxcbiAgICBweXRob246IC9cXGIoZGVmfGNsYXNzfGltcG9ydHxmcm9tfGlmIF9fbmFtZV9ffGFzeW5jIGRlZilcXGIvLFxuICAgIGpzb246IC9eXFxzKig/Olxce3xcXFspLiooPzpcXH18XFxdKVxccyokLyxcbiAgICBodG1sOiAvXjxbYS16XS9pLFxuICAgIGNzczogL15cXHMqWy4jW10/W1xcdy1dK1xccyp7LyxcbiAgICBzcWw6IC9cXGIoU0VMRUNUfEZST018V0hFUkV8SU5TRVJUfFVQREFURXxERUxFVEV8Q1JFQVRFfFRBQkxFKVxcYi9pLFxuICAgIGJhc2g6IC9eIyEvLFxuICAgIHlhbWw6IC9eW1xcdy1dKzpcXHMqXFxTL20sXG4gIH07XG5cbiAgZm9yIChjb25zdCBbbGFuZywgcGF0dGVybl0gb2YgT2JqZWN0LmVudHJpZXMocGF0dGVybnMpKSB7XG4gICAgaWYgKHBhdHRlcm4udGVzdCh0ZXh0KSkge1xuICAgICAgcmV0dXJuIGxhbmc7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cblxuLyoqXG4gKiBHZW5lcmF0ZSBhIGNvbmNpc2Ugc3VtbWFyeSBvZiBwYXN0ZWQgY29udGVudFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVQYXN0ZVN1bW1hcnkodGV4dDogc3RyaW5nKTogUGFzdGVTdW1tYXJ5IHtcbiAgY29uc3QgbGluZXMgPSB0ZXh0LnNwbGl0KCdcXG4nKTtcbiAgY29uc3Qgbm9uRW1wdHlMaW5lcyA9IGxpbmVzLmZpbHRlcihsaW5lID0+IGxpbmUudHJpbSgpLmxlbmd0aCA+IDApO1xuICBjb25zdCBjaGFyQ291bnQgPSB0ZXh0Lmxlbmd0aDtcbiAgY29uc3QgbGluZUNvdW50ID0gbm9uRW1wdHlMaW5lcy5sZW5ndGg7XG4gIGNvbnN0IGxhbmd1YWdlID0gZGV0ZWN0TGFuZ3VhZ2UodGV4dCk7XG5cbiAgLy8gQ3JlYXRlIHByZXZpZXc6IGZpcnN0IDYwIGNoYXJzIG9yIGZpcnN0IGxpbmVcbiAgbGV0IHByZXZpZXcgPSBub25FbXB0eUxpbmVzWzBdPy5zdWJzdHJpbmcoMCwgNjApIHx8ICcnO1xuICBpZiAocHJldmlldy5sZW5ndGggPT09IDYwKSB7XG4gICAgcHJldmlldyArPSAnLi4uJztcbiAgfVxuXG4gIC8vIEdlbmVyYXRlIHN1bW1hcnkgZGVzY3JpcHRpb25cbiAgY29uc3Qgc3VtbWFyeVBhcnRzOiBzdHJpbmdbXSA9IFtdO1xuXG4gIGlmIChsYW5ndWFnZSkge1xuICAgIHN1bW1hcnlQYXJ0cy5wdXNoKGAke2xhbmd1YWdlLnRvVXBwZXJDYXNlKCl9YCk7XG4gIH1cblxuICBzdW1tYXJ5UGFydHMucHVzaChgJHtsaW5lQ291bnR9IGxpbmUke2xpbmVDb3VudCAhPT0gMSA/ICdzJyA6ICcnfWApO1xuICBzdW1tYXJ5UGFydHMucHVzaChgJHtjaGFyQ291bnR9IGNoYXIke2NoYXJDb3VudCAhPT0gMSA/ICdzJyA6ICcnfWApO1xuXG4gIGNvbnN0IHN1bW1hcnkgPSBg8J+TiyBQYXN0ZWQ6ICR7c3VtbWFyeVBhcnRzLmpvaW4oJyDigKIgJyl9YDtcblxuICByZXR1cm4ge1xuICAgIGlzTXVsdGlsaW5lOiB0cnVlLFxuICAgIGxpbmVDb3VudCxcbiAgICBjaGFyQ291bnQsXG4gICAgcHJldmlldyxcbiAgICBsYW5ndWFnZSxcbiAgICBzdW1tYXJ5LFxuICB9O1xufVxuXG4vKipcbiAqIEZvcm1hdCBhIHBhc3RlIHN1bW1hcnkgZm9yIGRpc3BsYXlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdFBhc3RlU3VtbWFyeUZvckRpc3BsYXkoc3VtbWFyeTogUGFzdGVTdW1tYXJ5KTogc3RyaW5nIHtcbiAgcmV0dXJuIGAke3N1bW1hcnkuc3VtbWFyeX1cXG5cIiR7c3VtbWFyeS5wcmV2aWV3fVwiYDtcbn1cblxuLyoqXG4gKiBDcmVhdGUgYSBkaXNwbGF5LWZyaWVuZGx5IHZlcnNpb24gb2YgbXVsdGktbGluZSBjb250ZW50XG4gKiBSZXR1cm5zIGJvdGggdGhlIHN1bW1hcnkgZm9yIGRpc3BsYXkgYW5kIHRoZSBmdWxsIGNvbnRlbnQgZm9yIHNlbmRpbmdcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBQcm9jZXNzZWRQYXN0ZSB7XG4gIGRpc3BsYXlTdW1tYXJ5OiBzdHJpbmc7XG4gIGZ1bGxDb250ZW50OiBzdHJpbmc7XG4gIG1ldGFkYXRhOiBQYXN0ZVN1bW1hcnk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcm9jZXNzUGFzdGUodGV4dDogc3RyaW5nKTogUHJvY2Vzc2VkUGFzdGUge1xuICBjb25zdCBzdW1tYXJ5ID0gZ2VuZXJhdGVQYXN0ZVN1bW1hcnkodGV4dCk7XG4gIGNvbnN0IGRpc3BsYXlTdW1tYXJ5ID0gZm9ybWF0UGFzdGVTdW1tYXJ5Rm9yRGlzcGxheShzdW1tYXJ5KTtcblxuICByZXR1cm4ge1xuICAgIGRpc3BsYXlTdW1tYXJ5LFxuICAgIGZ1bGxDb250ZW50OiB0ZXh0LFxuICAgIG1ldGFkYXRhOiBzdW1tYXJ5LFxuICB9O1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztJQWVZO0lBQUFBLGNBQUEsWUFBQUEsQ0FBQTtNQUFBLE9BQUFDLGNBQUE7SUFBQTtFQUFBO0VBQUEsT0FBQUEsY0FBQTtBQUFBO0FBQUFELGNBQUE7QUFmWjtBQUNB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