1377800f383c4843feb16161416a8b42
"use strict";

var _globals = require("@jest/globals");
/**
 * Message Queue Integration Tests
 * Tests the critical race condition fix in streaming mode
 */

(0, _globals.describe)('Message Queue Integration', () => {
  (0, _globals.test)('Messages queue during streaming mode', () => {
    // Simulate the message queue behavior
    const pendingMessages = [];
    const isStreaming = true;

    // Simulate writeLocked behavior
    function writeLocked(content) {
      const payload = content.endsWith('\n') ? content : `${content}\n`;
      if (isStreaming) {
        pendingMessages.push({
          content: payload,
          timestamp: Date.now()
        });
      }
    }

    // Queue messages while streaming
    writeLocked('Message 1');
    writeLocked('Message 2');
    writeLocked('Message 3');
    (0, _globals.expect)(pendingMessages).toHaveLength(3);
    (0, _globals.expect)(pendingMessages[0]?.content).toBe('Message 1\n');
    (0, _globals.expect)(pendingMessages[1]?.content).toBe('Message 2\n');
    (0, _globals.expect)(pendingMessages[2]?.content).toBe('Message 3\n');
  });
  (0, _globals.test)('Messages flush in FIFO order', () => {
    const pendingMessages = [];
    const flushedMessages = [];

    // Queue messages
    pendingMessages.push({
      content: 'First\n',
      timestamp: Date.now()
    });
    pendingMessages.push({
      content: 'Second\n',
      timestamp: Date.now() + 1
    });
    pendingMessages.push({
      content: 'Third\n',
      timestamp: Date.now() + 2
    });

    // Flush in order
    while (pendingMessages.length > 0) {
      const msg = pendingMessages.shift();
      if (msg) {
        flushedMessages.push(msg.content);
      }
    }
    (0, _globals.expect)(flushedMessages).toEqual(['First\n', 'Second\n', 'Third\n']);
  });
  (0, _globals.test)('No messages lost on rapid streaming toggle', () => {
    const pendingMessages = [];
    const allMessages = [];
    let isStreaming = false;
    function writeLocked(content) {
      const payload = content.endsWith('\n') ? content : `${content}\n`;
      if (isStreaming) {
        pendingMessages.push({
          content: payload,
          timestamp: Date.now()
        });
      } else {
        // Flush pending first
        while (pendingMessages.length > 0) {
          const msg = pendingMessages.shift();
          if (msg) allMessages.push(msg.content);
        }
        allMessages.push(payload);
      }
    }

    // Rapid streaming mode changes
    for (let i = 0; i < 10; i++) {
      isStreaming = true;
      writeLocked(`Streaming ${i}`);
      isStreaming = false;
      writeLocked(`Normal ${i}`);
    }
    (0, _globals.expect)(allMessages).toHaveLength(20);
    (0, _globals.expect)(allMessages.filter(m => m.includes('Streaming'))).toHaveLength(10);
    (0, _globals.expect)(allMessages.filter(m => m.includes('Normal'))).toHaveLength(10);
  });
  (0, _globals.test)('Timestamps allow debugging of message delays', () => {
    const pendingMessages = [];
    const t1 = Date.now();
    pendingMessages.push({
      content: 'Msg 1',
      timestamp: t1
    });
    const t2 = Date.now() + 100;
    pendingMessages.push({
      content: 'Msg 2',
      timestamp: t2
    });
    const t3 = Date.now() + 200;
    pendingMessages.push({
      content: 'Msg 3',
      timestamp: t3
    });

    // Verify timestamps are increasing
    (0, _globals.expect)(pendingMessages[1].timestamp).toBeGreaterThan(pendingMessages[0].timestamp);
    (0, _globals.expect)(pendingMessages[2].timestamp).toBeGreaterThan(pendingMessages[1].timestamp);

    // Calculate delays
    const delay1 = pendingMessages[1].timestamp - pendingMessages[0].timestamp;
    const delay2 = pendingMessages[2].timestamp - pendingMessages[1].timestamp;
    (0, _globals.expect)(delay1).toBeGreaterThanOrEqual(100);
    (0, _globals.expect)(delay2).toBeGreaterThanOrEqual(100);
  });
  (0, _globals.test)('Empty messages are handled correctly', () => {
    const pendingMessages = [];
    const isStreaming = true;
    function writeLocked(content) {
      if (!content) return; // Guard against empty content

      const payload = content.endsWith('\n') ? content : `${content}\n`;
      if (isStreaming) {
        pendingMessages.push({
          content: payload,
          timestamp: Date.now()
        });
      }
    }
    writeLocked('');
    writeLocked('Valid message');
    writeLocked('');
    (0, _globals.expect)(pendingMessages).toHaveLength(1);
    (0, _globals.expect)(pendingMessages[0]?.content).toBe('Valid message\n');
  });
  (0, _globals.test)('Newline handling is consistent', () => {
    const messages = [];
    function addMessage(content) {
      const payload = content.endsWith('\n') ? content : `${content}\n`;
      messages.push(payload);
    }
    addMessage('Already has newline\n');
    addMessage('Needs newline');
    addMessage('Multiple\nlines\nhere');
    (0, _globals.expect)(messages[0]).toBe('Already has newline\n');
    (0, _globals.expect)(messages[1]).toBe('Needs newline\n');
    (0, _globals.expect)(messages[2]).toBe('Multiple\nlines\nhere\n');

    // All messages should end with exactly one newline
    messages.forEach(msg => {
      (0, _globals.expect)(msg.endsWith('\n')).toBe(true);
      (0, _globals.expect)(msg.endsWith('\n\n')).toBe(false);
    });
  });
  (0, _globals.test)('Message queue has bounded growth', () => {
    const maxMessages = /* TODO: Extract constant */1000;
    const pendingMessages = [];

    // Simulate rapid message generation
    for (let i = 0; i < maxMessages * 2; i++) {
      pendingMessages.push({
        content: `Message ${i}`,
        timestamp: Date.now()
      });

      // Simulate periodic flushing to prevent unbounded growth
      if (pendingMessages.length > maxMessages) {
        pendingMessages.shift(); // Remove oldest
      }
    }

    // Queue should not exceed max size
    (0, _globals.expect)(pendingMessages.length).toBeLessThanOrEqual(maxMessages);
  });
  (0, _globals.test)('Error during flush does not lose remaining messages', () => {
    const pendingMessages = [];
    const successfullyFlushed = [];
    const errors = [];
    pendingMessages.push({
      content: 'Message 1',
      timestamp: Date.now()
    });
    pendingMessages.push({
      content: 'BAD_MESSAGE',
      timestamp: Date.now()
    });
    pendingMessages.push({
      content: 'Message 3',
      timestamp: Date.now()
    });

    // Flush with error handling
    while (pendingMessages.length > 0) {
      const msg = pendingMessages.shift();
      if (msg) {
        try {
          if (msg.content === 'BAD_MESSAGE') {
            throw new Error('Simulated flush error');
          }
          successfullyFlushed.push(msg.content);
        } catch (error) {
          errors.push(msg.content);
          // Continue flushing despite error
        }
      }
    }
    (0, _globals.expect)(successfullyFlushed).toEqual(['Message 1', 'Message 3']);
    (0, _globals.expect)(errors).toEqual(['BAD_MESSAGE']);
    (0, _globals.expect)(pendingMessages).toHaveLength(0); // All messages processed
  });
  (0, _globals.test)('Stuck streaming state flushes pending messages on reset', () => {
    const pendingMessages = ['first\n', 'second\n'];
    const flushed = [];
    let streamingActive = true;
    let rendererMode = 'streaming';

    // Simulate the stopStreamingHeartbeat logic used by resetRendererStreamingMode
    function stopStreamingHeartbeat() {
      streamingActive = false;
      while (pendingMessages.length > 0) {
        const msg = pendingMessages.shift();
        if (msg) flushed.push(msg);
      }
    }
    function resetRendererStreamingMode(isProcessing) {
      if (isProcessing) return;
      const streamingStuck = rendererMode === 'streaming' || streamingActive;
      if (!streamingStuck) return;
      stopStreamingHeartbeat();
      rendererMode = 'idle';
    }
    resetRendererStreamingMode(false);
    (0, _globals.expect)(streamingActive).toBe(false);
    (0, _globals.expect)(rendererMode).toBe('idle');
    (0, _globals.expect)(flushed).toEqual(['first\n', 'second\n']);
    (0, _globals.expect)(pendingMessages).toHaveLength(0);
  });
});
(0, _globals.describe)('Streaming Mode State Transitions', () => {
  (0, _globals.test)('Detects double-entry to streaming mode', () => {
    const warnings = [];
    let streamingActive = false;
    function enterStreamingMode() {
      if (streamingActive) {
        warnings.push('enterStreamingMode() called while already in streaming mode');
      }
      streamingActive = true;
    }
    enterStreamingMode();
    enterStreamingMode(); // Should warn

    (0, _globals.expect)(warnings).toHaveLength(1);
    (0, _globals.expect)(warnings[0]).toContain('already in streaming mode');
  });
  (0, _globals.test)('Detects exit when not in streaming mode', () => {
    const warnings = [];
    let streamingActive = false;
    function exitStreamingMode() {
      if (!streamingActive) {
        warnings.push('exitStreamingMode() called while not in streaming mode');
      }
      streamingActive = false;
    }
    exitStreamingMode(); // Should warn

    (0, _globals.expect)(warnings).toHaveLength(1);
    (0, _globals.expect)(warnings[0]).toContain('not in streaming mode');
  });
  (0, _globals.test)('Clean state transitions work correctly', () => {
    const warnings = [];
    let streamingActive = false;
    function enterStreamingMode() {
      if (streamingActive) {
        warnings.push('enterStreamingMode() called while already in streaming mode');
      }
      streamingActive = true;
    }
    function exitStreamingMode() {
      if (!streamingActive) {
        warnings.push('exitStreamingMode() called while not in streaming mode');
      }
      streamingActive = false;
    }

    // Proper sequence
    enterStreamingMode();
    (0, _globals.expect)(streamingActive).toBe(true);
    exitStreamingMode();
    (0, _globals.expect)(streamingActive).toBe(false);
    enterStreamingMode();
    (0, _globals.expect)(streamingActive).toBe(true);
    exitStreamingMode();
    (0, _globals.expect)(streamingActive).toBe(false);
    (0, _globals.expect)(warnings).toHaveLength(0);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2xvYmFscyIsInJlcXVpcmUiLCJkZXNjcmliZSIsInRlc3QiLCJwZW5kaW5nTWVzc2FnZXMiLCJpc1N0cmVhbWluZyIsIndyaXRlTG9ja2VkIiwiY29udGVudCIsInBheWxvYWQiLCJlbmRzV2l0aCIsInB1c2giLCJ0aW1lc3RhbXAiLCJEYXRlIiwibm93IiwiZXhwZWN0IiwidG9IYXZlTGVuZ3RoIiwidG9CZSIsImZsdXNoZWRNZXNzYWdlcyIsImxlbmd0aCIsIm1zZyIsInNoaWZ0IiwidG9FcXVhbCIsImFsbE1lc3NhZ2VzIiwiaSIsImZpbHRlciIsIm0iLCJpbmNsdWRlcyIsInQxIiwidDIiLCJ0MyIsInRvQmVHcmVhdGVyVGhhbiIsImRlbGF5MSIsImRlbGF5MiIsInRvQmVHcmVhdGVyVGhhbk9yRXF1YWwiLCJtZXNzYWdlcyIsImFkZE1lc3NhZ2UiLCJmb3JFYWNoIiwibWF4TWVzc2FnZXMiLCJ0b0JlTGVzc1RoYW5PckVxdWFsIiwic3VjY2Vzc2Z1bGx5Rmx1c2hlZCIsImVycm9ycyIsIkVycm9yIiwiZXJyb3IiLCJmbHVzaGVkIiwic3RyZWFtaW5nQWN0aXZlIiwicmVuZGVyZXJNb2RlIiwic3RvcFN0cmVhbWluZ0hlYXJ0YmVhdCIsInJlc2V0UmVuZGVyZXJTdHJlYW1pbmdNb2RlIiwiaXNQcm9jZXNzaW5nIiwic3RyZWFtaW5nU3R1Y2siLCJ3YXJuaW5ncyIsImVudGVyU3RyZWFtaW5nTW9kZSIsInRvQ29udGFpbiIsImV4aXRTdHJlYW1pbmdNb2RlIl0sInNvdXJjZXMiOlsibWVzc2FnZVF1ZXVlSW50ZWdyYXRpb24udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE1lc3NhZ2UgUXVldWUgSW50ZWdyYXRpb24gVGVzdHNcbiAqIFRlc3RzIHRoZSBjcml0aWNhbCByYWNlIGNvbmRpdGlvbiBmaXggaW4gc3RyZWFtaW5nIG1vZGVcbiAqL1xuXG5pbXBvcnQgeyBkZXNjcmliZSwgdGVzdCwgZXhwZWN0LCBqZXN0IH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5cbmRlc2NyaWJlKCdNZXNzYWdlIFF1ZXVlIEludGVncmF0aW9uJywgKCkgPT4ge1xuICB0ZXN0KCdNZXNzYWdlcyBxdWV1ZSBkdXJpbmcgc3RyZWFtaW5nIG1vZGUnLCAoKSA9PiB7XG4gICAgLy8gU2ltdWxhdGUgdGhlIG1lc3NhZ2UgcXVldWUgYmVoYXZpb3JcbiAgICBjb25zdCBwZW5kaW5nTWVzc2FnZXM6IEFycmF5PHtjb250ZW50OiBzdHJpbmc7IHRpbWVzdGFtcDogbnVtYmVyfT4gPSBbXTtcbiAgICBjb25zdCBpc1N0cmVhbWluZyA9IHRydWU7XG5cbiAgICAvLyBTaW11bGF0ZSB3cml0ZUxvY2tlZCBiZWhhdmlvclxuICAgIGZ1bmN0aW9uIHdyaXRlTG9ja2VkKGNvbnRlbnQ6IHN0cmluZyk6IHZvaWQge1xuICAgICAgY29uc3QgcGF5bG9hZCA9IGNvbnRlbnQuZW5kc1dpdGgoJ1xcbicpID8gY29udGVudCA6IGAke2NvbnRlbnR9XFxuYDtcblxuICAgICAgaWYgKGlzU3RyZWFtaW5nKSB7XG4gICAgICAgIHBlbmRpbmdNZXNzYWdlcy5wdXNoKHtcbiAgICAgICAgICBjb250ZW50OiBwYXlsb2FkLFxuICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBRdWV1ZSBtZXNzYWdlcyB3aGlsZSBzdHJlYW1pbmdcbiAgICB3cml0ZUxvY2tlZCgnTWVzc2FnZSAxJyk7XG4gICAgd3JpdGVMb2NrZWQoJ01lc3NhZ2UgMicpO1xuICAgIHdyaXRlTG9ja2VkKCdNZXNzYWdlIDMnKTtcblxuICAgIGV4cGVjdChwZW5kaW5nTWVzc2FnZXMpLnRvSGF2ZUxlbmd0aCgzKTtcbiAgICBleHBlY3QocGVuZGluZ01lc3NhZ2VzWzBdPy5jb250ZW50KS50b0JlKCdNZXNzYWdlIDFcXG4nKTtcbiAgICBleHBlY3QocGVuZGluZ01lc3NhZ2VzWzFdPy5jb250ZW50KS50b0JlKCdNZXNzYWdlIDJcXG4nKTtcbiAgICBleHBlY3QocGVuZGluZ01lc3NhZ2VzWzJdPy5jb250ZW50KS50b0JlKCdNZXNzYWdlIDNcXG4nKTtcbiAgfSk7XG5cbiAgdGVzdCgnTWVzc2FnZXMgZmx1c2ggaW4gRklGTyBvcmRlcicsICgpID0+IHtcbiAgICBjb25zdCBwZW5kaW5nTWVzc2FnZXM6IEFycmF5PHtjb250ZW50OiBzdHJpbmc7IHRpbWVzdGFtcDogbnVtYmVyfT4gPSBbXTtcbiAgICBjb25zdCBmbHVzaGVkTWVzc2FnZXM6IHN0cmluZ1tdID0gW107XG5cbiAgICAvLyBRdWV1ZSBtZXNzYWdlc1xuICAgIHBlbmRpbmdNZXNzYWdlcy5wdXNoKHsgY29udGVudDogJ0ZpcnN0XFxuJywgdGltZXN0YW1wOiBEYXRlLm5vdygpIH0pO1xuICAgIHBlbmRpbmdNZXNzYWdlcy5wdXNoKHsgY29udGVudDogJ1NlY29uZFxcbicsIHRpbWVzdGFtcDogRGF0ZS5ub3coKSArIDEgfSk7XG4gICAgcGVuZGluZ01lc3NhZ2VzLnB1c2goeyBjb250ZW50OiAnVGhpcmRcXG4nLCB0aW1lc3RhbXA6IERhdGUubm93KCkgKyAyIH0pO1xuXG4gICAgLy8gRmx1c2ggaW4gb3JkZXJcbiAgICB3aGlsZSAocGVuZGluZ01lc3NhZ2VzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IG1zZyA9IHBlbmRpbmdNZXNzYWdlcy5zaGlmdCgpO1xuICAgICAgaWYgKG1zZykge1xuICAgICAgICBmbHVzaGVkTWVzc2FnZXMucHVzaChtc2cuY29udGVudCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZXhwZWN0KGZsdXNoZWRNZXNzYWdlcykudG9FcXVhbChbJ0ZpcnN0XFxuJywgJ1NlY29uZFxcbicsICdUaGlyZFxcbiddKTtcbiAgfSk7XG5cbiAgdGVzdCgnTm8gbWVzc2FnZXMgbG9zdCBvbiByYXBpZCBzdHJlYW1pbmcgdG9nZ2xlJywgKCkgPT4ge1xuICAgIGNvbnN0IHBlbmRpbmdNZXNzYWdlczogQXJyYXk8e2NvbnRlbnQ6IHN0cmluZzsgdGltZXN0YW1wOiBudW1iZXJ9PiA9IFtdO1xuICAgIGNvbnN0IGFsbE1lc3NhZ2VzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGxldCBpc1N0cmVhbWluZyA9IGZhbHNlO1xuXG4gICAgZnVuY3Rpb24gd3JpdGVMb2NrZWQoY29udGVudDogc3RyaW5nKTogdm9pZCB7XG4gICAgICBjb25zdCBwYXlsb2FkID0gY29udGVudC5lbmRzV2l0aCgnXFxuJykgPyBjb250ZW50IDogYCR7Y29udGVudH1cXG5gO1xuXG4gICAgICBpZiAoaXNTdHJlYW1pbmcpIHtcbiAgICAgICAgcGVuZGluZ01lc3NhZ2VzLnB1c2goeyBjb250ZW50OiBwYXlsb2FkLCB0aW1lc3RhbXA6IERhdGUubm93KCkgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBGbHVzaCBwZW5kaW5nIGZpcnN0XG4gICAgICAgIHdoaWxlIChwZW5kaW5nTWVzc2FnZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGNvbnN0IG1zZyA9IHBlbmRpbmdNZXNzYWdlcy5zaGlmdCgpO1xuICAgICAgICAgIGlmIChtc2cpIGFsbE1lc3NhZ2VzLnB1c2gobXNnLmNvbnRlbnQpO1xuICAgICAgICB9XG4gICAgICAgIGFsbE1lc3NhZ2VzLnB1c2gocGF5bG9hZCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gUmFwaWQgc3RyZWFtaW5nIG1vZGUgY2hhbmdlc1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykge1xuICAgICAgaXNTdHJlYW1pbmcgPSB0cnVlO1xuICAgICAgd3JpdGVMb2NrZWQoYFN0cmVhbWluZyAke2l9YCk7XG5cbiAgICAgIGlzU3RyZWFtaW5nID0gZmFsc2U7XG4gICAgICB3cml0ZUxvY2tlZChgTm9ybWFsICR7aX1gKTtcbiAgICB9XG5cbiAgICBleHBlY3QoYWxsTWVzc2FnZXMpLnRvSGF2ZUxlbmd0aCgyMCk7XG4gICAgZXhwZWN0KGFsbE1lc3NhZ2VzLmZpbHRlcihtID0+IG0uaW5jbHVkZXMoJ1N0cmVhbWluZycpKSkudG9IYXZlTGVuZ3RoKDEwKTtcbiAgICBleHBlY3QoYWxsTWVzc2FnZXMuZmlsdGVyKG0gPT4gbS5pbmNsdWRlcygnTm9ybWFsJykpKS50b0hhdmVMZW5ndGgoMTApO1xuICB9KTtcblxuICB0ZXN0KCdUaW1lc3RhbXBzIGFsbG93IGRlYnVnZ2luZyBvZiBtZXNzYWdlIGRlbGF5cycsICgpID0+IHtcbiAgICBjb25zdCBwZW5kaW5nTWVzc2FnZXM6IEFycmF5PHtjb250ZW50OiBzdHJpbmc7IHRpbWVzdGFtcDogbnVtYmVyfT4gPSBbXTtcblxuICAgIGNvbnN0IHQxID0gRGF0ZS5ub3coKTtcbiAgICBwZW5kaW5nTWVzc2FnZXMucHVzaCh7IGNvbnRlbnQ6ICdNc2cgMScsIHRpbWVzdGFtcDogdDEgfSk7XG5cbiAgICBjb25zdCB0MiA9IERhdGUubm93KCkgKyAxMDA7XG4gICAgcGVuZGluZ01lc3NhZ2VzLnB1c2goeyBjb250ZW50OiAnTXNnIDInLCB0aW1lc3RhbXA6IHQyIH0pO1xuXG4gICAgY29uc3QgdDMgPSBEYXRlLm5vdygpICsgMjAwO1xuICAgIHBlbmRpbmdNZXNzYWdlcy5wdXNoKHsgY29udGVudDogJ01zZyAzJywgdGltZXN0YW1wOiB0MyB9KTtcblxuICAgIC8vIFZlcmlmeSB0aW1lc3RhbXBzIGFyZSBpbmNyZWFzaW5nXG4gICAgZXhwZWN0KHBlbmRpbmdNZXNzYWdlc1sxXSEudGltZXN0YW1wKS50b0JlR3JlYXRlclRoYW4ocGVuZGluZ01lc3NhZ2VzWzBdIS50aW1lc3RhbXApO1xuICAgIGV4cGVjdChwZW5kaW5nTWVzc2FnZXNbMl0hLnRpbWVzdGFtcCkudG9CZUdyZWF0ZXJUaGFuKHBlbmRpbmdNZXNzYWdlc1sxXSEudGltZXN0YW1wKTtcblxuICAgIC8vIENhbGN1bGF0ZSBkZWxheXNcbiAgICBjb25zdCBkZWxheTEgPSBwZW5kaW5nTWVzc2FnZXNbMV0hLnRpbWVzdGFtcCAtIHBlbmRpbmdNZXNzYWdlc1swXSEudGltZXN0YW1wO1xuICAgIGNvbnN0IGRlbGF5MiA9IHBlbmRpbmdNZXNzYWdlc1syXSEudGltZXN0YW1wIC0gcGVuZGluZ01lc3NhZ2VzWzFdIS50aW1lc3RhbXA7XG5cbiAgICBleHBlY3QoZGVsYXkxKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDEwMCk7XG4gICAgZXhwZWN0KGRlbGF5MikudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgxMDApO1xuICB9KTtcblxuICB0ZXN0KCdFbXB0eSBtZXNzYWdlcyBhcmUgaGFuZGxlZCBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgY29uc3QgcGVuZGluZ01lc3NhZ2VzOiBBcnJheTx7Y29udGVudDogc3RyaW5nOyB0aW1lc3RhbXA6IG51bWJlcn0+ID0gW107XG4gICAgY29uc3QgaXNTdHJlYW1pbmcgPSB0cnVlO1xuXG4gICAgZnVuY3Rpb24gd3JpdGVMb2NrZWQoY29udGVudDogc3RyaW5nKTogdm9pZCB7XG4gICAgICBpZiAoIWNvbnRlbnQpIHJldHVybjsgLy8gR3VhcmQgYWdhaW5zdCBlbXB0eSBjb250ZW50XG5cbiAgICAgIGNvbnN0IHBheWxvYWQgPSBjb250ZW50LmVuZHNXaXRoKCdcXG4nKSA/IGNvbnRlbnQgOiBgJHtjb250ZW50fVxcbmA7XG5cbiAgICAgIGlmIChpc1N0cmVhbWluZykge1xuICAgICAgICBwZW5kaW5nTWVzc2FnZXMucHVzaCh7IGNvbnRlbnQ6IHBheWxvYWQsIHRpbWVzdGFtcDogRGF0ZS5ub3coKSB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB3cml0ZUxvY2tlZCgnJyk7XG4gICAgd3JpdGVMb2NrZWQoJ1ZhbGlkIG1lc3NhZ2UnKTtcbiAgICB3cml0ZUxvY2tlZCgnJyk7XG5cbiAgICBleHBlY3QocGVuZGluZ01lc3NhZ2VzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgZXhwZWN0KHBlbmRpbmdNZXNzYWdlc1swXT8uY29udGVudCkudG9CZSgnVmFsaWQgbWVzc2FnZVxcbicpO1xuICB9KTtcblxuICB0ZXN0KCdOZXdsaW5lIGhhbmRsaW5nIGlzIGNvbnNpc3RlbnQnLCAoKSA9PiB7XG4gICAgY29uc3QgbWVzc2FnZXM6IHN0cmluZ1tdID0gW107XG5cbiAgICBmdW5jdGlvbiBhZGRNZXNzYWdlKGNvbnRlbnQ6IHN0cmluZyk6IHZvaWQge1xuICAgICAgY29uc3QgcGF5bG9hZCA9IGNvbnRlbnQuZW5kc1dpdGgoJ1xcbicpID8gY29udGVudCA6IGAke2NvbnRlbnR9XFxuYDtcbiAgICAgIG1lc3NhZ2VzLnB1c2gocGF5bG9hZCk7XG4gICAgfVxuXG4gICAgYWRkTWVzc2FnZSgnQWxyZWFkeSBoYXMgbmV3bGluZVxcbicpO1xuICAgIGFkZE1lc3NhZ2UoJ05lZWRzIG5ld2xpbmUnKTtcbiAgICBhZGRNZXNzYWdlKCdNdWx0aXBsZVxcbmxpbmVzXFxuaGVyZScpO1xuXG4gICAgZXhwZWN0KG1lc3NhZ2VzWzBdKS50b0JlKCdBbHJlYWR5IGhhcyBuZXdsaW5lXFxuJyk7XG4gICAgZXhwZWN0KG1lc3NhZ2VzWzFdKS50b0JlKCdOZWVkcyBuZXdsaW5lXFxuJyk7XG4gICAgZXhwZWN0KG1lc3NhZ2VzWzJdKS50b0JlKCdNdWx0aXBsZVxcbmxpbmVzXFxuaGVyZVxcbicpO1xuXG4gICAgLy8gQWxsIG1lc3NhZ2VzIHNob3VsZCBlbmQgd2l0aCBleGFjdGx5IG9uZSBuZXdsaW5lXG4gICAgbWVzc2FnZXMuZm9yRWFjaChtc2cgPT4ge1xuICAgICAgZXhwZWN0KG1zZy5lbmRzV2l0aCgnXFxuJykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QobXNnLmVuZHNXaXRoKCdcXG5cXG4nKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIHRlc3QoJ01lc3NhZ2UgcXVldWUgaGFzIGJvdW5kZWQgZ3Jvd3RoJywgKCkgPT4ge1xuICAgIGNvbnN0IG1heE1lc3NhZ2VzID0gLyogVE9ETzogRXh0cmFjdCBjb25zdGFudCAqLyAxMDAwO1xuICAgIGNvbnN0IHBlbmRpbmdNZXNzYWdlczogQXJyYXk8e2NvbnRlbnQ6IHN0cmluZzsgdGltZXN0YW1wOiBudW1iZXJ9PiA9IFtdO1xuXG4gICAgLy8gU2ltdWxhdGUgcmFwaWQgbWVzc2FnZSBnZW5lcmF0aW9uXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBtYXhNZXNzYWdlcyAqIDI7IGkrKykge1xuICAgICAgcGVuZGluZ01lc3NhZ2VzLnB1c2goeyBjb250ZW50OiBgTWVzc2FnZSAke2l9YCwgdGltZXN0YW1wOiBEYXRlLm5vdygpIH0pO1xuXG4gICAgICAvLyBTaW11bGF0ZSBwZXJpb2RpYyBmbHVzaGluZyB0byBwcmV2ZW50IHVuYm91bmRlZCBncm93dGhcbiAgICAgIGlmIChwZW5kaW5nTWVzc2FnZXMubGVuZ3RoID4gbWF4TWVzc2FnZXMpIHtcbiAgICAgICAgcGVuZGluZ01lc3NhZ2VzLnNoaWZ0KCk7IC8vIFJlbW92ZSBvbGRlc3RcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBRdWV1ZSBzaG91bGQgbm90IGV4Y2VlZCBtYXggc2l6ZVxuICAgIGV4cGVjdChwZW5kaW5nTWVzc2FnZXMubGVuZ3RoKS50b0JlTGVzc1RoYW5PckVxdWFsKG1heE1lc3NhZ2VzKTtcbiAgfSk7XG5cbiAgdGVzdCgnRXJyb3IgZHVyaW5nIGZsdXNoIGRvZXMgbm90IGxvc2UgcmVtYWluaW5nIG1lc3NhZ2VzJywgKCkgPT4ge1xuICAgIGNvbnN0IHBlbmRpbmdNZXNzYWdlczogQXJyYXk8e2NvbnRlbnQ6IHN0cmluZzsgdGltZXN0YW1wOiBudW1iZXJ9PiA9IFtdO1xuICAgIGNvbnN0IHN1Y2Nlc3NmdWxseUZsdXNoZWQ6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgcGVuZGluZ01lc3NhZ2VzLnB1c2goeyBjb250ZW50OiAnTWVzc2FnZSAxJywgdGltZXN0YW1wOiBEYXRlLm5vdygpIH0pO1xuICAgIHBlbmRpbmdNZXNzYWdlcy5wdXNoKHsgY29udGVudDogJ0JBRF9NRVNTQUdFJywgdGltZXN0YW1wOiBEYXRlLm5vdygpIH0pO1xuICAgIHBlbmRpbmdNZXNzYWdlcy5wdXNoKHsgY29udGVudDogJ01lc3NhZ2UgMycsIHRpbWVzdGFtcDogRGF0ZS5ub3coKSB9KTtcblxuICAgIC8vIEZsdXNoIHdpdGggZXJyb3IgaGFuZGxpbmdcbiAgICB3aGlsZSAocGVuZGluZ01lc3NhZ2VzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IG1zZyA9IHBlbmRpbmdNZXNzYWdlcy5zaGlmdCgpO1xuICAgICAgaWYgKG1zZykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGlmIChtc2cuY29udGVudCA9PT0gJ0JBRF9NRVNTQUdFJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTaW11bGF0ZWQgZmx1c2ggZXJyb3InKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgc3VjY2Vzc2Z1bGx5Rmx1c2hlZC5wdXNoKG1zZy5jb250ZW50KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBlcnJvcnMucHVzaChtc2cuY29udGVudCk7XG4gICAgICAgICAgLy8gQ29udGludWUgZmx1c2hpbmcgZGVzcGl0ZSBlcnJvclxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgZXhwZWN0KHN1Y2Nlc3NmdWxseUZsdXNoZWQpLnRvRXF1YWwoWydNZXNzYWdlIDEnLCAnTWVzc2FnZSAzJ10pO1xuICAgIGV4cGVjdChlcnJvcnMpLnRvRXF1YWwoWydCQURfTUVTU0FHRSddKTtcbiAgICBleHBlY3QocGVuZGluZ01lc3NhZ2VzKS50b0hhdmVMZW5ndGgoMCk7IC8vIEFsbCBtZXNzYWdlcyBwcm9jZXNzZWRcbiAgfSk7XG5cbiAgdGVzdCgnU3R1Y2sgc3RyZWFtaW5nIHN0YXRlIGZsdXNoZXMgcGVuZGluZyBtZXNzYWdlcyBvbiByZXNldCcsICgpID0+IHtcbiAgICBjb25zdCBwZW5kaW5nTWVzc2FnZXM6IHN0cmluZ1tdID0gWydmaXJzdFxcbicsICdzZWNvbmRcXG4nXTtcbiAgICBjb25zdCBmbHVzaGVkOiBzdHJpbmdbXSA9IFtdO1xuICAgIGxldCBzdHJlYW1pbmdBY3RpdmUgPSB0cnVlO1xuICAgIGxldCByZW5kZXJlck1vZGU6ICdpZGxlJyB8ICdzdHJlYW1pbmcnID0gJ3N0cmVhbWluZyc7XG5cbiAgICAvLyBTaW11bGF0ZSB0aGUgc3RvcFN0cmVhbWluZ0hlYXJ0YmVhdCBsb2dpYyB1c2VkIGJ5IHJlc2V0UmVuZGVyZXJTdHJlYW1pbmdNb2RlXG4gICAgZnVuY3Rpb24gc3RvcFN0cmVhbWluZ0hlYXJ0YmVhdCgpOiB2b2lkIHtcbiAgICAgIHN0cmVhbWluZ0FjdGl2ZSA9IGZhbHNlO1xuICAgICAgd2hpbGUgKHBlbmRpbmdNZXNzYWdlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IG1zZyA9IHBlbmRpbmdNZXNzYWdlcy5zaGlmdCgpO1xuICAgICAgICBpZiAobXNnKSBmbHVzaGVkLnB1c2gobXNnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZXNldFJlbmRlcmVyU3RyZWFtaW5nTW9kZShpc1Byb2Nlc3Npbmc6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICAgIGlmIChpc1Byb2Nlc3NpbmcpIHJldHVybjtcbiAgICAgIGNvbnN0IHN0cmVhbWluZ1N0dWNrID0gcmVuZGVyZXJNb2RlID09PSAnc3RyZWFtaW5nJyB8fCBzdHJlYW1pbmdBY3RpdmU7XG4gICAgICBpZiAoIXN0cmVhbWluZ1N0dWNrKSByZXR1cm47XG5cbiAgICAgIHN0b3BTdHJlYW1pbmdIZWFydGJlYXQoKTtcbiAgICAgIHJlbmRlcmVyTW9kZSA9ICdpZGxlJztcbiAgICB9XG5cbiAgICByZXNldFJlbmRlcmVyU3RyZWFtaW5nTW9kZShmYWxzZSk7XG5cbiAgICBleHBlY3Qoc3RyZWFtaW5nQWN0aXZlKS50b0JlKGZhbHNlKTtcbiAgICBleHBlY3QocmVuZGVyZXJNb2RlKS50b0JlKCdpZGxlJyk7XG4gICAgZXhwZWN0KGZsdXNoZWQpLnRvRXF1YWwoWydmaXJzdFxcbicsICdzZWNvbmRcXG4nXSk7XG4gICAgZXhwZWN0KHBlbmRpbmdNZXNzYWdlcykudG9IYXZlTGVuZ3RoKDApO1xuICB9KTtcbn0pO1xuXG5kZXNjcmliZSgnU3RyZWFtaW5nIE1vZGUgU3RhdGUgVHJhbnNpdGlvbnMnLCAoKSA9PiB7XG4gIHRlc3QoJ0RldGVjdHMgZG91YmxlLWVudHJ5IHRvIHN0cmVhbWluZyBtb2RlJywgKCkgPT4ge1xuICAgIGNvbnN0IHdhcm5pbmdzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGxldCBzdHJlYW1pbmdBY3RpdmUgPSBmYWxzZTtcblxuICAgIGZ1bmN0aW9uIGVudGVyU3RyZWFtaW5nTW9kZSgpOiB2b2lkIHtcbiAgICAgIGlmIChzdHJlYW1pbmdBY3RpdmUpIHtcbiAgICAgICAgd2FybmluZ3MucHVzaCgnZW50ZXJTdHJlYW1pbmdNb2RlKCkgY2FsbGVkIHdoaWxlIGFscmVhZHkgaW4gc3RyZWFtaW5nIG1vZGUnKTtcbiAgICAgIH1cbiAgICAgIHN0cmVhbWluZ0FjdGl2ZSA9IHRydWU7XG4gICAgfVxuXG4gICAgZW50ZXJTdHJlYW1pbmdNb2RlKCk7XG4gICAgZW50ZXJTdHJlYW1pbmdNb2RlKCk7IC8vIFNob3VsZCB3YXJuXG5cbiAgICBleHBlY3Qod2FybmluZ3MpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICBleHBlY3Qod2FybmluZ3NbMF0pLnRvQ29udGFpbignYWxyZWFkeSBpbiBzdHJlYW1pbmcgbW9kZScpO1xuICB9KTtcblxuICB0ZXN0KCdEZXRlY3RzIGV4aXQgd2hlbiBub3QgaW4gc3RyZWFtaW5nIG1vZGUnLCAoKSA9PiB7XG4gICAgY29uc3Qgd2FybmluZ3M6IHN0cmluZ1tdID0gW107XG4gICAgbGV0IHN0cmVhbWluZ0FjdGl2ZSA9IGZhbHNlO1xuXG4gICAgZnVuY3Rpb24gZXhpdFN0cmVhbWluZ01vZGUoKTogdm9pZCB7XG4gICAgICBpZiAoIXN0cmVhbWluZ0FjdGl2ZSkge1xuICAgICAgICB3YXJuaW5ncy5wdXNoKCdleGl0U3RyZWFtaW5nTW9kZSgpIGNhbGxlZCB3aGlsZSBub3QgaW4gc3RyZWFtaW5nIG1vZGUnKTtcbiAgICAgIH1cbiAgICAgIHN0cmVhbWluZ0FjdGl2ZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIGV4aXRTdHJlYW1pbmdNb2RlKCk7IC8vIFNob3VsZCB3YXJuXG5cbiAgICBleHBlY3Qod2FybmluZ3MpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICBleHBlY3Qod2FybmluZ3NbMF0pLnRvQ29udGFpbignbm90IGluIHN0cmVhbWluZyBtb2RlJyk7XG4gIH0pO1xuXG4gIHRlc3QoJ0NsZWFuIHN0YXRlIHRyYW5zaXRpb25zIHdvcmsgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgIGNvbnN0IHdhcm5pbmdzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGxldCBzdHJlYW1pbmdBY3RpdmUgPSBmYWxzZTtcblxuICAgIGZ1bmN0aW9uIGVudGVyU3RyZWFtaW5nTW9kZSgpOiB2b2lkIHtcbiAgICAgIGlmIChzdHJlYW1pbmdBY3RpdmUpIHtcbiAgICAgICAgd2FybmluZ3MucHVzaCgnZW50ZXJTdHJlYW1pbmdNb2RlKCkgY2FsbGVkIHdoaWxlIGFscmVhZHkgaW4gc3RyZWFtaW5nIG1vZGUnKTtcbiAgICAgIH1cbiAgICAgIHN0cmVhbWluZ0FjdGl2ZSA9IHRydWU7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZXhpdFN0cmVhbWluZ01vZGUoKTogdm9pZCB7XG4gICAgICBpZiAoIXN0cmVhbWluZ0FjdGl2ZSkge1xuICAgICAgICB3YXJuaW5ncy5wdXNoKCdleGl0U3RyZWFtaW5nTW9kZSgpIGNhbGxlZCB3aGlsZSBub3QgaW4gc3RyZWFtaW5nIG1vZGUnKTtcbiAgICAgIH1cbiAgICAgIHN0cmVhbWluZ0FjdGl2ZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIC8vIFByb3BlciBzZXF1ZW5jZVxuICAgIGVudGVyU3RyZWFtaW5nTW9kZSgpO1xuICAgIGV4cGVjdChzdHJlYW1pbmdBY3RpdmUpLnRvQmUodHJ1ZSk7XG5cbiAgICBleGl0U3RyZWFtaW5nTW9kZSgpO1xuICAgIGV4cGVjdChzdHJlYW1pbmdBY3RpdmUpLnRvQmUoZmFsc2UpO1xuXG4gICAgZW50ZXJTdHJlYW1pbmdNb2RlKCk7XG4gICAgZXhwZWN0KHN0cmVhbWluZ0FjdGl2ZSkudG9CZSh0cnVlKTtcblxuICAgIGV4aXRTdHJlYW1pbmdNb2RlKCk7XG4gICAgZXhwZWN0KHN0cmVhbWluZ0FjdGl2ZSkudG9CZShmYWxzZSk7XG5cbiAgICBleHBlY3Qod2FybmluZ3MpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6Ijs7QUFLQSxJQUFBQSxRQUFBLEdBQUFDLE9BQUE7QUFMQTtBQUNBO0FBQ0E7QUFDQTs7QUFJQSxJQUFBQyxpQkFBUSxFQUFDLDJCQUEyQixFQUFFLE1BQU07RUFDMUMsSUFBQUMsYUFBSSxFQUFDLHNDQUFzQyxFQUFFLE1BQU07SUFDakQ7SUFDQSxNQUFNQyxlQUE0RCxHQUFHLEVBQUU7SUFDdkUsTUFBTUMsV0FBVyxHQUFHLElBQUk7O0lBRXhCO0lBQ0EsU0FBU0MsV0FBV0EsQ0FBQ0MsT0FBZSxFQUFRO01BQzFDLE1BQU1DLE9BQU8sR0FBR0QsT0FBTyxDQUFDRSxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUdGLE9BQU8sR0FBRyxHQUFHQSxPQUFPLElBQUk7TUFFakUsSUFBSUYsV0FBVyxFQUFFO1FBQ2ZELGVBQWUsQ0FBQ00sSUFBSSxDQUFDO1VBQ25CSCxPQUFPLEVBQUVDLE9BQU87VUFDaEJHLFNBQVMsRUFBRUMsSUFBSSxDQUFDQyxHQUFHLENBQUM7UUFDdEIsQ0FBQyxDQUFDO01BQ0o7SUFDRjs7SUFFQTtJQUNBUCxXQUFXLENBQUMsV0FBVyxDQUFDO0lBQ3hCQSxXQUFXLENBQUMsV0FBVyxDQUFDO0lBQ3hCQSxXQUFXLENBQUMsV0FBVyxDQUFDO0lBRXhCLElBQUFRLGVBQU0sRUFBQ1YsZUFBZSxDQUFDLENBQUNXLFlBQVksQ0FBQyxDQUFDLENBQUM7SUFDdkMsSUFBQUQsZUFBTSxFQUFDVixlQUFlLENBQUMsQ0FBQyxDQUFDLEVBQUVHLE9BQU8sQ0FBQyxDQUFDUyxJQUFJLENBQUMsYUFBYSxDQUFDO0lBQ3ZELElBQUFGLGVBQU0sRUFBQ1YsZUFBZSxDQUFDLENBQUMsQ0FB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