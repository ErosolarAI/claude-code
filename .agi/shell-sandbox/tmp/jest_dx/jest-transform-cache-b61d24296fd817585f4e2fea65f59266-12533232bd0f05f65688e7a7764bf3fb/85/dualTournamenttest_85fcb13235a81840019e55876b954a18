3a053e8684a7f4e335b7958276ba8266
"use strict";

var _dualTournament = require("../src/core/dualTournament.js");
var _repoUpgradeOrchestrator = require("../src/core/repoUpgradeOrchestrator.js");
describe('dualTournament engine', () => {
  it('uses fast path for single candidate with human accuracy = 1', () => {
    const outcome = (0, _dualTournament.runDualTournament)({
      id: 't1',
      goal: 'single candidate fast path'
    }, [{
      id: 'primary',
      policyId: 'primary',
      metrics: {
        executionSuccess: 1,
        testsPassed: 1,
        staticAnalysis: 1
      },
      signals: {
        rewardModelScore: 0.8
      }
    }]);
    expect(outcome.ranked).toHaveLength(1);
    const solo = outcome.ranked[0];
    expect(solo.humanAccuracy).toBe(1);
    expect(solo.aggregateScore).toBeGreaterThan(0.5);
    expect(Object.keys(outcome.pairwise)).toHaveLength(0);
  });
  it('prefers higher human accuracy when scores are tied', () => {
    const orchestrator = new _repoUpgradeOrchestrator.RepoUpgradeOrchestrator(async () => ({
      success: true,
      summary: 'noop',
      score: 0
    }));
    const def = _repoUpgradeOrchestrator.REPO_UPGRADE_MODE_DEFINITIONS['dual-rl-tournament'];
    const primary = {
      success: true,
      summary: 'p',
      score: 0.5,
      humanAccuracy: 0.2
    };
    const refiner = {
      success: true,
      summary: 'r',
      score: 0.5,
      humanAccuracy: 0.9
    };

    // @ts-expect-error - access private helper for targeted tie-break test
    const {
      winnerVariant
    } = orchestrator.pickWinner(def, primary, refiner);
    expect(winnerVariant).toBe('refiner');
  });
  it('assigns descending human accuracy across ranked candidates', () => {
    const outcome = (0, _dualTournament.runDualTournament)({
      id: 't2',
      goal: 'rank accuracy'
    }, [{
      id: 'p',
      policyId: 'p',
      metrics: {
        executionSuccess: 1,
        testsPassed: 1
      },
      signals: {
        rewardModelScore: 0.8
      }
    }, {
      id: 'r',
      policyId: 'r',
      metrics: {
        executionSuccess: 0.2,
        testsPassed: 0
      },
      signals: {
        rewardModelScore: 0.2
      }
    }]);
    const [top, bottom] = outcome.ranked;
    expect(top.humanAccuracy).toBe(1);
    expect(bottom.humanAccuracy).toBe(0);
    expect(top.aggregateScore).toBeGreaterThan(bottom.aggregateScore);
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZHVhbFRvdXJuYW1lbnQiLCJyZXF1aXJlIiwiX3JlcG9VcGdyYWRlT3JjaGVzdHJhdG9yIiwiZGVzY3JpYmUiLCJpdCIsIm91dGNvbWUiLCJydW5EdWFsVG91cm5hbWVudCIsImlkIiwiZ29hbCIsInBvbGljeUlkIiwibWV0cmljcyIsImV4ZWN1dGlvblN1Y2Nlc3MiLCJ0ZXN0c1Bhc3NlZCIsInN0YXRpY0FuYWx5c2lzIiwic2lnbmFscyIsInJld2FyZE1vZGVsU2NvcmUiLCJleHBlY3QiLCJyYW5rZWQiLCJ0b0hhdmVMZW5ndGgiLCJzb2xvIiwiaHVtYW5BY2N1cmFjeSIsInRvQmUiLCJhZ2dyZWdhdGVTY29yZSIsInRvQmVHcmVhdGVyVGhhbiIsIk9iamVjdCIsImtleXMiLCJwYWlyd2lzZSIsIm9yY2hlc3RyYXRvciIsIlJlcG9VcGdyYWRlT3JjaGVzdHJhdG9yIiwic3VjY2VzcyIsInN1bW1hcnkiLCJzY29yZSIsImRlZiIsIlJFUE9fVVBHUkFERV9NT0RFX0RFRklOSVRJT05TIiwicHJpbWFyeSIsInJlZmluZXIiLCJ3aW5uZXJWYXJpYW50IiwicGlja1dpbm5lciIsInRvcCIsImJvdHRvbSJdLCJzb3VyY2VzIjpbImR1YWxUb3VybmFtZW50LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcnVuRHVhbFRvdXJuYW1lbnQgfSBmcm9tICcuLi9zcmMvY29yZS9kdWFsVG91cm5hbWVudC5qcyc7XG5pbXBvcnQgeyBSZXBvVXBncmFkZU9yY2hlc3RyYXRvciwgUkVQT19VUEdSQURFX01PREVfREVGSU5JVElPTlMsIHR5cGUgVXBncmFkZVN0ZXBSZXN1bHQgfSBmcm9tICcuLi9zcmMvY29yZS9yZXBvVXBncmFkZU9yY2hlc3RyYXRvci5qcyc7XG5cbmRlc2NyaWJlKCdkdWFsVG91cm5hbWVudCBlbmdpbmUnLCAoKSA9PiB7XG4gIGl0KCd1c2VzIGZhc3QgcGF0aCBmb3Igc2luZ2xlIGNhbmRpZGF0ZSB3aXRoIGh1bWFuIGFjY3VyYWN5ID0gMScsICgpID0+IHtcbiAgICBjb25zdCBvdXRjb21lID0gcnVuRHVhbFRvdXJuYW1lbnQoXG4gICAgICB7IGlkOiAndDEnLCBnb2FsOiAnc2luZ2xlIGNhbmRpZGF0ZSBmYXN0IHBhdGgnIH0sXG4gICAgICBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogJ3ByaW1hcnknLFxuICAgICAgICAgIHBvbGljeUlkOiAncHJpbWFyeScsXG4gICAgICAgICAgbWV0cmljczogeyBleGVjdXRpb25TdWNjZXNzOiAxLCB0ZXN0c1Bhc3NlZDogMSwgc3RhdGljQW5hbHlzaXM6IDEgfSxcbiAgICAgICAgICBzaWduYWxzOiB7IHJld2FyZE1vZGVsU2NvcmU6IDAuOCB9LFxuICAgICAgICB9LFxuICAgICAgXVxuICAgICk7XG5cbiAgICBleHBlY3Qob3V0Y29tZS5yYW5rZWQpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICBjb25zdCBzb2xvID0gb3V0Y29tZS5yYW5rZWRbMF0hO1xuICAgIGV4cGVjdChzb2xvLmh1bWFuQWNjdXJhY3kpLnRvQmUoMSk7XG4gICAgZXhwZWN0KHNvbG8uYWdncmVnYXRlU2NvcmUpLnRvQmVHcmVhdGVyVGhhbigwLjUpO1xuICAgIGV4cGVjdChPYmplY3Qua2V5cyhvdXRjb21lLnBhaXJ3aXNlKSkudG9IYXZlTGVuZ3RoKDApO1xuICB9KTtcblxuICBpdCgncHJlZmVycyBoaWdoZXIgaHVtYW4gYWNjdXJhY3kgd2hlbiBzY29yZXMgYXJlIHRpZWQnLCAoKSA9PiB7XG4gICAgY29uc3Qgb3JjaGVzdHJhdG9yID0gbmV3IFJlcG9VcGdyYWRlT3JjaGVzdHJhdG9yKGFzeW5jICgpID0+ICh7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgc3VtbWFyeTogJ25vb3AnLFxuICAgICAgc2NvcmU6IDAsXG4gICAgfSkpO1xuICAgIGNvbnN0IGRlZiA9IFJFUE9fVVBHUkFERV9NT0RFX0RFRklOSVRJT05TWydkdWFsLXJsLXRvdXJuYW1lbnQnXTtcblxuICAgIGNvbnN0IHByaW1hcnk6IFVwZ3JhZGVTdGVwUmVzdWx0ID0ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHN1bW1hcnk6ICdwJyxcbiAgICAgIHNjb3JlOiAwLjUsXG4gICAgICBodW1hbkFjY3VyYWN5OiAwLjIsXG4gICAgfTtcbiAgICBjb25zdCByZWZpbmVyOiBVcGdyYWRlU3RlcFJlc3VsdCA9IHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBzdW1tYXJ5OiAncicsXG4gICAgICBzY29yZTogMC41LFxuICAgICAgaHVtYW5BY2N1cmFjeTogMC45LFxuICAgIH07XG5cbiAgICAvLyBAdHMtZXhwZWN0LWVycm9yIC0gYWNjZXNzIHByaXZhdGUgaGVscGVyIGZvciB0YXJnZXRlZCB0aWUtYnJlYWsgdGVzdFxuICAgIGNvbnN0IHsgd2lubmVyVmFyaWFudCB9ID0gKG9yY2hlc3RyYXRvciBhcyB1bmtub3duIGFzIHsgcGlja1dpbm5lcjogdHlwZW9mIG9yY2hlc3RyYXRvclsncGlja1dpbm5lciddIH0pLnBpY2tXaW5uZXIoXG4gICAgICBkZWYsXG4gICAgICBwcmltYXJ5LFxuICAgICAgcmVmaW5lclxuICAgICk7XG5cbiAgICBleHBlY3Qod2lubmVyVmFyaWFudCkudG9CZSgncmVmaW5lcicpO1xuICB9KTtcblxuICBpdCgnYXNzaWducyBkZXNjZW5kaW5nIGh1bWFuIGFjY3VyYWN5IGFjcm9zcyByYW5rZWQgY2FuZGlkYXRlcycsICgpID0+IHtcbiAgICBjb25zdCBvdXRjb21lID0gcnVuRHVhbFRvdXJuYW1lbnQoXG4gICAgICB7IGlkOiAndDInLCBnb2FsOiAncmFuayBhY2N1cmFjeScgfSxcbiAgICAgIFtcbiAgICAgICAgeyBpZDogJ3AnLCBwb2xpY3lJZDogJ3AnLCBtZXRyaWNzOiB7IGV4ZWN1dGlvblN1Y2Nlc3M6IDEsIHRlc3RzUGFzc2VkOiAxIH0sIHNpZ25hbHM6IHsgcmV3YXJkTW9kZWxTY29yZTogMC44IH0gfSxcbiAgICAgICAgeyBpZDogJ3InLCBwb2xpY3lJZDogJ3InLCBtZXRyaWNzOiB7IGV4ZWN1dGlvblN1Y2Nlc3M6IDAuMiwgdGVzdHNQYXNzZWQ6IDAgfSwgc2lnbmFsczogeyByZXdhcmRNb2RlbFNjb3JlOiAwLjIgfSB9LFxuICAgICAgXVxuICAgICk7XG5cbiAgICBjb25zdCBbdG9wLCBib3R0b21dID0gb3V0Y29tZS5yYW5rZWQ7XG4gICAgZXhwZWN0KHRvcC5odW1hbkFjY3VyYWN5KS50b0JlKDEpO1xuICAgIGV4cGVjdChib3R0b20uaHVtYW5BY2N1cmFjeSkudG9CZSgwKTtcbiAgICBleHBlY3QodG9wLmFnZ3JlZ2F0ZVNjb3JlKS50b0JlR3JlYXRlclRoYW4oYm90dG9tLmFnZ3JlZ2F0ZVNjb3JlKTtcbiAgfSk7XG59KTtcbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFBQSxlQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyx3QkFBQSxHQUFBRCxPQUFBO0FBRUFFLFFBQVEsQ0FBQyx1QkFBdUIsRUFBRSxNQUFNO0VBQ3RDQyxFQUFFLENBQUMsNkRBQTZELEVBQUUsTUFBTTtJQUN0RSxNQUFNQyxPQUFPLEdBQUcsSUFBQUMsaUNBQWlCLEVBQy9CO01BQUVDLEVBQUUsRUFBRSxJQUFJO01BQUVDLElBQUksRUFBRTtJQUE2QixDQUFDLEVBQ2hELENBQ0U7TUFDRUQsRUFBRSxFQUFFLFNBQVM7TUFDYkUsUUFBUSxFQUFFLFNBQVM7TUFDbkJDLE9BQU8sRUFBRTtRQUFFQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQUVDLFdBQVcsRUFBRSxDQUFDO1FBQUVDLGNBQWMsRUFBRTtNQUFFLENBQUM7TUFDbkVDLE9BQU8sRUFBRTtRQUFFQyxnQkFBZ0IsRUFBRTtNQUFJO0lBQ25DLENBQUMsQ0FFTCxDQUFDO0lBRURDLE1BQU0sQ0FBQ1gsT0FBTyxDQUFDWSxNQUFNLENBQUMsQ0FBQ0MsWUFBWSxDQUFDLENBQUMsQ0FBQztJQUN0QyxNQUFNQyxJQUFJLEdBQUdkLE9BQU8sQ0FBQ1ksTUFBTSxDQUFDLENBQUMsQ0FBRTtJQUMvQkQsTUFBTSxDQUFDRyxJQUFJLENBQUNDLGFBQWEsQ0FBQyxDQUFD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