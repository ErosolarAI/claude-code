{"version":3,"names":["UIUpdateCoordinator","queue","flushing","scheduled","disposed","mode","enqueue","task","push","queueMicrotask","flush","getMode","isDisposed","setMode","dispose","length","shift","run","exports"],"sources":["UIUpdateCoordinator.ts"],"sourcesContent":["export interface UIUpdateTask {\n  lane: string;\n  run: () => Promise<void> | void;\n}\n\ntype Mode = 'idle' | 'flushing';\n\nexport class UIUpdateCoordinator {\n  private readonly queue: UIUpdateTask[] = [];\n  private flushing = false;\n  private scheduled = false;\n  private disposed = false;\n  private mode: Mode = 'idle';\n\n  enqueue(task: UIUpdateTask): void {\n    if (this.disposed) return;\n    this.queue.push(task);\n    if (!this.scheduled) {\n      this.scheduled = true;\n      queueMicrotask(() => void this.flush());\n    }\n  }\n\n  getMode(): Mode {\n    return this.mode;\n  }\n\n  isDisposed(): boolean {\n    return this.disposed;\n  }\n\n  setMode(mode: Mode): void {\n    this.mode = mode;\n  }\n\n  dispose(): void {\n    this.disposed = true;\n    this.queue.length = 0;\n    this.mode = 'idle';\n  }\n\n  private async flush(): Promise<void> {\n    if (this.disposed || this.flushing) {\n      this.scheduled = false;\n      return;\n    }\n    this.flushing = true;\n    this.scheduled = false;\n    this.mode = 'flushing';\n\n    while (this.queue.length && !this.disposed) {\n      const task = this.queue.shift();\n      if (!task) {\n        continue;\n      }\n      try {\n        await task.run();\n      } catch {\n        // Ignore individual task errors to keep UI updates flowing\n      }\n    }\n\n    this.flushing = false;\n    this.mode = 'idle';\n\n    // In case more tasks were enqueued after the loop ended\n    if (this.queue.length && !this.scheduled && !this.disposed) {\n      this.scheduled = true;\n      queueMicrotask(() => void this.flush());\n    }\n  }\n}\n"],"mappings":";;;;;;AAOO,MAAMA,mBAAmB,CAAC;EACdC,KAAK,GAAmB,EAAE;EACnCC,QAAQ,GAAG,KAAK;EAChBC,SAAS,GAAG,KAAK;EACjBC,QAAQ,GAAG,KAAK;EAChBC,IAAI,GAAS,MAAM;EAE3BC,OAAOA,CAACC,IAAkB,EAAQ;IAChC,IAAI,IAAI,CAACH,QAAQ,EAAE;IACnB,IAAI,CAACH,KAAK,CAACO,IAAI,CAACD,IAAI,CAAC;IACrB,IAAI,CAAC,IAAI,CAACJ,SAAS,EAAE;MACnB,IAAI,CAACA,SAAS,GAAG,IAAI;MACrBM,cAAc,CAAC,MAAM,KAAK,IAAI,CAACC,KAAK,CAAC,CAAC,CAAC;IACzC;EACF;EAEAC,OAAOA,CAAA,EAAS;IACd,OAAO,IAAI,CAACN,IAAI;EAClB;EAEAO,UAAUA,CAAA,EAAY;IACpB,OAAO,IAAI,CAACR,QAAQ;EACtB;EAEAS,OAAOA,CAACR,IAAU,EAAQ;IACxB,IAAI,CAACA,IAAI,GAAGA,IAAI;EAClB;EAEAS,OAAOA,CAAA,EAAS;IACd,IAAI,CAACV,QAAQ,GAAG,IAAI;IACpB,IAAI,CAACH,KAAK,CAACc,MAAM,GAAG,CAAC;IACrB,IAAI,CAACV,IAAI,GAAG,MAAM;EACpB;EAEA,MAAcK,KAAKA,CAAA,EAAkB;IACnC,IAAI,IAAI,CAACN,QAAQ,IAAI,IAAI,CAACF,QAAQ,EAAE;MAClC,IAAI,CAACC,SAAS,GAAG,KAAK;MACtB;IACF;IACA,IAAI,CAACD,QAAQ,GAAG,IAAI;IACpB,IAAI,CAACC,SAAS,GAAG,KAAK;IACtB,IAAI,CAACE,IAAI,GAAG,UAAU;IAEtB,OAAO,IAAI,CAACJ,KAAK,CAACc,MAAM,IAAI,CAAC,IAAI,CAACX,QAAQ,EAAE;MAC1C,MAAMG,IAAI,GAAG,IAAI,CAACN,KAAK,CAACe,KAAK,CAAC,CAAC;MAC/B,IAAI,CAACT,IAAI,EAAE;QACT;MACF;MACA,IAAI;QACF,MAAMA,IAAI,CAACU,GAAG,CAAC,CAAC;MAClB,CAAC,CAAC,MAAM;QACN;MAAA;IAEJ;IAEA,IAAI,CAACf,QAAQ,GAAG,KAAK;IACrB,IAAI,CAACG,IAAI,GAAG,MAAM;;IAElB;IACA,IAAI,IAAI,CAACJ,KAAK,CAACc,MAAM,IAAI,CAAC,IAAI,CAACZ,SAAS,IAAI,CAAC,IAAI,CAACC,QAAQ,EAAE;MAC1D,IAAI,CAACD,SAAS,GAAG,IAAI;MACrBM,cAAc,CAAC,MAAM,KAAK,IAAI,CAACC,KAAK,CAAC,CAAC,CAAC;IACzC;EACF;AACF;AAACQ,OAAA,CAAAlB,mBAAA,GAAAA,mBAAA","ignoreList":[]}