{"version":3,"names":["validateBashCommand","_command","valid","warnings","validateToolArgs","toolName","args","constraints","key","constraint","Object","entries","value","undefined","matchesType","type","error","Error","num","max","min","SmartFixer","fixDangerousCommand","command","fixed","changes","test","replace","push","fixResourceLimits","newValue","Math","floor","fixValidationErrors","trim","parsed","Number","isNaN","toLowerCase","exports","AutoFixValidator","constructor","autoFix","enabled","setAutoFix","validate","validator","result"],"sources":["safetyValidator.ts"],"sourcesContent":["/**\n * Safety Validator - Lean validation for tool arguments.\n * No command blocking - all bash commands allowed.\n */\n\nexport interface ValidationResult {\n  valid: boolean;\n  error?: Error;\n  warnings: string[];\n  autoFix?: {\n    available: boolean;\n    apply: () => unknown;\n    description: string;\n  };\n}\n\ninterface ToolConstraint {\n  type: 'number' | 'string' | 'boolean';\n  max?: number;\n  min?: number;\n}\n\n/**\n * Validate bash command - all commands allowed\n */\nexport function validateBashCommand(_command: string): ValidationResult {\n  return { valid: true, warnings: [] };\n}\n\n/**\n * Validate tool arguments against type constraints\n */\nexport function validateToolArgs(\n  toolName: string,\n  args: Record<string, unknown>,\n  constraints: Record<string, ToolConstraint>\n): ValidationResult {\n  for (const [key, constraint] of Object.entries(constraints)) {\n    const value = args[key];\n    if (value === undefined) continue;\n\n    if (!matchesType(value, constraint.type)) {\n      return {\n        valid: false,\n        error: new Error(`Invalid type for ${toolName}.${key}: expected ${constraint.type}.`),\n        warnings: [],\n      };\n    }\n\n    if (constraint.type === 'number') {\n      const num = value as number;\n      if (constraint.max !== undefined && num > constraint.max) {\n        return {\n          valid: false,\n          error: new Error(`${toolName}.${key} exceeds maximum (${num} > ${constraint.max}).`),\n          warnings: [],\n        };\n      }\n      if (constraint.min !== undefined && num < constraint.min) {\n        return {\n          valid: false,\n          error: new Error(`${toolName}.${key} below minimum (${num} < ${constraint.min}).`),\n          warnings: [],\n        };\n      }\n    }\n  }\n\n  return { valid: true, warnings: [] };\n}\n\n/**\n * Utility fixer for common patterns\n */\nexport class SmartFixer {\n  static fixDangerousCommand(command: string): { fixed: string; changes: string[] } {\n    let fixed = command;\n    const changes: string[] = [];\n\n    if (/\\brm\\s+-rf\\s+\\/(\\s|$)/i.test(fixed)) {\n      fixed = fixed.replace(/\\brm\\s+-rf\\s+\\/(\\s|$)/i, 'rm -rf ./');\n      changes.push('Rewrote \"rm -rf /\" to \"rm -rf ./\".');\n    }\n    if (/chmod\\s+-R\\s+777\\b/i.test(fixed)) {\n      fixed = fixed.replace(/chmod\\s+-R\\s+777\\b/i, 'chmod -R 755');\n      changes.push('Reduced chmod 777 to chmod 755.');\n    }\n    if (/git\\s+push\\s+--force\\b/i.test(fixed)) {\n      fixed = fixed.replace(/git\\s+push\\s+--force\\b/i, 'git push --force-with-lease');\n      changes.push('Replaced --force with --force-with-lease.');\n    }\n\n    return { fixed, changes };\n  }\n\n  static fixResourceLimits(\n    args: Record<string, unknown>,\n    constraints: Record<string, { max?: number; min?: number }>\n  ): { fixed: Record<string, unknown>; changes: string[] } {\n    const fixed = { ...args };\n    const changes: string[] = [];\n\n    for (const [key, constraint] of Object.entries(constraints)) {\n      const value = fixed[key];\n      if (typeof value !== 'number') continue;\n\n      if (constraint.max !== undefined && value > constraint.max) {\n        const newValue = Math.floor(constraint.max * 0.8);\n        fixed[key] = newValue;\n        changes.push(`Lowered ${key} to ${newValue} (80% of max ${constraint.max}).`);\n      } else if (constraint.min !== undefined && value < constraint.min) {\n        fixed[key] = constraint.min;\n        changes.push(`Raised ${key} to minimum ${constraint.min}.`);\n      }\n    }\n\n    return { fixed, changes };\n  }\n\n  static fixValidationErrors(\n    args: Record<string, unknown>,\n    constraints: Record<string, ToolConstraint>\n  ): { fixed: Record<string, unknown>; changes: string[] } {\n    const fixed = { ...args };\n    const changes: string[] = [];\n\n    for (const [key, constraint] of Object.entries(constraints)) {\n      const value = fixed[key];\n\n      if (constraint.type === 'number' && typeof value === 'string' && value.trim() !== '') {\n        const parsed = Number(value);\n        if (!Number.isNaN(parsed)) {\n          fixed[key] = parsed;\n          changes.push(`Coerced ${key} to number.`);\n        }\n      }\n\n      if (constraint.type === 'boolean' && typeof value === 'string') {\n        if (value.toLowerCase() === 'true') {\n          fixed[key] = true;\n          changes.push(`Coerced ${key} to boolean true.`);\n        } else if (value.toLowerCase() === 'false') {\n          fixed[key] = false;\n          changes.push(`Coerced ${key} to boolean false.`);\n        }\n      }\n    }\n\n    return { fixed, changes };\n  }\n}\n\n/**\n * Validator wrapper with optional auto-fix\n */\nexport class AutoFixValidator<T = string> {\n  private enabled: boolean;\n\n  constructor(autoFix: boolean) {\n    this.enabled = autoFix;\n  }\n\n  setAutoFix(enabled: boolean): void {\n    this.enabled = enabled;\n  }\n\n  async validate(\n    value: T,\n    validator: (value: T) => ValidationResult\n  ): Promise<{ value: T; result: ValidationResult }> {\n    const result = validator(value);\n    return { value, result };\n  }\n}\n\nfunction matchesType(value: unknown, type: ToolConstraint['type']): boolean {\n  if (type === 'number') return typeof value === 'number';\n  if (type === 'string') return typeof value === 'string';\n  if (type === 'boolean') return typeof value === 'boolean';\n  return false;\n}\n"],"mappings":"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","ignoreList":[]}