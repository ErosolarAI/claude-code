ef2fc68cecd8b253c5c4d6ab403d30d4
"use strict";

var _events = require("events");
var _UnifiedUIRenderer = require("../../src/ui/UnifiedUIRenderer.js");
var _display = require("../../src/ui/display.js");
const makeMockStream = () => {
  const emitter = new _events.EventEmitter();
  const stream = {
    isTTY: false,
    rows: 24,
    columns: 80,
    write: jest.fn(),
    on: emitter.on.bind(emitter),
    off: emitter.off.bind(emitter),
    removeListener: emitter.removeListener.bind(emitter),
    once: emitter.once.bind(emitter),
    emit: emitter.emit.bind(emitter),
    listenerCount: emitter.listenerCount.bind(emitter),
    setMaxListeners: emitter.setMaxListeners.bind(emitter),
    getMaxListeners: emitter.getMaxListeners.bind(emitter),
    resume: jest.fn(),
    pause: jest.fn(),
    setRawMode: jest.fn()
  };
  return stream;
};
const makeLines = count => Array.from({
  length: count
}, (_, index) => `line-${index + 1}`);
describe('inline panel clamping', () => {
  test('UnifiedUIRenderer.limitInlinePanel caps lines and prepends overflow indicator', () => {
    const renderer = new _UnifiedUIRenderer.UnifiedUIRenderer(makeMockStream(), makeMockStream());
    // Simulate a taller terminal to make the math predictable
    renderer.rows = 32;
    const input = makeLines(20);
    const result = renderer.limitInlinePanel(input);
    const expectedMax = Math.max(4, Math.min(renderer.maxInlinePanelLines, Math.max(2, 32 - 8)));
    const expectedTailCount = Math.max(1, expectedMax - 1);
    expect(result[0]).toContain('more lines');
    expect(result.length).toBe(expectedTailCount + 1);
    expect(result.slice(1)).toEqual(input.slice(-expectedTailCount));
  });
  test('Display.clampInlinePanel trims and annotates overflow', () => {
    const display = new _display.Display(makeMockStream(), makeMockStream());
    const input = makeLines(70);
    const result = display.clampInlinePanel(input);
    const expectedTailCount = 63; // maxLines (64) minus the overflow indicator

    expect(result[0]).toContain('more lines');
    expect(result.length).toBe(expectedTailCount + 1);
    expect(result.slice(1)).toEqual(input.slice(-expectedTailCount));
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZXZlbnRzIiwicmVxdWlyZSIsIl9VbmlmaWVkVUlSZW5kZXJlciIsIl9kaXNwbGF5IiwibWFrZU1vY2tTdHJlYW0iLCJlbWl0dGVyIiwiRXZlbnRFbWl0dGVyIiwic3RyZWFtIiwiaXNUVFkiLCJyb3dzIiwiY29sdW1ucyIsIndyaXRlIiwiamVzdCIsImZuIiwib24iLCJiaW5kIiwib2ZmIiwicmVtb3ZlTGlzdGVuZXIiLCJvbmNlIiwiZW1pdCIsImxpc3RlbmVyQ291bnQiLCJzZXRNYXhMaXN0ZW5lcnMiLCJnZXRNYXhMaXN0ZW5lcnMiLCJyZXN1bWUiLCJwYXVzZSIsInNldFJhd01vZGUiLCJtYWtlTGluZXMiLCJjb3VudCIsIkFycmF5IiwiZnJvbSIsImxlbmd0aCIsIl8iLCJpbmRleCIsImRlc2NyaWJlIiwidGVzdCIsInJlbmRlcmVyIiwiVW5pZmllZFVJUmVuZGVyZXIiLCJpbnB1dCIsInJlc3VsdCIsImxpbWl0SW5saW5lUGFuZWwiLCJleHBlY3RlZE1heCIsIk1hdGgiLCJtYXgiLCJtaW4iLCJtYXhJbmxpbmVQYW5lbExpbmVzIiwiZXhwZWN0ZWRUYWlsQ291bnQiLCJleHBlY3QiLCJ0b0NvbnRhaW4iLCJ0b0JlIiwic2xpY2UiLCJ0b0VxdWFsIiwiZGlzcGxheSIsIkRpc3BsYXkiLCJjbGFtcElubGluZVBhbmVsIl0sInNvdXJjZXMiOlsiaW5saW5lUGFuZWwudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnO1xuaW1wb3J0IHsgVW5pZmllZFVJUmVuZGVyZXIgfSBmcm9tICcuLi8uLi9zcmMvdWkvVW5pZmllZFVJUmVuZGVyZXIuanMnO1xuaW1wb3J0IHsgRGlzcGxheSB9IGZyb20gJy4uLy4uL3NyYy91aS9kaXNwbGF5LmpzJztcblxudHlwZSBXcml0YWJsZUxpa2UgPSBOb2RlSlMuV3JpdGVTdHJlYW0gJiB7IGlzVFRZPzogYm9vbGVhbjsgcm93cz86IG51bWJlcjsgY29sdW1ucz86IG51bWJlciB9O1xudHlwZSBSZWFkYWJsZUxpa2UgPSBOb2RlSlMuUmVhZFN0cmVhbSAmIHsgaXNUVFk/OiBib29sZWFuIH07XG5cbmNvbnN0IG1ha2VNb2NrU3RyZWFtID0gKCk6IFdyaXRhYmxlTGlrZSAmIFJlYWRhYmxlTGlrZSA9PiB7XG4gIGNvbnN0IGVtaXR0ZXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIGNvbnN0IHN0cmVhbTogUGFydGlhbDxXcml0YWJsZUxpa2UgJiBSZWFkYWJsZUxpa2U+ID0ge1xuICAgIGlzVFRZOiBmYWxzZSxcbiAgICByb3dzOiAyNCxcbiAgICBjb2x1bW5zOiA4MCxcbiAgICB3cml0ZTogamVzdC5mbigpLFxuICAgIG9uOiBlbWl0dGVyLm9uLmJpbmQoZW1pdHRlciksXG4gICAgb2ZmOiBlbWl0dGVyLm9mZi5iaW5kKGVtaXR0ZXIpLFxuICAgIHJlbW92ZUxpc3RlbmVyOiBlbWl0dGVyLnJlbW92ZUxpc3RlbmVyLmJpbmQoZW1pdHRlciksXG4gICAgb25jZTogZW1pdHRlci5vbmNlLmJpbmQoZW1pdHRlciksXG4gICAgZW1pdDogZW1pdHRlci5lbWl0LmJpbmQoZW1pdHRlciksXG4gICAgbGlzdGVuZXJDb3VudDogZW1pdHRlci5saXN0ZW5lckNvdW50LmJpbmQoZW1pdHRlciksXG4gICAgc2V0TWF4TGlzdGVuZXJzOiBlbWl0dGVyLnNldE1heExpc3RlbmVycy5iaW5kKGVtaXR0ZXIpLFxuICAgIGdldE1heExpc3RlbmVyczogZW1pdHRlci5nZXRNYXhMaXN0ZW5lcnMuYmluZChlbWl0dGVyKSxcbiAgICByZXN1bWU6IGplc3QuZm4oKSxcbiAgICBwYXVzZTogamVzdC5mbigpLFxuICAgIHNldFJhd01vZGU6IGplc3QuZm4oKSxcbiAgfTtcbiAgcmV0dXJuIHN0cmVhbSBhcyBXcml0YWJsZUxpa2UgJiBSZWFkYWJsZUxpa2U7XG59O1xuXG5jb25zdCBtYWtlTGluZXMgPSAoY291bnQ6IG51bWJlcik6IHN0cmluZ1tdID0+XG4gIEFycmF5LmZyb20oeyBsZW5ndGg6IGNvdW50IH0sIChfLCBpbmRleCkgPT4gYGxpbmUtJHtpbmRleCArIDF9YCk7XG5cbmRlc2NyaWJlKCdpbmxpbmUgcGFuZWwgY2xhbXBpbmcnLCAoKSA9PiB7XG4gIHRlc3QoJ1VuaWZpZWRVSVJlbmRlcmVyLmxpbWl0SW5saW5lUGFuZWwgY2FwcyBsaW5lcyBhbmQgcHJlcGVuZHMgb3ZlcmZsb3cgaW5kaWNhdG9yJywgKCkgPT4ge1xuICAgIGNvbnN0IHJlbmRlcmVyID0gbmV3IFVuaWZpZWRVSVJlbmRlcmVyKG1ha2VNb2NrU3RyZWFtKCksIG1ha2VNb2NrU3RyZWFtKCkpO1xuICAgIC8vIFNpbXVsYXRlIGEgdGFsbGVyIHRlcm1pbmFsIHRvIG1ha2UgdGhlIG1hdGggcHJlZGljdGFibGVcbiAgICAocmVuZGVyZXIgYXMgYW55KS5yb3dzID0gMzI7XG5cbiAgICBjb25zdCBpbnB1dCA9IG1ha2VMaW5lcygyMCk7XG4gICAgY29uc3QgcmVzdWx0ID0gKHJlbmRlcmVyIGFzIGFueSkubGltaXRJbmxpbmVQYW5lbChpbnB1dCkgYXMgc3RyaW5nW107XG5cbiAgICBjb25zdCBleHBlY3RlZE1heCA9IE1hdGgubWF4KDQsIE1hdGgubWluKChyZW5kZXJlciBhcyBhbnkpLm1heElubGluZVBhbmVsTGluZXMsIE1hdGgubWF4KDIsIDMyIC0gOCkpKTtcbiAgICBjb25zdCBleHBlY3RlZFRhaWxDb3VudCA9IE1hdGgubWF4KDEsIGV4cGVjdGVkTWF4IC0gMSk7XG5cbiAgICBleHBlY3QocmVzdWx0WzBdKS50b0NvbnRhaW4oJ21vcmUgbGluZXMnKTtcbiAgICBleHBlY3QocmVzdWx0Lmxlbmd0aCkudG9CZShleHBlY3RlZFRhaWxDb3VudCArIDEpO1xuICAgIGV4cGVjdChyZXN1bHQuc2xpY2UoMSkpLnRvRXF1YWwoaW5wdXQuc2xpY2UoLWV4cGVjdGVkVGFpbENvdW50KSk7XG4gIH0pO1xuXG4gIHRlc3QoJ0Rpc3BsYXkuY2xhbXBJbmxpbmVQYW5lbCB0cmltcyBhbmQgYW5ub3RhdGVzIG92ZXJmbG93JywgKCkgPT4ge1xuICAgIGNvbnN0IGRpc3BsYXkgPSBuZXcgRGlzcGxheShtYWtlTW9ja1N0cmVhbSgpLCBtYWtlTW9ja1N0cmVhbSgpKTtcbiAgICBjb25zdCBpbnB1dCA9IG1ha2VMaW5lcyg3MCk7XG5cbiAgICBjb25zdCByZXN1bHQgPSAoZGlzcGxheSBhcyBhbnkpLmNsYW1wSW5saW5lUGFuZWwoaW5wdXQpIGFzIHN0cmluZ1tdO1xuICAgIGNvbnN0IGV4cGVjdGVkVGFpbENvdW50ID0gNjM7IC8vIG1heExpbmVzICg2NCkgbWludXMgdGhlIG92ZXJmbG93IGluZGljYXRvclxuXG4gICAgZXhwZWN0KHJlc3VsdFswXSkudG9Db250YWluKCdtb3JlIGxpbmVzJyk7XG4gICAgZXhwZWN0KHJlc3VsdC5sZW5ndGgpLnRvQmUoZXhwZWN0ZWRUYWlsQ291bnQgKyAxKTtcbiAgICBleHBlY3QocmVzdWx0LnNsaWNlKDEpKS50b0VxdWFsKGlucHV0LnNsaWNlKC1leHBlY3RlZFRhaWxDb3VudCkpO1xuICB9KTtcbn0pO1xuIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQUFBLE9BQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLGtCQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxRQUFBLEdBQUFGLE9BQUE7QUFLQSxNQUFNRyxjQUFjLEdBQUdBLENBQUEsS0FBbUM7RUFDeEQsTUFBTUMsT0FBTyxHQUFHLElBQUlDLG9CQUFZLENBQUMsQ0FBQztFQUNsQyxNQUFNQyxNQUE0QyxHQUFHO0lBQ25EQyxLQUFLLEVBQUUsS0FBSztJQUNaQyxJQUFJLEVBQUUsRUFBRTtJQUNSQyxPQUFPLEVBQUUsRUFBRTtJQUNYQyxLQUFLLEVBQUVDLElBQUksQ0FBQ0MsRUFBRSxDQUFDLENBQUM7SUFDaEJDLEVBQUUsRUFBRVQsT0FBTyxDQUFDUyxFQUFFLENBQUNDLElBQUksQ0FBQ1YsT0FBTyxDQUFDO0lBQzVCVyxHQUFHLEVBQUVYLE9BQU8sQ0FBQ1csR0FBRyxDQUFDRCxJQUFJLENBQUNWLE9BQU8sQ0FBQztJQUM5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