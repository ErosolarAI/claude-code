{"version":3,"names":["_display","require","_globals","describe","originalWrite","originalColumns","writes","createSpinnerStub","cleared","spinner","clear","stop","update","getCleared","beforeEach","process","stdout","write","columns","chunk","_encoding","cb","text","toString","push","afterEach","display","activeSpinner","it","showAssistantMessage","output","join","expect","startsWith","toBe","includes","stopThinking"],"sources":["display.test.ts"],"sourcesContent":["import { display } from '../src/ui/display.js';\nimport { describe, it, beforeEach, afterEach, expect } from '@jest/globals';\n\ntype StubSpinner = {\n  clear: () => void;\n  stop: () => void;\n  update: () => void;\n};\n\ndescribe('Display spinner handling', () => {\n  let originalWrite: typeof process.stdout.write;\n  let originalColumns: number | undefined;\n  let writes: string[];\n\n  const createSpinnerStub = () => {\n    let cleared = 0;\n    const spinner: StubSpinner = {\n      clear: () => {\n        cleared += 1;\n      },\n      stop: () => {\n        cleared += 1;\n      },\n      update: () => {},\n    };\n    return { spinner, getCleared: () => cleared };\n  };\n\n  beforeEach(() => {\n    writes = [];\n    originalWrite = process.stdout.write;\n    originalColumns = process.stdout.columns;\n    process.stdout.columns = 80 as any;\n    process.stdout.write = ((chunk: any, _encoding?: any, cb?: any) => {\n      const text = typeof chunk === 'string' ? chunk : chunk?.toString?.() ?? '';\n      writes.push(text);\n      if (typeof cb === 'function') {\n        cb();\n      }\n      return true;\n    }) as any;\n  });\n\n  afterEach(() => {\n    process.stdout.write = originalWrite;\n    process.stdout.columns = originalColumns as any;\n    (display as any).activeSpinner = null;\n  });\n\n  it('shows assistant message content directly', () => {\n    display.showAssistantMessage('hello world');\n\n    const output = writes.join('');\n    // Note: showAssistantMessage no longer adds a newline by default\n    // The output should start directly with the message content\n    expect(output.startsWith('\\n')).toBe(false);\n    expect(output.includes('hello world')).toBe(true);\n  });\n\n  it('stopThinking is a no-op that does not write output', () => {\n    display.stopThinking(false);\n\n    const output = writes.join('');\n    expect(output).toBe('');\n  });\n});"],"mappings":";;AAAA,IAAAA,QAAA,GAAAC,OAAA;AACA,IAAAC,QAAA,GAAAD,OAAA;AAQA,IAAAE,iBAAQ,EAAC,0BAA0B,EAAE,MAAM;EACzC,IAAIC,aAA0C;EAC9C,IAAIC,eAAmC;EACvC,IAAIC,MAAgB;EAEpB,MAAMC,iBAAiB,GAAGA,CAAA,KAAM;IAC9B,IAAIC,OAAO,GAAG,CAAC;IACf,MAAMC,OAAoB,GAAG;MAC3BC,KAAK,EAAEA,CAAA,KAAM;QACXF,OAAO,IAAI,CAAC;MACd,CAAC;MACDG,IAAI,EAAEA,CAAA,KAAM;QACVH,OAAO,IAAI,CAAC;MACd,CAAC;MACDI,MAAM,EAAEA,CAAA,KAAM,CAAC;IACjB,CAAC;IACD,OAAO;MAAEH,OAAO;MAAEI,UAAU,EAAEA,CAAA,KAAML;IAAQ,CAAC;EAC/C,CAAC;EAED,IAAAM,mBAAU,EAAC,MAAM;IACfR,MAAM,GAAG,EAAE;IACXF,aAAa,GAAGW,OAAO,CAACC,MAAM,CAACC,KAAK;IACpCZ,eAAe,GAAGU,OAAO,CAACC,MAAM,CAACE,OAAO;IACxCH,OAAO,CAACC,MAAM,CAACE,OAAO,GAAG,EAAS;IAClCH,OAAO,CAACC,MAAM,CAACC,KAAK,GAAI,CAACE,KAAU,EAAEC,SAAe,EAAEC,EAAQ,KAAK;MACjE,MAAMC,IAAI,GAAG,OAAOH,KAAK,KAAK,QAAQ,GAAGA,KAAK,GAAGA,KAAK,EAAEI,QAAQ,GAAG,CAAC,IAAI,EAAE;MAC1EjB,MAAM,CAACkB,IAAI,CAACF,IAAI,CAAC;MACjB,IAAI,OAAOD,EAAE,KAAK,UAAU,EAAE;QAC5BA,EAAE,CAAC,CAAC;MACN;MACA,OAAO,IAAI;IACb,CAAS;EACX,CAAC,CAAC;EAEF,IAAAI,kBAAS,EAAC,MAAM;IACdV,OAAO,CAACC,MAAM,CAACC,KAAK,GAAGb,aAAa;IACpCW,OAAO,CAACC,MAAM,CAACE,OAAO,GAAGb,eAAsB;IAC9CqB,gBAAO,CAASC,aAAa,GAAG,IAAI;EACvC,CAAC,CAAC;EAEF,IAAAC,WAAE,EAAC,0CAA0C,EAAE,MAAM;IACnDF,gBAAO,CAACG,oBAAoB,CAAC,aAAa,CAAC;IAE3C,MAAMC,MAAM,GAAGxB,MAAM,CAACyB,IAAI,CAAC,EAAE,CAAC;IAC9B;IACA;IACA,IAAAC,eAAM,EAACF,MAAM,CAACG,UAAU,CAAC,IAAI,CAAC,CAAC,CAACC,IAAI,CAAC,KAAK,CAAC;IAC3C,IAAAF,eAAM,EAACF,MAAM,CAACK,QAAQ,CAAC,aAAa,CAAC,CAAC,CAACD,IAAI,CAAC,IAAI,CAAC;EACnD,CAAC,CAAC;EAEF,IAAAN,WAAE,EAAC,oDAAoD,EAAE,MAAM;IAC7DF,gBAAO,CAACU,YAAY,CAAC,KAAK,CAAC;IAE3B,MAAMN,MAAM,GAAGxB,MAAM,CAACyB,IAAI,CAAC,EAAE,CAAC;IAC9B,IAAAC,eAAM,EAACF,MAAM,CAAC,CAACI,IAAI,CAAC,EAAE,CAAC;EACzB,CAAC,CAAC;AACJ,CAAC,CAAC","ignoreList":[]}