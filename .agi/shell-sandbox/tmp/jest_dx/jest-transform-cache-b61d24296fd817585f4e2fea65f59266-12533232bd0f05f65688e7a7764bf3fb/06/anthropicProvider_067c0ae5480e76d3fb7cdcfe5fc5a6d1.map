{"version":3,"names":["cov_2q7qq425hb","actualCoverage","Anthropic","APIError","RateLimitError","sanitizeErrorMessage","safeErrorMessage","logDebug","TRANSIENT_ERROR_PATTERNS","s","isTransientError","error","f","Error","b","message","toLowerCase","errorName","name","errorCode","code","allText","some","pattern","includes","status","DEFAULT_RATE_LIMIT_RETRIES","DEFAULT_RATE_LIMIT_INITIAL_DELAY_MS","MIN_RATE_LIMIT_DELAY_MS","MAX_RATE_LIMIT_DELAY_MS","DEFAULT_TRANSIENT_RETRIES","supportsExtendedThinking","model","lowerModel","AnthropicMessagesProvider","id","constructor","options","client","apiKey","maxTokens","temperature","rateLimitMaxRetries","Math","max","rateLimitInitialDelayMs","enablePromptCaching","_transientMaxRetries","transientMaxRetries","thinking","undefined","generate","messages","tools","system","chat","convertConversation","requestParams","max_tokens","length","map","mapTool","enabled","budgetTokens","type","budget_tokens","response","executeWithRateLimitRetries","create","usage","mapUsage","stopReason","mapStopReason","stop_reason","toolCalls","content","filter","block","arguments","toRecord","input","textContent","text","join","trim","generateStream","streamParams","stream","currentToolCall","currentToolCallInput","toolCallId","event","content_block","blockType","delta","deltaType","thinkingDelta","jsonDelta","partial_json","JSON","parse","toolCall","finalMessage","getCapabilities","streaming","toolCalling","vision","functionCalling","supportedModalities","contextWindow","cachedModelInfo","getModelInfo","models","retrieve","modelInfo","rawInfo","maxOutputTokens","inputTokenLimit","outputTokenLimit","String","getBackoffDelay","attempt","baseDelay","maxDelay","delay","min","pow","random","operation","rateLimitRetries","transientRetries","delayMs","isRateLimitError","buildRateLimitFailureError","waitMs","determineRetryDelay","headers","round","sleep","cause","sanitizeMessageSequence","sanitized","pendingToolCallIds","Set","role","tc","add","push","has","delete","slice","clear","sanitizedMessages","systemPrompts","contentBlocks","call","tool_use_id","cacheBreakpoint","i","Array","isArray","lastContent","definition","description","input_schema","parameters","properties","value","isPlainRecord","trimmed","parsed","total","input_tokens","output_tokens","inputTokens","outputTokens","totalTokens","fallbackMs","retryAfter","parseRetryAfterHeader","clamp","jitter","randomized","get","numeric","Number","isFinite","parsedDate","Date","now","durationMs","Promise","resolve","setTimeout","retries","baseMessage","retryDetails","advisory","original"],"sources":["anthropicProvider.ts"],"sourcesContent":["import Anthropic from '@anthropic-ai/sdk';\nimport { APIError, RateLimitError } from '@anthropic-ai/sdk/error.js';\nimport type { MessageParam, Tool, ToolResultBlockParam, ToolUseBlock, TextBlock } from '@anthropic-ai/sdk/resources/messages.js';\nimport type {\n  ConversationMessage,\n  LLMProvider,\n  ProviderModelInfo,\n  ProviderResponse,\n  ProviderToolDefinition,\n  ProviderUsage,\n  StopReason,\n  StreamChunk,\n  ToolCallRequest,\n  ThinkingBudgetConfig,\n} from '../core/types.js';\nimport { sanitizeErrorMessage, safeErrorMessage } from '../core/secretStore.js';\nimport { logDebug } from '../utils/debugLogger.js';\n\n// ============================================================================\n// Error Recovery Constants\n// ============================================================================\n\nconst TRANSIENT_ERROR_PATTERNS = [\n  'premature close',\n  'premature end',\n  'unexpected end',\n  'aborted',\n  'fetcherror',\n  'invalid response body',\n  'gunzip',\n  'decompress',\n  'econnreset',\n  'econnrefused',\n  'epipe',\n  'socket hang up',\n  'network',\n  'timeout',\n  '500',\n  '502',\n  '503',\n  '504',\n  'overloaded',\n] as const;\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nfunction isTransientError(error: unknown): boolean {\n  if (!(error instanceof Error)) return false;\n  const message = error.message.toLowerCase();\n  const errorName = error.name?.toLowerCase() ?? '';\n  const errorCode = (error as { code?: string }).code?.toLowerCase() ?? '';\n  const allText = `${message} ${errorName} ${errorCode}`;\n\n  // Check for transient patterns\n  if (TRANSIENT_ERROR_PATTERNS.some(pattern => allText.includes(pattern))) {\n    return true;\n  }\n\n  // Check for 5xx status codes\n  if (error instanceof APIError) {\n    const status = error.status;\n    if (status && status >= 500 && status < 600) {\n      return true;\n    }\n    // Anthropic overloaded error\n    if (status === 529) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\ninterface AnthropicProviderOptions {\n  apiKey: string;\n  model: string;\n  maxTokens?: number;\n  temperature?: number;\n  rateLimitMaxRetries?: number;\n  rateLimitInitialDelayMs?: number;\n  enablePromptCaching?: boolean;\n  /** Maximum retries for transient errors (default: 3) */\n  transientMaxRetries?: number;\n  /** Extended thinking configuration for reasoning models */\n  thinking?: ThinkingBudgetConfig;\n}\n\nconst DEFAULT_RATE_LIMIT_RETRIES = 4;\nconst DEFAULT_RATE_LIMIT_INITIAL_DELAY_MS = 1500;\nconst MIN_RATE_LIMIT_DELAY_MS = 750;\nconst MAX_RATE_LIMIT_DELAY_MS = 40_000;\nconst DEFAULT_TRANSIENT_RETRIES = 3;\n\n/**\n * Check if a model supports extended thinking\n * Claude 4, Sonnet 4.5, Sonnet 3.7, Haiku 4.5, and Opus models support extended thinking\n */\nfunction supportsExtendedThinking(model: string): boolean {\n  const lowerModel = model.toLowerCase();\n  return (\n    lowerModel.includes('claude-4') ||\n    lowerModel.includes('claude-sonnet-4') ||\n    lowerModel.includes('claude-opus-4') ||\n    lowerModel.includes('claude-haiku-4') ||\n    lowerModel.includes('sonnet-4') ||\n    lowerModel.includes('opus-4') ||\n    lowerModel.includes('haiku-4') ||\n    lowerModel.includes('3.7') ||\n    lowerModel.includes('3-7')\n  );\n}\n\nexport class AnthropicMessagesProvider implements LLMProvider {\n  readonly id = 'anthropic';\n  readonly model: string;\n  private readonly client: Anthropic;\n  private readonly maxTokens: number;\n  private readonly temperature: number;\n  private readonly rateLimitMaxRetries: number;\n  private readonly rateLimitInitialDelayMs: number;\n  private readonly enablePromptCaching: boolean;\n  // Reserved for future transient error retry logic\n  private readonly _transientMaxRetries: number;\n  private readonly thinking?: ThinkingBudgetConfig;\n\n  constructor(options: AnthropicProviderOptions) {\n    this.client = new Anthropic({ apiKey: options.apiKey });\n    this.model = options.model;\n    // Default to 16K output tokens to handle extended thinking and code generation\n    this.maxTokens = options.maxTokens ?? 16384;\n    this.temperature = options.temperature ?? 0;\n    this.rateLimitMaxRetries = Math.max(0, options.rateLimitMaxRetries ?? DEFAULT_RATE_LIMIT_RETRIES);\n    this.rateLimitInitialDelayMs = Math.max(\n      MIN_RATE_LIMIT_DELAY_MS,\n      options.rateLimitInitialDelayMs ?? DEFAULT_RATE_LIMIT_INITIAL_DELAY_MS\n    );\n    this.enablePromptCaching = options.enablePromptCaching ?? true;\n    this._transientMaxRetries = options.transientMaxRetries ?? DEFAULT_TRANSIENT_RETRIES;\n    // Only enable thinking for models that support it\n    this.thinking = supportsExtendedThinking(options.model) ? options.thinking : undefined;\n  }\n\n  async generate(messages: ConversationMessage[], tools: ProviderToolDefinition[]): Promise<ProviderResponse> {\n    const { system, chat } = convertConversation(messages, this.enablePromptCaching);\n\n    // Build request with optional extended thinking\n    const requestParams: Parameters<typeof this.client.messages.create>[0] = {\n      model: this.model,\n      max_tokens: this.maxTokens,\n      temperature: this.temperature,\n      messages: chat,\n      ...(system ? { system } : {}),\n      ...(tools.length ? { tools: tools.map(mapTool) } : {}),\n    };\n\n    // Add extended thinking configuration if enabled\n    if (this.thinking?.enabled) {\n      const budgetTokens = this.thinking.budgetTokens ?? 10000;\n      // Extended thinking requires temperature 1 and budget >= 1024\n      (requestParams as unknown as Record<string, unknown>)['thinking'] = {\n        type: 'enabled',\n        budget_tokens: Math.max(1024, budgetTokens),\n      };\n      requestParams.temperature = 1; // Required for extended thinking\n    }\n\n    const response = await this.executeWithRateLimitRetries(() =>\n      this.client.messages.create(requestParams)\n    );\n\n    // Type guard for non-streaming response\n    if (!('usage' in response)) {\n      throw new Error('Unexpected streaming response from non-streaming request');\n    }\n\n    const usage = mapUsage(response.usage);\n    const stopReason = mapStopReason(response.stop_reason);\n\n    const toolCalls = response.content\n      .filter((block): block is ToolUseBlock => block.type === 'tool_use')\n      .map((block) => ({\n        id: block.id,\n        name: block.name,\n        arguments: toRecord(block.input),\n      }));\n\n    const textContent = response.content\n      .filter((block): block is TextBlock => block.type === 'text')\n      .map((block) => block.text)\n      .join('\\n')\n      .trim();\n\n    if (toolCalls.length > 0) {\n      return {\n        type: 'tool_calls',\n        toolCalls,\n        content: textContent,\n        usage,\n        stopReason,\n      };\n    }\n\n    return {\n      type: 'message',\n      content: textContent,\n      usage,\n      stopReason,\n    };\n  }\n\n  async *generateStream(messages: ConversationMessage[], tools: ProviderToolDefinition[]): AsyncIterableIterator<StreamChunk> {\n    const { system, chat } = convertConversation(messages, this.enablePromptCaching);\n\n    // Build stream request with optional extended thinking\n    const streamParams: Parameters<typeof this.client.messages.stream>[0] = {\n      model: this.model,\n      max_tokens: this.maxTokens,\n      temperature: this.temperature,\n      messages: chat,\n      ...(system ? { system } : {}),\n      ...(tools.length ? { tools: tools.map(mapTool) } : {}),\n    };\n\n    // Add extended thinking configuration if enabled\n    if (this.thinking?.enabled) {\n      const budgetTokens = this.thinking.budgetTokens ?? 10000;\n      // Extended thinking requires temperature 1 and budget >= 1024\n      (streamParams as unknown as Record<string, unknown>)['thinking'] = {\n        type: 'enabled',\n        budget_tokens: Math.max(1024, budgetTokens),\n      };\n      streamParams.temperature = 1; // Required for extended thinking\n    }\n\n    const stream = this.client.messages.stream(streamParams);\n\n    let currentToolCall: Partial<ToolCallRequest> | null = null;\n    let currentToolCallInput = '';\n    let toolCallId = '';\n\n    for await (const event of stream) {\n      // Handle different event types\n      if (event.type === 'content_block_start') {\n        const block = event.content_block;\n        const blockType = block.type as string;\n        if (blockType === 'tool_use' && 'id' in block && 'name' in block) {\n          toolCallId = block.id;\n          currentToolCall = {\n            id: block.id,\n            name: block.name,\n            arguments: {},\n          };\n          currentToolCallInput = '';\n        }\n      } else if (event.type === 'content_block_delta') {\n        const delta = event.delta;\n        const deltaType = delta.type as string;\n        if (deltaType === 'text_delta' && 'text' in delta) {\n          yield {\n            type: 'content',\n            content: (delta as { text: string }).text,\n          };\n        } else if (deltaType === 'thinking_delta') {\n          // Stream thinking content as reasoning chunks\n          const thinkingDelta = delta as { thinking?: string };\n          if (thinkingDelta.thinking) {\n            yield {\n              type: 'reasoning',\n              content: thinkingDelta.thinking,\n            };\n          }\n        } else if (deltaType === 'input_json_delta' && currentToolCall) {\n          // accumulate tool input JSON fragments\n          const jsonDelta = delta as { partial_json?: string };\n          if (typeof jsonDelta.partial_json === 'string' && jsonDelta.partial_json) {\n            currentToolCallInput += jsonDelta.partial_json;\n          }\n        }\n      } else if (event.type === 'content_block_stop') {\n        if (currentToolCall && toolCallId) {\n          if (currentToolCallInput.trim()) {\n            try {\n              currentToolCall.arguments = toRecord(JSON.parse(currentToolCallInput));\n            } catch {\n              currentToolCall.arguments = {};\n            }\n          }\n          yield {\n            type: 'tool_call',\n            toolCall: currentToolCall as ToolCallRequest,\n          };\n          currentToolCall = null;\n          currentToolCallInput = '';\n          toolCallId = '';\n        }\n      } else if (event.type === 'message_stop') {\n        const finalMessage = await stream.finalMessage();\n        const usage = mapUsage(finalMessage.usage);\n        const stopReason = mapStopReason(finalMessage.stop_reason);\n        if (usage) {\n          yield {\n            type: 'usage',\n            usage,\n          };\n        }\n        yield {\n          type: 'done',\n          stopReason,\n        };\n      }\n    }\n  }\n\n  getCapabilities() {\n    return {\n      streaming: true,\n      toolCalling: true,\n      vision: this.model.includes('sonnet') || this.model.includes('opus'),\n      functionCalling: true,\n      maxTokens: this.maxTokens,\n      supportedModalities: ['text', 'image'] as ('text' | 'image' | 'audio')[],\n      contextWindow: this.cachedModelInfo?.contextWindow,\n    };\n  }\n\n  private cachedModelInfo: ProviderModelInfo | null = null;\n\n  /**\n   * Fetch model info from Anthropic API\n   * Returns context window and token limits from the real API\n   */\n  async getModelInfo(): Promise<ProviderModelInfo | null> {\n    if (this.cachedModelInfo) {\n      return this.cachedModelInfo;\n    }\n\n    try {\n      // Use the Anthropic models API to get real model info\n      // The models API is accessed via client.models.retrieve()\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const client = this.client as any;\n      if (typeof client.models?.retrieve !== 'function') {\n        // SDK version doesn't support models API\n        return null;\n      }\n\n      const modelInfo = await client.models.retrieve(this.model);\n\n      if (modelInfo) {\n        // Extract context window from model info\n        // Anthropic returns input_context_length or context_window for context window\n        const rawInfo = modelInfo as Record<string, unknown>;\n        const contextWindow =\n          rawInfo['input_context_length'] as number | undefined ??\n          rawInfo['context_window'] as number | undefined;\n\n        const maxOutputTokens =\n          rawInfo['max_output_tokens'] as number | undefined ??\n          rawInfo['output_token_limit'] as number | undefined;\n\n        if (contextWindow) {\n          this.cachedModelInfo = {\n            id: this.model,\n            contextWindow,\n            maxOutputTokens,\n            inputTokenLimit: contextWindow,\n            outputTokenLimit: maxOutputTokens,\n          };\n          return this.cachedModelInfo;\n        }\n      }\n    } catch (error) {\n      // Models API may not be available for all accounts/models\n      // Fall through to return null\n      const message = error instanceof Error ? error.message : String(error);\n      if (!message.includes('404') && !message.includes('not found')) {\n        // Log unexpected errors but don't fail\n        logDebug(`Failed to fetch model info for ${this.model}:`, message);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Calculate exponential backoff delay with jitter\n   */\n  private getBackoffDelay(attempt: number, baseDelay = 1000, maxDelay = 30000): number {\n    const delay = Math.min(baseDelay * Math.pow(2, attempt), maxDelay);\n    return delay + Math.random() * delay * 0.1;\n  }\n\n  private async executeWithRateLimitRetries<T>(operation: () => Promise<T>): Promise<T> {\n    let rateLimitRetries = 0;\n    let transientRetries = 0;\n    let delayMs = this.rateLimitInitialDelayMs;\n\n    // Retry until success or retry limits reached.\n    // eslint-disable-next-line no-constant-condition\n    while (true) {\n      try {\n        return await operation();\n      } catch (error) {\n        // Handle rate limit errors\n        if (isRateLimitError(error)) {\n          if (rateLimitRetries >= this.rateLimitMaxRetries) {\n            throw buildRateLimitFailureError(error, rateLimitRetries);\n          }\n          const waitMs = determineRetryDelay(error.headers, delayMs);\n          // SECURITY: Don't log error details that might contain tokens\n          logDebug(\n            `[anthropic] Rate limited (attempt ${rateLimitRetries + 1}/${this.rateLimitMaxRetries + 1}). ` +\n            `Retrying in ${Math.round(waitMs)}ms...`\n          );\n          await sleep(waitMs);\n          rateLimitRetries += 1;\n          delayMs = Math.min(delayMs * 2, MAX_RATE_LIMIT_DELAY_MS);\n          continue;\n        }\n\n        // Handle transient errors (network, stream, etc.)\n        if (isTransientError(error)) {\n          if (transientRetries >= this._transientMaxRetries) {\n            // SECURITY: Sanitize error message before including in new error\n            throw new Error(\n              `Transient error after ${transientRetries + 1} attempts: ${safeErrorMessage(error)}`,\n              { cause: error }\n            );\n          }\n          const waitMs = this.getBackoffDelay(transientRetries);\n          // SECURITY: Sanitize error message to prevent token leakage\n          logDebug(\n            `[anthropic] Transient error (attempt ${transientRetries + 1}/${this._transientMaxRetries + 1}): ` +\n            `${safeErrorMessage(error)}. Retrying in ${Math.round(waitMs)}ms...`\n          );\n          await sleep(waitMs);\n          transientRetries += 1;\n          continue;\n        }\n\n        // Non-retryable error\n        throw error;\n      }\n    }\n  }\n}\n\n/**\n * Validate and sanitize message sequence to ensure tool messages have preceding tool_calls.\n * Anthropic API requires tool_result blocks to reference preceding tool_use blocks.\n */\nfunction sanitizeMessageSequence(messages: ConversationMessage[]): ConversationMessage[] {\n  const sanitized: ConversationMessage[] = [];\n  const pendingToolCallIds = new Set<string>();\n\n  for (const message of messages) {\n    if (message.role === 'assistant' && message.toolCalls?.length) {\n      // Track tool call IDs that need responses\n      for (const tc of message.toolCalls) {\n        if (tc.id) pendingToolCallIds.add(tc.id);\n      }\n      sanitized.push(message);\n    } else if (message.role === 'tool') {\n      // Only include tool messages if we have a pending tool call for them\n      const toolCallId = message.toolCallId;\n      if (toolCallId && pendingToolCallIds.has(toolCallId)) {\n        pendingToolCallIds.delete(toolCallId);\n        sanitized.push(message);\n      } else {\n        // ORPHANED TOOL MESSAGE - skip it to prevent API error\n        logDebug(`[AnthropicProvider] Skipping orphaned tool message (no preceding tool_use): ${toolCallId?.slice(0, 20) || 'no-id'}`);\n      }\n    } else {\n      // system, user, assistant without tool_calls - pass through\n      if (message.role === 'user') {\n        pendingToolCallIds.clear();\n      }\n      sanitized.push(message);\n    }\n  }\n\n  return sanitized;\n}\n\nfunction convertConversation(\n  messages: ConversationMessage[],\n  enablePromptCaching = false\n): { system: string | null; chat: MessageParam[] } {\n  // CRITICAL: Sanitize message sequence to prevent orphaned tool_result blocks\n  const sanitizedMessages = sanitizeMessageSequence(messages);\n\n  const systemPrompts: string[] = [];\n  const chat: MessageParam[] = [];\n\n  for (const message of sanitizedMessages) {\n    switch (message.role) {\n      case 'system': {\n        systemPrompts.push(message.content);\n        break;\n      }\n      case 'user': {\n        chat.push({\n          role: 'user',\n          content: [{ type: 'text', text: message.content }],\n        });\n        break;\n      }\n      case 'assistant': {\n        const contentBlocks: MessageParam['content'] = [];\n        if (message.content.trim().length > 0) {\n          contentBlocks.push({ type: 'text', text: message.content });\n        }\n        for (const call of message.toolCalls ?? []) {\n          contentBlocks.push({\n            type: 'tool_use',\n            id: call.id,\n            name: call.name,\n            input: call.arguments,\n          });\n        }\n        chat.push({\n          role: 'assistant',\n          content: contentBlocks.length ? contentBlocks : [{ type: 'text', text: '' }],\n        });\n        break;\n      }\n      case 'tool': {\n        const block: ToolResultBlockParam = {\n          type: 'tool_result',\n          tool_use_id: message.toolCallId,\n          content: [{ type: 'text', text: message.content }],\n        };\n        chat.push({\n          role: 'user',\n          content: [block],\n        });\n        break;\n      }\n      default:\n        break;\n    }\n  }\n\n  // Add cache control breakpoints to optimize costs\n  // Cache the first few user messages (usually contain system context)\n  if (enablePromptCaching && chat.length > 2) {\n    const cacheBreakpoint = Math.min(2, chat.length - 1);\n    for (let i = 0; i < cacheBreakpoint; i++) {\n      const message = chat[i];\n      if (message && message.role === 'user' && Array.isArray(message.content)) {\n        const lastContent = message.content[message.content.length - 1];\n        if (lastContent && 'text' in lastContent) {\n          (lastContent as unknown as Record<string, unknown>)['cache_control'] = { type: 'ephemeral' };\n        }\n      }\n    }\n  }\n\n  return {\n    system: systemPrompts.length ? systemPrompts.join('\\n\\n') : null,\n    chat,\n  };\n}\n\nfunction mapTool(definition: ProviderToolDefinition): Tool {\n  return {\n    name: definition.name,\n    description: definition.description,\n    input_schema: (definition.parameters ?? {\n      type: 'object',\n      properties: {},\n    }) as Tool['input_schema'],\n  };\n}\n\nfunction toRecord(value: unknown): Record<string, unknown> {\n  if (isPlainRecord(value)) {\n    return value;\n  }\n  if (typeof value === 'string') {\n    const trimmed = value.trim();\n    if (!trimmed) {\n      return {};\n    }\n    try {\n      const parsed = JSON.parse(trimmed);\n      return isPlainRecord(parsed) ? parsed : {};\n    } catch {\n      return {};\n    }\n  }\n  return {};\n}\n\nfunction isPlainRecord(value: unknown): value is Record<string, unknown> {\n  return typeof value === 'object' && value !== null && !Array.isArray(value);\n}\n\nfunction mapUsage(usage?: { input_tokens?: number; output_tokens?: number } | null): ProviderUsage | null {\n  if (!usage) {\n    return null;\n  }\n  const total = typeof usage.input_tokens === 'number' && typeof usage.output_tokens === 'number'\n    ? usage.input_tokens + usage.output_tokens\n    : undefined;\n  return {\n    inputTokens: usage.input_tokens,\n    outputTokens: usage.output_tokens,\n    totalTokens: total,\n  };\n}\n\n/**\n * Map Anthropic's stop_reason to our StopReason type\n * Critical for agentic loop control - determines if model wants to continue\n */\nfunction mapStopReason(stopReason: string | null | undefined): StopReason | undefined {\n  if (!stopReason) return undefined;\n  switch (stopReason) {\n    case 'end_turn':\n      return 'end_turn';\n    case 'tool_use':\n      return 'tool_use';\n    case 'max_tokens':\n      return 'max_tokens';\n    case 'stop_sequence':\n      return 'stop_sequence';\n    default:\n      return undefined;\n  }\n}\n\nfunction isRateLimitError(error: unknown): error is APIError {\n  if (error instanceof RateLimitError) {\n    return true;\n  }\n  if (error instanceof APIError && error.status === 429) {\n    return true;\n  }\n  return typeof error === 'object' && error !== null && 'status' in error && (error as { status?: number }).status === 429;\n}\n\nfunction determineRetryDelay(headers: HeadersLike, fallbackMs: number): number {\n  const retryAfter = parseRetryAfterHeader(headers);\n  if (retryAfter !== null) {\n    return clamp(retryAfter, MIN_RATE_LIMIT_DELAY_MS, MAX_RATE_LIMIT_DELAY_MS);\n  }\n  const jitter = fallbackMs * 0.25;\n  const randomized = fallbackMs + (Math.random() * (2 * jitter) - jitter);\n  return clamp(Math.round(randomized), MIN_RATE_LIMIT_DELAY_MS, MAX_RATE_LIMIT_DELAY_MS);\n}\n\nfunction parseRetryAfterHeader(headers: HeadersLike): number | null {\n  if (!headers || typeof headers.get !== 'function') {\n    return null;\n  }\n  const retryAfter = headers.get('retry-after');\n  if (!retryAfter) {\n    return null;\n  }\n  const numeric = Number(retryAfter);\n  if (Number.isFinite(numeric) && numeric >= 0) {\n    return numeric * 1000;\n  }\n  const parsedDate = Date.parse(retryAfter);\n  if (Number.isFinite(parsedDate)) {\n    return Math.max(0, parsedDate - Date.now());\n  }\n  return null;\n}\n\nfunction clamp(value: number, min: number, max: number): number {\n  return Math.max(min, Math.min(max, value));\n}\n\nasync function sleep(durationMs: number): Promise<void> {\n  await new Promise((resolve) => setTimeout(resolve, durationMs));\n}\n\nfunction buildRateLimitFailureError(error: APIError, retries: number): Error {\n  const baseMessage =\n    'Anthropic rejected the request because the per-minute token rate limit was exceeded.';\n  const retryDetails =\n    retries > 0 ? ` Waited and retried ${retries} time${retries === 1 ? '' : 's'} without success.` : '';\n  const advisory =\n    ' Reduce the prompt size or wait for usage to reset before trying again. ' +\n    'See https://docs.claude.com/en/api/rate-limits for quota guidance.';\n  // SECURITY: Sanitize original error message to prevent token leakage\n  const original = error.message ? `\\nOriginal message: ${sanitizeErrorMessage(error.message)}` : '';\n  return new Error(`${baseMessage}${retryDetails}${advisory}${original}`, {\n    cause: error,\n  });\n}\n\ntype HeadersLike = {\n  get?: (header: string) => string | null | undefined;\n} | null | undefined;\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}