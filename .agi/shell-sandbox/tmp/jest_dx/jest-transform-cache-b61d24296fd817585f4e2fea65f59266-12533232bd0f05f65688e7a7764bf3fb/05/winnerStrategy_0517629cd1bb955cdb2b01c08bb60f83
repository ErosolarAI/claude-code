43d770f1d22f5b154808cf77db297b72
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.resolveWinner = resolveWinner;
/**
 * Resolve the winner for an upgrade step using tournament rankings when present,
 * otherwise falling back to the provided pickWinner strategy.
 */
function resolveWinner(input, pickWinner) {
  const primary = input.variantResults.primary;
  const refiner = input.variantResults.refiner;
  if (input.tournamentOutcome?.ranked?.length) {
    const top = input.tournamentOutcome.ranked[0];
    const topVariant = top.candidateId === 'refiner' && refiner ? 'refiner' : 'primary';
    const winner = topVariant === 'refiner' && refiner ? refiner : primary;
    return {
      winner,
      winnerVariant: topVariant
    };
  }
  return pickWinner(input.modeDefinition, primary, refiner);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJyZXNvbHZlV2lubmVyIiwiaW5wdXQiLCJwaWNrV2lubmVyIiwicHJpbWFyeSIsInZhcmlhbnRSZXN1bHRzIiwicmVmaW5lciIsInRvdXJuYW1lbnRPdXRjb21lIiwicmFua2VkIiwibGVuZ3RoIiwidG9wIiwidG9wVmFyaWFudCIsImNhbmRpZGF0ZUlkIiwid2lubmVyIiwid2lubmVyVmFyaWFudCIsIm1vZGVEZWZpbml0aW9uIl0sInNvdXJjZXMiOlsid2lubmVyU3RyYXRlZ3kudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBUb3VybmFtZW50T3V0Y29tZSB9IGZyb20gJy4vZHVhbFRvdXJuYW1lbnQuanMnO1xuaW1wb3J0IHR5cGUge1xuICBSZXBvVXBncmFkZU1vZGVEZWZpbml0aW9uLFxuICBVcGdyYWRlU3RlcFJlc3VsdCxcbiAgVXBncmFkZVZhcmlhbnQsXG59IGZyb20gJy4vcmVwb1VwZ3JhZGVPcmNoZXN0cmF0b3IuanMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFdpbm5lclJlc29sdXRpb25JbnB1dCB7XG4gIG1vZGVEZWZpbml0aW9uOiBSZXBvVXBncmFkZU1vZGVEZWZpbml0aW9uO1xuICB2YXJpYW50UmVzdWx0czogUGFydGlhbDxSZWNvcmQ8VXBncmFkZVZhcmlhbnQsIFVwZ3JhZGVTdGVwUmVzdWx0Pj47XG4gIHRvdXJuYW1lbnRPdXRjb21lOiBUb3VybmFtZW50T3V0Y29tZSB8IG51bGw7XG59XG5cbmV4cG9ydCB0eXBlIFBpY2tXaW5uZXJGbiA9IChcbiAgZGVmaW5pdGlvbjogUmVwb1VwZ3JhZGVNb2RlRGVmaW5pdGlvbixcbiAgcHJpbWFyeTogVXBncmFkZVN0ZXBSZXN1bHQsXG4gIHJlZmluZXI/OiBVcGdyYWRlU3RlcFJlc3VsdFxuKSA9PiB7IHdpbm5lcjogVXBncmFkZVN0ZXBSZXN1bHQ7IHdpbm5lclZhcmlhbnQ6IFVwZ3JhZGVWYXJpYW50IH07XG5cbi8qKlxuICogUmVzb2x2ZSB0aGUgd2lubmVyIGZvciBhbiB1cGdyYWRlIHN0ZXAgdXNpbmcgdG91cm5hbWVudCByYW5raW5ncyB3aGVuIHByZXNlbnQsXG4gKiBvdGhlcndpc2UgZmFsbGluZyBiYWNrIHRvIHRoZSBwcm92aWRlZCBwaWNrV2lubmVyIHN0cmF0ZWd5LlxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVzb2x2ZVdpbm5lcihcbiAgaW5wdXQ6IFdpbm5lclJlc29sdXRpb25JbnB1dCxcbiAgcGlja1dpbm5lcjogUGlja1dpbm5lckZuXG4pOiB7IHdpbm5lcjogVXBncmFkZVN0ZXBSZXN1bHQ7IHdpbm5lclZhcmlhbnQ6IFVwZ3JhZGVWYXJpYW50IH0ge1xuICBjb25zdCBwcmltYXJ5ID0gaW5wdXQudmFyaWFudFJlc3VsdHMucHJpbWFyeSBhcyBVcGdyYWRlU3RlcFJlc3VsdDtcbiAgY29uc3QgcmVmaW5lciA9IGlucHV0LnZhcmlhbnRSZXN1bHRzLnJlZmluZXI7XG5cbiAgaWYgKGlucHV0LnRvdXJuYW1lbnRPdXRjb21lPy5yYW5rZWQ/Lmxlbmd0aCkge1xuICAgIGNvbnN0IHRvcCA9IGlucHV0LnRvdXJuYW1lbnRPdXRjb21lLnJhbmtlZFswXTtcbiAgICBjb25zdCB0b3BWYXJpYW50OiBVcGdyYWRlVmFyaWFudCA9IHRvcC5jYW5kaWRhdGVJZCA9PT0gJ3JlZmluZXInICYmIHJlZmluZXIgPyAncmVmaW5lcicgOiAncHJpbWFyeSc7XG4gICAgY29uc3Qgd2lubmVyID0gdG9wVmFyaWFudCA9PT0gJ3JlZmluZXInICYmIHJlZmluZXIgPyByZWZpbmVyIDogcHJpbWFyeTtcbiAgICByZXR1cm4geyB3aW5uZXIsIHdpbm5lclZhcmlhbnQ6IHRvcFZhcmlhbnQgfTtcbiAgfVxuXG4gIHJldHVybiBwaWNrV2lubmVyKGlucHV0Lm1vZGVEZWZpbml0aW9uLCBwcmltYXJ5LCByZWZpbmVyKTtcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBbUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ08sU0FBU0EsYUFBYUEsQ0FDM0JDLEtBQTRCLEVBQzVCQyxVQUF3QixFQUNzQztFQUM5RCxNQUFNQyxPQUFPLEdBQUdGLEtBQUssQ0FBQ0csY0FBYyxDQUFDRCxPQUE0QjtFQUNqRSxNQUFNRSxPQUFPLEdBQUdKLEtBQUssQ0FBQ0csY0FBYyxDQUFDQyxPQUFPO0VBRTVDLElBQUlKLEtBQUssQ0FBQ0ssaUJBQWlCLEVBQUVDLE1BQU0sRUFBRUMsTUFBTSxFQUFFO0lBQzNDLE1BQU1DLEdBQUcsR0FBR1IsS0FBSyxDQUFDSyxpQkFBaUIsQ0FBQ0MsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUM3QyxNQUFNRyxVQUEwQixHQUFHRCxHQUFHLENBQUNFLFdBQVcsS0FBSyxTQUFTLElBQUlOLE9BQU8sR0FBRyxTQUFTLEdBQUcsU0FBUztJQUNuRyxNQUFNTyxNQUFNLEdBQUdGLFVBQVUsS0FBSyxTQUFTLElBQUlMLE9BQU8sR0FBR0EsT0FBTyxHQUFHRixPQUFPO0lBQ3RFLE9BQU87TUFBRVMsTUFBTTtNQUFFQyxhQUFhLEVBQUVIO0lBQVcsQ0FBQztFQUM5QztFQUVBLE9BQU9SLFVBQVUsQ0FBQ0QsS0FBSyxDQUFDYSxjQUFjLEVBQUVYLE9BQU8sRUFBRUUsT0FBTyxDQUFDO0FBQzNEIiwiaWdub3JlTGlzdCI6W119