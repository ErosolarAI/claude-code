{"version":3,"names":["resolveWinner","input","pickWinner","primary","variantResults","refiner","tournamentOutcome","ranked","length","top","topVariant","candidateId","winner","winnerVariant","modeDefinition"],"sources":["winnerStrategy.ts"],"sourcesContent":["import type { TournamentOutcome } from './dualTournament.js';\nimport type {\n  RepoUpgradeModeDefinition,\n  UpgradeStepResult,\n  UpgradeVariant,\n} from './repoUpgradeOrchestrator.js';\n\nexport interface WinnerResolutionInput {\n  modeDefinition: RepoUpgradeModeDefinition;\n  variantResults: Partial<Record<UpgradeVariant, UpgradeStepResult>>;\n  tournamentOutcome: TournamentOutcome | null;\n}\n\nexport type PickWinnerFn = (\n  definition: RepoUpgradeModeDefinition,\n  primary: UpgradeStepResult,\n  refiner?: UpgradeStepResult\n) => { winner: UpgradeStepResult; winnerVariant: UpgradeVariant };\n\n/**\n * Resolve the winner for an upgrade step using tournament rankings when present,\n * otherwise falling back to the provided pickWinner strategy.\n */\nexport function resolveWinner(\n  input: WinnerResolutionInput,\n  pickWinner: PickWinnerFn\n): { winner: UpgradeStepResult; winnerVariant: UpgradeVariant } {\n  const primary = input.variantResults.primary as UpgradeStepResult;\n  const refiner = input.variantResults.refiner;\n\n  if (input.tournamentOutcome?.ranked?.length) {\n    const top = input.tournamentOutcome.ranked[0];\n    const topVariant: UpgradeVariant = top.candidateId === 'refiner' && refiner ? 'refiner' : 'primary';\n    const winner = topVariant === 'refiner' && refiner ? refiner : primary;\n    return { winner, winnerVariant: topVariant };\n  }\n\n  return pickWinner(input.modeDefinition, primary, refiner);\n}\n"],"mappings":";;;;;;AAmBA;AACA;AACA;AACA;AACO,SAASA,aAAaA,CAC3BC,KAA4B,EAC5BC,UAAwB,EACsC;EAC9D,MAAMC,OAAO,GAAGF,KAAK,CAACG,cAAc,CAACD,OAA4B;EACjE,MAAME,OAAO,GAAGJ,KAAK,CAACG,cAAc,CAACC,OAAO;EAE5C,IAAIJ,KAAK,CAACK,iBAAiB,EAAEC,MAAM,EAAEC,MAAM,EAAE;IAC3C,MAAMC,GAAG,GAAGR,KAAK,CAACK,iBAAiB,CAACC,MAAM,CAAC,CAAC,CAAC;IAC7C,MAAMG,UAA0B,GAAGD,GAAG,CAACE,WAAW,KAAK,SAAS,IAAIN,OAAO,GAAG,SAAS,GAAG,SAAS;IACnG,MAAMO,MAAM,GAAGF,UAAU,KAAK,SAAS,IAAIL,OAAO,GAAGA,OAAO,GAAGF,OAAO;IACtE,OAAO;MAAES,MAAM;MAAEC,aAAa,EAAEH;IAAW,CAAC;EAC9C;EAEA,OAAOR,UAAU,CAACD,KAAK,CAACa,cAAc,EAAEX,OAAO,EAAEE,OAAO,CAAC;AAC3D","ignoreList":[]}