{"version":3,"names":["_dualTournament","require","_repoUpgradeOrchestrator","buildEvaluatorConfig","module","telemetry","repoType","getRepoTypeFromModule","rewardWeights","DEFAULT_HUMAN_REWARD_WEIGHTS","hardWeight","qualityWeight","rewardWeight","alpha","beta","gamma","telemetrySnapshot","get","total","Math","max","winsPrimary","winsRefiner","bias","clampScore","evaluators","id","label","weight","kind","scope","join","toLowerCase","test"],"sources":["tournamentStrategy.ts"],"sourcesContent":["import type { RepoUpgradeModule } from './repoUpgradeOrchestrator.js';\nimport { DEFAULT_HUMAN_REWARD_WEIGHTS, type HumanRewardWeights } from './dualTournament.js';\nimport { clampScore } from './repoUpgradeOrchestrator.js';\n\nexport interface EvaluatorConfig {\n  rewardWeights: HumanRewardWeights;\n  evaluators: Array<{\n    id: string;\n    label: string;\n    weight: number;\n    kind: 'hard' | 'soft' | 'hybrid';\n    elo?: number;\n  }>;\n}\n\nexport function buildEvaluatorConfig(\n  module: RepoUpgradeModule,\n  telemetry?: Map<string, TelemetrySnapshot>\n): EvaluatorConfig {\n  const repoType = getRepoTypeFromModule(module);\n\n  // Default: balanced weights\n  let rewardWeights = DEFAULT_HUMAN_REWARD_WEIGHTS;\n  let hardWeight = 1.35;\n  let qualityWeight = 1.0;\n  let rewardWeight = 0.9;\n\n  if (repoType === 'tests') {\n    rewardWeights = { alpha: 0.7, beta: 0.15, gamma: 0.15 };\n    hardWeight = 1.55;\n    qualityWeight = 0.9;\n    rewardWeight = 0.85;\n  } else if (repoType === 'docs') {\n    rewardWeights = { alpha: 0.45, beta: 0.3, gamma: 0.25 };\n    hardWeight = 1.0;\n    qualityWeight = 1.2;\n    rewardWeight = 1.0;\n  } else if (repoType === 'refactor') {\n    rewardWeights = { alpha: 0.55, beta: 0.25, gamma: 0.2 };\n    hardWeight = 1.25;\n    qualityWeight = 1.15;\n    rewardWeight = 0.95;\n  }\n\n  const telemetrySnapshot = telemetry?.get(repoType);\n  if (telemetrySnapshot) {\n    const total = Math.max(1, telemetrySnapshot.winsPrimary + telemetrySnapshot.winsRefiner);\n    const bias = (telemetrySnapshot.winsPrimary - telemetrySnapshot.winsRefiner) / total;\n    if (bias > 0.1) {\n      hardWeight = clampScore(hardWeight + 0.1, 0.8, 2);\n      rewardWeights = {\n        alpha: clampScore((rewardWeights.alpha ?? 0.6) + 0.05, 0, 1),\n        beta: rewardWeights.beta,\n        gamma: clampScore((rewardWeights.gamma ?? 0.2) - 0.02, 0, 1),\n      };\n    } else if (bias < -0.1) {\n      qualityWeight = clampScore(qualityWeight + 0.1, 0.8, 2);\n      rewardWeight = clampScore(rewardWeight + 0.05, 0.5, 1.5);\n      rewardWeights = {\n        alpha: clampScore((rewardWeights.alpha ?? 0.6) - 0.05, 0, 1),\n        beta: clampScore((rewardWeights.beta ?? 0.25) + 0.05, 0, 1),\n        gamma: clampScore((rewardWeights.gamma ?? 0.2) + 0.02, 0, 1),\n      };\n    }\n  }\n\n  return {\n    rewardWeights,\n    evaluators: [\n      { id: 'hard-metrics', label: 'Hard metrics', weight: hardWeight, kind: 'hard' },\n      { id: 'quality', label: 'Quality', weight: qualityWeight, kind: 'hybrid' },\n      { id: 'reward-signal', label: 'Reward signal', weight: rewardWeight, kind: 'hybrid' },\n    ],\n  };\n}\n\nexport interface TelemetrySnapshot {\n  winsPrimary: number;\n  winsRefiner: number;\n}\n\nfunction getRepoTypeFromModule(module: RepoUpgradeModule): string {\n  const scope = (module.scope || []).join(' ').toLowerCase();\n  const label = (module.label || '').toLowerCase();\n  if (/\\btest|__tests__|spec\\b/i.test(scope) || /\\btest\\b/i.test(label)) return 'tests';\n  if (/\\bdocs?\\b/i.test(scope) || /\\bdoc\\b/i.test(label)) return 'docs';\n  if (/\\brefactor|cleanup|source\\b/i.test(scope + ' ' + label)) return 'refactor';\n  return 'general';\n}\n"],"mappings":"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","ignoreList":[]}