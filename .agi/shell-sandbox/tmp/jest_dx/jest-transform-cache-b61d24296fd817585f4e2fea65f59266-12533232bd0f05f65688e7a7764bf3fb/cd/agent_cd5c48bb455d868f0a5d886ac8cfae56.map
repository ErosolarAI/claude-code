{"version":3,"names":["cov_11bj2euw36","actualCoverage","AGENT_CONTRACT_VERSION","exports","s"],"sources":["agent.ts"],"sourcesContent":["/**\n * Agent Contract v1.0\n * \n * Stable interface for agent interaction across all frontends.\n * Breaking changes require a new version (v2/).\n */\n\nexport const AGENT_CONTRACT_VERSION = '1.0.0';\n\n/**\n * Event types emitted during agent execution\n */\nexport type AgentEventType =\n  | 'message.start'\n  | 'message.delta'\n  | 'message.complete'\n  | 'tool.start'\n  | 'tool.complete'\n  | 'tool.error'\n  | 'edit.explanation'\n  | 'reasoning'\n  | 'error'\n  | 'usage'\n  | 'provider.fallback';\n\n/**\n * Base event structure\n */\nexport interface AgentEvent {\n  type: AgentEventType;\n  timestamp: number;\n}\n\n/**\n * Message events\n */\nexport interface MessageStartEvent extends AgentEvent {\n  type: 'message.start';\n}\n\nexport interface MessageDeltaEvent extends AgentEvent {\n  type: 'message.delta';\n  content: string;\n  isFinal: boolean;\n}\n\nexport interface MessageCompleteEvent extends AgentEvent {\n  type: 'message.complete';\n  content: string;\n  elapsedMs: number;\n}\n\n/**\n * Tool execution events\n */\nexport interface ToolStartEvent extends AgentEvent {\n  type: 'tool.start';\n  toolName: string;\n  toolCallId: string;\n  parameters: Record<string, unknown>;\n}\n\nexport interface ToolCompleteEvent extends AgentEvent {\n  type: 'tool.complete';\n  toolName: string;\n  toolCallId: string;\n  result: string;\n}\n\nexport interface ToolErrorEvent extends AgentEvent {\n  type: 'tool.error';\n  toolName: string;\n  toolCallId: string;\n  error: string;\n}\n\nexport interface EditExplanationEvent extends AgentEvent {\n  type: 'edit.explanation';\n  content: string;\n  files?: string[];\n  toolName?: string;\n  toolCallId?: string;\n}\n\n/**\n * Reasoning/thought event - model's internal thinking process\n */\nexport interface ReasoningEvent extends AgentEvent {\n  type: 'reasoning';\n  content: string;\n}\n\n/**\n * Error and usage events\n */\nexport interface ErrorEvent extends AgentEvent {\n  type: 'error';\n  error: string;\n  code?: string;\n}\n\nexport interface UsageEvent extends AgentEvent {\n  type: 'usage';\n  inputTokens?: number;\n  outputTokens?: number;\n  totalTokens?: number;\n}\n\n/**\n * Provider fallback event - emitted when switching to another provider due to error\n */\nexport interface ProviderFallbackEvent extends AgentEvent {\n  type: 'provider.fallback';\n  /** Provider that failed */\n  fromProvider: string;\n  /** Model that failed */\n  fromModel: string;\n  /** Provider being switched to */\n  toProvider: string;\n  /** Model being switched to */\n  toModel: string;\n  /** Reason for fallback */\n  reason: string;\n  /** Original error message */\n  error: string;\n}\n\n/**\n * Union of all event types\n */\nexport type AgentEventUnion =\n  | MessageStartEvent\n  | MessageDeltaEvent\n  | MessageCompleteEvent\n  | ToolStartEvent\n  | ToolCompleteEvent\n  | ToolErrorEvent\n  | EditExplanationEvent\n  | ReasoningEvent\n  | ErrorEvent\n  | UsageEvent\n  | ProviderFallbackEvent;\n\n/**\n * Model selection configuration\n */\nexport interface ModelConfig {\n  provider: string;\n  model: string;\n  temperature?: number;\n  maxTokens?: number;\n}\n\n/**\n * Capability manifest\n */\nexport interface CapabilityManifest {\n  contractVersion: string;\n  profile: string;\n  model: ModelConfig;\n  tools: ToolCapability[];\n  features: string[];\n}\n\nexport interface ToolCapability {\n  name: string;\n  description: string;\n  category: string;\n}\n\n/**\n * Core agent controller interface\n * \n * This is the stable contract that all frontends depend on.\n */\nexport interface IAgentController {\n  /**\n   * Send a message and receive streaming events\n   */\n  send(message: string): AsyncIterableIterator<AgentEventUnion>;\n\n  /**\n   * Switch the active model\n   */\n  switchModel(config: ModelConfig): Promise<void>;\n\n  /**\n   * Get current capabilities\n   */\n  getCapabilities(): CapabilityManifest;\n\n  /**\n   * Register a tool suite\n   */\n  registerToolSuite(suiteId: string, suite: unknown): void;\n\n  /**\n   * Unregister a tool suite\n   */\n  unregisterToolSuite(suiteId: string): void;\n\n  /**\n   * Get conversation history\n   */\n  getHistory(): ConversationMessage[];\n\n  /**\n   * Clear conversation history\n   */\n  clearHistory(): void;\n}\n\n/**\n * Conversation message structure\n */\nexport interface ConversationMessage {\n  role: 'system' | 'user' | 'assistant' | 'tool';\n  content: string;\n  toolCalls?: Array<{\n    id: string;\n    name: string;\n    arguments: Record<string, unknown>;\n  }>;\n  toolCallId?: string;\n  name?: string;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAeY;IAAAA,cAAA,YAAAA,CAAA;MAAA,OAAAC,cAAA;IAAA;EAAA;EAAA,OAAAA,cAAA;AAAA;AAAAD,cAAA;AAfZ;AACA;AACA;AACA;AACA;AACA;;AAEO,MAAME,sBAAsB;AAAA;AAAAC,OAAA,CAAAD,sBAAA,IAAAF,cAAA,GAAAI,CAAA,OAAG,OAAO;;AAE7C;AACA;AACA;;AAcA;AACA;AACA;;AAMA;AACA;AACA;;AAiBA;AACA;AACA;;AA8BA;AACA;AACA;;AAMA;AACA;AACA;;AAcA;AACA;AACA;;AAiBA;AACA;AACA;;AAcA;AACA;AACA;;AAQA;AACA;AACA;;AAeA;AACA;AACA;AACA;AACA;;AAsCA;AACA;AACA","ignoreList":[]}