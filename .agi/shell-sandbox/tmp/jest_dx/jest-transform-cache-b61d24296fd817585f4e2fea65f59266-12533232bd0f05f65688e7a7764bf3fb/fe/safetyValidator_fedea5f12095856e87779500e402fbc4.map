{"version":3,"names":["MAX_TARGET_LENGTH","MAX_PORT","MIN_PORT","MAX_COMMAND_LENGTH","MAX_URL_LENGTH","DANGEROUS_PATTERNS","INTERNAL_IP_RANGES","validateBashCommand","command","valid","error","Error","warnings","length","pattern","test","push","validateTarget","target","ipRegex","hostnameRegex","validatePorts","ports","portList","split","port","includes","startStr","endStr","start","parseInt","trim","end","isNaN","portNum","validateUrl","url","parsed","URL","protocol","hostnameResult","hostname","validateToolArgs","toolName","args","constraints","key","constraint","Object","entries","value","undefined","matchesType","type","num","max","min","SmartFixer","fixDangerousCommand","fixed","changes","replace","fixResourceLimits","newValue","Math","floor","fixValidationErrors","Number","toLowerCase","exports","AutoFixValidator","constructor","autoFix","enabled","setAutoFix","validate","validator","result"],"sources":["safetyValidator.ts"],"sourcesContent":["/**\n * Safety Validator - Enhanced security validation for tool arguments.\n * Implements comprehensive input validation and security controls.\n */\n\nexport interface ValidationResult {\n  valid: boolean;\n  error?: Error;\n  warnings: string[];\n  autoFix?: {\n    available: boolean;\n    apply: () => unknown;\n    description: string;\n  };\n}\n\ninterface ToolConstraint {\n  type: 'number' | 'string' | 'boolean';\n  max?: number;\n  min?: number;\n  pattern?: RegExp;\n  allowedValues?: string[];\n}\n\n// Security constants\nconst MAX_TARGET_LENGTH = 253;\nconst MAX_PORT = 65535;\nconst MIN_PORT = 1;\nconst MAX_COMMAND_LENGTH = 4096;\nconst MAX_URL_LENGTH = 2048;\n\n// Dangerous patterns to block\nconst DANGEROUS_PATTERNS = [\n  /[\\x00-\\x1F\\x7F]/, // Control characters\n  /[|&;`$<>(){}[\\]]/, // Shell metacharacters (when used inappropriately)\n  /\\b(rm\\s+-rf\\s+\\/|rm\\s+-rf\\s+--no-preserve-root\\s+\\/)/i, // Dangerous rm commands\n  /\\b(chmod\\s+777\\s+\\/|chmod\\s+-R\\s+777\\s+\\/)/i, // Dangerous permission changes\n  /\\b(dd\\s+if=\\/dev\\/|dd\\s+of=\\/dev\\/)/i, // Dangerous dd commands\n  /\\b(mkfs\\s+|format\\s+)/i, // Filesystem operations\n];\n\n// Internal IP ranges to block (RFC 1918, localhost, etc.)\nconst INTERNAL_IP_RANGES = [\n  /^127\\./, // localhost\n  /^10\\./, // 10.0.0.0/8\n  /^172\\.(1[6-9]|2[0-9]|3[0-1])\\./, // 172.16.0.0/12\n  /^192\\.168\\./, // 192.168.0.0/16\n  /^169\\.254\\./, // link-local\n  /^0\\./, // invalid\n  /^224\\./, // multicast\n  /^240\\./, // reserved\n];\n\n/**\n * Validate bash command with security checks\n */\nexport function validateBashCommand(command: string): ValidationResult {\n  if (typeof command !== 'string') {\n    return { \n      valid: false, \n      error: new Error('Command must be a string'),\n      warnings: [] \n    };\n  }\n\n  if (command.length > MAX_COMMAND_LENGTH) {\n    return {\n      valid: false,\n      error: new Error(`Command too long (max ${MAX_COMMAND_LENGTH} chars)`),\n      warnings: []\n    };\n  }\n\n  const warnings: string[] = [];\n\n  // Check for dangerous patterns\n  for (const pattern of DANGEROUS_PATTERNS) {\n    if (pattern.test(command)) {\n      warnings.push(`Command contains potentially dangerous pattern: ${pattern}`);\n    }\n  }\n\n  return { valid: true, warnings };\n}\n\n/**\n * Validate target (IP address or hostname)\n */\nexport function validateTarget(target: string): ValidationResult {\n  if (typeof target !== 'string') {\n    return {\n      valid: false,\n      error: new Error('Target must be a string'),\n      warnings: []\n    };\n  }\n\n  if (target.length > MAX_TARGET_LENGTH) {\n    return {\n      valid: false,\n      error: new Error(`Target too long (max ${MAX_TARGET_LENGTH} chars)`),\n      warnings: []\n    };\n  }\n\n  // Check for shell metacharacters\n  if (/[|&;`$<>(){}[\\]'\"\\\\]/.test(target)) {\n    return {\n      valid: false,\n      error: new Error('Target contains invalid characters'),\n      warnings: []\n    };\n  }\n\n  // Check for internal IP addresses (unless explicitly allowed)\n  for (const pattern of INTERNAL_IP_RANGES) {\n    if (pattern.test(target)) {\n      return {\n        valid: false,\n        error: new Error('Target appears to be an internal IP address'),\n        warnings: []\n      };\n    }\n  }\n\n  // Validate as IP address or hostname\n  const ipRegex = /^(\\d{1,3}\\.){3}\\d{1,3}$/;\n  const hostnameRegex = /^[a-zA-Z0-9]([a-zA-Z0-9\\-]*[a-zA-Z0-9])?(\\.[a-zA-Z0-9]([a-zA-Z0-9\\-]*[a-zA-Z0-9])?)*$/;\n  \n  if (!ipRegex.test(target) && !hostnameRegex.test(target)) {\n    return {\n      valid: false,\n      error: new Error('Invalid target format (must be IP or hostname)'),\n      warnings: []\n    };\n  }\n\n  return { valid: true, warnings: [] };\n}\n\n/**\n * Validate port number or range\n */\nexport function validatePorts(ports: string): ValidationResult {\n  if (typeof ports !== 'string') {\n    return {\n      valid: false,\n      error: new Error('Ports must be a string'),\n      warnings: []\n    };\n  }\n\n  const portList = ports.split(',');\n  for (const port of portList) {\n    if (port.includes('-')) {\n      // Handle port ranges\n      const [startStr, endStr] = port.split('-');\n      const start = parseInt(startStr.trim(), 10);\n      const end = parseInt(endStr.trim(), 10);\n      \n      if (isNaN(start) || isNaN(end)) {\n        return {\n          valid: false,\n          error: new Error(`Invalid port range format: ${port}`),\n          warnings: []\n        };\n      }\n      \n      if (start < MIN_PORT || end > MAX_PORT || start > end) {\n        return {\n          valid: false,\n          error: new Error(`Port range out of bounds: ${port}`),\n          warnings: []\n        };\n      }\n    } else {\n      // Single port\n      const portNum = parseInt(port.trim(), 10);\n      if (isNaN(portNum) || portNum < MIN_PORT || portNum > MAX_PORT) {\n        return {\n          valid: false,\n          error: new Error(`Invalid port number: ${port}`),\n          warnings: []\n        };\n      }\n    }\n  }\n\n  return { valid: true, warnings: [] };\n}\n\n/**\n * Validate URL for safe usage\n */\nexport function validateUrl(url: string): ValidationResult {\n  if (typeof url !== 'string') {\n    return {\n      valid: false,\n      error: new Error('URL must be a string'),\n      warnings: []\n    };\n  }\n\n  if (url.length > MAX_URL_LENGTH) {\n    return {\n      valid: false,\n      error: new Error(`URL too long (max ${MAX_URL_LENGTH} chars)`),\n      warnings: []\n    };\n  }\n\n  // Check for dangerous patterns\n  if (/[\\x00-\\x1F\\x7F]/.test(url)) {\n    return {\n      valid: false,\n      error: new Error('URL contains control characters'),\n      warnings: []\n    };\n  }\n\n  // Validate URL format\n  try {\n    const parsed = new URL(url);\n    \n    // Allow only http/https protocols\n    if (!['http:', 'https:'].includes(parsed.protocol)) {\n      return {\n        valid: false,\n        error: new Error('Only http and https protocols are allowed'),\n        warnings: []\n      };\n    }\n\n    // Validate hostname\n    const hostnameResult = validateTarget(parsed.hostname);\n    if (!hostnameResult.valid) {\n      return hostnameResult;\n    }\n\n  } catch (error) {\n    return {\n      valid: false,\n      error: new Error(`Invalid URL format: ${url}`),\n      warnings: []\n    };\n  }\n\n  return { valid: true, warnings: [] };\n}\n\n/**\n * Validate tool arguments against type constraints\n */\nexport function validateToolArgs(\n  toolName: string,\n  args: Record<string, unknown>,\n  constraints: Record<string, ToolConstraint>\n): ValidationResult {\n  for (const [key, constraint] of Object.entries(constraints)) {\n    const value = args[key];\n    if (value === undefined) continue;\n\n    if (!matchesType(value, constraint.type)) {\n      return {\n        valid: false,\n        error: new Error(`Invalid type for ${toolName}.${key}: expected ${constraint.type}.`),\n        warnings: [],\n      };\n    }\n\n    if (constraint.type === 'number') {\n      const num = value as number;\n      if (constraint.max !== undefined && num > constraint.max) {\n        return {\n          valid: false,\n          error: new Error(`${toolName}.${key} exceeds maximum (${num} > ${constraint.max}).`),\n          warnings: [],\n        };\n      }\n      if (constraint.min !== undefined && num < constraint.min) {\n        return {\n          valid: false,\n          error: new Error(`${toolName}.${key} below minimum (${num} < ${constraint.min}).`),\n          warnings: [],\n        };\n      }\n    }\n  }\n\n  return { valid: true, warnings: [] };\n}\n\n/**\n * Utility fixer for common patterns\n */\nexport class SmartFixer {\n  static fixDangerousCommand(command: string): { fixed: string; changes: string[] } {\n    let fixed = command;\n    const changes: string[] = [];\n\n    if (/\\brm\\s+-rf\\s+\\/(\\s|$)/i.test(fixed)) {\n      fixed = fixed.replace(/\\brm\\s+-rf\\s+\\/(\\s|$)/i, 'rm -rf ./');\n      changes.push('Rewrote \"rm -rf /\" to \"rm -rf ./\".');\n    }\n    if (/chmod\\s+-R\\s+777\\b/i.test(fixed)) {\n      fixed = fixed.replace(/chmod\\s+-R\\s+777\\b/i, 'chmod -R 755');\n      changes.push('Reduced chmod 777 to chmod 755.');\n    }\n    if (/git\\s+push\\s+--force\\b/i.test(fixed)) {\n      fixed = fixed.replace(/git\\s+push\\s+--force\\b/i, 'git push --force-with-lease');\n      changes.push('Replaced --force with --force-with-lease.');\n    }\n\n    return { fixed, changes };\n  }\n\n  static fixResourceLimits(\n    args: Record<string, unknown>,\n    constraints: Record<string, { max?: number; min?: number }>\n  ): { fixed: Record<string, unknown>; changes: string[] } {\n    const fixed = { ...args };\n    const changes: string[] = [];\n\n    for (const [key, constraint] of Object.entries(constraints)) {\n      const value = fixed[key];\n      if (typeof value !== 'number') continue;\n\n      if (constraint.max !== undefined && value > constraint.max) {\n        const newValue = Math.floor(constraint.max * 0.8);\n        fixed[key] = newValue;\n        changes.push(`Lowered ${key} to ${newValue} (80% of max ${constraint.max}).`);\n      } else if (constraint.min !== undefined && value < constraint.min) {\n        fixed[key] = constraint.min;\n        changes.push(`Raised ${key} to minimum ${constraint.min}.`);\n      }\n    }\n\n    return { fixed, changes };\n  }\n\n  static fixValidationErrors(\n    args: Record<string, unknown>,\n    constraints: Record<string, ToolConstraint>\n  ): { fixed: Record<string, unknown>; changes: string[] } {\n    const fixed = { ...args };\n    const changes: string[] = [];\n\n    for (const [key, constraint] of Object.entries(constraints)) {\n      const value = fixed[key];\n\n      if (constraint.type === 'number' && typeof value === 'string' && value.trim() !== '') {\n        const parsed = Number(value);\n        if (!Number.isNaN(parsed)) {\n          fixed[key] = parsed;\n          changes.push(`Coerced ${key} to number.`);\n        }\n      }\n\n      if (constraint.type === 'boolean' && typeof value === 'string') {\n        if (value.toLowerCase() === 'true') {\n          fixed[key] = true;\n          changes.push(`Coerced ${key} to boolean true.`);\n        } else if (value.toLowerCase() === 'false') {\n          fixed[key] = false;\n          changes.push(`Coerced ${key} to boolean false.`);\n        }\n      }\n    }\n\n    return { fixed, changes };\n  }\n}\n\n/**\n * Validator wrapper with optional auto-fix\n */\nexport class AutoFixValidator<T = string> {\n  private enabled: boolean;\n\n  constructor(autoFix: boolean) {\n    this.enabled = autoFix;\n  }\n\n  setAutoFix(enabled: boolean): void {\n    this.enabled = enabled;\n  }\n\n  async validate(\n    value: T,\n    validator: (value: T) => ValidationResult\n  ): Promise<{ value: T; result: ValidationResult }> {\n    const result = validator(value);\n    return { value, result };\n  }\n}\n\nfunction matchesType(value: unknown, type: ToolConstraint['type']): boolean {\n  if (type === 'number') return typeof value === 'number';\n  if (type === 'string') return typeof value === 'string';\n  if (type === 'boolean') return typeof value === 'boolean';\n  return false;\n}\n"],"mappings":"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","ignoreList":[]}