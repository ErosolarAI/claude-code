{"version":3,"names":["cov_ylsgbk2m3","actualCoverage","TRANSIENT_ERROR_PATTERNS","s","DEFAULT_RETRY_CONFIG","maxRetries","initialDelayMs","maxDelayMs","backoffMultiplier","DEFAULT_RATE_LIMIT_CONFIG","minDelayMs","isTransientError","error","f","Error","b","message","toLowerCase","errorName","name","errorCode","code","allText","some","pattern","includes","isRateLimitError","status","isAuthError","sleep","ms","Promise","resolve","setTimeout","calculateBackoffDelay","attempt","config","delay","Math","pow","jitter","random","min","withRetry","operation","options","shouldRetry","lastError","onRetry","extractSystemMessage","messages","systemMessages","filter","m","role","rest","length","system","map","content","JSON","stringify","join","mergeConsecutiveMessages","merged","current","push","emptyUsage","inputTokens","outputTokens","totalTokens","mergeUsage","a","BaseProvider","constructor","model","maxTokens","temperature","retryConfig","rateLimitConfig","generate","tools","doGenerate","generateStream","doGenerateStream","getModels","_error","_attempt","_delay"],"sources":["baseProvider.ts"],"sourcesContent":["/**\n * Base Provider - Abstract LLM Provider Implementation\n *\n * Provides common functionality for LLM providers:\n * - Retry logic with exponential backoff\n * - Rate limit handling\n * - Transient error recovery\n * - Message conversion utilities\n * - Usage tracking\n *\n * Usage:\n * ```typescript\n * class MyProvider extends BaseProvider {\n *   readonly id = 'my-provider';\n *\n *   protected async doGenerate(messages, tools): Promise<ProviderResponse> {\n *     // Provider-specific implementation\n *   }\n *\n *   protected async doGenerateStream(messages, tools): AsyncIterable<StreamChunk> {\n *     // Provider-specific implementation\n *   }\n * }\n * ```\n */\n\nimport type {\n  ConversationMessage,\n  LLMProvider,\n  ProviderResponse,\n  ProviderToolDefinition,\n  ProviderUsage,\n  StreamChunk,\n  ProviderModelInfo,\n} from '../core/types.js';\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// Constants\n// ═══════════════════════════════════════════════════════════════════════════════\n\n/** Patterns that indicate transient/retryable errors */\nexport const TRANSIENT_ERROR_PATTERNS = [\n  'premature close',\n  'premature end',\n  'unexpected end',\n  'aborted',\n  'fetcherror',\n  'invalid response body',\n  'gunzip',\n  'decompress',\n  'econnreset',\n  'econnrefused',\n  'epipe',\n  'socket hang up',\n  'network',\n  'timeout',\n  '500',\n  '502',\n  '503',\n  '504',\n  'overloaded',\n] as const;\n\n/** Default retry configuration */\nexport const DEFAULT_RETRY_CONFIG = {\n  maxRetries: 3,\n  initialDelayMs: 1000,\n  maxDelayMs: 30000,\n  backoffMultiplier: 2,\n} as const;\n\n/** Default rate limit configuration */\nexport const DEFAULT_RATE_LIMIT_CONFIG = {\n  maxRetries: 4,\n  initialDelayMs: 1500,\n  minDelayMs: 750,\n  maxDelayMs: 40000,\n} as const;\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// Types\n// ═══════════════════════════════════════════════════════════════════════════════\n\nexport interface RetryConfig {\n  maxRetries: number;\n  initialDelayMs: number;\n  maxDelayMs: number;\n  backoffMultiplier: number;\n}\n\nexport interface RateLimitConfig {\n  maxRetries: number;\n  initialDelayMs: number;\n  minDelayMs: number;\n  maxDelayMs: number;\n}\n\nexport interface BaseProviderOptions {\n  model: string;\n  maxTokens?: number;\n  temperature?: number;\n  retryConfig?: Partial<RetryConfig>;\n  rateLimitConfig?: Partial<RateLimitConfig>;\n}\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// Error Detection Utilities\n// ═══════════════════════════════════════════════════════════════════════════════\n\n/**\n * Check if an error is transient and can be retried\n */\nexport function isTransientError(error: unknown): boolean {\n  if (!(error instanceof Error)) return false;\n\n  const message = error.message.toLowerCase();\n  const errorName = error.name?.toLowerCase() ?? '';\n  const errorCode = (error as { code?: string }).code?.toLowerCase() ?? '';\n  const allText = `${message} ${errorName} ${errorCode}`;\n\n  return TRANSIENT_ERROR_PATTERNS.some((pattern) => allText.includes(pattern));\n}\n\n/**\n * Check if an error is a rate limit error\n */\nexport function isRateLimitError(error: unknown): boolean {\n  if (!(error instanceof Error)) return false;\n\n  const message = error.message.toLowerCase();\n\n  // Check for common rate limit indicators\n  if (\n    message.includes('rate limit') ||\n    message.includes('rate_limit') ||\n    message.includes('too many requests') ||\n    message.includes('429')\n  ) {\n    return true;\n  }\n\n  // Check for status code\n  const status = (error as { status?: number }).status;\n  return status === 429;\n}\n\n/**\n * Check if an error is an authentication error\n */\nexport function isAuthError(error: unknown): boolean {\n  if (!(error instanceof Error)) return false;\n\n  const message = error.message.toLowerCase();\n  const status = (error as { status?: number }).status;\n\n  return (\n    status === 401 ||\n    status === 403 ||\n    message.includes('unauthorized') ||\n    message.includes('invalid api key') ||\n    message.includes('authentication')\n  );\n}\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// Retry Utilities\n// ═══════════════════════════════════════════════════════════════════════════════\n\n/**\n * Sleep for a given duration\n */\nexport function sleep(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\n/**\n * Calculate exponential backoff delay\n */\nexport function calculateBackoffDelay(\n  attempt: number,\n  config: RetryConfig\n): number {\n  const delay = config.initialDelayMs * Math.pow(config.backoffMultiplier, attempt);\n  // Add jitter (±10%)\n  const jitter = delay * 0.1 * (Math.random() * 2 - 1);\n  return Math.min(delay + jitter, config.maxDelayMs);\n}\n\n/**\n * Execute an operation with retry logic\n */\nexport async function withRetry<T>(\n  operation: () => Promise<T>,\n  options: {\n    config?: Partial<RetryConfig>;\n    shouldRetry?: (error: unknown) => boolean;\n    onRetry?: (error: unknown, attempt: number, delay: number) => void;\n  } = {}\n): Promise<T> {\n  const config: RetryConfig = {\n    ...DEFAULT_RETRY_CONFIG,\n    ...options.config,\n  };\n  const shouldRetry = options.shouldRetry ?? isTransientError;\n\n  let lastError: unknown;\n\n  for (let attempt = 0; attempt <= config.maxRetries; attempt++) {\n    try {\n      return await operation();\n    } catch (error) {\n      lastError = error;\n\n      // Don't retry auth errors\n      if (isAuthError(error)) {\n        throw error;\n      }\n\n      // Check if we should retry\n      if (attempt === config.maxRetries || !shouldRetry(error)) {\n        throw error;\n      }\n\n      // Calculate delay and wait\n      const delay = calculateBackoffDelay(attempt, config);\n      options.onRetry?.(error, attempt, delay);\n      await sleep(delay);\n    }\n  }\n\n  throw lastError;\n}\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// Message Utilities\n// ═══════════════════════════════════════════════════════════════════════════════\n\n/**\n * Extract system message from conversation\n */\nexport function extractSystemMessage(\n  messages: ConversationMessage[]\n): { system: string | null; rest: ConversationMessage[] } {\n  const systemMessages = messages.filter((m) => m.role === 'system');\n  const rest = messages.filter((m) => m.role !== 'system');\n\n  if (systemMessages.length === 0) {\n    return { system: null, rest };\n  }\n\n  // Combine all system messages\n  const system = systemMessages\n    .map((m) => (typeof m.content === 'string' ? m.content : JSON.stringify(m.content)))\n    .join('\\n\\n');\n\n  return { system, rest };\n}\n\n/**\n * Merge consecutive messages from the same role\n */\nexport function mergeConsecutiveMessages(\n  messages: ConversationMessage[]\n): ConversationMessage[] {\n  if (messages.length === 0) return [];\n\n  const merged: ConversationMessage[] = [];\n  let current: ConversationMessage | null = null;\n\n  for (const message of messages) {\n    if (!current) {\n      current = { ...message };\n      continue;\n    }\n\n    if (current.role === message.role && typeof current.content === 'string' && typeof message.content === 'string') {\n      // Merge text content\n      current.content = `${current.content}\\n\\n${message.content}`;\n    } else {\n      merged.push(current);\n      current = { ...message };\n    }\n  }\n\n  if (current) {\n    merged.push(current);\n  }\n\n  return merged;\n}\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// Usage Tracking\n// ═══════════════════════════════════════════════════════════════════════════════\n\n/**\n * Create an empty usage object\n */\nexport function emptyUsage(): ProviderUsage {\n  return {\n    inputTokens: 0,\n    outputTokens: 0,\n    totalTokens: 0,\n  };\n}\n\n/**\n * Merge usage objects\n */\nexport function mergeUsage(a: ProviderUsage, b: ProviderUsage): ProviderUsage {\n  return {\n    inputTokens: (a.inputTokens ?? 0) + (b.inputTokens ?? 0),\n    outputTokens: (a.outputTokens ?? 0) + (b.outputTokens ?? 0),\n    totalTokens: (a.totalTokens ?? 0) + (b.totalTokens ?? 0),\n  };\n}\n\n// ═══════════════════════════════════════════════════════════════════════════════\n// Abstract Base Provider\n// ═══════════════════════════════════════════════════════════════════════════════\n\n/**\n * Abstract base class for LLM providers\n *\n * Implements common functionality like retry logic and error handling.\n * Subclasses must implement the abstract methods for provider-specific behavior.\n */\nexport abstract class BaseProvider implements LLMProvider {\n  abstract readonly id: string;\n  readonly model: string;\n\n  protected readonly maxTokens: number;\n  protected readonly temperature: number;\n  protected readonly retryConfig: RetryConfig;\n  protected readonly rateLimitConfig: RateLimitConfig;\n\n  constructor(options: BaseProviderOptions) {\n    this.model = options.model;\n    this.maxTokens = options.maxTokens ?? 4096;\n    this.temperature = options.temperature ?? 0;\n    this.retryConfig = { ...DEFAULT_RETRY_CONFIG, ...options.retryConfig };\n    this.rateLimitConfig = { ...DEFAULT_RATE_LIMIT_CONFIG, ...options.rateLimitConfig };\n  }\n\n  /**\n   * Generate a response (implemented by subclass)\n   */\n  async generate(\n    messages: ConversationMessage[],\n    tools: ProviderToolDefinition[]\n  ): Promise<ProviderResponse> {\n    return withRetry(\n      () => this.doGenerate(messages, tools),\n      {\n        config: this.retryConfig,\n        shouldRetry: (error) => isTransientError(error) || isRateLimitError(error),\n        onRetry: (error, attempt, delay) => {\n          this.onRetry(error, attempt, delay);\n        },\n      }\n    );\n  }\n\n  /**\n   * Generate a streaming response (implemented by subclass)\n   */\n  async *generateStream(\n    messages: ConversationMessage[],\n    tools: ProviderToolDefinition[]\n  ): AsyncIterableIterator<StreamChunk> {\n    // Stream operations are harder to retry, so we do best-effort\n    yield* this.doGenerateStream(messages, tools);\n  }\n\n  /**\n   * Get available models (optional, implemented by subclass)\n   */\n  async getModels(): Promise<ProviderModelInfo[]> {\n    return [];\n  }\n\n  /**\n   * Provider-specific generate implementation\n   */\n  protected abstract doGenerate(\n    messages: ConversationMessage[],\n    tools: ProviderToolDefinition[]\n  ): Promise<ProviderResponse>;\n\n  /**\n   * Provider-specific stream implementation\n   */\n  protected abstract doGenerateStream(\n    messages: ConversationMessage[],\n    tools: ProviderToolDefinition[]\n  ): AsyncIterable<StreamChunk>;\n\n  /**\n   * Called when a retry is about to happen\n   */\n  protected onRetry(_error: unknown, _attempt: number, _delay: number): void {\n    // Subclasses can override for logging\n  }\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}