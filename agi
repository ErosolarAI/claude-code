#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" && pwd)"
DIST_BIN="$SCRIPT_DIR/dist/bin/agi.js"
SRC_BIN="$SCRIPT_DIR/src/bin/agi.ts"

if [ -x "$DIST_BIN" ]; then
  exec node "$DIST_BIN" "$@"
fi

if command -v ts-node >/dev/null 2>&1; then
  exec node --loader ts-node/esm "$SRC_BIN" "$@"
fi

echo "dist/bin/agi.js not found. Run 'npm run build' (or install ts-node) then re-run ./agi." >&2
exit 1
